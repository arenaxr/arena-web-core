{"version":3,"file":"lib-jitsi-meet.min.js","mappings":"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","sources":["webpack://JitsiMeetJS/webpack/universalModuleDefinition","webpack://JitsiMeetJS/./node_modules/lodash-es/_listCacheClear.js","webpack://JitsiMeetJS/./node_modules/lodash-es/eq.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_assocIndexOf.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_listCacheDelete.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_ListCache.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_listCacheGet.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_listCacheHas.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_listCacheSet.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_freeGlobal.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_root.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_Symbol.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_getRawTag.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_objectToString.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_baseGetTag.js","webpack://JitsiMeetJS/./node_modules/lodash-es/isObject.js","webpack://JitsiMeetJS/./node_modules/lodash-es/isFunction.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_coreJsData.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_isMasked.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_toSource.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_baseIsNative.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_getNative.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_getValue.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_Map.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_nativeCreate.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_hashGet.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_hashHas.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_Hash.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_hashClear.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_hashDelete.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_hashSet.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_getMapData.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_isKeyable.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_MapCache.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_mapCacheClear.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_mapCacheDelete.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_mapCacheGet.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_mapCacheHas.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_mapCacheSet.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_Stack.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_stackClear.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_stackDelete.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_stackGet.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_stackHas.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_stackSet.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_defineProperty.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_baseAssignValue.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_assignMergeValue.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_baseFor.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_createBaseFor.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_cloneBuffer.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_Uint8Array.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_cloneArrayBuffer.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_cloneTypedArray.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_copyArray.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_baseCreate.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_overArg.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_getPrototype.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_isPrototype.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_initCloneObject.js","webpack://JitsiMeetJS/./node_modules/lodash-es/isObjectLike.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_baseIsArguments.js","webpack://JitsiMeetJS/./node_modules/lodash-es/isArguments.js","webpack://JitsiMeetJS/./node_modules/lodash-es/isArray.js","webpack://JitsiMeetJS/./node_modules/lodash-es/isLength.js","webpack://JitsiMeetJS/./node_modules/lodash-es/isArrayLike.js","webpack://JitsiMeetJS/./node_modules/lodash-es/isBuffer.js","webpack://JitsiMeetJS/./node_modules/lodash-es/stubFalse.js","webpack://JitsiMeetJS/./node_modules/lodash-es/isPlainObject.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_baseIsTypedArray.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_baseUnary.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_nodeUtil.js","webpack://JitsiMeetJS/./node_modules/lodash-es/isTypedArray.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_safeGet.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_assignValue.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_copyObject.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_isIndex.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_arrayLikeKeys.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_baseTimes.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_baseKeysIn.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_nativeKeysIn.js","webpack://JitsiMeetJS/./node_modules/lodash-es/keysIn.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_baseMergeDeep.js","webpack://JitsiMeetJS/./node_modules/lodash-es/isArrayLikeObject.js","webpack://JitsiMeetJS/./node_modules/lodash-es/toPlainObject.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_baseMerge.js","webpack://JitsiMeetJS/./node_modules/lodash-es/identity.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_overRest.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_baseSetToString.js","webpack://JitsiMeetJS/./node_modules/lodash-es/constant.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_shortOut.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_setToString.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_baseRest.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_apply.js","webpack://JitsiMeetJS/./node_modules/lodash-es/merge.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_createAssigner.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_isIterateeCall.js","webpack://JitsiMeetJS/./JitsiConferenceErrors.ts","webpack://JitsiMeetJS/./JitsiConferenceEvents.ts","webpack://JitsiMeetJS/./node_modules/lodash-es/_SetCache.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_setCacheAdd.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_setCacheHas.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_arraySome.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_equalArrays.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_cacheHas.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_mapToArray.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_setToArray.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_equalByTag.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_arrayPush.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_baseGetAllKeys.js","webpack://JitsiMeetJS/./node_modules/lodash-es/stubArray.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_getSymbols.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_arrayFilter.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_nativeKeys.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_baseKeys.js","webpack://JitsiMeetJS/./node_modules/lodash-es/keys.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_getAllKeys.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_equalObjects.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_DataView.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_Promise.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_Set.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_WeakMap.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_getTag.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_baseIsEqualDeep.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_baseIsEqual.js","webpack://JitsiMeetJS/./node_modules/lodash-es/isEqual.js","webpack://JitsiMeetJS/./JitsiTrackEvents.ts","webpack://JitsiMeetJS/./node_modules/@jitsi/js-utils/browser-detection/constants.js","webpack://JitsiMeetJS/./node_modules/@jitsi/js-utils/browser-detection/BrowserDetection.js","webpack://JitsiMeetJS/./node_modules/@jitsi/rtcstats/events.js","webpack://JitsiMeetJS/./node_modules/@jitsi/rtcstats/rtcstats.js","webpack://JitsiMeetJS/./node_modules/uuid/dist/esm-browser/rng.js","webpack://JitsiMeetJS/./node_modules/uuid/dist/esm-browser/regex.js","webpack://JitsiMeetJS/./node_modules/uuid/dist/esm-browser/stringify.js","webpack://JitsiMeetJS/./node_modules/uuid/dist/esm-browser/validate.js","webpack://JitsiMeetJS/./node_modules/uuid/dist/esm-browser/v4.js","webpack://JitsiMeetJS/./node_modules/@jitsi/rtcstats/constants.js","webpack://JitsiMeetJS/./node_modules/@jitsi/rtcstats/obfuscator.js","webpack://JitsiMeetJS/./node_modules/@jitsi/rtcstats/trace-ws.js","webpack://JitsiMeetJS/./node_modules/@jitsi/js-utils/jitsi-local-storage/index.js","webpack://JitsiMeetJS/./node_modules/@jitsi/js-utils/json.js","webpack://JitsiMeetJS/./modules/util/RandomUtil.ts","webpack://JitsiMeetJS/./modules/util/UsernameGenerator.ts","webpack://JitsiMeetJS/./modules/settings/Settings.ts","webpack://JitsiMeetJS/./modules/util/EventEmitter.ts","webpack://JitsiMeetJS/./modules/RTCStats/RTCStatsEvents.ts","webpack://JitsiMeetJS/./modules/RTCStats/DefaulLogStorage.ts","webpack://JitsiMeetJS/./modules/RTCStats/RTCStats.ts","webpack://JitsiMeetJS/./service/statistics/AnalyticsEvents.ts","webpack://JitsiMeetJS/./service/statistics/Events.ts","webpack://JitsiMeetJS/./modules/browser/index.js","webpack://JitsiMeetJS/./modules/browser/BrowserCapabilities.ts","webpack://JitsiMeetJS/./modules/watchRTC/WatchRTC.ts","webpack://JitsiMeetJS/./modules/watchRTC/functions.ts","webpack://JitsiMeetJS/./modules/statistics/AnalyticsAdapter.ts","webpack://JitsiMeetJS/./modules/statistics/LocalStatsCollector.ts","webpack://JitsiMeetJS/./service/RTC/MediaType.ts","webpack://JitsiMeetJS/./modules/flags/FeatureFlags.ts","webpack://JitsiMeetJS/./modules/util/MathUtil.ts","webpack://JitsiMeetJS/./modules/statistics/RTPStatsCollector.js","webpack://JitsiMeetJS/./modules/statistics/statistics.ts","webpack://JitsiMeetJS/./service/statistics/constants.ts","webpack://JitsiMeetJS/./modules/util/EventEmitterForwarder.ts","webpack://JitsiMeetJS/./service/RTC/RTCEvents.ts","webpack://JitsiMeetJS/./service/authentication/AuthenticationEvents.ts","webpack://JitsiMeetJS/./service/xmpp/XMPPEvents.ts","webpack://JitsiMeetJS/./JitsiConferenceEventManager.ts","webpack://JitsiMeetJS/./modules/statistics/constants.ts","webpack://JitsiMeetJS/./JitsiConnectionEvents.ts","webpack://JitsiMeetJS/./JitsiParticipant.ts","webpack://JitsiMeetJS/./JitsiTrackErrors.ts","webpack://JitsiMeetJS/./JitsiTrackError.ts","webpack://JitsiMeetJS/./node_modules/lodash-es/_arrayEach.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_getSymbolsIn.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_getAllKeysIn.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_initCloneArray.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_cloneRegExp.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_cloneSymbol.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_initCloneByTag.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_cloneDataView.js","webpack://JitsiMeetJS/./node_modules/lodash-es/isMap.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_baseIsMap.js","webpack://JitsiMeetJS/./node_modules/lodash-es/isSet.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_baseIsSet.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_baseClone.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_copySymbolsIn.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_baseAssignIn.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_copySymbols.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_baseAssign.js","webpack://JitsiMeetJS/./node_modules/lodash-es/cloneDeep.js","webpack://JitsiMeetJS/./service/RTC/VideoType.ts","webpack://JitsiMeetJS/./modules/util/Listenable.ts","webpack://JitsiMeetJS/./modules/RTC/BridgeChannel.ts","webpack://JitsiMeetJS/./service/RTC/CameraFacingMode.ts","webpack://JitsiMeetJS/./node_modules/webrtc-adapter/src/js/utils.js","webpack://JitsiMeetJS/./node_modules/webrtc-adapter/src/js/chrome/getusermedia.js","webpack://JitsiMeetJS/./node_modules/webrtc-adapter/src/js/chrome/getdisplaymedia.js","webpack://JitsiMeetJS/./node_modules/webrtc-adapter/src/js/chrome/chrome_shim.js","webpack://JitsiMeetJS/./node_modules/webrtc-adapter/src/js/firefox/getusermedia.js","webpack://JitsiMeetJS/./node_modules/webrtc-adapter/src/js/firefox/getdisplaymedia.js","webpack://JitsiMeetJS/./node_modules/webrtc-adapter/src/js/firefox/firefox_shim.js","webpack://JitsiMeetJS/./node_modules/webrtc-adapter/src/js/safari/safari_shim.js","webpack://JitsiMeetJS/./node_modules/webrtc-adapter/src/js/common_shim.js","webpack://JitsiMeetJS/./node_modules/webrtc-adapter/src/js/adapter_factory.js","webpack://JitsiMeetJS/./node_modules/webrtc-adapter/src/js/adapter_core.js","webpack://JitsiMeetJS/./service/RTC/Resolutions.ts","webpack://JitsiMeetJS/./modules/RTC/ScreenObtainer.ts","webpack://JitsiMeetJS/./modules/RTC/RTCUtils.js","webpack://JitsiMeetJS/./modules/RTC/JitsiTrack.ts","webpack://JitsiMeetJS/./modules/RTC/JitsiLocalTrack.ts","webpack://JitsiMeetJS/./service/RTC/CodecMimeType.ts","webpack://JitsiMeetJS/./service/RTC/MediaDirection.ts","webpack://JitsiMeetJS/./service/RTC/SignalingEvents.ts","webpack://JitsiMeetJS/./service/RTC/SignalingLayer.ts","webpack://JitsiMeetJS/./service/RTC/StandardVideoQualitySettings.ts","webpack://JitsiMeetJS/./modules/sdp/SdpTransformUtil.ts","webpack://JitsiMeetJS/./modules/sdp/LocalSdpMunger.ts","webpack://JitsiMeetJS/./modules/sdp/SDPUtil.ts","webpack://JitsiMeetJS/./modules/sdp/RtxModifier.js","webpack://JitsiMeetJS/./service/xmpp/XMPPExtensioProtocols.ts","webpack://JitsiMeetJS/./modules/util/XMLUtils.ts","webpack://JitsiMeetJS/./modules/sdp/SDP.ts","webpack://JitsiMeetJS/./modules/sdp/SdpSimulcast.ts","webpack://JitsiMeetJS/./modules/connectivity/TrackStreamingStatus.ts","webpack://JitsiMeetJS/./modules/RTC/JitsiRemoteTrack.ts","webpack://JitsiMeetJS/./service/RTC/VideoEncoderScalabilityMode.ts","webpack://JitsiMeetJS/./modules/RTC/TPCUtils.ts","webpack://JitsiMeetJS/./modules/RTC/TraceablePeerConnection.ts","webpack://JitsiMeetJS/./modules/RTC/RTC.js","webpack://JitsiMeetJS/./service/connectivity/ConnectionQualityEvents.ts","webpack://JitsiMeetJS/./modules/connectivity/ConnectionQuality.ts","webpack://JitsiMeetJS/./modules/connectivity/IceFailedHandling.ts","webpack://JitsiMeetJS/./modules/detection/DetectionEvents.ts","webpack://JitsiMeetJS/./modules/detection/NoAudioSignalDetection.ts","webpack://JitsiMeetJS/./modules/detection/P2PDominantSpeakerDetection.ts","webpack://JitsiMeetJS/./modules/webaudio/WebAudioUtils.ts","webpack://JitsiMeetJS/./modules/detection/TrackVADEmitter.ts","webpack://JitsiMeetJS/./modules/detection/VADAudioAnalyser.ts","webpack://JitsiMeetJS/./modules/detection/VADNoiseDetection.ts","webpack://JitsiMeetJS/./modules/detection/VADTalkMutedDetection.ts","webpack://JitsiMeetJS/./modules/util/Deferred.ts","webpack://JitsiMeetJS/./modules/e2ee/E2EEContext.js","webpack://JitsiMeetJS/./modules/e2ee/KeyHandler.js","webpack://JitsiMeetJS/./modules/e2ee/ExternallyManagedKeyHandler.js","webpack://JitsiMeetJS/./node_modules/lodash-es/now.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_trimmedEndIndex.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_baseTrim.js","webpack://JitsiMeetJS/./node_modules/lodash-es/isSymbol.js","webpack://JitsiMeetJS/./node_modules/lodash-es/toNumber.js","webpack://JitsiMeetJS/./node_modules/lodash-es/debounce.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_baseToString.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_arrayMap.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_unescapeHtmlChar.js","webpack://JitsiMeetJS/./node_modules/lodash-es/_basePropertyOf.js","webpack://JitsiMeetJS/./node_modules/lodash-es/unescape.js","webpack://JitsiMeetJS/./node_modules/lodash-es/toString.js","webpack://JitsiMeetJS/./JitsiConnectionErrors.ts","webpack://JitsiMeetJS/./modules/xmpp/sha1.ts","webpack://JitsiMeetJS/./modules/xmpp/Caps.ts","webpack://JitsiMeetJS/./modules/xmpp/FileSharing.ts","webpack://JitsiMeetJS/./service/connectivity/Constants.ts","webpack://JitsiMeetJS/./modules/connectivity/NetworkInfo.ts","webpack://JitsiMeetJS/./modules/util/Retry.ts","webpack://JitsiMeetJS/./modules/xmpp/ResumeTask.ts","webpack://JitsiMeetJS/./modules/xmpp/StropheLastSuccess.ts","webpack://JitsiMeetJS/./modules/xmpp/strophe.stream-management.ts","webpack://JitsiMeetJS/./modules/xmpp/ConnectionPlugin.ts","webpack://JitsiMeetJS/./modules/xmpp/strophe.ping.ts","webpack://JitsiMeetJS/./modules/xmpp/XmppConnection.ts","webpack://JitsiMeetJS/./modules/xmpp/StropheErrorHandler.ts","webpack://JitsiMeetJS/./modules/xmpp/moderator.js","webpack://JitsiMeetJS/./modules/xmpp/strophe.disco.js","webpack://JitsiMeetJS/./JitsiTranscriptionStatus.ts","webpack://JitsiMeetJS/./modules/xmpp/AVModeration.ts","webpack://JitsiMeetJS/./modules/xmpp/BreakoutRooms.js","webpack://JitsiMeetJS/./modules/xmpp/Lobby.js","webpack://JitsiMeetJS/./modules/xmpp/Polls.ts","webpack://JitsiMeetJS/./modules/xmpp/RoomMetadata.ts","webpack://JitsiMeetJS/./modules/xmpp/ChatRoom.ts","webpack://JitsiMeetJS/./node_modules/emoji-regex/index.mjs","webpack://JitsiMeetJS/./modules/xmpp/strophe.emuc.ts","webpack://JitsiMeetJS/./modules/xmpp/JingleHelperFunctions.ts","webpack://JitsiMeetJS/./modules/sdp/SDPDiffer.ts","webpack://JitsiMeetJS/./node_modules/async-es/internal/onlyOnce.js","webpack://JitsiMeetJS/./node_modules/async-es/internal/setImmediate.js","webpack://JitsiMeetJS/./node_modules/async-es/internal/DoublyLinkedList.js","webpack://JitsiMeetJS/./node_modules/async-es/asyncify.js","webpack://JitsiMeetJS/./node_modules/async-es/internal/wrapAsync.js","webpack://JitsiMeetJS/./node_modules/async-es/internal/initialParams.js","webpack://JitsiMeetJS/./node_modules/async-es/internal/queue.js","webpack://JitsiMeetJS/./modules/util/AsyncQueue.ts","webpack://JitsiMeetJS/./node_modules/async-es/queue.js","webpack://JitsiMeetJS/./modules/xmpp/JingleSessionState.ts","webpack://JitsiMeetJS/./modules/xmpp/JingleSession.ts","webpack://JitsiMeetJS/./modules/xmpp/MediaSessionEvents.ts","webpack://JitsiMeetJS/./modules/xmpp/JingleSessionPC.ts","webpack://JitsiMeetJS/./modules/xmpp/strophe.jingle.js","webpack://JitsiMeetJS/./modules/xmpp/strophe.logger.ts","webpack://JitsiMeetJS/./modules/xmpp/strophe.rayo.ts","webpack://JitsiMeetJS/./modules/xmpp/strophe.util.ts","webpack://JitsiMeetJS/./modules/xmpp/xmpp.ts","webpack://JitsiMeetJS/./modules/e2ee/E2EEErrors.ts","webpack://JitsiMeetJS/./modules/e2ee/SAS.ts","webpack://JitsiMeetJS/./modules/e2ee/OlmAdapter.js","webpack://JitsiMeetJS/./modules/e2ee/ManagedKeyHandler.js","webpack://JitsiMeetJS/./modules/e2ee/crypto-utils.ts","webpack://JitsiMeetJS/./modules/e2ee/E2EEncryption.js","webpack://JitsiMeetJS/./service/e2eping/E2ePingEvents.ts","webpack://JitsiMeetJS/./modules/e2eping/e2eping.ts","webpack://JitsiMeetJS/./modules/litemode/LiteModeContext.ts","webpack://JitsiMeetJS/./modules/qualitycontrol/CodecSelection.ts","webpack://JitsiMeetJS/./service/RTC/ReceiverAudioSubscription.ts","webpack://JitsiMeetJS/./modules/qualitycontrol/ReceiveAudioController.ts","webpack://JitsiMeetJS/./modules/qualitycontrol/ReceiveVideoController.ts","webpack://JitsiMeetJS/./modules/qualitycontrol/SendVideoController.ts","webpack://JitsiMeetJS/./modules/qualitycontrol/QualityController.ts","webpack://JitsiMeetJS/./modules/recording/JibriSession.ts","webpack://JitsiMeetJS/./modules/recording/recordingXMLUtils.ts","webpack://JitsiMeetJS/./modules/recording/RecordingManager.ts","webpack://JitsiMeetJS/./modules/statistics/AvgRTPStatsReporter.ts","webpack://JitsiMeetJS/./modules/statistics/SpeakerStats.ts","webpack://JitsiMeetJS/./modules/statistics/SpeakerStatsCollector.ts","webpack://JitsiMeetJS/./modules/version/ComponentsVersions.ts","webpack://JitsiMeetJS/./modules/videosipgw/VideoSIPGWConstants.ts","webpack://JitsiMeetJS/./modules/videosipgw/JitsiVideoSIPGWSession.ts","webpack://JitsiMeetJS/./modules/videosipgw/VideoSIPGW.ts","webpack://JitsiMeetJS/./modules/xmpp/SignalingLayerImpl.ts","webpack://JitsiMeetJS/./service/RTC/BridgeVideoType.ts","webpack://JitsiMeetJS/./JitsiConference.ts","webpack://JitsiMeetJS/./JitsiConnection.ts","webpack://JitsiMeetJS/./JitsiMediaDevicesEvents.ts","webpack://JitsiMeetJS/./JitsiMediaDevices.ts","webpack://JitsiMeetJS/./modules/detection/ActiveDeviceDetector.ts","webpack://JitsiMeetJS/./modules/proxyconnection/CustomSignalingLayer.ts","webpack://JitsiMeetJS/./modules/proxyconnection/constants.ts","webpack://JitsiMeetJS/./modules/proxyconnection/ProxyConnectionPC.js","webpack://JitsiMeetJS/./modules/proxyconnection/ProxyConnectionService.js","webpack://JitsiMeetJS/./node_modules/@jitsi/precall-test/src/utility/parsedIceCandidate.js","webpack://JitsiMeetJS/./node_modules/@jitsi/precall-test/src/utility/stats/detectbrowser.js","webpack://JitsiMeetJS/./node_modules/@jitsi/precall-test/src/utility/stats/statsadapter.js","webpack://JitsiMeetJS/./node_modules/@jitsi/precall-test/src/utility/stats/getstatshandler.js","webpack://JitsiMeetJS/./node_modules/@jitsi/precall-test/src/turnConnection.js","webpack://JitsiMeetJS/./node_modules/@jitsi/precall-test/src/utility/timestamps.js","webpack://JitsiMeetJS/./node_modules/@jitsi/precall-test/src/tests/turnTest.js","webpack://JitsiMeetJS/./node_modules/@jitsi/precall-test/src/tests/rttTest.js","webpack://JitsiMeetJS/./node_modules/@jitsi/precall-test/src/utility/messageMaker.js","webpack://JitsiMeetJS/./node_modules/@jitsi/precall-test/src/tests/throughputTest.js","webpack://JitsiMeetJS/./node_modules/@jitsi/precall-test/src/tests/lossTest.js","webpack://JitsiMeetJS/./node_modules/@jitsi/precall-test/src/utility/resultsHandler.js","webpack://JitsiMeetJS/./node_modules/@jitsi/precall-test/src/utility/onlineCheck.js","webpack://JitsiMeetJS/./node_modules/@jitsi/precall-test/src/main.js","webpack://JitsiMeetJS/./modules/util/ScriptUtil.ts","webpack://JitsiMeetJS/./modules/webaudio/AudioMixer.ts","webpack://JitsiMeetJS/./version.ts","webpack://JitsiMeetJS/./JitsiMeetJS.ts","webpack://JitsiMeetJS/./modules/recording/recordingConstants.ts","webpack://JitsiMeetJS/./modules/statistics/PreCallTest.ts","webpack://JitsiMeetJS/./index.js","webpack://JitsiMeetJS/./node_modules/@hapi/bourne/lib/index.js","webpack://JitsiMeetJS/./node_modules/@jitsi/js-utils/node_modules/ua-parser-js/src/ua-parser.js","webpack://JitsiMeetJS/./node_modules/@jitsi/logger/lib/LogCollector.js","webpack://JitsiMeetJS/./node_modules/@jitsi/logger/lib/Logger.js","webpack://JitsiMeetJS/./node_modules/@jitsi/logger/lib/index.js","webpack://JitsiMeetJS/./node_modules/@jitsi/rtcstats/node_modules/@jitsi/logger/lib/LogCollector.js","webpack://JitsiMeetJS/./node_modules/@jitsi/rtcstats/node_modules/@jitsi/logger/lib/Logger.js","webpack://JitsiMeetJS/./node_modules/@jitsi/rtcstats/node_modules/@jitsi/logger/lib/index.js","webpack://JitsiMeetJS/watchRTC/webpack/universalModuleDefinition","webpack://JitsiMeetJS/watchRTC/src/index.ts","webpack://JitsiMeetJS/watchRTC/src/sdk.ts","webpack://JitsiMeetJS/watchRTC/src/stats.ts","webpack://JitsiMeetJS/watchRTC/src/types.ts","webpack://JitsiMeetJS/watchRTC/src/utils.ts","webpack://JitsiMeetJS/watchRTC/src/version.ts","webpack://JitsiMeetJS/watchRTC/src/watchrtchttp.ts","webpack://JitsiMeetJS/watchRTC/src/watchrtcsocket.ts","webpack://JitsiMeetJS/watchRTC/src/detect-gpu.js","webpack://JitsiMeetJS/watchRTC/Users/yurapostevka/Documents/apps/testrtc/watchrtc-sdk/src/gpu-benchmarks|sync|/^\\.\\/.*$/","webpack://JitsiMeetJS/watchRTC/src/lz-string.js","webpack://JitsiMeetJS/watchRTC/webpack/bootstrap","webpack://JitsiMeetJS/watchRTC/webpack/startup","webpack://JitsiMeetJS/watchRTC/webpack/runtime/global","webpack://JitsiMeetJS/watchRTC/webpack/runtime/hasOwnProperty shorthand","webpack://JitsiMeetJS/./node_modules/base64-js/index.js","webpack://JitsiMeetJS/./node_modules/current-executing-script/dist/currentExecutingScript.js","webpack://JitsiMeetJS/./node_modules/events/events.js","webpack://JitsiMeetJS/./node_modules/js-md5/src/md5.js","webpack://JitsiMeetJS/./node_modules/sdp-transform/lib/grammar.js","webpack://JitsiMeetJS/./node_modules/sdp-transform/lib/index.js","webpack://JitsiMeetJS/./node_modules/sdp-transform/lib/parser.js","webpack://JitsiMeetJS/./node_modules/sdp-transform/lib/writer.js","webpack://JitsiMeetJS/./node_modules/sdp/sdp.js","webpack://JitsiMeetJS/./node_modules/strophe.js/dist/strophe.umd.js","webpack://JitsiMeetJS/webpack/bootstrap","webpack://JitsiMeetJS/webpack/runtime/amd options","webpack://JitsiMeetJS/webpack/runtime/compat get default export","webpack://JitsiMeetJS/webpack/runtime/define property getters","webpack://JitsiMeetJS/webpack/runtime/global","webpack://JitsiMeetJS/webpack/runtime/hasOwnProperty shorthand","webpack://JitsiMeetJS/webpack/runtime/make namespace object","webpack://JitsiMeetJS/webpack/startup"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"JitsiMeetJS\"] = factory();\n\telse\n\t\troot[\"JitsiMeetJS\"] = factory();\n})(self, () => {\nreturn ","/**\n * Removes all key-value entries from the list cache.\n *\n * @private\n * @name clear\n * @memberOf ListCache\n */\nfunction listCacheClear() {\n  this.__data__ = [];\n  this.size = 0;\n}\n\nexport default listCacheClear;\n","/**\n * Performs a\n * [`SameValueZero`](http://ecma-international.org/ecma-262/7.0/#sec-samevaluezero)\n * comparison between two values to determine if they are equivalent.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to compare.\n * @param {*} other The other value to compare.\n * @returns {boolean} Returns `true` if the values are equivalent, else `false`.\n * @example\n *\n * var object = { 'a': 1 };\n * var other = { 'a': 1 };\n *\n * _.eq(object, object);\n * // => true\n *\n * _.eq(object, other);\n * // => false\n *\n * _.eq('a', 'a');\n * // => true\n *\n * _.eq('a', Object('a'));\n * // => false\n *\n * _.eq(NaN, NaN);\n * // => true\n */\nfunction eq(value, other) {\n  return value === other || (value !== value && other !== other);\n}\n\nexport default eq;\n","import eq from './eq.js';\n\n/**\n * Gets the index at which the `key` is found in `array` of key-value pairs.\n *\n * @private\n * @param {Array} array The array to inspect.\n * @param {*} key The key to search for.\n * @returns {number} Returns the index of the matched value, else `-1`.\n */\nfunction assocIndexOf(array, key) {\n  var length = array.length;\n  while (length--) {\n    if (eq(array[length][0], key)) {\n      return length;\n    }\n  }\n  return -1;\n}\n\nexport default assocIndexOf;\n","import assocIndexOf from './_assocIndexOf.js';\n\n/** Used for built-in method references. */\nvar arrayProto = Array.prototype;\n\n/** Built-in value references. */\nvar splice = arrayProto.splice;\n\n/**\n * Removes `key` and its value from the list cache.\n *\n * @private\n * @name delete\n * @memberOf ListCache\n * @param {string} key The key of the value to remove.\n * @returns {boolean} Returns `true` if the entry was removed, else `false`.\n */\nfunction listCacheDelete(key) {\n  var data = this.__data__,\n      index = assocIndexOf(data, key);\n\n  if (index < 0) {\n    return false;\n  }\n  var lastIndex = data.length - 1;\n  if (index == lastIndex) {\n    data.pop();\n  } else {\n    splice.call(data, index, 1);\n  }\n  --this.size;\n  return true;\n}\n\nexport default listCacheDelete;\n","import listCacheClear from './_listCacheClear.js';\nimport listCacheDelete from './_listCacheDelete.js';\nimport listCacheGet from './_listCacheGet.js';\nimport listCacheHas from './_listCacheHas.js';\nimport listCacheSet from './_listCacheSet.js';\n\n/**\n * Creates an list cache object.\n *\n * @private\n * @constructor\n * @param {Array} [entries] The key-value pairs to cache.\n */\nfunction ListCache(entries) {\n  var index = -1,\n      length = entries == null ? 0 : entries.length;\n\n  this.clear();\n  while (++index < length) {\n    var entry = entries[index];\n    this.set(entry[0], entry[1]);\n  }\n}\n\n// Add methods to `ListCache`.\nListCache.prototype.clear = listCacheClear;\nListCache.prototype['delete'] = listCacheDelete;\nListCache.prototype.get = listCacheGet;\nListCache.prototype.has = listCacheHas;\nListCache.prototype.set = listCacheSet;\n\nexport default ListCache;\n","import assocIndexOf from './_assocIndexOf.js';\n\n/**\n * Gets the list cache value for `key`.\n *\n * @private\n * @name get\n * @memberOf ListCache\n * @param {string} key The key of the value to get.\n * @returns {*} Returns the entry value.\n */\nfunction listCacheGet(key) {\n  var data = this.__data__,\n      index = assocIndexOf(data, key);\n\n  return index < 0 ? undefined : data[index][1];\n}\n\nexport default listCacheGet;\n","import assocIndexOf from './_assocIndexOf.js';\n\n/**\n * Checks if a list cache value for `key` exists.\n *\n * @private\n * @name has\n * @memberOf ListCache\n * @param {string} key The key of the entry to check.\n * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.\n */\nfunction listCacheHas(key) {\n  return assocIndexOf(this.__data__, key) > -1;\n}\n\nexport default listCacheHas;\n","import assocIndexOf from './_assocIndexOf.js';\n\n/**\n * Sets the list cache `key` to `value`.\n *\n * @private\n * @name set\n * @memberOf ListCache\n * @param {string} key The key of the value to set.\n * @param {*} value The value to set.\n * @returns {Object} Returns the list cache instance.\n */\nfunction listCacheSet(key, value) {\n  var data = this.__data__,\n      index = assocIndexOf(data, key);\n\n  if (index < 0) {\n    ++this.size;\n    data.push([key, value]);\n  } else {\n    data[index][1] = value;\n  }\n  return this;\n}\n\nexport default listCacheSet;\n","/** Detect free variable `global` from Node.js. */\nvar freeGlobal = typeof global == 'object' && global && global.Object === Object && global;\n\nexport default freeGlobal;\n","import freeGlobal from './_freeGlobal.js';\n\n/** Detect free variable `self`. */\nvar freeSelf = typeof self == 'object' && self && self.Object === Object && self;\n\n/** Used as a reference to the global object. */\nvar root = freeGlobal || freeSelf || Function('return this')();\n\nexport default root;\n","import root from './_root.js';\n\n/** Built-in value references. */\nvar Symbol = root.Symbol;\n\nexport default Symbol;\n","import Symbol from './_Symbol.js';\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * Used to resolve the\n * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)\n * of values.\n */\nvar nativeObjectToString = objectProto.toString;\n\n/** Built-in value references. */\nvar symToStringTag = Symbol ? Symbol.toStringTag : undefined;\n\n/**\n * A specialized version of `baseGetTag` which ignores `Symbol.toStringTag` values.\n *\n * @private\n * @param {*} value The value to query.\n * @returns {string} Returns the raw `toStringTag`.\n */\nfunction getRawTag(value) {\n  var isOwn = hasOwnProperty.call(value, symToStringTag),\n      tag = value[symToStringTag];\n\n  try {\n    value[symToStringTag] = undefined;\n    var unmasked = true;\n  } catch (e) {}\n\n  var result = nativeObjectToString.call(value);\n  if (unmasked) {\n    if (isOwn) {\n      value[symToStringTag] = tag;\n    } else {\n      delete value[symToStringTag];\n    }\n  }\n  return result;\n}\n\nexport default getRawTag;\n","/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/**\n * Used to resolve the\n * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)\n * of values.\n */\nvar nativeObjectToString = objectProto.toString;\n\n/**\n * Converts `value` to a string using `Object.prototype.toString`.\n *\n * @private\n * @param {*} value The value to convert.\n * @returns {string} Returns the converted string.\n */\nfunction objectToString(value) {\n  return nativeObjectToString.call(value);\n}\n\nexport default objectToString;\n","import Symbol from './_Symbol.js';\nimport getRawTag from './_getRawTag.js';\nimport objectToString from './_objectToString.js';\n\n/** `Object#toString` result references. */\nvar nullTag = '[object Null]',\n    undefinedTag = '[object Undefined]';\n\n/** Built-in value references. */\nvar symToStringTag = Symbol ? Symbol.toStringTag : undefined;\n\n/**\n * The base implementation of `getTag` without fallbacks for buggy environments.\n *\n * @private\n * @param {*} value The value to query.\n * @returns {string} Returns the `toStringTag`.\n */\nfunction baseGetTag(value) {\n  if (value == null) {\n    return value === undefined ? undefinedTag : nullTag;\n  }\n  return (symToStringTag && symToStringTag in Object(value))\n    ? getRawTag(value)\n    : objectToString(value);\n}\n\nexport default baseGetTag;\n","/**\n * Checks if `value` is the\n * [language type](http://www.ecma-international.org/ecma-262/7.0/#sec-ecmascript-language-types)\n * of `Object`. (e.g. arrays, functions, objects, regexes, `new Number(0)`, and `new String('')`)\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an object, else `false`.\n * @example\n *\n * _.isObject({});\n * // => true\n *\n * _.isObject([1, 2, 3]);\n * // => true\n *\n * _.isObject(_.noop);\n * // => true\n *\n * _.isObject(null);\n * // => false\n */\nfunction isObject(value) {\n  var type = typeof value;\n  return value != null && (type == 'object' || type == 'function');\n}\n\nexport default isObject;\n","import baseGetTag from './_baseGetTag.js';\nimport isObject from './isObject.js';\n\n/** `Object#toString` result references. */\nvar asyncTag = '[object AsyncFunction]',\n    funcTag = '[object Function]',\n    genTag = '[object GeneratorFunction]',\n    proxyTag = '[object Proxy]';\n\n/**\n * Checks if `value` is classified as a `Function` object.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a function, else `false`.\n * @example\n *\n * _.isFunction(_);\n * // => true\n *\n * _.isFunction(/abc/);\n * // => false\n */\nfunction isFunction(value) {\n  if (!isObject(value)) {\n    return false;\n  }\n  // The use of `Object#toString` avoids issues with the `typeof` operator\n  // in Safari 9 which returns 'object' for typed arrays and other constructors.\n  var tag = baseGetTag(value);\n  return tag == funcTag || tag == genTag || tag == asyncTag || tag == proxyTag;\n}\n\nexport default isFunction;\n","import root from './_root.js';\n\n/** Used to detect overreaching core-js shims. */\nvar coreJsData = root['__core-js_shared__'];\n\nexport default coreJsData;\n","import coreJsData from './_coreJsData.js';\n\n/** Used to detect methods masquerading as native. */\nvar maskSrcKey = (function() {\n  var uid = /[^.]+$/.exec(coreJsData && coreJsData.keys && coreJsData.keys.IE_PROTO || '');\n  return uid ? ('Symbol(src)_1.' + uid) : '';\n}());\n\n/**\n * Checks if `func` has its source masked.\n *\n * @private\n * @param {Function} func The function to check.\n * @returns {boolean} Returns `true` if `func` is masked, else `false`.\n */\nfunction isMasked(func) {\n  return !!maskSrcKey && (maskSrcKey in func);\n}\n\nexport default isMasked;\n","/** Used for built-in method references. */\nvar funcProto = Function.prototype;\n\n/** Used to resolve the decompiled source of functions. */\nvar funcToString = funcProto.toString;\n\n/**\n * Converts `func` to its source code.\n *\n * @private\n * @param {Function} func The function to convert.\n * @returns {string} Returns the source code.\n */\nfunction toSource(func) {\n  if (func != null) {\n    try {\n      return funcToString.call(func);\n    } catch (e) {}\n    try {\n      return (func + '');\n    } catch (e) {}\n  }\n  return '';\n}\n\nexport default toSource;\n","import isFunction from './isFunction.js';\nimport isMasked from './_isMasked.js';\nimport isObject from './isObject.js';\nimport toSource from './_toSource.js';\n\n/**\n * Used to match `RegExp`\n * [syntax characters](http://ecma-international.org/ecma-262/7.0/#sec-patterns).\n */\nvar reRegExpChar = /[\\\\^$.*+?()[\\]{}|]/g;\n\n/** Used to detect host constructors (Safari). */\nvar reIsHostCtor = /^\\[object .+?Constructor\\]$/;\n\n/** Used for built-in method references. */\nvar funcProto = Function.prototype,\n    objectProto = Object.prototype;\n\n/** Used to resolve the decompiled source of functions. */\nvar funcToString = funcProto.toString;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/** Used to detect if a method is native. */\nvar reIsNative = RegExp('^' +\n  funcToString.call(hasOwnProperty).replace(reRegExpChar, '\\\\$&')\n  .replace(/hasOwnProperty|(function).*?(?=\\\\\\()| for .+?(?=\\\\\\])/g, '$1.*?') + '$'\n);\n\n/**\n * The base implementation of `_.isNative` without bad shim checks.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a native function,\n *  else `false`.\n */\nfunction baseIsNative(value) {\n  if (!isObject(value) || isMasked(value)) {\n    return false;\n  }\n  var pattern = isFunction(value) ? reIsNative : reIsHostCtor;\n  return pattern.test(toSource(value));\n}\n\nexport default baseIsNative;\n","import baseIsNative from './_baseIsNative.js';\nimport getValue from './_getValue.js';\n\n/**\n * Gets the native function at `key` of `object`.\n *\n * @private\n * @param {Object} object The object to query.\n * @param {string} key The key of the method to get.\n * @returns {*} Returns the function if it's native, else `undefined`.\n */\nfunction getNative(object, key) {\n  var value = getValue(object, key);\n  return baseIsNative(value) ? value : undefined;\n}\n\nexport default getNative;\n","/**\n * Gets the value at `key` of `object`.\n *\n * @private\n * @param {Object} [object] The object to query.\n * @param {string} key The key of the property to get.\n * @returns {*} Returns the property value.\n */\nfunction getValue(object, key) {\n  return object == null ? undefined : object[key];\n}\n\nexport default getValue;\n","import getNative from './_getNative.js';\nimport root from './_root.js';\n\n/* Built-in method references that are verified to be native. */\nvar Map = getNative(root, 'Map');\n\nexport default Map;\n","import getNative from './_getNative.js';\n\n/* Built-in method references that are verified to be native. */\nvar nativeCreate = getNative(Object, 'create');\n\nexport default nativeCreate;\n","import nativeCreate from './_nativeCreate.js';\n\n/** Used to stand-in for `undefined` hash values. */\nvar HASH_UNDEFINED = '__lodash_hash_undefined__';\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * Gets the hash value for `key`.\n *\n * @private\n * @name get\n * @memberOf Hash\n * @param {string} key The key of the value to get.\n * @returns {*} Returns the entry value.\n */\nfunction hashGet(key) {\n  var data = this.__data__;\n  if (nativeCreate) {\n    var result = data[key];\n    return result === HASH_UNDEFINED ? undefined : result;\n  }\n  return hasOwnProperty.call(data, key) ? data[key] : undefined;\n}\n\nexport default hashGet;\n","import nativeCreate from './_nativeCreate.js';\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * Checks if a hash value for `key` exists.\n *\n * @private\n * @name has\n * @memberOf Hash\n * @param {string} key The key of the entry to check.\n * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.\n */\nfunction hashHas(key) {\n  var data = this.__data__;\n  return nativeCreate ? (data[key] !== undefined) : hasOwnProperty.call(data, key);\n}\n\nexport default hashHas;\n","import hashClear from './_hashClear.js';\nimport hashDelete from './_hashDelete.js';\nimport hashGet from './_hashGet.js';\nimport hashHas from './_hashHas.js';\nimport hashSet from './_hashSet.js';\n\n/**\n * Creates a hash object.\n *\n * @private\n * @constructor\n * @param {Array} [entries] The key-value pairs to cache.\n */\nfunction Hash(entries) {\n  var index = -1,\n      length = entries == null ? 0 : entries.length;\n\n  this.clear();\n  while (++index < length) {\n    var entry = entries[index];\n    this.set(entry[0], entry[1]);\n  }\n}\n\n// Add methods to `Hash`.\nHash.prototype.clear = hashClear;\nHash.prototype['delete'] = hashDelete;\nHash.prototype.get = hashGet;\nHash.prototype.has = hashHas;\nHash.prototype.set = hashSet;\n\nexport default Hash;\n","import nativeCreate from './_nativeCreate.js';\n\n/**\n * Removes all key-value entries from the hash.\n *\n * @private\n * @name clear\n * @memberOf Hash\n */\nfunction hashClear() {\n  this.__data__ = nativeCreate ? nativeCreate(null) : {};\n  this.size = 0;\n}\n\nexport default hashClear;\n","/**\n * Removes `key` and its value from the hash.\n *\n * @private\n * @name delete\n * @memberOf Hash\n * @param {Object} hash The hash to modify.\n * @param {string} key The key of the value to remove.\n * @returns {boolean} Returns `true` if the entry was removed, else `false`.\n */\nfunction hashDelete(key) {\n  var result = this.has(key) && delete this.__data__[key];\n  this.size -= result ? 1 : 0;\n  return result;\n}\n\nexport default hashDelete;\n","import nativeCreate from './_nativeCreate.js';\n\n/** Used to stand-in for `undefined` hash values. */\nvar HASH_UNDEFINED = '__lodash_hash_undefined__';\n\n/**\n * Sets the hash `key` to `value`.\n *\n * @private\n * @name set\n * @memberOf Hash\n * @param {string} key The key of the value to set.\n * @param {*} value The value to set.\n * @returns {Object} Returns the hash instance.\n */\nfunction hashSet(key, value) {\n  var data = this.__data__;\n  this.size += this.has(key) ? 0 : 1;\n  data[key] = (nativeCreate && value === undefined) ? HASH_UNDEFINED : value;\n  return this;\n}\n\nexport default hashSet;\n","import isKeyable from './_isKeyable.js';\n\n/**\n * Gets the data for `map`.\n *\n * @private\n * @param {Object} map The map to query.\n * @param {string} key The reference key.\n * @returns {*} Returns the map data.\n */\nfunction getMapData(map, key) {\n  var data = map.__data__;\n  return isKeyable(key)\n    ? data[typeof key == 'string' ? 'string' : 'hash']\n    : data.map;\n}\n\nexport default getMapData;\n","/**\n * Checks if `value` is suitable for use as unique object key.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is suitable, else `false`.\n */\nfunction isKeyable(value) {\n  var type = typeof value;\n  return (type == 'string' || type == 'number' || type == 'symbol' || type == 'boolean')\n    ? (value !== '__proto__')\n    : (value === null);\n}\n\nexport default isKeyable;\n","import mapCacheClear from './_mapCacheClear.js';\nimport mapCacheDelete from './_mapCacheDelete.js';\nimport mapCacheGet from './_mapCacheGet.js';\nimport mapCacheHas from './_mapCacheHas.js';\nimport mapCacheSet from './_mapCacheSet.js';\n\n/**\n * Creates a map cache object to store key-value pairs.\n *\n * @private\n * @constructor\n * @param {Array} [entries] The key-value pairs to cache.\n */\nfunction MapCache(entries) {\n  var index = -1,\n      length = entries == null ? 0 : entries.length;\n\n  this.clear();\n  while (++index < length) {\n    var entry = entries[index];\n    this.set(entry[0], entry[1]);\n  }\n}\n\n// Add methods to `MapCache`.\nMapCache.prototype.clear = mapCacheClear;\nMapCache.prototype['delete'] = mapCacheDelete;\nMapCache.prototype.get = mapCacheGet;\nMapCache.prototype.has = mapCacheHas;\nMapCache.prototype.set = mapCacheSet;\n\nexport default MapCache;\n","import Hash from './_Hash.js';\nimport ListCache from './_ListCache.js';\nimport Map from './_Map.js';\n\n/**\n * Removes all key-value entries from the map.\n *\n * @private\n * @name clear\n * @memberOf MapCache\n */\nfunction mapCacheClear() {\n  this.size = 0;\n  this.__data__ = {\n    'hash': new Hash,\n    'map': new (Map || ListCache),\n    'string': new Hash\n  };\n}\n\nexport default mapCacheClear;\n","import getMapData from './_getMapData.js';\n\n/**\n * Removes `key` and its value from the map.\n *\n * @private\n * @name delete\n * @memberOf MapCache\n * @param {string} key The key of the value to remove.\n * @returns {boolean} Returns `true` if the entry was removed, else `false`.\n */\nfunction mapCacheDelete(key) {\n  var result = getMapData(this, key)['delete'](key);\n  this.size -= result ? 1 : 0;\n  return result;\n}\n\nexport default mapCacheDelete;\n","import getMapData from './_getMapData.js';\n\n/**\n * Gets the map value for `key`.\n *\n * @private\n * @name get\n * @memberOf MapCache\n * @param {string} key The key of the value to get.\n * @returns {*} Returns the entry value.\n */\nfunction mapCacheGet(key) {\n  return getMapData(this, key).get(key);\n}\n\nexport default mapCacheGet;\n","import getMapData from './_getMapData.js';\n\n/**\n * Checks if a map value for `key` exists.\n *\n * @private\n * @name has\n * @memberOf MapCache\n * @param {string} key The key of the entry to check.\n * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.\n */\nfunction mapCacheHas(key) {\n  return getMapData(this, key).has(key);\n}\n\nexport default mapCacheHas;\n","import getMapData from './_getMapData.js';\n\n/**\n * Sets the map `key` to `value`.\n *\n * @private\n * @name set\n * @memberOf MapCache\n * @param {string} key The key of the value to set.\n * @param {*} value The value to set.\n * @returns {Object} Returns the map cache instance.\n */\nfunction mapCacheSet(key, value) {\n  var data = getMapData(this, key),\n      size = data.size;\n\n  data.set(key, value);\n  this.size += data.size == size ? 0 : 1;\n  return this;\n}\n\nexport default mapCacheSet;\n","import ListCache from './_ListCache.js';\nimport stackClear from './_stackClear.js';\nimport stackDelete from './_stackDelete.js';\nimport stackGet from './_stackGet.js';\nimport stackHas from './_stackHas.js';\nimport stackSet from './_stackSet.js';\n\n/**\n * Creates a stack cache object to store key-value pairs.\n *\n * @private\n * @constructor\n * @param {Array} [entries] The key-value pairs to cache.\n */\nfunction Stack(entries) {\n  var data = this.__data__ = new ListCache(entries);\n  this.size = data.size;\n}\n\n// Add methods to `Stack`.\nStack.prototype.clear = stackClear;\nStack.prototype['delete'] = stackDelete;\nStack.prototype.get = stackGet;\nStack.prototype.has = stackHas;\nStack.prototype.set = stackSet;\n\nexport default Stack;\n","import ListCache from './_ListCache.js';\n\n/**\n * Removes all key-value entries from the stack.\n *\n * @private\n * @name clear\n * @memberOf Stack\n */\nfunction stackClear() {\n  this.__data__ = new ListCache;\n  this.size = 0;\n}\n\nexport default stackClear;\n","/**\n * Removes `key` and its value from the stack.\n *\n * @private\n * @name delete\n * @memberOf Stack\n * @param {string} key The key of the value to remove.\n * @returns {boolean} Returns `true` if the entry was removed, else `false`.\n */\nfunction stackDelete(key) {\n  var data = this.__data__,\n      result = data['delete'](key);\n\n  this.size = data.size;\n  return result;\n}\n\nexport default stackDelete;\n","/**\n * Gets the stack value for `key`.\n *\n * @private\n * @name get\n * @memberOf Stack\n * @param {string} key The key of the value to get.\n * @returns {*} Returns the entry value.\n */\nfunction stackGet(key) {\n  return this.__data__.get(key);\n}\n\nexport default stackGet;\n","/**\n * Checks if a stack value for `key` exists.\n *\n * @private\n * @name has\n * @memberOf Stack\n * @param {string} key The key of the entry to check.\n * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.\n */\nfunction stackHas(key) {\n  return this.__data__.has(key);\n}\n\nexport default stackHas;\n","import ListCache from './_ListCache.js';\nimport Map from './_Map.js';\nimport MapCache from './_MapCache.js';\n\n/** Used as the size to enable large array optimizations. */\nvar LARGE_ARRAY_SIZE = 200;\n\n/**\n * Sets the stack `key` to `value`.\n *\n * @private\n * @name set\n * @memberOf Stack\n * @param {string} key The key of the value to set.\n * @param {*} value The value to set.\n * @returns {Object} Returns the stack cache instance.\n */\nfunction stackSet(key, value) {\n  var data = this.__data__;\n  if (data instanceof ListCache) {\n    var pairs = data.__data__;\n    if (!Map || (pairs.length < LARGE_ARRAY_SIZE - 1)) {\n      pairs.push([key, value]);\n      this.size = ++data.size;\n      return this;\n    }\n    data = this.__data__ = new MapCache(pairs);\n  }\n  data.set(key, value);\n  this.size = data.size;\n  return this;\n}\n\nexport default stackSet;\n","import getNative from './_getNative.js';\n\nvar defineProperty = (function() {\n  try {\n    var func = getNative(Object, 'defineProperty');\n    func({}, '', {});\n    return func;\n  } catch (e) {}\n}());\n\nexport default defineProperty;\n","import defineProperty from './_defineProperty.js';\n\n/**\n * The base implementation of `assignValue` and `assignMergeValue` without\n * value checks.\n *\n * @private\n * @param {Object} object The object to modify.\n * @param {string} key The key of the property to assign.\n * @param {*} value The value to assign.\n */\nfunction baseAssignValue(object, key, value) {\n  if (key == '__proto__' && defineProperty) {\n    defineProperty(object, key, {\n      'configurable': true,\n      'enumerable': true,\n      'value': value,\n      'writable': true\n    });\n  } else {\n    object[key] = value;\n  }\n}\n\nexport default baseAssignValue;\n","import baseAssignValue from './_baseAssignValue.js';\nimport eq from './eq.js';\n\n/**\n * This function is like `assignValue` except that it doesn't assign\n * `undefined` values.\n *\n * @private\n * @param {Object} object The object to modify.\n * @param {string} key The key of the property to assign.\n * @param {*} value The value to assign.\n */\nfunction assignMergeValue(object, key, value) {\n  if ((value !== undefined && !eq(object[key], value)) ||\n      (value === undefined && !(key in object))) {\n    baseAssignValue(object, key, value);\n  }\n}\n\nexport default assignMergeValue;\n","import createBaseFor from './_createBaseFor.js';\n\n/**\n * The base implementation of `baseForOwn` which iterates over `object`\n * properties returned by `keysFunc` and invokes `iteratee` for each property.\n * Iteratee functions may exit iteration early by explicitly returning `false`.\n *\n * @private\n * @param {Object} object The object to iterate over.\n * @param {Function} iteratee The function invoked per iteration.\n * @param {Function} keysFunc The function to get the keys of `object`.\n * @returns {Object} Returns `object`.\n */\nvar baseFor = createBaseFor();\n\nexport default baseFor;\n","/**\n * Creates a base function for methods like `_.forIn` and `_.forOwn`.\n *\n * @private\n * @param {boolean} [fromRight] Specify iterating from right to left.\n * @returns {Function} Returns the new base function.\n */\nfunction createBaseFor(fromRight) {\n  return function(object, iteratee, keysFunc) {\n    var index = -1,\n        iterable = Object(object),\n        props = keysFunc(object),\n        length = props.length;\n\n    while (length--) {\n      var key = props[fromRight ? length : ++index];\n      if (iteratee(iterable[key], key, iterable) === false) {\n        break;\n      }\n    }\n    return object;\n  };\n}\n\nexport default createBaseFor;\n","import root from './_root.js';\n\n/** Detect free variable `exports`. */\nvar freeExports = typeof exports == 'object' && exports && !exports.nodeType && exports;\n\n/** Detect free variable `module`. */\nvar freeModule = freeExports && typeof module == 'object' && module && !module.nodeType && module;\n\n/** Detect the popular CommonJS extension `module.exports`. */\nvar moduleExports = freeModule && freeModule.exports === freeExports;\n\n/** Built-in value references. */\nvar Buffer = moduleExports ? root.Buffer : undefined,\n    allocUnsafe = Buffer ? Buffer.allocUnsafe : undefined;\n\n/**\n * Creates a clone of  `buffer`.\n *\n * @private\n * @param {Buffer} buffer The buffer to clone.\n * @param {boolean} [isDeep] Specify a deep clone.\n * @returns {Buffer} Returns the cloned buffer.\n */\nfunction cloneBuffer(buffer, isDeep) {\n  if (isDeep) {\n    return buffer.slice();\n  }\n  var length = buffer.length,\n      result = allocUnsafe ? allocUnsafe(length) : new buffer.constructor(length);\n\n  buffer.copy(result);\n  return result;\n}\n\nexport default cloneBuffer;\n","import root from './_root.js';\n\n/** Built-in value references. */\nvar Uint8Array = root.Uint8Array;\n\nexport default Uint8Array;\n","import Uint8Array from './_Uint8Array.js';\n\n/**\n * Creates a clone of `arrayBuffer`.\n *\n * @private\n * @param {ArrayBuffer} arrayBuffer The array buffer to clone.\n * @returns {ArrayBuffer} Returns the cloned array buffer.\n */\nfunction cloneArrayBuffer(arrayBuffer) {\n  var result = new arrayBuffer.constructor(arrayBuffer.byteLength);\n  new Uint8Array(result).set(new Uint8Array(arrayBuffer));\n  return result;\n}\n\nexport default cloneArrayBuffer;\n","import cloneArrayBuffer from './_cloneArrayBuffer.js';\n\n/**\n * Creates a clone of `typedArray`.\n *\n * @private\n * @param {Object} typedArray The typed array to clone.\n * @param {boolean} [isDeep] Specify a deep clone.\n * @returns {Object} Returns the cloned typed array.\n */\nfunction cloneTypedArray(typedArray, isDeep) {\n  var buffer = isDeep ? cloneArrayBuffer(typedArray.buffer) : typedArray.buffer;\n  return new typedArray.constructor(buffer, typedArray.byteOffset, typedArray.length);\n}\n\nexport default cloneTypedArray;\n","/**\n * Copies the values of `source` to `array`.\n *\n * @private\n * @param {Array} source The array to copy values from.\n * @param {Array} [array=[]] The array to copy values to.\n * @returns {Array} Returns `array`.\n */\nfunction copyArray(source, array) {\n  var index = -1,\n      length = source.length;\n\n  array || (array = Array(length));\n  while (++index < length) {\n    array[index] = source[index];\n  }\n  return array;\n}\n\nexport default copyArray;\n","import isObject from './isObject.js';\n\n/** Built-in value references. */\nvar objectCreate = Object.create;\n\n/**\n * The base implementation of `_.create` without support for assigning\n * properties to the created object.\n *\n * @private\n * @param {Object} proto The object to inherit from.\n * @returns {Object} Returns the new object.\n */\nvar baseCreate = (function() {\n  function object() {}\n  return function(proto) {\n    if (!isObject(proto)) {\n      return {};\n    }\n    if (objectCreate) {\n      return objectCreate(proto);\n    }\n    object.prototype = proto;\n    var result = new object;\n    object.prototype = undefined;\n    return result;\n  };\n}());\n\nexport default baseCreate;\n","/**\n * Creates a unary function that invokes `func` with its argument transformed.\n *\n * @private\n * @param {Function} func The function to wrap.\n * @param {Function} transform The argument transform.\n * @returns {Function} Returns the new function.\n */\nfunction overArg(func, transform) {\n  return function(arg) {\n    return func(transform(arg));\n  };\n}\n\nexport default overArg;\n","import overArg from './_overArg.js';\n\n/** Built-in value references. */\nvar getPrototype = overArg(Object.getPrototypeOf, Object);\n\nexport default getPrototype;\n","/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/**\n * Checks if `value` is likely a prototype object.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a prototype, else `false`.\n */\nfunction isPrototype(value) {\n  var Ctor = value && value.constructor,\n      proto = (typeof Ctor == 'function' && Ctor.prototype) || objectProto;\n\n  return value === proto;\n}\n\nexport default isPrototype;\n","import baseCreate from './_baseCreate.js';\nimport getPrototype from './_getPrototype.js';\nimport isPrototype from './_isPrototype.js';\n\n/**\n * Initializes an object clone.\n *\n * @private\n * @param {Object} object The object to clone.\n * @returns {Object} Returns the initialized clone.\n */\nfunction initCloneObject(object) {\n  return (typeof object.constructor == 'function' && !isPrototype(object))\n    ? baseCreate(getPrototype(object))\n    : {};\n}\n\nexport default initCloneObject;\n","/**\n * Checks if `value` is object-like. A value is object-like if it's not `null`\n * and has a `typeof` result of \"object\".\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is object-like, else `false`.\n * @example\n *\n * _.isObjectLike({});\n * // => true\n *\n * _.isObjectLike([1, 2, 3]);\n * // => true\n *\n * _.isObjectLike(_.noop);\n * // => false\n *\n * _.isObjectLike(null);\n * // => false\n */\nfunction isObjectLike(value) {\n  return value != null && typeof value == 'object';\n}\n\nexport default isObjectLike;\n","import baseGetTag from './_baseGetTag.js';\nimport isObjectLike from './isObjectLike.js';\n\n/** `Object#toString` result references. */\nvar argsTag = '[object Arguments]';\n\n/**\n * The base implementation of `_.isArguments`.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an `arguments` object,\n */\nfunction baseIsArguments(value) {\n  return isObjectLike(value) && baseGetTag(value) == argsTag;\n}\n\nexport default baseIsArguments;\n","import baseIsArguments from './_baseIsArguments.js';\nimport isObjectLike from './isObjectLike.js';\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/** Built-in value references. */\nvar propertyIsEnumerable = objectProto.propertyIsEnumerable;\n\n/**\n * Checks if `value` is likely an `arguments` object.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an `arguments` object,\n *  else `false`.\n * @example\n *\n * _.isArguments(function() { return arguments; }());\n * // => true\n *\n * _.isArguments([1, 2, 3]);\n * // => false\n */\nvar isArguments = baseIsArguments(function() { return arguments; }()) ? baseIsArguments : function(value) {\n  return isObjectLike(value) && hasOwnProperty.call(value, 'callee') &&\n    !propertyIsEnumerable.call(value, 'callee');\n};\n\nexport default isArguments;\n","/**\n * Checks if `value` is classified as an `Array` object.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an array, else `false`.\n * @example\n *\n * _.isArray([1, 2, 3]);\n * // => true\n *\n * _.isArray(document.body.children);\n * // => false\n *\n * _.isArray('abc');\n * // => false\n *\n * _.isArray(_.noop);\n * // => false\n */\nvar isArray = Array.isArray;\n\nexport default isArray;\n","/** Used as references for various `Number` constants. */\nvar MAX_SAFE_INTEGER = 9007199254740991;\n\n/**\n * Checks if `value` is a valid array-like length.\n *\n * **Note:** This method is loosely based on\n * [`ToLength`](http://ecma-international.org/ecma-262/7.0/#sec-tolength).\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a valid length, else `false`.\n * @example\n *\n * _.isLength(3);\n * // => true\n *\n * _.isLength(Number.MIN_VALUE);\n * // => false\n *\n * _.isLength(Infinity);\n * // => false\n *\n * _.isLength('3');\n * // => false\n */\nfunction isLength(value) {\n  return typeof value == 'number' &&\n    value > -1 && value % 1 == 0 && value <= MAX_SAFE_INTEGER;\n}\n\nexport default isLength;\n","import isFunction from './isFunction.js';\nimport isLength from './isLength.js';\n\n/**\n * Checks if `value` is array-like. A value is considered array-like if it's\n * not a function and has a `value.length` that's an integer greater than or\n * equal to `0` and less than or equal to `Number.MAX_SAFE_INTEGER`.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is array-like, else `false`.\n * @example\n *\n * _.isArrayLike([1, 2, 3]);\n * // => true\n *\n * _.isArrayLike(document.body.children);\n * // => true\n *\n * _.isArrayLike('abc');\n * // => true\n *\n * _.isArrayLike(_.noop);\n * // => false\n */\nfunction isArrayLike(value) {\n  return value != null && isLength(value.length) && !isFunction(value);\n}\n\nexport default isArrayLike;\n","import root from './_root.js';\nimport stubFalse from './stubFalse.js';\n\n/** Detect free variable `exports`. */\nvar freeExports = typeof exports == 'object' && exports && !exports.nodeType && exports;\n\n/** Detect free variable `module`. */\nvar freeModule = freeExports && typeof module == 'object' && module && !module.nodeType && module;\n\n/** Detect the popular CommonJS extension `module.exports`. */\nvar moduleExports = freeModule && freeModule.exports === freeExports;\n\n/** Built-in value references. */\nvar Buffer = moduleExports ? root.Buffer : undefined;\n\n/* Built-in method references for those with the same name as other `lodash` methods. */\nvar nativeIsBuffer = Buffer ? Buffer.isBuffer : undefined;\n\n/**\n * Checks if `value` is a buffer.\n *\n * @static\n * @memberOf _\n * @since 4.3.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a buffer, else `false`.\n * @example\n *\n * _.isBuffer(new Buffer(2));\n * // => true\n *\n * _.isBuffer(new Uint8Array(2));\n * // => false\n */\nvar isBuffer = nativeIsBuffer || stubFalse;\n\nexport default isBuffer;\n","/**\n * This method returns `false`.\n *\n * @static\n * @memberOf _\n * @since 4.13.0\n * @category Util\n * @returns {boolean} Returns `false`.\n * @example\n *\n * _.times(2, _.stubFalse);\n * // => [false, false]\n */\nfunction stubFalse() {\n  return false;\n}\n\nexport default stubFalse;\n","import baseGetTag from './_baseGetTag.js';\nimport getPrototype from './_getPrototype.js';\nimport isObjectLike from './isObjectLike.js';\n\n/** `Object#toString` result references. */\nvar objectTag = '[object Object]';\n\n/** Used for built-in method references. */\nvar funcProto = Function.prototype,\n    objectProto = Object.prototype;\n\n/** Used to resolve the decompiled source of functions. */\nvar funcToString = funcProto.toString;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/** Used to infer the `Object` constructor. */\nvar objectCtorString = funcToString.call(Object);\n\n/**\n * Checks if `value` is a plain object, that is, an object created by the\n * `Object` constructor or one with a `[[Prototype]]` of `null`.\n *\n * @static\n * @memberOf _\n * @since 0.8.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a plain object, else `false`.\n * @example\n *\n * function Foo() {\n *   this.a = 1;\n * }\n *\n * _.isPlainObject(new Foo);\n * // => false\n *\n * _.isPlainObject([1, 2, 3]);\n * // => false\n *\n * _.isPlainObject({ 'x': 0, 'y': 0 });\n * // => true\n *\n * _.isPlainObject(Object.create(null));\n * // => true\n */\nfunction isPlainObject(value) {\n  if (!isObjectLike(value) || baseGetTag(value) != objectTag) {\n    return false;\n  }\n  var proto = getPrototype(value);\n  if (proto === null) {\n    return true;\n  }\n  var Ctor = hasOwnProperty.call(proto, 'constructor') && proto.constructor;\n  return typeof Ctor == 'function' && Ctor instanceof Ctor &&\n    funcToString.call(Ctor) == objectCtorString;\n}\n\nexport default isPlainObject;\n","import baseGetTag from './_baseGetTag.js';\nimport isLength from './isLength.js';\nimport isObjectLike from './isObjectLike.js';\n\n/** `Object#toString` result references. */\nvar argsTag = '[object Arguments]',\n    arrayTag = '[object Array]',\n    boolTag = '[object Boolean]',\n    dateTag = '[object Date]',\n    errorTag = '[object Error]',\n    funcTag = '[object Function]',\n    mapTag = '[object Map]',\n    numberTag = '[object Number]',\n    objectTag = '[object Object]',\n    regexpTag = '[object RegExp]',\n    setTag = '[object Set]',\n    stringTag = '[object String]',\n    weakMapTag = '[object WeakMap]';\n\nvar arrayBufferTag = '[object ArrayBuffer]',\n    dataViewTag = '[object DataView]',\n    float32Tag = '[object Float32Array]',\n    float64Tag = '[object Float64Array]',\n    int8Tag = '[object Int8Array]',\n    int16Tag = '[object Int16Array]',\n    int32Tag = '[object Int32Array]',\n    uint8Tag = '[object Uint8Array]',\n    uint8ClampedTag = '[object Uint8ClampedArray]',\n    uint16Tag = '[object Uint16Array]',\n    uint32Tag = '[object Uint32Array]';\n\n/** Used to identify `toStringTag` values of typed arrays. */\nvar typedArrayTags = {};\ntypedArrayTags[float32Tag] = typedArrayTags[float64Tag] =\ntypedArrayTags[int8Tag] = typedArrayTags[int16Tag] =\ntypedArrayTags[int32Tag] = typedArrayTags[uint8Tag] =\ntypedArrayTags[uint8ClampedTag] = typedArrayTags[uint16Tag] =\ntypedArrayTags[uint32Tag] = true;\ntypedArrayTags[argsTag] = typedArrayTags[arrayTag] =\ntypedArrayTags[arrayBufferTag] = typedArrayTags[boolTag] =\ntypedArrayTags[dataViewTag] = typedArrayTags[dateTag] =\ntypedArrayTags[errorTag] = typedArrayTags[funcTag] =\ntypedArrayTags[mapTag] = typedArrayTags[numberTag] =\ntypedArrayTags[objectTag] = typedArrayTags[regexpTag] =\ntypedArrayTags[setTag] = typedArrayTags[stringTag] =\ntypedArrayTags[weakMapTag] = false;\n\n/**\n * The base implementation of `_.isTypedArray` without Node.js optimizations.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a typed array, else `false`.\n */\nfunction baseIsTypedArray(value) {\n  return isObjectLike(value) &&\n    isLength(value.length) && !!typedArrayTags[baseGetTag(value)];\n}\n\nexport default baseIsTypedArray;\n","/**\n * The base implementation of `_.unary` without support for storing metadata.\n *\n * @private\n * @param {Function} func The function to cap arguments for.\n * @returns {Function} Returns the new capped function.\n */\nfunction baseUnary(func) {\n  return function(value) {\n    return func(value);\n  };\n}\n\nexport default baseUnary;\n","import freeGlobal from './_freeGlobal.js';\n\n/** Detect free variable `exports`. */\nvar freeExports = typeof exports == 'object' && exports && !exports.nodeType && exports;\n\n/** Detect free variable `module`. */\nvar freeModule = freeExports && typeof module == 'object' && module && !module.nodeType && module;\n\n/** Detect the popular CommonJS extension `module.exports`. */\nvar moduleExports = freeModule && freeModule.exports === freeExports;\n\n/** Detect free variable `process` from Node.js. */\nvar freeProcess = moduleExports && freeGlobal.process;\n\n/** Used to access faster Node.js helpers. */\nvar nodeUtil = (function() {\n  try {\n    // Use `util.types` for Node.js 10+.\n    var types = freeModule && freeModule.require && freeModule.require('util').types;\n\n    if (types) {\n      return types;\n    }\n\n    // Legacy `process.binding('util')` for Node.js < 10.\n    return freeProcess && freeProcess.binding && freeProcess.binding('util');\n  } catch (e) {}\n}());\n\nexport default nodeUtil;\n","import baseIsTypedArray from './_baseIsTypedArray.js';\nimport baseUnary from './_baseUnary.js';\nimport nodeUtil from './_nodeUtil.js';\n\n/* Node.js helper references. */\nvar nodeIsTypedArray = nodeUtil && nodeUtil.isTypedArray;\n\n/**\n * Checks if `value` is classified as a typed array.\n *\n * @static\n * @memberOf _\n * @since 3.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a typed array, else `false`.\n * @example\n *\n * _.isTypedArray(new Uint8Array);\n * // => true\n *\n * _.isTypedArray([]);\n * // => false\n */\nvar isTypedArray = nodeIsTypedArray ? baseUnary(nodeIsTypedArray) : baseIsTypedArray;\n\nexport default isTypedArray;\n","/**\n * Gets the value at `key`, unless `key` is \"__proto__\" or \"constructor\".\n *\n * @private\n * @param {Object} object The object to query.\n * @param {string} key The key of the property to get.\n * @returns {*} Returns the property value.\n */\nfunction safeGet(object, key) {\n  if (key === 'constructor' && typeof object[key] === 'function') {\n    return;\n  }\n\n  if (key == '__proto__') {\n    return;\n  }\n\n  return object[key];\n}\n\nexport default safeGet;\n","import baseAssignValue from './_baseAssignValue.js';\nimport eq from './eq.js';\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * Assigns `value` to `key` of `object` if the existing value is not equivalent\n * using [`SameValueZero`](http://ecma-international.org/ecma-262/7.0/#sec-samevaluezero)\n * for equality comparisons.\n *\n * @private\n * @param {Object} object The object to modify.\n * @param {string} key The key of the property to assign.\n * @param {*} value The value to assign.\n */\nfunction assignValue(object, key, value) {\n  var objValue = object[key];\n  if (!(hasOwnProperty.call(object, key) && eq(objValue, value)) ||\n      (value === undefined && !(key in object))) {\n    baseAssignValue(object, key, value);\n  }\n}\n\nexport default assignValue;\n","import assignValue from './_assignValue.js';\nimport baseAssignValue from './_baseAssignValue.js';\n\n/**\n * Copies properties of `source` to `object`.\n *\n * @private\n * @param {Object} source The object to copy properties from.\n * @param {Array} props The property identifiers to copy.\n * @param {Object} [object={}] The object to copy properties to.\n * @param {Function} [customizer] The function to customize copied values.\n * @returns {Object} Returns `object`.\n */\nfunction copyObject(source, props, object, customizer) {\n  var isNew = !object;\n  object || (object = {});\n\n  var index = -1,\n      length = props.length;\n\n  while (++index < length) {\n    var key = props[index];\n\n    var newValue = customizer\n      ? customizer(object[key], source[key], key, object, source)\n      : undefined;\n\n    if (newValue === undefined) {\n      newValue = source[key];\n    }\n    if (isNew) {\n      baseAssignValue(object, key, newValue);\n    } else {\n      assignValue(object, key, newValue);\n    }\n  }\n  return object;\n}\n\nexport default copyObject;\n","/** Used as references for various `Number` constants. */\nvar MAX_SAFE_INTEGER = 9007199254740991;\n\n/** Used to detect unsigned integer values. */\nvar reIsUint = /^(?:0|[1-9]\\d*)$/;\n\n/**\n * Checks if `value` is a valid array-like index.\n *\n * @private\n * @param {*} value The value to check.\n * @param {number} [length=MAX_SAFE_INTEGER] The upper bounds of a valid index.\n * @returns {boolean} Returns `true` if `value` is a valid index, else `false`.\n */\nfunction isIndex(value, length) {\n  var type = typeof value;\n  length = length == null ? MAX_SAFE_INTEGER : length;\n\n  return !!length &&\n    (type == 'number' ||\n      (type != 'symbol' && reIsUint.test(value))) &&\n        (value > -1 && value % 1 == 0 && value < length);\n}\n\nexport default isIndex;\n","import baseTimes from './_baseTimes.js';\nimport isArguments from './isArguments.js';\nimport isArray from './isArray.js';\nimport isBuffer from './isBuffer.js';\nimport isIndex from './_isIndex.js';\nimport isTypedArray from './isTypedArray.js';\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * Creates an array of the enumerable property names of the array-like `value`.\n *\n * @private\n * @param {*} value The value to query.\n * @param {boolean} inherited Specify returning inherited property names.\n * @returns {Array} Returns the array of property names.\n */\nfunction arrayLikeKeys(value, inherited) {\n  var isArr = isArray(value),\n      isArg = !isArr && isArguments(value),\n      isBuff = !isArr && !isArg && isBuffer(value),\n      isType = !isArr && !isArg && !isBuff && isTypedArray(value),\n      skipIndexes = isArr || isArg || isBuff || isType,\n      result = skipIndexes ? baseTimes(value.length, String) : [],\n      length = result.length;\n\n  for (var key in value) {\n    if ((inherited || hasOwnProperty.call(value, key)) &&\n        !(skipIndexes && (\n           // Safari 9 has enumerable `arguments.length` in strict mode.\n           key == 'length' ||\n           // Node.js 0.10 has enumerable non-index properties on buffers.\n           (isBuff && (key == 'offset' || key == 'parent')) ||\n           // PhantomJS 2 has enumerable non-index properties on typed arrays.\n           (isType && (key == 'buffer' || key == 'byteLength' || key == 'byteOffset')) ||\n           // Skip index properties.\n           isIndex(key, length)\n        ))) {\n      result.push(key);\n    }\n  }\n  return result;\n}\n\nexport default arrayLikeKeys;\n","/**\n * The base implementation of `_.times` without support for iteratee shorthands\n * or max array length checks.\n *\n * @private\n * @param {number} n The number of times to invoke `iteratee`.\n * @param {Function} iteratee The function invoked per iteration.\n * @returns {Array} Returns the array of results.\n */\nfunction baseTimes(n, iteratee) {\n  var index = -1,\n      result = Array(n);\n\n  while (++index < n) {\n    result[index] = iteratee(index);\n  }\n  return result;\n}\n\nexport default baseTimes;\n","import isObject from './isObject.js';\nimport isPrototype from './_isPrototype.js';\nimport nativeKeysIn from './_nativeKeysIn.js';\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * The base implementation of `_.keysIn` which doesn't treat sparse arrays as dense.\n *\n * @private\n * @param {Object} object The object to query.\n * @returns {Array} Returns the array of property names.\n */\nfunction baseKeysIn(object) {\n  if (!isObject(object)) {\n    return nativeKeysIn(object);\n  }\n  var isProto = isPrototype(object),\n      result = [];\n\n  for (var key in object) {\n    if (!(key == 'constructor' && (isProto || !hasOwnProperty.call(object, key)))) {\n      result.push(key);\n    }\n  }\n  return result;\n}\n\nexport default baseKeysIn;\n","/**\n * This function is like\n * [`Object.keys`](http://ecma-international.org/ecma-262/7.0/#sec-object.keys)\n * except that it includes inherited enumerable properties.\n *\n * @private\n * @param {Object} object The object to query.\n * @returns {Array} Returns the array of property names.\n */\nfunction nativeKeysIn(object) {\n  var result = [];\n  if (object != null) {\n    for (var key in Object(object)) {\n      result.push(key);\n    }\n  }\n  return result;\n}\n\nexport default nativeKeysIn;\n","import arrayLikeKeys from './_arrayLikeKeys.js';\nimport baseKeysIn from './_baseKeysIn.js';\nimport isArrayLike from './isArrayLike.js';\n\n/**\n * Creates an array of the own and inherited enumerable property names of `object`.\n *\n * **Note:** Non-object values are coerced to objects.\n *\n * @static\n * @memberOf _\n * @since 3.0.0\n * @category Object\n * @param {Object} object The object to query.\n * @returns {Array} Returns the array of property names.\n * @example\n *\n * function Foo() {\n *   this.a = 1;\n *   this.b = 2;\n * }\n *\n * Foo.prototype.c = 3;\n *\n * _.keysIn(new Foo);\n * // => ['a', 'b', 'c'] (iteration order is not guaranteed)\n */\nfunction keysIn(object) {\n  return isArrayLike(object) ? arrayLikeKeys(object, true) : baseKeysIn(object);\n}\n\nexport default keysIn;\n","import assignMergeValue from './_assignMergeValue.js';\nimport cloneBuffer from './_cloneBuffer.js';\nimport cloneTypedArray from './_cloneTypedArray.js';\nimport copyArray from './_copyArray.js';\nimport initCloneObject from './_initCloneObject.js';\nimport isArguments from './isArguments.js';\nimport isArray from './isArray.js';\nimport isArrayLikeObject from './isArrayLikeObject.js';\nimport isBuffer from './isBuffer.js';\nimport isFunction from './isFunction.js';\nimport isObject from './isObject.js';\nimport isPlainObject from './isPlainObject.js';\nimport isTypedArray from './isTypedArray.js';\nimport safeGet from './_safeGet.js';\nimport toPlainObject from './toPlainObject.js';\n\n/**\n * A specialized version of `baseMerge` for arrays and objects which performs\n * deep merges and tracks traversed objects enabling objects with circular\n * references to be merged.\n *\n * @private\n * @param {Object} object The destination object.\n * @param {Object} source The source object.\n * @param {string} key The key of the value to merge.\n * @param {number} srcIndex The index of `source`.\n * @param {Function} mergeFunc The function to merge values.\n * @param {Function} [customizer] The function to customize assigned values.\n * @param {Object} [stack] Tracks traversed source values and their merged\n *  counterparts.\n */\nfunction baseMergeDeep(object, source, key, srcIndex, mergeFunc, customizer, stack) {\n  var objValue = safeGet(object, key),\n      srcValue = safeGet(source, key),\n      stacked = stack.get(srcValue);\n\n  if (stacked) {\n    assignMergeValue(object, key, stacked);\n    return;\n  }\n  var newValue = customizer\n    ? customizer(objValue, srcValue, (key + ''), object, source, stack)\n    : undefined;\n\n  var isCommon = newValue === undefined;\n\n  if (isCommon) {\n    var isArr = isArray(srcValue),\n        isBuff = !isArr && isBuffer(srcValue),\n        isTyped = !isArr && !isBuff && isTypedArray(srcValue);\n\n    newValue = srcValue;\n    if (isArr || isBuff || isTyped) {\n      if (isArray(objValue)) {\n        newValue = objValue;\n      }\n      else if (isArrayLikeObject(objValue)) {\n        newValue = copyArray(objValue);\n      }\n      else if (isBuff) {\n        isCommon = false;\n        newValue = cloneBuffer(srcValue, true);\n      }\n      else if (isTyped) {\n        isCommon = false;\n        newValue = cloneTypedArray(srcValue, true);\n      }\n      else {\n        newValue = [];\n      }\n    }\n    else if (isPlainObject(srcValue) || isArguments(srcValue)) {\n      newValue = objValue;\n      if (isArguments(objValue)) {\n        newValue = toPlainObject(objValue);\n      }\n      else if (!isObject(objValue) || isFunction(objValue)) {\n        newValue = initCloneObject(srcValue);\n      }\n    }\n    else {\n      isCommon = false;\n    }\n  }\n  if (isCommon) {\n    // Recursively merge objects and arrays (susceptible to call stack limits).\n    stack.set(srcValue, newValue);\n    mergeFunc(newValue, srcValue, srcIndex, customizer, stack);\n    stack['delete'](srcValue);\n  }\n  assignMergeValue(object, key, newValue);\n}\n\nexport default baseMergeDeep;\n","import isArrayLike from './isArrayLike.js';\nimport isObjectLike from './isObjectLike.js';\n\n/**\n * This method is like `_.isArrayLike` except that it also checks if `value`\n * is an object.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an array-like object,\n *  else `false`.\n * @example\n *\n * _.isArrayLikeObject([1, 2, 3]);\n * // => true\n *\n * _.isArrayLikeObject(document.body.children);\n * // => true\n *\n * _.isArrayLikeObject('abc');\n * // => false\n *\n * _.isArrayLikeObject(_.noop);\n * // => false\n */\nfunction isArrayLikeObject(value) {\n  return isObjectLike(value) && isArrayLike(value);\n}\n\nexport default isArrayLikeObject;\n","import copyObject from './_copyObject.js';\nimport keysIn from './keysIn.js';\n\n/**\n * Converts `value` to a plain object flattening inherited enumerable string\n * keyed properties of `value` to own properties of the plain object.\n *\n * @static\n * @memberOf _\n * @since 3.0.0\n * @category Lang\n * @param {*} value The value to convert.\n * @returns {Object} Returns the converted plain object.\n * @example\n *\n * function Foo() {\n *   this.b = 2;\n * }\n *\n * Foo.prototype.c = 3;\n *\n * _.assign({ 'a': 1 }, new Foo);\n * // => { 'a': 1, 'b': 2 }\n *\n * _.assign({ 'a': 1 }, _.toPlainObject(new Foo));\n * // => { 'a': 1, 'b': 2, 'c': 3 }\n */\nfunction toPlainObject(value) {\n  return copyObject(value, keysIn(value));\n}\n\nexport default toPlainObject;\n","import Stack from './_Stack.js';\nimport assignMergeValue from './_assignMergeValue.js';\nimport baseFor from './_baseFor.js';\nimport baseMergeDeep from './_baseMergeDeep.js';\nimport isObject from './isObject.js';\nimport keysIn from './keysIn.js';\nimport safeGet from './_safeGet.js';\n\n/**\n * The base implementation of `_.merge` without support for multiple sources.\n *\n * @private\n * @param {Object} object The destination object.\n * @param {Object} source The source object.\n * @param {number} srcIndex The index of `source`.\n * @param {Function} [customizer] The function to customize merged values.\n * @param {Object} [stack] Tracks traversed source values and their merged\n *  counterparts.\n */\nfunction baseMerge(object, source, srcIndex, customizer, stack) {\n  if (object === source) {\n    return;\n  }\n  baseFor(source, function(srcValue, key) {\n    stack || (stack = new Stack);\n    if (isObject(srcValue)) {\n      baseMergeDeep(object, source, key, srcIndex, baseMerge, customizer, stack);\n    }\n    else {\n      var newValue = customizer\n        ? customizer(safeGet(object, key), srcValue, (key + ''), object, source, stack)\n        : undefined;\n\n      if (newValue === undefined) {\n        newValue = srcValue;\n      }\n      assignMergeValue(object, key, newValue);\n    }\n  }, keysIn);\n}\n\nexport default baseMerge;\n","/**\n * This method returns the first argument it receives.\n *\n * @static\n * @since 0.1.0\n * @memberOf _\n * @category Util\n * @param {*} value Any value.\n * @returns {*} Returns `value`.\n * @example\n *\n * var object = { 'a': 1 };\n *\n * console.log(_.identity(object) === object);\n * // => true\n */\nfunction identity(value) {\n  return value;\n}\n\nexport default identity;\n","import apply from './_apply.js';\n\n/* Built-in method references for those with the same name as other `lodash` methods. */\nvar nativeMax = Math.max;\n\n/**\n * A specialized version of `baseRest` which transforms the rest array.\n *\n * @private\n * @param {Function} func The function to apply a rest parameter to.\n * @param {number} [start=func.length-1] The start position of the rest parameter.\n * @param {Function} transform The rest array transform.\n * @returns {Function} Returns the new function.\n */\nfunction overRest(func, start, transform) {\n  start = nativeMax(start === undefined ? (func.length - 1) : start, 0);\n  return function() {\n    var args = arguments,\n        index = -1,\n        length = nativeMax(args.length - start, 0),\n        array = Array(length);\n\n    while (++index < length) {\n      array[index] = args[start + index];\n    }\n    index = -1;\n    var otherArgs = Array(start + 1);\n    while (++index < start) {\n      otherArgs[index] = args[index];\n    }\n    otherArgs[start] = transform(array);\n    return apply(func, this, otherArgs);\n  };\n}\n\nexport default overRest;\n","import constant from './constant.js';\nimport defineProperty from './_defineProperty.js';\nimport identity from './identity.js';\n\n/**\n * The base implementation of `setToString` without support for hot loop shorting.\n *\n * @private\n * @param {Function} func The function to modify.\n * @param {Function} string The `toString` result.\n * @returns {Function} Returns `func`.\n */\nvar baseSetToString = !defineProperty ? identity : function(func, string) {\n  return defineProperty(func, 'toString', {\n    'configurable': true,\n    'enumerable': false,\n    'value': constant(string),\n    'writable': true\n  });\n};\n\nexport default baseSetToString;\n","/**\n * Creates a function that returns `value`.\n *\n * @static\n * @memberOf _\n * @since 2.4.0\n * @category Util\n * @param {*} value The value to return from the new function.\n * @returns {Function} Returns the new constant function.\n * @example\n *\n * var objects = _.times(2, _.constant({ 'a': 1 }));\n *\n * console.log(objects);\n * // => [{ 'a': 1 }, { 'a': 1 }]\n *\n * console.log(objects[0] === objects[1]);\n * // => true\n */\nfunction constant(value) {\n  return function() {\n    return value;\n  };\n}\n\nexport default constant;\n","/** Used to detect hot functions by number of calls within a span of milliseconds. */\nvar HOT_COUNT = 800,\n    HOT_SPAN = 16;\n\n/* Built-in method references for those with the same name as other `lodash` methods. */\nvar nativeNow = Date.now;\n\n/**\n * Creates a function that'll short out and invoke `identity` instead\n * of `func` when it's called `HOT_COUNT` or more times in `HOT_SPAN`\n * milliseconds.\n *\n * @private\n * @param {Function} func The function to restrict.\n * @returns {Function} Returns the new shortable function.\n */\nfunction shortOut(func) {\n  var count = 0,\n      lastCalled = 0;\n\n  return function() {\n    var stamp = nativeNow(),\n        remaining = HOT_SPAN - (stamp - lastCalled);\n\n    lastCalled = stamp;\n    if (remaining > 0) {\n      if (++count >= HOT_COUNT) {\n        return arguments[0];\n      }\n    } else {\n      count = 0;\n    }\n    return func.apply(undefined, arguments);\n  };\n}\n\nexport default shortOut;\n","import baseSetToString from './_baseSetToString.js';\nimport shortOut from './_shortOut.js';\n\n/**\n * Sets the `toString` method of `func` to return `string`.\n *\n * @private\n * @param {Function} func The function to modify.\n * @param {Function} string The `toString` result.\n * @returns {Function} Returns `func`.\n */\nvar setToString = shortOut(baseSetToString);\n\nexport default setToString;\n","import identity from './identity.js';\nimport overRest from './_overRest.js';\nimport setToString from './_setToString.js';\n\n/**\n * The base implementation of `_.rest` which doesn't validate or coerce arguments.\n *\n * @private\n * @param {Function} func The function to apply a rest parameter to.\n * @param {number} [start=func.length-1] The start position of the rest parameter.\n * @returns {Function} Returns the new function.\n */\nfunction baseRest(func, start) {\n  return setToString(overRest(func, start, identity), func + '');\n}\n\nexport default baseRest;\n","/**\n * A faster alternative to `Function#apply`, this function invokes `func`\n * with the `this` binding of `thisArg` and the arguments of `args`.\n *\n * @private\n * @param {Function} func The function to invoke.\n * @param {*} thisArg The `this` binding of `func`.\n * @param {Array} args The arguments to invoke `func` with.\n * @returns {*} Returns the result of `func`.\n */\nfunction apply(func, thisArg, args) {\n  switch (args.length) {\n    case 0: return func.call(thisArg);\n    case 1: return func.call(thisArg, args[0]);\n    case 2: return func.call(thisArg, args[0], args[1]);\n    case 3: return func.call(thisArg, args[0], args[1], args[2]);\n  }\n  return func.apply(thisArg, args);\n}\n\nexport default apply;\n","import baseMerge from './_baseMerge.js';\nimport createAssigner from './_createAssigner.js';\n\n/**\n * This method is like `_.assign` except that it recursively merges own and\n * inherited enumerable string keyed properties of source objects into the\n * destination object. Source properties that resolve to `undefined` are\n * skipped if a destination value exists. Array and plain object properties\n * are merged recursively. Other objects and value types are overridden by\n * assignment. Source objects are applied from left to right. Subsequent\n * sources overwrite property assignments of previous sources.\n *\n * **Note:** This method mutates `object`.\n *\n * @static\n * @memberOf _\n * @since 0.5.0\n * @category Object\n * @param {Object} object The destination object.\n * @param {...Object} [sources] The source objects.\n * @returns {Object} Returns `object`.\n * @example\n *\n * var object = {\n *   'a': [{ 'b': 2 }, { 'd': 4 }]\n * };\n *\n * var other = {\n *   'a': [{ 'c': 3 }, { 'e': 5 }]\n * };\n *\n * _.merge(object, other);\n * // => { 'a': [{ 'b': 2, 'c': 3 }, { 'd': 4, 'e': 5 }] }\n */\nvar merge = createAssigner(function(object, source, srcIndex) {\n  baseMerge(object, source, srcIndex);\n});\n\nexport default merge;\n","import baseRest from './_baseRest.js';\nimport isIterateeCall from './_isIterateeCall.js';\n\n/**\n * Creates a function like `_.assign`.\n *\n * @private\n * @param {Function} assigner The function to assign values.\n * @returns {Function} Returns the new assigner function.\n */\nfunction createAssigner(assigner) {\n  return baseRest(function(object, sources) {\n    var index = -1,\n        length = sources.length,\n        customizer = length > 1 ? sources[length - 1] : undefined,\n        guard = length > 2 ? sources[2] : undefined;\n\n    customizer = (assigner.length > 3 && typeof customizer == 'function')\n      ? (length--, customizer)\n      : undefined;\n\n    if (guard && isIterateeCall(sources[0], sources[1], guard)) {\n      customizer = length < 3 ? undefined : customizer;\n      length = 1;\n    }\n    object = Object(object);\n    while (++index < length) {\n      var source = sources[index];\n      if (source) {\n        assigner(object, source, index, customizer);\n      }\n    }\n    return object;\n  });\n}\n\nexport default createAssigner;\n","import eq from './eq.js';\nimport isArrayLike from './isArrayLike.js';\nimport isIndex from './_isIndex.js';\nimport isObject from './isObject.js';\n\n/**\n * Checks if the given arguments are from an iteratee call.\n *\n * @private\n * @param {*} value The potential iteratee value argument.\n * @param {*} index The potential iteratee index or key argument.\n * @param {*} object The potential iteratee object argument.\n * @returns {boolean} Returns `true` if the arguments are from an iteratee call,\n *  else `false`.\n */\nfunction isIterateeCall(value, index, object) {\n  if (!isObject(object)) {\n    return false;\n  }\n  var type = typeof index;\n  if (type == 'number'\n        ? (isArrayLike(object) && isIndex(index, object.length))\n        : (type == 'string' && index in object)\n      ) {\n    return eq(object[index], value);\n  }\n  return false;\n}\n\nexport default isIterateeCall;\n","/**\n * The errors for the conference.\n */\n\nexport enum JitsiConferenceErrors {\n\n    /**\n     * Indicates that client must be authenticated to create the conference.\n     */\n    AUTHENTICATION_REQUIRED = 'conference.authenticationRequired',\n\n    /**\n     * Indicates that chat error occurred.\n     */\n    CHAT_ERROR = 'conference.chatError',\n\n    /**\n     * Indicates that a connection error is due to denied access to the room,\n     * occurred after joining a lobby room and access is denied by the room moderators.\n     */\n    CONFERENCE_ACCESS_DENIED = 'conference.connectionError.accessDenied',\n\n    /**\n     * Indicates that conference has been destroyed.\n     */\n    CONFERENCE_DESTROYED = 'conference.destroyed',\n\n    /**\n     * Indicates that max users limit has been reached.\n     */\n    CONFERENCE_MAX_USERS = 'conference.max_users',\n\n    /**\n     * Indicates that a connection error occurred when trying to join a conference.\n     */\n    CONNECTION_ERROR = 'conference.connectionError',\n\n    /**\n     * Indicates that the display name is required when joining the room.\n     * There are cases like lobby room where display name is required.\n     * @param {boolean|null} lobby whether the error is because lobby is enabled.\n     */\n    DISPLAY_NAME_REQUIRED = 'conference.display_name_required',\n\n    /**\n     * Indicates that focus error happened.\n     */\n    FOCUS_DISCONNECTED = 'conference.focusDisconnected',\n\n    /**\n     * Indicates that focus left the conference.\n     */\n    FOCUS_LEFT = 'conference.focusLeft',\n\n    /**\n     * Indicates that graceful shutdown happened.\n     */\n    GRACEFUL_SHUTDOWN = 'conference.gracefulShutdown',\n\n    /**\n     * Indicates that the media connection has failed.\n     */\n    ICE_FAILED = 'conference.iceFailed',\n\n    /**\n     * Indicates that the versions of the server side components are incompatible\n     * with the client side.\n     */\n    INCOMPATIBLE_SERVER_VERSIONS = 'conference.incompatible_server_versions',\n\n    /**\n     * Indicates that a connection error is due to not allowed,\n     * occurred when trying to join a conference, only approved members are allowed to join.\n     */\n    MEMBERS_ONLY_ERROR = 'conference.connectionError.membersOnly',\n\n    /**\n     * Indicates that a connection error is due to not allowed,\n     * occurred when trying to join a conference.\n     */\n    NOT_ALLOWED_ERROR = 'conference.connectionError.notAllowed',\n\n    /**\n     * Indicates that offer/answer had failed.\n     */\n    OFFER_ANSWER_FAILED = 'conference.offerAnswerFailed',\n\n    /**\n     * Indicates that password cannot be set for this conference.\n     */\n    PASSWORD_NOT_SUPPORTED = 'conference.passwordNotSupported',\n\n    /**\n     * Indicates that a password is required in order to join the conference.\n     */\n    PASSWORD_REQUIRED = 'conference.passwordRequired',\n\n    /**\n     * Indicates that reservation system returned error.\n     */\n    RESERVATION_ERROR = 'conference.reservationError',\n\n    /**\n     * Indicates that a settings error occurred.\n     */\n    SETTINGS_ERROR = 'conference.settingsError',\n\n    /**\n     * Indicates that there is no available videobridge.\n     */\n    VIDEOBRIDGE_NOT_AVAILABLE = 'conference.videobridgeNotAvailable'\n}\n\n/**\n * Types that are passed for NOT_ALLOWED_ERROR.\n */\nexport enum AUTH_ERROR_TYPES {\n    GENERAL = 'general',\n    NO_MAIN_PARTICIPANTS = 'no-main-participants',\n    NO_VISITORS_LOBBY = 'no-visitors-lobby',\n    PROMOTION_NOT_ALLOWED = 'promotion-not-allowed',\n    ROOM_CREATION_RESTRICTION = 'room-creation-restriction',\n    ROOM_UNAUTHENTICATED_ACCESS_DISABLED = 'authentication-required'\n}\n\n// exported for backward compatibility\nexport const AUTHENTICATION_REQUIRED = JitsiConferenceErrors.AUTHENTICATION_REQUIRED;\nexport const CHAT_ERROR = JitsiConferenceErrors.CHAT_ERROR;\nexport const SETTINGS_ERROR = JitsiConferenceErrors.SETTINGS_ERROR;\nexport const CONFERENCE_DESTROYED = JitsiConferenceErrors.CONFERENCE_DESTROYED;\nexport const CONFERENCE_MAX_USERS = JitsiConferenceErrors.CONFERENCE_MAX_USERS;\nexport const CONNECTION_ERROR = JitsiConferenceErrors.CONNECTION_ERROR;\nexport const NOT_ALLOWED_ERROR = JitsiConferenceErrors.NOT_ALLOWED_ERROR;\nexport const MEMBERS_ONLY_ERROR = JitsiConferenceErrors.MEMBERS_ONLY_ERROR;\nexport const CONFERENCE_ACCESS_DENIED = JitsiConferenceErrors.CONFERENCE_ACCESS_DENIED;\nexport const DISPLAY_NAME_REQUIRED = JitsiConferenceErrors.DISPLAY_NAME_REQUIRED;\nexport const FOCUS_DISCONNECTED = JitsiConferenceErrors.FOCUS_DISCONNECTED;\nexport const FOCUS_LEFT = JitsiConferenceErrors.FOCUS_LEFT;\nexport const GRACEFUL_SHUTDOWN = JitsiConferenceErrors.GRACEFUL_SHUTDOWN;\nexport const ICE_FAILED = JitsiConferenceErrors.ICE_FAILED;\nexport const INCOMPATIBLE_SERVER_VERSIONS = JitsiConferenceErrors.INCOMPATIBLE_SERVER_VERSIONS;\nexport const OFFER_ANSWER_FAILED = JitsiConferenceErrors.OFFER_ANSWER_FAILED;\nexport const PASSWORD_NOT_SUPPORTED = JitsiConferenceErrors.PASSWORD_NOT_SUPPORTED;\nexport const PASSWORD_REQUIRED = JitsiConferenceErrors.PASSWORD_REQUIRED;\nexport const RESERVATION_ERROR = JitsiConferenceErrors.RESERVATION_ERROR;\nexport const VIDEOBRIDGE_NOT_AVAILABLE = JitsiConferenceErrors.VIDEOBRIDGE_NOT_AVAILABLE;\n","export enum JitsiConferenceEvents {\n\n    /**\n     * Event indicates that the current conference audio input switched between audio\n     * input states,i.e. with or without audio input.\n     */\n    AUDIO_INPUT_STATE_CHANGE = 'conference.audio_input_state_changed',\n\n    /**\n     * Event indicates that the permission for unmuting audio has changed based on the number of audio senders in the\n     * call and the audio sender limit configured in Jicofo.\n     */\n    AUDIO_UNMUTE_PERMISSIONS_CHANGED = 'conference.audio_unmute_permissions_changed',\n\n    /**\n     * Indicates that authentication status changed.\n     */\n    AUTH_STATUS_CHANGED = 'conference.auth_status_changed',\n\n    /**\n     * The local participant was approved to be able to unmute.\n     * @param {options} event - {\n     *     {MediaType} mediaType\n     * }.\n     */\n    AV_MODERATION_APPROVED = 'conference.av_moderation.approved',\n\n    /**\n     * AV Moderation was enabled/disabled. The actor is the participant that is currently in the meeting,\n     * or undefined if that participant has left the meeting.\n     *\n     * @param {options} event - {\n     *     {boolean} enabled,\n     *     {MediaType} mediaType,\n     *     {JitsiParticipant} actor\n     * }.\n     */\n    AV_MODERATION_CHANGED = 'conference.av_moderation.changed',\n\n    /**\n     * AV Moderation, report for user being approved to unmute.\n     * @param {options} event - {\n     *     {JitsiParticipant} participant,\n     *     {MediaType} mediaType\n     * }.\n     */\n    AV_MODERATION_PARTICIPANT_APPROVED = 'conference.av_moderation.participant.approved',\n\n    /**\n     * AV Moderation, report for user being blocked to unmute.\n     * @param {options} event - {\n     *     {JitsiParticipant} participant,\n     *     {MediaType} mediaType\n     * }.\n     */\n    AV_MODERATION_PARTICIPANT_REJECTED = 'conference.av_moderation.participant.rejected',\n\n    /**\n     * The local participant was blocked to be able to unmute.\n     * @param {options} event - {\n     *     {MediaType} mediaType\n     * }.\n     */\n    AV_MODERATION_REJECTED = 'conference.av_moderation.rejected',\n\n    /**\n     * Fired just before the statistics module is disposed and it's the last chance\n     * to submit some logs to the statistics service before it's disconnected.\n     */\n    BEFORE_STATISTICS_DISPOSED = 'conference.beforeStatisticsDisposed',\n\n    /**\n     * Event indicates that the bot participant type changed.\n     */\n    BOT_TYPE_CHANGED = 'conference.bot_type_changed',\n\n    /**\n     * Event fired when a participant is requested to join a given (breakout) room.\n     */\n    BREAKOUT_ROOMS_MOVE_TO_ROOM = 'conference.breakout-rooms.move-to-room',\n\n    /**\n     * Event fired when the breakout rooms data was updated.\n     */\n    BREAKOUT_ROOMS_UPDATED = 'conference.breakout-rooms.updated',\n\n    /**\n     * Event fired when the bandwidth estimation stats are received from the bridge.\n     */\n    BRIDGE_BWE_STATS_RECEIVED = 'conference.bridgeBweStatsReceived',\n\n    /**\n     * UTC conference timestamp when first participant joined.\n     */\n    CONFERENCE_CREATED_TIMESTAMP = 'conference.createdTimestamp',\n\n    /**\n     * Indicates that an error occurred.\n     */\n    CONFERENCE_ERROR = 'conference.error',\n\n    /**\n     * Indicates that conference failed.\n     */\n    CONFERENCE_FAILED = 'conference.failed',\n\n    /**\n     * Indicates that conference has been joined. The event does NOT provide any\n     * parameters to its listeners.\n     */\n    CONFERENCE_JOINED = 'conference.joined',\n\n    /**\n     * Indicates that conference is in progress of joining.\n     */\n    CONFERENCE_JOIN_IN_PROGRESS = 'conference.join_in_progress',\n\n    /**\n     * Indicates that conference has been left.\n     */\n    CONFERENCE_LEFT = 'conference.left',\n\n    /**\n     * Indicates that the conference unique identifier has been set.\n     */\n    CONFERENCE_UNIQUE_ID_SET = 'conference.unique_id_set',\n\n    /**\n     * Indicates that the aggregate set of codecs supported by the visitors has changed.\n     */\n    CONFERENCE_VISITOR_CODECS_CHANGED = 'conference.visitor_codecs_changed',\n\n    /**\n     * Indicates that the connection to the conference has been established\n     * XXX This is currently fired when the *ICE* connection enters 'connected'\n     * state for the first time.\n     */\n    CONNECTION_ESTABLISHED = 'conference.connectionEstablished',\n\n    /**\n     * Indicates that the connection to the conference has been interrupted for some\n     * reason.\n     * XXX This is currently fired when the *ICE* connection is interrupted.\n     */\n    CONNECTION_INTERRUPTED = 'conference.connectionInterrupted',\n\n    /**\n     * Indicates that the connection to the conference has been restored.\n     * XXX This is currently fired when the *ICE* connection is restored.\n     */\n    CONNECTION_RESTORED = 'conference.connectionRestored',\n\n    /**\n     * A connection to the video bridge's data channel has been closed.\n     * This event is only emitted in\n     */\n    DATA_CHANNEL_CLOSED = 'conference.dataChannelClosed',\n\n    /**\n     * A connection to the video bridge's data channel has been established.\n     */\n    DATA_CHANNEL_OPENED = 'conference.dataChannelOpened',\n\n    /**\n     * A user has changed it display name\n     */\n    DISPLAY_NAME_CHANGED = 'conference.displayNameChanged',\n\n    /**\n     * The dominant speaker was changed.\n     */\n    DOMINANT_SPEAKER_CHANGED = 'conference.dominantSpeaker',\n\n    /**\n     * Indicates that DTMF support changed.\n     */\n    DTMF_SUPPORT_CHANGED = 'conference.dtmfSupportChanged',\n\n    E2EE_VERIFICATION_AVAILABLE = 'conference.e2ee.verification.available',\n\n    E2EE_VERIFICATION_COMPLETED = 'conference.e2ee.verification.completed',\n\n    E2EE_VERIFICATION_READY = 'conference.e2ee.verification.ready',\n\n    /**\n     * Indicates that the encode time stats for the local video sources has been received.\n     */\n    ENCODE_TIME_STATS_RECEIVED = 'conference.encode_time_stats_received',\n\n    /**\n     * Indicates that a message from another participant is received on data\n     * channel.\n     */\n    ENDPOINT_MESSAGE_RECEIVED = 'conference.endpoint_message_received',\n\n    /**\n     * Indicates that a message for the remote endpoint statistics has been received on the bridge channel.\n     */\n    ENDPOINT_STATS_RECEIVED = 'conference.endpoint_stats_received',\n\n    /**\n     * Event emitted when a list file is received in the conference. This event is fired when a participant joins\n     * and the file list is sent to them.\n     * @param {Map<String, IFileMetadata>} files - The map of files received in the conference with key the file ID.\n     */\n    FILE_SHARING_FILES_RECEIVED = 'conference.file_sharing.files_received',\n\n    /**\n     * Event emitted when a file is added to the conference.\n     * @param {IFileMetadata} file - The file object containing metadata about the file.\n     */\n    FILE_SHARING_FILE_ADDED = 'conference.file_sharing.file_added',\n\n    /**\n     * Event emitted when a file is removed from the conference.\n     * @param {String} fileId - The ID of the file that was removed.\n     */\n    FILE_SHARING_FILE_REMOVED = 'conference.file_sharing.file_removed',\n\n    /**\n     * The forwarded sources set is changed.\n     *\n     * @param {Array<string>} leavingForwardedSources the sourceNames of all the tracks which are leaving forwarded\n     * sources\n     * @param {Array<string>} enteringForwardedSources the sourceNames of all the tracks which are entering forwarded\n     * sources\n     */\n    FORWARDED_SOURCES_CHANGED = 'conference.forwardedSourcesChanged',\n\n    /**\n     * You are kicked from the conference.\n     * @param {JitsiParticipant} the participant that initiated the kick.\n     */\n    KICKED = 'conference.kicked',\n\n    /**\n     * The Last N set is changed.\n     *\n     * @param {Array<string>|null} leavingEndpointIds the ids of all the endpoints\n     * which are leaving Last N\n     * @param {Array<string>|null} enteringEndpointIds the ids of all the endpoints\n     * which are entering Last N\n     */\n    LAST_N_ENDPOINTS_CHANGED = 'conference.lastNEndpointsChanged',\n\n    /**\n     * A new user joined the lobby room.\n     */\n    LOBBY_USER_JOINED = 'conference.lobby.userJoined',\n\n    /**\n     * A user left the lobby room.\n     */\n    LOBBY_USER_LEFT = 'conference.lobby.userLeft',\n\n    /**\n     * A user from the lobby room has been update.\n     */\n    LOBBY_USER_UPDATED = 'conference.lobby.userUpdated',\n\n    /**\n     * Indicates that the room has been locked or unlocked.\n     */\n    LOCK_STATE_CHANGED = 'conference.lock_state_changed',\n\n    /**\n     * Indicates that the conference had changed to members only enabled/disabled.\n     * The first argument of this event is a <tt>boolean</tt> which when set to\n     * <tt>true</tt> means that the conference is running in members only mode.\n     * You may need to use Lobby if supported to ask for permissions to enter the conference.\n     */\n    MEMBERS_ONLY_CHANGED = 'conference.membersOnlyChanged',\n\n    /**\n     * New text message was received.\n     */\n    MESSAGE_RECEIVED = 'conference.messageReceived',\n\n    /**\n     * Event fired when the conference metadata is updated.\n     */\n    METADATA_UPDATED = 'conference.metadata.updated',\n\n    /**\n     * Event indicates that the current microphone used by the conference is noisy.\n     */\n    NOISY_MIC = 'conference.noisy_mic',\n\n    /**\n     * Indicates that a message from the local user or from the Prosody backend\n     * was received on the data channel.\n     */\n    NON_PARTICIPANT_MESSAGE_RECEIVED = 'conference.non_participant_message_received',\n\n    /**\n     * Event indicates that the current selected input device has no signal\n     */\n    NO_AUDIO_INPUT = 'conference.no_audio_input',\n\n    /**\n     * Indicates that the conference has switched between JVB and P2P connections.\n     * The first argument of this event is a <tt>boolean</tt> which when set to\n     * <tt>true</tt> means that the conference is running on the P2P connection.\n     */\n    P2P_STATUS = 'conference.p2pStatus',\n\n    /**\n     * Indicates that the features of the participant has been changed.\n     * TODO: there is a spelling mistake in this event name and associated constants\n     */\n    PARTCIPANT_FEATURES_CHANGED = 'conference.partcipant_features_changed',\n\n    /**\n     * Participant was kicked from the conference.\n     * @param {JitsiParticipant} the participant that initiated the kick.\n     * @param {JitsiParticipant} the participant that was kicked.\n     */\n    PARTICIPANT_KICKED = 'conference.participant_kicked',\n\n    /**\n     * Indicates that a value of a specific property of a specific participant\n     * has changed.\n     */\n    PARTICIPANT_PROPERTY_CHANGED = 'conference.participant_property_changed',\n\n    /**\n     * Indicates the state of sources attached to a given remote participant has changed.\n     */\n    PARTICIPANT_SOURCE_UPDATED = 'conference.participant_source_updated',\n\n    /**\n     * Indicates that the permissions for the local participant were updated.\n     */\n    PERMISSIONS_RECEIVED = 'conference.permissions_received',\n\n    /**\n     * Indicates that phone number changed.\n     */\n    PHONE_NUMBER_CHANGED = 'conference.phoneNumberChanged',\n\n    /**\n     * An answer for a pool was received.\n     */\n    POLL_ANSWER_RECEIVED = 'conference.pollAnswerReceived',\n\n    /**\n     * A new poll was received or a poll is loaded from the history.\n     */\n    POLL_RECEIVED = 'conference.pollReceived',\n\n    /**\n     * New private text message was received.\n     */\n    PRIVATE_MESSAGE_RECEIVED = 'conference.privateMessageReceived',\n\n    /**\n     * The conference properties changed.\n     */\n    PROPERTIES_CHANGED = 'conference.propertiesChanged',\n\n    /**\n     * New reaction was received.\n     */\n    REACTION_RECEIVED = 'conference.reactionReceived',\n\n    /**\n     * Indicates that recording state changed.\n     */\n    RECORDER_STATE_CHANGED = 'conference.recorderStateChanged',\n\n    /**\n     * Indicates that the region of the media server (jitsi-videobridge) that we\n     * are connected to changed (or was initially set).\n     */\n    SERVER_REGION_CHANGED = 'conference.server_region_changed',\n\n    /**\n     * Indicates a user has joined without audio\n     */\n    SILENT_STATUS_CHANGED = 'conference.silentStatusChanged',\n\n    /**\n     * Indicates that start muted settings changed.\n     */\n    START_MUTED_POLICY_CHANGED = 'conference.start_muted_policy_changed',\n\n    /**\n     * Indicates that subject of the conference has changed.\n     */\n    SUBJECT_CHANGED = 'conference.subjectChanged',\n\n    /**\n     * Indicates that DTMF support changed.\n     */\n    SUSPEND_DETECTED = 'conference.suspendDetected',\n\n    /**\n     * Event indicates that local user is talking while he muted himself\n     */\n    TALK_WHILE_MUTED = 'conference.talk_while_muted',\n\n    /**\n     * A new media track was added to the conference. The event provides the\n     * following parameters to its listeners:\n     *\n     * @param {JitsiTrack} track the added JitsiTrack\n     */\n    TRACK_ADDED = 'conference.trackAdded',\n\n    /**\n     * Audio levels of a media track ( attached to the conference) was changed.\n     */\n    TRACK_AUDIO_LEVEL_CHANGED = 'conference.audioLevelsChanged',\n\n    /**\n     * A media track ( attached to the conference) mute status was changed.\n     * @param {JitsiParticipant|null} the participant that initiated the mute\n     * if it is a remote mute.\n     */\n    TRACK_MUTE_CHANGED = 'conference.trackMuteChanged',\n\n    /**\n     * The media track was removed from the conference. The event provides the\n     * following parameters to its listeners:\n     *\n     * @param {JitsiTrack} track the removed JitsiTrack\n     */\n    TRACK_REMOVED = 'conference.trackRemoved',\n\n    /**\n     * The source-add for unmuting of a media track was rejected by Jicofo.\n     *\n     */\n    TRACK_UNMUTE_REJECTED = 'conference.trackUnmuteRejected',\n\n    /**\n     * Notifies for transcription status changes. The event provides the\n     * following parameters to its listeners:\n     *\n     * @param {String} status - The new status.\n     */\n    TRANSCRIPTION_STATUS_CHANGED = 'conference.transcriptionStatusChanged',\n\n    /**\n     * A new user joined the conference.\n     */\n    USER_JOINED = 'conference.userJoined',\n\n    /**\n     * A user has left the conference.\n     */\n    USER_LEFT = 'conference.userLeft',\n\n    /**\n     * User role changed.\n     */\n    USER_ROLE_CHANGED = 'conference.roleChanged',\n\n    /**\n     * User status changed.\n     */\n    USER_STATUS_CHANGED = 'conference.statusChanged',\n\n    /**\n     * Indicates that the video codec of the local video track has changed.\n     */\n    VIDEO_CODEC_CHANGED = 'conference.videoCodecChanged',\n\n    /**\n     * Indicates that video SIP GW state changed.\n     * @param {VideoSIPGWConstants} status.\n     */\n    VIDEO_SIP_GW_AVAILABILITY_CHANGED = 'conference.videoSIPGWAvailabilityChanged',\n\n    /**\n     * Indicates that video SIP GW Session state changed.\n     * @param {options} event - {\n     *     {string} address,\n     *     {VideoSIPGWConstants} oldState,\n     *     {VideoSIPGWConstants} newState,\n     *     {string} displayName\n     * }.\n     */\n    VIDEO_SIP_GW_SESSION_STATE_CHANGED = 'conference.videoSIPGWSessionStateChanged',\n\n    /**\n     * Event indicates that the permission for unmuting video has changed based on the number of video senders in the\n     * call and the video sender limit configured in Jicofo.\n     */\n    VIDEO_UNMUTE_PERMISSIONS_CHANGED = 'conference.video_unmute_permissions_changed',\n\n    /**\n     * Event indicating we have received a message from the visitors component.\n     */\n    VISITORS_MESSAGE = 'conference.visitors_message',\n\n    /**\n     * Event indicating that our request for promotion was rejected.\n     */\n    VISITORS_REJECTION = 'conference.visitors_rejection',\n\n    /**\n     * Indicates that the conference has support for visitors.\n     */\n    VISITORS_SUPPORTED_CHANGED = 'conference.visitorsSupported',\n\n    /**\n     * An event(library-private) fired when the conference switches the currently active media session.\n     * @private\n     */\n    _MEDIA_SESSION_ACTIVE_CHANGED = 'conference.media_session.active_changed',\n\n    /**\n     * An event(library-private) fired when a new media session is added to the conference.\n     * @private\n     */\n    _MEDIA_SESSION_STARTED = 'conference.media_session.started'\n}\n","import MapCache from './_MapCache.js';\nimport setCacheAdd from './_setCacheAdd.js';\nimport setCacheHas from './_setCacheHas.js';\n\n/**\n *\n * Creates an array cache object to store unique values.\n *\n * @private\n * @constructor\n * @param {Array} [values] The values to cache.\n */\nfunction SetCache(values) {\n  var index = -1,\n      length = values == null ? 0 : values.length;\n\n  this.__data__ = new MapCache;\n  while (++index < length) {\n    this.add(values[index]);\n  }\n}\n\n// Add methods to `SetCache`.\nSetCache.prototype.add = SetCache.prototype.push = setCacheAdd;\nSetCache.prototype.has = setCacheHas;\n\nexport default SetCache;\n","/** Used to stand-in for `undefined` hash values. */\nvar HASH_UNDEFINED = '__lodash_hash_undefined__';\n\n/**\n * Adds `value` to the array cache.\n *\n * @private\n * @name add\n * @memberOf SetCache\n * @alias push\n * @param {*} value The value to cache.\n * @returns {Object} Returns the cache instance.\n */\nfunction setCacheAdd(value) {\n  this.__data__.set(value, HASH_UNDEFINED);\n  return this;\n}\n\nexport default setCacheAdd;\n","/**\n * Checks if `value` is in the array cache.\n *\n * @private\n * @name has\n * @memberOf SetCache\n * @param {*} value The value to search for.\n * @returns {number} Returns `true` if `value` is found, else `false`.\n */\nfunction setCacheHas(value) {\n  return this.__data__.has(value);\n}\n\nexport default setCacheHas;\n","/**\n * A specialized version of `_.some` for arrays without support for iteratee\n * shorthands.\n *\n * @private\n * @param {Array} [array] The array to iterate over.\n * @param {Function} predicate The function invoked per iteration.\n * @returns {boolean} Returns `true` if any element passes the predicate check,\n *  else `false`.\n */\nfunction arraySome(array, predicate) {\n  var index = -1,\n      length = array == null ? 0 : array.length;\n\n  while (++index < length) {\n    if (predicate(array[index], index, array)) {\n      return true;\n    }\n  }\n  return false;\n}\n\nexport default arraySome;\n","import SetCache from './_SetCache.js';\nimport arraySome from './_arraySome.js';\nimport cacheHas from './_cacheHas.js';\n\n/** Used to compose bitmasks for value comparisons. */\nvar COMPARE_PARTIAL_FLAG = 1,\n    COMPARE_UNORDERED_FLAG = 2;\n\n/**\n * A specialized version of `baseIsEqualDeep` for arrays with support for\n * partial deep comparisons.\n *\n * @private\n * @param {Array} array The array to compare.\n * @param {Array} other The other array to compare.\n * @param {number} bitmask The bitmask flags. See `baseIsEqual` for more details.\n * @param {Function} customizer The function to customize comparisons.\n * @param {Function} equalFunc The function to determine equivalents of values.\n * @param {Object} stack Tracks traversed `array` and `other` objects.\n * @returns {boolean} Returns `true` if the arrays are equivalent, else `false`.\n */\nfunction equalArrays(array, other, bitmask, customizer, equalFunc, stack) {\n  var isPartial = bitmask & COMPARE_PARTIAL_FLAG,\n      arrLength = array.length,\n      othLength = other.length;\n\n  if (arrLength != othLength && !(isPartial && othLength > arrLength)) {\n    return false;\n  }\n  // Check that cyclic values are equal.\n  var arrStacked = stack.get(array);\n  var othStacked = stack.get(other);\n  if (arrStacked && othStacked) {\n    return arrStacked == other && othStacked == array;\n  }\n  var index = -1,\n      result = true,\n      seen = (bitmask & COMPARE_UNORDERED_FLAG) ? new SetCache : undefined;\n\n  stack.set(array, other);\n  stack.set(other, array);\n\n  // Ignore non-index properties.\n  while (++index < arrLength) {\n    var arrValue = array[index],\n        othValue = other[index];\n\n    if (customizer) {\n      var compared = isPartial\n        ? customizer(othValue, arrValue, index, other, array, stack)\n        : customizer(arrValue, othValue, index, array, other, stack);\n    }\n    if (compared !== undefined) {\n      if (compared) {\n        continue;\n      }\n      result = false;\n      break;\n    }\n    // Recursively compare arrays (susceptible to call stack limits).\n    if (seen) {\n      if (!arraySome(other, function(othValue, othIndex) {\n            if (!cacheHas(seen, othIndex) &&\n                (arrValue === othValue || equalFunc(arrValue, othValue, bitmask, customizer, stack))) {\n              return seen.push(othIndex);\n            }\n          })) {\n        result = false;\n        break;\n      }\n    } else if (!(\n          arrValue === othValue ||\n            equalFunc(arrValue, othValue, bitmask, customizer, stack)\n        )) {\n      result = false;\n      break;\n    }\n  }\n  stack['delete'](array);\n  stack['delete'](other);\n  return result;\n}\n\nexport default equalArrays;\n","/**\n * Checks if a `cache` value for `key` exists.\n *\n * @private\n * @param {Object} cache The cache to query.\n * @param {string} key The key of the entry to check.\n * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.\n */\nfunction cacheHas(cache, key) {\n  return cache.has(key);\n}\n\nexport default cacheHas;\n","/**\n * Converts `map` to its key-value pairs.\n *\n * @private\n * @param {Object} map The map to convert.\n * @returns {Array} Returns the key-value pairs.\n */\nfunction mapToArray(map) {\n  var index = -1,\n      result = Array(map.size);\n\n  map.forEach(function(value, key) {\n    result[++index] = [key, value];\n  });\n  return result;\n}\n\nexport default mapToArray;\n","/**\n * Converts `set` to an array of its values.\n *\n * @private\n * @param {Object} set The set to convert.\n * @returns {Array} Returns the values.\n */\nfunction setToArray(set) {\n  var index = -1,\n      result = Array(set.size);\n\n  set.forEach(function(value) {\n    result[++index] = value;\n  });\n  return result;\n}\n\nexport default setToArray;\n","import Symbol from './_Symbol.js';\nimport Uint8Array from './_Uint8Array.js';\nimport eq from './eq.js';\nimport equalArrays from './_equalArrays.js';\nimport mapToArray from './_mapToArray.js';\nimport setToArray from './_setToArray.js';\n\n/** Used to compose bitmasks for value comparisons. */\nvar COMPARE_PARTIAL_FLAG = 1,\n    COMPARE_UNORDERED_FLAG = 2;\n\n/** `Object#toString` result references. */\nvar boolTag = '[object Boolean]',\n    dateTag = '[object Date]',\n    errorTag = '[object Error]',\n    mapTag = '[object Map]',\n    numberTag = '[object Number]',\n    regexpTag = '[object RegExp]',\n    setTag = '[object Set]',\n    stringTag = '[object String]',\n    symbolTag = '[object Symbol]';\n\nvar arrayBufferTag = '[object ArrayBuffer]',\n    dataViewTag = '[object DataView]';\n\n/** Used to convert symbols to primitives and strings. */\nvar symbolProto = Symbol ? Symbol.prototype : undefined,\n    symbolValueOf = symbolProto ? symbolProto.valueOf : undefined;\n\n/**\n * A specialized version of `baseIsEqualDeep` for comparing objects of\n * the same `toStringTag`.\n *\n * **Note:** This function only supports comparing values with tags of\n * `Boolean`, `Date`, `Error`, `Number`, `RegExp`, or `String`.\n *\n * @private\n * @param {Object} object The object to compare.\n * @param {Object} other The other object to compare.\n * @param {string} tag The `toStringTag` of the objects to compare.\n * @param {number} bitmask The bitmask flags. See `baseIsEqual` for more details.\n * @param {Function} customizer The function to customize comparisons.\n * @param {Function} equalFunc The function to determine equivalents of values.\n * @param {Object} stack Tracks traversed `object` and `other` objects.\n * @returns {boolean} Returns `true` if the objects are equivalent, else `false`.\n */\nfunction equalByTag(object, other, tag, bitmask, customizer, equalFunc, stack) {\n  switch (tag) {\n    case dataViewTag:\n      if ((object.byteLength != other.byteLength) ||\n          (object.byteOffset != other.byteOffset)) {\n        return false;\n      }\n      object = object.buffer;\n      other = other.buffer;\n\n    case arrayBufferTag:\n      if ((object.byteLength != other.byteLength) ||\n          !equalFunc(new Uint8Array(object), new Uint8Array(other))) {\n        return false;\n      }\n      return true;\n\n    case boolTag:\n    case dateTag:\n    case numberTag:\n      // Coerce booleans to `1` or `0` and dates to milliseconds.\n      // Invalid dates are coerced to `NaN`.\n      return eq(+object, +other);\n\n    case errorTag:\n      return object.name == other.name && object.message == other.message;\n\n    case regexpTag:\n    case stringTag:\n      // Coerce regexes to strings and treat strings, primitives and objects,\n      // as equal. See http://www.ecma-international.org/ecma-262/7.0/#sec-regexp.prototype.tostring\n      // for more details.\n      return object == (other + '');\n\n    case mapTag:\n      var convert = mapToArray;\n\n    case setTag:\n      var isPartial = bitmask & COMPARE_PARTIAL_FLAG;\n      convert || (convert = setToArray);\n\n      if (object.size != other.size && !isPartial) {\n        return false;\n      }\n      // Assume cyclic values are equal.\n      var stacked = stack.get(object);\n      if (stacked) {\n        return stacked == other;\n      }\n      bitmask |= COMPARE_UNORDERED_FLAG;\n\n      // Recursively compare objects (susceptible to call stack limits).\n      stack.set(object, other);\n      var result = equalArrays(convert(object), convert(other), bitmask, customizer, equalFunc, stack);\n      stack['delete'](object);\n      return result;\n\n    case symbolTag:\n      if (symbolValueOf) {\n        return symbolValueOf.call(object) == symbolValueOf.call(other);\n      }\n  }\n  return false;\n}\n\nexport default equalByTag;\n","/**\n * Appends the elements of `values` to `array`.\n *\n * @private\n * @param {Array} array The array to modify.\n * @param {Array} values The values to append.\n * @returns {Array} Returns `array`.\n */\nfunction arrayPush(array, values) {\n  var index = -1,\n      length = values.length,\n      offset = array.length;\n\n  while (++index < length) {\n    array[offset + index] = values[index];\n  }\n  return array;\n}\n\nexport default arrayPush;\n","import arrayPush from './_arrayPush.js';\nimport isArray from './isArray.js';\n\n/**\n * The base implementation of `getAllKeys` and `getAllKeysIn` which uses\n * `keysFunc` and `symbolsFunc` to get the enumerable property names and\n * symbols of `object`.\n *\n * @private\n * @param {Object} object The object to query.\n * @param {Function} keysFunc The function to get the keys of `object`.\n * @param {Function} symbolsFunc The function to get the symbols of `object`.\n * @returns {Array} Returns the array of property names and symbols.\n */\nfunction baseGetAllKeys(object, keysFunc, symbolsFunc) {\n  var result = keysFunc(object);\n  return isArray(object) ? result : arrayPush(result, symbolsFunc(object));\n}\n\nexport default baseGetAllKeys;\n","/**\n * This method returns a new empty array.\n *\n * @static\n * @memberOf _\n * @since 4.13.0\n * @category Util\n * @returns {Array} Returns the new empty array.\n * @example\n *\n * var arrays = _.times(2, _.stubArray);\n *\n * console.log(arrays);\n * // => [[], []]\n *\n * console.log(arrays[0] === arrays[1]);\n * // => false\n */\nfunction stubArray() {\n  return [];\n}\n\nexport default stubArray;\n","import arrayFilter from './_arrayFilter.js';\nimport stubArray from './stubArray.js';\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Built-in value references. */\nvar propertyIsEnumerable = objectProto.propertyIsEnumerable;\n\n/* Built-in method references for those with the same name as other `lodash` methods. */\nvar nativeGetSymbols = Object.getOwnPropertySymbols;\n\n/**\n * Creates an array of the own enumerable symbols of `object`.\n *\n * @private\n * @param {Object} object The object to query.\n * @returns {Array} Returns the array of symbols.\n */\nvar getSymbols = !nativeGetSymbols ? stubArray : function(object) {\n  if (object == null) {\n    return [];\n  }\n  object = Object(object);\n  return arrayFilter(nativeGetSymbols(object), function(symbol) {\n    return propertyIsEnumerable.call(object, symbol);\n  });\n};\n\nexport default getSymbols;\n","/**\n * A specialized version of `_.filter` for arrays without support for\n * iteratee shorthands.\n *\n * @private\n * @param {Array} [array] The array to iterate over.\n * @param {Function} predicate The function invoked per iteration.\n * @returns {Array} Returns the new filtered array.\n */\nfunction arrayFilter(array, predicate) {\n  var index = -1,\n      length = array == null ? 0 : array.length,\n      resIndex = 0,\n      result = [];\n\n  while (++index < length) {\n    var value = array[index];\n    if (predicate(value, index, array)) {\n      result[resIndex++] = value;\n    }\n  }\n  return result;\n}\n\nexport default arrayFilter;\n","import overArg from './_overArg.js';\n\n/* Built-in method references for those with the same name as other `lodash` methods. */\nvar nativeKeys = overArg(Object.keys, Object);\n\nexport default nativeKeys;\n","import isPrototype from './_isPrototype.js';\nimport nativeKeys from './_nativeKeys.js';\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * The base implementation of `_.keys` which doesn't treat sparse arrays as dense.\n *\n * @private\n * @param {Object} object The object to query.\n * @returns {Array} Returns the array of property names.\n */\nfunction baseKeys(object) {\n  if (!isPrototype(object)) {\n    return nativeKeys(object);\n  }\n  var result = [];\n  for (var key in Object(object)) {\n    if (hasOwnProperty.call(object, key) && key != 'constructor') {\n      result.push(key);\n    }\n  }\n  return result;\n}\n\nexport default baseKeys;\n","import arrayLikeKeys from './_arrayLikeKeys.js';\nimport baseKeys from './_baseKeys.js';\nimport isArrayLike from './isArrayLike.js';\n\n/**\n * Creates an array of the own enumerable property names of `object`.\n *\n * **Note:** Non-object values are coerced to objects. See the\n * [ES spec](http://ecma-international.org/ecma-262/7.0/#sec-object.keys)\n * for more details.\n *\n * @static\n * @since 0.1.0\n * @memberOf _\n * @category Object\n * @param {Object} object The object to query.\n * @returns {Array} Returns the array of property names.\n * @example\n *\n * function Foo() {\n *   this.a = 1;\n *   this.b = 2;\n * }\n *\n * Foo.prototype.c = 3;\n *\n * _.keys(new Foo);\n * // => ['a', 'b'] (iteration order is not guaranteed)\n *\n * _.keys('hi');\n * // => ['0', '1']\n */\nfunction keys(object) {\n  return isArrayLike(object) ? arrayLikeKeys(object) : baseKeys(object);\n}\n\nexport default keys;\n","import baseGetAllKeys from './_baseGetAllKeys.js';\nimport getSymbols from './_getSymbols.js';\nimport keys from './keys.js';\n\n/**\n * Creates an array of own enumerable property names and symbols of `object`.\n *\n * @private\n * @param {Object} object The object to query.\n * @returns {Array} Returns the array of property names and symbols.\n */\nfunction getAllKeys(object) {\n  return baseGetAllKeys(object, keys, getSymbols);\n}\n\nexport default getAllKeys;\n","import getAllKeys from './_getAllKeys.js';\n\n/** Used to compose bitmasks for value comparisons. */\nvar COMPARE_PARTIAL_FLAG = 1;\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * A specialized version of `baseIsEqualDeep` for objects with support for\n * partial deep comparisons.\n *\n * @private\n * @param {Object} object The object to compare.\n * @param {Object} other The other object to compare.\n * @param {number} bitmask The bitmask flags. See `baseIsEqual` for more details.\n * @param {Function} customizer The function to customize comparisons.\n * @param {Function} equalFunc The function to determine equivalents of values.\n * @param {Object} stack Tracks traversed `object` and `other` objects.\n * @returns {boolean} Returns `true` if the objects are equivalent, else `false`.\n */\nfunction equalObjects(object, other, bitmask, customizer, equalFunc, stack) {\n  var isPartial = bitmask & COMPARE_PARTIAL_FLAG,\n      objProps = getAllKeys(object),\n      objLength = objProps.length,\n      othProps = getAllKeys(other),\n      othLength = othProps.length;\n\n  if (objLength != othLength && !isPartial) {\n    return false;\n  }\n  var index = objLength;\n  while (index--) {\n    var key = objProps[index];\n    if (!(isPartial ? key in other : hasOwnProperty.call(other, key))) {\n      return false;\n    }\n  }\n  // Check that cyclic values are equal.\n  var objStacked = stack.get(object);\n  var othStacked = stack.get(other);\n  if (objStacked && othStacked) {\n    return objStacked == other && othStacked == object;\n  }\n  var result = true;\n  stack.set(object, other);\n  stack.set(other, object);\n\n  var skipCtor = isPartial;\n  while (++index < objLength) {\n    key = objProps[index];\n    var objValue = object[key],\n        othValue = other[key];\n\n    if (customizer) {\n      var compared = isPartial\n        ? customizer(othValue, objValue, key, other, object, stack)\n        : customizer(objValue, othValue, key, object, other, stack);\n    }\n    // Recursively compare objects (susceptible to call stack limits).\n    if (!(compared === undefined\n          ? (objValue === othValue || equalFunc(objValue, othValue, bitmask, customizer, stack))\n          : compared\n        )) {\n      result = false;\n      break;\n    }\n    skipCtor || (skipCtor = key == 'constructor');\n  }\n  if (result && !skipCtor) {\n    var objCtor = object.constructor,\n        othCtor = other.constructor;\n\n    // Non `Object` object instances with different constructors are not equal.\n    if (objCtor != othCtor &&\n        ('constructor' in object && 'constructor' in other) &&\n        !(typeof objCtor == 'function' && objCtor instanceof objCtor &&\n          typeof othCtor == 'function' && othCtor instanceof othCtor)) {\n      result = false;\n    }\n  }\n  stack['delete'](object);\n  stack['delete'](other);\n  return result;\n}\n\nexport default equalObjects;\n","import getNative from './_getNative.js';\nimport root from './_root.js';\n\n/* Built-in method references that are verified to be native. */\nvar DataView = getNative(root, 'DataView');\n\nexport default DataView;\n","import getNative from './_getNative.js';\nimport root from './_root.js';\n\n/* Built-in method references that are verified to be native. */\nvar Promise = getNative(root, 'Promise');\n\nexport default Promise;\n","import getNative from './_getNative.js';\nimport root from './_root.js';\n\n/* Built-in method references that are verified to be native. */\nvar Set = getNative(root, 'Set');\n\nexport default Set;\n","import getNative from './_getNative.js';\nimport root from './_root.js';\n\n/* Built-in method references that are verified to be native. */\nvar WeakMap = getNative(root, 'WeakMap');\n\nexport default WeakMap;\n","import DataView from './_DataView.js';\nimport Map from './_Map.js';\nimport Promise from './_Promise.js';\nimport Set from './_Set.js';\nimport WeakMap from './_WeakMap.js';\nimport baseGetTag from './_baseGetTag.js';\nimport toSource from './_toSource.js';\n\n/** `Object#toString` result references. */\nvar mapTag = '[object Map]',\n    objectTag = '[object Object]',\n    promiseTag = '[object Promise]',\n    setTag = '[object Set]',\n    weakMapTag = '[object WeakMap]';\n\nvar dataViewTag = '[object DataView]';\n\n/** Used to detect maps, sets, and weakmaps. */\nvar dataViewCtorString = toSource(DataView),\n    mapCtorString = toSource(Map),\n    promiseCtorString = toSource(Promise),\n    setCtorString = toSource(Set),\n    weakMapCtorString = toSource(WeakMap);\n\n/**\n * Gets the `toStringTag` of `value`.\n *\n * @private\n * @param {*} value The value to query.\n * @returns {string} Returns the `toStringTag`.\n */\nvar getTag = baseGetTag;\n\n// Fallback for data views, maps, sets, and weak maps in IE 11 and promises in Node.js < 6.\nif ((DataView && getTag(new DataView(new ArrayBuffer(1))) != dataViewTag) ||\n    (Map && getTag(new Map) != mapTag) ||\n    (Promise && getTag(Promise.resolve()) != promiseTag) ||\n    (Set && getTag(new Set) != setTag) ||\n    (WeakMap && getTag(new WeakMap) != weakMapTag)) {\n  getTag = function(value) {\n    var result = baseGetTag(value),\n        Ctor = result == objectTag ? value.constructor : undefined,\n        ctorString = Ctor ? toSource(Ctor) : '';\n\n    if (ctorString) {\n      switch (ctorString) {\n        case dataViewCtorString: return dataViewTag;\n        case mapCtorString: return mapTag;\n        case promiseCtorString: return promiseTag;\n        case setCtorString: return setTag;\n        case weakMapCtorString: return weakMapTag;\n      }\n    }\n    return result;\n  };\n}\n\nexport default getTag;\n","import Stack from './_Stack.js';\nimport equalArrays from './_equalArrays.js';\nimport equalByTag from './_equalByTag.js';\nimport equalObjects from './_equalObjects.js';\nimport getTag from './_getTag.js';\nimport isArray from './isArray.js';\nimport isBuffer from './isBuffer.js';\nimport isTypedArray from './isTypedArray.js';\n\n/** Used to compose bitmasks for value comparisons. */\nvar COMPARE_PARTIAL_FLAG = 1;\n\n/** `Object#toString` result references. */\nvar argsTag = '[object Arguments]',\n    arrayTag = '[object Array]',\n    objectTag = '[object Object]';\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * A specialized version of `baseIsEqual` for arrays and objects which performs\n * deep comparisons and tracks traversed objects enabling objects with circular\n * references to be compared.\n *\n * @private\n * @param {Object} object The object to compare.\n * @param {Object} other The other object to compare.\n * @param {number} bitmask The bitmask flags. See `baseIsEqual` for more details.\n * @param {Function} customizer The function to customize comparisons.\n * @param {Function} equalFunc The function to determine equivalents of values.\n * @param {Object} [stack] Tracks traversed `object` and `other` objects.\n * @returns {boolean} Returns `true` if the objects are equivalent, else `false`.\n */\nfunction baseIsEqualDeep(object, other, bitmask, customizer, equalFunc, stack) {\n  var objIsArr = isArray(object),\n      othIsArr = isArray(other),\n      objTag = objIsArr ? arrayTag : getTag(object),\n      othTag = othIsArr ? arrayTag : getTag(other);\n\n  objTag = objTag == argsTag ? objectTag : objTag;\n  othTag = othTag == argsTag ? objectTag : othTag;\n\n  var objIsObj = objTag == objectTag,\n      othIsObj = othTag == objectTag,\n      isSameTag = objTag == othTag;\n\n  if (isSameTag && isBuffer(object)) {\n    if (!isBuffer(other)) {\n      return false;\n    }\n    objIsArr = true;\n    objIsObj = false;\n  }\n  if (isSameTag && !objIsObj) {\n    stack || (stack = new Stack);\n    return (objIsArr || isTypedArray(object))\n      ? equalArrays(object, other, bitmask, customizer, equalFunc, stack)\n      : equalByTag(object, other, objTag, bitmask, customizer, equalFunc, stack);\n  }\n  if (!(bitmask & COMPARE_PARTIAL_FLAG)) {\n    var objIsWrapped = objIsObj && hasOwnProperty.call(object, '__wrapped__'),\n        othIsWrapped = othIsObj && hasOwnProperty.call(other, '__wrapped__');\n\n    if (objIsWrapped || othIsWrapped) {\n      var objUnwrapped = objIsWrapped ? object.value() : object,\n          othUnwrapped = othIsWrapped ? other.value() : other;\n\n      stack || (stack = new Stack);\n      return equalFunc(objUnwrapped, othUnwrapped, bitmask, customizer, stack);\n    }\n  }\n  if (!isSameTag) {\n    return false;\n  }\n  stack || (stack = new Stack);\n  return equalObjects(object, other, bitmask, customizer, equalFunc, stack);\n}\n\nexport default baseIsEqualDeep;\n","import baseIsEqualDeep from './_baseIsEqualDeep.js';\nimport isObjectLike from './isObjectLike.js';\n\n/**\n * The base implementation of `_.isEqual` which supports partial comparisons\n * and tracks traversed objects.\n *\n * @private\n * @param {*} value The value to compare.\n * @param {*} other The other value to compare.\n * @param {boolean} bitmask The bitmask flags.\n *  1 - Unordered comparison\n *  2 - Partial comparison\n * @param {Function} [customizer] The function to customize comparisons.\n * @param {Object} [stack] Tracks traversed `value` and `other` objects.\n * @returns {boolean} Returns `true` if the values are equivalent, else `false`.\n */\nfunction baseIsEqual(value, other, bitmask, customizer, stack) {\n  if (value === other) {\n    return true;\n  }\n  if (value == null || other == null || (!isObjectLike(value) && !isObjectLike(other))) {\n    return value !== value && other !== other;\n  }\n  return baseIsEqualDeep(value, other, bitmask, customizer, baseIsEqual, stack);\n}\n\nexport default baseIsEqual;\n","import baseIsEqual from './_baseIsEqual.js';\n\n/**\n * Performs a deep comparison between two values to determine if they are\n * equivalent.\n *\n * **Note:** This method supports comparing arrays, array buffers, booleans,\n * date objects, error objects, maps, numbers, `Object` objects, regexes,\n * sets, strings, symbols, and typed arrays. `Object` objects are compared\n * by their own, not inherited, enumerable properties. Functions and DOM\n * nodes are compared by strict equality, i.e. `===`.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to compare.\n * @param {*} other The other value to compare.\n * @returns {boolean} Returns `true` if the values are equivalent, else `false`.\n * @example\n *\n * var object = { 'a': 1 };\n * var other = { 'a': 1 };\n *\n * _.isEqual(object, other);\n * // => true\n *\n * object === other;\n * // => false\n */\nfunction isEqual(value, other) {\n  return baseIsEqual(value, other);\n}\n\nexport default isEqual;\n","export enum JitsiTrackEvents {\n\n    /**\n     * The media track was removed to the conference.\n     */\n    LOCAL_TRACK_STOPPED = 'track.stopped',\n\n    /**\n     * Indicates that the local audio track is not receiving any audio input from\n     * the microphone that is currently selected.\n     */\n    NO_AUDIO_INPUT = 'track.no_audio_input',\n\n    /**\n     * Indicates that the track is not receiving any data even though we expect it\n     * to receive data (i.e. the stream is not stopped).\n     */\n    NO_DATA_FROM_SOURCE = 'track.no_data_from_source',\n\n    /**\n     * Audio levels of a this track was changed.\n     * The first argument is a number with audio level value in range [0, 1].\n     * The second argument is a <tt>TraceablePeerConnection</tt> which is the peer\n     * connection which measured the audio level (one audio track can be added\n     * to multiple peer connection at the same time). This argument is optional for\n     * local tracks for which we can measure audio level without the peer\n     * connection (the value will be <tt>undefined</tt>).\n     *\n     * NOTE The second argument should be treated as library internal and can be\n     * removed at any time.\n     */\n    TRACK_AUDIO_LEVEL_CHANGED = 'track.audioLevelsChanged',\n\n    /**\n     * The audio output of the track was changed.\n     */\n    TRACK_AUDIO_OUTPUT_CHANGED = 'track.audioOutputChanged',\n\n    /**\n     * A media track mute status was changed.\n     */\n    TRACK_MUTE_CHANGED = 'track.trackMuteChanged',\n\n    /**\n     * Indicates that a new owner has been assigned to a remote track when SSRC rewriting is enabled.\n     */\n    TRACK_OWNER_SET = 'track.owner_set',\n\n    /**\n     * Event fired whenever video track's streaming changes.\n     * First argument is the sourceName of the track and the second is a string indicating if the connection is\n     * currently\n     * - active - the connection is active.\n     * - inactive - the connection is inactive, was intentionally interrupted by the bridge because of low BWE or\n     *   because of the endpoint falling out of last N.\n     * - interrupted - a network problem occurred.\n     * - restoring - the connection was inactive and is restoring now.\n     *\n     * The current status value can be obtained by calling JitsiRemoteTrack.getTrackStreamingStatus().\n     */\n    TRACK_STREAMING_STATUS_CHANGED = 'track.streaming_status_changed',\n\n    /**\n     * The video type(\"camera\" or \"desktop\") of the track was changed.\n     */\n    TRACK_VIDEOTYPE_CHANGED = 'track.videoTypeChanged'\n}\n","export var Browser;\n(function (Browser) {\n    Browser[\"CHROME\"] = \"chrome\";\n    Browser[\"FIREFOX\"] = \"firefox\";\n    Browser[\"SAFARI\"] = \"safari\";\n    Browser[\"ELECTRON\"] = \"electron\";\n    Browser[\"REACT_NATIVE\"] = \"react-native\";\n    Browser[\"WEBKIT_BROWSER\"] = \"webkit-browser\";\n})(Browser || (Browser = {}));\n/**\n * Maps the names of the browsers from ua-parser to the internal names defined in\n * ./browsers.js\n */\nexport const PARSER_TO_JITSI_NAME = {\n    'Chrome': Browser.CHROME,\n    'Firefox': Browser.FIREFOX,\n    'Safari': Browser.SAFARI,\n    'Electron': Browser.ELECTRON\n};\nexport var Engine;\n(function (Engine) {\n    Engine[\"BLINK\"] = \"blink\";\n    Engine[\"WEBKIT\"] = \"webkit\";\n    Engine[\"GECKO\"] = \"gecko\";\n})(Engine || (Engine = {}));\nexport const ENGINES = {\n    'Blink': Engine.BLINK,\n    'WebKit': Engine.WEBKIT,\n    'Gecko': Engine.GECKO\n};\n","import { UAParser } from 'ua-parser-js';\nimport { Browser, Engine, ENGINES, PARSER_TO_JITSI_NAME, } from './constants';\n/**\n * Detects React Native environment.\n * @returns {Object|undefined} - The name (REACT_NATIVE) and version.\n */\nfunction _detectReactNative() {\n    const match = navigator.userAgent.match(/\\b(react[ \\t_-]*native)(?:\\/(\\S+))?/i);\n    let version;\n    // If we're remote debugging a React Native app, it may be treated as Chrome. Check navigator.product as well and\n    // always return some version even if we can't get the real one.\n    if (match || navigator.product === 'ReactNative') {\n        let name = Browser.REACT_NATIVE;\n        version = 'unknown';\n        if (match && match.length > 2) {\n            name = match[1];\n            version = match[2];\n        }\n        return {\n            name,\n            version\n        };\n    }\n}\n/**\n * Returns the Jitsi recognized name for the browser\n *\n * @param {Object} [browserInfo] - Information about the browser.\n * @param {string} browserInfo.name - The name of the browser.\n * @param {string} browserInfo.version - The version of the browser.\n * @param {string} browserInfo.engine - The engine of the browser.\n * @param {string} browserInfo.engineVersion - The version of the engine of the browser.\n * @param {string} browserInfo.os - The os of the browser.\n * @param {string} browserInfo.osVersion - The os version of the browser.\n * @returns\n */\nfunction _getJitsiBrowserInfo(browserInfo) {\n    const { engine, engineVersion, name, version } = browserInfo;\n    return {\n        name: PARSER_TO_JITSI_NAME[name],\n        version,\n        engine: engine ? ENGINES[engine] : undefined,\n        engineVersion: engineVersion\n    };\n}\n/**\n * Returns information about the current browser.\n * @param {Object} - The parser instance.\n * @returns {Object} - The name and version of the browser.\n */\nfunction _detect(parser) {\n    const reactNativeInfo = _detectReactNative();\n    if (reactNativeInfo) {\n        return reactNativeInfo;\n    }\n    const { name, version } = parser.getBrowser();\n    const { name: engine, version: engineVersion } = parser.getEngine();\n    return _getJitsiBrowserInfo({\n        name,\n        version,\n        engine,\n        engineVersion\n    });\n}\n/**\n * Implements browser detection.\n */\nexport default class BrowserDetection {\n    /**\n     * Creates new BrowserDetection instance.\n     *\n     * @param {Object} [browserInfo] - Information about the browser.\n     * @param {string} browserInfo.name - The name of the browser.\n     * @param {string} browserInfo.version - The version of the browser.\n     * @param {string} browserInfo.engine - The engine of the browser.\n     * @param {string} browserInfo.engineVersion - The version of the engine of the browser.\n     * @param {string} browserInfo.os - The os of the browser.\n     * @param {string} browserInfo.osVersion - The os version of the browser.\n     */\n    constructor(browserInfo) {\n        this._parser = new UAParser(navigator.userAgent);\n        const { name, version, engine, engineVersion } = browserInfo ? _getJitsiBrowserInfo(browserInfo) : _detect(this._parser);\n        this._name = name;\n        this._version = version;\n        this._engine = engine;\n        this._engineVersion = engineVersion;\n    }\n    /**\n     * Checks if current browser is Chrome.\n     * @returns {boolean}\n     */\n    isChrome() {\n        // for backward compatibility returns true for all Chromium browsers\n        return this._name === Browser.CHROME || this._engine === Engine.BLINK;\n    }\n    /**\n     * Checks if current browser is Firefox.\n     * @returns {boolean}\n     */\n    isFirefox() {\n        return this._engine === Engine.GECKO;\n    }\n    /**\n     * Checks if current browser is Safari.\n     * @returns {boolean}\n     */\n    isSafari() {\n        return this._name === Browser.SAFARI;\n    }\n    /**\n     * Checks if current environment is Electron.\n     * @returns {boolean}\n     */\n    isElectron() {\n        return this._name === Browser.ELECTRON;\n    }\n    /**\n     * Checks if current environment is React Native.\n     * @returns {boolean}\n     */\n    isReactNative() {\n        return this._name === Browser.REACT_NATIVE;\n    }\n    /**\n     * Checks if current browser is based on chromium.\n     * @returns {boolean}\n     */\n    isChromiumBased() {\n        return this._engine === Engine.BLINK;\n    }\n    /**\n     * Checks if current browser is based on webkit.\n     * @returns {boolean}\n     */\n    isWebKitBased() {\n        return this._engine === Engine.WEBKIT;\n    }\n    /**\n     * Gets current browser name.\n     * @returns {string}\n     */\n    getName() {\n        if (this._name) {\n            return this._name;\n        }\n        return this._parser.getBrowser().name;\n    }\n    /**\n     * Returns the version of the current browser.\n     * @returns {string}\n     */\n    getVersion() {\n        if (this._version) {\n            return this._version;\n        }\n        return this._parser.getBrowser().version;\n    }\n    /**\n     * Gets current engine name of the browser.\n     * @returns {string}\n     */\n    getEngine() {\n        return this._engine;\n    }\n    /**\n     * Returns the engine version of the current browser.\n     * @returns the engine version\n     */\n    getEngineVersion() {\n        return this._engineVersion;\n    }\n    /**\n     * Returns the operating system.\n     */\n    getOS() {\n        return this._parser.getOS().name;\n    }\n    /**\n     * Return the os version.\n     */\n    getOSVersion() {\n        return this._parser.getOS().version;\n    }\n    /**\n     * Compares the passed version with the current browser version.\n     *\n     * @param {number} version - The version to compare with.\n     * @returns {boolean} - Returns true if the current version is greater than the passed version and false otherwise.\n     */\n    isVersionGreaterThan(version) {\n        if (this._version) {\n            return parseInt(this._version, 10) > version;\n        }\n        return false;\n    }\n    /**\n     * Compares the passed version with the current browser version.\n     *\n     * @param {number} version - The version to compare with.\n     * @returns {boolean} - Returns true if the current version is lower than the passed version and false otherwise.\n     */\n    isVersionLessThan(version) {\n        if (this._version) {\n            return parseInt(this._version, 10) < version;\n        }\n        return false;\n    }\n    /**\n     * Compares the passed version with the current browser version.\n     *\n     * @param {number} version - The version to compare with.\n     * @returns {boolean} - Returns true if the current version is equal to the passed version and false otherwise.\n     */\n    isVersionEqualTo(version) {\n        if (this._version) {\n            return parseInt(this._version, 10) === version;\n        }\n        return false;\n    }\n    /**\n     * Compares the passed version with the current engine version.\n     *\n     * @param {number} version - The version to compare with.\n     * @returns {boolean} - Returns true if the current version is greater than the passed version and false otherwise.\n     */\n    isEngineVersionGreaterThan(version) {\n        if (this._engineVersion) {\n            return parseInt(this._engineVersion, 10) > version;\n        }\n        return false;\n    }\n    /**\n     * Compares the passed version with the current engine version.\n     *\n     * @param {number} version - The version to compare with.\n     * @returns {boolean} - Returns true if the current version is lower than the passed version and false otherwise.\n     */\n    isEngineVersionLessThan(version) {\n        if (this._engineVersion) {\n            return parseInt(this._engineVersion, 10) < version;\n        }\n        return false;\n    }\n    /**\n     * Compares the passed version with the current engine version.\n     *\n     * @param {number} version - The version to compare with.\n     * @returns {boolean} - Returns true if the current version is equal to the passed version and false otherwise.\n     */\n    isEngineVersionEqualTo(version) {\n        if (this._engineVersion) {\n            return parseInt(this._engineVersion, 10) === version;\n        }\n        return false;\n    }\n}\n","\nexport const PC_STATE_CONNECTED = 'connected';\n\nexport const PC_STATE_DISCONNECTED = 'disconnected';\n\nexport const PC_STATE_FAILED = 'failed';\n\nexport const PC_CON_STATE_CHANGE = 'connectionstatechange';\n\nexport const PC_ICE_CON_STATE_CHANGE = 'iceconnectionstatechange';\n","/* eslint-disable prefer-rest-params */\n/* eslint-disable no-param-reassign */\nimport { BrowserDetection } from '@jitsi/js-utils/browser-detection';\nimport { getLogger } from '@jitsi/logger';\n\nconst logger = getLogger('rtctstats');\n\nimport { PC_CON_STATE_CHANGE, PC_ICE_CON_STATE_CHANGE } from './events';\n\n/**\n * transforms a maplike to an object. Mostly for getStats + JSON.parse(JSON.stringify())\n * @param {*} m\n */\nfunction map2obj(m) {\n    if (!m.entries) {\n        return m;\n    }\n    const o = {};\n\n    m.forEach((v, k) => {\n        o[k] = v;\n    });\n\n    return o;\n}\n\n/**\n *\n * @param {*} pc\n * @param {*} response\n */\nfunction mangleChromeStats(pc, response) {\n    const standardReport = {};\n    const reports = response.result();\n\n    reports.forEach(report => {\n        const standardStats = {\n            id: report.id,\n            timestamp: report.timestamp.getTime(),\n            type: report.type\n        };\n\n        report.names().forEach(name => {\n            standardStats[name] = report.stat(name);\n        });\n        standardReport[standardStats.id] = standardStats;\n    });\n\n    return standardReport;\n}\n\n/**\n * Apply a delta compression to the stats report. Reduces size by ~90%.\n * To reduce further, report keys could be compressed.\n * @param {*} oldStats\n * @param {*} newStats\n */\nfunction deltaCompression(oldStats, newStatsArg) {\n    const newStats = JSON.parse(JSON.stringify(newStatsArg));\n\n    // Go through each report of the newly fetches stats entry and compare it with the previous one (old)\n    // If a field value (e.g. ssrc.id) from the new report matches the corresponding one from the old report\n    // delete it.\n    // The new stats entry will be returned thus any reports from the old stats entry that are no longer found\n    // in the new one will me considered as removed.\n    // stats entries are expected to have the following format:\n    // {reportName1: {\n    //    key1: value,\n    //    key2: value2\n    // },\n    // reportName2: {\n    //    key1: value,\n    //    key2, value2,\n    // }}\n\n    Object.keys(newStats).forEach(id => {\n        const report = newStats[id];\n\n        delete report.id;\n        if (!oldStats[id]) {\n            return;\n        }\n        Object.keys(report).forEach(name => {\n            if (report[name] === oldStats[id][name]) {\n                delete newStats[id][name];\n            }\n        });\n    });\n\n    // TODO Snippet bellow adds the last timestamp as a stats level fields, probably used in feature extraction on the\n    // rtcstats-server side, most likely not used anymore, verify if this can be removed.\n    let timestamp = -Infinity;\n\n    Object.keys(newStats).forEach(id => {\n        const report = newStats[id];\n\n        if (report.timestamp > timestamp) {\n            timestamp = report.timestamp;\n        }\n    });\n    Object.keys(newStats).forEach(id => {\n        const report = newStats[id];\n\n        if (report.timestamp === timestamp) {\n            report.timestamp = 0;\n        }\n    });\n    newStats.timestamp = timestamp;\n\n    return newStats;\n}\n\n/**\n *\n * @param {*} stream\n */\nfunction dumpStream(stream) {\n    return {\n        id: stream.id,\n        tracks: stream.getTracks().map(track => {\n            return {\n                id: track.id, // unique identifier (GUID) for the track\n                kind: track.kind, // `audio` or `video`\n                label: track.label, // identified the track source\n                enabled: track.enabled, // application can control it\n                muted: track.muted, // application cannot control it (read-only)\n                readyState: track.readyState // `live` or `ended`\n            };\n        })\n    };\n}\n\n/**\n *\n * @param {*} trace\n * @param {*} getStatsInterval\n * @param {*} prefixesToWrap\n * @param {*} connectionFilter\n */\nexport default function(\n        { statsEntry: sendStatsEntry },\n        { connectionFilter,\n            pollInterval,\n            useLegacy,\n            sendSdp = false,\n            prefixesToWrap = [ '' ],\n            eventCallback }\n) {\n    let peerconnectioncounter = 0;\n\n    const browserDetection = new BrowserDetection();\n    const isFirefox = browserDetection.isFirefox();\n    const isChromiumBased = browserDetection.isChromiumBased();\n    const isWebKitBased = browserDetection.isWebKitBased();\n    const isReactNative = browserDetection.isReactNative();\n\n    // Only initialize rtcstats if it's run in a supported browser\n    if (!(isFirefox || isChromiumBased || isWebKitBased || isReactNative)) {\n        logger.warn('RTCStats unsupported browser.');\n\n        return;\n    }\n\n    prefixesToWrap.forEach(prefix => {\n        if (!window[`${prefix}RTCPeerConnection`]) {\n            return;\n        }\n\n        const OrigPeerConnection = window[`${prefix}RTCPeerConnection`];\n        const peerconnection = function(config, constraints = {}) {\n            // We want to make sure that any potential errors that occur at this point, caused by rtcstats logic,\n            // does not affect the normal flow of any application that might integrate it.\n            const origConfig = { ...config };\n            const { optional = [] } = constraints;\n            let isP2P = false;\n\n            try {\n                // Verify if the connection is configured as P2P\n                optional.some(option => option.rtcStatsSFUP2P === true) && (isP2P = true);\n\n                const pc = new OrigPeerConnection(config, constraints);\n\n                // In case the client wants to skip some rtcstats connections, a filter function can be provided which\n                // will return the original PC object without any strings attached.\n                if (connectionFilter && connectionFilter(config)) {\n                    return pc;\n                }\n\n                const id = `PC_${peerconnectioncounter++}`;\n\n                pc.__rtcStatsId = id;\n\n                if (!config) {\n                    config = { nullConfig: true };\n                }\n\n                config = JSON.parse(JSON.stringify(config)); // deepcopy\n                // don't log credentials\n                ((config && config.iceServers) || []).forEach(server => {\n                    delete server.credential;\n                });\n\n                if (isFirefox) {\n                    config.browserType = 'moz';\n                } else {\n                    config.browserType = 'webkit';\n                }\n\n                sendStatsEntry('create', id, config);\n\n                pc.__dtlsTransport = null;\n\n                // TODO: do we want to log constraints here? They are chrome-proprietary.\n                // eslint-disable-next-line max-len\n                // http://stackoverflow.com/questions/31003928/what-do-each-of-these-experimental-goog-rtcpeerconnectionconstraints-do\n                sendStatsEntry('constraints', id, constraints);\n\n                pc.addEventListener('icecandidate', e => {\n                    sendStatsEntry('onicecandidate', id, e.candidate);\n                });\n                pc.addEventListener('addstream', e => {\n                    sendStatsEntry(\n                        'onaddstream',\n                        id,\n                        `${e.stream.id} ${e.stream.getTracks().map(t => `${t.kind}:${t.id}`)}`\n                    );\n                });\n                pc.addEventListener('track', e => {\n                    sendStatsEntry(\n                        'ontrack',\n                        id,\n                        `${e.track.kind}:${e.track.id} ${e.streams.map(stream => `stream:${stream.id}`)}`\n                    );\n                });\n                pc.addEventListener('removestream', e => {\n                    sendStatsEntry(\n                        'onremovestream',\n                        id,\n                        `${e.stream.id} ${e.stream.getTracks().map(t => `${t.kind}:${t.id}`)}`\n                    );\n                });\n                pc.addEventListener('signalingstatechange', () => {\n                    sendStatsEntry('onsignalingstatechange', id, pc.signalingState);\n                });\n                pc.addEventListener('iceconnectionstatechange', () => {\n                    const { iceConnectionState } = pc;\n\n                    sendStatsEntry('oniceconnectionstatechange', id, iceConnectionState);\n                    eventCallback?.({\n                        type: PC_ICE_CON_STATE_CHANGE,\n                        body: {\n                            pcId: id,\n                            isP2P,\n                            state: iceConnectionState\n                        }\n                    });\n                });\n                pc.addEventListener('icegatheringstatechange', () => {\n                    sendStatsEntry('onicegatheringstatechange', id, pc.iceGatheringState);\n                });\n                pc.addEventListener('connectionstatechange', () => {\n                    const { connectionState } = pc;\n\n                    sendStatsEntry('onconnectionstatechange', id, pc.connectionState);\n                    eventCallback?.({\n                        type: PC_CON_STATE_CHANGE,\n                        body: {\n                            pcId: id,\n                            isP2P,\n                            state: connectionState\n                        }\n                    });\n                });\n                pc.addEventListener('negotiationneeded', () => {\n                    sendStatsEntry('onnegotiationneeded', id, undefined);\n                });\n                pc.addEventListener('datachannel', event => {\n                    sendStatsEntry('ondatachannel', id, [ event.channel.id, event.channel.label ]);\n                });\n\n                let prev = {};\n\n                const getStats = function() {\n                    if (isFirefox || isWebKitBased || isReactNative || ((isChromiumBased && !useLegacy))) {\n                        pc.getStats(null).then(res => {\n                            const now = map2obj(res);\n                            const base = JSON.parse(JSON.stringify(now)); // our new prev\n\n                            sendStatsEntry('getstats', id, deltaCompression(prev, now));\n                            prev = base;\n                        });\n                    } else if (isChromiumBased) {\n                        // for chromium based env we have the option of using the chrome getstats api via the\n                        // useLegacy flag.\n                        pc.getStats(res => {\n                            const now = mangleChromeStats(pc, res);\n                            const base = JSON.parse(JSON.stringify(now)); // our new prev\n\n                            sendStatsEntry('getstats', id, deltaCompression(prev, now));\n                            prev = base;\n                        });\n                    }\n\n                    // If the current env doesn't support any getstats call do nothing.\n                };\n\n                // TODO: do we want one big interval and all peerconnections\n                //    queried in that or one setInterval per PC?\n                //    we have to collect results anyway so...\n                if (pollInterval) {\n                    const interval = window.setInterval(() => {\n                        if (pc.signalingState === 'closed' || pc.iceConnectionState === 'closed') {\n                            window.clearInterval(interval);\n\n                            return;\n                        }\n                        getStats();\n                    }, pollInterval);\n                }\n\n                pc.addEventListener('connectionstatechange', () => {\n                    if ([ 'connected', 'failed' ].includes(pc.connectionState)) {\n                        getStats();\n                    }\n                });\n\n                return pc;\n            } catch (error) {\n                // If something went wrong, return a normal PeerConnection\n                console.error('RTCStats PeerConnection bind failed: ', error);\n\n                return new OrigPeerConnection(origConfig, constraints);\n            }\n        };\n\n        [ 'createDataChannel', 'close' ].forEach(method => {\n            const nativeMethod = OrigPeerConnection.prototype[method];\n\n            if (nativeMethod) {\n                OrigPeerConnection.prototype[method] = function() {\n                    try {\n                        sendStatsEntry(method, this.__rtcStatsId, arguments);\n                    } catch (error) {\n                        console.error(`RTCStats ${method} bind failed: `, error);\n                    }\n\n                    return nativeMethod.apply(this, arguments);\n                };\n            }\n        });\n\n        [ 'addStream', 'removeStream' ].forEach(method => {\n            const nativeMethod = OrigPeerConnection.prototype[method];\n\n            if (nativeMethod) {\n                OrigPeerConnection.prototype[method] = function() {\n                    try {\n                        const stream = arguments[0];\n                        const streamInfo = stream\n                            .getTracks()\n                            .map(t => `${t.kind}:${t.id}`)\n                            .join(',');\n\n                        sendStatsEntry(method, this.__rtcStatsId, `${stream.id} ${streamInfo}`);\n                    } catch (error) {\n                        console.error(`RTCStats ${method} bind failed: `, error);\n                    }\n\n                    return nativeMethod.apply(this, arguments);\n                };\n            }\n        });\n\n        [ 'addTrack' ].forEach(method => {\n            const nativeMethod = OrigPeerConnection.prototype[method];\n\n            if (nativeMethod) {\n                OrigPeerConnection.prototype[method] = function() {\n                    try {\n                        const track = arguments[0];\n                        const streams = [].slice.call(arguments, 1);\n\n                        sendStatsEntry(\n                            method,\n                            this.__rtcStatsId,\n                            `${track.kind}:${track.id} ${streams.map(s => `stream:${s.id}`).join(';') || '-'}`\n                        );\n                    } catch (error) {\n                        console.error(`RTCStats ${method} bind failed: `, error);\n                    }\n\n                    return nativeMethod.apply(this, arguments);\n                };\n            }\n        });\n\n        [ 'removeTrack' ].forEach(method => {\n            const nativeMethod = OrigPeerConnection.prototype[method];\n\n            if (nativeMethod) {\n                OrigPeerConnection.prototype[method] = function() {\n                    try {\n                        const track = arguments[0].track;\n\n                        sendStatsEntry(method, this.__rtcStatsId, track ? `${track.kind}:${track.id}` : 'null');\n                    } catch (error) {\n                        console.error(`RTCStats ${method} bind failed: `, error);\n                    }\n\n                    return nativeMethod.apply(this, arguments);\n                };\n            }\n        });\n\n        [ 'addTransceiver' ].forEach(method => {\n            const nativeMethod = OrigPeerConnection.prototype[method];\n\n            if (nativeMethod) {\n                OrigPeerConnection.prototype[method] = function() {\n                    try {\n                        const trackOrKind = arguments[0];\n                        let opts;\n\n                        if (typeof trackOrKind === 'string') {\n\n                            opts = trackOrKind;\n                        } else {\n                            opts = `${trackOrKind.kind}:${trackOrKind.id}`;\n                        }\n                        if (arguments.length === 2 && typeof arguments[1] === 'object') {\n                            opts += ` ${JSON.stringify(arguments[1])}`;\n                        }\n\n                        sendStatsEntry(method, this.__rtcStatsId, opts);\n                    } catch (error) {\n                        console.error(`RTCStats ${method} bind failed: `, error);\n                    }\n\n                    return nativeMethod.apply(this, arguments);\n                };\n            }\n        });\n\n        [ 'createOffer', 'createAnswer' ].forEach(method => {\n            const nativeMethod = OrigPeerConnection.prototype[method];\n\n            if (nativeMethod) {\n                OrigPeerConnection.prototype[method] = function() {\n                    // The logic here extracts the arguments and establishes if the API\n                    // is callback or Promise based.\n                    const rtcStatsId = this.__rtcStatsId;\n                    const args = arguments;\n                    let opts;\n\n                    if (arguments.length === 1 && typeof arguments[0] === 'object') {\n                        opts = arguments[0];\n                    } else if (arguments.length === 3 && typeof arguments[2] === 'object') {\n                        opts = arguments[2];\n                    }\n\n                    // We can only put a \"barrier\" at this point because the above logic is\n                    // necessary in all cases, if something fails there we can't just bypass it.\n                    try {\n                        sendStatsEntry(method, this.__rtcStatsId, opts);\n                    } catch (error) {\n                        console.error(`RTCStats ${method} bind failed: `, error);\n                    }\n\n                    return nativeMethod.apply(this, opts ? [ opts ] : undefined).then(\n                        description => {\n                            try {\n\n                                const data = sendSdp ? description : '';\n\n                                sendStatsEntry(`${method}OnSuccess`, rtcStatsId, data);\n                            } catch (error) {\n                                console.error(`RTCStats ${method} promise success bind failed: `, error);\n                            }\n\n                            // We can't safely bypass this part of logic because it's necessary for Proxying this\n                            // request. It determines weather the call is callback or promise based.\n                            if (args.length > 0 && typeof args[0] === 'function') {\n                                args[0].apply(null, [ description ]);\n\n                                return undefined;\n                            }\n\n                            return description;\n                        },\n                        err => {\n                            try {\n                                sendStatsEntry(`${method}OnFailure`, rtcStatsId, err.toString());\n                            } catch (error) {\n                                console.error(`RTCStats ${method} promise failure bind failed: `, error);\n                            }\n\n                            // We can't safely bypass this part of logic because it's necessary for\n                            // Proxying this request. It determines weather the call is callback or promise based.\n                            if (args.length > 1 && typeof args[1] === 'function') {\n                                args[1].apply(null, [ err ]);\n\n                                return;\n                            }\n                            throw err;\n                        }\n                    );\n                };\n            }\n        });\n\n        [ 'setLocalDescription', 'setRemoteDescription', 'addIceCandidate' ].forEach(method => {\n            const nativeMethod = OrigPeerConnection.prototype[method];\n\n            if (nativeMethod) {\n                OrigPeerConnection.prototype[method] = function() {\n                    const rtcStatsId = this.__rtcStatsId;\n                    const args = arguments;\n\n                    try {\n                        const data = sendSdp ? args[0] : '';\n\n                        sendStatsEntry(method, this.__rtcStatsId, data);\n                    } catch (error) {\n                        console.error(`RTCStats ${method} bind failed: `, error);\n                    }\n\n                    return nativeMethod.apply(this, [ args[0] ]).then(\n                        () => {\n                            try {\n                                sendStatsEntry(`${method}OnSuccess`, rtcStatsId, undefined);\n                            } catch (error) {\n                                console.error(`RTCStats ${method} promise success bind failed: `, error);\n                            }\n\n                            if (!this.__dtlsTransport && method.endsWith('Description') && !isReactNative) {\n                                this.getSenders().forEach(sender => {\n                                    if (!this.__dtlsTransport && sender.transport) {\n                                        this.__dtlsTransport = sender.transport;\n\n                                        sender.transport.addEventListener('error', error => {\n                                            sendStatsEntry('ondtlserror', rtcStatsId, error);\n                                        });\n\n                                        sender.transport.addEventListener('statechange', () => {\n                                            const newstate = sender.transport.state;\n\n                                            sendStatsEntry('ondtlsstatechange', rtcStatsId, newstate);\n                                        });\n                                    }\n                                });\n                            }\n\n                            // We can't safely bypass this part of logic because it's necessary for\n                            // Proxying this request. It determines weather the call is callback or promise based.\n                            if (args.length >= 2 && typeof args[1] === 'function') {\n                                args[1].apply(null, []);\n\n                                return undefined;\n                            }\n\n                            return undefined;\n                        },\n                        err => {\n                            try {\n                                sendStatsEntry(`${method}OnFailure`, rtcStatsId, err.toString());\n                            } catch (error) {\n                                console.error(`RTCStats ${method} promise failure bind failed: `, error);\n                            }\n\n                            // We can't safely bypass this part of logic because it's necessary for\n                            // Proxying this request. It determines weather the call is callback or promise based\n                            if (args.length >= 3 && typeof args[2] === 'function') {\n                                args[2].apply(null, [ err ]);\n\n                                return undefined;\n                            }\n                            throw err;\n                        }\n                    );\n                };\n            }\n        });\n\n        // wrap static methods. Currently just generateCertificate.\n        if (OrigPeerConnection.generateCertificate) {\n            Object.defineProperty(peerconnection, 'generateCertificate', {\n                get() {\n                    return arguments.length\n                        ? OrigPeerConnection.generateCertificate.apply(null, arguments)\n                        : OrigPeerConnection.generateCertificate;\n                }\n            });\n        }\n        window[`${prefix}RTCPeerConnection`] = peerconnection;\n        window[`${prefix}RTCPeerConnection`].prototype = OrigPeerConnection.prototype;\n    });\n\n    // getUserMedia wrappers\n    prefixesToWrap.forEach(prefix => {\n        const name = prefix + (prefix.length ? 'GetUserMedia' : 'getUserMedia');\n\n        if (!navigator[name]) {\n            return;\n        }\n        const origGetUserMedia = navigator[name].bind(navigator);\n        const gum = function() {\n            try {\n                sendStatsEntry('getUserMedia', null, arguments[0]);\n            } catch (error) {\n                console.error('RTCStats getUserMedia bind failed: ', error);\n            }\n\n            const cb = arguments[1];\n            const eb = arguments[2];\n\n            origGetUserMedia(\n                arguments[0],\n                stream => {\n                    try {\n                        sendStatsEntry('getUserMediaOnSuccess', null, dumpStream(stream));\n                    } catch (error) {\n                        console.error('RTCStats getUserMediaOnSuccess bind failed: ', error);\n                    }\n\n                    // we log the stream id, track ids and tracks readystate since that is ended GUM fails\n                    // to acquire the cam (in chrome)\n                    if (cb) {\n                        cb(stream);\n                    }\n                },\n                err => {\n                    try {\n                        sendStatsEntry('getUserMediaOnFailure', null, err.name);\n                    } catch (error) {\n                        console.error('RTCStats getUserMediaOnFailure bind failed: ', error);\n                    }\n\n                    if (eb) {\n                        eb(err);\n                    }\n                }\n            );\n        };\n\n        navigator[name] = gum.bind(navigator);\n    });\n\n    if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {\n        const origGetUserMedia = navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);\n        const gum = function() {\n            try {\n                sendStatsEntry('navigator.mediaDevices.getUserMedia', null, arguments[0]);\n            } catch (error) {\n                console.error('RTCStats navigator.mediaDevices.getUserMedia bind failed: ', error);\n            }\n\n            return origGetUserMedia.apply(navigator.mediaDevices, arguments).then(\n                stream => {\n                    try {\n                        sendStatsEntry('navigator.mediaDevices.getUserMediaOnSuccess', null, dumpStream(stream));\n                    } catch (error) {\n                        console.error('RTCStats navigator.mediaDevices.getUserMediaOnSuccess bind failed: ', error);\n                    }\n\n                    return stream;\n                },\n                err => {\n                    try {\n                        sendStatsEntry('navigator.mediaDevices.getUserMediaOnFailure', null, err.name);\n                    } catch (error) {\n                        console.error('RTCStats navigator.mediaDevices.getUserMediaOnFailure bind failed: ', error);\n                    }\n\n                    return Promise.reject(err);\n                }\n            );\n        };\n\n        navigator.mediaDevices.getUserMedia = gum.bind(navigator.mediaDevices);\n    }\n\n    // getDisplayMedia\n    if (navigator.mediaDevices && navigator.mediaDevices.getDisplayMedia) {\n        const origGetDisplayMedia = navigator.mediaDevices.getDisplayMedia.bind(navigator.mediaDevices);\n        const gdm = function() {\n            try {\n                sendStatsEntry('navigator.mediaDevices.getDisplayMedia', null, arguments[0]);\n            } catch (error) {\n                console.error('RTCStats navigator.mediaDevices.getDisplayMedia bind failed: ', error);\n            }\n\n            return origGetDisplayMedia.apply(navigator.mediaDevices, arguments).then(\n                stream => {\n                    try {\n                        sendStatsEntry('navigator.mediaDevices.getDisplayMediaOnSuccess', null, dumpStream(stream));\n                    } catch (error) {\n                        console.error('RTCStats navigator.mediaDevices.getDisplayMediaOnSuccess bind failed: ', error);\n                    }\n\n                    return stream;\n                },\n                err => {\n                    try {\n                        sendStatsEntry('navigator.mediaDevices.getDisplayMediaOnFailure', null, err.name);\n                    } catch (error) {\n                        console.error('RTCStats navigator.mediaDevices.getDisplayMediaOnFailure bind failed: ', error);\n                    }\n\n                    return Promise.reject(err);\n                }\n            );\n        };\n\n        navigator.mediaDevices.getDisplayMedia = gdm.bind(navigator.mediaDevices);\n    }\n}\n","// Unique ID creation requires a high quality random # generator. In the browser we therefore\n// require the crypto API and do not support built-in fallback to lower quality random number\n// generators (like Math.random()).\nvar getRandomValues;\nvar rnds8 = new Uint8Array(16);\nexport default function rng() {\n  // lazy load so that environments that need to polyfill have a chance to do so\n  if (!getRandomValues) {\n    // getRandomValues needs to be invoked in a context where \"this\" is a Crypto implementation. Also,\n    // find the complete implementation of crypto (msCrypto) on IE11.\n    getRandomValues = typeof crypto !== 'undefined' && crypto.getRandomValues && crypto.getRandomValues.bind(crypto) || typeof msCrypto !== 'undefined' && typeof msCrypto.getRandomValues === 'function' && msCrypto.getRandomValues.bind(msCrypto);\n\n    if (!getRandomValues) {\n      throw new Error('crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported');\n    }\n  }\n\n  return getRandomValues(rnds8);\n}","export default /^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;","import validate from './validate.js';\n/**\n * Convert array of 16 byte values to UUID string format of the form:\n * XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\n */\n\nvar byteToHex = [];\n\nfor (var i = 0; i < 256; ++i) {\n  byteToHex.push((i + 0x100).toString(16).substr(1));\n}\n\nfunction stringify(arr) {\n  var offset = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n  // Note: Be careful editing this code!  It's been tuned for performance\n  // and works in ways you may not expect. See https://github.com/uuidjs/uuid/pull/434\n  var uuid = (byteToHex[arr[offset + 0]] + byteToHex[arr[offset + 1]] + byteToHex[arr[offset + 2]] + byteToHex[arr[offset + 3]] + '-' + byteToHex[arr[offset + 4]] + byteToHex[arr[offset + 5]] + '-' + byteToHex[arr[offset + 6]] + byteToHex[arr[offset + 7]] + '-' + byteToHex[arr[offset + 8]] + byteToHex[arr[offset + 9]] + '-' + byteToHex[arr[offset + 10]] + byteToHex[arr[offset + 11]] + byteToHex[arr[offset + 12]] + byteToHex[arr[offset + 13]] + byteToHex[arr[offset + 14]] + byteToHex[arr[offset + 15]]).toLowerCase(); // Consistency check for valid UUID.  If this throws, it's likely due to one\n  // of the following:\n  // - One or more input array values don't map to a hex octet (leading to\n  // \"undefined\" in the uuid)\n  // - Invalid input values for the RFC `version` or `variant` fields\n\n  if (!validate(uuid)) {\n    throw TypeError('Stringified UUID is invalid');\n  }\n\n  return uuid;\n}\n\nexport default stringify;","import REGEX from './regex.js';\n\nfunction validate(uuid) {\n  return typeof uuid === 'string' && REGEX.test(uuid);\n}\n\nexport default validate;","import rng from './rng.js';\nimport stringify from './stringify.js';\n\nfunction v4(options, buf, offset) {\n  options = options || {};\n  var rnds = options.random || (options.rng || rng)(); // Per 4.4, set bits for version and `clock_seq_hi_and_reserved`\n\n  rnds[6] = rnds[6] & 0x0f | 0x40;\n  rnds[8] = rnds[8] & 0x3f | 0x80; // Copy bytes to buffer, if provided\n\n  if (buf) {\n    offset = offset || 0;\n\n    for (var i = 0; i < 16; ++i) {\n      buf[offset + i] = rnds[i];\n    }\n\n    return buf;\n  }\n\n  return stringify(rnds);\n}\n\nexport default v4;","export const PROTOCOL_ITERATION = '3.1';\n\n// the maximum number of ms allowed for the client to try reconnect\nexport const MAX_RECONNECT_TIME = 600000;\nexport const messageTypes = {\n    SequenceNumber: 'sn'\n};\nexport const CONFERENCE_LEAVE_CODE = 3001;\nexport const DUMP_ERROR_CODE = 3002;\nexport const CUSTOM_ERROR_CODES = [ CONFERENCE_LEAVE_CODE, DUMP_ERROR_CODE ];\n\n// The limit chosen for the buffer so that memory overflows do not happen.\nexport const BUFFER_LIMIT = 1000;\n","// obfuscate ip addresses which should not be stored long-term.\n\nimport SDPUtils from 'sdp';\n\n/**\n * obfuscate ip, keeping address family intact.\n * @param {*} ip\n */\nfunction maskIP(ip) {\n    if (ip.indexOf('[') === 0 || ip.indexOf(':') !== -1) {\n        // IPv6\n        // obfuscate last five bits like Chrome does.\n        return `${ip.split(':').slice(0, 3)\n            .join(':')}:x:x:x:x:x`;\n    }\n\n    const parts = ip.split('.');\n\n    if (parts.length === 4) {\n        parts[3] = 'x';\n\n        return parts.join('.');\n    }\n\n    return ip;\n}\n\n/**\n * Returns a simple IP mask.\n *\n * @returns masked IP.\n */\nfunction obfuscateIP(ip) {\n    if (ip.indexOf('[') === 0 || ip.indexOf(':') !== -1) {\n\n        return 'x:x:x:x:x:x:x:x';\n    }\n\n    return 'x.x.x.x';\n}\n\n/**\n * obfuscate the ip in ice candidates. Does NOT obfuscate the ip of the TURN server to allow\n * selecting/grouping sessions by TURN server.\n * @param {*} candidate\n */\nfunction obfuscateCandidate(candidate) {\n    const cand = SDPUtils.parseCandidate(candidate);\n\n    if (!(cand.type === 'relay' || cand.protocol === 'ssltcp')) {\n        cand.ip = obfuscateIP(cand.ip);\n        cand.address = obfuscateIP(cand.address);\n    }\n    if (cand.relatedAddress) {\n        cand.relatedAddress = obfuscateIP(cand.relatedAddress);\n    }\n\n    return SDPUtils.writeCandidate(cand);\n}\n\n/**\n *\n * @param {*} sdp\n */\nfunction obfuscateSDP(sdp) {\n    const lines = SDPUtils.splitLines(sdp);\n\n    return `${lines\n        .map(line => {\n            // obfuscate a=candidate, c= and a=rtcp\n            if (line.indexOf('a=candidate:') === 0) {\n                return `a=${obfuscateCandidate(line)}`;\n            } else if (line.indexOf('c=') === 0) {\n                return 'c=IN IP4 0.0.0.0';\n            } else if (line.indexOf('a=rtcp:') === 0) {\n                return 'a=rtcp:9 IN IP4 0.0.0.0';\n            }\n\n            return line;\n        })\n        .join('\\r\\n')\n        .trim()}\\r\\n`;\n}\n\n/**\n *\n * @param {*} stats\n */\nfunction obfuscateStats(stats) {\n    Object.keys(stats).forEach(id => {\n        const report = stats[id];\n\n        // TODO Safari and Firefox seem to be sending empty statistic files\n        if (!report) {\n            return;\n        }\n\n        // obfuscate different variants of how the ip is contained in different stats / versions.\n        [ 'ipAddress', 'ip', 'address' ].forEach(address => {\n            if (report[address] && report.candidateType !== 'relay') {\n                report[address] = obfuscateIP(report[address]);\n            }\n        });\n        [ 'googLocalAddress', 'googRemoteAddress' ].forEach(name => {\n            // contains both address and port\n            let port;\n            let ip;\n            let splitBy;\n\n            // These fields also have the port, separate it first and the obfuscate.\n            if (report[name]) {\n                // IPv6 has the following format [1fff:0:a88:85a3::ac1f]:8001\n                // IPv5 has the following format 127.0.0.1:8001\n                if (report[name][0] === '[') {\n                    splitBy = ']:';\n                } else {\n                    splitBy = ':';\n                }\n\n                [ ip, port ] = report[name].split(splitBy);\n\n                report[name] = `${obfuscateIP(ip)}:${port}`;\n            }\n        });\n    });\n}\n\n/**\n * Obfuscates the ip addresses from webrtc statistics.\n * NOTE. The statistics spec is subject to change, consider evaluating which statistics contain IP addresses\n * before usage.\n *\n * @param {*} data\n */\nexport default function(data) {\n    switch (data[0]) {\n    case 'addIceCandidate':\n    case 'onicecandidate':\n        if (data[2] && data[2].candidate) {\n\n            const jsonRepr = data[2];\n\n            jsonRepr.candidate = obfuscateCandidate(jsonRepr.candidate);\n            data[2] = jsonRepr;\n        }\n        break;\n    case 'setLocalDescription':\n    case 'setRemoteDescription':\n    case 'createOfferOnSuccess':\n    case 'createAnswerOnSuccess':\n        if (data[2] && data[2].sdp) {\n            data[2].sdp = obfuscateSDP(data[2].sdp);\n        }\n        break;\n    case 'getStats':\n    case 'getstats':\n        if (data[2]) {\n            obfuscateStats(data[2]);\n        }\n        break;\n    default:\n        break;\n    }\n}\n","/* eslint-disable prefer-rest-params */\nimport { v4 as uuidv4 } from 'uuid';\n\nimport {\n    PROTOCOL_ITERATION,\n    MAX_RECONNECT_TIME,\n    messageTypes,\n    CONFERENCE_LEAVE_CODE,\n    BUFFER_LIMIT,\n    CUSTOM_ERROR_CODES,\n    DUMP_ERROR_CODE\n} from './constants';\nimport obfuscator from './obfuscator';\n\n/**\n * Function that returns the timeout time for the reconnect based on number of attempts.\n *\n * @param {*} reconnectAttempts\n * @returns\n */\nfunction getTimeout(reconnectAttempts) {\n    return ((2 ** reconnectAttempts) * 1000) + Math.floor(Math.random() * 10000);\n}\n\n/**\n *\n * @param {*} endpoint\n * @param {*} onCloseCallback\n * @param {*} pingInterval\n */\nexport default function({ endpoint, meetingFqn, onCloseCallback, useLegacy, obfuscate = true, pingInterval = 30000 }) {\n    // Parent stats session id, used when breakout rooms occur to keep track of the initial stats session id.\n    let parentStatsSessionId;\n\n    // Buffer for storing stats if there is no connection to the server.\n    let buffer = [];\n    let statsSessionId = uuidv4();\n    let connection;\n    let keepAliveInterval;\n\n    // the number of ms spent trying to reconnect to the server.\n    let reconnectSpentTime = 0;\n\n    // flag indicating if data can be sent to the server.\n    let canSendMessage = false;\n\n    // The sequence number of the last stat.\n    let sequenceNumber = 1;\n\n    // Timeout time for the reconnect protocol.\n    let reconnectTimeout;\n\n    // We maintain support for legacy chrome rtcstats just in case we need some critical statistic\n    // only obtainable from that format, ideally we'd remove this in the future.\n    const protocolVersion = useLegacy ? `${PROTOCOL_ITERATION}_LEGACY` : `${PROTOCOL_ITERATION}_STANDARD`;\n\n    // Function setting the timestamp and the sequence number of the entry.\n    const setTransportParams = data => {\n        data.push(new Date().getTime());\n        data.push(sequenceNumber++);\n    };\n\n    // Function sending the message to the server if there is a connection.\n    const sendMessage = msg => {\n        // It creates a copy of the message so that the message from the buffer have the data attribute unstringified\n        const copyMsg = Object.assign({}, msg);\n\n        if (copyMsg.type !== 'identity' && copyMsg.data) {\n            copyMsg.data = JSON.stringify(copyMsg.data);\n        }\n        if (connection && (connection.readyState === WebSocket.OPEN) && canSendMessage) {\n            connection.send(JSON.stringify(copyMsg));\n        }\n    };\n\n    const trace = function(msg) {\n        sendMessage(msg);\n        if (buffer.length < BUFFER_LIMIT && msg.data) {\n            buffer.push(msg);\n        }\n    };\n\n    trace.isConnected = function() {\n        if (!connection) {\n            return false;\n        }\n        const { readyState } = connection;\n\n        return readyState === WebSocket.OPEN;\n    };\n\n    trace.isClosed = function() {\n        if (!connection) {\n            return true;\n        }\n\n        const { readyState } = connection;\n\n        return readyState === WebSocket.CLOSED;\n    };\n\n    trace.identity = function(...data) {\n        setTransportParams(data);\n\n        if (parentStatsSessionId) {\n            data[2].parentStatsSessionId = parentStatsSessionId;\n        }\n\n        const identityMsg = {\n            statsSessionId,\n            type: 'identity',\n            data\n        };\n\n        trace(identityMsg);\n    };\n\n    trace.statsEntry = function(...data) {\n        let myData = data;\n\n        if (obfuscate) {\n            switch (data[0]) {\n            case 'addIceCandidate':\n            case 'onicecandidate':\n            case 'setLocalDescription':\n            case 'setRemoteDescription':\n                // These functions need to original values to work with\n                // so we need a deep copy to do the obfuscation on.\n                myData = JSON.parse(JSON.stringify(myData));\n                break;\n            default:\n                break;\n            }\n\n            // Obfuscate the ips is required.\n            obfuscator(myData);\n        }\n        setTransportParams(myData);\n\n        const statsEntryMsg = {\n            statsSessionId,\n            type: 'stats-entry',\n            data: myData\n        };\n\n        trace(statsEntryMsg);\n    };\n\n    trace.keepAlive = function() {\n\n        const keepaliveMsg = {\n            statsSessionId,\n            type: 'keepalive'\n        };\n\n        trace(keepaliveMsg);\n    };\n\n    trace.close = function() {\n        connection && connection.close(CONFERENCE_LEAVE_CODE);\n    };\n\n    trace.connect = function(isBreakoutRoom, isReconnect = false) {\n        if (isBreakoutRoom && !parentStatsSessionId) {\n            parentStatsSessionId = statsSessionId;\n        }\n        if (parentStatsSessionId) {\n            statsSessionId = uuidv4();\n            buffer.forEach(entry => {\n                entry.statsSessionId = statsSessionId;\n            });\n        }\n        if (connection) {\n            connection.close();\n        }\n\n        connection = new WebSocket(\n            `${endpoint}/${meetingFqn}?statsSessionId=${statsSessionId}&isReconnect=${isReconnect}`,\n            protocolVersion,\n            { headers: { 'User-Agent': navigator.userAgent } }\n        );\n\n        connection.onclose = function(closeEvent) {\n            keepAliveInterval && clearInterval(keepAliveInterval);\n            canSendMessage && (canSendMessage = false);\n\n            onCloseCallback({ code: closeEvent.code,\n                reason: closeEvent.reason });\n\n            // Do not try to reconnect if connection was closed intentionally.\n            if (CUSTOM_ERROR_CODES.includes(closeEvent.code)) {\n                return;\n            }\n\n            if (reconnectSpentTime < MAX_RECONNECT_TIME) {\n                const reconnectTimeoutTimeCandidate = getTimeout(reconnectSpentTime);\n                const reconnectTimeoutTime = reconnectSpentTime + reconnectTimeoutTimeCandidate < MAX_RECONNECT_TIME\n                    ? reconnectTimeoutTimeCandidate\n                    : MAX_RECONNECT_TIME - reconnectSpentTime;\n\n                reconnectSpentTime += reconnectTimeoutTime;\n                reconnectTimeout = setTimeout(() => trace.connect(isBreakoutRoom, true), reconnectTimeoutTime);\n            }\n        };\n\n        connection.onopen = function() {\n            keepAliveInterval = setInterval(trace.keepAlive, pingInterval);\n        };\n\n        connection.onmessage = async function(msg) {\n            const { type, body } = JSON.parse(msg.data);\n\n            // if the server sends back the last sequence number that it has been received.\n            if (type === messageTypes.SequenceNumber) {\n                const { value, state } = body;\n\n                // if there are entries in the buffer\n                if (buffer.length) {\n                    const firstSN = buffer[0].data[4];\n                    const lastSN = buffer[buffer.length - 1].data[4];\n\n                    // messages would not be in order, some messages might be missing\n                    if (value < firstSN - 1 && value > lastSN) {\n                        connection && connection.close(DUMP_ERROR_CODE);\n\n                        return;\n                    }\n\n                    const lastReceivedSNIndex = buffer.findIndex(statsEntry => statsEntry.data[4] === value);\n\n                    buffer = buffer.slice(lastReceivedSNIndex + 1);\n                }\n\n                // this happens when the connection is established\n                if (state === 'initial') {\n                    reconnectTimeout && clearTimeout(reconnectTimeout);\n                    reconnectSpentTime = 0;\n                    canSendMessage = true;\n                    for (let i = 0; i < buffer.length; i++) {\n                        sendMessage(buffer[i]);\n                    }\n                }\n            }\n        };\n    };\n\n    return trace;\n}\n","import EventEmitter from 'events';\n\n/**\n * Dummy implementation of Storage interface.\n */\nclass DummyLocalStorage extends EventEmitter {\n\n    /**\n     * The object used for storage.\n     */\n    _storage = {};\n\n    /**\n     * Empties all keys out of the storage.\n     *\n     * @returns {void}\n     */\n    clear() {\n        this._storage = {};\n    }\n\n    /**\n     * Returns the number of data items stored in the Storage object.\n     *\n     * @returns {number} - The number of data items stored in the Storage object.\n     */\n    get length() {\n        return Object.keys(this._storage).length;\n    }\n\n    /**\n     * Will return that key's value associated to the passed key name.\n     *\n     * @param {string} keyName - The key name.\n     * @returns {*} - The key value.\n     */\n    getItem(keyName) {\n        return this._storage[keyName];\n    }\n\n    /**\n     * When passed a key name and value, will add that key to the storage,\n     * or update that key's value if it already exists.\n     *\n     * @param {string} keyName - The key name.\n     * @param {*} keyValue - The key value.\n     * @returns {void}\n     */\n    setItem(keyName, keyValue) {\n        this._storage[keyName] = keyValue;\n    }\n\n    /**\n     * When passed a key name, will remove that key from the storage.\n     *\n     * @param {string} keyName - The key name.\n     * @returns {void}\n     */\n    removeItem(keyName) {\n        delete this._storage[keyName];\n    }\n\n    /**\n     * When passed a number n, this method will return the name of the nth key in the storage.\n     *\n     * @param {number} idx - The index of the key.\n     * @returns {string} - The nth key name.\n     */\n    key(n) {\n        const keys = Object.keys(this._storage);\n\n        if (keys.length <= n) {\n            return undefined;\n        }\n\n        return keys[n];\n    }\n\n    /**\n     * Serializes the content of the storage.\n     *\n     * @param {Array<string>} ignore - Array with keys from the local storage to be ignored.\n     * @returns {string} - The serialized content.\n     */\n    serialize(ignore = []) {\n        if (ignore.length === 0) {\n            return JSON.stringify(this._storage);\n        }\n\n        const storageCopy = { ...this._storage };\n\n        ignore.forEach(key => {\n            delete storageCopy[key];\n        });\n\n        return JSON.stringify(storageCopy);\n    }\n}\n\n/**\n * Wrapper class for browser's local storage object.\n */\nclass JitsiLocalStorage extends EventEmitter {\n    /**\n     * @constructor\n     * @param {Storage} storage browser's local storage object.\n     */\n    constructor() {\n        super();\n\n        try {\n            this._storage = window.localStorage;\n            this._localStorageDisabled = false;\n        } catch (ignore) {\n            // localStorage throws an exception.\n        }\n\n        if (!this._storage) { // Handles the case when window.localStorage is undefined or throws an exception.\n            console.warn('Local storage is disabled.');\n            this._storage = new DummyLocalStorage();\n            this._localStorageDisabled = true;\n        }\n    }\n\n    /**\n     * Returns true if window.localStorage is disabled and false otherwise.\n     *\n     * @returns {boolean} - True if window.localStorage is disabled and false otherwise.\n     */\n    isLocalStorageDisabled() {\n        return this._localStorageDisabled;\n    }\n\n    /**\n     * Switch between window.localStorage and DummyLocalStorage.\n     */\n    setLocalStorageDisabled(value) {\n        this._localStorageDisabled = value;\n\n        try {\n            this._storage = value ? new DummyLocalStorage() : window.localStorage;\n        } catch (ignore) {\n            // localStorage throws an exception.\n        }\n\n        if (!this._storage) {\n            this._storage = new DummyLocalStorage();\n        }\n    }\n\n    /**\n     * Empties all keys out of the storage.\n     *\n     * @returns {void}\n     */\n    clear() {\n        this._storage.clear();\n        this.emit('changed');\n    }\n\n    /**\n     * Returns the number of data items stored in the Storage object.\n     *\n     * @returns {number} - The number of data items stored in the Storage object.\n     */\n    get length() {\n        return this._storage.length;\n    }\n\n    /**\n     * Returns that passed key's value.\n     * @param {string} keyName the name of the key you want to retrieve\n     * the value of.\n     * @returns {String|null} the value of the key. If the key does not exist,\n     * null is returned.\n     */\n    getItem(keyName) {\n        return this._storage.getItem(keyName);\n    }\n\n    /**\n     * Adds a key to the storage, or update key's value if it already exists.\n     * @param {string} keyName - the name of the key you want to create/update.\n     * @param {string} keyValue - the value you want to give the key you are\n     * creating/updating.\n     * @param {boolean} dontEmitChangedEvent - If true a changed event won't be emitted.\n     */\n    setItem(keyName, keyValue, dontEmitChangedEvent = false) {\n        this._storage.setItem(keyName, keyValue);\n\n        if (!dontEmitChangedEvent) {\n            this.emit('changed');\n        }\n    }\n\n    /**\n     * Remove a key from the storage.\n     * @param {string} keyName the name of the key you want to remove.\n     */\n    removeItem(keyName) {\n        this._storage.removeItem(keyName);\n        this.emit('changed');\n    }\n\n    /**\n     * Returns the name of the nth key in the list, or null if n is greater\n     * than or equal to the number of key/value pairs in the object.\n     *\n     * @param {number} i - The index of the key in the list.\n     * @returns {string}\n     */\n    key(i) {\n        return this._storage.key(i);\n    }\n\n    /**\n     * Serializes the content of the storage.\n     *\n     * @param {Array<string>} ignore - Array with keys from the local storage to be ignored.\n     * @returns {string} - The serialized content.\n     */\n    serialize(ignore = []) {\n        if (this.isLocalStorageDisabled()) {\n            return this._storage.serialize(ignore);\n        }\n\n        const length = this._storage.length;\n        const localStorageContent = {};\n\n        for (let i = 0; i < length; i++) {\n            const key = this._storage.key(i);\n\n            if (!ignore.includes(key)) {\n                localStorageContent[key] = this._storage.getItem(key);\n            }\n        }\n\n        return JSON.stringify(localStorageContent);\n    }\n}\n\nexport const jitsiLocalStorage = new JitsiLocalStorage();\n","import { parse as BourneParse } from '@hapi/bourne';\n/**\n * Safely parse JSON payloads.\n *\n * @param {string} data - The payload to be parsed.\n * @returns The parsed object.\n */\nexport function safeJsonParse(data) {\n    return BourneParse(data);\n}\n","/**\n * @const\n */\nconst ALPHANUM\n    = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ';\n\n/**\n * Hexadecimal digits.\n * @const\n */\nconst HEX_DIGITS = '0123456789abcdef';\n\n/**\n * Generates random int within the range [min, max]\n * @param min the minimum value for the generated number\n * @param max the maximum value for the generated number\n * @returns random int number\n */\nexport function randomInt(min: number, max: number): number {\n    return Math.floor(Math.random() * (max - min + 1)) + min;\n}\n\n/**\n * Get random element from array or string.\n * @param {Array|string} arr source\n * @returns array element or string character\n */\nexport function randomElement<T>(arr: T[] | string): T | string {\n    return arr[randomInt(0, arr.length - 1)];\n}\n\n/**\n * Generate random alphanumeric string.\n * @param {number} length expected string length\n * @returns {string} random string of specified length\n */\nexport function randomAlphanumStr(length: number): string {\n    let result = '';\n\n    for (let i = 0; i < length; i += 1) {\n        result += randomElement(ALPHANUM);\n    }\n\n    return result;\n}\n\n/**\n * Exported interface.\n */\nconst RandomUtil = {\n    /**\n     * Returns a random hex digit.\n     * @returns {*}\n     */\n    randomAlphanumStr,\n    randomElement,\n    randomHexDigit(): string {\n        return randomElement(HEX_DIGITS) as string;\n    },\n\n    /**\n     * Returns a random string of hex digits with length 'len'.\n     * @param len the length.\n     */\n    randomHexString(len: number): string {\n        let ret = '';\n\n        while (len--) { // eslint-disable-line no-param-reassign\n            ret += this.randomHexDigit();\n        }\n\n        return ret;\n    },\n    randomInt\n};\n\nexport default RandomUtil;\n","import { randomAlphanumStr, randomElement } from './RandomUtil';\n\n/**\n * from faker.js - Copyright (c) 2014-2015 Matthew Bergman & Marak Squires\n * MIT License\n * http://github.com/marak/faker.js/\n *\n * @const\n */\nconst names: string[] = [\n    'Aaliyah', 'Aaron', 'Abagail', 'Abbey', 'Abbie', 'Abbigail', 'Abby',\n    'Abdiel', 'Abdul', 'Abdullah', 'Abe', 'Abel', 'Abelardo', 'Abigail',\n    'Abigale', 'Abigayle', 'Abner', 'Abraham', 'Ada', 'Adah', 'Adalberto',\n    'Adaline', 'Adam', 'Adan', 'Addie', 'Addison', 'Adela', 'Adelbert', 'Adele',\n    'Adelia', 'Adeline', 'Adell', 'Adella', 'Adelle', 'Aditya', 'Adolf',\n    'Adolfo', 'Adolph', 'Adolphus', 'Adonis', 'Adrain', 'Adrian', 'Adriana',\n    'Adrianna', 'Adriel', 'Adrien', 'Adrienne', 'Afton', 'Aglae', 'Agnes',\n    'Agustin', 'Agustina', 'Ahmad', 'Ahmed', 'Aida', 'Aidan', 'Aiden', 'Aileen',\n    'Aisha', 'Aiyana', 'Akeem', 'Al', 'Alaina', 'Alan', 'Alana', 'Alanis',\n    'Alanna', 'Alayna', 'Alba', 'Albert', 'Alberta', 'Albertha', 'Alberto',\n    'Albin', 'Albina', 'Alda', 'Alden', 'Alec', 'Aleen', 'Alejandra',\n    'Alejandrin', 'Alek', 'Alena', 'Alene', 'Alessandra', 'Alessandro',\n    'Alessia', 'Aletha', 'Alex', 'Alexa', 'Alexander', 'Alexandra', 'Alexandre',\n    'Alexandrea', 'Alexandria', 'Alexandrine', 'Alexandro', 'Alexane',\n    'Alexanne', 'Alexie', 'Alexis', 'Alexys', 'Alexzander', 'Alf', 'Alfonso',\n    'Alfonzo', 'Alford', 'Alfred', 'Alfreda', 'Alfredo', 'Ali', 'Alia', 'Alice',\n    'Alicia', 'Alisa', 'Alisha', 'Alison', 'Alivia', 'Aliya', 'Aliyah', 'Aliza',\n    'Alize', 'Allan', 'Allen', 'Allene', 'Allie', 'Allison', 'Ally', 'Alphonso',\n    'Alta', 'Althea', 'Alva', 'Alvah', 'Alvena', 'Alvera', 'Alverta', 'Alvina',\n    'Alvis', 'Alyce', 'Alycia', 'Alysa', 'Alysha', 'Alyson', 'Alysson',\n    'Amalia', 'Amanda', 'Amani', 'Amara', 'Amari', 'Amaya', 'Amber', 'Ambrose',\n    'Amelia', 'Amelie', 'Amely', 'America', 'Americo', 'Amie', 'Amina', 'Amir',\n    'Amira', 'Amiya', 'Amos', 'Amparo', 'Amy', 'Amya', 'Ana', 'Anabel',\n    'Anabelle', 'Anahi', 'Anais', 'Anastacio', 'Anastasia', 'Anderson', 'Andre',\n    'Andreane', 'Andreanne', 'Andres', 'Andrew', 'Andy', 'Angel', 'Angela',\n    'Angelica', 'Angelina', 'Angeline', 'Angelita', 'Angelo', 'Angie', 'Angus',\n    'Anibal', 'Anika', 'Anissa', 'Anita', 'Aniya', 'Aniyah', 'Anjali', 'Anna',\n    'Annabel', 'Annabell', 'Annabelle', 'Annalise', 'Annamae', 'Annamarie',\n    'Anne', 'Annetta', 'Annette', 'Annie', 'Ansel', 'Ansley', 'Anthony',\n    'Antoinette', 'Antone', 'Antonetta', 'Antonette', 'Antonia', 'Antonietta',\n    'Antonina', 'Antonio', 'Antwan', 'Antwon', 'Anya', 'April', 'Ara',\n    'Araceli', 'Aracely', 'Arch', 'Archibald', 'Ardella', 'Arden', 'Ardith',\n    'Arely', 'Ari', 'Ariane', 'Arianna', 'Aric', 'Ariel', 'Arielle', 'Arjun',\n    'Arlene', 'Arlie', 'Arlo', 'Armand', 'Armando', 'Armani', 'Arnaldo', 'Arne',\n    'Arno', 'Arnold', 'Arnoldo', 'Arnulfo', 'Aron', 'Art', 'Arthur', 'Arturo',\n    'Arvel', 'Arvid', 'Arvilla', 'Aryanna', 'Asa', 'Asha', 'Ashlee', 'Ashleigh',\n    'Ashley', 'Ashly', 'Ashlynn', 'Ashton', 'Ashtyn', 'Asia', 'Assunta',\n    'Astrid', 'Athena', 'Aubree', 'Aubrey', 'Audie', 'Audra', 'Audreanne',\n    'Audrey', 'August', 'Augusta', 'Augustine', 'Augustus', 'Aurelia',\n    'Aurelie', 'Aurelio', 'Aurore', 'Austen', 'Austin', 'Austyn', 'Autumn',\n    'Ava', 'Avery', 'Avis', 'Axel', 'Ayana', 'Ayden', 'Ayla', 'Aylin', 'Baby',\n    'Bailee', 'Bailey', 'Barbara', 'Barney', 'Baron', 'Barrett', 'Barry',\n    'Bart', 'Bartholome', 'Barton', 'Baylee', 'Beatrice', 'Beau', 'Beaulah',\n    'Bell', 'Bella', 'Belle', 'Ben', 'Benedict', 'Benjamin', 'Bennett',\n    'Bennie', 'Benny', 'Benton', 'Berenice', 'Bernadette', 'Bernadine',\n    'Bernard', 'Bernardo', 'Berneice', 'Bernhard', 'Bernice', 'Bernie',\n    'Berniece', 'Bernita', 'Berry', 'Bert', 'Berta', 'Bertha', 'Bertram',\n    'Bertrand', 'Beryl', 'Bessie', 'Beth', 'Bethany', 'Bethel', 'Betsy',\n    'Bette', 'Bettie', 'Betty', 'Bettye', 'Beulah', 'Beverly', 'Bianka', 'Bill',\n    'Billie', 'Billy', 'Birdie', 'Blair', 'Blaise', 'Blake', 'Blanca',\n    'Blanche', 'Blaze', 'Bo', 'Bobbie', 'Bobby', 'Bonita', 'Bonnie', 'Boris',\n    'Boyd', 'Brad', 'Braden', 'Bradford', 'Bradley', 'Bradly', 'Brady',\n    'Braeden', 'Brain', 'Brandi', 'Brando', 'Brandon', 'Brandt', 'Brandy',\n    'Brandyn', 'Brannon', 'Branson', 'Brant', 'Braulio', 'Braxton', 'Brayan',\n    'Breana', 'Breanna', 'Breanne', 'Brenda', 'Brendan', 'Brenden', 'Brendon',\n    'Brenna', 'Brennan', 'Brennon', 'Brent', 'Bret', 'Brett', 'Bria', 'Brian',\n    'Briana', 'Brianne', 'Brice', 'Bridget', 'Bridgette', 'Bridie', 'Brielle',\n    'Brigitte', 'Brionna', 'Brisa', 'Britney', 'Brittany', 'Brock', 'Broderick',\n    'Brody', 'Brook', 'Brooke', 'Brooklyn', 'Brooks', 'Brown', 'Bruce',\n    'Bryana', 'Bryce', 'Brycen', 'Bryon', 'Buck', 'Bud', 'Buddy', 'Buford',\n    'Bulah', 'Burdette', 'Burley', 'Burnice', 'Buster', 'Cade', 'Caden',\n    'Caesar', 'Caitlyn', 'Cale', 'Caleb', 'Caleigh', 'Cali', 'Calista',\n    'Callie', 'Camden', 'Cameron', 'Camila', 'Camilla', 'Camille', 'Camren',\n    'Camron', 'Camryn', 'Camylle', 'Candace', 'Candelario', 'Candice',\n    'Candida', 'Candido', 'Cara', 'Carey', 'Carissa', 'Carlee', 'Carleton',\n    'Carley', 'Carli', 'Carlie', 'Carlo', 'Carlos', 'Carlotta', 'Carmel',\n    'Carmela', 'Carmella', 'Carmelo', 'Carmen', 'Carmine', 'Carol', 'Carolanne',\n    'Carole', 'Carolina', 'Caroline', 'Carolyn', 'Carolyne', 'Carrie',\n    'Carroll', 'Carson', 'Carter', 'Cary', 'Casandra', 'Casey', 'Casimer',\n    'Casimir', 'Casper', 'Cassandra', 'Cassandre', 'Cassidy', 'Cassie',\n    'Catalina', 'Caterina', 'Catharine', 'Catherine', 'Cathrine', 'Cathryn',\n    'Cathy', 'Cayla', 'Ceasar', 'Cecelia', 'Cecil', 'Cecile', 'Cecilia',\n    'Cedrick', 'Celestine', 'Celestino', 'Celia', 'Celine', 'Cesar', 'Chad',\n    'Chadd', 'Chadrick', 'Chaim', 'Chance', 'Chandler', 'Chanel', 'Chanelle',\n    'Charity', 'Charlene', 'Charles', 'Charley', 'Charlie', 'Charlotte',\n    'Chase', 'Chasity', 'Chauncey', 'Chaya', 'Chaz', 'Chelsea', 'Chelsey',\n    'Chelsie', 'Chesley', 'Chester', 'Chet', 'Cheyanne', 'Cheyenne', 'Chloe',\n    'Chris', 'Christ', 'Christa', 'Christelle', 'Christian', 'Christiana',\n    'Christina', 'Christine', 'Christop', 'Christophe', 'Christopher',\n    'Christy', 'Chyna', 'Ciara', 'Cicero', 'Cielo', 'Cierra', 'Cindy',\n    'Citlalli', 'Clair', 'Claire', 'Clara', 'Clarabelle', 'Clare', 'Clarissa',\n    'Clark', 'Claud', 'Claude', 'Claudia', 'Claudie', 'Claudine', 'Clay',\n    'Clemens', 'Clement', 'Clementina', 'Clementine', 'Clemmie', 'Cleo',\n    'Cleora', 'Cleta', 'Cletus', 'Cleve', 'Cleveland', 'Clifford', 'Clifton',\n    'Clint', 'Clinton', 'Clotilde', 'Clovis', 'Cloyd', 'Clyde', 'Coby', 'Cody',\n    'Colby', 'Cole', 'Coleman', 'Colin', 'Colleen', 'Collin', 'Colt', 'Colten',\n    'Colton', 'Columbus', 'Concepcion', 'Conner', 'Connie', 'Connor', 'Conor',\n    'Conrad', 'Constance', 'Constantin', 'Consuelo', 'Cooper', 'Cora',\n    'Coralie', 'Corbin', 'Cordelia', 'Cordell', 'Cordia', 'Cordie', 'Corene',\n    'Corine', 'Cornelius', 'Cornell', 'Corrine', 'Cortez', 'Cortney', 'Cory',\n    'Coty', 'Courtney', 'Coy', 'Craig', 'Crawford', 'Creola', 'Cristal',\n    'Cristian', 'Cristina', 'Cristobal', 'Cristopher', 'Cruz', 'Crystal',\n    'Crystel', 'Cullen', 'Curt', 'Curtis', 'Cydney', 'Cynthia', 'Cyril',\n    'Cyrus', 'Dagmar', 'Dahlia', 'Daija', 'Daisha', 'Daisy', 'Dakota', 'Dale',\n    'Dallas', 'Dallin', 'Dalton', 'Damaris', 'Dameon', 'Damian', 'Damien',\n    'Damion', 'Damon', 'Dan', 'Dana', 'Dandre', 'Dane', 'D\\'angelo', 'Dangelo',\n    'Danial', 'Daniela', 'Daniella', 'Danielle', 'Danika', 'Dannie', 'Danny',\n    'Dante', 'Danyka', 'Daphne', 'Daphnee', 'Daphney', 'Darby', 'Daren',\n    'Darian', 'Dariana', 'Darien', 'Dario', 'Darion', 'Darius', 'Darlene',\n    'Daron', 'Darrel', 'Darrell', 'Darren', 'Darrick', 'Darrin', 'Darrion',\n    'Darron', 'Darryl', 'Darwin', 'Daryl', 'Dashawn', 'Dasia', 'Dave', 'David',\n    'Davin', 'Davion', 'Davon', 'Davonte', 'Dawn', 'Dawson', 'Dax', 'Dayana',\n    'Dayna', 'Dayne', 'Dayton', 'Dean', 'Deangelo', 'Deanna', 'Deborah',\n    'Declan', 'Dedric', 'Dedrick', 'Dee', 'Deion', 'Deja', 'Dejah', 'Dejon',\n    'Dejuan', 'Delaney', 'Delbert', 'Delfina', 'Delia', 'Delilah', 'Dell',\n    'Della', 'Delmer', 'Delores', 'Delpha', 'Delphia', 'Delphine', 'Delta',\n    'Demarco', 'Demarcus', 'Demario', 'Demetris', 'Demetrius', 'Demond', 'Dena',\n    'Denis', 'Dennis', 'Deon', 'Deondre', 'Deontae', 'Deonte', 'Dereck',\n    'Derek', 'Derick', 'Deron', 'Derrick', 'Deshaun', 'Deshawn', 'Desiree',\n    'Desmond', 'Dessie', 'Destany', 'Destin', 'Destinee', 'Destiney', 'Destini',\n    'Destiny', 'Devan', 'Devante', 'Deven', 'Devin', 'Devon', 'Devonte',\n    'Devyn', 'Dewayne', 'Dewitt', 'Dexter', 'Diamond', 'Diana', 'Dianna',\n    'Diego', 'Dillan', 'Dillon', 'Dimitri', 'Dina', 'Dino', 'Dion', 'Dixie',\n    'Dock', 'Dolly', 'Dolores', 'Domenic', 'Domenica', 'Domenick', 'Domenico',\n    'Domingo', 'Dominic', 'Dominique', 'Don', 'Donald', 'Donato', 'Donavon',\n    'Donna', 'Donnell', 'Donnie', 'Donny', 'Dora', 'Dorcas', 'Dorian', 'Doris',\n    'Dorothea', 'Dorothy', 'Dorris', 'Dortha', 'Dorthy', 'Doug', 'Douglas',\n    'Dovie', 'Doyle', 'Drake', 'Drew', 'Duane', 'Dudley', 'Dulce', 'Duncan',\n    'Durward', 'Dustin', 'Dusty', 'Dwight', 'Dylan', 'Earl', 'Earlene',\n    'Earline', 'Earnest', 'Earnestine', 'Easter', 'Easton', 'Ebba', 'Ebony',\n    'Ed', 'Eda', 'Edd', 'Eddie', 'Eden', 'Edgar', 'Edgardo', 'Edison', 'Edmond',\n    'Edmund', 'Edna', 'Eduardo', 'Edward', 'Edwardo', 'Edwin', 'Edwina',\n    'Edyth', 'Edythe', 'Effie', 'Efrain', 'Efren', 'Eileen', 'Einar', 'Eino',\n    'Eladio', 'Elaina', 'Elbert', 'Elda', 'Eldon', 'Eldora', 'Eldred',\n    'Eldridge', 'Eleanora', 'Eleanore', 'Eleazar', 'Electa', 'Elena', 'Elenor',\n    'Elenora', 'Eleonore', 'Elfrieda', 'Eli', 'Elian', 'Eliane', 'Elias',\n    'Eliezer', 'Elijah', 'Elinor', 'Elinore', 'Elisa', 'Elisabeth', 'Elise',\n    'Eliseo', 'Elisha', 'Elissa', 'Eliza', 'Elizabeth', 'Ella', 'Ellen',\n    'Ellie', 'Elliot', 'Elliott', 'Ellis', 'Ellsworth', 'Elmer', 'Elmira',\n    'Elmo', 'Elmore', 'Elna', 'Elnora', 'Elody', 'Eloisa', 'Eloise', 'Elouise',\n    'Eloy', 'Elroy', 'Elsa', 'Else', 'Elsie', 'Elta', 'Elton', 'Elva', 'Elvera',\n    'Elvie', 'Elvis', 'Elwin', 'Elwyn', 'Elyse', 'Elyssa', 'Elza', 'Emanuel',\n    'Emelia', 'Emelie', 'Emely', 'Emerald', 'Emerson', 'Emery', 'Emie', 'Emil',\n    'Emile', 'Emilia', 'Emiliano', 'Emilie', 'Emilio', 'Emily', 'Emma',\n    'Emmalee', 'Emmanuel', 'Emmanuelle', 'Emmet', 'Emmett', 'Emmie', 'Emmitt',\n    'Emmy', 'Emory', 'Ena', 'Enid', 'Enoch', 'Enola', 'Enos', 'Enrico',\n    'Enrique', 'Ephraim', 'Era', 'Eriberto', 'Eric', 'Erica', 'Erich', 'Erick',\n    'Ericka', 'Erik', 'Erika', 'Erin', 'Erling', 'Erna', 'Ernest', 'Ernestina',\n    'Ernestine', 'Ernesto', 'Ernie', 'Ervin', 'Erwin', 'Eryn', 'Esmeralda',\n    'Esperanza', 'Esta', 'Esteban', 'Estefania', 'Estel', 'Estell', 'Estella',\n    'Estelle', 'Estevan', 'Esther', 'Estrella', 'Etha', 'Ethan', 'Ethel',\n    'Ethelyn', 'Ethyl', 'Ettie', 'Eudora', 'Eugene', 'Eugenia', 'Eula', 'Eulah',\n    'Eulalia', 'Euna', 'Eunice', 'Eusebio', 'Eva', 'Evalyn', 'Evan',\n    'Evangeline', 'Evans', 'Eve', 'Eveline', 'Evelyn', 'Everardo', 'Everett',\n    'Everette', 'Evert', 'Evie', 'Ewald', 'Ewell', 'Ezekiel', 'Ezequiel',\n    'Ezra', 'Fabian', 'Fabiola', 'Fae', 'Fannie', 'Fanny', 'Fatima', 'Faustino',\n    'Fausto', 'Favian', 'Fay', 'Faye', 'Federico', 'Felicia', 'Felicita',\n    'Felicity', 'Felipa', 'Felipe', 'Felix', 'Felton', 'Fermin', 'Fern',\n    'Fernando', 'Ferne', 'Fidel', 'Filiberto', 'Filomena', 'Finn', 'Fiona',\n    'Flavie', 'Flavio', 'Fleta', 'Fletcher', 'Flo', 'Florence', 'Florencio',\n    'Florian', 'Florida', 'Florine', 'Flossie', 'Floy', 'Floyd', 'Ford',\n    'Forest', 'Forrest', 'Foster', 'Frances', 'Francesca', 'Francesco',\n    'Francis', 'Francisca', 'Francisco', 'Franco', 'Frank', 'Frankie', 'Franz',\n    'Fred', 'Freda', 'Freddie', 'Freddy', 'Frederic', 'Frederick', 'Frederik',\n    'Frederique', 'Fredrick', 'Fredy', 'Freeda', 'Freeman', 'Freida', 'Frida',\n    'Frieda', 'Friedrich', 'Fritz', 'Furman', 'Gabe', 'Gabriel', 'Gabriella',\n    'Gabrielle', 'Gaetano', 'Gage', 'Gail', 'Gardner', 'Garett', 'Garfield',\n    'Garland', 'Garnet', 'Garnett', 'Garret', 'Garrett', 'Garrick', 'Garrison',\n    'Garry', 'Garth', 'Gaston', 'Gavin', 'Gay', 'Gayle', 'Gaylord', 'Gene',\n    'General', 'Genesis', 'Genevieve', 'Gennaro', 'Genoveva', 'Geo', 'Geoffrey',\n    'George', 'Georgette', 'Georgiana', 'Georgianna', 'Geovanni', 'Geovanny',\n    'Geovany', 'Gerald', 'Geraldine', 'Gerard', 'Gerardo', 'Gerda', 'Gerhard',\n    'Germaine', 'German', 'Gerry', 'Gerson', 'Gertrude', 'Gia', 'Gianni',\n    'Gideon', 'Gilbert', 'Gilberto', 'Gilda', 'Giles', 'Gillian', 'Gina',\n    'Gino', 'Giovani', 'Giovanna', 'Giovanni', 'Giovanny', 'Gisselle',\n    'Giuseppe', 'Gladyce', 'Gladys', 'Glen', 'Glenda', 'Glenna', 'Glennie',\n    'Gloria', 'Godfrey', 'Golda', 'Golden', 'Gonzalo', 'Gordon', 'Grace',\n    'Gracie', 'Graciela', 'Grady', 'Graham', 'Grant', 'Granville', 'Grayce',\n    'Grayson', 'Green', 'Greg', 'Gregg', 'Gregoria', 'Gregorio', 'Gregory',\n    'Greta', 'Gretchen', 'Greyson', 'Griffin', 'Grover', 'Guadalupe', 'Gudrun',\n    'Guido', 'Guillermo', 'Guiseppe', 'Gunnar', 'Gunner', 'Gus', 'Gussie',\n    'Gust', 'Gustave', 'Guy', 'Gwen', 'Gwendolyn', 'Hadley', 'Hailee', 'Hailey',\n    'Hailie', 'Hal', 'Haleigh', 'Haley', 'Halie', 'Halle', 'Hallie', 'Hank',\n    'Hanna', 'Hannah', 'Hans', 'Hardy', 'Harley', 'Harmon', 'Harmony', 'Harold',\n    'Harrison', 'Harry', 'Harvey', 'Haskell', 'Hassan', 'Hassie', 'Hattie',\n    'Haven', 'Hayden', 'Haylee', 'Hayley', 'Haylie', 'Hazel', 'Hazle', 'Heath',\n    'Heather', 'Heaven', 'Heber', 'Hector', 'Heidi', 'Helen', 'Helena',\n    'Helene', 'Helga', 'Hellen', 'Helmer', 'Heloise', 'Henderson', 'Henri',\n    'Henriette', 'Henry', 'Herbert', 'Herman', 'Hermann', 'Hermina', 'Herminia',\n    'Herminio', 'Hershel', 'Herta', 'Hertha', 'Hester', 'Hettie', 'Hilario',\n    'Hilbert', 'Hilda', 'Hildegard', 'Hillard', 'Hillary', 'Hilma', 'Hilton',\n    'Hipolito', 'Hiram', 'Hobart', 'Holden', 'Hollie', 'Hollis', 'Holly',\n    'Hope', 'Horace', 'Horacio', 'Hortense', 'Hosea', 'Houston', 'Howard',\n    'Howell', 'Hoyt', 'Hubert', 'Hudson', 'Hugh', 'Hulda', 'Humberto', 'Hunter',\n    'Hyman', 'Ian', 'Ibrahim', 'Icie', 'Ida', 'Idell', 'Idella', 'Ignacio',\n    'Ignatius', 'Ike', 'Ila', 'Ilene', 'Iliana', 'Ima', 'Imani', 'Imelda',\n    'Immanuel', 'Imogene', 'Ines', 'Irma', 'Irving', 'Irwin', 'Isaac', 'Isabel',\n    'Isabell', 'Isabella', 'Isabelle', 'Isac', 'Isadore', 'Isai', 'Isaiah',\n    'Isaias', 'Isidro', 'Ismael', 'Isobel', 'Isom', 'Israel', 'Issac', 'Itzel',\n    'Iva', 'Ivah', 'Ivory', 'Ivy', 'Izabella', 'Izaiah', 'Jabari', 'Jace',\n    'Jacey', 'Jacinthe', 'Jacinto', 'Jack', 'Jackeline', 'Jackie', 'Jacklyn',\n    'Jackson', 'Jacky', 'Jaclyn', 'Jacquelyn', 'Jacques', 'Jacynthe', 'Jada',\n    'Jade', 'Jaden', 'Jadon', 'Jadyn', 'Jaeden', 'Jaida', 'Jaiden', 'Jailyn',\n    'Jaime', 'Jairo', 'Jakayla', 'Jake', 'Jakob', 'Jaleel', 'Jalen', 'Jalon',\n    'Jalyn', 'Jamaal', 'Jamal', 'Jamar', 'Jamarcus', 'Jamel', 'Jameson',\n    'Jamey', 'Jamie', 'Jamil', 'Jamir', 'Jamison', 'Jammie', 'Jan', 'Jana',\n    'Janae', 'Jane', 'Janelle', 'Janessa', 'Janet', 'Janice', 'Janick', 'Janie',\n    'Janis', 'Janiya', 'Jannie', 'Jany', 'Jaquan', 'Jaquelin', 'Jaqueline',\n    'Jared', 'Jaren', 'Jarod', 'Jaron', 'Jarred', 'Jarrell', 'Jarret',\n    'Jarrett', 'Jarrod', 'Jarvis', 'Jasen', 'Jasmin', 'Jason', 'Jasper',\n    'Jaunita', 'Javier', 'Javon', 'Javonte', 'Jay', 'Jayce', 'Jaycee', 'Jayda',\n    'Jayde', 'Jayden', 'Jaydon', 'Jaylan', 'Jaylen', 'Jaylin', 'Jaylon',\n    'Jayme', 'Jayne', 'Jayson', 'Jazlyn', 'Jazmin', 'Jazmyn', 'Jazmyne', 'Jean',\n    'Jeanette', 'Jeanie', 'Jeanne', 'Jed', 'Jedediah', 'Jedidiah', 'Jeff',\n    'Jefferey', 'Jeffery', 'Jeffrey', 'Jeffry', 'Jena', 'Jenifer', 'Jennie',\n    'Jennifer', 'Jennings', 'Jennyfer', 'Jensen', 'Jerad', 'Jerald', 'Jeramie',\n    'Jeramy', 'Jerel', 'Jeremie', 'Jeremy', 'Jermain', 'Jermaine', 'Jermey',\n    'Jerod', 'Jerome', 'Jeromy', 'Jerrell', 'Jerrod', 'Jerrold', 'Jerry',\n    'Jess', 'Jesse', 'Jessica', 'Jessie', 'Jessika', 'Jessy', 'Jessyca',\n    'Jesus', 'Jett', 'Jettie', 'Jevon', 'Jewel', 'Jewell', 'Jillian', 'Jimmie',\n    'Jimmy', 'Jo', 'Joan', 'Joana', 'Joanie', 'Joanne', 'Joannie', 'Joanny',\n    'Joany', 'Joaquin', 'Jocelyn', 'Jodie', 'Jody', 'Joe', 'Joel', 'Joelle',\n    'Joesph', 'Joey', 'Johan', 'Johann', 'Johanna', 'Johathan', 'John',\n    'Johnathan', 'Johnathon', 'Johnnie', 'Johnny', 'Johnpaul', 'Johnson',\n    'Jolie', 'Jon', 'Jonas', 'Jonatan', 'Jonathan', 'Jonathon', 'Jordan',\n    'Jordane', 'Jordi', 'Jordon', 'Jordy', 'Jordyn', 'Jorge', 'Jose', 'Josefa',\n    'Josefina', 'Joseph', 'Josephine', 'Josh', 'Joshua', 'Joshuah', 'Josiah',\n    'Josiane', 'Josianne', 'Josie', 'Josue', 'Jovan', 'Jovani', 'Jovanny',\n    'Jovany', 'Joy', 'Joyce', 'Juana', 'Juanita', 'Judah', 'Judd', 'Jude',\n    'Judge', 'Judson', 'Judy', 'Jules', 'Julia', 'Julian', 'Juliana',\n    'Julianne', 'Julie', 'Julien', 'Juliet', 'Julio', 'Julius', 'June',\n    'Junior', 'Junius', 'Justen', 'Justice', 'Justina', 'Justine', 'Juston',\n    'Justus', 'Justyn', 'Juvenal', 'Juwan', 'Kacey', 'Kaci', 'Kacie', 'Kade',\n    'Kaden', 'Kadin', 'Kaela', 'Kaelyn', 'Kaia', 'Kailee', 'Kailey', 'Kailyn',\n    'Kaitlin', 'Kaitlyn', 'Kale', 'Kaleb', 'Kaleigh', 'Kaley', 'Kali', 'Kallie',\n    'Kameron', 'Kamille', 'Kamren', 'Kamron', 'Kamryn', 'Kane', 'Kara',\n    'Kareem', 'Karelle', 'Karen', 'Kari', 'Kariane', 'Karianne', 'Karina',\n    'Karine', 'Karl', 'Karlee', 'Karley', 'Karli', 'Karlie', 'Karolann',\n    'Karson', 'Kasandra', 'Kasey', 'Kassandra', 'Katarina', 'Katelin',\n    'Katelyn', 'Katelynn', 'Katharina', 'Katherine', 'Katheryn', 'Kathleen',\n    'Kathlyn', 'Kathryn', 'Kathryne', 'Katlyn', 'Katlynn', 'Katrina', 'Katrine',\n    'Kattie', 'Kavon', 'Kay', 'Kaya', 'Kaycee', 'Kayden', 'Kayla', 'Kaylah',\n    'Kaylee', 'Kayleigh', 'Kayley', 'Kayli', 'Kaylie', 'Kaylin', 'Keagan',\n    'Keanu', 'Keara', 'Keaton', 'Keegan', 'Keeley', 'Keely', 'Keenan', 'Keira',\n    'Keith', 'Kellen', 'Kelley', 'Kelli', 'Kellie', 'Kelly', 'Kelsi', 'Kelsie',\n    'Kelton', 'Kelvin', 'Ken', 'Kendall', 'Kendra', 'Kendrick', 'Kenna',\n    'Kennedi', 'Kennedy', 'Kenneth', 'Kennith', 'Kenny', 'Kenton', 'Kenya',\n    'Kenyatta', 'Kenyon', 'Keon', 'Keshaun', 'Keshawn', 'Keven', 'Kevin',\n    'Kevon', 'Keyon', 'Keyshawn', 'Khalid', 'Khalil', 'Kian', 'Kiana', 'Kianna',\n    'Kiara', 'Kiarra', 'Kiel', 'Kiera', 'Kieran', 'Kiley', 'Kim', 'Kimberly',\n    'King', 'Kip', 'Kira', 'Kirk', 'Kirsten', 'Kirstin', 'Kitty', 'Kobe',\n    'Koby', 'Kody', 'Kolby', 'Kole', 'Korbin', 'Korey', 'Kory', 'Kraig', 'Kris',\n    'Krista', 'Kristian', 'Kristin', 'Kristina', 'Kristofer', 'Kristoffer',\n    'Kristopher', 'Kristy', 'Krystal', 'Krystel', 'Krystina', 'Kurt', 'Kurtis',\n    'Kyla', 'Kyle', 'Kylee', 'Kyleigh', 'Kyler', 'Kylie', 'Kyra', 'Lacey',\n    'Lacy', 'Ladarius', 'Lafayette', 'Laila', 'Laisha', 'Lamar', 'Lambert',\n    'Lamont', 'Lance', 'Landen', 'Lane', 'Laney', 'Larissa', 'Laron', 'Larry',\n    'Larue', 'Laura', 'Laurel', 'Lauren', 'Laurence', 'Lauretta', 'Lauriane',\n    'Laurianne', 'Laurie', 'Laurine', 'Laury', 'Lauryn', 'Lavada', 'Lavern',\n    'Laverna', 'Laverne', 'Lavina', 'Lavinia', 'Lavon', 'Lavonne', 'Lawrence',\n    'Lawson', 'Layla', 'Layne', 'Lazaro', 'Lea', 'Leann', 'Leanna', 'Leanne',\n    'Leatha', 'Leda', 'Lee', 'Leif', 'Leila', 'Leilani', 'Lela', 'Lelah',\n    'Leland', 'Lelia', 'Lempi', 'Lemuel', 'Lenna', 'Lennie', 'Lenny', 'Lenora',\n    'Lenore', 'Leo', 'Leola', 'Leon', 'Leonard', 'Leonardo', 'Leone', 'Leonel',\n    'Leonie', 'Leonor', 'Leonora', 'Leopold', 'Leopoldo', 'Leora', 'Lera',\n    'Lesley', 'Leslie', 'Lesly', 'Lessie', 'Lester', 'Leta', 'Letha', 'Letitia',\n    'Levi', 'Lew', 'Lewis', 'Lexi', 'Lexie', 'Lexus', 'Lia', 'Liam', 'Liana',\n    'Libbie', 'Libby', 'Lila', 'Lilian', 'Liliana', 'Liliane', 'Lilla',\n    'Lillian', 'Lilliana', 'Lillie', 'Lilly', 'Lily', 'Lilyan', 'Lina',\n    'Lincoln', 'Linda', 'Lindsay', 'Lindsey', 'Linnea', 'Linnie', 'Linwood',\n    'Lionel', 'Lisa', 'Lisandro', 'Lisette', 'Litzy', 'Liza', 'Lizeth',\n    'Lizzie', 'Llewellyn', 'Lloyd', 'Logan', 'Lois', 'Lola', 'Lolita', 'Loma',\n    'Lon', 'London', 'Lonie', 'Lonnie', 'Lonny', 'Lonzo', 'Lora', 'Loraine',\n    'Loren', 'Lorena', 'Lorenz', 'Lorenza', 'Lorenzo', 'Lori', 'Lorine',\n    'Lorna', 'Lottie', 'Lou', 'Louie', 'Louisa', 'Lourdes', 'Louvenia',\n    'Lowell', 'Loy', 'Loyal', 'Loyce', 'Lucas', 'Luciano', 'Lucie', 'Lucienne',\n    'Lucile', 'Lucinda', 'Lucio', 'Lucious', 'Lucius', 'Lucy', 'Ludie',\n    'Ludwig', 'Lue', 'Luella', 'Luigi', 'Luis', 'Luisa', 'Lukas', 'Lula',\n    'Lulu', 'Luna', 'Lupe', 'Lura', 'Lurline', 'Luther', 'Luz', 'Lyda', 'Lydia',\n    'Lyla', 'Lynn', 'Lyric', 'Lysanne', 'Mabel', 'Mabelle', 'Mable', 'Mac',\n    'Macey', 'Maci', 'Macie', 'Mack', 'Mackenzie', 'Macy', 'Madaline',\n    'Madalyn', 'Maddison', 'Madeline', 'Madelyn', 'Madelynn', 'Madge', 'Madie',\n    'Madilyn', 'Madisen', 'Madison', 'Madisyn', 'Madonna', 'Madyson', 'Mae',\n    'Maegan', 'Maeve', 'Mafalda', 'Magali', 'Magdalen', 'Magdalena', 'Maggie',\n    'Magnolia', 'Magnus', 'Maia', 'Maida', 'Maiya', 'Major', 'Makayla',\n    'Makenna', 'Makenzie', 'Malachi', 'Malcolm', 'Malika', 'Malinda', 'Mallie',\n    'Mallory', 'Malvina', 'Mandy', 'Manley', 'Manuel', 'Manuela', 'Mara',\n    'Marc', 'Marcel', 'Marcelina', 'Marcelino', 'Marcella', 'Marcelle',\n    'Marcellus', 'Marcelo', 'Marcia', 'Marco', 'Marcos', 'Marcus', 'Margaret',\n    'Margarete', 'Margarett', 'Margaretta', 'Margarette', 'Margarita', 'Marge',\n    'Margie', 'Margot', 'Margret', 'Marguerite', 'Maria', 'Mariah', 'Mariam',\n    'Marian', 'Mariana', 'Mariane', 'Marianna', 'Marianne', 'Mariano',\n    'Maribel', 'Marie', 'Mariela', 'Marielle', 'Marietta', 'Marilie', 'Marilou',\n    'Marilyne', 'Marina', 'Mario', 'Marion', 'Marisa', 'Marisol', 'Maritza',\n    'Marjolaine', 'Marjorie', 'Marjory', 'Mark', 'Markus', 'Marlee', 'Marlen',\n    'Marlene', 'Marley', 'Marlin', 'Marlon', 'Marques', 'Marquis', 'Marquise',\n    'Marshall', 'Marta', 'Martin', 'Martina', 'Martine', 'Marty', 'Marvin',\n    'Mary', 'Maryam', 'Maryjane', 'Maryse', 'Mason', 'Mateo', 'Mathew',\n    'Mathias', 'Mathilde', 'Matilda', 'Matilde', 'Matt', 'Matteo', 'Mattie',\n    'Maud', 'Maude', 'Maudie', 'Maureen', 'Maurice', 'Mauricio', 'Maurine',\n    'Maverick', 'Mavis', 'Max', 'Maxie', 'Maxime', 'Maximilian', 'Maximillia',\n    'Maximillian', 'Maximo', 'Maximus', 'Maxine', 'Maxwell', 'May', 'Maya',\n    'Maybell', 'Maybelle', 'Maye', 'Maymie', 'Maynard', 'Mayra', 'Mazie',\n    'Mckayla', 'Mckenna', 'Mckenzie', 'Meagan', 'Meaghan', 'Meda', 'Megane',\n    'Meggie', 'Meghan', 'Mekhi', 'Melany', 'Melba', 'Melisa', 'Melissa',\n    'Mellie', 'Melody', 'Melvin', 'Melvina', 'Melyna', 'Melyssa', 'Mercedes',\n    'Meredith', 'Merl', 'Merle', 'Merlin', 'Merritt', 'Mertie', 'Mervin',\n    'Meta', 'Mia', 'Micaela', 'Micah', 'Michael', 'Michaela', 'Michale',\n    'Micheal', 'Michel', 'Michele', 'Michelle', 'Miguel', 'Mikayla', 'Mike',\n    'Mikel', 'Milan', 'Miles', 'Milford', 'Miller', 'Millie', 'Milo', 'Milton',\n    'Mina', 'Minerva', 'Minnie', 'Miracle', 'Mireille', 'Mireya', 'Misael',\n    'Missouri', 'Misty', 'Mitchel', 'Mitchell', 'Mittie', 'Modesta', 'Modesto',\n    'Mohamed', 'Mohammad', 'Mohammed', 'Moises', 'Mollie', 'Molly', 'Mona',\n    'Monica', 'Monique', 'Monroe', 'Monserrat', 'Monserrate', 'Montana',\n    'Monte', 'Monty', 'Morgan', 'Moriah', 'Morris', 'Mortimer', 'Morton',\n    'Mose', 'Moses', 'Moshe', 'Mossie', 'Mozell', 'Mozelle', 'Muhammad',\n    'Muriel', 'Murl', 'Murphy', 'Murray', 'Mustafa', 'Mya', 'Myah', 'Mylene',\n    'Myles', 'Myra', 'Myriam', 'Myrl', 'Myrna', 'Myron', 'Myrtice', 'Myrtie',\n    'Myrtis', 'Myrtle', 'Nadia', 'Nakia', 'Name', 'Nannie', 'Naomi', 'Naomie',\n    'Napoleon', 'Narciso', 'Nash', 'Nasir', 'Nat', 'Natalia', 'Natalie',\n    'Natasha', 'Nathan', 'Nathanael', 'Nathanial', 'Nathaniel', 'Nathen',\n    'Nayeli', 'Neal', 'Ned', 'Nedra', 'Neha', 'Neil', 'Nelda', 'Nella', 'Nelle',\n    'Nellie', 'Nels', 'Nelson', 'Neoma', 'Nestor', 'Nettie', 'Neva', 'Newell',\n    'Newton', 'Nia', 'Nicholas', 'Nicholaus', 'Nichole', 'Nick', 'Nicklaus',\n    'Nickolas', 'Nico', 'Nicola', 'Nicolas', 'Nicole', 'Nicolette', 'Nigel',\n    'Nikita', 'Nikki', 'Nikko', 'Niko', 'Nikolas', 'Nils', 'Nina', 'Noah',\n    'Noble', 'Noe', 'Noel', 'Noelia', 'Noemi', 'Noemie', 'Noemy', 'Nola',\n    'Nolan', 'Nona', 'Nora', 'Norbert', 'Norberto', 'Norene', 'Norma', 'Norris',\n    'Norval', 'Norwood', 'Nova', 'Novella', 'Nya', 'Nyah', 'Nyasia', 'Obie',\n    'Oceane', 'Ocie', 'Octavia', 'Oda', 'Odell', 'Odessa', 'Odie', 'Ofelia',\n    'Okey', 'Ola', 'Olaf', 'Ole', 'Olen', 'Oleta', 'Olga', 'Olin', 'Oliver',\n    'Ollie', 'Oma', 'Omari', 'Omer', 'Ona', 'Onie', 'Opal', 'Ophelia', 'Ora',\n    'Oral', 'Oran', 'Oren', 'Orie', 'Orin', 'Orion', 'Orland', 'Orlando',\n    'Orlo', 'Orpha', 'Orrin', 'Orval', 'Orville', 'Osbaldo', 'Osborne', 'Oscar',\n    'Osvaldo', 'Oswald', 'Oswaldo', 'Otha', 'Otho', 'Otilia', 'Otis', 'Ottilie',\n    'Ottis', 'Otto', 'Ova', 'Owen', 'Ozella', 'Pablo', 'Paige', 'Palma',\n    'Pamela', 'Pansy', 'Paolo', 'Paris', 'Parker', 'Pascale', 'Pasquale', 'Pat',\n    'Patience', 'Patricia', 'Patrick', 'Patsy', 'Pattie', 'Paul', 'Paula',\n    'Pauline', 'Paxton', 'Payton', 'Pearl', 'Pearlie', 'Pearline', 'Pedro',\n    'Peggie', 'Penelope', 'Percival', 'Percy', 'Perry', 'Pete', 'Peter',\n    'Petra', 'Peyton', 'Philip', 'Phoebe', 'Phyllis', 'Pierce', 'Pierre',\n    'Pietro', 'Pink', 'Pinkie', 'Piper', 'Polly', 'Porter', 'Precious',\n    'Presley', 'Preston', 'Price', 'Prince', 'Princess', 'Priscilla',\n    'Providenci', 'Prudence', 'Queen', 'Queenie', 'Quentin', 'Quincy', 'Quinn',\n    'Quinten', 'Quinton', 'Rachael', 'Rachel', 'Rachelle', 'Rae', 'Raegan',\n    'Rafael', 'Rafaela', 'Raheem', 'Rahsaan', 'Rahul', 'Raina', 'Raleigh',\n    'Ralph', 'Ramiro', 'Ramon', 'Ramona', 'Randal', 'Randall', 'Randi', 'Randy',\n    'Ransom', 'Raoul', 'Raphael', 'Raphaelle', 'Raquel', 'Rashad', 'Rashawn',\n    'Rasheed', 'Raul', 'Raven', 'Ray', 'Raymond', 'Raymundo', 'Reagan',\n    'Reanna', 'Reba', 'Rebeca', 'Rebecca', 'Rebeka', 'Rebekah', 'Reece', 'Reed',\n    'Reese', 'Regan', 'Reggie', 'Reginald', 'Reid', 'Reilly', 'Reina',\n    'Reinhold', 'Remington', 'Rene', 'Renee', 'Ressie', 'Reta', 'Retha',\n    'Retta', 'Reuben', 'Reva', 'Rex', 'Rey', 'Reyes', 'Reymundo', 'Reyna',\n    'Reynold', 'Rhea', 'Rhett', 'Rhianna', 'Rhiannon', 'Rhoda', 'Ricardo',\n    'Richard', 'Richie', 'Richmond', 'Rick', 'Rickey', 'Rickie', 'Ricky',\n    'Rico', 'Rigoberto', 'Riley', 'Rita', 'River', 'Robb', 'Robbie', 'Robert',\n    'Roberta', 'Roberto', 'Robin', 'Robyn', 'Rocio', 'Rocky', 'Rod', 'Roderick',\n    'Rodger', 'Rodolfo', 'Rodrick', 'Rodrigo', 'Roel', 'Rogelio', 'Roger',\n    'Rogers', 'Rolando', 'Rollin', 'Roma', 'Romaine', 'Roman', 'Ron', 'Ronaldo',\n    'Ronny', 'Roosevelt', 'Rory', 'Rosa', 'Rosalee', 'Rosalia', 'Rosalind',\n    'Rosalinda', 'Rosalyn', 'Rosamond', 'Rosanna', 'Rosario', 'Roscoe', 'Rose',\n    'Rosella', 'Roselyn', 'Rosemarie', 'Rosemary', 'Rosendo', 'Rosetta',\n    'Rosie', 'Rosina', 'Roslyn', 'Ross', 'Rossie', 'Rowan', 'Rowena', 'Rowland',\n    'Roxane', 'Roxanne', 'Roy', 'Royal', 'Royce', 'Rozella', 'Ruben', 'Rubie',\n    'Ruby', 'Rubye', 'Rudolph', 'Rudy', 'Rupert', 'Russ', 'Russel', 'Russell',\n    'Rusty', 'Ruth', 'Ruthe', 'Ruthie', 'Ryan', 'Ryann', 'Ryder', 'Rylan',\n    'Rylee', 'Ryleigh', 'Ryley', 'Sabina', 'Sabrina', 'Sabryna', 'Sadie',\n    'Sadye', 'Sage', 'Saige', 'Sallie', 'Sally', 'Salma', 'Salvador',\n    'Salvatore', 'Sam', 'Samanta', 'Samantha', 'Samara', 'Samir', 'Sammie',\n    'Sammy', 'Samson', 'Sandra', 'Sandrine', 'Sandy', 'Sanford', 'Santa',\n    'Santiago', 'Santina', 'Santino', 'Santos', 'Sarah', 'Sarai', 'Sarina',\n    'Sasha', 'Saul', 'Savanah', 'Savanna', 'Savannah', 'Savion', 'Scarlett',\n    'Schuyler', 'Scot', 'Scottie', 'Scotty', 'Seamus', 'Sean', 'Sebastian',\n    'Sedrick', 'Selena', 'Selina', 'Selmer', 'Serena', 'Serenity', 'Seth',\n    'Shad', 'Shaina', 'Shakira', 'Shana', 'Shane', 'Shanel', 'Shanelle',\n    'Shania', 'Shanie', 'Shaniya', 'Shanna', 'Shannon', 'Shanny', 'Shanon',\n    'Shany', 'Sharon', 'Shaun', 'Shawn', 'Shawna', 'Shaylee', 'Shayna',\n    'Shayne', 'Shea', 'Sheila', 'Sheldon', 'Shemar', 'Sheridan', 'Sherman',\n    'Sherwood', 'Shirley', 'Shyann', 'Shyanne', 'Sibyl', 'Sid', 'Sidney',\n    'Sienna', 'Sierra', 'Sigmund', 'Sigrid', 'Sigurd', 'Silas', 'Sim', 'Simeon',\n    'Simone', 'Sincere', 'Sister', 'Skye', 'Skyla', 'Skylar', 'Sofia',\n    'Soledad', 'Solon', 'Sonia', 'Sonny', 'Sonya', 'Sophia', 'Sophie',\n    'Spencer', 'Stacey', 'Stacy', 'Stan', 'Stanford', 'Stanley', 'Stanton',\n    'Stefan', 'Stefanie', 'Stella', 'Stephan', 'Stephania', 'Stephanie',\n    'Stephany', 'Stephen', 'Stephon', 'Sterling', 'Steve', 'Stevie', 'Stewart',\n    'Stone', 'Stuart', 'Summer', 'Sunny', 'Susan', 'Susana', 'Susanna', 'Susie',\n    'Suzanne', 'Sven', 'Syble', 'Sydnee', 'Sydney', 'Sydni', 'Sydnie', 'Sylvan',\n    'Sylvester', 'Sylvia', 'Tabitha', 'Tad', 'Talia', 'Talon', 'Tamara',\n    'Tamia', 'Tania', 'Tanner', 'Tanya', 'Tara', 'Taryn', 'Tate', 'Tatum',\n    'Tatyana', 'Taurean', 'Tavares', 'Taya', 'Taylor', 'Teagan', 'Ted', 'Telly',\n    'Terence', 'Teresa', 'Terrance', 'Terrell', 'Terrence', 'Terrill', 'Terry',\n    'Tess', 'Tessie', 'Tevin', 'Thad', 'Thaddeus', 'Thalia', 'Thea', 'Thelma',\n    'Theo', 'Theodora', 'Theodore', 'Theresa', 'Therese', 'Theresia', 'Theron',\n    'Thomas', 'Thora', 'Thurman', 'Tia', 'Tiana', 'Tianna', 'Tiara', 'Tierra',\n    'Tiffany', 'Tillman', 'Timmothy', 'Timmy', 'Timothy', 'Tina', 'Tito',\n    'Titus', 'Tobin', 'Toby', 'Tod', 'Tom', 'Tomas', 'Tomasa', 'Tommie',\n    'Toney', 'Toni', 'Tony', 'Torey', 'Torrance', 'Torrey', 'Toy', 'Trace',\n    'Tracey', 'Tracy', 'Travis', 'Travon', 'Tre', 'Tremaine', 'Tremayne',\n    'Trent', 'Trenton', 'Tressa', 'Tressie', 'Treva', 'Trever', 'Trevion',\n    'Trevor', 'Trey', 'Trinity', 'Trisha', 'Tristian', 'Tristin', 'Triston',\n    'Troy', 'Trudie', 'Trycia', 'Trystan', 'Turner', 'Twila', 'Tyler', 'Tyra',\n    'Tyree', 'Tyreek', 'Tyrel', 'Tyrell', 'Tyrese', 'Tyrique', 'Tyshawn',\n    'Tyson', 'Ubaldo', 'Ulices', 'Ulises', 'Una', 'Unique', 'Urban', 'Uriah',\n    'Uriel', 'Ursula', 'Vada', 'Valentin', 'Valentina', 'Valentine', 'Valerie',\n    'Vallie', 'Van', 'Vance', 'Vanessa', 'Vaughn', 'Veda', 'Velda', 'Vella',\n    'Velma', 'Velva', 'Vena', 'Verda', 'Verdie', 'Vergie', 'Verla', 'Verlie',\n    'Vern', 'Verna', 'Verner', 'Vernice', 'Vernie', 'Vernon', 'Verona',\n    'Veronica', 'Vesta', 'Vicenta', 'Vicente', 'Vickie', 'Vicky', 'Victor',\n    'Victoria', 'Vida', 'Vidal', 'Vilma', 'Vince', 'Vincent', 'Vincenza',\n    'Vincenzo', 'Vinnie', 'Viola', 'Violet', 'Violette', 'Virgie', 'Virgil',\n    'Virginia', 'Virginie', 'Vita', 'Vito', 'Viva', 'Vivian', 'Viviane',\n    'Vivianne', 'Vivien', 'Vivienne', 'Vladimir', 'Wade', 'Waino', 'Waldo',\n    'Walker', 'Wallace', 'Walter', 'Walton', 'Wanda', 'Ward', 'Warren',\n    'Watson', 'Wava', 'Waylon', 'Wayne', 'Webster', 'Weldon', 'Wellington',\n    'Wendell', 'Wendy', 'Werner', 'Westley', 'Weston', 'Whitney', 'Wilber',\n    'Wilbert', 'Wilburn', 'Wiley', 'Wilford', 'Wilfred', 'Wilfredo', 'Wilfrid',\n    'Wilhelm', 'Wilhelmine', 'Will', 'Willa', 'Willard', 'William', 'Willie',\n    'Willis', 'Willow', 'Willy', 'Wilma', 'Wilmer', 'Wilson', 'Wilton',\n    'Winfield', 'Winifred', 'Winnifred', 'Winona', 'Winston', 'Woodrow',\n    'Wyatt', 'Wyman', 'Xander', 'Xavier', 'Xzavier', 'Yadira', 'Yasmeen',\n    'Yasmin', 'Yasmine', 'Yazmin', 'Yesenia', 'Yessenia', 'Yolanda', 'Yoshiko',\n    'Yvette', 'Yvonne', 'Zachariah', 'Zachary', 'Zachery', 'Zack', 'Zackary',\n    'Zackery', 'Zakary', 'Zander', 'Zane', 'Zaria', 'Zechariah', 'Zelda',\n    'Zella', 'Zelma', 'Zena', 'Zetta', 'Zion', 'Zita', 'Zoe', 'Zoey', 'Zoie',\n    'Zoila', 'Zola', 'Zora', 'Zula'\n];\n\n/**\n * Generate random username.\n * @returns {string} random username\n */\nfunction generateUsername(): string {\n    const name = randomElement(names);\n    const suffix = randomAlphanumStr(3);\n\n    return `${name}-${suffix}`;\n}\n\nexport { generateUsername };\n","import { jitsiLocalStorage } from '@jitsi/js-utils';\nimport { getLogger } from '@jitsi/logger';\nimport { v4 as uuidv4 } from 'uuid';\n\nimport { generateUsername } from '../util/UsernameGenerator';\n\nconst logger = getLogger('settings:Settings');\n\nlet _callStatsUserName: Nullable<string> = null;\n\nlet _machineId: Nullable<string> = null;\n\n/**\n *\n */\nexport interface ISettings {\n    _storage: Storage;\n    readonly callStatsUserName: string;\n    init: (externalStorage?: Storage) => void;\n    readonly machineId: string;\n    sessionId: string;\n}\n\nconst Settings: ISettings = {\n    /**\n     * The storage used to store the settings.\n     */\n    _storage: jitsiLocalStorage,\n\n    /**\n     * Returns the ID to use for the purposes of stats, saved in localstorage as \"callStatsUserName\".\n     * @returns {string} fake username for callstats\n     */\n    get callStatsUserName(): string {\n        if (!_callStatsUserName) {\n            _callStatsUserName = this._storage.getItem('callStatsUserName');\n            if (!_callStatsUserName) {\n                _callStatsUserName = _generateStatsId();\n                this._storage.setItem('callStatsUserName', _callStatsUserName);\n            }\n        }\n\n        return _callStatsUserName;\n    },\n\n    /**\n     * Initializes the Settings class.\n     *\n     * @param {Storage|undefined} externalStorage - Object that implements the Storage interface. This object will be\n     * used for storing data instead of jitsiLocalStorage if specified.\n     */\n    init(externalStorage?: Storage): void {\n        this._storage = externalStorage || jitsiLocalStorage;\n    },\n\n    /**\n     * Returns current machine id.\n     * @returns {string} machine id\n     */\n    get machineId(): string {\n        if (!_machineId) {\n            const amDid = this._storage.getItem('billingId');\n\n            _machineId = amDid || this._storage.getItem('jitsiMeetId');\n\n            if (amDid) {\n                this._storage.setItem('jitsiMeetId', amDid);\n            } else if (!_machineId) {\n                _machineId = generateJitsiMeetId();\n                this._storage.setItem('jitsiMeetId', _machineId);\n            }\n        }\n\n        return _machineId!;\n    },\n\n    /**\n     * Returns current session id.\n     * @returns {string} current session id\n     */\n    get sessionId(): string {\n        // We may update sessionId in localStorage from another JitsiConference\n        // instance and that's why we should always re-read it.\n        return this._storage.getItem('sessionId') || '';\n    },\n\n    /**\n     * Save current session id.\n     * @param {string} sessionId session id\n     */\n    set sessionId(sessionId: string) {\n        if (sessionId) {\n            this._storage.setItem('sessionId', sessionId);\n        } else {\n            this._storage.removeItem('sessionId');\n        }\n    }\n};\n\n/**\n * Generate a random ID to be used for statistics.\n * @returns {string} the random ID\n */\nfunction _generateStatsId() {\n    const username = generateUsername();\n\n    logger.info('generated stats id', username);\n\n    return username;\n}\n\n/**\n * Generate unique id.\n * @returns {string} random unique id\n */\nfunction generateJitsiMeetId(): string {\n    const jitsiMeetId = uuidv4().replaceAll('-', '');\n\n    logger.info('generated id', jitsiMeetId);\n\n    return jitsiMeetId;\n}\n\nexport default Settings;\n","import { EventEmitter as NodeEventEmitter } from 'events';\n\nexport type EventListener = (...args: any[]) => void;\n\n/**\n * The class creates our own EventEmitter instance\n */\nexport default class EventEmitter extends NodeEventEmitter {\n    public addEventListener: typeof NodeEventEmitter.prototype.addListener;\n    public removeEventListener: typeof NodeEventEmitter.prototype.removeListener;\n\n    /**\n     * Creates new instance.\n     * @constructor\n     */\n    constructor() {\n        super();\n\n        // aliases for addListener/removeListener\n        this.addEventListener = this.addListener;\n        this.removeEventListener = this.removeListener;\n    }\n}\n","/**\n * Events emitted by the RTCStats module.\n */\nexport enum RTCStatsEvents {\n    /**\n     * Event that indicates that the microphone has been muted or unmuted.\n     *\n     * @param {boolean} muted - Whether microphone was muted.\n     */\n    AUDIO_MUTE_CHANGED_EVENT = 'audioMutedChanged',\n\n    /**\n     * Event that indicates that the video codec on the sender has changed.\n     *\n     * @param {object} data - The data.\n     * @param {CodecMimeType} data.camera - The codec used for camera source.\n     * @param {CodecMimeType} data.screenshare - The codec used for screenshare.\n     */\n    CODEC_CHANGED_EVENT = 'codecChanged',\n\n    /**\n     * Event that indicates that the conference start timestamp has been received from MUC.\n     */\n    CONFERENCE_START_TIMESTAMP_EVENT = 'conferenceStartTimestamp',\n\n    /**\n     * Event that indicates that the current user has become the dominant speaker for the conference.\n     */\n    DOMINANT_SPEAKER_CHANGED_EVENT = 'dominantSpeakerChanged',\n\n    /**\n     * Event that indicates that the encode resolution is being restricted by CPU.\n     *\n     * @param {boolean} restricted - Whether CPU restriction was detected or removed.\n     */\n    ENCODER_CPU_RESTRICTED_EVENT = 'cpuRestricted',\n\n    /**\n     * Event that indicates that the JVB media session is restarted because of ICE failure.\n     */\n    JVB_ICE_RESTARTED_EVENT = 'jvbIceRestarted',\n\n    /**\n     * Event for logging.\n     */\n    LOG_EVENT = 'logs',\n\n    /**\n     * Event that indicates that a remote video source's media stream has been interrupted.\n     */\n    REMOTE_SOURCE_INTERRUPTED_EVENT = 'remoteSourceInterrupted',\n\n    /**\n     * Event that indicates that a remote video source is suspended by the JVB because of BWE issues.\n     */\n    REMOTE_SOURCE_SUSPENDED_EVENT = 'remoteSourceSuspended',\n\n    /**\n     * Event emitted when any PeerConnection event is triggered.\n     *\n     * @param {object} event - The PeerConnection event.\n     * @param {string} event.type - The event type.\n     * @param {object} event.body - Event body.\n     * @param {string} event.body.isP2P - PeerConnection type.\n     * @param {string} event.body.state - PeerConnection state change which triggered the event.\n     */\n    RTC_STATS_PC_EVENT = 'rtstats_pc_event',\n\n    /**\n     * Event emitted when the websocket connection to the rtcstats server is disconnected.\n     */\n    RTC_STATS_WC_DISCONNECTED = 'rtcstats_ws_disconnected',\n\n    /**\n     * Event that indicates that the screenshare has started or stopped.\n     *\n     * @param {object} data - The data.\n     * @param {boolean} data.muted - Whether screenshare was toggled off or on.\n     */\n    SCREENSHARE_MUTE_CHANGED_EVENT = 'screenshareToggled',\n\n    /**\n     * Event that indicates that the strophe connection has disconnected.\n     */\n    STROPHE_DISCONNECTED_EVENT = 'stropheDisconnected',\n\n    /**\n     * Event that indicates that a strophe error has occurred.\n     *\n     * @param {object} data - The data.\n     */\n    STROPHE_ERROR_EVENT = 'strophe.error',\n\n    /**\n     * Event that indicates that the strophe connection has been re-established.\n     */\n    STROPHE_RECONNECTED_EVENT = 'stropheReconnected',\n\n    /**\n     * Event that indicates that the camera has been muted or unmuted.\n     *\n     * @param {boolean} muted - Whether camera was muted.\n     */\n    VIDEO_MUTE_CHANGED_EVENT = 'videoMutedChanged'\n}\n","import RTCStats from './RTCStats';\nimport { RTCStatsEvents } from './RTCStatsEvents';\n\n/**\n * The default log storage implementation.\n */\nexport default class DefaultLogStorage {\n    private rtcStats: any;\n\n    /**\n     * Creates new instance of <tt>DefaultLogStorage</tt>.\n     * @param rtcStats - The RTCStats instance.\n     */\n    constructor(rtcStats: any) {\n        this.rtcStats = rtcStats;\n    }\n\n\n    /**\n     * The DefaultLogStorage is ready when the RTCStats is ready.\n     *\n     * @returns {boolean} <tt>true</tt> when this storage is ready or\n     * <tt>false</tt> otherwise.\n     */\n    isReady() {\n        return this.rtcStats.isTraceAvailable();\n    }\n\n    /**\n     * Called by the <tt>LogCollector</tt> to store a series of log lines into\n     * batch.\n     *\n     * @param {Array<string|Object>} logEntries - An array containing strings\n     * representing log lines or aggregated lines objects.\n     * @returns {void}\n     */\n    storeLogs(logEntries: Array<string | any>) {\n        RTCStats.sendStatsEntry(RTCStatsEvents.LOG_EVENT, null, logEntries);\n    }\n}\n","import Logger, { getLogger } from '@jitsi/logger';\nimport rtcstatsInit from '@jitsi/rtcstats/rtcstats';\nimport traceInit from '@jitsi/rtcstats/trace-ws';\n\nimport JitsiConference from '../../JitsiConference';\nimport { JitsiConferenceEvents } from '../../JitsiConferenceEvents';\nimport JitsiConnection from '../../JitsiConnection';\nimport Settings from '../settings/Settings';\nimport EventEmitter from '../util/EventEmitter';\n\nimport DefaultLogStorage from './DefaulLogStorage';\nimport { RTCStatsEvents } from './RTCStatsEvents';\nimport { ITraceOptions } from './interfaces';\n\nconst logger = getLogger('analytics:RTCStats');\n\n/**\n * RTCStats Singleton that is initialized only once for the lifetime of the app, subsequent calls to init will be\n * ignored. Config and conference changes are handled by the start method.\n * RTCStats \"proxies\" WebRTC functions such as GUM and RTCPeerConnection by rewriting the global objects.\n * The proxies will then send data to the rtcstats server via the trace object.\n * The initialization procedure must be called once after lib-jitsi-meet is loaded.\n */\nclass RTCStats {\n    private _defaultLogCollector: any = null;\n    private _initialized: boolean = false;\n    private _startedWithNewConnection: boolean = true;\n    private _trace: any = null;\n    public events: EventEmitter = new EventEmitter();\n\n    isTraceAvailable(): boolean {\n        return this._trace !== null;\n    }\n\n    /**\n     * A JitsiConnection instance is created before the conference is joined, so even though\n     * we don't have any conference specific data yet, we can initialize the trace module and\n     * send any logs that might of otherwise be missed in case an error occurs between the connection\n     * and conference initialization.\n     *\n     * @param connection - The JitsiConnection instance.\n     * @returns {void}\n     */\n    startWithConnection(connection: JitsiConnection): void {\n        const { options } = connection;\n        const name = options?.name ?? '';\n        const {\n            analytics: {\n                rtcstatsEndpoint: endpoint = '',\n                rtcstatsEnabled = false,\n                rtcstatsPollInterval: pollInterval = 10000,\n                rtcstatsSendSdp: sendSdp = false\n            } = {},\n        } = options;\n\n        // Even though we have options being passed to init we need to recheck it as some client (react-native)\n        // don't always re-initialize the module and could create multiple connections with different options.\n        if (!rtcstatsEnabled) return;\n\n        // If rtcstats already initialized, do nothing.\n        // Calling rtcsatsInit multiple times will cause the global objects to be rewritten multiple times,\n        // with unforeseen consequences.\n        if (!this._initialized) {\n            rtcstatsInit(\n                { statsEntry: this.sendStatsEntry.bind(this) },\n                { eventCallback: event => this.events.emit(RTCStatsEvents.RTC_STATS_PC_EVENT, event),\n                    pollInterval,\n                    sendSdp,\n                    useLegacy: false }\n            );\n            this._initialized = true;\n        }\n\n        const traceOptions: ITraceOptions = {\n            endpoint,\n            isBreakoutRoom: false,\n            meetingFqn: name\n        };\n\n        // Can't be a breakout room.\n        this._connectTrace(traceOptions);\n\n        this._defaultLogCollector?.flush();\n\n        this.sendIdentity({\n            confName: name,\n            ...options\n        });\n\n        // This module is tightly tied with the ljm JitsiConnection and JitsiConference flows, technically\n        // the connection isn't associated with a conference, but we still need to have some association for\n        // data that is logged before the conference is joined.\n        // In short the flow is as follows:\n        // 1. Connection is created.\n        // 2. The trace module is initialized and connected to the rtcstats server, so data starts being sent.\n        // 3. Conference is created.\n        // 4. If the trace wasn't already initialized from the connection creation, it will be initialized again.\n        // this will take care of the cases where the connection is created and then multiple conferences are\n        // sequentially joined and left, such as breakout rooms.\n        this._startedWithNewConnection = true;\n    }\n\n    /**\n     * When a conference is about to start, we need to reset the trace module, and initialize it with the\n     * new conference's config. On a normal conference flow this wouldn't be necessary, as the whole page is\n     * reloaded, but in the case of breakout rooms or react native the js context doesn't reload, hence the\n     * RTCStats singleton and its config persists between conferences.\n     *\n     * @param conference - JitsiConference instance that's about to start.\n     * @returns {void}\n     */\n    attachToConference(conference: JitsiConference): void {\n        const {\n            options: {\n                config: confConfig = {},\n                name: confName = ''\n            } = {},\n            _statsCurrentId: displayName = ''\n        } = conference;\n\n        const {\n            analytics: {\n                rtcstatsEnabled = false,\n                rtcstatsEndpoint: endpoint = ''\n            } = {}\n        } = confConfig;\n\n        // The statisticsId, statisticsDisplayName and _statsCurrentId (renamed to displayName) fields\n        // that are sent through options might be a bit confusing. Depending on the context, they could\n        // be intermixed inside ljm, for instance _statsCurrentId might refer to the email field which is stored\n        // in statisticsId or it could have the same value as callStatsUserName.\n        // The following is the mapping between the fields, and a short explanation of each:\n        // statisticsId -> email, this is only send by jitsi-meet if enableEmailInStats option is set.\n        // statisticsDisplayName -> nick, this is only send by jitsi-meet if enableDisplayNameInStats option is set.\n        // localId, this is the unique id that is used to track users throughout stats.\n        const localId = Settings?.callStatsUserName ?? '';\n\n        // The new conference config might have rtcstats disabled, so we need to check again.\n        if (!rtcstatsEnabled) {\n            return;\n        }\n\n        // If rtcstats proxy module is not initialized, do nothing.\n        if (!this._initialized) {\n            logger.error('Calling attachToConference before RTCStats proxy module is initialized.');\n\n            return;\n        }\n\n        // When the conference is joined, we need to initialize the trace module with the new conference's config.\n        // The trace module will then connect to the rtcstats server and send the identity data.\n        conference.once(JitsiConferenceEvents.CONFERENCE_JOINED, () => {\n            const isBreakoutRoom = Boolean(conference.getBreakoutRooms()?.isBreakoutRoom());\n            const endpointId = conference.myUserId();\n            const meetingUniqueId = conference.getMeetingUniqueId();\n\n            // Connect to the rtcstats server instance. Stats (data obtained from getstats) won't be send until the\n            // connect successfully initializes, however calls to GUM are recorded in an internal buffer even if not\n            // connected and sent once it is established.\n            if (!this._startedWithNewConnection) {\n                const traceOptions = {\n                    endpoint,\n                    isBreakoutRoom,\n                    meetingFqn: confName\n                };\n\n                this._connectTrace(traceOptions);\n\n                // In cases where the conference was left but the connection was not closed,\n                // logs could get cached, so we flush them as soon as we get a chance after the\n                // conference is joined.\n                this._defaultLogCollector?.flush();\n            }\n\n            const identityData = {\n                ...confConfig,\n                confName,\n                displayName,\n                endpointId,\n                isBreakoutRoom,\n                localId,\n                meetingUniqueId\n            };\n\n            this.sendIdentity(identityData);\n            // Reset the flag, so that the next conference that is joined will have the trace module initialized, such as a breakout room.\n            this._startedWithNewConnection = false;\n        });\n\n        // Note, this will only be called for normal rooms, not breakout rooms.\n        conference.once(JitsiConferenceEvents.CONFERENCE_UNIQUE_ID_SET, meetingUniqueId => {\n            this.sendIdentity({ meetingUniqueId });\n        });\n\n        conference.once(JitsiConferenceEvents.CONFERENCE_LEFT, () => {\n            this.reset();\n        });\n\n        conference.once(JitsiConferenceEvents.CONFERENCE_CREATED_TIMESTAMP, (timestamp: number) => {\n            this.sendStatsEntry(RTCStatsEvents.CONFERENCE_START_TIMESTAMP_EVENT, null, timestamp);\n        });\n\n        conference.once(\n            JitsiConferenceEvents.BEFORE_STATISTICS_DISPOSED,\n            () => this._defaultLogCollector?.flush()\n        );\n    }\n\n    /**\n     * Reset and connects the trace module to the s server.\n     *\n     * @param traceOptions - Options for the trace module.\n     * @returns {void}\n     */\n    _connectTrace(traceOptions: ITraceOptions): void {\n\n        const traceOptionsComplete = {\n            ...traceOptions,\n            onCloseCallback: event => this.events.emit(RTCStatsEvents.RTC_STATS_WC_DISCONNECTED, event),\n            useLegacy: false\n        };\n\n        const { isBreakoutRoom } = traceOptionsComplete;\n\n        this.reset();\n        this._trace = traceInit(traceOptionsComplete);\n        this._trace.connect(isBreakoutRoom);\n    }\n\n    /**\n     * Sends the identity data to the rtcstats server.\n     *\n     * @param identityData - Identity data to send.\n     * @returns {void}\n     */\n    sendIdentity(identityData: any): void {\n        this._trace?.identity('identity', null, identityData);\n    }\n\n    /**\n     * Resets the trace module by closing the websocket and deleting the object.\n     * After reset, the rtcstats proxy module that tries to send data via `sendStatsEntry`, will no longer\n     * send any data, until the trace module is initialized again. This comes in handy on react-native\n     * where ljm doesn't get reloaded, so we need to switch the trace module between conferences.\n     *\n     * @returns {void}\n     */\n    reset(): void {\n        // If a trace is connected, flush the remaining logs before closing the connection,\n        // if the trace is not present and we flush the logs will be lost,\n        this._trace && this._defaultLogCollector?.flush();\n        this._trace?.close();\n        this._trace = null;\n    }\n\n    /**\n     * Sends a stats entry to the rtcstats server. This is called by the rtcstats proxy module,\n     * or any other app that wants to send custom stats.\n     *\n     * @param entry - Stats entry to send.\n     * @returns {void}\n     */\n    sendStatsEntry(statsType: RTCStatsEvents, pcId?: Optional<string>, data?: Optional<any>): void {\n        this._trace?.statsEntry(statsType, pcId, data);\n    }\n\n    /**\n     * Creates a new log collector with the default log storage.\n     */\n    getDefaultLogCollector(maxEntryLength: number = 10000): void {\n        if (!this._defaultLogCollector) {\n            // If undefined is passed  as maxEntryLength LogCollector will default to 10000 bytes\n            this._defaultLogCollector = new Logger.LogCollector(new DefaultLogStorage(this), { maxEntryLength });\n            this._defaultLogCollector.start();\n        }\n\n        return this._defaultLogCollector;\n    }\n}\n\nexport default new RTCStats();\n","/**\n * This class exports constants and factory methods related to the analytics\n * API provided by AnalyticsAdapter. In order for entries in a database to be\n * somewhat easily traceable back to the code which produced them, events sent\n * through analytics should be defined here.\n *\n * Since the AnalyticsAdapter API can be used in different ways, for some events\n * it is more convenient to just define the event name as a constant. For other\n * events a factory function is easier.\n *\n * A general approach for adding a new event:\n * 1. Determine the event type: track, UI, page, or operational. If in doubt use\n * operational.\n * 2. Determine whether the event is related to other existing events, and\n * which fields are desired to be set: name, action, actionSubject, source.\n * 3. If the name is sufficient (the other fields are not important), use a\n * constant. Otherwise use a factory function.\n *\n * Note that the AnalyticsAdapter uses the events passed to its functions for\n * its own purposes, and might modify them. Because of this, factory functions\n * should create new objects.\n *\n */\n\nexport enum AnalyticsEvents {\n\n    /**\n     * The \"action\" value for Jingle events which indicates that the Jingle session\n     * was restarted (TODO: verify/fix the documentation)\n     */\n    ACTION_JINGLE_RESTART = 'restart',\n\n    /**\n     * The \"action\" value for Jingle events which indicates that a session-accept\n     * timed out (TODO: verify/fix the documentation)\n     */\n    ACTION_JINGLE_SA_TIMEOUT = 'session-accept.timeout',\n\n    /**\n     * The \"action\" value for Jingle events which indicates that a session-initiate\n     * was received.\n     */\n    ACTION_JINGLE_SI_RECEIVED = 'session-initiate.received',\n\n    /**\n     * The \"action\" value for Jingle events which indicates that a session-initiate\n     * not arrived within a timeout (the value is specified in\n     * the {@link JingleSessionPC}.\n     */\n    ACTION_JINGLE_SI_TIMEOUT = 'session-initiate.timeout',\n\n    /**\n     * A constant for the \"terminate\" action for Jingle events. TODO: verify/fix\n     * the documentation)\n     */\n    ACTION_JINGLE_TERMINATE = 'terminate',\n\n    /**\n     * The \"action\" value for JVB events which indicates that the ICE connection has failed after 3 restart attempts\n     */\n    ACTION_JVB_ICE_FAILED = 'jvb.ice.failed',\n\n    /**\n     * The \"action\" value for P2P events which indicates that P2P session initiate message has been rejected by the\n     * client because the mandatory requirements were not met.\n     */\n    ACTION_P2P_DECLINED = 'decline',\n\n    /**\n     * The \"action\" value for P2P events which indicates that a connection was\n     * established (TODO: verify/fix the documentation)\n     */\n    ACTION_P2P_ESTABLISHED = 'established',\n\n    /**\n     * The \"action\" value for P2P events which indicates that something failed.\n     */\n    ACTION_P2P_FAILED = 'failed',\n\n    /**\n     * The \"action\" value for P2P events which indicates that a switch to\n     * jitsi-videobridge happened.\n     */\n    ACTION_P2P_SWITCH_TO_JVB = 'switch.to.jvb',\n\n    /**\n     * The name of an event which indicates an available device. We send one such\n     * event per available device once when the available devices are first known,\n     * and every time that they change\n     *\n     * Properties:\n     *      audio_input_device_count: the number of audio input devices available at\n     *          the time the event was sent.\n     *      audio_output_device_count: the number of audio output devices available\n     *          at the time the event was sent.\n     *      video_input_device_count: the number of video input devices available at\n     *          the time the event was sent.\n     *      video_output_device_count: the number of video output devices available\n     *          at the time the event was sent.\n     *      device_id: an identifier of the device described in this event.\n     *      device_group_id:\n     *      device_kind: one of 'audioinput', 'audiooutput', 'videoinput' or\n     *          'videooutput'.\n     *      device_label: a string which describes the device.\n     */\n    AVAILABLE_DEVICE = 'available.device',\n\n    /**\n     * This appears to be fired only in certain cases when the XMPP connection\n     * disconnects (and it was intentional?). It is currently never observed to\n     * fire in production.\n     *\n     * TODO: document\n     *\n     * Properties:\n     *      message: an error message\n     */\n    CONNECTION_DISCONNECTED = 'connection.disconnected',\n\n    /**\n     * Indicates that the user of the application provided feedback in terms of a\n     * rating (an integer from 1 to 5) and an optional comment.\n     * Properties:\n     *      value: the user's rating (an integer from 1 to 5)\n     *      comment: the user's comment\n     */\n    FEEDBACK = 'feedback',\n\n    /**\n     * Indicates the duration of a particular phase of the ICE connectivity\n     * establishment.\n     *\n     * Properties:\n     *      phase: the ICE phase (e.g. 'gathering', 'checking', 'establishment')\n     *      value: the duration in milliseconds.\n     *      p2p: whether the associated ICE connection is p2p or towards a\n     *          jitsi-videobridge\n     *      initiator: whether the local Jingle peer is the initiator or responder\n     *          in the Jingle session. XXX we probably actually care about the ICE\n     *          role (controlling vs controlled), and we assume that this correlates\n     *          with the Jingle initiator.\n     */\n    ICE_DURATION = 'ice.duration',\n\n    /**\n     * Indicates the difference in milliseconds between the ICE establishment time\n     * for the P2P and JVB connections (e.g. a value of 10 would indicate that the\n     * P2P connection took 10ms more than JVB connection to establish).\n     *\n     * Properties:\n     *      value: the difference in establishment durations in milliseconds.\n     *\n     */\n    ICE_ESTABLISHMENT_DURATION_DIFF = 'ice.establishment.duration.diff',\n\n    /**\n     * Indicates that the ICE state has changed.\n     *\n     * Properties:\n     *      state: the ICE state which was entered (e.g. 'checking', 'connected',\n     *          'completed', etc).\n     *      value: the time in milliseconds (as reported by\n     *          window.performance.now()) that the state change occurred.\n     *      p2p: whether the associated ICE connection is p2p or towards a\n     *          jitsi-videobridge\n     *      signalingState: The signaling state of the associated PeerConnection\n     *      reconnect: whether the associated Jingle session is in the process of\n     *          reconnecting (or is it ICE? TODO: verify/fix the documentation)\n     */\n    ICE_STATE_CHANGED = 'ice.state.changed',\n\n    /**\n     * Indicates that no bytes have been sent for the track.\n     *\n     * Properties:\n     *      mediaType: the media type of the local track ('audio' or 'video').\n     */\n    NO_BYTES_SENT = 'track.no-bytes-sent',\n\n    /**\n     * Indicates that a track was unmuted (?).\n     *\n     * Properties:\n     *      mediaType: the media type of the local track ('audio' or 'video').\n     *      trackType: the type of the track ('local' or 'remote').\n     *      value: TODO: document\n     */\n    TRACK_UNMUTED = 'track.unmuted',\n\n    /**\n     * The constant which identifies an event of type \"operational\".\n     */\n    TYPE_OPERATIONAL = 'operational',\n\n    /**\n     * The constant which identifies an event of type \"page\".\n     */\n    TYPE_PAGE = 'page',\n\n    /**\n     * The constant which identifies an event of type \"track\".\n     */\n    TYPE_TRACK = 'track',\n\n    /**\n     * The constant which identifies an event of type \"ui\".\n     */\n    TYPE_UI = 'ui',\n\n    /**\n     * Indicates that the video codec changed for a local track.\n     *\n     * Properties:\n     *      value: the video codec mimeType.\n     *      videoType: the videoType of local track, whether its 'camera' or 'desktop'.\n     */\n    VIDEO_CODEC_CHANGED = 'quality.video-codec-changed',\n}\n\n/**\n * Creates an operational event which indicates that we have received a\n * \"bridge down\" event from jicofo.\n */\nexport const createBridgeDownEvent = () => {\n    return {\n        action: 'bridge.down',\n        actionSubject: 'bridge.down',\n        type: AnalyticsEvents.TYPE_OPERATIONAL\n    };\n};\n\n/**\n * Creates an event which indicates that the XMPP connection failed\n * @param errorType TODO\n * @param errorMessage TODO\n * @param detail connection failed details.\n */\nexport const createConnectionFailedEvent = (errorType: unknown, errorMessage: unknown, details: object) => {\n    return {\n        action: 'connection.failed',\n        attributes: {\n            'error_message': errorMessage,\n            'error_type': errorType,\n            ...details\n        },\n        type: AnalyticsEvents.TYPE_OPERATIONAL\n    };\n};\n\n/**\n * Creates a conference event.\n *\n * @param action - The action of the event.\n * @param attributes - The attributes to be added to the event.\n */\nexport const createConferenceEvent = (action: string, attributes: object) => {\n    return {\n        action,\n        attributes,\n        source: 'conference',\n        type: AnalyticsEvents.TYPE_OPERATIONAL\n    };\n};\n\n/**\n * Creates an operational event which indicates that a particular connection\n * stage was reached (i.e. the XMPP connection transitioned to the \"connected\"\n * state).\n *\n * @param stage the stage which was reached\n * @param attributes additional attributes for the event. This should be an\n * object with a \"value\" property indicating a timestamp in milliseconds\n * relative to the beginning of the document's lifetime.\n *\n */\nexport const createConnectionStageReachedEvent = (stage: unknown, attributes: object) => {\n    return {\n        action: 'connection.stage.reached',\n        actionSubject: stage,\n        attributes,\n        source: 'connection.stage.reached',\n        type: AnalyticsEvents.TYPE_OPERATIONAL\n    };\n};\n\n/**\n * Creates an operational event for the end-to-end round trip time to a\n * specific remote participant.\n * @param participantId the ID of the remote participant.\n * @param region the region of the remote participant\n * @param rtt the rtt\n */\nexport const createE2eRttEvent = (participantId: unknown, region: unknown, rtt: unknown) => {\n    return {\n        attributes: {\n            'participant_id': participantId,\n            region,\n            rtt\n        },\n        name: 'e2e_rtt',\n        type: AnalyticsEvents.TYPE_OPERATIONAL\n    };\n};\n\n/**\n * Creates an event which indicates that the focus has left the MUC.\n */\nexport const createFocusLeftEvent = () => {\n    return {\n        action: 'focus.left',\n        actionSubject: 'focus.left',\n        type: AnalyticsEvents.TYPE_OPERATIONAL\n    };\n};\n\n/**\n * Creates an event related to a getUserMedia call.\n *\n * @param action the type of the result that the event represents: 'error',\n * 'success', 'warning', etc.\n * @param attributes the attributes to attach to the event.\n */\nexport const createGetUserMediaEvent = (action: 'error' | 'success' | 'warning' | string, attributes: object = {}) => {\n    return {\n        action,\n        attributes,\n        source: 'get.user.media',\n        type: AnalyticsEvents.TYPE_OPERATIONAL\n    };\n};\n\n/**\n * Creates an event which indicates that the JVB ICE connection has failed event after 3 retries.\n *\n * @param action - The action type of the event.\n * @param attributes - The attributes to be added to the event.\n * @returns - The event object.\n */\nexport const createJvbIceFailedEvent = (action: unknown, attributes: object = {}) => {\n    return {\n        action,\n        attributes,\n        type: AnalyticsEvents.TYPE_OPERATIONAL\n    };\n};\n\n/**\n * Creates an event related to remote participant connection status changes.\n *\n * @param attributes the attributes to attach to the event.\n */\nexport const createParticipantConnectionStatusEvent = (attributes: object = {}) => {\n    return {\n        action: 'duration',\n        attributes,\n        source: 'peer.conn.status',\n        type: AnalyticsEvents.TYPE_OPERATIONAL\n    };\n};\n\n/**\n * Creates an event related to remote track streaming status changes.\n *\n * @param attributes the attributes to attach to the event.\n */\nexport const createTrackStreamingStatusEvent = (attributes: object = {}) => {\n    return {\n        action: 'duration',\n        attributes,\n        source: 'track.streaming.status',\n        type: AnalyticsEvents.TYPE_OPERATIONAL\n    };\n};\n\n/**\n * Creates an event for a Jingle-related event.\n * @param action the action of the event\n * @param attributes attributes to add to the event.\n */\nexport const createJingleEvent = (action: unknown, attributes: object = {}) => {\n    return {\n        action,\n        attributes,\n        source: 'jingle',\n        type: AnalyticsEvents.TYPE_OPERATIONAL\n    };\n};\n\n/**\n * Creates an event which indicates that a local track was not able to read\n * data from its source (a camera or a microphone).\n *\n * @param mediaType the media type of the local track ('audio' or\n * 'video').\n */\nexport const createNoDataFromSourceEvent = (mediaType: 'audio' | 'video' | string, value: unknown) => {\n    return {\n        action: 'track.no.data.from.source',\n        attributes: {\n            'media_type': mediaType,\n            value\n        },\n        type: AnalyticsEvents.TYPE_OPERATIONAL\n    };\n};\n\n/**\n * Creates an event for a p2p-related event.\n * @param action the action of the event\n * @param attributes attributes to add to the event.\n */\nexport const createP2PEvent = (action: unknown, attributes: object = {}) => {\n    return {\n        action,\n        attributes,\n        source: 'p2p',\n        type: AnalyticsEvents.TYPE_OPERATIONAL\n    };\n};\n\n/**\n * Indicates that we received a remote command to mute.\n */\nexport const createRemotelyMutedEvent = (mediaType: unknown) => {\n    return {\n        action: 'remotely.muted',\n        mediaType,\n        type: AnalyticsEvents.TYPE_OPERATIONAL\n    };\n};\n\n/**\n * Creates an event which contains RTP statistics such as RTT and packet loss.\n *\n * All average RTP stats are currently reported under 1 event name, but with\n * different properties that allows to distinguish between a P2P call, a\n * call relayed through TURN or the JVB, and multiparty vs 1:1.\n *\n * The structure of the event is:\n *\n * {\n *      p2p: true,\n *      conferenceSize: 2,\n *      localCandidateType: \"relay\",\n *      remoteCandidateType: \"relay\",\n *      transportType: \"udp\",\n *\n *      // Average RTT of 200ms\n *      \"rtt.avg\": 200,\n *      \"rtt.samples\": \"[100, 200, 300]\",\n *\n *      // Average packet loss of 10%\n *      \"packet.loss.avg\": 10,\n *      \"packet.loss.samples\": '[5, 10, 15]'\n *\n *      // Difference in milliseconds in the end-to-end RTT between p2p and jvb.\n *      // The e2e RTT through jvb is 15ms shorter:\n *      \"rtt.diff\": 15,\n *\n *      // End-to-end RTT through JVB is ms.\n *      \"end2end.rtt.avg\" = 100\n * }\n *\n * Note that the value of the \"samples\" properties are (JSON encoded) strings,\n * and not JSON arrays, as events' attributes can not be nested. The samples are\n * currently included for debug purposes only and can be removed anytime soon\n * from the structure.\n *\n * Also note that not all of values are present in each event, as values are\n * obtained and calculated as part of different process/event pipe. For example\n * {@link ConnectionAvgStats} instances are doing the reports for each\n * {@link TraceablePeerConnection} and work independently from the main stats\n * pipe.\n */\nexport const createRtpStatsEvent = (attributes: object) => {\n    return {\n        action: 'rtp.stats',\n        attributes,\n        type: AnalyticsEvents.TYPE_OPERATIONAL\n    };\n};\n\n/**\n * Creates an event which contains the round trip time (RTT) to a set of\n * regions.\n *\n * @param attributes\n */\nexport const createRttByRegionEvent = (attributes: object) => {\n    return {\n        action: 'rtt.by.region',\n        attributes,\n        type: AnalyticsEvents.TYPE_OPERATIONAL\n    };\n};\n\n/**\n * Creates an event which contains the local and remote ICE candidate types\n * for the transport that is currently selected.\n *\n * @param attributes\n */\nexport const createTransportStatsEvent = (attributes: object) => {\n    return {\n        action: 'transport.stats',\n        attributes,\n        type: AnalyticsEvents.TYPE_OPERATIONAL\n    };\n};\n\n/**\n * Creates an event which contains information about the audio output problem (the user id of the affected participant,\n * the local audio levels and the remote audio levels that triggered the event).\n *\n * @param userID - The user id of the affected participant.\n * @param localAudioLevels - The local audio levels.\n * @param remoteAudioLevels - The audio levels received from the participant.\n */\nexport const createAudioOutputProblemEvent\n    = (userID: string, localAudioLevels: unknown, remoteAudioLevels: unknown) => {\n        return {\n            action: 'audio.output.problem',\n            attributes: {\n                localAudioLevels,\n                remoteAudioLevels,\n                userID\n            },\n            type: AnalyticsEvents.TYPE_OPERATIONAL\n        };\n    };\n\n/**\n * Creates an event which contains an information related to the bridge channel close event.\n *\n * @param code - A code from {@link https://developer.mozilla.org/en-US/docs/Web/API/CloseEvent}\n * @param reason - A string which describes the reason for closing the bridge channel.\n */\nexport const createBridgeChannelClosedEvent = (code: string, reason: string) => {\n    return {\n        action: 'bridge-channel.error',\n        attributes: {\n            code,\n            reason\n        },\n        type: AnalyticsEvents.TYPE_OPERATIONAL\n    };\n};\n\n/**\n * Creates an event which indicates the Time To First Media (TTFM).\n * It is measured in milliseconds relative to the beginning of the document's\n * lifetime (i.e. the origin used by window.performance.now()), and it excludes\n * the following:\n * 1. The delay due to getUserMedia()\n * 2. The period between the MUC being joined and the reception of the Jingle\n * session-initiate from jicofo. This is because jicofo will not start a Jingle\n * session until there are at least 2 participants in the room.\n *\n * @param attributes the attributes to add to the event. Currently used fields:\n *      mediaType: the media type of the local track ('audio' or 'video').\n *      muted: whether the track has ever been muted (?)\n *      value: the TTMF in milliseconds.\n */\nexport const createTtfmEvent = (attributes: object) => createConnectionStageReachedEvent('ttfm', attributes);\n","export enum StatisticsEvents {\n\n    /**\n     * Notifies about audio level in RTP statistics by SSRC.\n     *\n     * @param ssrc - The synchronization source identifier (SSRC) of the\n     * endpoint/participant whose audio level is being reported.\n     * @param {number} audioLevel - The audio level of <tt>ssrc</tt> according to\n     * RTP statistics.\n     * @param {boolean} isLocal - <tt>true</tt> if <tt>ssrc</tt> identifies the\n     * local endpoint/participant; otherwise, <tt>false</tt>.\n     */\n    AUDIO_LEVEL = 'statistics.audioLevel',\n\n    /**\n     * An event fired just before the statistics module gets disposes and it's\n     * the last chance to submit logs.\n     */\n    BEFORE_DISPOSED = 'statistics.before_disposed',\n\n    /**\n     * An event carrying all statistics by ssrc.\n     */\n    BYTE_SENT_STATS = 'statistics.byte_sent_stats',\n\n    /**\n     * An event carrying connection statistics.\n     *\n     * @param {object} connectionStats - The connection statistics carried by the\n     * event such as <tt>bandwidth</tt>, <tt>bitrate</tt>, <tt>packetLoss</tt>,\n     * <tt>resolution</tt>, and <tt>transport</tt>.\n     */\n    CONNECTION_STATS = 'statistics.connectionstats',\n\n    /**\n     * An event carrying the encode time stats for all the local video sources.\n     */\n    ENCODE_TIME_STATS = 'statistics.encode_time_stats',\n}\n","import BrowserCapabilities from './BrowserCapabilities';\n\nexport default new BrowserCapabilities();\n","import BrowserDetection from '@jitsi/js-utils/browser-detection/BrowserDetection';\n\n/* Minimum required Chrome / Chromium version. This applies also to derivatives. */\nconst MIN_REQUIRED_CHROME_VERSION = 72;\nconst MIN_REQUIRED_FIREFOX_VERSION = 91;\nconst MIN_REQUIRED_SAFARI_VERSION = 14;\nconst MIN_REQUIRED_IOS_VERSION = 14;\n\n// Starting with iPadOS 13 the actual Safari / iPadOS version is concealed from the UA string and\n// the system pretends to be macOS 10.15.7. Yeah, you read that right.\nconst FROZEN_MACOS_VERSION = '10.15.7';\n\n// TODO: Move this code to js-utils.\n\n// NOTE: Now we are extending BrowserDetection in order to preserve\n// RTCBrowserType interface but maybe it worth exporting BrowserCapabilities\n// and BrowserDetection as separate objects in future.\n\n/**\n * Implements browser capabilities for lib-jitsi-meet.\n */\nexport default class BrowserCapabilities extends BrowserDetection {\n    /**\n     * Returns the version of an ios browser.\n     *\n     * @returns {Number}\n     */\n    _getIOSVersion(): number {\n        if (this.isWebKitBased()) {\n            return Number.parseInt(this.getOSVersion(), 10);\n        }\n\n        return -1;\n    }\n\n    /**\n     * Returns the version of a Safari browser.\n     *\n     * @returns {Number}\n     */\n    _getSafariVersion(): number {\n        if (this.isSafari()) {\n            return Number.parseInt(this.getVersion(), 10);\n        }\n\n        return -1;\n    }\n\n    /**\n     * Tells whether or not the <tt>MediaStream/tt> is removed from the <tt>PeerConnection</tt> and disposed on video\n     * mute (in order to turn off the camera device). This is needed on Firefox because of the following bug\n     * https://bugzilla.mozilla.org/show_bug.cgi?id=1735951\n     *\n     * @return {boolean} <tt>true</tt> if the current browser supports this strategy or <tt>false</tt> otherwise.\n     */\n    doesVideoMuteByStreamRemove(): boolean {\n        return this.isChromiumBased() || this.isWebKitBased() || this.isFirefox();\n    }\n\n    /**\n     * Checks if the client is running on an Android browser.\n     *\n     * @returns {boolean}\n     */\n    isAndroidBrowser(): boolean {\n        return !this.isReactNative() && this.getOS() === 'Android';\n    }\n\n    /**\n     * Checks if the current platform is iOS.\n     *\n     * @returns {boolean}\n     */\n    isIosBrowser(): boolean {\n        return !this.isReactNative() && this.getOS() === 'iOS';\n    }\n\n    /**\n     * Checks if the client is running on a mobile device.\n     *\n     * @returns {boolean}\n     */\n    isMobileDevice(): boolean {\n        return this.isAndroidBrowser() || this.isIosBrowser() || this.isReactNative();\n    }\n\n    /**\n     * Checks whether current running context is a Trusted Web Application.\n     *\n     * @returns {boolean} Whether the current context is a TWA.\n     */\n    isTwa(): boolean {\n        return 'matchMedia' in window && window.matchMedia('(display-mode:standalone)').matches;\n    }\n\n    /**\n     * Checks if the current browser is supported.\n     *\n     * @returns {boolean} true if the browser is supported, false otherwise.\n     */\n    isSupported(): boolean {\n        // First check for WebRTC APIs because some \"security\" extensions are dumb.\n        if (typeof RTCPeerConnection === 'undefined'\n                || !navigator?.mediaDevices?.enumerateDevices || !navigator?.mediaDevices?.getUserMedia) {\n            return false;\n        }\n\n        if (this.isSafari() && this._getSafariVersion() < MIN_REQUIRED_SAFARI_VERSION) {\n            return false;\n        }\n\n        return (this.isChromiumBased() && this.isEngineVersionGreaterThan(MIN_REQUIRED_CHROME_VERSION - 1))\n            || (this.isFirefox() && this.isVersionGreaterThan(MIN_REQUIRED_FIREFOX_VERSION - 1))\n            || this.isReactNative()\n            || this.isWebKitBased();\n    }\n\n    /**\n     * Returns whether the browser is supported for Android.\n     *\n     * @returns {boolean} true if the browser is supported for Android devices.\n     */\n    isSupportedAndroidBrowser(): boolean {\n        return this.isChromiumBased() || this.isFirefox();\n    }\n\n    /**\n     * Returns whether the browser is supported for iOS.\n     *\n     * @returns {boolean} true if the browser is supported for iOS devices.\n     */\n    isSupportedIOSBrowser(): boolean {\n        // After iPadOS 13 we have no way to know the Safari or iPadOS version, so YOLO.\n        if (!this.isSafari() && this.isWebKitBased() && this.getOSVersion() === FROZEN_MACOS_VERSION) {\n            return true;\n        }\n\n        return this._getSafariVersion() >= MIN_REQUIRED_IOS_VERSION\n                || this._getIOSVersion() >= MIN_REQUIRED_IOS_VERSION;\n    }\n\n    /**\n     * Returns whether or not the current environment needs a user interaction\n     * with the page before any unmute can occur.\n     *\n     * @returns {boolean}\n     */\n    isUserInteractionRequiredForUnmute(): boolean {\n        return this.isFirefox() && this.isVersionLessThan(68);\n    }\n\n    /**\n     * Checks if the current browser triggers 'onmute'/'onunmute' events when\n     * user's connection is interrupted and the video stops playback.\n     *\n     * @returns {*|boolean} 'true' if the event is supported or 'false' otherwise.\n     */\n    supportsVideoMuteOnConnInterrupted(): any | boolean {\n        return this.isChromiumBased() || this.isReactNative();\n    }\n\n    /**\n     * Checks if the current browser reports upload and download bandwidth statistics.\n     *\n     * @return {boolean}\n     */\n    supportsBandwidthStatistics(): boolean {\n        // FIXME bandwidth stats are currently not implemented for FF on our\n        // side, but not sure if not possible ?\n        return !this.isFirefox() && !this.isWebKitBased();\n    }\n\n    /**\n     * Checks if the current browser supports setting codec preferences on the transceiver.\n     *\n     * @returns {boolean}\n     */\n    supportsCodecPreferences(): boolean {\n        return Boolean('setCodecPreferences' in window.RTCRtpTransceiver?.prototype\n            && typeof window.RTCRtpReceiver?.getCapabilities !== 'undefined')\n\n            // this is not working on Safari because of the following bug\n            // https://bugs.webkit.org/show_bug.cgi?id=215567\n            && !this.isWebKitBased()\n\n            // Calling this API on Firefox is causing freezes when the local endpoint is the answerer.\n            // https://bugzilla.mozilla.org/show_bug.cgi?id=1917800\n            && !this.isFirefox();\n    }\n\n    /**\n     * Checks if the browser supports the new codec selection API, i.e., checks if dictionary member\n     * RTCRtpEncodingParameters.codec as defined in\n     * https://w3c.github.io/webrtc-extensions/#dom-rtcrtpencodingparameters-codec is supported by the browser. It\n     * allows the application to change the current codec used by each RTCRtpSender without a renegotiation.\n     *\n     * @returns {boolean}\n     */\n    supportsCodecSelectionAPI(): boolean {\n        return this.isChromiumBased() && this.isEngineVersionGreaterThan(125);\n    }\n\n    /**\n     * Returns true if the browser supports Dependency Descriptor header extension.\n     *\n     * @returns {boolean}\n     */\n    supportsDDExtHeaders(): boolean {\n        return !(this.isFirefox() && this.isVersionLessThan(136));\n    }\n\n    /**\n     * Checks if the current browser support the device change event.\n     * @return {boolean}\n     */\n    supportsDeviceChangeEvent(): boolean {\n        return typeof navigator.mediaDevices?.ondevicechange !== 'undefined'\n            && typeof navigator.mediaDevices?.addEventListener !== 'undefined';\n    }\n\n    /**\n     * Checks if the current browser supports audio level stats on the receivers.\n     *\n     * @return {boolean}\n     */\n    supportsReceiverStats(): boolean {\n        return typeof window.RTCRtpReceiver !== 'undefined'\n            && Object.keys(RTCRtpReceiver.prototype).indexOf('getSynchronizationSources') > -1;\n    }\n\n    /**\n     * Checks if the current browser reports round trip time statistics for the ICE candidate pair.\n     *\n     * @return {boolean}\n     */\n    supportsRTTStatistics(): boolean {\n        // Firefox does not seem to report RTT for ICE candidate pair:\n        // eslint-disable-next-line max-len\n        // https://www.w3.org/TR/webrtc-stats/#dom-rtcicecandidatepairstats-currentroundtriptime\n        // It does report mozRTT for RTP streams, but at the time of this\n        // writing it's value does not make sense most of the time\n        // (is reported as 1):\n        // https://bugzilla.mozilla.org/show_bug.cgi?id=1241066\n        // For Chrome and others we rely on 'googRtt'.\n        return !this.isFirefox();\n    }\n\n    /**\n     * Returns true if the browser supports the new Scalability Mode API for VP9/AV1 simulcast and full SVC. H.264\n     * simulcast will also be supported by the jvb for this version because the bridge is able to read the Dependency\n     * Descriptor RTP header extension to extract layers information for H.264 as well.\n     *\n     * @returns {boolean}\n     */\n    supportsScalabilityModeAPI(): boolean {\n        return this.isChromiumBased() && this.isEngineVersionGreaterThan(112);\n    }\n\n    /**\n     * Returns true if the browser supports track based statistics for the local video track. Otherwise,\n     * track resolution and framerate will be calculated based on the 'outbound-rtp' statistics.\n     *\n     * @returns {boolean}\n     */\n    supportsTrackBasedStats(): boolean {\n        return this.isChromiumBased() && this.isEngineVersionLessThan(112);\n    }\n\n    /**\n     * Returns true if VP9 is supported by the client on the browser. VP9 is currently disabled on Safari\n     * and older versions of Firefox because of issues. Please check https://bugs.webkit.org/show_bug.cgi?id=231074 for\n     * details.\n     *\n     * @returns {boolean}\n     */\n    supportsVP9(): boolean {\n        // Keep this disabled for FF because simulcast is disabled by default.\n        // For versions 136+ if the media.webrtc.simulcast.vp9.enabled config is set to true it will work.\n        // TODO: enable for FF with version 136+ once media.webrtc.simulcast.vp9.enabled is set to true by default.\n        return !(this.isWebKitBased() || this.isFirefox());\n    }\n\n    /**\n     * Returns true if SVC is supported.\n     *\n     * @returns {boolean}\n     */\n    supportsSVC(): boolean {\n        return !this.isFirefox();\n    }\n\n    /**\n     * Checks if the browser uses SDP munging for turning on simulcast.\n     *\n     * @returns {boolean}\n     */\n    usesSdpMungingForSimulcast(): boolean {\n        return this.isChromiumBased() || this.isReactNative() || this.isWebKitBased();\n    }\n\n    /**\n     * Checks if the browser uses RIDs/MIDs for siganling the simulcast streams\n     * to the bridge instead of the ssrcs.\n     *\n     * @returns {boolean}\n     */\n    usesRidsForSimulcast(): boolean {\n        return false;\n    }\n\n    /**\n     * Checks if the browser supports getDisplayMedia.\n     *\n     * @returns {boolean} {@code true} if the browser supports getDisplayMedia.\n     */\n    supportsGetDisplayMedia(): boolean {\n        // @ts-ignore\n        return typeof navigator.getDisplayMedia !== 'undefined'\n            || (typeof navigator.mediaDevices?.getDisplayMedia !== 'undefined');\n    }\n\n    /**\n     * Checks if the browser supports WebRTC Encoded Transform, an alternative\n     * to insertable streams.\n     *\n     * NOTE: At the time of this writing the only browser supporting this is\n     * Safari / WebKit, behind a flag.\n     *\n     * @returns {boolean} {@code true} if the browser supports it.\n     */\n    supportsEncodedTransform(): boolean {\n        return Boolean(window.RTCRtpScriptTransform);\n    }\n\n    /**\n     * Checks if the browser supports insertable streams, needed for E2EE.\n     *\n     * @returns {boolean} {@code true} if the browser supports insertable streams.\n     */\n    supportsInsertableStreams(): boolean {\n        // @ts-ignore\n        if (!window.RTCRtpSender?.prototype.createEncodedStreams) {\n            return false;\n        }\n\n        // Feature-detect transferable streams which we need to operate in a worker.\n        // See https://groups.google.com/a/chromium.org/g/blink-dev/c/1LStSgBt6AM/m/hj0odB8pCAAJ\n        const stream = new ReadableStream();\n\n        try {\n            window.postMessage(stream, '*', [ stream ]);\n\n            return true;\n        } catch {\n            return false;\n        }\n    }\n\n    /**\n     * Whether the browser supports the RED format for audio.\n     *\n     * @returns {boolean} {@code true} if the browser supports RED.\n     */\n    supportsAudioRed(): boolean {\n        return Boolean(window.RTCRtpSender?.getCapabilities('audio')?.codecs.some(codec => codec.mimeType === 'audio/red')\n            && window.RTCRtpReceiver?.getCapabilities('audio')?.codecs.some(codec => codec.mimeType === 'audio/red'));\n    }\n\n    /**\n     * Checks if the browser supports voice activity detection via the @type {VADAudioAnalyser} service.\n     *\n     * @returns {boolean}\n     */\n    supportsVADDetection(): boolean {\n        return this.isChromiumBased();\n    }\n\n    /**\n     * Check if the browser supports the RTP RTX feature (and it is usable).\n     *\n     * @returns {boolean}\n     */\n    supportsRTX(): boolean {\n        // Disable RTX on Firefox up to 96 because we prefer simulcast over RTX\n        // see https://bugzilla.mozilla.org/show_bug.cgi?id=1738504\n        return !(this.isFirefox() && this.isVersionLessThan(96));\n    }\n}\n","\nimport Logger from '@jitsi/logger';\nimport watchRTC from '@testrtc/watchrtc-sdk';\n\nimport browser from '../browser';\n\nimport { isAnalyticsEnabled, isWatchRTCEnabled } from './functions';\nimport { IWatchRTCConfiguration } from './interfaces';\n\nconst logger = Logger.getLogger('analytics:WatchRTC');\n\n/**\n * Class that controls the watchRTC flow, because it overwrites and proxies global function it should only be\n * initialized once.\n */\nclass WatchRTCHandler {\n    options?: IWatchRTCConfiguration;\n\n    /**\n     * Initialize watchRTC, it overwrites GUM and PeerConnection global functions and adds a proxy over them\n     * used to capture stats.\n     *\n     * @param {Object} options - Init options.\n     * @returns {void}\n     */\n    init(options: any): void {\n        if (isWatchRTCEnabled(options)) {\n\n            // @ts-ignore\n            if (browser.isReactNative()) {\n                logger.warn('Cannot initialize WatchRTC in a react native environment!');\n\n                return;\n            }\n\n            if (!isAnalyticsEnabled(options)) {\n                logger.error('Cannot initialize WatchRTC when analytics or third party requests are disabled.');\n\n                return;\n            }\n\n            try {\n                if (options?.watchRTCConfigParams?.rtcApiKey) {\n                    watchRTC.init({\n                        rtcApiKey: options.watchRTCConfigParams.rtcApiKey,\n                    });\n                    this.options = options.watchRTCConfigParams;\n                    logger.info('WatchRTC initialized.');\n                } else {\n                    logger.error('WatchRTC is enabled but missing API key.');\n                }\n            } catch (error) {\n                logger.error('Failed to initialize WatchRTC: ', error);\n            }\n        }\n    }\n\n    /**\n     * Begin watchRTC session considering roomName and userName if already not available\n     *\n     * @param {string} roomName - The room name we are currently in.\n     * @param {string} userName - The user name. This value is obtained from\n     * JitsiConference.prototype.myUserId\n     * @returns {void}\n     */\n    start(roomName: string, userName: string): void {\n        try {\n            if (this.options) {\n                this.options.rtcRoomId = this.options.rtcRoomId ? this.options.rtcRoomId : roomName;\n                this.options.rtcPeerId = this.options.rtcPeerId ? this.options.rtcPeerId : userName;\n                watchRTC.setConfig(this.options);\n                logger.info('WatchRTC setConfig.');\n            }\n        } catch (error) {\n            logger.error('Failed to start WatchRTC session: ', error);\n        }\n    }\n}\n\nexport default new WatchRTCHandler();\n","/**\n * Checks whether analytics is enabled or not.\n *\n * @param {Object} options - Init options.\n * @returns {boolean}\n */\nexport function isAnalyticsEnabled(options): boolean {\n    const { analytics, disableThirdPartyRequests } = options;\n\n    return !(analytics?.disabled || disableThirdPartyRequests);\n}\n\n/**\n * Checks whether rtcstats is enabled or not.\n *\n * @param {Object} options - Init options.\n * @returns {boolean}\n */\nexport function isRtcstatsEnabled(options): boolean {\n    const { analytics } = options;\n\n    return analytics?.rtcstatsEnabled ?? false;\n}\n\n/**\n * Checks whether watchrtc is enabled or not.\n *\n * @param {Object} options - Init options.\n * @returns {boolean}\n */\nexport function isWatchRTCEnabled(options): boolean {\n    const { analytics } = options;\n\n    return analytics?.watchRTCEnabled ?? false;\n}\n","import { getLogger } from '@jitsi/logger';\n\nimport { AnalyticsEvents } from '../../service/statistics/AnalyticsEvents';\nimport browser from '../browser';\n\nconst MAX_CACHE_SIZE = 100;\n\nconst logger = getLogger('stats:AnalyticsAdapter');\n\n/**\n * Type for analytics event objects.\n */\nexport interface IAnalyticsEvent {\n    action?: string;\n    actionSubject?: string;\n    actionSubjectId?: string;\n    attributes?: Record<string, unknown>;\n    categories?: string[];\n    containerId?: string;\n    containerType?: string;\n    name?: string;\n    objectId?: string;\n    objectType?: string;\n    source?: string;\n    tags?: string[];\n    type: string;\n}\n\n/**\n * Type for analytics handler objects.\n */\nexport interface IAnalyticsHandler {\n    dispose?: () => void;\n    sendEvent: (event: IAnalyticsEvent) => void;\n    setUserProperties: (properties: Record<string, unknown>) => void;\n}\n\n/**\n * This class provides an API to lib-jitsi-meet and its users for sending\n * analytics events. It serves as a bridge to different backend implementations\n * (\"analytics handlers\") and a cache for events attempted to be sent before\n * the analytics handlers were enabled.\n *\n * The API is designed to be an easy replacement for the previous version of\n * this adapter, and is meant to be extended with more convenience methods.\n *\n *\n * The API calls are translated to objects with the following structure, which\n * are then passed to the sendEvent(event) function of the underlying handlers:\n *\n * {\n *    type,\n *\n *    action,\n *    actionSubject,\n *    actionSubjectId,\n *    attributes,\n *    categories,\n *    containerId,\n *    containerType,\n *    name,\n *    objectId,\n *    objectType,\n *    source,\n *    tags\n * }\n *\n * The 'type' is one of 'operational', 'page', 'track' or 'ui', and some of the\n * other properties are considered required according to the type.\n *\n * For events with type 'page', the required properties are: name.\n *\n * For events with type 'operational' and 'ui', the required properties are:\n * action, actionSubject, source\n *\n * For events with type 'page', the required properties are:\n * action, actionSubject, source, containerType, containerId, objectType,\n * objectId\n */\nclass AnalyticsAdapter {\n    /**\n     * Whether this AnalyticsAdapter has been disposed of or not. Once this\n     * is set to true, the AnalyticsAdapter is disabled and does not accept\n     * any more events, and it can not be re-enabled.\n     * @type {boolean}\n     */\n    private disposed: boolean;\n\n    /**\n     * The set of handlers to which events will be sent.\n     * @type {Set<AnalyticsHandler>}\n     */\n    private analyticsHandlers: Set<IAnalyticsHandler>;\n\n    /**\n     * The cache of events which are not sent yet. The cache is enabled\n     * while this field is truthy, and disabled otherwise.\n     * @type {AnalyticsEvent[] | null}\n     */\n    private cache: IAnalyticsEvent[] | null;\n\n    /**\n     * Map of properties that will be added to every event. Note that the\n     * keys will be prefixed with \"permanent.\".\n     */\n    private permanentProperties: Record<string, unknown>;\n\n    /**\n     * The name of the conference that this AnalyticsAdapter is associated\n     * with.\n     * @type {string}\n     */\n    private conferenceName: string;\n\n    /**\n     * Creates new AnalyticsAdapter instance.\n     */\n    constructor() {\n        this.reset();\n    }\n\n    /**\n     * Saves an event to the cache, if the cache is enabled.\n     * @param event the event to save.\n     * @returns {boolean} true if the event was saved, and false otherwise (i.e.\n     * if the cache was disabled).\n     * @private\n     */\n    private _maybeCacheEvent(event: IAnalyticsEvent): boolean {\n        if (this.cache) {\n            this.cache.push(event);\n\n            // We limit the size of the cache, in case the user fails to ever\n            // set the analytics handlers.\n            if (this.cache.length > MAX_CACHE_SIZE) {\n                this.cache.splice(0, 1);\n            }\n\n            return true;\n        }\n\n        return false;\n\n    }\n\n    /**\n     *\n     * @param event\n     * @private\n     */\n    private _sendEvent(event: IAnalyticsEvent): void {\n        if (this._maybeCacheEvent(event)) {\n            // The event was consumed by the cache.\n        } else {\n            this.analyticsHandlers.forEach(handler => {\n                try {\n                    handler.sendEvent(event);\n                } catch (e) {\n                    logger.warn(`Error sending analytics event: ${e}`);\n                }\n            });\n        }\n    }\n\n\n    /**\n     * Set the user properties to the analytics handlers.\n     *\n     * @returns {void}\n     */\n    private _setUserProperties(): void {\n        this.analyticsHandlers.forEach(handler => {\n            try {\n                handler.setUserProperties(this.permanentProperties);\n            } catch (error) {\n                logger.warn('Error in setUserProperties method of one of the '\n                    + `analytics handlers: ${error}`);\n            }\n        });\n    }\n\n    /**\n     * Checks whether an event has all of the required fields set, and tries\n     * to fill in some of the missing fields with reasonable default values.\n     * Returns true if after this operation the event has all of the required\n     * fields set, and false otherwise (if some of the required fields were not\n     * set and the attempt to fill them in with a default failed).\n     *\n     * @param event the event object.\n     * @return {boolean} true if the event (after the call to this function)\n     * contains all of the required fields, and false otherwise.\n     * @private\n     */\n    private _verifyRequiredFields(event: IAnalyticsEvent | null): boolean {\n        if (!event) {\n            return false;\n        }\n\n        if (!event.type) {\n            event.type = AnalyticsEvents.TYPE_OPERATIONAL;\n        }\n\n        const type = event.type;\n\n        if (type !== AnalyticsEvents.TYPE_OPERATIONAL && type !== AnalyticsEvents.TYPE_PAGE\n                && type !== AnalyticsEvents.TYPE_UI && type !== AnalyticsEvents.TYPE_TRACK) {\n            logger.error(`Unknown event type: ${type}`);\n\n            return false;\n        }\n\n        if (type === AnalyticsEvents.TYPE_PAGE) {\n            return Boolean(event.name);\n        }\n\n        // Try to set some reasonable default values in case some of the\n        // parameters required by the handler API are missing.\n        event.action = event.action || event.name || event.actionSubject;\n        event.actionSubject = event.actionSubject || event.name || event.action;\n        event.source = event.source || event.name || event.action\n            || event.actionSubject;\n\n        if (!event.action || !event.actionSubject || !event.source) {\n            logger.error(\n                'Required field missing (action, actionSubject or source)');\n\n            return false;\n        }\n\n        // Track events have additional required fields.\n        if (type === AnalyticsEvents.TYPE_TRACK) {\n            event.objectType = event.objectType || 'generic-object-type';\n            event.containerType = event.containerType || 'conference';\n            if (event.containerType === 'conference' && !event.containerId) {\n                event.containerId = this.conferenceName;\n            }\n\n\n            if (!event.objectType || !event.objectId\n                || !event.containerType || !event.containerId) {\n                logger.error(\n                    'Required field missing (containerId, containerType, '\n                        + 'objectId or objectType)');\n\n                return false;\n            }\n        }\n\n        return true;\n    }\n\n\n    /**\n     * Adds a set of permanent properties to this this AnalyticsAdapter.\n     * Permanent properties will be added as \"attributes\" to events sent to\n     * the underlying \"analytics handlers\", and their keys will be prefixed\n     * by \"permanent_\", i.e. adding a permanent property {key: \"value\"} will\n     * result in {\"permanent_key\": \"value\"} object to be added to the\n     * \"attributes\" field of events.\n     *\n     * @param {Record<string, unknown>} properties the properties to add\n     */\n    public addPermanentProperties(properties: Record<string, unknown>): void {\n        this.permanentProperties = {\n            ...this.permanentProperties,\n            ...properties\n        };\n\n        this._setUserProperties();\n    }\n\n    /**\n         * Dispose analytics. Clears all handlers.\n         */\n    public dispose(): void {\n        logger.debug('Disposing of analytics adapter.');\n\n        if (this.analyticsHandlers && this.analyticsHandlers.size > 0) {\n            this.analyticsHandlers.forEach(handler => {\n                if (typeof handler.dispose === 'function') {\n                    handler.dispose();\n                }\n            });\n        }\n\n        this.setAnalyticsHandlers([]);\n        this.disposed = true;\n    }\n\n    /**\n     * Reset the state to the initial one.\n     *\n     * @returns {void}\n     */\n    public reset(): void {\n        this.disposed = false;\n        this.analyticsHandlers = new Set();\n        this.cache = [];\n        this.permanentProperties = {};\n        this.conferenceName = '';\n        this.addPermanentProperties({\n            'browser_name': browser.getName(),\n            'user_agent': navigator.userAgent\n        });\n    }\n\n    /**\n     * Sends an event with a given name and given properties. The first\n     * parameter is either a string or an object. If it is a string, it is used\n     * as the event name and the second parameter is used at the attributes to\n     * attach to the event. If it is an object, it represents the whole event,\n     * including any desired attributes, and the second parameter is ignored.\n     *\n     * @param {String|IAnalyticsEvent} eventName either a string to be used as the name\n     * of the event, or an event object. If an event object is passed, the\n     * properties parameters is ignored.\n     * @param {Record<string, unknown>} properties the properties/attributes to attach to the\n     * event, if eventName is a string.\n     */\n    public sendEvent(eventName: string | IAnalyticsEvent, properties: Record<string, unknown> = {}): void {\n        if (this.disposed) {\n            return;\n        }\n\n        let event: IAnalyticsEvent | null = null;\n\n        if (typeof eventName === 'string') {\n            event = {\n                action: eventName,\n                actionSubject: eventName,\n                attributes: properties,\n                source: eventName,\n                type: AnalyticsEvents.TYPE_OPERATIONAL\n            };\n        } else if (typeof eventName === 'object') {\n            event = eventName;\n        }\n\n        if (!this._verifyRequiredFields(event)) {\n            logger.error(\n                `Dropping a mis-formatted event: ${JSON.stringify(event)}`);\n\n            return;\n        }\n\n        this._sendEvent(event);\n    }\n\n    /**\n         * Sets the handlers that are going to be used to send analytics. Sends any\n         * cached events.\n         * @param {IAnalyticsHandler[]} handlers the handlers\n         */\n    public setAnalyticsHandlers(handlers: IAnalyticsHandler[]): void {\n        if (this.disposed) {\n            return;\n        }\n\n        this.analyticsHandlers = new Set(handlers);\n\n        this._setUserProperties();\n\n        // Note that we disable the cache even if the set of handlers is empty.\n        const cache = this.cache;\n\n        this.cache = null;\n        if (cache) {\n            cache.forEach(event => this._sendEvent(event));\n        }\n    }\n\n\n    /**\n     * Sets the name of the conference that this AnalyticsAdapter is associated\n     * with.\n     * @param name the name to set.\n     */\n    public setConferenceName(name: string): void {\n        this.conferenceName = name;\n        this.addPermanentProperties({ 'conference_name': name });\n    }\n\n}\n\nexport default new AnalyticsAdapter();\n","import { getLogger } from '@jitsi/logger';\n\nconst logger = getLogger('stats:LocalStatsCollector');\n/**\n * Size of the webaudio analyzer buffer.\n * @type {number}\n */\nconst WEBAUDIO_ANALYZER_FFT_SIZE: number = 2048;\n\n/**\n * Value of the webaudio analyzer smoothing time parameter.\n * @type {number}\n */\nconst WEBAUDIO_ANALYZER_SMOOTING_TIME: number = 0.8;\n\n/**\n * The audio context.\n * @type {AudioContext}\n */\nlet context: Nullable<AudioContext> = null;\n\n/**\n * Converts time domain data array to audio level.\n * @param samples the time domain data array.\n * @returns {number} the audio level\n */\nfunction timeDomainDataToAudioLevel(samples: Uint8Array): number {\n    let maxVolume = 0;\n    const length = samples.length;\n\n    for (let i = 0; i < length; i++) {\n        if (maxVolume < samples[i]) {\n            maxVolume = samples[i];\n        }\n    }\n\n    return Number.parseFloat(((maxVolume - 127) / 128).toFixed(3));\n}\n\n/**\n * Animates audio level change\n * @param newLevel the new audio level\n * @param lastLevel the last audio level\n * @returns {Number} the audio level to be set\n */\nfunction animateLevel(newLevel: number, lastLevel: number): number {\n    let value = 0;\n    const diff = lastLevel - newLevel;\n\n    if (diff > 0.2) {\n        value = lastLevel - 0.2;\n    } else if (diff < -0.4) {\n        value = lastLevel + 0.4;\n    } else {\n        value = newLevel;\n    }\n\n    return Number.parseFloat(value.toFixed(3));\n}\n\n/**\n * Provides statistics for the local stream.\n */\nexport default class LocalStatsCollector {\n    stream: MediaStream;\n    intervalId: Nullable<Timeout>;\n    intervalMilis: number;\n    audioLevel: number;\n    callback: (audioLevel: number) => void;\n    source: Nullable<MediaStreamAudioSourceNode>;\n    analyser: Nullable<AnalyserNode>;\n\n    /**\n     * Creates a new instance of LocalStatsCollector.\n     *\n     * @param {MediaStream} stream - the local stream\n     * @param {number} interval - stats refresh interval given in ms.\n     * @param {Function} callback - function that receives the audio levels.\n     * @constructor\n     */\n    constructor(\n            stream: MediaStream,\n            interval: number,\n            callback: (audioLevel: number) => void\n    ) {\n        this.stream = stream;\n        this.intervalId = null;\n        this.intervalMilis = interval;\n        this.audioLevel = 0;\n        this.callback = callback;\n        this.source = null;\n        this.analyser = null;\n    }\n\n    /**\n     * Starts the collecting the statistics.\n     */\n    start(): void {\n        if (!LocalStatsCollector.isLocalStatsSupported()) {\n            return;\n        }\n\n        context!.resume();\n        this.analyser = context!.createAnalyser();\n\n        this.analyser.smoothingTimeConstant = WEBAUDIO_ANALYZER_SMOOTING_TIME;\n        this.analyser.fftSize = WEBAUDIO_ANALYZER_FFT_SIZE;\n\n        this.source = context!.createMediaStreamSource(this.stream);\n\n        this.source.connect(this.analyser);\n\n        this.intervalId = setInterval(\n            () => {\n                const array = new Uint8Array(this.analyser!.frequencyBinCount);\n\n                this.analyser!.getByteTimeDomainData(array);\n                const audioLevel = timeDomainDataToAudioLevel(array);\n\n                // Set the audio levels always as NoAudioSignalDetection now\n                // uses audio levels from LocalStatsCollector and waits for\n                // atleast 4 secs for a no audio signal before displaying the\n                // notification on the UI.\n                this.audioLevel = animateLevel(audioLevel, this.audioLevel);\n                this.callback(this.audioLevel);\n            },\n            this.intervalMilis\n        );\n    }\n\n    /**\n     * Stops collecting the statistics.\n     */\n    stop(): void {\n        if (this.intervalId) {\n            clearInterval(this.intervalId);\n            this.intervalId = null;\n        }\n\n        this.analyser?.disconnect();\n        this.analyser = null;\n        this.source?.disconnect();\n        this.source = null;\n    }\n\n    /**\n     * Initialize collector.\n     */\n    static init(): void {\n        LocalStatsCollector.connectAudioContext();\n    }\n\n    /**\n     * Checks if the environment has the necessary conditions to support\n     * collecting stats from local streams.\n     *\n     * @returns {boolean}\n     */\n    static isLocalStatsSupported(): boolean {\n        return Boolean(window?.AudioContext);\n    }\n\n    /**\n     * Disconnects the audio context.\n     */\n    static async disconnectAudioContext(): Promise<void> {\n        if (context) {\n            logger.info('Disconnecting audio context');\n            await context.close();\n            context = null;\n        }\n    }\n\n    /**\n     * Connects the audio context.\n     */\n    static connectAudioContext(): void {\n        if (!LocalStatsCollector.isLocalStatsSupported()) {\n            return;\n        }\n\n        logger.info('Connecting audio context');\n        context = new AudioContext();\n\n        context.suspend();\n    }\n}\n","export enum MediaType {\n\n    /**\n     * The application type (data over bridge channel).\n     */\n    APPLICATION = 'application',\n\n    /**\n     * The audio type.\n     */\n    AUDIO = 'audio',\n\n    /**\n     * The desktop video type.\n     */\n    DESKTOP = 'desktop',\n\n    /**\n     * The video type.\n     */\n    VIDEO = 'video'\n}\n","import browser from '../browser';\n\n/**\n * A global module for accessing information about different feature flags state.\n */\nclass FeatureFlags {\n    private _runInLiteMode: boolean;\n    private _ssrcRewriting: boolean;\n\n    /**\n     * Configures the module.\n     *\n     * @param {object} flags - The feature flags.\n     * @param {Optional<boolean>} flags.runInLiteMode - Enables lite mode for testing to disable media decoding.\n     * @param {Optional<boolean>} flags.ssrcRewritingEnabled - Use SSRC rewriting.\n     */\n    init(flags: { runInLiteMode?: Optional<boolean>; ssrcRewritingEnabled?: Optional<boolean>; }) {\n        this._runInLiteMode = Boolean(flags.runInLiteMode);\n        this._ssrcRewriting = Boolean(flags.ssrcRewritingEnabled);\n    }\n\n    /**\n     * Checks if the run in lite mode is enabled.\n     * This will cause any media to be received and not decoded. (Insertable streams are used to discard\n     * all media before it is decoded). This can be used for various test scenarios.\n     *\n     * @returns {boolean}\n     */\n    isRunInLiteModeEnabled(): boolean {\n        return this._runInLiteMode && browser.supportsInsertableStreams();\n    }\n\n    /**\n     * Checks if the clients supports re-writing of the SSRCs on the media streams by the bridge.\n     * @returns {boolean}\n     */\n    isSsrcRewritingSupported(): boolean {\n        return this._ssrcRewriting;\n    }\n}\n\nexport default new FeatureFlags();\n","/**\n * The method will increase the given number by 1. If the given counter is equal\n * or greater to {@link Number.MAX_SAFE_INTEGER} then it will be rolled back to\n * 1.\n * @param {number} number - An integer counter value to be incremented.\n * @return {number} the next counter value increased by 1 (see the description\n * above for exception).\n */\nexport function safeCounterIncrement(number: number): number {\n    let nextValue = number;\n\n    if (number >= Number.MAX_SAFE_INTEGER) {\n        nextValue = 0;\n    }\n\n    return nextValue + 1;\n}\n\n/**\n * Calculates the average value of an Array of numbers.\n *\n * @param {Float32Array} valueArray - Array of numbers.\n * @returns {number} - Number array average.\n */\nexport function calculateAverage(valueArray: Float32Array): number {\n    return valueArray.length > 0 ? valueArray.reduce((a, b) => a + b) / valueArray.length : 0;\n}\n\n/**\n * Calculates a unique hash for a given string similar to Java's\n * implementation of String.hashCode()\n *\n * @param {string} string - String whose hash has to be calculated.\n * @returns {number} - Unique hash code calculated.\n */\nexport function hashString(string: string): number {\n    let hash = 0;\n\n    for (let i = 0; i < string.length; i++) {\n        hash += Math.pow(string.charCodeAt(i) * 31, string.length - i);\n\n        /* eslint-disable no-bitwise */\n        hash = hash & hash; // Convert to 32bit integer\n    }\n\n    return Math.abs(hash);\n}\n\n/**\n * Returns only the positive values from an array of numbers.\n *\n * @param {Float32Array} valueArray - Array of vad scores.\n * @returns {number[]} - Array of positive numbers.\n */\nexport function filterPositiveValues(valueArray: Float32Array): number[] {\n    return Array.from(valueArray).filter(value => value >= 0);\n}\n\n/**\n * This class calculates a simple running average that continually changes\n * as more data points are collected and added.\n */\nexport class RunningAverage {\n    private average: number;\n    private n: number;\n\n    /**\n     * Creates an instance of the running average calculator.\n     */\n    constructor() {\n        this.average = 0;\n        this.n = 0;\n    }\n\n    /**\n     * Adds a new data point to the existing set of values and recomputes\n     * the running average.\n     * @param {number} value\n     * @returns {void}\n     */\n    addNext(value: number): void {\n        if (typeof value !== 'number') {\n            return;\n        }\n        this.n += 1;\n        this.average = this.average + ((value - this.average) / this.n);\n    }\n\n    /**\n     * Obtains the average value for the current subset of values.\n     * @returns {number} - computed average.\n     */\n    getAverage(): number {\n        return this.average;\n    }\n}\n\n/**\n * Subtracts the two numbers passed or returns 0 if any of the arguments are not a number.\n *\n * @param {*} x - The number we subtract from.\n * @param {*} y - The number we subtract.\n * @returns {number} - x - y or 0 if x or y is not a number.\n */\nexport function safeSubtract(x: any, y: any): number {\n    return isValidNumber(x) && isValidNumber(y) ? x - y : 0;\n}\n\n/**\n * Checks if the given value is a valid number.\n *\n * @param n - The value to check.\n * @returns - `true` if the value is a valid number, `false` otherwise.\n */\nexport function isValidNumber(n: any): boolean {\n    const v = Number.parseInt(n, 10);\n\n    return Number.isFinite(v); // Filter out NaN and Infinity.\n}\n","import { getLogger } from '@jitsi/logger';\n\nimport { MediaType } from '../../service/RTC/MediaType';\nimport { StatisticsEvents } from '../../service/statistics/Events';\nimport browser from '../browser';\nimport FeatureFlags from '../flags/FeatureFlags';\nimport { isValidNumber } from '../util/MathUtil';\n\nconst logger = getLogger('stats:RTPStatsCollector');\n\n/**\n * Calculates packet lost percent using the number of lost packets and the\n * number of all packet.\n * @param lostPackets the number of lost packets\n * @param totalPackets the number of all packets.\n * @returns {number} packet loss percent\n */\nfunction calculatePacketLoss(lostPackets, totalPackets) {\n    if (lostPackets > 0 && totalPackets > 0) {\n        return Math.round(lostPackets / totalPackets * 100);\n    }\n\n    return 0;\n}\n\n/**\n * Holds \"statistics\" for a single SSRC.\n */\nclass SsrcStats {\n    /**\n     * Constructor.\n     */\n    constructor() {\n        this.loss = {};\n        this.bitrate = {\n            download: 0,\n            upload: 0\n        };\n        this.resolution = {};\n        this.framerate = 0;\n        this.codec = '';\n    }\n\n    /**\n     * Sets the \"loss\" object.\n     * @param loss the value to set.\n     */\n    setLoss(loss) {\n        this.loss = loss || {};\n    }\n\n    /**\n     * Sets resolution that belong to the ssrc represented by this instance.\n     * @param resolution new resolution value to be set.\n     */\n    setResolution(resolution) {\n        this.resolution = resolution || {};\n    }\n\n    /**\n     * Adds the \"download\" and \"upload\" fields from the \"bitrate\" parameter to\n     * the respective fields of the \"bitrate\" field of this object.\n     * @param bitrate an object holding the values to add.\n     */\n    addBitrate(bitrate) {\n        this.bitrate.download += bitrate.download;\n        this.bitrate.upload += bitrate.upload;\n    }\n\n    /**\n     * Resets the bit rate for given <tt>ssrc</tt> that belong to the peer\n     * represented by this instance.\n     */\n    resetBitrate() {\n        this.bitrate.download = 0;\n        this.bitrate.upload = 0;\n    }\n\n    /**\n     * Sets the \"framerate\".\n     * @param framerate the value to set.\n     */\n    setFramerate(framerate) {\n        this.framerate = framerate || 0;\n    }\n\n    /**\n     * Sets the codec.\n     * @param codec the value to set.\n     */\n    setCodec(codec) {\n        this.codec = codec || '';\n    }\n\n    /**\n     * Sets the encode stats.\n     * @param encodeStats the value to set.\n     */\n    setEncodeStats(encodeStats) {\n        this.encodeStats = encodeStats || {};\n    }\n}\n\n/**\n * Conference statistics.\n */\nclass ConferenceStats {\n    /**\n     * Constructor.\n     */\n    constructor() {\n        /**\n         * The bandwidth\n         * @type {{}}\n         */\n        this.bandwidth = {};\n\n        /**\n         * The bit rate\n         * @type {{}}\n         */\n        this.bitrate = {};\n\n        /**\n         * The packet loss rate\n         * @type {{}}\n         */\n        this.packetLoss = null;\n\n        /**\n         * Array with the transport information.\n         * @type {Array}\n         */\n        this.transport = [];\n    }\n}\n\n/* eslint-disable max-params */\n\n/**\n * <tt>StatsCollector</tt> registers for stats updates of given\n * <tt>peerconnection</tt> in given <tt>interval</tt>. On each update particular\n * stats are extracted and put in {@link SsrcStats} objects. Once the processing\n * is done <tt>audioLevelsUpdateCallback</tt> is called with <tt>this</tt>\n * instance as an event source.\n */\nexport default class StatsCollector {\n    /**\n     * Creates new <tt>StatsCollector</tt> instance.\n     * @param peerconnection WebRTC PeerConnection object.\n     * @param audioLevelsInterval\n     * @param statsInterval stats refresh interval given in ms.\n     * @param eventEmitter\n     * @constructor\n     */\n    constructor(peerconnection, audioLevelsInterval, statsInterval, eventEmitter) {\n        this.peerconnection = peerconnection;\n        this.currentStatsReport = null;\n        this.previousStatsReport = null;\n        this.audioLevelsIntervalId = null;\n        this.eventEmitter = eventEmitter;\n        this.conferenceStats = new ConferenceStats();\n\n        // Updates stats interval\n        this.audioLevelsIntervalMilis = audioLevelsInterval;\n\n        this.speakerList = [];\n        this.statsIntervalId = null;\n        this.statsIntervalMilis = statsInterval;\n\n        /**\n         * Maps SSRC numbers to {@link SsrcStats}.\n         * @type {Map<number,SsrcStats}\n         */\n        this.ssrc2stats = new Map();\n    }\n\n    /**\n     * Set the list of the remote speakers for which audio levels are to be calculated.\n     *\n     * @param {Array<string>} speakerList - Endpoint ids.\n     * @returns {void}\n     */\n    setSpeakerList(speakerList) {\n        this.speakerList = speakerList;\n    }\n\n    /**\n     * Stops stats updates.\n     */\n    stop() {\n        if (this.audioLevelsIntervalId) {\n            clearInterval(this.audioLevelsIntervalId);\n            this.audioLevelsIntervalId = null;\n        }\n\n        if (this.statsIntervalId) {\n            clearInterval(this.statsIntervalId);\n            this.statsIntervalId = null;\n        }\n    }\n\n    /**\n     * Callback passed to <tt>getStats</tt> method.\n     * @param error an error that occurred on <tt>getStats</tt> call.\n     */\n    errorCallback(error) {\n        logger.error('Get stats error', error);\n        this.stop();\n    }\n\n    /**\n     * Starts stats updates.\n     */\n    start(startAudioLevelStats) {\n        if (startAudioLevelStats && browser.supportsReceiverStats()) {\n            this.audioLevelsIntervalId = setInterval(\n                () => {\n                    const audioLevels = this.peerconnection.getAudioLevels(this.speakerList);\n\n                    for (const ssrc in audioLevels) {\n                        if (audioLevels.hasOwnProperty(ssrc)) {\n                            // Use a scaling factor of 2.5 to report the same audio levels that getStats reports.\n                            const audioLevel = audioLevels[ssrc] * 2.5;\n\n                            this.eventEmitter.emit(\n                                StatisticsEvents.AUDIO_LEVEL,\n                                this.peerconnection,\n                                Number.parseInt(ssrc, 10),\n                                audioLevel,\n                                false /* isLocal */);\n                        }\n                    }\n                },\n                this.audioLevelsIntervalMilis\n            );\n        }\n\n        const processStats = () => {\n            // Interval updates\n            this.peerconnection.getStats()\n                .then(report => {\n                    this.currentStatsReport = typeof report?.result === 'function'\n                        ? report.result()\n                        : report;\n\n                    try {\n                        this.processStatsReport();\n                    } catch (error) {\n                        logger.error('Processing of RTP stats failed:', error);\n                    }\n                    this.previousStatsReport = this.currentStatsReport;\n                })\n                .catch(error => this.errorCallback(error));\n        };\n\n        processStats();\n        this.statsIntervalId = setInterval(processStats, this.statsIntervalMilis);\n    }\n\n    /**\n     * Process and emit statistics report.\n     * @private\n     */\n    _processAndEmitReport() {\n        // process stats\n        const totalPackets = {\n            download: 0,\n            upload: 0\n        };\n        const lostPackets = {\n            download: 0,\n            upload: 0\n        };\n        let bitrateDownload = 0;\n        let bitrateUpload = 0;\n        const resolutions = {};\n        const framerates = {};\n        const codecs = {};\n        let audioBitrateDownload = 0;\n        let audioBitrateUpload = 0;\n        let videoBitrateDownload = 0;\n        let videoBitrateUpload = 0;\n\n        for (const [ ssrc, ssrcStats ] of this.ssrc2stats) {\n            // process packet loss stats\n            const loss = ssrcStats.loss;\n            const type = loss.isDownloadStream ? 'download' : 'upload';\n\n            totalPackets[type] += loss.packetsTotal;\n            lostPackets[type] += loss.packetsLost;\n\n            const ssrcBitrateDownload = ssrcStats.bitrate.download;\n            const ssrcBitrateUpload = ssrcStats.bitrate.upload;\n\n            // process bitrate stats\n            bitrateDownload += ssrcBitrateDownload;\n            bitrateUpload += ssrcBitrateUpload;\n\n            ssrcStats.resetBitrate();\n\n            // collect resolutions and framerates\n            const track = this.peerconnection.getTrackBySSRC(ssrc);\n\n            if (!track) {\n                continue; // eslint-disable-line no-continue\n            }\n\n            let audioCodec;\n            let videoCodec;\n\n            if (track.isAudioTrack()) {\n                audioBitrateDownload += ssrcBitrateDownload;\n                audioBitrateUpload += ssrcBitrateUpload;\n                audioCodec = ssrcStats.codec;\n            } else {\n                videoBitrateDownload += ssrcBitrateDownload;\n                videoBitrateUpload += ssrcBitrateUpload;\n                videoCodec = ssrcStats.codec;\n            }\n\n            const participantId = track.getParticipantId();\n\n            if (!participantId) {\n                // All tracks in ssrc-rewriting mode need not have a participant associated with it.\n                if (!FeatureFlags.isSsrcRewritingSupported()) {\n                    logger.error(`No participant ID returned by ${track}`);\n                }\n                continue;\n            }\n\n            const userCodecs = codecs[participantId] ?? { };\n\n            userCodecs[ssrc] = {\n                audio: audioCodec,\n                video: videoCodec\n            };\n\n            codecs[participantId] = userCodecs;\n            const { resolution } = ssrcStats;\n\n            if (!track.isVideoTrack()\n                || !isValidNumber(resolution?.height)\n                || !isValidNumber(resolution?.width)\n                || resolution.height === -1\n                || resolution.width === -1) {\n                continue;\n            }\n            const userResolutions = resolutions[participantId] || {};\n\n            // If simulcast (VP8) is used, there will be 3 \"outbound-rtp\" streams with different resolutions and 3\n            // different SSRCs. Based on the requested resolution and the current cpu and available bandwidth\n            // values, some of the streams might get suspended. Therefore the actual send resolution needs to be\n            // calculated based on the outbound-rtp streams that are currently active for the simulcast case.\n            // However for the SVC case, there will be only 1 \"outbound-rtp\" stream which will have the correct\n            // send resolution width and height.\n            if (track.isLocal() && !browser.supportsTrackBasedStats() && this.peerconnection.doesTrueSimulcast(track)) {\n                const localSsrcs = this.peerconnection.getLocalVideoSSRCs(track);\n\n                for (const localSsrc of localSsrcs) {\n                    const ssrcResolution = this.ssrc2stats.get(localSsrc)?.resolution;\n\n                    // The code processes resolution stats only for 'outbound-rtp' streams that are currently active.\n                    if (ssrcResolution?.height && ssrcResolution?.width) {\n                        resolution.height = Math.max(resolution.height, ssrcResolution.height);\n                        resolution.width = Math.max(resolution.width, ssrcResolution.width);\n                    }\n                }\n            }\n\n            userResolutions[ssrc] = resolution;\n            resolutions[participantId] = userResolutions;\n\n            if (ssrcStats.framerate > 0) {\n                const userFramerates = framerates[participantId] || {};\n\n                userFramerates[ssrc] = ssrcStats.framerate;\n                framerates[participantId] = userFramerates;\n            }\n        }\n\n        this.conferenceStats.bitrate = {\n            download: bitrateDownload,\n            upload: bitrateUpload\n        };\n\n        this.conferenceStats.bitrate.audio = {\n            download: audioBitrateDownload,\n            upload: audioBitrateUpload\n        };\n\n        this.conferenceStats.bitrate.video = {\n            download: videoBitrateDownload,\n            upload: videoBitrateUpload\n        };\n\n        this.conferenceStats.packetLoss = {\n            download:\n                calculatePacketLoss(lostPackets.download, totalPackets.download),\n            total:\n                calculatePacketLoss(\n                    lostPackets.download + lostPackets.upload,\n                    totalPackets.download + totalPackets.upload),\n            upload:\n                calculatePacketLoss(lostPackets.upload, totalPackets.upload)\n        };\n\n        this.eventEmitter.emit(\n            StatisticsEvents.CONNECTION_STATS,\n            this.peerconnection,\n            {\n                bandwidth: this.conferenceStats.bandwidth,\n                bitrate: this.conferenceStats.bitrate,\n                codec: codecs,\n                framerate: framerates,\n                packetLoss: this.conferenceStats.packetLoss,\n                resolution: resolutions,\n                transport: this.conferenceStats.transport\n            });\n        this.conferenceStats.transport = [];\n    }\n\n    /**\n     * Converts the value to a non-negative number.\n     * If the value is either invalid or negative then 0 will be returned.\n     * @param {*} v\n     * @return {number}\n     * @private\n     */\n    getNonNegativeValue(v) {\n        let value = v;\n\n        if (typeof value !== 'number') {\n            value = Number(value);\n        }\n\n        if (!isValidNumber(value)) {\n            return 0;\n        }\n\n        return Math.max(0, value);\n    }\n\n    /**\n     * Calculates bitrate between before and now using a supplied field name and its\n     * value in the stats.\n     * @param {RTCInboundRtpStreamStats|RTCSentRtpStreamStats} now the current stats\n     * @param {RTCInboundRtpStreamStats|RTCSentRtpStreamStats} before the\n     * previous stats.\n     * @param fieldName the field to use for calculations.\n     * @return {number} the calculated bitrate between now and before.\n     * @private\n     */\n    _calculateBitrate(now, before, fieldName) {\n        const bytesNow = this.getNonNegativeValue(now[fieldName]);\n        const bytesBefore = this.getNonNegativeValue(before[fieldName]);\n        const bytesProcessed = Math.max(0, bytesNow - bytesBefore);\n\n        const timeMs = now.timestamp - before.timestamp;\n        let bitrateKbps = 0;\n\n        if (timeMs > 0) {\n            // TODO is there any reason to round here?\n            bitrateKbps = Math.round((bytesProcessed * 8) / timeMs);\n        }\n\n        return bitrateKbps;\n    }\n\n    /**\n     * Calculates the frames per second rate between before and now using a supplied field name and its value in stats.\n     * @param {RTCOutboundRtpStreamStats|RTCSentRtpStreamStats} now the current stats\n     * @param {RTCOutboundRtpStreamStats|RTCSentRtpStreamStats} before the previous stats\n     * @param {string} fieldName the field to use for calculations.\n     * @returns {number} the calculated frame rate between now and before.\n     */\n    _calculateFps(now, before, fieldName) {\n        const timeMs = now.timestamp - before.timestamp;\n        let frameRate = 0;\n\n        if (timeMs > 0 && now[fieldName]) {\n            const numberOfFramesSinceBefore = now[fieldName] - before[fieldName];\n\n            frameRate = (numberOfFramesSinceBefore / timeMs) * 1000;\n        }\n\n        return frameRate;\n    }\n\n    /**\n     * Stats processing for spec-compliant RTCPeerConnection#getStats.\n     */\n    processStatsReport() {\n        const byteSentStats = {};\n        const encodedTimeStatsPerSsrc = new Map();\n\n        this.currentStatsReport.forEach(now => {\n            const before = this.previousStatsReport ? this.previousStatsReport.get(now.id) : null;\n\n            // RTCIceCandidatePairStats - https://w3c.github.io/webrtc-stats/#candidatepair-dict*\n            if (now.type === 'candidate-pair' && now.nominated && now.state === 'succeeded') {\n                const availableIncomingBitrate = now.availableIncomingBitrate;\n                const availableOutgoingBitrate = now.availableOutgoingBitrate;\n\n                if (availableIncomingBitrate || availableOutgoingBitrate) {\n                    this.conferenceStats.bandwidth = {\n                        'download': Math.round(availableIncomingBitrate / 1000),\n                        'upload': Math.round(availableOutgoingBitrate / 1000)\n                    };\n                }\n\n                const remoteUsedCandidate = this.currentStatsReport.get(now.remoteCandidateId);\n                const localUsedCandidate = this.currentStatsReport.get(now.localCandidateId);\n\n                // RTCIceCandidateStats\n                // https://w3c.github.io/webrtc-stats/#icecandidate-dict*\n                if (remoteUsedCandidate && localUsedCandidate) {\n                    const remoteIpAddress = browser.isChromiumBased()\n                        ? remoteUsedCandidate.ip\n                        : remoteUsedCandidate.address;\n                    const remotePort = remoteUsedCandidate.port;\n                    const ip = `${remoteIpAddress}:${remotePort}`;\n\n                    const localIpAddress = browser.isChromiumBased()\n                        ? localUsedCandidate.ip\n                        : localUsedCandidate.address;\n                    const localPort = localUsedCandidate.port;\n                    const localip = `${localIpAddress}:${localPort}`;\n                    const type = remoteUsedCandidate.protocol;\n\n                    // Save the address unless it has been saved already.\n                    const conferenceStatsTransport = this.conferenceStats.transport;\n\n                    if (!conferenceStatsTransport.some(t =>\n                        t.ip === ip\n                        && t.type === type\n                        && t.localip === localip)) {\n                        conferenceStatsTransport.push({\n                            ip,\n                            localCandidateType: localUsedCandidate.candidateType,\n                            localip,\n                            networkType: localUsedCandidate.networkType,\n                            p2p: this.peerconnection.isP2P,\n                            remoteCandidateType: remoteUsedCandidate.candidateType,\n                            rtt: now.currentRoundTripTime * 1000,\n                            type\n                        });\n                    }\n                }\n\n            // RTCReceivedRtpStreamStats\n            // https://w3c.github.io/webrtc-stats/#receivedrtpstats-dict*\n            // RTCSentRtpStreamStats\n            // https://w3c.github.io/webrtc-stats/#sentrtpstats-dict*\n            } else if (now.type === 'inbound-rtp' || now.type === 'outbound-rtp') {\n                const ssrc = this.getNonNegativeValue(now.ssrc);\n\n                if (!ssrc) {\n                    return;\n                }\n\n                let ssrcStats = this.ssrc2stats.get(ssrc);\n\n                if (!ssrcStats) {\n                    ssrcStats = new SsrcStats();\n                    this.ssrc2stats.set(ssrc, ssrcStats);\n                }\n\n                let isDownloadStream = true;\n                let key = 'packetsReceived';\n\n                if (now.type === 'outbound-rtp') {\n                    isDownloadStream = false;\n                    key = 'packetsSent';\n                }\n\n                let packetsNow = now[key];\n\n                if (!packetsNow || packetsNow < 0) {\n                    packetsNow = 0;\n                }\n\n                if (before) {\n                    const packetsBefore = this.getNonNegativeValue(before[key]);\n                    const packetsDiff = Math.max(0, packetsNow - packetsBefore);\n\n                    const packetsLostNow = this.getNonNegativeValue(now.packetsLost);\n                    const packetsLostBefore = this.getNonNegativeValue(before.packetsLost);\n                    const packetsLostDiff = Math.max(0, packetsLostNow - packetsLostBefore);\n\n                    ssrcStats.setLoss({\n                        isDownloadStream,\n                        packetsLost: packetsLostDiff,\n                        packetsTotal: packetsDiff + packetsLostDiff\n                    });\n                }\n\n                let resolution;\n\n                // Process the stats for 'inbound-rtp' streams always and 'outbound-rtp' only if the browser is\n                // Chromium based and version 112 and later since 'track' based stats are no longer available there\n                // for calculating send resolution and frame rate.\n                if (typeof now.frameHeight !== 'undefined' && typeof now.frameWidth !== 'undefined') {\n                    // Assume the stream is active if the field is missing in the stats(Firefox)\n                    const isStreamActive = now.active ?? true;\n\n                    if (now.type === 'inbound-rtp' || (!browser.supportsTrackBasedStats() && isStreamActive)) {\n                        resolution = {\n                            height: now.frameHeight,\n                            width: now.frameWidth\n                        };\n                    }\n                }\n                ssrcStats.setResolution(resolution);\n\n                let frameRate = now.framesPerSecond;\n\n                if (!frameRate && before) {\n                    frameRate = this._calculateFps(now, before, 'framesSent');\n                }\n\n                ssrcStats.setFramerate(Math.round(frameRate || 0));\n\n                if (now.type === 'inbound-rtp' && before) {\n                    ssrcStats.addBitrate({\n                        'download': this._calculateBitrate(now, before, 'bytesReceived'),\n                        'upload': 0\n                    });\n                } else if (before) {\n                    byteSentStats[ssrc] = this.getNonNegativeValue(now.bytesSent);\n                    ssrcStats.addBitrate({\n                        'download': 0,\n                        'upload': this._calculateBitrate(now, before, 'bytesSent')\n                    });\n                }\n\n                const codec = this.currentStatsReport.get(now.codecId);\n\n                if (codec) {\n                    /**\n                     * The mime type has the following form: video/VP8 or audio/ISAC, so we what to keep just the type\n                     * after the '/', audio and video keys will be added on the processing side.\n                     */\n                    const codecShortType = codec.mimeType.split('/')[1];\n\n                    codecShortType && ssrcStats.setCodec(codecShortType);\n\n                    // Calculate the encodeTime stat for outbound video streams.\n                    const track = this.peerconnection.getTrackBySSRC(ssrc);\n\n                    if (now.type === 'outbound-rtp'\n                        && now.active\n                        && track?.isVideoTrack()\n                        && before?.totalEncodeTime\n                        && before?.framesEncoded\n                        && now.frameHeight\n                        && now.frameWidth) {\n                        const encodeTimeDelta = now.totalEncodeTime - before.totalEncodeTime;\n                        const framesEncodedDelta = now.framesEncoded - before.framesEncoded;\n                        const encodeTimePerFrameInMs = 1000 * encodeTimeDelta / framesEncodedDelta;\n                        const encodeTimeStats = {\n                            codec: codecShortType,\n                            encodeTime: encodeTimePerFrameInMs,\n                            qualityLimitationReason: now.qualityLimitationReason,\n                            resolution,\n                            timestamp: now.timestamp\n                        };\n\n                        encodedTimeStatsPerSsrc.set(ssrc, encodeTimeStats);\n                        ssrcStats.setEncodeStats(encodedTimeStatsPerSsrc);\n                    }\n                }\n\n            // Continue to use the 'track' based stats for Firefox and Safari and older versions of Chromium.\n            } else if (browser.supportsTrackBasedStats()\n                && now.type === 'track'\n                && now.kind === MediaType.VIDEO\n                && !now.remoteSource) {\n                const resolution = {\n                    height: now.frameHeight,\n                    width: now.frameWidth\n                };\n                const localVideoTracks = this.peerconnection.getLocalTracks(MediaType.VIDEO);\n\n                if (!localVideoTracks?.length) {\n                    return;\n                }\n\n                const ssrc = this.peerconnection.getSsrcByTrackId(now.trackIdentifier);\n\n                if (!ssrc) {\n                    return;\n                }\n                let ssrcStats = this.ssrc2stats.get(ssrc);\n\n                if (!ssrcStats) {\n                    ssrcStats = new SsrcStats();\n                    this.ssrc2stats.set(ssrc, ssrcStats);\n                }\n                if (resolution.height && resolution.width) {\n                    ssrcStats.setResolution(resolution);\n                }\n\n                // Calculate the frame rate. 'framesSent' is the total aggregate value for all the simulcast streams.\n                // Therefore, it needs to be divided by the total number of active simulcast streams.\n                let frameRate = now.framesPerSecond;\n\n                if (!frameRate && before) {\n                    frameRate = this._calculateFps(now, before, 'framesSent');\n                }\n                ssrcStats.setFramerate(frameRate);\n            }\n        });\n\n        if (Object.keys(byteSentStats).length) {\n            this.eventEmitter.emit(StatisticsEvents.BYTE_SENT_STATS, this.peerconnection, byteSentStats);\n        }\n\n        if (encodedTimeStatsPerSsrc.size) {\n            this.eventEmitter.emit(StatisticsEvents.ENCODE_TIME_STATS, this.peerconnection, encodedTimeStatsPerSsrc);\n        }\n\n        this._processAndEmitReport();\n    }\n}\n","import { getLogger } from '@jitsi/logger';\n\nimport JitsiConference from '../../JitsiConference';\nimport { JitsiTrackEvents } from '../../JitsiTrackEvents';\nimport { AnalyticsEvents } from '../../service/statistics/AnalyticsEvents';\nimport { StatisticsEvents } from '../../service/statistics/Events';\nimport { LOCAL_JID } from '../../service/statistics/constants';\nimport JitsiTrack from '../RTC/JitsiTrack';\nimport TraceablePeerConnection from '../RTC/TraceablePeerConnection';\nimport RTCStats from '../RTCStats/RTCStats';\nimport browser from '../browser';\nimport EventEmitter from '../util/EventEmitter';\nimport WatchRTC from '../watchRTC/WatchRTC';\nimport XMPP from '../xmpp/xmpp';\n\nimport analytics from './AnalyticsAdapter';\nimport LocalStats from './LocalStatsCollector';\nimport RTPStats from './RTPStatsCollector';\n\nconst logger = getLogger('stats:statistics');\n\nexport type IStatisticsOptions = {\n    aliasName?: string;\n    applicationName?: string;\n    callStatsID?: string;\n    callStatsSecret?: string;\n    confID?: string;\n    customScriptUrl?: string;\n    roomName?: string;\n    userName?: string;\n};\n\n/**\n * Statistics class provides various functionality related to collecting and reporting statistics.\n */\nexport default class Statistics {\n    /**\n     * Stores all active Statistics instances.\n     * @type {Set<Statistics>}\n     */\n    static _instances: Set<Statistics>;\n\n    /**\n     * Static getter for instances property\n     * Returns the Set holding all active Statistics instances. Lazily\n     * initializes the Set to allow any Set polyfills to be applied.\n     * @type {Set<Statistics>}\n     */\n    static get instances(): Set<Statistics> {\n        if (!Statistics._instances) {\n            Statistics._instances = new Set();\n        }\n\n        return Statistics._instances;\n    }\n\n    /**\n     * Flag indicating whether audio levels are enabled or not.\n     * @static\n     * @type {boolean}\n     */\n    static audioLevelsEnabled: boolean = false;\n\n    /**\n     * The interval for audio levels stats collection.\n     * @static\n     * @type {number}\n     */\n    static audioLevelsInterval: number = 200;\n\n    /**\n     * The interval for peer connection stats collection.\n     * @static\n     * @type {number}\n     */\n    static pcStatsInterval: number = 10000;\n\n    /**\n     * Flag indicating whether third party requests are disabled.\n     * @static\n     * @type {boolean}\n     */\n    static disableThirdPartyRequests: boolean = false;\n\n    /**\n     * Analytics adapter for sending events.\n     * @static\n     * @type {Object}\n     */\n    static analytics: {\n        addPermanentProperties: (properties: Record<string, any>) => void;\n        sendEvent: (eventName: string | Record<string, any>, properties?: Record<string, any>) => void;\n    } = analytics;\n\n    /**\n     * Array holding local statistics collectors.\n     * @static\n     * @type {Array}\n     */\n    static localStats: LocalStats[] = [];\n\n    /**\n     * Local JID constant.\n     * @static\n     * @type {string}\n     */\n    static LOCAL_JID: string = LOCAL_JID;\n\n    /**\n     * Init statistic options\n     * @static\n     * @param {Object} options - The options to initialize statistics with\n     */\n    static init(options: {\n        audioLevelsInterval?: number;\n        disableAudioLevels?: boolean;\n        disableThirdPartyRequests?: boolean;\n        pcStatsInterval?: number;\n    }): void {\n        Statistics.audioLevelsEnabled = !options.disableAudioLevels;\n        if (typeof options.pcStatsInterval === 'number') {\n            Statistics.pcStatsInterval = options.pcStatsInterval;\n        }\n        if (typeof options.audioLevelsInterval === 'number') {\n            Statistics.audioLevelsInterval = options.audioLevelsInterval;\n        }\n        Statistics.disableThirdPartyRequests = options.disableThirdPartyRequests;\n        LocalStats.init();\n        WatchRTC.init(options);\n    }\n\n    /**\n     * Starts collecting local statistics for a track.\n     * @static\n     * @param {JitsiTrack} track - The track to collect statistics for\n     * @param {Function} callback - The callback to invoke with audio levels\n     */\n    static startLocalStats(track: JitsiTrack, callback: (audioLevel: number) => void): void {\n        if (browser.isIosBrowser()) {\n            // On iOS browsers audio is lost if the audio input device is in use by another app\n            // https://bugs.webkit.org/show_bug.cgi?id=233473\n            // The culprit was using the AudioContext, so now we close the AudioContext during\n            // the track being muted, and re-instantiate it afterwards.\n            track.addEventListener(\n                JitsiTrackEvents.NO_DATA_FROM_SOURCE,\n                /**\n                 * Closes AudioContext on no audio data, and enables it on data received again.\n                 *\n                 * @param {boolean} value - Whether we receive audio data or not.\n                 */\n                async (value: boolean) => {\n                    if (value) {\n                        for (const localStat of Statistics.localStats) {\n                            localStat.stop();\n                        }\n                        await LocalStats.disconnectAudioContext();\n                    } else {\n                        LocalStats.connectAudioContext();\n                        for (const localStat of Statistics.localStats) {\n                            localStat.start();\n                        }\n                    }\n                }\n            );\n        }\n        if (!Statistics.audioLevelsEnabled) {\n            return;\n        }\n        track.addEventListener(\n            JitsiTrackEvents.LOCAL_TRACK_STOPPED,\n            () => {\n                Statistics.stopLocalStats(track);\n            }\n        );\n        const stream = track.getOriginalStream();\n        const localStats = new LocalStats(stream, Statistics.audioLevelsInterval, callback);\n\n        this.localStats.push(localStats);\n        localStats.start();\n    }\n\n    /**\n     * Stops collecting local statistics for a track.\n     * @static\n     * @param {JitsiTrack} track - The track to stop collecting statistics for\n     */\n    static stopLocalStats(track: JitsiTrack): void {\n        if (!Statistics.audioLevelsEnabled) {\n            return;\n        }\n        const stream = track.getOriginalStream();\n\n        for (let i = 0; i < Statistics.localStats.length; i++) {\n            if (Statistics.localStats[i].stream === stream) {\n                const localStats = Statistics.localStats.splice(i, 1);\n\n                localStats[0].stop();\n                break;\n            }\n        }\n    }\n\n    /**\n     * Sends event to analytics and logs a message to the logger/console.\n     * @static\n     * @param {string | Object} event - The event name, or an object which represents the entire event\n     * @param {Object} properties - Properties to attach to the event\n     */\n    static sendAnalyticsAndLog(event: string | Record<string, any>, properties: Record<string, any> = {}): void {\n        if (!event) {\n            logger.warn('No event or event name given.');\n\n            return;\n        }\n        let eventToLog;\n\n        // Also support an API with a single object as an event.\n        if (typeof event === 'object') {\n            eventToLog = event;\n        } else {\n            eventToLog = {\n                name: event,\n                properties\n            };\n        }\n        logger.debug(JSON.stringify(eventToLog));\n        // We do this last, because it may modify the object which is passed.\n        this.analytics.sendEvent(event, properties);\n    }\n\n    /**\n     * Sends event to analytics.\n     * @static\n     * @param {string | Object} eventName - The event name, or an object which represents the entire event\n     * @param {Object} properties - Properties to attach to the event\n     */\n    static sendAnalytics(eventName: string | Record<string, any>, properties: Record<string, any> = {}): void {\n        this.analytics.sendEvent(eventName, properties);\n    }\n\n    /**\n     * The options to configure Statistics.\n     * @typedef {Object} StatisticsOptions\n     * @property {string} userName - The user name to use\n     * @property {string} roomName - The room name we are currently in.\n     *\n     * @param {JitsiConference} conference - The conference instance from which the statistics were initialized.\n     * @param {StatisticsOptions} options - The options to use creating the\n     * Statistics.\n     */\n    rtpStatsMap: Map<string, RTPStats>;\n    eventEmitter: EventEmitter;\n    conference: JitsiConference;\n    xmpp: XMPP;\n    options: IStatisticsOptions;\n\n    constructor(conference: JitsiConference, options: IStatisticsOptions) {\n        /**\n         * {@link RTPStats} mapped by {@link TraceablePeerConnection.id} which\n         * collect RTP statistics for each peerconnection.\n         * @type {Map<string, RTPStats>}\n         */\n        this.rtpStatsMap = new Map();\n        this.eventEmitter = new EventEmitter();\n        this.conference = conference;\n        this.xmpp = conference?.xmpp;\n        this.options = options || ({} as IStatisticsOptions);\n        Statistics.instances.add(this);\n        RTCStats.attachToConference(this.conference);\n        // WatchRTC is not required to work for react native\n        if (!browser.isReactNative()) {\n            WatchRTC.start(this.options.roomName, this.options.userName);\n        }\n    }\n\n    /**\n     * Starts collecting RTP stats for given peerconnection.\n     * @param {TraceablePeerConnection} peerconnection\n     */\n    startRemoteStats(peerconnection: TraceablePeerConnection): void {\n        this.stopRemoteStats(peerconnection);\n        try {\n            const rtpStats = new RTPStats(\n                peerconnection,\n                Statistics.audioLevelsInterval,\n                Statistics.pcStatsInterval,\n                this.eventEmitter\n            );\n\n            rtpStats.start(Statistics.audioLevelsEnabled);\n            this.rtpStatsMap.set(String(peerconnection.id), rtpStats);\n        } catch (e) {\n            logger.error(`Failed to start collecting remote statistics: ${e}`);\n        }\n    }\n\n    /**\n     * Adds a listener for audio level events.\n     * @param {Function} listener - The listener to add\n     */\n    addAudioLevelListener(listener: (...args: any[]) => void): void {\n        if (!Statistics.audioLevelsEnabled) {\n            return;\n        }\n        this.eventEmitter.on(StatisticsEvents.AUDIO_LEVEL, listener);\n    }\n\n    /**\n     * Removes an audio level listener.\n     * @param {Function} listener - The listener to remove\n     */\n    removeAudioLevelListener(listener: (...args: any[]) => void): void {\n        if (!Statistics.audioLevelsEnabled) {\n            return;\n        }\n        this.eventEmitter.removeListener(StatisticsEvents.AUDIO_LEVEL, listener);\n    }\n\n    /**\n     * Adds a listener for before disposed events.\n     * @param {Function} listener - The listener to add\n     */\n    addBeforeDisposedListener(listener: (...args: any[]) => void): void {\n        this.eventEmitter.on(StatisticsEvents.BEFORE_DISPOSED, listener);\n    }\n\n    /**\n     * Removes a before disposed listener.\n     * @param {Function} listener - The listener to remove\n     */\n    removeBeforeDisposedListener(listener: (...args: any[]) => void): void {\n        this.eventEmitter.removeListener(\n            StatisticsEvents.BEFORE_DISPOSED, listener);\n    }\n\n    /**\n     * Adds a listener for connection stats events.\n     * @param {Function} listener - The listener to add\n     */\n    addConnectionStatsListener(listener: (...args: any[]) => void): void {\n        this.eventEmitter.on(StatisticsEvents.CONNECTION_STATS, listener);\n    }\n\n    /**\n     * Removes a connection stats listener.\n     * @param {Function} listener - The listener to remove\n     */\n    removeConnectionStatsListener(listener: (...args: any[]) => void): void {\n        this.eventEmitter.removeListener(\n            StatisticsEvents.CONNECTION_STATS,\n            listener);\n    }\n\n    /**\n     * Adds a listener for encode time stats events.\n     * @param {Function} listener - The listener to add\n     */\n    addEncodeTimeStatsListener(listener: (...args: any[]) => void): void {\n        this.eventEmitter.on(StatisticsEvents.ENCODE_TIME_STATS, listener);\n    }\n\n    /**\n     * Removes an encode time stats listener.\n     * @param {Function} listener - The listener to remove\n     */\n    removeEncodeTimeStatsListener(listener: (...args: any[]) => void): void {\n        this.eventEmitter.removeListener(StatisticsEvents.ENCODE_TIME_STATS, listener);\n    }\n\n    /**\n     * Adds a listener for byte sent stats events.\n     * @param {Function} listener - The listener to add\n     */\n    addByteSentStatsListener(listener: (...args: any[]) => void): void {\n        this.eventEmitter.on(StatisticsEvents.BYTE_SENT_STATS, listener);\n    }\n\n    /**\n     * Removes a byte sent stats listener.\n     * @param {Function} listener - The listener to remove\n     */\n    removeByteSentStatsListener(listener: (...args: any[]) => void): void {\n        this.eventEmitter.removeListener(StatisticsEvents.BYTE_SENT_STATS,\n            listener);\n    }\n\n    /**\n     * Updates the list of speakers for which the audio levels are to be calculated. This is needed for the jvb pc only.\n     *\n     * @param {Array<string>} speakerList The list of remote endpoint ids.\n     * @returns {void}\n     */\n    setSpeakerList(speakerList: string[]): void {\n        for (const rtpStats of Array.from(this.rtpStatsMap.values())) {\n            if (!rtpStats.peerconnection.isP2P) {\n                rtpStats.setSpeakerList(speakerList);\n            }\n        }\n    }\n\n    /**\n     * Disposes of this instance, stopping any ongoing stats collection.\n     */\n    dispose(): void {\n        try {\n            this.eventEmitter.emit(StatisticsEvents.BEFORE_DISPOSED);\n            for (const tpcId of this.rtpStatsMap.keys()) {\n                this._stopRemoteStats(tpcId);\n            }\n            if (this.eventEmitter) {\n                this.eventEmitter.removeAllListeners();\n            }\n        } finally {\n            Statistics.instances.delete(this);\n        }\n    }\n\n    /**\n     * Stops remote RTP stats for given peerconnection ID.\n     * @param {string} tpcId {@link TraceablePeerConnection.id}\n     * @private\n     */\n    _stopRemoteStats(tpcId: string): void {\n        const rtpStats = this.rtpStatsMap.get(tpcId);\n\n        if (rtpStats) {\n            rtpStats.stop();\n            this.rtpStatsMap.delete(tpcId);\n        }\n    }\n\n    /**\n     * Stops collecting RTP stats for given peerconnection\n     * @param {TraceablePeerConnection} tpc\n     */\n    stopRemoteStats(tpc: TraceablePeerConnection): void {\n        this._stopRemoteStats(String(tpc.id));\n    }\n\n    /**\n     * Sends the given feedback\n     *\n     * @param {number} overall an integer between 1 and 5 indicating the user's rating.\n     * @param {string} comment the comment from the user.\n     * @returns {Promise} Resolves immediately.\n     */\n    sendFeedback(overall: number, comment: string): Promise<void> {\n        // Statistics.analytics.sendEvent is currently fire and forget, without\n        // confirmation of successful send.\n        Statistics.analytics.sendEvent(\n            AnalyticsEvents.FEEDBACK,\n            {\n                comment,\n                rating: overall\n            });\n\n        return Promise.resolve();\n    }\n}\n\n","export const LOCAL_JID = 'local';\n","/**\n * Implements utility to forward events from one eventEmitter to another.\n * @param src {object} instance of EventEmitter or another class that implements\n * addListener method which will register listener to EventEmitter instance.\n * @param dest {object} instance of EventEmitter or another class that\n * implements emit method which will emit an event.\n */\nexport default class EventEmitterForwarder {\n    src: any;\n    dest: any;\n    listeners: Map<any, any>;\n\n    /**\n     * @constructor\n     */\n    constructor(src: any, dest: any) {\n        if (!src || !dest || typeof src.addListener !== 'function' || typeof dest.emit !== 'function') {\n            throw new Error('Invalid arguments passed to EventEmitterForwarder');\n        }\n        this.src = src;\n        this.dest = dest;\n        this.listeners = new Map();\n    }\n\n    /**\n     * Adds event to be forwarded from src to dest.\n     * @param srcEvent {string} the event that EventEmitterForwarder is listening\n     * for.\n     * @param dstEvent {string} the event that will be fired from dest.\n     * @param arguments all other passed arguments are going to be fired with\n     * dstEvent.\n     */\n    forward(...args) {\n        const srcEvent = args[0];\n\n        // This will be the \"this\" value for emit function.\n        args[0] = this.dest;\n\n        // Using bind.apply to pass the arguments as Array-like object (\"arguments\")\n        const newListener = Function.prototype.bind.apply(this.dest.emit, args);\n\n        this.src.addListener(srcEvent, newListener);\n        this.listeners.set(srcEvent, newListener);\n    }\n\n    /**\n     * Clears the listeners for the supplied events.\n     *\n     * @param args all the events which listeners to be cleaned.\n     */\n    removeListeners(...args) {\n        args.forEach(a => {\n            const l = this.listeners.get(a);\n\n            if (l) {\n                this.src.removeListener(a, l);\n                this.listeners.delete(a);\n            }\n        });\n    }\n}\n","export enum RTCEvents {\n    /**\n     * Designates an event indicating that the audio output device has changed.\n     */\n    AUDIO_OUTPUT_DEVICE_CHANGED = 'rtc.audio_output_device_changed',\n\n    /**\n     * Designates an event indicating that some audio SSRCs that have already been signaled will now map to new remote\n     * sources.\n     */\n    AUDIO_SSRCS_REMAPPED = 'rtc.audio_ssrcs_remapped',\n\n    /**\n     * Designates an event indicating that the bridge bandwidth estimation stats have been received.\n     */\n    BRIDGE_BWE_STATS_RECEIVED = 'rtc.bridge_bwe_stats_received',\n\n    /**\n     * Indicates that the data channel has been closed.\n     */\n    DATA_CHANNEL_CLOSED = 'rtc.data_channel_closed',\n\n    /**\n     * Indicates that the data channel has been opened.\n     */\n    DATA_CHANNEL_OPEN = 'rtc.data_channel_open',\n\n    /**\n     * Indicates that the list with available devices is now available.\n     */\n    DEVICE_LIST_AVAILABLE = 'rtc.device_list_available',\n\n    /**\n     * Indicates that the list with available devices has changed.\n     */\n    DEVICE_LIST_CHANGED = 'rtc.device_list_changed',\n\n    /**\n     * Indicates that the list with available devices will change.\n     */\n    DEVICE_LIST_WILL_CHANGE = 'rtc.device_list_will_change',\n\n    /**\n     * Indicates that the dominant speaker has changed.\n     */\n    DOMINANT_SPEAKER_CHANGED = 'rtc.dominant_speaker_changed',\n\n    /**\n     * Indicates that the connection status of the endpoint has changed.\n     */\n    ENDPOINT_CONN_STATUS_CHANGED = 'rtc.endpoint_conn_status_changed',\n\n    /**\n     * Indicates that a message from another participant is received on data channel.\n     */\n    ENDPOINT_MESSAGE_RECEIVED = 'rtc.endpoint_message_received',\n\n    /**\n     * Indicates that the remote endpoint stats have been received on data channel.\n     */\n    ENDPOINT_STATS_RECEIVED = 'rtc.endpoint_stats_received',\n\n    /**\n     * Indicates that the list of sources currently being forwarded by the bridge has changed.\n     */\n    FORWARDED_SOURCES_CHANGED = 'rtc.forwarded_sources_changed',\n\n    /**\n     * Event emitted when {@link RTC.setLastN} method is called to update with the new value set.\n     * The first argument is the value passed to {@link RTC.setLastN}.\n     */\n    LASTN_VALUE_CHANGED = 'rtc.lastn_value_changed',\n\n    /**\n     * The max enabled resolution of a local video track was changed.\n     */\n    LOCAL_TRACK_MAX_ENABLED_RESOLUTION_CHANGED = 'rtc.local_track_max_enabled_resolution_changed',\n\n    /**\n     * Designates an event indicating that the local ICE username fragment of\n     * the jingle session has changed.\n     * The first argument of the vent is <tt>TraceablePeerConnection</tt> which\n     * is the source of the event.\n     * The second argument is the actual \"ufrag\" string.\n     */\n    LOCAL_UFRAG_CHANGED = 'rtc.local_ufrag_changed',\n\n    /**\n     * Event emitted when the user granted/blocked a permission for the camera / mic.\n     * Used to keep track of the granted permissions on browsers which don't\n     * support the Permissions API.\n     */\n    PERMISSIONS_CHANGED = 'rtc.permissions_changed',\n\n    /**\n     * Event fired when we remote track is added to the conference.\n     * 1st event argument is the added <tt>JitsiRemoteTrack</tt> instance.\n     **/\n    REMOTE_TRACK_ADDED = 'rtc.remote_track_added',\n\n    // FIXME get rid of this event in favour of NO_DATA_FROM_SOURCE event\n    // (currently implemented for local tracks only)\n    REMOTE_TRACK_MUTE = 'rtc.remote_track_mute',\n\n    /**\n     * Indicates that the remote track has been removed from the conference.\n     * 1st event argument is the removed {@link JitsiRemoteTrack} instance.\n     */\n    REMOTE_TRACK_REMOVED = 'rtc.remote_track_removed',\n\n    // FIXME get rid of this event in favour of NO_DATA_FROM_SOURCE event\n    // (currently implemented for local tracks only)\n    REMOTE_TRACK_UNMUTE = 'rtc.remote_track_unmute',\n\n    /**\n     * Designates an event indicating that the local ICE username fragment of the jingle session has changed.\n     * The first argument of the vent is <tt>TraceablePeerConnection</tt> which is the source of the event.\n     * The second argument is the actual \"ufrag\" string.\n     */\n    REMOTE_UFRAG_CHANGED = 'rtc.remote_ufrag_changed',\n\n    /**\n     * Indicates that sender constraints requested by the bridge for this endpoint have changed.\n     */\n    SENDER_VIDEO_CONSTRAINTS_CHANGED = 'rtc.sender_video_constraints_changed',\n\n    /**\n     * Designates an event indicating that some video SSRCs that have already been signaled will now map to new remote\n     * sources.\n     */\n    VIDEO_SSRCS_REMAPPED = 'rtc.video_ssrcs_remapped'\n}\n","export enum AuthenticationEvents {\n    /**\n     * Event callback arguments:\n     * function(authenticationEnabled, userIdentity)\n     * authenticationEnabled - indicates whether authentication has been enabled\n     *                         in this session\n     * userIdentity - if user has been logged in then it contains user name. If\n     *                contains 'null' or 'undefined' then user is not logged in.\n     */\n    IDENTITY_UPDATED = 'authentication.identity_updated'\n}\n","export enum XMPPEvents {\n\n    /**\n     * Indicates error while adding ice candidate.\n     */\n    ADD_ICE_CANDIDATE_FAILED = 'xmpp.add_ice_candidate_failed',\n\n    // Designates an event indicating that the focus has asked us to mute our\n    // audio.\n    AUDIO_MUTED_BY_FOCUS = 'xmpp.audio_muted_by_focus',\n\n    AUTHENTICATION_REQUIRED = 'xmpp.authentication_required',\n\n    /**\n     * Event fired when we receive a message for AV moderation approved for the local participant.\n     */\n    AV_MODERATION_APPROVED = 'xmpp.av_moderation.approved',\n\n    /**\n     * Event fired when the moderation enable/disable changes.\n     */\n    AV_MODERATION_CHANGED = 'xmpp.av_moderation.changed',\n\n    /**\n     * Event fired when we receive message that a new jid was approved.\n     */\n    AV_MODERATION_PARTICIPANT_APPROVED = 'xmpp.av_moderation.participant.approved',\n\n    /**\n     * Event fired when we receive message that a new jid was approved.\n     */\n    AV_MODERATION_PARTICIPANT_REJECTED = 'xmpp.av_moderation.participant.rejected',\n\n    /**\n     * Event fired when we receive a message for AV moderation.\n     */\n    AV_MODERATION_RECEIVED = 'xmpp.av_moderation.received',\n\n    /**\n    * Event fired when we receive a message for AV moderation rejected for the local participant.\n    */\n    AV_MODERATION_REJECTED = 'xmpp.av_moderation.rejected',\n\n    /**\n     * Event fired when we receive a message for breakout rooms.\n     */\n    BREAKOUT_ROOMS_EVENT = 'xmpp.breakout-rooms.event',\n\n    /**\n     * Event fired when a participant is requested to join a given (breakout) room.\n     */\n    BREAKOUT_ROOMS_MOVE_TO_ROOM = 'xmpp.breakout-rooms.move-to-room',\n\n    /**\n     * Event fired when the breakout rooms data was updated.\n     */\n    BREAKOUT_ROOMS_UPDATED = 'xmpp.breakout-rooms.updated',\n\n    BRIDGE_DOWN = 'xmpp.bridge_down',\n\n    /**\n     * Triggered when 'session-accept' is received from the responder.\n     */\n    CALL_ACCEPTED = 'xmpp.callaccepted.jingle',\n\n    // Triggered when Jicofo kills our media session, this can happen while\n    // we're still in the MUC, when it decides to terminate the media session.\n    // For example when the session is idle for too long, because we're the only\n    // person in the conference room.\n    CALL_ENDED = 'xmpp.callended.jingle',\n\n    // Designates an event indicating that an offer (e.g. Jingle\n    // session-initiate) was received.\n    CALL_INCOMING = 'xmpp.callincoming.jingle',\n\n    CHAT_ERROR_RECEIVED = 'xmpp.chat_error_received',\n\n    // The conference properties (as advertised by jicofo) have changed\n    CONFERENCE_PROPERTIES_CHANGED = 'xmpp.conference_properties_changed',\n\n    /**\n     * Event fired when conference creation timestamp is received.\n     */\n    CONFERENCE_TIMESTAMP_RECEIVED = 'xmpp.conference_timestamp_received',\n\n    /**\n     * This event is triggered when the ICE connects for the first time.\n     */\n    CONNECTION_ESTABLISHED = 'xmpp.connection.connected',\n\n    // Designates an event indicating that the connection to the XMPP server\n    // failed.\n    CONNECTION_FAILED = 'xmpp.connection.failed',\n\n    // Designates an event indicating that the media (ICE) connection failed.\n    // This should go to the RTC module.\n    CONNECTION_ICE_FAILED = 'xmpp.connection.ice.failed',\n\n    // Designates an event indicating that the media (ICE) connection was\n    // interrupted. This should go to the RTC module.\n    CONNECTION_INTERRUPTED = 'xmpp.connection.interrupted',\n\n    // Designates an event indicating that the media (ICE) connection was\n    // restored. This should go to the RTC module.\n    CONNECTION_RESTORED = 'xmpp.connection.restored',\n\n    /**\n     * Designates an event indicating connection status changes.\n     */\n    CONNECTION_STATUS_CHANGED = 'xmpp.connection.status.changed',\n\n    /**\n     * Designates an event indicating that the focus has asked us to disable our\n     * desktop share.\n     */\n    DESKTOP_MUTED_BY_FOCUS = 'xmpp.desktop_muted_by_focus',\n\n    // Designates an event indicating that the display name of a participant\n    // has changed.\n    DISPLAY_NAME_CHANGED = 'xmpp.display_name_changed',\n\n    /**\n     * Event for incoming presence error which is for required display name.\n     */\n    DISPLAY_NAME_REQUIRED = 'xmpp.display_name_required',\n\n    /**\n     * Chat room instance have been added to Strophe.emuc plugin.\n     */\n    EMUC_ROOM_ADDED = 'xmpp.emuc_room_added',\n\n    /**\n     * Chat room instance have been removed from Strophe.emuc plugin.\n     */\n    EMUC_ROOM_REMOVED = 'xmpp.emuc_room_removed',\n\n    ETHERPAD = 'xmpp.etherpad',\n\n    /**\n     * Event fired when we receive a message for files sharing.\n     */\n    FILE_SHARING_EVENT = 'xmpp.files-sharing.event',\n\n    /**\n     * Event emitted when a list file is received in the conference.\n     */\n    FILE_SHARING_FILES_RECEIVED = 'xmpp.files-sharing.list',\n\n    /**\n     * Event emitted when a file is added to the conference.\n     */\n    FILE_SHARING_FILE_ADDED = 'xmpp.files-sharing.add',\n\n    /**\n     * Event emitted when a file is removed from the conference.\n     */\n    FILE_SHARING_FILE_REMOVED = 'xmpp.files-sharing.remove',\n\n    FOCUS_DISCONNECTED = 'xmpp.focus_disconnected',\n\n    FOCUS_LEFT = 'xmpp.focus_left',\n\n    GRACEFUL_SHUTDOWN = 'xmpp.graceful_shutdown',\n\n    // Designates an event indicating that the local ICE connection state has\n    // changed.\n    ICE_CONNECTION_STATE_CHANGED = 'xmpp.ice_connection_state_changed',\n\n    // Designates an event indicating that an invite XMPP message in the MUC was\n    // received.\n    INVITE_MESSAGE_RECEIVED = 'xmpp.invite_message_received',\n\n    /**\n     * Event which is emitted when the body in an XMPP message in the MUC\n     * contains JSON\n     * TODO: this event contains a typo (xmmp vs xmpp) but it's unlikely this can be changed now\n     */\n    JSON_MESSAGE_RECEIVED = 'xmmp.json_message_received',\n\n    /**\n     * Designates an event indicating that we were kicked from the XMPP MUC.\n     * @param {boolean} isSelfPresence - whether it is for local participant\n     * or another participant.\n     * @param {string} actorJid - the jid of the participant who was initiator\n     * of the kick.\n     * @param {?string} participantJid - when it is not a kick for local participant,\n     * this is the jid of the participant which was kicked.\n     */\n    KICKED = 'xmpp.kicked',\n\n    // Designates an event indicating that our role in the XMPP MUC has changed.\n    LOCAL_ROLE_CHANGED = 'xmpp.localrole_changed',\n\n    /**\n     * Event fired when the unique meeting id is set.\n     */\n    MEETING_ID_SET = 'xmpp.meeting_id_set',\n\n    // Designates an event indicating that an XMPP message in the MUC was\n    // received.\n    MESSAGE_RECEIVED = 'xmpp.message_received',\n\n    // Designates an event indicating that a participant was denied access to a conference from the lobby XMPP MUC.\n    MUC_DENIED_ACCESS = 'xmpp.muc_denied access',\n\n    // Designates an event indicating that the XMPP MUC was destroyed.\n    MUC_DESTROYED = 'xmpp.muc_destroyed',\n\n    // Designates an event indicating that we have joined the XMPP MUC.\n    MUC_JOINED = 'xmpp.muc_joined',\n\n    // Designates an event indicating that we are currently in process of joining the XMPP MUC.\n    MUC_JOIN_IN_PROGRESS = 'xmpp.muc_join_in_progress',\n\n    // Designates an event indicating that local participant left the muc\n    MUC_LEFT = 'xmpp.muc_left',\n\n    // Designates an event indicating that a participant joined the lobby XMPP MUC.\n    MUC_LOBBY_MEMBER_JOINED = 'xmpp.muc_lobby_member_joined',\n\n    // Designates an event indicating that a participant left the XMPP MUC.\n    MUC_LOBBY_MEMBER_LEFT = 'xmpp.muc_lobby_member_left',\n\n    // Designates an event indicating that a participant in the lobby XMPP MUC has been updated\n    MUC_LOBBY_MEMBER_UPDATED = 'xmpp.muc_lobby_member_updated',\n\n    // Designates an event indicating that the MUC has been locked or unlocked.\n    MUC_LOCK_CHANGED = 'xmpp.muc_lock_changed',\n\n    // Designates an event indicating that the MUC members only config has changed.\n    MUC_MEMBERS_ONLY_CHANGED = 'xmpp.muc_members_only_changed',\n\n    // Designates an event indicating that a bot participant type had changed\n    MUC_MEMBER_BOT_TYPE_CHANGED = 'xmpp.muc_member_bot_type_changed',\n\n    // Designates an event indicating that a participant joined the XMPP MUC.\n    MUC_MEMBER_JOINED = 'xmpp.muc_member_joined',\n\n    // Designates an event indicating that a participant left the XMPP MUC.\n    MUC_MEMBER_LEFT = 'xmpp.muc_member_left',\n\n    // Designates an event indicating that the MUC role of a participant has\n    // changed.\n    MUC_ROLE_CHANGED = 'xmpp.muc_role_changed',\n\n    // Designates an event indicating that the MUC visitors support has changed.\n    MUC_VISITORS_SUPPORTED_CHANGED = 'xmpp.muc_visitors_supported_changed',\n\n    // Designates an event indicating that a participant in the XMPP MUC has\n    // advertised that they have audio muted (or unmuted).\n    PARTICIPANT_AUDIO_MUTED = 'xmpp.audio_muted',\n\n    /**\n     * Indicates that the features of the participant has been changed.\n     */\n    PARTICIPANT_FEATURES_CHANGED = 'xmpp.participant_features_changed',\n\n    // Designates an event indicating that a participant in the XMPP MUC has\n    // advertised that they have video muted (or unmuted).\n    PARTICIPANT_VIDEO_MUTED = 'xmpp.video_muted',\n\n    // Designates an event indicating that the video type (e.g. 'camera' or\n    // 'screen') for a participant has changed.\n    // Note = currently this event fires every time we receive presence from\n    // someone (regardless of whether or not the \"video type\" changed).\n    PARTICIPANT_VIDEO_TYPE_CHANGED = 'xmpp.video_type',\n\n    PASSWORD_REQUIRED = 'xmpp.password_required',\n\n    /**\n     * Event fired when we receive a self-presence with permissions.\n     */\n    PERMISSIONS_RECEIVED = 'xmpp.permissions_received',\n\n    /**\n     * Indicates that phone number changed.\n     */\n    PHONE_NUMBER_CHANGED = 'conference.phoneNumberChanged',\n\n    /**\n     * Event fired when we receive an answer for a poll.\n     */\n    POLLS_ANSWER_EVENT = 'xmpp.polls.answer.event',\n\n    /**\n     * Event fired when we receive a message for polls.\n     */\n    POLLS_EVENT = 'xmpp.polls.event',\n\n    /**\n     * Event fired when we received a poll or polls history event (old-polls).\n     */\n    POLLS_RECEIVE_EVENT = 'xmpp.polls.received.event',\n\n    PRESENCE_RECEIVED = 'xmpp.presence_received',\n    PRESENCE_STATUS = 'xmpp.presence_status',\n\n    // Designates an event indicating that a private XMPP message in the MUC was\n    // received.\n    PRIVATE_MESSAGE_RECEIVED = 'xmpp.private_message_received',\n    PROMPT_FOR_LOGIN = 'xmpp.prompt_for_login',\n\n    // Designates an event indicating that a reaction XMPP message in the MUC\n    // was received.\n    REACTION_RECEIVED = 'xmpp.reaction_received',\n\n    // xmpp is connected and obtained user media\n    READY_TO_JOIN = 'xmpp.ready_to_join',\n\n    /**\n     * Indicates that recording state changed.\n     */\n    RECORDER_STATE_CHANGED = 'xmpp.recorderStateChanged',\n\n    // Designates an event indicating that we received statistics from a\n    // participant in the MUC.\n    REMOTE_STATS = 'xmpp.remote_stats',\n\n    RESERVATION_ERROR = 'xmpp.room_reservation_error',\n\n    ROOM_CONNECT_ERROR = 'xmpp.room_connect_error',\n\n    ROOM_CONNECT_MEMBERS_ONLY_ERROR = 'xmpp.room_connect_error.members_only',\n\n    ROOM_CONNECT_NOT_ALLOWED_ERROR = 'xmpp.room_connect_error.not_allowed',\n\n    ROOM_DISCO_INFO_FAILED = 'xmpp.room_disco_info_failed',\n\n    /**\n     * Indicates that we have received a reply to our disco-info request for the room.\n     */\n    ROOM_DISCO_INFO_UPDATED = 'xmpp.room_disco_info_updated',\n\n    ROOM_JOIN_ERROR = 'xmpp.room_join_error',\n\n    /**\n     * Indicates that max users limit has been reached.\n     */\n    ROOM_MAX_USERS_ERROR = 'xmpp.room_max_users_error',\n\n    /**\n     * Event fired when we receive a message related to room metadata.\n     */\n    ROOM_METADATA_EVENT = 'xmpp.room-metadata.event',\n\n    /**\n     * Event fired when we receive a message related to room metadata.\n     */\n    ROOM_METADATA_UPDATED = 'xmpp.room-metadata.updated',\n\n    // Designates an event indicating that we sent an XMPP message to the MUC.\n    SENDING_CHAT_MESSAGE = 'xmpp.sending_chat_message',\n\n    // Designates an event indicating that we sent a private XMPP message to\n    // a specific user of the muc.\n    SENDING_PRIVATE_CHAT_MESSAGE = 'xmpp.sending_private_chat_message',\n\n    /**\n     * Event fired after receiving the confirmation about session accept.\n     */\n    SESSION_ACCEPT = 'xmpp.session_accept',\n\n    /**\n     * Event fired if we receive an error after sending the session accept.\n     */\n    SESSION_ACCEPT_ERROR = 'xmpp.session_accept_error',\n\n    /**\n     * Event fired when we do not get our 'session-accept' acknowledged by\n     * Jicofo. It most likely means that there is serious problem with our\n     * connection or XMPP server and we should reload the conference.\n     *\n     * We have seen that to happen in BOSH requests race condition when the BOSH\n     * request table containing the 'session-accept' was discarded by Prosody.\n     * Jicofo does send the RESULT immediately without any condition, so missing\n     * packets means that most likely it has never seen our IQ.\n     */\n    SESSION_ACCEPT_TIMEOUT = 'xmpp.session_accept_timeout',\n\n    SETTINGS_ERROR_RECEIVED = 'xmpp.settings_error_received',\n\n    /**\n     * Event fired when participant joins a meeting without audio.\n     */\n    SILENT_STATUS_CHANGED = 'xmpp.silent_status_changed',\n\n    /**\n     * Event fired after successful sending of jingle source-add.\n     */\n    SOURCE_ADD = 'xmpp.source_add',\n\n    /**\n     * Event fired after receiving an error sending of jingle source-add.\n     */\n    SOURCE_ADD_ERROR = 'xmpp.source_add_error',\n\n    /**\n     * Event fired after successful sending of jingle source-remove.\n     */\n    SOURCE_REMOVE = 'xmpp.source_remove',\n\n    /**\n     * Event fired after receiving an error sending of jingle source-remove.\n     */\n    SOURCE_REMOVE_ERROR = 'xmpp.source_remove_error',\n\n    /**\n     * Event fired when speaker stats update message is received.\n     */\n    SPEAKER_STATS_RECEIVED = 'xmpp.speaker_stats_received',\n\n    // Designates an event indicating that the subject of the XMPP MUC has\n    // changed.\n    SUBJECT_CHANGED = 'xmpp.subject_changed',\n\n    // FIXME: how does it belong to XMPP ? - it's detected by the PeerConnection\n    // suspending detected\n    SUSPEND_DETECTED = 'xmpp.suspend_detected',\n\n    /**\n     * Notifies for transcription status changes. The event provides the\n     * following parameters to its listeners:\n     *\n     * @param {String} status - The new status.\n     */\n    TRANSCRIPTION_STATUS_CHANGED = 'xmpp.transcription_status_changed',\n\n    /**\n     * Event fired when 'transport-info' with new ICE candidates is received.\n     */\n    TRANSPORT_INFO = 'xmpp.transportinfo.jingle',\n\n    // Designates an event indicating that the focus has asked us to disable our\n    // camera.\n    VIDEO_MUTED_BY_FOCUS = 'xmpp.video_muted_by_focus',\n\n    /**\n     * Indicates that video SIP GW state changed.\n     *\n     * @param {VideoSIPGWStatusConstants} status - Any of the following statuses:\n     * STATUS_BUSY, STATUS_AVAILABLE or STATUS_UNDEFINED.\n     */\n    VIDEO_SIP_GW_AVAILABILITY_CHANGED = 'xmpp.videoSIPGWAvailabilityChanged',\n\n    /**\n     * Indicates that video SIP GW Session state changed.\n     * The statuses are any of the following statuses:\n     * STATE_ON, STATE_OFF, STATE_PENDING, STATE_RETRYING, STATE_FAILED.\n     * {@see VideoSIPGWStateConstants}\n     *\n     * @param {options} event - {address, oldState, newState, displayName}.\n     */\n    VIDEO_SIP_GW_SESSION_STATE_CHANGED = 'xmpp.videoSIPGWSessionStateChanged',\n\n    /**\n     * Event indicating we have received a message from the visitors component.\n     */\n    VISITORS_MESSAGE = 'xmpp.visitors_message',\n\n    /**\n     * Event indicating that our request for promotion was rejected.\n     */\n    VISITORS_REJECTION = 'xmpp.visitors_rejection',\n\n}\n","import { getLogger } from '@jitsi/logger';\nimport { Strophe } from 'strophe.js';\n\nimport JitsiConference from './JitsiConference';\nimport * as JitsiConferenceErrors from './JitsiConferenceErrors';\nimport { JitsiConferenceEvents } from './JitsiConferenceEvents';\nimport { JitsiTrackEvents } from './JitsiTrackEvents';\nimport JitsiRemoteTrack from './modules/RTC/JitsiRemoteTrack';\nimport TraceablePeerConnection from './modules/RTC/TraceablePeerConnection';\nimport RTCStats from './modules/RTCStats/RTCStats';\nimport { RTCStatsEvents } from './modules/RTCStats/RTCStatsEvents';\nimport JibriSession from './modules/recording/JibriSession';\nimport { SPEAKERS_AUDIO_LEVELS } from './modules/statistics/constants';\nimport Statistics from './modules/statistics/statistics';\nimport EventEmitterForwarder from './modules/util/EventEmitterForwarder';\nimport JingleSessionPC from './modules/xmpp/JingleSessionPC';\nimport { MediaType } from './service/RTC/MediaType';\nimport { RTCEvents } from './service/RTC/RTCEvents';\nimport { VideoType } from './service/RTC/VideoType';\nimport { AuthenticationEvents } from './service/authentication/AuthenticationEvents';\nimport {\n    AnalyticsEvents,\n    createBridgeDownEvent,\n    createConnectionStageReachedEvent,\n    createFocusLeftEvent,\n    createJingleEvent,\n    createRemotelyMutedEvent\n} from './service/statistics/AnalyticsEvents';\nimport { XMPPEvents } from './service/xmpp/XMPPEvents';\n\nconst logger = getLogger('core:JitsiConferenceEventManager');\n\n/**\n * Setups all event listeners related to conference\n */\nexport default class JitsiConferenceEventManager {\n    private conference: JitsiConference;\n    private xmppListeners: { [key: string]: (...args: any[]) => void; }; // Todo\n    private chatRoomForwarder?: EventEmitterForwarder;\n\n    /**\n     * Setups all event listeners related to conference\n     * @param conference {JitsiConference} the conference\n     */\n    constructor(conference: JitsiConference) {\n        this.conference = conference;\n        this.xmppListeners = {};\n    }\n\n    /**\n     * Add XMPP listener and save its reference for remove on leave conference.\n     * @param {string} eventName - The event name.\n     * @param {Function} listener - The listener function.\n     * @private\n     */\n    private _addConferenceXMPPListener(eventName: string, listener: (...args: any[]) => void): void { // Todo\n        this.xmppListeners[eventName] = listener;\n        this.conference.xmpp.addListener(eventName, listener);\n    }\n\n    /**\n     * Setups event listeners related to conference.chatRoom\n     */\n    setupChatRoomListeners(): void {\n        const conference = this.conference;\n        const chatRoom = conference.room;\n\n        this.chatRoomForwarder = new EventEmitterForwarder(chatRoom,\n            this.conference.eventEmitter);\n\n        chatRoom.addListener(XMPPEvents.PARTICIPANT_FEATURES_CHANGED, (from: string, features: Set<string>) => {\n            const participant = conference.getParticipantById(Strophe.getResourceFromJid(from));\n\n            if (participant) {\n                participant.setFeatures(features);\n                conference.eventEmitter.emit(JitsiConferenceEvents.PARTCIPANT_FEATURES_CHANGED, participant);\n            }\n        });\n\n        this.chatRoomForwarder.forward(XMPPEvents.PERMISSIONS_RECEIVED, JitsiConferenceEvents.PERMISSIONS_RECEIVED);\n\n        chatRoom.addListener(XMPPEvents.AUDIO_MUTED_BY_FOCUS,\n            (actor: string) => {\n                // TODO: Add a way to differentiate between commands which caused\n                // us to mute and those that did not change our state (i.e. we were\n                // already muted).\n                Statistics.sendAnalytics(createRemotelyMutedEvent(MediaType.AUDIO));\n\n                conference.mutedByFocusActor = actor;\n\n                // set isMutedByFocus when setAudioMute Promise ends\n                conference.rtc.setAudioMute().then(\n                    () => {\n                        conference.isMutedByFocus = true;\n                        conference.mutedByFocusActor = null;\n                    })\n                    .catch(\n                        (error: Error) => {\n                            conference.mutedByFocusActor = null;\n                            logger.warn(\n                                'Error while audio muting due to focus request', error);\n                        });\n            }\n        );\n\n        chatRoom.addListener(XMPPEvents.VIDEO_MUTED_BY_FOCUS,\n            (actor: string) => {\n                // TODO: Add a way to differentiate between commands which caused\n                // us to mute and those that did not change our state (i.e. we were\n                // already muted).\n                Statistics.sendAnalytics(createRemotelyMutedEvent(MediaType.VIDEO));\n\n                conference.mutedVideoByFocusActor = actor;\n\n                // set isVideoMutedByFocus when setVideoMute Promise ends\n                conference.rtc.setVideoMute().then(\n                    () => {\n                        conference.isVideoMutedByFocus = true;\n                        conference.mutedVideoByFocusActor = null;\n                    })\n                    .catch(\n                        (error: Error) => {\n                            conference.mutedVideoByFocusActor = null;\n                            logger.warn(\n                                'Error while video muting due to focus request', error);\n                        });\n            }\n        );\n\n        chatRoom.addListener(XMPPEvents.DESKTOP_MUTED_BY_FOCUS,\n            (actor: string) => {\n                // TODO: Add a way to differentiate between commands which caused\n                // us to mute and those that did not change our state (i.e. we were\n                // already muted).\n                Statistics.sendAnalytics(createRemotelyMutedEvent(MediaType.DESKTOP));\n\n                conference.mutedDesktopByFocusActor = actor;\n\n                // set isDesktopMutedByFocus when setDesktopMute Promise ends\n                conference.rtc.setDesktopMute().then(\n                    () => {\n                        conference.isDesktopMutedByFocus = true;\n                        conference.mutedDesktopByFocusActor = null;\n                    })\n                    .catch(\n                        (error: Error) => {\n                            conference.mutedDesktopByFocusActor = null;\n                            logger.warn(\n                                'Error while desktop video muting due to focus request', error);\n                        });\n            }\n        );\n\n        this.chatRoomForwarder.forward(XMPPEvents.SUBJECT_CHANGED,\n            JitsiConferenceEvents.SUBJECT_CHANGED);\n\n        this.chatRoomForwarder.forward(XMPPEvents.MUC_JOINED,\n            JitsiConferenceEvents.CONFERENCE_JOINED);\n\n        this.chatRoomForwarder.forward(XMPPEvents.MUC_JOIN_IN_PROGRESS,\n            JitsiConferenceEvents.CONFERENCE_JOIN_IN_PROGRESS);\n\n        this.chatRoomForwarder.forward(XMPPEvents.MEETING_ID_SET,\n            JitsiConferenceEvents.CONFERENCE_UNIQUE_ID_SET);\n\n        this.chatRoomForwarder.forward(XMPPEvents.CONFERENCE_TIMESTAMP_RECEIVED,\n            JitsiConferenceEvents.CONFERENCE_CREATED_TIMESTAMP);\n\n        // send some analytics events\n        chatRoom.addListener(XMPPEvents.MUC_JOINED,\n            () => {\n                this.conference._onMucJoined();\n\n                this.conference.isJvbConnectionInterrupted = false;\n\n                // TODO: Move all of the 'connectionTimes' logic to its own module.\n                Object.keys(chatRoom.connectionTimes).forEach(key => {\n                    const event\n                        = createConnectionStageReachedEvent(\n                            `conference_${key}`,\n                            { value: chatRoom.connectionTimes[key] });\n\n                    Statistics.sendAnalytics(event);\n                });\n\n                // TODO: Move all of the 'connectionTimes' logic to its own module.\n                Object.keys(chatRoom.xmpp.connectionTimes).forEach(key => {\n                    const event\n                        = createConnectionStageReachedEvent(\n                            `xmpp_${key}`,\n                            { value: chatRoom.xmpp.connectionTimes[key] });\n\n                    Statistics.sendAnalytics(event);\n                });\n            });\n\n        chatRoom.addListener(JitsiTrackEvents.TRACK_OWNER_SET, (track: JitsiRemoteTrack, owner: string, sourceName: string, videoType: VideoType) => {\n            if (track.getParticipantId() !== owner || track.getSourceName() !== sourceName) {\n                conference.eventEmitter.emit(JitsiConferenceEvents.TRACK_REMOVED, track);\n\n                // Update the owner and other properties on the track.\n                track.setOwner(owner);\n                track.setSourceName(sourceName);\n                track._setVideoType(videoType);\n                owner && conference.eventEmitter.emit(JitsiConferenceEvents.TRACK_ADDED, track);\n            }\n        });\n\n        this.chatRoomForwarder.forward(XMPPEvents.ROOM_JOIN_ERROR,\n            JitsiConferenceEvents.CONFERENCE_FAILED,\n            JitsiConferenceErrors.CONNECTION_ERROR);\n\n        this.chatRoomForwarder.forward(XMPPEvents.DISPLAY_NAME_REQUIRED,\n            JitsiConferenceEvents.CONFERENCE_FAILED,\n            JitsiConferenceErrors.DISPLAY_NAME_REQUIRED);\n\n        this.chatRoomForwarder.forward(XMPPEvents.ROOM_CONNECT_ERROR,\n            JitsiConferenceEvents.CONFERENCE_FAILED,\n            JitsiConferenceErrors.CONNECTION_ERROR);\n        this.chatRoomForwarder.forward(XMPPEvents.ROOM_CONNECT_NOT_ALLOWED_ERROR,\n            JitsiConferenceEvents.CONFERENCE_FAILED,\n            JitsiConferenceErrors.NOT_ALLOWED_ERROR);\n        this.chatRoomForwarder.forward(XMPPEvents.ROOM_CONNECT_MEMBERS_ONLY_ERROR,\n            JitsiConferenceEvents.CONFERENCE_FAILED,\n            JitsiConferenceErrors.MEMBERS_ONLY_ERROR);\n\n        this.chatRoomForwarder.forward(XMPPEvents.ROOM_MAX_USERS_ERROR,\n            JitsiConferenceEvents.CONFERENCE_FAILED,\n            JitsiConferenceErrors.CONFERENCE_MAX_USERS);\n\n        this.chatRoomForwarder.forward(XMPPEvents.PASSWORD_REQUIRED,\n            JitsiConferenceEvents.CONFERENCE_FAILED,\n            JitsiConferenceErrors.PASSWORD_REQUIRED);\n\n        this.chatRoomForwarder.forward(XMPPEvents.AUTHENTICATION_REQUIRED,\n            JitsiConferenceEvents.CONFERENCE_FAILED,\n            JitsiConferenceErrors.AUTHENTICATION_REQUIRED);\n\n        this.chatRoomForwarder.forward(XMPPEvents.BRIDGE_DOWN,\n            JitsiConferenceEvents.CONFERENCE_FAILED,\n            JitsiConferenceErrors.VIDEOBRIDGE_NOT_AVAILABLE);\n        chatRoom.addListener(\n            XMPPEvents.BRIDGE_DOWN,\n            () => Statistics.sendAnalytics(createBridgeDownEvent()));\n\n        this.chatRoomForwarder.forward(XMPPEvents.RESERVATION_ERROR,\n            JitsiConferenceEvents.CONFERENCE_FAILED,\n            JitsiConferenceErrors.RESERVATION_ERROR);\n\n        this.chatRoomForwarder.forward(XMPPEvents.GRACEFUL_SHUTDOWN,\n            JitsiConferenceEvents.CONFERENCE_FAILED,\n            JitsiConferenceErrors.GRACEFUL_SHUTDOWN);\n\n        this.chatRoomForwarder.forward(XMPPEvents.MUC_DESTROYED,\n            JitsiConferenceEvents.CONFERENCE_FAILED,\n            JitsiConferenceErrors.CONFERENCE_DESTROYED);\n\n        this.chatRoomForwarder.forward(XMPPEvents.CHAT_ERROR_RECEIVED,\n            JitsiConferenceEvents.CONFERENCE_ERROR,\n            JitsiConferenceErrors.CHAT_ERROR);\n\n        this.chatRoomForwarder.forward(XMPPEvents.SETTINGS_ERROR_RECEIVED,\n            JitsiConferenceEvents.CONFERENCE_ERROR,\n            JitsiConferenceErrors.SETTINGS_ERROR);\n\n        this.chatRoomForwarder.forward(XMPPEvents.FOCUS_DISCONNECTED,\n            JitsiConferenceEvents.CONFERENCE_FAILED,\n            JitsiConferenceErrors.FOCUS_DISCONNECTED);\n\n        chatRoom.addListener(XMPPEvents.FOCUS_LEFT,\n            () => {\n                Statistics.sendAnalytics(createFocusLeftEvent());\n                conference.eventEmitter.emit(\n                    JitsiConferenceEvents.CONFERENCE_FAILED,\n                    JitsiConferenceErrors.FOCUS_LEFT);\n            });\n\n        chatRoom.addListener(XMPPEvents.SESSION_ACCEPT_TIMEOUT,\n            (jingleSession: JingleSessionPC) => {\n                Statistics.sendAnalyticsAndLog(\n                    createJingleEvent(\n                        AnalyticsEvents.ACTION_JINGLE_SA_TIMEOUT,\n                        { p2p: jingleSession.isP2P }));\n            });\n\n        chatRoom.addListener(XMPPEvents.RECORDER_STATE_CHANGED,\n            (session: JibriSession, jid: string) => {\n\n                if (jid) {\n                    const resource = Strophe.getResourceFromJid(jid);\n                    const participant = conference.getParticipantById(resource) || resource;\n\n                    if (session.getStatus() === 'off') {\n                        session.setTerminator(participant);\n                    } else if (session.getStatus() === 'on') {\n                        session.setInitiator(participant);\n                    }\n                }\n\n                conference.eventEmitter.emit(\n                    JitsiConferenceEvents.RECORDER_STATE_CHANGED,\n                    session);\n            });\n\n        this.chatRoomForwarder.forward(XMPPEvents.TRANSCRIPTION_STATUS_CHANGED,\n            JitsiConferenceEvents.TRANSCRIPTION_STATUS_CHANGED);\n\n        this.chatRoomForwarder.forward(XMPPEvents.VIDEO_SIP_GW_AVAILABILITY_CHANGED,\n            JitsiConferenceEvents.VIDEO_SIP_GW_AVAILABILITY_CHANGED);\n\n        this.chatRoomForwarder.forward(\n            XMPPEvents.VIDEO_SIP_GW_SESSION_STATE_CHANGED,\n            JitsiConferenceEvents.VIDEO_SIP_GW_SESSION_STATE_CHANGED);\n\n        this.chatRoomForwarder.forward(XMPPEvents.PHONE_NUMBER_CHANGED,\n            JitsiConferenceEvents.PHONE_NUMBER_CHANGED);\n\n        chatRoom.setParticipantPropertyListener((id: string, prop: string, value: string) => {\n            const participant = conference.getParticipantById(id);\n\n            if (!participant) {\n                return;\n            }\n\n            participant.setProperty(prop, value);\n        });\n\n        chatRoom.addListener(XMPPEvents.KICKED,\n            conference.onMemberKicked.bind(conference));\n        chatRoom.addListener(XMPPEvents.SUSPEND_DETECTED,\n            conference.onSuspendDetected.bind(conference));\n\n        this.chatRoomForwarder.forward(XMPPEvents.MUC_LOCK_CHANGED,\n            JitsiConferenceEvents.LOCK_STATE_CHANGED);\n\n        this.chatRoomForwarder.forward(XMPPEvents.MUC_MEMBERS_ONLY_CHANGED,\n            JitsiConferenceEvents.MEMBERS_ONLY_CHANGED);\n        this.chatRoomForwarder.forward(XMPPEvents.MUC_VISITORS_SUPPORTED_CHANGED,\n            JitsiConferenceEvents.VISITORS_SUPPORTED_CHANGED);\n\n        chatRoom.addListener(XMPPEvents.MUC_MEMBER_JOINED,\n            conference.onMemberJoined.bind(conference));\n        this.chatRoomForwarder.forward(XMPPEvents.MUC_LOBBY_MEMBER_JOINED,\n            JitsiConferenceEvents.LOBBY_USER_JOINED);\n        this.chatRoomForwarder.forward(XMPPEvents.MUC_LOBBY_MEMBER_UPDATED,\n            JitsiConferenceEvents.LOBBY_USER_UPDATED);\n        this.chatRoomForwarder.forward(XMPPEvents.MUC_LOBBY_MEMBER_LEFT,\n            JitsiConferenceEvents.LOBBY_USER_LEFT);\n        chatRoom.addListener(XMPPEvents.MUC_MEMBER_BOT_TYPE_CHANGED,\n            conference._onMemberBotTypeChanged.bind(conference));\n        chatRoom.addListener(XMPPEvents.MUC_MEMBER_LEFT,\n            conference.onMemberLeft.bind(conference));\n        this.chatRoomForwarder.forward(XMPPEvents.MUC_LEFT,\n            JitsiConferenceEvents.CONFERENCE_LEFT);\n        this.chatRoomForwarder.forward(XMPPEvents.MUC_DENIED_ACCESS,\n            JitsiConferenceEvents.CONFERENCE_FAILED,\n            JitsiConferenceErrors.CONFERENCE_ACCESS_DENIED);\n\n        chatRoom.addListener(XMPPEvents.DISPLAY_NAME_CHANGED,\n            conference.onDisplayNameChanged.bind(conference));\n\n        chatRoom.addListener(XMPPEvents.SILENT_STATUS_CHANGED,\n            conference.onSilentStatusChanged.bind(conference));\n\n        chatRoom.addListener(XMPPEvents.LOCAL_ROLE_CHANGED, (role: string) => {\n            conference.onLocalRoleChanged(role);\n        });\n\n        chatRoom.addListener(XMPPEvents.MUC_ROLE_CHANGED,\n            conference.onUserRoleChanged.bind(conference));\n\n        chatRoom.addListener(AuthenticationEvents.IDENTITY_UPDATED,\n            (authEnabled: boolean, authIdentity: any) => {\n                conference.authEnabled = authEnabled;\n                conference.authIdentity = authIdentity;\n                conference.eventEmitter.emit(\n                    JitsiConferenceEvents.AUTH_STATUS_CHANGED, authEnabled,\n                    authIdentity);\n            });\n\n        chatRoom.addListener(\n            XMPPEvents.MESSAGE_RECEIVED,\n\n            // eslint-disable-next-line max-params\n            (jid: string, txt: string, myJid: string, ts: number,\n                    displayName: string, isVisitor: boolean, messageId: string, source: string, replyToId?: string) => {\n                const participantId = Strophe.getResourceFromJid(jid);\n\n                conference.eventEmitter.emit(\n                    JitsiConferenceEvents.MESSAGE_RECEIVED,\n                    participantId, txt, ts, displayName, isVisitor, messageId, source, replyToId);\n            });\n\n        this.chatRoomForwarder.forward(XMPPEvents.POLLS_RECEIVE_EVENT,\n            JitsiConferenceEvents.POLL_RECEIVED);\n        this.chatRoomForwarder.forward(XMPPEvents.POLLS_ANSWER_EVENT,\n            JitsiConferenceEvents.POLL_ANSWER_RECEIVED);\n\n        chatRoom.addListener(\n            XMPPEvents.REACTION_RECEIVED,\n\n            (jid: string, reactionList: string[], messageId: string) => {\n                const participantId = Strophe.getResourceFromJid(jid);\n\n                conference.eventEmitter.emit(\n                    JitsiConferenceEvents.REACTION_RECEIVED,\n                    participantId, reactionList, messageId);\n            });\n\n        chatRoom.addListener(\n            XMPPEvents.PRIVATE_MESSAGE_RECEIVED,\n\n            // eslint-disable-next-line max-params\n            (jid: string, txt: string, myJid: string, ts: number, messageId: string,\n                    displayName: string, isVisitor: boolean, ofrom: string, replyToId?: string) => {\n                const participantId = isVisitor ? ofrom : Strophe.getResourceFromJid(jid);\n\n                conference.eventEmitter.emit(\n                    JitsiConferenceEvents.PRIVATE_MESSAGE_RECEIVED,\n                    participantId, txt, ts, messageId, displayName, isVisitor, replyToId);\n            });\n\n        chatRoom.addListener(XMPPEvents.PRESENCE_STATUS,\n            (jid: string, status: string) => {\n                const id = Strophe.getResourceFromJid(jid);\n                const participant = conference.getParticipantById(id);\n\n                if (!participant || participant._status === status) {\n                    return;\n                }\n                participant._status = status;\n                conference.eventEmitter.emit(\n                    JitsiConferenceEvents.USER_STATUS_CHANGED, id, status);\n            });\n\n        chatRoom.addListener(XMPPEvents.JSON_MESSAGE_RECEIVED,\n            (from: string, payload: any) => {\n                const id = Strophe.getResourceFromJid(from);\n                const participant = conference.getParticipantById(id);\n\n                if (participant) {\n                    conference.eventEmitter.emit(\n                        JitsiConferenceEvents.ENDPOINT_MESSAGE_RECEIVED,\n                        participant, payload);\n                } else {\n                    conference.eventEmitter.emit(\n                        JitsiConferenceEvents.NON_PARTICIPANT_MESSAGE_RECEIVED,\n                        id, payload);\n                }\n            });\n\n        // Breakout rooms.\n        this.chatRoomForwarder.forward(XMPPEvents.BREAKOUT_ROOMS_MOVE_TO_ROOM,\n            JitsiConferenceEvents.BREAKOUT_ROOMS_MOVE_TO_ROOM);\n        this.chatRoomForwarder.forward(XMPPEvents.BREAKOUT_ROOMS_UPDATED,\n            JitsiConferenceEvents.BREAKOUT_ROOMS_UPDATED);\n\n        // File sharing\n        this.chatRoomForwarder.forward(XMPPEvents.FILE_SHARING_FILES_RECEIVED,\n            JitsiConferenceEvents.FILE_SHARING_FILES_RECEIVED);\n        this.chatRoomForwarder.forward(XMPPEvents.FILE_SHARING_FILE_ADDED,\n            JitsiConferenceEvents.FILE_SHARING_FILE_ADDED);\n        this.chatRoomForwarder.forward(XMPPEvents.FILE_SHARING_FILE_REMOVED,\n            JitsiConferenceEvents.FILE_SHARING_FILE_REMOVED);\n\n        // Room metadata.\n        chatRoom.addListener(XMPPEvents.ROOM_METADATA_UPDATED, (metadata: any) => {\n            if (metadata.startMuted) {\n                const audio = metadata.startMuted.audio || false;\n                const video = metadata.startMuted.video || false;\n\n                audio && (conference.isMutedByFocus = true);\n                video && (conference.isVideoMutedByFocus = true);\n                conference._updateStartMutedPolicy(audio, video);\n            }\n            if (metadata.recording && typeof metadata.recording.isTranscribingEnabled !== 'undefined') {\n                conference._setTranscribingEnabled(Boolean(metadata.recording.isTranscribingEnabled));\n            }\n            conference.eventEmitter.emit(JitsiConferenceEvents.METADATA_UPDATED, metadata);\n        });\n    }\n\n    /**\n     * Setups event listeners related to conference.rtc\n     */\n    setupRTCListeners(): void {\n        const conference = this.conference;\n        const rtc = conference.rtc;\n\n        rtc.addListener(\n            RTCEvents.REMOTE_TRACK_ADDED,\n            conference.onRemoteTrackAdded.bind(conference));\n\n        rtc.addListener(\n            RTCEvents.REMOTE_TRACK_REMOVED,\n            conference.onRemoteTrackRemoved.bind(conference));\n\n        rtc.addListener(RTCEvents.DOMINANT_SPEAKER_CHANGED,\n            (dominant: string, previous: string[], silence: boolean) => {\n                if ((conference.lastDominantSpeaker !== dominant || conference.dominantSpeakerIsSilent !== silence)\n                        && conference.room) {\n                    conference.dominantSpeakerIsSilent = silence;\n                    conference.eventEmitter.emit(\n                        JitsiConferenceEvents.DOMINANT_SPEAKER_CHANGED, dominant, previous, silence);\n                    if (conference.statistics && conference.myUserId() === dominant) {\n                        // We are the new dominant speaker.\n                        conference.xmpp.sendDominantSpeakerEvent(conference.room.roomjid, silence);\n                        RTCStats.sendStatsEntry(RTCStatsEvents.DOMINANT_SPEAKER_CHANGED_EVENT);\n                    }\n                    if (conference.lastDominantSpeaker !== dominant) {\n                        conference.lastDominantSpeaker = dominant;\n\n                        if (previous?.length) {\n                            const speakerList = previous.slice(0);\n\n                            // Add the dominant speaker to the top of the list (exclude self).\n                            if (conference.myUserId() !== dominant) {\n                                speakerList.splice(0, 0, dominant);\n                            }\n\n                            // Trim the list to the top 5 speakers only.\n                            if (speakerList.length > SPEAKERS_AUDIO_LEVELS) {\n                                speakerList.splice(SPEAKERS_AUDIO_LEVELS, speakerList.length - SPEAKERS_AUDIO_LEVELS);\n                            }\n                            conference.statistics && conference.statistics.setSpeakerList(speakerList);\n                        }\n                    }\n                }\n            });\n\n        rtc.addListener(RTCEvents.DATA_CHANNEL_OPEN, () => {\n            const now = window.performance.now();\n            const key = 'data.channel.opened';\n\n            // TODO: Move all of the 'connectionTimes' logic to its own module.\n            logger.info(`(TIME) ${key}:\\t`, now);\n            conference.room.connectionTimes[key] = now;\n            Statistics.sendAnalytics(\n                createConnectionStageReachedEvent(key, { value: now }));\n\n            conference.eventEmitter.emit(JitsiConferenceEvents.DATA_CHANNEL_OPENED);\n        });\n\n        rtc.addListener(RTCEvents.DATA_CHANNEL_CLOSED, (ev: RTCDataChannelEvent) => {\n            conference.eventEmitter.emit(JitsiConferenceEvents.DATA_CHANNEL_CLOSED, ev);\n        });\n\n        rtc.addListener(RTCEvents.VIDEO_SSRCS_REMAPPED, (msg: any) => {\n            this.conference.jvbJingleSession.processSourceMap(msg, MediaType.VIDEO);\n        });\n\n        rtc.addListener(RTCEvents.AUDIO_SSRCS_REMAPPED, (msg: any) => {\n            this.conference.jvbJingleSession.processSourceMap(msg, MediaType.AUDIO);\n        });\n\n        rtc.addListener(RTCEvents.BRIDGE_BWE_STATS_RECEIVED, (bwe: any) => {\n            conference.eventEmitter.emit(JitsiConferenceEvents.BRIDGE_BWE_STATS_RECEIVED, bwe);\n        });\n\n        rtc.addListener(RTCEvents.ENDPOINT_MESSAGE_RECEIVED,\n            (from: string, payload: any) => {\n                if (from === 'transcriber') {\n                    conference.eventEmitter.emit(\n                        JitsiConferenceEvents.NON_PARTICIPANT_MESSAGE_RECEIVED,\n                        from, payload);\n\n                    return;\n                }\n\n                const participant = conference.getParticipantById(from);\n\n                if (participant) {\n                    conference.eventEmitter.emit(\n                        JitsiConferenceEvents.ENDPOINT_MESSAGE_RECEIVED,\n                        participant, payload);\n                } else {\n                    logger.warn(\n                        'Ignored ENDPOINT_MESSAGE_RECEIVED for not existing '\n                            + `participant: ${from}`,\n                        payload);\n                }\n            });\n\n        rtc.addListener(RTCEvents.ENDPOINT_STATS_RECEIVED,\n            (from: string, payload: any) => {\n                const participant = conference.getParticipantById(from);\n\n                if (participant) {\n                    conference.eventEmitter.emit(JitsiConferenceEvents.ENDPOINT_STATS_RECEIVED, participant, payload);\n                } else {\n                    logger.warn(`Ignoring ENDPOINT_STATS_RECEIVED for a non-existant participant: ${from}`);\n                }\n            });\n    }\n\n    /**\n     * Setups event listeners related to conference.statistics\n     */\n    setupStatisticsListeners(): void {\n        const conference = this.conference;\n\n        if (!conference.statistics) {\n            return;\n        }\n\n        /* eslint-disable max-params */\n        conference.statistics.addAudioLevelListener((tpc: TraceablePeerConnection, ssrc: number, level: number, isLocal: boolean) => {\n            conference.rtc.setAudioLevel(tpc, ssrc, level, isLocal);\n        });\n\n        /* eslint-enable max-params */\n\n        // Forward the \"before stats disposed\" event\n        conference.statistics.addBeforeDisposedListener(() => {\n            conference.eventEmitter.emit(\n                JitsiConferenceEvents.BEFORE_STATISTICS_DISPOSED);\n        });\n\n        conference.statistics.addEncodeTimeStatsListener((tpc: TraceablePeerConnection, stats: RTCEncodedAudioFrameMetadata) => {\n            conference.eventEmitter.emit(\n                JitsiConferenceEvents.ENCODE_TIME_STATS_RECEIVED, tpc, stats);\n        });\n\n        // if we are in startSilent mode we will not be sending/receiving so nothing to detect\n        if (!conference.options.config.startSilent) {\n            conference.statistics.addByteSentStatsListener((tpc: TraceablePeerConnection, stats: RTCEncodedAudioFrameMetadata) => {\n                conference.getLocalTracks(MediaType.AUDIO).forEach(track => {\n                    const ssrc = tpc.getLocalSSRC(track);\n\n                    if (!ssrc || !stats.hasOwnProperty(ssrc)) {\n                        return;\n                    }\n\n                    track.onByteSentStatsReceived(tpc, stats[ssrc]);\n                });\n            });\n        }\n    }\n\n    /**\n     * Setups event listeners related to conference.xmpp\n     */\n    setupXMPPListeners(): void {\n        const conference = this.conference;\n\n        this._addConferenceXMPPListener(\n            XMPPEvents.CALL_INCOMING,\n            conference.onIncomingCall.bind(conference));\n        this._addConferenceXMPPListener(\n            XMPPEvents.CALL_ACCEPTED,\n            conference.onCallAccepted.bind(conference));\n        this._addConferenceXMPPListener(\n            XMPPEvents.TRANSPORT_INFO,\n            conference.onTransportInfo.bind(conference));\n        this._addConferenceXMPPListener(\n            XMPPEvents.CALL_ENDED,\n            conference.onCallEnded.bind(conference));\n\n        this._addConferenceXMPPListener(XMPPEvents.AV_MODERATION_CHANGED,\n            (value: boolean, mediaType: MediaType, actorJid: string) => {\n                const actorParticipant = conference.getParticipants().find(p => p.getJid() === actorJid);\n\n                conference.eventEmitter.emit(JitsiConferenceEvents.AV_MODERATION_CHANGED, {\n                    actor: actorParticipant,\n                    enabled: value,\n                    mediaType\n                });\n            });\n        this._addConferenceXMPPListener(XMPPEvents.AV_MODERATION_PARTICIPANT_APPROVED,\n            (mediaType: MediaType, jid: string) => {\n                const participant = conference.getParticipantById(Strophe.getResourceFromJid(jid));\n\n                if (participant) {\n                    conference.eventEmitter.emit(JitsiConferenceEvents.AV_MODERATION_PARTICIPANT_APPROVED, {\n                        mediaType,\n                        participant\n                    });\n                }\n            });\n        this._addConferenceXMPPListener(XMPPEvents.AV_MODERATION_PARTICIPANT_REJECTED,\n            (mediaType: MediaType, jid: string) => {\n                const participant = conference.getParticipantById(Strophe.getResourceFromJid(jid));\n\n                if (participant) {\n                    conference.eventEmitter.emit(JitsiConferenceEvents.AV_MODERATION_PARTICIPANT_REJECTED, {\n                        mediaType,\n                        participant\n                    });\n                }\n            });\n        this._addConferenceXMPPListener(XMPPEvents.AV_MODERATION_APPROVED,\n            (value: MediaType) => conference.eventEmitter.emit(JitsiConferenceEvents.AV_MODERATION_APPROVED, { mediaType: value }));\n        this._addConferenceXMPPListener(XMPPEvents.AV_MODERATION_REJECTED,\n            (value: MediaType) => {\n                conference.eventEmitter.emit(JitsiConferenceEvents.AV_MODERATION_REJECTED, { mediaType: value });\n            });\n\n        this._addConferenceXMPPListener(XMPPEvents.VISITORS_MESSAGE,\n            (value: string) => conference.eventEmitter.emit(JitsiConferenceEvents.VISITORS_MESSAGE, value));\n        this._addConferenceXMPPListener(XMPPEvents.VISITORS_REJECTION,\n            () => conference.eventEmitter.emit(JitsiConferenceEvents.VISITORS_REJECTION));\n    }\n\n\n    /**\n     * Removes event listeners related to conference.xmpp\n     */\n    removeXMPPListeners(): void {\n        const conference = this.conference;\n\n        Object.keys(this.xmppListeners).forEach(eventName => {\n            conference.xmpp.removeListener(\n                eventName,\n                this.xmppListeners[eventName]);\n        });\n        this.xmppListeners = {};\n    }\n}\n","/**\n * The number of remote speakers for which the audio levels will be calculated using\n * RTCRtpReceiver#getSynchronizationSources. Limit the number of endpoints to save cpu on the client as this API call\n * is known to take longer to execute when there are many audio receivers.\n */\nexport const SPEAKERS_AUDIO_LEVELS: number = 5;\n","/**\n * The events for the connection.\n */\n\nexport enum JitsiConnectionEvents {\n\n    /**\n     * Indicates that the connection has been disconnected. The event provides\n     * the following parameters to its listeners:\n     *\n     * @param msg {string} a message associated with the disconnect such as the\n     * last (known) error message\n     */\n    CONNECTION_DISCONNECTED = 'connection.connectionDisconnected',\n\n    /**\n     * Indicates that the connection has been established. The event provides\n     * the following parameters to its listeners:\n     *\n     * @param id {string} the ID of the local endpoint/participant/peer (within\n     * the context of the established connection)\n     */\n    CONNECTION_ESTABLISHED = 'connection.connectionEstablished',\n\n    /**\n     * Indicates that the connection has been failed for some reason. The event\n     * provides the following parameters to its listeners:\n     *\n     * @param errType {JitsiConnectionErrors} the type of error associated with\n     * the failure\n     * @param errReason {string} the error (message) associated with the failure\n     * @param credentials {object} the credentials used to connect (if any)\n     * @param errReasonDetails {object} an optional object with details about\n     * the error, like shard moving, suspending. Used for analytics purposes.\n     */\n    CONNECTION_FAILED = 'connection.connectionFailed',\n\n    /**\n     * The connection is redirected to a visitor node.\n     */\n    CONNECTION_REDIRECTED = 'connection.redirected',\n\n    /**\n     * Indicates that the display name is required over this connection and need to be supplied when\n     * joining the room.\n     * There are cases like lobby room where display name is required.\n     */\n    DISPLAY_NAME_REQUIRED = 'connection.display_name_required',\n\n    /**\n     * Indicates that the connection properties have been updated.\n     * @param properties {object} - All available connection properties (e.g. shard, region).\n     */\n    PROPERTIES_UPDATED = 'connection.propertiesUpdated',\n}\n\n// exported for backward compatibility\nexport const CONNECTION_DISCONNECTED = JitsiConnectionEvents.CONNECTION_DISCONNECTED;\nexport const CONNECTION_ESTABLISHED = JitsiConnectionEvents.CONNECTION_ESTABLISHED;\nexport const CONNECTION_FAILED = JitsiConnectionEvents.CONNECTION_FAILED;\nexport const CONNECTION_REDIRECTED = JitsiConnectionEvents.CONNECTION_REDIRECTED;\nexport const DISPLAY_NAME_REQUIRED = JitsiConnectionEvents.DISPLAY_NAME_REQUIRED;\nexport const PROPERTIES_UPDATED = JitsiConnectionEvents.PROPERTIES_UPDATED;\n","import { Strophe } from 'strophe.js';\n\nimport JitsiConference from './JitsiConference';\nimport { JitsiConferenceEvents } from './JitsiConferenceEvents';\nimport JitsiRemoteTrack from './modules/RTC/JitsiRemoteTrack';\nimport { MediaType } from './service/RTC/MediaType';\nimport { SourceName } from './service/RTC/SignalingLayer';\nimport { VideoType } from './service/RTC/VideoType';\n\nexport interface ISourceInfo {\n    muted: boolean;\n    videoType: string;\n}\n\n/**\n * Represents a participant in (i.e. a member of) a conference.\n */\nexport default class JitsiParticipant {\n\n    private _jid: string;\n    private _id: string;\n    private _conference: JitsiConference;\n    private _role: string;\n    private _hidden: boolean;\n    private _statsID?: string;\n    private _properties: Map<string, any>;\n    private _identity?: object;\n    private _isReplacing?: boolean;\n    private _isReplaced?: boolean;\n    private _isSilent?: boolean;\n    private _features: Set<string>;\n    private _sources: Map<MediaType, Map<string, ISourceInfo>>;\n    private _botType?: string;\n    private _connectionJid?: string;\n    /**\n     * @internal\n     */\n    _status?: string;\n    /**\n     * @internal\n     */\n    _displayName: string;\n    /**\n     * @internal\n     */\n    _supportsDTMF: boolean;\n    /**\n     * @internal\n     */\n    _tracks: JitsiRemoteTrack[];\n\n    /* eslint-disable max-params */\n\n    /**\n     * Initializes a new JitsiParticipant instance.\n     *\n     * @param jid the conference XMPP jid\n     * @param conference\n     * @param displayName\n     * @param {Boolean} hidden - True if the new JitsiParticipant instance is to\n     * represent a hidden participant; otherwise, false.\n     * @param {string} statsID - optional participant statsID\n     * @param {string} status - the initial status if any.\n     * @param {object} identity - the xmpp identity\n     * @param {boolean?} isReplacing - whether this is a participant replacing another into the meeting.\n     * @param {boolean?} isReplaced - whether this is a participant to be kicked and replaced into the meeting.\n     * @param {boolean?} isSilent - whether participant has joined without audio\n     */\n    constructor(\n            jid: string,\n            conference: JitsiConference,\n            displayName: string,\n            hidden: boolean,\n            statsID?: string,\n            status?: string,\n            identity?: object,\n            isReplacing?: boolean,\n            isReplaced?: boolean,\n            isSilent?: boolean\n    ) {\n        this._jid = jid;\n        this._id = Strophe.getResourceFromJid(jid);\n        this._conference = conference;\n        this._displayName = displayName;\n        this._supportsDTMF = false;\n        this._tracks = [];\n        this._role = 'none';\n        this._status = status;\n        this._hidden = hidden;\n        this._statsID = statsID;\n        this._properties = new Map();\n        this._identity = identity;\n        this._isReplacing = isReplacing;\n        this._isReplaced = isReplaced;\n        this._isSilent = isSilent;\n        this._features = new Set();\n\n        /**\n         * Remote sources associated with the participant in the following format.\n         * Map<mediaType, Map<sourceName, ISourceInfo>>\n         *\n         * mediaType - 'audio' or 'video'.\n         * sourceName - name of the remote source.\n         * ISourceInfo: {\n         *   muted: boolean;\n         *   videoType: string;\n         * }\n         */\n        this._sources = new Map();\n    }\n\n    /**\n     * Determines whether all JitsiTracks which are of a specific MediaType and which belong to this\n     * JitsiParticipant are muted.\n     *\n     * @param {MediaType} mediaType - The MediaType of the JitsiTracks to be checked.\n     * @private\n     * @returns {Boolean} True if all JitsiTracks which are of the specified mediaType and which belong to this\n     * JitsiParticipant are muted; otherwise, false.\n     */\n    _isMediaTypeMuted(mediaType: MediaType): boolean {\n        return this.getTracks().reduce(\n            (muted, track) =>\n                muted && (track.getType() !== mediaType || (track as any).isMuted()),\n            true);\n    }\n\n    /**\n     * Sets source info.\n     * @param {MediaType} mediaType The media type, 'audio' or 'video'.\n     * @param {boolean} muted The new muted state.\n     * @param {SourceName} sourceName The name of the source.\n     * @param {string} videoType The video type of the source.\n     * @returns {void}\n     */\n    _setSources(mediaType: MediaType, muted: boolean, sourceName: SourceName, videoType: VideoType): void {\n        let sourceByMediaType = this._sources.get(mediaType);\n        const sourceInfo: ISourceInfo = {\n            muted,\n            videoType\n        };\n\n        if (sourceByMediaType?.size) {\n            sourceByMediaType.set(sourceName, sourceInfo);\n\n            return;\n        }\n\n        sourceByMediaType = new Map();\n        sourceByMediaType.set(sourceName, sourceInfo);\n        this._sources.set(mediaType, sourceByMediaType);\n    }\n\n    /**\n     * Returns the bot type for the participant.\n     *\n     * @returns {Optional<string>} - The bot type of the participant.\n     */\n    getBotType(): Optional<string> {\n        return this._botType;\n    }\n\n    /**\n     * @returns {JitsiConference} The conference that this participant belongs\n     * to.\n     */\n    getConference(): JitsiConference {\n        return this._conference;\n    }\n\n    /**\n     * Returns the connection jid for the participant.\n     *\n     * @returns {Optional<string>} - The connection jid of the participant.\n     */\n    getConnectionJid(): Optional<string> {\n        return this._connectionJid;\n    }\n\n    /**\n     * @returns {String} The human-readable display name of this participant.\n     */\n    getDisplayName(): string {\n        return this._displayName;\n    }\n\n    /**\n     * Returns a set with the features for the participant.\n     * @returns {Promise<Set<String>>}\n     */\n    getFeatures(): Promise<Set<string>> {\n        return Promise.resolve(this._features);\n    }\n\n    /**\n     * @returns {String} The ID of this participant.\n     */\n    getId(): string {\n        return this._id;\n    }\n\n    /**\n     * Returns the XMPP identity. This is defined by your application in the\n     * JWT `context` claims section.\n     *\n     * @returns {Optional<object>} - XMPP user identity.\n     */\n    getIdentity(): Optional<object> {\n        return this._identity;\n    }\n\n    /**\n     * @returns {String} The JID of this participant.\n     */\n    getJid(): string {\n        return this._jid;\n    }\n\n    /**\n     * Gets the value of a property of this participant.\n     */\n    getProperty(name: string): any {\n        return this._properties.get(name);\n    }\n\n    /**\n     * @returns {String} The role of this participant.\n     */\n    getRole(): string {\n        return this._role;\n    }\n\n    /**\n     * Returns the sources associated with this participant.\n     * @returns Map<string, Map<string, Object>>\n     */\n    getSources(): Map<MediaType, Map<string, ISourceInfo>> {\n        return this._sources;\n    }\n\n    /**\n     * @returns {String} The stats ID of this participant.\n     */\n    getStatsID(): string {\n        return this._statsID;\n    }\n\n    /**\n     * @returns {String} The status of the participant.\n     */\n    getStatus(): string {\n        return this._status;\n    }\n\n    /**\n     * @returns {Array.<JitsiRemoteTrack>} The list of media tracks for this\n     * participant.\n     */\n    getTracks(): (JitsiRemoteTrack)[] {\n        return this._tracks.slice();\n    }\n\n    /**\n     * @param {MediaType} mediaType\n     * @returns {Array.<JitsiRemoteTrack>} an array of media tracks for this\n     * participant, for given media type.\n     */\n    getTracksByMediaType(mediaType: MediaType): (JitsiRemoteTrack)[] {\n        return this.getTracks().filter(track => track.getType() === mediaType);\n    }\n\n    /**\n     * Checks current set features.\n     * @param {String} feature - the feature to check.\n     * @return {boolean} <tt>true</tt> if this <tt>participant</tt> contains the\n     * <tt>feature</tt>.\n     */\n    hasFeature(feature: string): boolean {\n        return this._features.has(feature);\n    }\n\n    /**\n     * @returns {Boolean} Whether this participant has muted their audio.\n     */\n    isAudioMuted(): boolean {\n        return this._isMediaTypeMuted(MediaType.AUDIO);\n    }\n\n    /**\n     * @returns {Boolean} Whether this participant is a hidden participant. Some\n     * special system participants may want to join hidden (like for example the\n     * recorder).\n     */\n    isHidden(): boolean {\n        return this._hidden;\n    }\n\n    /**\n     * @returns {Boolean} Whether this participant is a hidden participant. Some\n     * special system participants may want to join hidden (like for example the\n     * recorder).\n     */\n    isHiddenFromRecorder(): boolean {\n        return (this._identity as any)?.user?.['hidden-from-recorder'] === 'true';\n    }\n\n    /**\n     * @returns {Boolean} Whether this participant is a moderator or not.\n     */\n    isModerator(): boolean {\n        return this._role === 'moderator';\n    }\n\n    /**\n     * @returns {Boolean} Wheter this participants will be replaced by another\n     * participant in the meeting.\n     */\n    isReplaced(): boolean {\n        return this._isReplaced;\n    }\n\n    /**\n     * @returns {Boolean} Whether this participant replaces another participant\n     * from the meeting.\n     */\n    isReplacing(): boolean {\n        return this._isReplacing;\n    }\n\n    /**\n     * @returns {Boolean} Whether this participant has joined without audio.\n     */\n    isSilent(): boolean {\n        return this._isSilent;\n    }\n\n    /**\n     * @returns {Boolean} Whether this participant has muted their video.\n     */\n    isVideoMuted(): boolean {\n        return this._isMediaTypeMuted(MediaType.VIDEO);\n    }\n\n    /**\n     * Sets the bot type for the participant.\n     * @param {String} newBotType - The new bot type to set.\n     */\n    setBotType(newBotType: string): void {\n        this._botType = newBotType;\n    }\n\n    /**\n     * Sets the connection jid for the participant.\n     * @param {String} newJid - The connection jid to set.\n     */\n    setConnectionJid(newJid: string): void {\n        this._connectionJid = newJid;\n    }\n\n    /**\n     * Set new features.\n     * @param {Set<String>|undefined} newFeatures - Sets new features.\n     */\n    setFeatures(newFeatures?: Set<string>): void {\n        this._features = newFeatures || new Set();\n    }\n\n    /**\n     * Sets whether participant is being replaced by another based on jwt.\n     * @param {boolean} newIsReplaced - whether is being replaced.\n     */\n    setIsReplaced(newIsReplaced: boolean): void {\n        this._isReplaced = newIsReplaced;\n    }\n\n    /**\n     * Sets whether participant is replacing another based on jwt.\n     * @param {boolean} newIsReplacing - whether is replacing.\n     */\n    setIsReplacing(newIsReplacing: boolean): void {\n        this._isReplacing = newIsReplacing;\n    }\n\n    /**\n     * Sets whether participant has joined without audio.\n     * @param {boolean} newIsSilent - whether is silent.\n     */\n    setIsSilent(newIsSilent: boolean): void {\n        this._isSilent = newIsSilent;\n    }\n\n    /**\n     * Sets the value of a property of this participant, and fires an event if\n     * the value has changed.\n     * @param {string} name the name of the property.\n     * @param {any} value the value to set.\n     */\n    setProperty(name: string, value: any): void {\n        const oldValue = this._properties.get(name);\n\n        if (value !== oldValue) {\n            this._properties.set(name, value);\n            this._conference.eventEmitter.emit(\n                JitsiConferenceEvents.PARTICIPANT_PROPERTY_CHANGED,\n                this,\n                name,\n                oldValue,\n                value);\n        }\n    }\n\n    /**\n     * Sets a new participant role.\n     * @param {String} newRole - the new role.\n     */\n    setRole(newRole: string): void {\n        this._role = newRole;\n    }\n\n    /**\n     *\n     */\n    supportsDTMF(): boolean {\n        return this._supportsDTMF;\n    }\n}\n","/**\n * The errors for the JitsiTrack objects.\n */\n\nexport enum JitsiTrackErrors {\n\n    /**\n     * An error which indicates that some of requested constraints in\n     * getUserMedia call were not satisfied.\n     */\n    CONSTRAINT_FAILED = 'gum.constraint_failed',\n\n    /**\n     * A generic error which indicates an error occurred while selecting\n     * a DesktopCapturerSource from the electron app.\n     */\n    ELECTRON_DESKTOP_PICKER_ERROR = 'gum.electron_desktop_picker_error',\n\n    /**\n     * An error which indicates a custom desktop picker could not be detected\n     * for the electron app.\n     */\n    ELECTRON_DESKTOP_PICKER_NOT_FOUND = 'gum.electron_desktop_picker_not_found',\n\n    /**\n     * Generic getUserMedia error.\n     */\n    GENERAL = 'gum.general',\n\n    /**\n     * An error which indicates that requested device was not found.\n     */\n    NOT_FOUND = 'gum.not_found',\n\n    /**\n     * An error which indicates that user denied permission to share requested\n     * device.\n     */\n    PERMISSION_DENIED = 'gum.permission_denied',\n\n    /**\n     * Generic error for screensharing failure.\n     */\n    SCREENSHARING_GENERIC_ERROR = 'gum.screensharing_generic_error',\n\n    /**\n     * Error in getDisplayMedia when not supported. Can happen in Electron if no\n     * permission handler was set.\n     */\n    SCREENSHARING_NOT_SUPPORTED_ERROR = 'gdm.screen_sharing_not_supported',\n\n    /**\n     * An error which indicates that user canceled screen sharing window\n     * selection dialog.\n     */\n    SCREENSHARING_USER_CANCELED = 'gum.screensharing_user_canceled',\n\n    /**\n     * Indicates that the timeout passed to the obtainAudioAndVideoPermissions has expired without GUM resolving.\n     */\n    TIMEOUT = 'gum.timeout',\n\n    /**\n     * An error which indicates that track has been already disposed and cannot\n     * be longer used.\n     */\n    TRACK_IS_DISPOSED = 'track.track_is_disposed',\n\n    /**\n     * An error which indicates that track has no MediaStream associated.\n     */\n    TRACK_NO_STREAM_FOUND = 'track.no_stream_found',\n\n    /**\n     * An error which indicates that no tracks were found in the media stream\n     */\n    TRACK_NO_STREAM_TRACKS_FOUND = 'track.no_stream_tracks_found',\n\n    /**\n     * An error which indicates that there are too many tracks in the provided media stream\n     */\n    TRACK_TOO_MANY_TRACKS_IN_STREAM = 'track.too_many_tracks_in_stream',\n\n    /**\n     * An error which indicates that requested video resolution is not supported\n     * by a webcam.\n     */\n    UNSUPPORTED_RESOLUTION = 'gum.unsupported_resolution'\n}\n\n// exported for backward compatibility\nexport const CONSTRAINT_FAILED = JitsiTrackErrors.CONSTRAINT_FAILED;\nexport const ELECTRON_DESKTOP_PICKER_ERROR = JitsiTrackErrors.ELECTRON_DESKTOP_PICKER_ERROR;\nexport const ELECTRON_DESKTOP_PICKER_NOT_FOUND = JitsiTrackErrors.ELECTRON_DESKTOP_PICKER_NOT_FOUND;\nexport const GENERAL = JitsiTrackErrors.GENERAL;\nexport const NOT_FOUND = JitsiTrackErrors.NOT_FOUND;\nexport const PERMISSION_DENIED = JitsiTrackErrors.PERMISSION_DENIED;\nexport const SCREENSHARING_GENERIC_ERROR = JitsiTrackErrors.SCREENSHARING_GENERIC_ERROR;\nexport const SCREENSHARING_NOT_SUPPORTED_ERROR = JitsiTrackErrors.SCREENSHARING_NOT_SUPPORTED_ERROR;\nexport const SCREENSHARING_USER_CANCELED = JitsiTrackErrors.SCREENSHARING_USER_CANCELED;\nexport const TIMEOUT = JitsiTrackErrors.TIMEOUT;\nexport const TRACK_IS_DISPOSED = JitsiTrackErrors.TRACK_IS_DISPOSED;\nexport const TRACK_NO_STREAM_FOUND = JitsiTrackErrors.TRACK_NO_STREAM_FOUND;\nexport const UNSUPPORTED_RESOLUTION = JitsiTrackErrors.UNSUPPORTED_RESOLUTION;\nexport const TRACK_TOO_MANY_TRACKS_IN_STREAM = JitsiTrackErrors.TRACK_TOO_MANY_TRACKS_IN_STREAM;\nexport const TRACK_NO_STREAM_TRACKS_FOUND = JitsiTrackErrors.TRACK_NO_STREAM_TRACKS_FOUND;\n","import * as JitsiTrackErrors from './JitsiTrackErrors';\n\nexport interface IGumError {\n    constraint?: string;\n    constraintName?: string;\n    message?: string;\n    name?: string;\n    stack?: string;\n}\n\nexport interface IVideoConstraints {\n    mandatory?: { [key: string]: string | number; };\n}\n\nexport interface IGumOptions {\n    video?: IVideoConstraints;\n}\n\nexport interface IGum {\n    constraints?: IGumOptions | string;\n    devices?: ('audio' | 'video' | 'desktop' | 'screen' | 'audiooutput')[];\n    error: IGumError;\n}\n\nexport type DeviceType = 'audio' | 'video' | 'desktop' | 'screen' | 'audiooutput';\n\nconst TRACK_ERROR_TO_MESSAGE_MAP: { [key: string]: string; } = {\n    [JitsiTrackErrors.UNSUPPORTED_RESOLUTION]: 'Video resolution is not supported: ',\n    [JitsiTrackErrors.SCREENSHARING_USER_CANCELED]: 'User canceled screen sharing prompt',\n    [JitsiTrackErrors.SCREENSHARING_GENERIC_ERROR]: 'Unknown error from screensharing',\n    [JitsiTrackErrors.SCREENSHARING_NOT_SUPPORTED_ERROR]: 'Not supported',\n    [JitsiTrackErrors.ELECTRON_DESKTOP_PICKER_ERROR]: 'Unkown error from desktop picker',\n    [JitsiTrackErrors.ELECTRON_DESKTOP_PICKER_NOT_FOUND]: 'Failed to detect desktop picker',\n    [JitsiTrackErrors.GENERAL]: 'Generic getUserMedia error',\n    [JitsiTrackErrors.PERMISSION_DENIED]: 'User denied permission to use device(s): ',\n    [JitsiTrackErrors.NOT_FOUND]: 'Requested device(s) was/were not found: ',\n    [JitsiTrackErrors.CONSTRAINT_FAILED]: 'Constraint could not be satisfied: ',\n    [JitsiTrackErrors.TIMEOUT]: 'Could not start media source. Timeout occurred!',\n    [JitsiTrackErrors.TRACK_IS_DISPOSED]: 'Track has been already disposed',\n    [JitsiTrackErrors.TRACK_NO_STREAM_FOUND]: 'Track does not have an associated Media Stream'\n};\n\n/**\n *\n * Represents an error that occurred to a JitsiTrack. Can represent various\n * types of errors. For error descriptions (@see JitsiTrackErrors).\n */\nexport default class JitsiTrackError extends Error {\n    public gum?: IGum;\n\n    /**\n     * @param {IGumError|string} error - error object or error name\n     * @param {IGumOptions|string} [options] - getUserMedia constraints object or error message\n     * @param {DeviceType[]} [devices] - list of getUserMedia requested devices\n     */\n    constructor(\n            error: IGumError | string,\n            options?: IGumOptions | string,\n            devices?: DeviceType[]\n    ) {\n        super();\n\n        if (typeof error === 'object' && typeof error.name !== 'undefined') {\n            /**\n             * Additional information about original getUserMedia error\n             * and constraints.\n             * @type {IGum}\n             */\n            this.gum = {\n                constraints: options,\n                devices: devices && Array.isArray(devices) ? devices.slice(0) : undefined,\n                error\n            };\n\n            switch (error.name) {\n            case 'NotAllowedError':\n            case 'PermissionDeniedError':\n            case 'SecurityError':\n                this.name = JitsiTrackErrors.PERMISSION_DENIED;\n                this.message = TRACK_ERROR_TO_MESSAGE_MAP[this.name] + (this.gum.devices || []).join(', ');\n                break;\n            case 'DevicesNotFoundError':\n            case 'NotFoundError':\n                this.name = JitsiTrackErrors.NOT_FOUND;\n                this.message = TRACK_ERROR_TO_MESSAGE_MAP[this.name] + (this.gum.devices || []).join(', ');\n                break;\n            case 'ConstraintNotSatisfiedError':\n            case 'OverconstrainedError': {\n                const constraintName = error.constraintName || error.constraint;\n\n                // we treat deviceId as unsupported resolution, as we want to\n                // retry and finally if everything fails to remove deviceId from\n                // mandatory constraints\n                if (typeof options !== 'string'\n                        && options?.video\n                        && (!devices || devices.indexOf('video') > -1)\n                        && (constraintName === 'minWidth'\n                            || constraintName === 'maxWidth'\n                            || constraintName === 'minHeight'\n                            || constraintName === 'maxHeight'\n                            || constraintName === 'width'\n                            || constraintName === 'height'\n                            || constraintName === 'deviceId')) {\n                    this.name = JitsiTrackErrors.UNSUPPORTED_RESOLUTION;\n                    this.message = TRACK_ERROR_TO_MESSAGE_MAP[this.name]\n                            + this.getResolutionFromFailedConstraint(constraintName, options);\n                } else {\n                    this.name = JitsiTrackErrors.CONSTRAINT_FAILED;\n                    this.message = TRACK_ERROR_TO_MESSAGE_MAP[this.name] + error.constraintName;\n                }\n                break;\n            }\n            default:\n                this.name = JitsiTrackErrors.GENERAL;\n                this.message = error.message || TRACK_ERROR_TO_MESSAGE_MAP[this.name];\n                break;\n            }\n        } else if (typeof error === 'string') {\n            if (TRACK_ERROR_TO_MESSAGE_MAP[error]) {\n                this.name = error;\n                this.message = typeof options === 'string' ? options : TRACK_ERROR_TO_MESSAGE_MAP[error];\n            } else {\n            // this is some generic error that do not fit any of our\n            // pre-defined errors, so don't give it any specific name, just\n            // store message\n                this.message = error;\n            }\n        } else {\n            throw new Error('Invalid arguments');\n        }\n\n        this.stack = typeof error === 'string' ? new Error().stack : error.stack;\n    }\n\n    /**\n     * Gets failed resolution constraint from corresponding object.\n     * @param failedConstraintName - The name of the failed constraint\n     * @param constraints - The constraints object\n     * @returns The resolution value or empty string\n     */\n    private getResolutionFromFailedConstraint(failedConstraintName: string, constraints: IGumOptions): string | number {\n        if (constraints?.video?.mandatory) {\n            switch (failedConstraintName) {\n            case 'width':\n                return constraints.video.mandatory.minWidth;\n            case 'height':\n                return constraints.video.mandatory.minHeight;\n            default:\n                return constraints.video.mandatory[failedConstraintName] || '';\n            }\n        }\n\n        return '';\n    }\n}\n","/**\n * A specialized version of `_.forEach` for arrays without support for\n * iteratee shorthands.\n *\n * @private\n * @param {Array} [array] The array to iterate over.\n * @param {Function} iteratee The function invoked per iteration.\n * @returns {Array} Returns `array`.\n */\nfunction arrayEach(array, iteratee) {\n  var index = -1,\n      length = array == null ? 0 : array.length;\n\n  while (++index < length) {\n    if (iteratee(array[index], index, array) === false) {\n      break;\n    }\n  }\n  return array;\n}\n\nexport default arrayEach;\n","import arrayPush from './_arrayPush.js';\nimport getPrototype from './_getPrototype.js';\nimport getSymbols from './_getSymbols.js';\nimport stubArray from './stubArray.js';\n\n/* Built-in method references for those with the same name as other `lodash` methods. */\nvar nativeGetSymbols = Object.getOwnPropertySymbols;\n\n/**\n * Creates an array of the own and inherited enumerable symbols of `object`.\n *\n * @private\n * @param {Object} object The object to query.\n * @returns {Array} Returns the array of symbols.\n */\nvar getSymbolsIn = !nativeGetSymbols ? stubArray : function(object) {\n  var result = [];\n  while (object) {\n    arrayPush(result, getSymbols(object));\n    object = getPrototype(object);\n  }\n  return result;\n};\n\nexport default getSymbolsIn;\n","import baseGetAllKeys from './_baseGetAllKeys.js';\nimport getSymbolsIn from './_getSymbolsIn.js';\nimport keysIn from './keysIn.js';\n\n/**\n * Creates an array of own and inherited enumerable property names and\n * symbols of `object`.\n *\n * @private\n * @param {Object} object The object to query.\n * @returns {Array} Returns the array of property names and symbols.\n */\nfunction getAllKeysIn(object) {\n  return baseGetAllKeys(object, keysIn, getSymbolsIn);\n}\n\nexport default getAllKeysIn;\n","/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * Initializes an array clone.\n *\n * @private\n * @param {Array} array The array to clone.\n * @returns {Array} Returns the initialized clone.\n */\nfunction initCloneArray(array) {\n  var length = array.length,\n      result = new array.constructor(length);\n\n  // Add properties assigned by `RegExp#exec`.\n  if (length && typeof array[0] == 'string' && hasOwnProperty.call(array, 'index')) {\n    result.index = array.index;\n    result.input = array.input;\n  }\n  return result;\n}\n\nexport default initCloneArray;\n","/** Used to match `RegExp` flags from their coerced string values. */\nvar reFlags = /\\w*$/;\n\n/**\n * Creates a clone of `regexp`.\n *\n * @private\n * @param {Object} regexp The regexp to clone.\n * @returns {Object} Returns the cloned regexp.\n */\nfunction cloneRegExp(regexp) {\n  var result = new regexp.constructor(regexp.source, reFlags.exec(regexp));\n  result.lastIndex = regexp.lastIndex;\n  return result;\n}\n\nexport default cloneRegExp;\n","import Symbol from './_Symbol.js';\n\n/** Used to convert symbols to primitives and strings. */\nvar symbolProto = Symbol ? Symbol.prototype : undefined,\n    symbolValueOf = symbolProto ? symbolProto.valueOf : undefined;\n\n/**\n * Creates a clone of the `symbol` object.\n *\n * @private\n * @param {Object} symbol The symbol object to clone.\n * @returns {Object} Returns the cloned symbol object.\n */\nfunction cloneSymbol(symbol) {\n  return symbolValueOf ? Object(symbolValueOf.call(symbol)) : {};\n}\n\nexport default cloneSymbol;\n","import cloneArrayBuffer from './_cloneArrayBuffer.js';\nimport cloneDataView from './_cloneDataView.js';\nimport cloneRegExp from './_cloneRegExp.js';\nimport cloneSymbol from './_cloneSymbol.js';\nimport cloneTypedArray from './_cloneTypedArray.js';\n\n/** `Object#toString` result references. */\nvar boolTag = '[object Boolean]',\n    dateTag = '[object Date]',\n    mapTag = '[object Map]',\n    numberTag = '[object Number]',\n    regexpTag = '[object RegExp]',\n    setTag = '[object Set]',\n    stringTag = '[object String]',\n    symbolTag = '[object Symbol]';\n\nvar arrayBufferTag = '[object ArrayBuffer]',\n    dataViewTag = '[object DataView]',\n    float32Tag = '[object Float32Array]',\n    float64Tag = '[object Float64Array]',\n    int8Tag = '[object Int8Array]',\n    int16Tag = '[object Int16Array]',\n    int32Tag = '[object Int32Array]',\n    uint8Tag = '[object Uint8Array]',\n    uint8ClampedTag = '[object Uint8ClampedArray]',\n    uint16Tag = '[object Uint16Array]',\n    uint32Tag = '[object Uint32Array]';\n\n/**\n * Initializes an object clone based on its `toStringTag`.\n *\n * **Note:** This function only supports cloning values with tags of\n * `Boolean`, `Date`, `Error`, `Map`, `Number`, `RegExp`, `Set`, or `String`.\n *\n * @private\n * @param {Object} object The object to clone.\n * @param {string} tag The `toStringTag` of the object to clone.\n * @param {boolean} [isDeep] Specify a deep clone.\n * @returns {Object} Returns the initialized clone.\n */\nfunction initCloneByTag(object, tag, isDeep) {\n  var Ctor = object.constructor;\n  switch (tag) {\n    case arrayBufferTag:\n      return cloneArrayBuffer(object);\n\n    case boolTag:\n    case dateTag:\n      return new Ctor(+object);\n\n    case dataViewTag:\n      return cloneDataView(object, isDeep);\n\n    case float32Tag: case float64Tag:\n    case int8Tag: case int16Tag: case int32Tag:\n    case uint8Tag: case uint8ClampedTag: case uint16Tag: case uint32Tag:\n      return cloneTypedArray(object, isDeep);\n\n    case mapTag:\n      return new Ctor;\n\n    case numberTag:\n    case stringTag:\n      return new Ctor(object);\n\n    case regexpTag:\n      return cloneRegExp(object);\n\n    case setTag:\n      return new Ctor;\n\n    case symbolTag:\n      return cloneSymbol(object);\n  }\n}\n\nexport default initCloneByTag;\n","import cloneArrayBuffer from './_cloneArrayBuffer.js';\n\n/**\n * Creates a clone of `dataView`.\n *\n * @private\n * @param {Object} dataView The data view to clone.\n * @param {boolean} [isDeep] Specify a deep clone.\n * @returns {Object} Returns the cloned data view.\n */\nfunction cloneDataView(dataView, isDeep) {\n  var buffer = isDeep ? cloneArrayBuffer(dataView.buffer) : dataView.buffer;\n  return new dataView.constructor(buffer, dataView.byteOffset, dataView.byteLength);\n}\n\nexport default cloneDataView;\n","import baseIsMap from './_baseIsMap.js';\nimport baseUnary from './_baseUnary.js';\nimport nodeUtil from './_nodeUtil.js';\n\n/* Node.js helper references. */\nvar nodeIsMap = nodeUtil && nodeUtil.isMap;\n\n/**\n * Checks if `value` is classified as a `Map` object.\n *\n * @static\n * @memberOf _\n * @since 4.3.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a map, else `false`.\n * @example\n *\n * _.isMap(new Map);\n * // => true\n *\n * _.isMap(new WeakMap);\n * // => false\n */\nvar isMap = nodeIsMap ? baseUnary(nodeIsMap) : baseIsMap;\n\nexport default isMap;\n","import getTag from './_getTag.js';\nimport isObjectLike from './isObjectLike.js';\n\n/** `Object#toString` result references. */\nvar mapTag = '[object Map]';\n\n/**\n * The base implementation of `_.isMap` without Node.js optimizations.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a map, else `false`.\n */\nfunction baseIsMap(value) {\n  return isObjectLike(value) && getTag(value) == mapTag;\n}\n\nexport default baseIsMap;\n","import baseIsSet from './_baseIsSet.js';\nimport baseUnary from './_baseUnary.js';\nimport nodeUtil from './_nodeUtil.js';\n\n/* Node.js helper references. */\nvar nodeIsSet = nodeUtil && nodeUtil.isSet;\n\n/**\n * Checks if `value` is classified as a `Set` object.\n *\n * @static\n * @memberOf _\n * @since 4.3.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a set, else `false`.\n * @example\n *\n * _.isSet(new Set);\n * // => true\n *\n * _.isSet(new WeakSet);\n * // => false\n */\nvar isSet = nodeIsSet ? baseUnary(nodeIsSet) : baseIsSet;\n\nexport default isSet;\n","import getTag from './_getTag.js';\nimport isObjectLike from './isObjectLike.js';\n\n/** `Object#toString` result references. */\nvar setTag = '[object Set]';\n\n/**\n * The base implementation of `_.isSet` without Node.js optimizations.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a set, else `false`.\n */\nfunction baseIsSet(value) {\n  return isObjectLike(value) && getTag(value) == setTag;\n}\n\nexport default baseIsSet;\n","import Stack from './_Stack.js';\nimport arrayEach from './_arrayEach.js';\nimport assignValue from './_assignValue.js';\nimport baseAssign from './_baseAssign.js';\nimport baseAssignIn from './_baseAssignIn.js';\nimport cloneBuffer from './_cloneBuffer.js';\nimport copyArray from './_copyArray.js';\nimport copySymbols from './_copySymbols.js';\nimport copySymbolsIn from './_copySymbolsIn.js';\nimport getAllKeys from './_getAllKeys.js';\nimport getAllKeysIn from './_getAllKeysIn.js';\nimport getTag from './_getTag.js';\nimport initCloneArray from './_initCloneArray.js';\nimport initCloneByTag from './_initCloneByTag.js';\nimport initCloneObject from './_initCloneObject.js';\nimport isArray from './isArray.js';\nimport isBuffer from './isBuffer.js';\nimport isMap from './isMap.js';\nimport isObject from './isObject.js';\nimport isSet from './isSet.js';\nimport keys from './keys.js';\nimport keysIn from './keysIn.js';\n\n/** Used to compose bitmasks for cloning. */\nvar CLONE_DEEP_FLAG = 1,\n    CLONE_FLAT_FLAG = 2,\n    CLONE_SYMBOLS_FLAG = 4;\n\n/** `Object#toString` result references. */\nvar argsTag = '[object Arguments]',\n    arrayTag = '[object Array]',\n    boolTag = '[object Boolean]',\n    dateTag = '[object Date]',\n    errorTag = '[object Error]',\n    funcTag = '[object Function]',\n    genTag = '[object GeneratorFunction]',\n    mapTag = '[object Map]',\n    numberTag = '[object Number]',\n    objectTag = '[object Object]',\n    regexpTag = '[object RegExp]',\n    setTag = '[object Set]',\n    stringTag = '[object String]',\n    symbolTag = '[object Symbol]',\n    weakMapTag = '[object WeakMap]';\n\nvar arrayBufferTag = '[object ArrayBuffer]',\n    dataViewTag = '[object DataView]',\n    float32Tag = '[object Float32Array]',\n    float64Tag = '[object Float64Array]',\n    int8Tag = '[object Int8Array]',\n    int16Tag = '[object Int16Array]',\n    int32Tag = '[object Int32Array]',\n    uint8Tag = '[object Uint8Array]',\n    uint8ClampedTag = '[object Uint8ClampedArray]',\n    uint16Tag = '[object Uint16Array]',\n    uint32Tag = '[object Uint32Array]';\n\n/** Used to identify `toStringTag` values supported by `_.clone`. */\nvar cloneableTags = {};\ncloneableTags[argsTag] = cloneableTags[arrayTag] =\ncloneableTags[arrayBufferTag] = cloneableTags[dataViewTag] =\ncloneableTags[boolTag] = cloneableTags[dateTag] =\ncloneableTags[float32Tag] = cloneableTags[float64Tag] =\ncloneableTags[int8Tag] = cloneableTags[int16Tag] =\ncloneableTags[int32Tag] = cloneableTags[mapTag] =\ncloneableTags[numberTag] = cloneableTags[objectTag] =\ncloneableTags[regexpTag] = cloneableTags[setTag] =\ncloneableTags[stringTag] = cloneableTags[symbolTag] =\ncloneableTags[uint8Tag] = cloneableTags[uint8ClampedTag] =\ncloneableTags[uint16Tag] = cloneableTags[uint32Tag] = true;\ncloneableTags[errorTag] = cloneableTags[funcTag] =\ncloneableTags[weakMapTag] = false;\n\n/**\n * The base implementation of `_.clone` and `_.cloneDeep` which tracks\n * traversed objects.\n *\n * @private\n * @param {*} value The value to clone.\n * @param {boolean} bitmask The bitmask flags.\n *  1 - Deep clone\n *  2 - Flatten inherited properties\n *  4 - Clone symbols\n * @param {Function} [customizer] The function to customize cloning.\n * @param {string} [key] The key of `value`.\n * @param {Object} [object] The parent object of `value`.\n * @param {Object} [stack] Tracks traversed objects and their clone counterparts.\n * @returns {*} Returns the cloned value.\n */\nfunction baseClone(value, bitmask, customizer, key, object, stack) {\n  var result,\n      isDeep = bitmask & CLONE_DEEP_FLAG,\n      isFlat = bitmask & CLONE_FLAT_FLAG,\n      isFull = bitmask & CLONE_SYMBOLS_FLAG;\n\n  if (customizer) {\n    result = object ? customizer(value, key, object, stack) : customizer(value);\n  }\n  if (result !== undefined) {\n    return result;\n  }\n  if (!isObject(value)) {\n    return value;\n  }\n  var isArr = isArray(value);\n  if (isArr) {\n    result = initCloneArray(value);\n    if (!isDeep) {\n      return copyArray(value, result);\n    }\n  } else {\n    var tag = getTag(value),\n        isFunc = tag == funcTag || tag == genTag;\n\n    if (isBuffer(value)) {\n      return cloneBuffer(value, isDeep);\n    }\n    if (tag == objectTag || tag == argsTag || (isFunc && !object)) {\n      result = (isFlat || isFunc) ? {} : initCloneObject(value);\n      if (!isDeep) {\n        return isFlat\n          ? copySymbolsIn(value, baseAssignIn(result, value))\n          : copySymbols(value, baseAssign(result, value));\n      }\n    } else {\n      if (!cloneableTags[tag]) {\n        return object ? value : {};\n      }\n      result = initCloneByTag(value, tag, isDeep);\n    }\n  }\n  // Check for circular references and return its corresponding clone.\n  stack || (stack = new Stack);\n  var stacked = stack.get(value);\n  if (stacked) {\n    return stacked;\n  }\n  stack.set(value, result);\n\n  if (isSet(value)) {\n    value.forEach(function(subValue) {\n      result.add(baseClone(subValue, bitmask, customizer, subValue, value, stack));\n    });\n  } else if (isMap(value)) {\n    value.forEach(function(subValue, key) {\n      result.set(key, baseClone(subValue, bitmask, customizer, key, value, stack));\n    });\n  }\n\n  var keysFunc = isFull\n    ? (isFlat ? getAllKeysIn : getAllKeys)\n    : (isFlat ? keysIn : keys);\n\n  var props = isArr ? undefined : keysFunc(value);\n  arrayEach(props || value, function(subValue, key) {\n    if (props) {\n      key = subValue;\n      subValue = value[key];\n    }\n    // Recursively populate clone (susceptible to call stack limits).\n    assignValue(result, key, baseClone(subValue, bitmask, customizer, key, value, stack));\n  });\n  return result;\n}\n\nexport default baseClone;\n","import copyObject from './_copyObject.js';\nimport getSymbolsIn from './_getSymbolsIn.js';\n\n/**\n * Copies own and inherited symbols of `source` to `object`.\n *\n * @private\n * @param {Object} source The object to copy symbols from.\n * @param {Object} [object={}] The object to copy symbols to.\n * @returns {Object} Returns `object`.\n */\nfunction copySymbolsIn(source, object) {\n  return copyObject(source, getSymbolsIn(source), object);\n}\n\nexport default copySymbolsIn;\n","import copyObject from './_copyObject.js';\nimport keysIn from './keysIn.js';\n\n/**\n * The base implementation of `_.assignIn` without support for multiple sources\n * or `customizer` functions.\n *\n * @private\n * @param {Object} object The destination object.\n * @param {Object} source The source object.\n * @returns {Object} Returns `object`.\n */\nfunction baseAssignIn(object, source) {\n  return object && copyObject(source, keysIn(source), object);\n}\n\nexport default baseAssignIn;\n","import copyObject from './_copyObject.js';\nimport getSymbols from './_getSymbols.js';\n\n/**\n * Copies own symbols of `source` to `object`.\n *\n * @private\n * @param {Object} source The object to copy symbols from.\n * @param {Object} [object={}] The object to copy symbols to.\n * @returns {Object} Returns `object`.\n */\nfunction copySymbols(source, object) {\n  return copyObject(source, getSymbols(source), object);\n}\n\nexport default copySymbols;\n","import copyObject from './_copyObject.js';\nimport keys from './keys.js';\n\n/**\n * The base implementation of `_.assign` without support for multiple sources\n * or `customizer` functions.\n *\n * @private\n * @param {Object} object The destination object.\n * @param {Object} source The source object.\n * @returns {Object} Returns `object`.\n */\nfunction baseAssign(object, source) {\n  return object && copyObject(source, keys(source), object);\n}\n\nexport default baseAssign;\n","import baseClone from './_baseClone.js';\n\n/** Used to compose bitmasks for cloning. */\nvar CLONE_DEEP_FLAG = 1,\n    CLONE_SYMBOLS_FLAG = 4;\n\n/**\n * This method is like `_.clone` except that it recursively clones `value`.\n *\n * @static\n * @memberOf _\n * @since 1.0.0\n * @category Lang\n * @param {*} value The value to recursively clone.\n * @returns {*} Returns the deep cloned value.\n * @see _.clone\n * @example\n *\n * var objects = [{ 'a': 1 }, { 'b': 2 }];\n *\n * var deep = _.cloneDeep(objects);\n * console.log(deep[0] === objects[0]);\n * // => false\n */\nfunction cloneDeep(value) {\n  return baseClone(value, CLONE_DEEP_FLAG | CLONE_SYMBOLS_FLAG);\n}\n\nexport default cloneDeep;\n","/**\n * Enumeration of the video types\n */\nexport enum VideoType {\n\n    /**\n     * The camera video type.\n     */\n    CAMERA = 'camera',\n\n    /**\n     * The desktop video type.\n     */\n    DESKTOP = 'desktop',\n\n    /**\n     * The high fps desktop video type.\n     */\n    DESKTOP_HIGH_FPS = 'desktop_high_fps'\n}\n","import EventEmitter, { EventListener } from './EventEmitter';\n\n/**\n * The class implements basic event operations - add/remove listener.\n * NOTE: The purpose of the class is to be extended in order to add\n * this functionality to other classes.\n */\nexport default class Listenable {\n    /**\n     * @internal\n     */\n    eventEmitter: EventEmitter;\n\n    /**\n     * Creates new instance.\n     */\n    constructor() {\n        this.eventEmitter = new EventEmitter();\n    }\n\n    /**\n   * Attaches a handler for events (e.g., \"participant joined\") in the conference.\n   * All possible events are defined in JitsiConferenceEvents.\n   * @param {string} eventId - The event ID.\n   * @param {Function} handler - Handler for the event.\n   */\n    on(eventId: string, handler: EventListener): void {\n        this.eventEmitter.on(eventId, handler);\n    }\n\n    /**\n   * Removes event listener.\n   * @param {string} eventId - The event ID.\n   * @param {Function} [handler] - Optional, the specific handler to unbind.\n   */\n    off(eventId: string, handler?: EventListener): void {\n        this.eventEmitter.removeListener(eventId, handler);\n    }\n\n    /**\n   * Adds a one-time listener function for the event.\n   * @param {string} eventId - The event ID.\n   * @param {Function} handler - Handler for the event.\n   */\n    once(eventId: string, handler: EventListener): void {\n        this.eventEmitter.once(eventId, handler);\n    }\n\n    /**\n     * Alias for on method.\n     * @param {string} eventId - The event ID.\n     * @param {Function} handler - Handler for the event.\n     */\n    addEventListener(eventId: string, handler: EventListener): void {\n        this.on(eventId, handler);\n    }\n\n    /**\n     * Alias for off method.\n     * @param {string} eventId - The event ID.\n     * @param {Function} [handler] - Optional, the specific handler to unbind.\n     */\n    removeEventListener(eventId: string, handler?: EventListener): void {\n        this.off(eventId, handler);\n    }\n\n    /**\n     * Adds new cancellable listener.\n     * @param {String} eventName the name of the event\n     * @param {Function} listener the listener.\n     * @returns {Function} - The unsubscribe function.\n     */\n    addCancellableListener(eventName: string, listener: EventListener): () => void {\n        this.addListener(eventName, listener);\n\n        return () => this.removeListener(eventName, listener);\n    }\n\n    /**\n     * Adds new listener.\n     * @param {String} eventName the name of the event\n     * @param {Function} listener the listener.\n     * @returns {EventEmitter} - The emitter, so that calls can be chained.\n     */\n    addListener(eventName: string, listener: EventListener): EventEmitter {\n        return this.eventEmitter.addListener(eventName, listener);\n    }\n\n    /**\n     * Removes listener.\n     * @param {String} eventName the name of the event that triggers the\n     * listener\n     * @param {Function} listener the listener.\n     * @returns {EventEmitter} - The emitter, so that calls can be chained.\n     */\n    removeListener(eventName: string, listener: EventListener): EventEmitter {\n        return this.eventEmitter.removeListener(eventName, listener);\n    }\n\n    /**\n     * Emits an event.\n     * @param {string} event - event name\n     */\n    emit(event: string, ...args: any[]): void {\n        this.eventEmitter.emit(event, ...args);\n    }\n\n    /**\n     * Removes all listeners for the event emitter.\n     */\n    removeAllListeners(): void {\n        this.eventEmitter.removeAllListeners();\n    }\n\n    /**\n     * Returns the number of listeners for the specified event.\n     * @param {string} [eventName] - The name of the event.\n     * @returns {number} - The number of listeners for the event.\n     */\n    listenerCount(eventName?: string): number {\n        return this.eventEmitter.listenerCount(eventName);\n    }\n}\n","import { safeJsonParse } from '@jitsi/js-utils/json';\nimport { getLogger } from '@jitsi/logger';\nimport { EventEmitter } from 'events';\n\nimport JitsiConference from '../../JitsiConference';\nimport { BridgeVideoType } from '../../service/RTC/BridgeVideoType';\nimport { RTCEvents } from '../../service/RTC/RTCEvents';\nimport { IReceiverAudioSubscriptionMessage } from '../../service/RTC/ReceiverAudioSubscription';\nimport { SourceName } from '../../service/RTC/SignalingLayer';\nimport { createBridgeChannelClosedEvent } from '../../service/statistics/AnalyticsEvents';\nimport ReceiverVideoConstraints from '../qualitycontrol/ReceiveVideoController';\nimport Statistics from '../statistics/statistics';\n\n\nconst logger = getLogger('rtc:BridgeChannel');\n\n/**\n * Handles a WebRTC RTCPeerConnection or a WebSocket instance to communicate\n * with the videobridge.\n */\nexport default class BridgeChannel {\n\n    private _channel: Nullable<RTCDataChannel | WebSocket> = null;\n    private _conference: JitsiConference;\n    private _connected: Optional<boolean> = undefined;\n    private _eventEmitter: EventEmitter;\n    private _mode: Nullable<'datachannel' | 'websocket'> = null;\n    private _areRetriesEnabled: boolean = false;\n    private _closedFromClient: boolean = false;\n    private _wsUrl?: string;\n    private _retryTimeout?: ReturnType<typeof setTimeout>;\n\n    /**\n     * Binds \"ondatachannel\" event listener on the given RTCPeerConnection\n     * instance, or creates a WebSocket connection with the videobridge.\n     * At least one of both, peerconnection or wsUrl parameters, must be\n     * given.\n     * @param {Nullable<RTCPeerConnection>} [peerconnection] WebRTC peer connection\n     * instance.\n     * @param {Nullable<string>} [wsUrl] WebSocket URL.\n     * @param {EventEmitter} emitter the EventEmitter instance to use for event emission.\n     * @param {JitsiConference} conference the conference instance.\n     */\n    constructor(\n            peerconnection: Nullable<RTCPeerConnection>,\n            wsUrl: Nullable<string>,\n            emitter: EventEmitter,\n            conference: JitsiConference\n    ) {\n        if (!peerconnection && !wsUrl) {\n            throw new TypeError('At least peerconnection or wsUrl must be given');\n        } else if (peerconnection && wsUrl) {\n            throw new TypeError('Just one of peerconnection or wsUrl must be given');\n        }\n\n        if (peerconnection) {\n            logger.debug('constructor() with peerconnection');\n        } else {\n            logger.debug(`constructor() with wsUrl:\"${wsUrl}\"`);\n        }\n\n        // The underlying WebRTC RTCDataChannel or WebSocket instance.\n        // @type {RTCDataChannel|WebSocket}\n        this._channel = null;\n\n        // The conference that uses this bridge channel.\n        this._conference = conference;\n\n        // Whether the channel is connected or not. It will start as undefined\n        // for the first connection attempt. Then transition to either true or false.\n        this._connected = undefined;\n\n        // @type {EventEmitter}\n        this._eventEmitter = emitter;\n\n        // Whether a RTCDataChannel or WebSocket is internally used.\n        // @type {string} \"datachannel\" / \"websocket\"\n        this._mode = null;\n\n        // Indicates whether the connection retries are enabled or not.\n        this._areRetriesEnabled = false;\n\n        // Indicates whether the connection was closed from the client or not.\n        this._closedFromClient = false;\n\n        // If a RTCPeerConnection is given, listen for new RTCDataChannel\n        // event.\n        if (peerconnection) {\n            const datachannel\n                = peerconnection.createDataChannel(\n                    'JVB data channel', {\n                        protocol: 'http://jitsi.org/protocols/colibri'\n                    });\n\n            // Handle the RTCDataChannel.\n            this._handleChannel(datachannel);\n            this._mode = 'datachannel';\n\n        // Otherwise create a WebSocket connection.\n        } else if (wsUrl) {\n            this._areRetriesEnabled = true;\n            this._wsUrl = wsUrl;\n            this._initWebSocket();\n        }\n    }\n\n    /**\n     * Initializes the web socket channel.\n     *\n     * @returns {void}\n     */\n    _initWebSocket(): void {\n        // Create a WebSocket instance.\n        const ws = new WebSocket(this._wsUrl);\n\n        // Handle the WebSocket.\n        this._handleChannel(ws);\n        this._mode = 'websocket';\n    }\n\n    /**\n     * Starts the websocket connection retries.\n     *\n     * @returns {void}\n     */\n    _startConnectionRetries(): void {\n        let timeoutS = 1;\n\n        const reload = (): void => {\n            const isConnecting = this._channel && (this._channel.readyState === 'connecting'\n                    || this._channel.readyState === WebSocket.CONNECTING);\n\n            // Should not spawn new websockets while one is already trying to connect.\n            if (isConnecting) {\n                // Timeout is still required as there is flag `_areRetriesEnabled` that\n                // blocks new retrying cycles until any channel opens in current cycle.\n                this._retryTimeout = setTimeout(reload, timeoutS * 1000);\n\n                return;\n            }\n\n            if (this.isOpen()) {\n                return;\n            }\n            this._initWebSocket();\n            timeoutS = Math.min(timeoutS * 2, 60);\n            this._retryTimeout = setTimeout(reload, timeoutS * 1000);\n        };\n\n        this._retryTimeout = setTimeout(reload, timeoutS * 1000);\n    }\n\n    /**\n     * Stops the websocket connection retries.\n     *\n     * @returns {void}\n     */\n    _stopConnectionRetries(): void {\n        if (this._retryTimeout) {\n            clearTimeout(this._retryTimeout);\n            this._retryTimeout = undefined;\n        }\n    }\n\n    /**\n     * Retries to establish the websocket connection after the connection was closed by the server.\n     *\n     * @param {CloseEvent} closeEvent - The close event that triggered the retries.\n     * @returns {void}\n     */\n    _retryWebSocketConnection(closeEvent: CloseEvent): void {\n        if (!this._areRetriesEnabled) {\n            return;\n        }\n        const { code, reason } = closeEvent;\n\n        Statistics.sendAnalytics(createBridgeChannelClosedEvent(code.toString(), reason));\n        this._areRetriesEnabled = false;\n        this._eventEmitter.once(RTCEvents.DATA_CHANNEL_OPEN, () => {\n            this._stopConnectionRetries();\n            this._areRetriesEnabled = true;\n        });\n        this._startConnectionRetries();\n    }\n\n    /**\n     * The channel mode.\n     * @return {string} \"datachannel\" or \"websocket\" (or null if not yet set).\n     */\n    get mode(): string {\n        return this._mode;\n    }\n\n    /**\n     * Closes the currently opened channel.\n     */\n    close(): void {\n        this._closedFromClient = true;\n        this._stopConnectionRetries();\n        this._areRetriesEnabled = false;\n        if (this._channel) {\n            try {\n                this._channel.close();\n            } catch (error) {} // eslint-disable-line no-empty\n\n            this._channel = null;\n        }\n    }\n\n    /**\n     * Whether there is an underlying RTCDataChannel or WebSocket and it's\n     * open.\n     * @return {boolean}\n     */\n    isOpen(): boolean {\n        return this._channel && (this._channel.readyState === 'open'\n            || this._channel.readyState === WebSocket.OPEN);\n    }\n\n    /**\n     * Sends local stats via the bridge channel.\n     * @param {Object} payload The payload of the message.\n     * @throws NetworkError/InvalidStateError/Error if the operation fails or if there is no data channel created.\n     */\n    sendEndpointStatsMessage(payload: Record<string, unknown>): void {\n        this._send({\n            colibriClass: 'EndpointStats',\n            ...payload\n        });\n    }\n\n    /**\n     * Sends message via the channel.\n     * @param {string} to The id of the endpoint that should receive the\n     * message. If \"\" the message will be sent to all participants.\n     * @param  {object} payload The payload of the message.\n     * @throws NetworkError or InvalidStateError from RTCDataChannel#send (@see\n     * {@link https://developer.mozilla.org/docs/Web/API/RTCDataChannel/send})\n     * or from WebSocket#send or Error with \"No opened channel\" message.\n     */\n    sendMessage(to: string, payload: Record<string, unknown>): void {\n        this._send({\n            colibriClass: 'EndpointMessage',\n            msgPayload: payload,\n            to\n        });\n    }\n\n    /**\n     * Sends a \"lastN value changed\" message via the channel.\n     * @param {number} value The new value for lastN. -1 means unlimited.\n     */\n    sendSetLastNMessage(value: number): void {\n        logger.debug(`Sending lastN=${value}.`);\n\n        this._send({\n            colibriClass: 'LastNChangedEvent',\n            lastN: value\n        });\n    }\n\n    /**\n     * Sends a message for audio subscription updates.\n     *\n     * @param {IReceiverAudioSubscriptionMessage} message - The audio subscription message.\n     * @returns {void}\n     */\n    sendReceiverAudioSubscriptionMessage(message: IReceiverAudioSubscriptionMessage): void {\n        logger.info(`Sending ReceiverAudioSubscription with mode: ${message.mode}`\n            + ` and ${message.list?.length ? 'list=' + message.list.join(', ') : 'no list'}`);\n        this._send({\n            colibriClass: 'ReceiverAudioSubscription',\n            ...message\n        });\n    }\n\n    /**\n     * Sends a 'ReceiverVideoConstraints' message via the bridge channel.\n     *\n     * @param {ReceiverVideoConstraints} constraints video constraints.\n     */\n    sendReceiverVideoConstraintsMessage(constraints: ReceiverVideoConstraints): void {\n        logger.info(`Sending ReceiverVideoConstraints with ${JSON.stringify(constraints)}`);\n        this._send({\n            colibriClass: 'ReceiverVideoConstraints',\n            ...constraints\n        });\n    }\n\n    /**\n     * Sends a 'SourceVideoTypeMessage' message via the bridge channel.\n     *\n     * @param {BridgeVideoType} videoType - the video type.\n     * @param {SourceName} sourceName - the source name of the video track.\n     * @returns {void}\n     */\n    sendSourceVideoTypeMessage(sourceName: SourceName, videoType: BridgeVideoType): void {\n        logger.info(`Sending SourceVideoTypeMessage with video type ${sourceName}: ${videoType}`);\n        this._send({\n            colibriClass: 'SourceVideoTypeMessage',\n            sourceName,\n            videoType\n        });\n    }\n\n    /**\n     * Set events on the given RTCDataChannel or WebSocket instance.\n     */\n    _handleChannel(channel: RTCDataChannel | WebSocket): void {\n        const emitter = this._eventEmitter;\n\n        channel.onopen = (): Nullable<void> => {\n            logger.info(`${this._mode} channel opened`);\n\n            this._connected = true;\n\n            emitter.emit(RTCEvents.DATA_CHANNEL_OPEN);\n        };\n\n        channel.onerror = (event: ErrorEvent): void => {\n            // WS error events contain no information about the failure (this is available in the onclose event) and\n            // the event references the WS object itself, which causes hangs on mobile.\n            if (this._mode !== 'websocket') {\n                logger.error(`Channel error: ${event.message}`);\n            }\n        };\n\n        channel.onmessage = ({ data }: { data: string; }): void => {\n            // JSON object.\n            let obj;\n\n            try {\n                obj = safeJsonParse(data);\n            } catch (error) {\n                logger.error('Failed to parse channel message as JSON: ', data, error);\n\n                return;\n            }\n\n            const colibriClass = obj.colibriClass;\n\n            switch (colibriClass) {\n            case 'ConnectionStats': {\n                const { estimatedDownlinkBandwidth } = obj;\n\n                logger.debug(`Connection stats: bwe=${estimatedDownlinkBandwidth} bps`);\n                emitter.emit(RTCEvents.BRIDGE_BWE_STATS_RECEIVED, estimatedDownlinkBandwidth);\n                break;\n            }\n\n            case 'DominantSpeakerEndpointChangeEvent': {\n                const { dominantSpeakerEndpoint, previousSpeakers = [], silence } = obj;\n\n                logger.debug(`Dominant speaker: ${dominantSpeakerEndpoint}, previous speakers: ${previousSpeakers}`);\n                emitter.emit(RTCEvents.DOMINANT_SPEAKER_CHANGED, dominantSpeakerEndpoint, previousSpeakers, silence);\n                break;\n            }\n            case 'EndpointConnectivityStatusChangeEvent': {\n                const endpoint = obj.endpoint;\n                const isActive = obj.active === 'true';\n\n                logger.info(`Endpoint connection status changed: ${endpoint} active=${isActive}`);\n                emitter.emit(RTCEvents.ENDPOINT_CONN_STATUS_CHANGED, endpoint, isActive);\n\n                break;\n            }\n            case 'EndpointMessage': {\n                emitter.emit(RTCEvents.ENDPOINT_MESSAGE_RECEIVED, obj.from, obj.msgPayload);\n\n                break;\n            }\n            case 'EndpointStats': {\n                emitter.emit(RTCEvents.ENDPOINT_STATS_RECEIVED, obj.from, obj);\n\n                break;\n            }\n            case 'ForwardedSources': {\n                const forwardedSources = obj.forwardedSources;\n\n                logger.info(`New forwarded sources: ${forwardedSources}`);\n                emitter.emit(RTCEvents.FORWARDED_SOURCES_CHANGED, forwardedSources);\n\n                break;\n            }\n            case 'SenderSourceConstraints': {\n                if (typeof obj.sourceName === 'string' && typeof obj.maxHeight === 'number') {\n                    logger.info(`SenderSourceConstraints: ${obj.sourceName} - ${obj.maxHeight}`);\n                    emitter.emit(RTCEvents.SENDER_VIDEO_CONSTRAINTS_CHANGED, obj);\n                } else {\n                    logger.error(`Invalid SenderSourceConstraints: ${obj.sourceName} - ${obj.maxHeight}`);\n                }\n                break;\n            }\n            case 'ServerHello': {\n                logger.info(`Received ServerHello, version=${obj.version}.`);\n                break;\n            }\n            case 'VideoSourcesMap': {\n                logger.info(`Received VideoSourcesMap: ${JSON.stringify(obj.mappedSources)}`);\n                emitter.emit(RTCEvents.VIDEO_SSRCS_REMAPPED, obj);\n                break;\n            }\n            case 'AudioSourcesMap': {\n                logger.info(`Received AudioSourcesMap: ${JSON.stringify(obj.mappedSources)}`);\n                emitter.emit(RTCEvents.AUDIO_SSRCS_REMAPPED, obj);\n                break;\n            }\n            default: {\n                logger.debug('Channel JSON-formatted message: ', obj);\n\n                // The received message appears to be appropriately formatted\n                // (i.e. is a JSON object which assigns a value to the\n                // mandatory property colibriClass) so don't just swallow it,\n                // expose it to public consumption.\n                emitter.emit(`rtc.datachannel.${colibriClass}`, obj);\n            }\n            }\n        };\n\n        channel.onclose = (event: CloseEvent): void => {\n            logger.debug(`Channel closed by ${this._closedFromClient ? 'client' : 'server'}`);\n\n            if (channel !== this._channel) {\n                logger.debug('Skip close handler, channel instance is not equal to stored one');\n\n                return;\n            }\n\n            // When the JVB closes the connection gracefully due to the participant being alone in the meeting it uses\n            // code 1001. However, the same code is also used by Cloudflare when it terminates the ws. Therefore, check\n            // for the number of remote participants in the call and abort retries only when the endpoint is the only\n            // endpoint in the call.\n            const isGracefulClose = this._closedFromClient\n                || (event.code === 1001 && this._conference.getParticipantCount() === 1);\n\n            if (!isGracefulClose) {\n                const { code, reason } = event;\n\n                logger.error(`Channel closed: ${code} ${reason}`);\n\n                if (this._mode === 'websocket') {\n                    this._retryWebSocketConnection(event);\n\n                    // We only want to send this event the first time the failure happens.\n                    if (this._connected !== false) {\n                        emitter.emit(RTCEvents.DATA_CHANNEL_CLOSED, {\n                            code,\n                            reason\n                        });\n                    }\n                }\n            }\n\n            this._connected = false;\n\n            // Remove the channel.\n            this._channel = null;\n        };\n\n        // Store the channel.\n        this._channel = channel;\n    }\n\n    /**\n     * Sends passed object via the channel.\n     * @param {object} jsonObject The object that will be sent.\n     * @throws NetworkError or InvalidStateError from RTCDataChannel#send (@see\n     * {@link https://developer.mozilla.org/docs/Web/API/RTCDataChannel/send})\n     * or from WebSocket#send or Error with \"No opened channel\" message.\n     */\n    _send(jsonObject: Record<string, unknown>): void {\n        const channel = this._channel;\n\n        if (!this.isOpen()) {\n            logger.error('Bridge Channel send: no opened channel.');\n            throw new Error('No opened channel');\n        }\n\n        channel.send(JSON.stringify(jsonObject));\n    }\n}\n","/**\n * The possible camera facing modes. For now support only 'user' and\n * 'environment' because 'left' and 'right' are not used anywhere in our\n * projects at the time of this writing. For more information please refer to\n * https://w3c.github.io/mediacapture-main/getusermedia.html\n * #def-constraint-facingMode.\n *\n * @enum {string}\n */\nexport enum CameraFacingMode {\n\n    /**\n     * The mode which specifies the environment-facing camera.\n     */\n    ENVIRONMENT = 'environment',\n\n    /**\n     * The mode which specifies the user-facing camera.\n     */\n    USER = 'user'\n}\n","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\n\nlet logDisabled_ = true;\nlet deprecationWarnings_ = true;\n\n/**\n * Extract browser version out of the provided user agent string.\n *\n * @param {!string} uastring userAgent string.\n * @param {!string} expr Regular expression used as match criteria.\n * @param {!number} pos position in the version string to be returned.\n * @return {!number} browser version.\n */\nexport function extractVersion(uastring, expr, pos) {\n  const match = uastring.match(expr);\n  return match && match.length >= pos && parseInt(match[pos], 10);\n}\n\n// Wraps the peerconnection event eventNameToWrap in a function\n// which returns the modified event object (or false to prevent\n// the event).\nexport function wrapPeerConnectionEvent(window, eventNameToWrap, wrapper) {\n  if (!window.RTCPeerConnection) {\n    return;\n  }\n  const proto = window.RTCPeerConnection.prototype;\n  const nativeAddEventListener = proto.addEventListener;\n  proto.addEventListener = function(nativeEventName, cb) {\n    if (nativeEventName !== eventNameToWrap) {\n      return nativeAddEventListener.apply(this, arguments);\n    }\n    const wrappedCallback = (e) => {\n      const modifiedEvent = wrapper(e);\n      if (modifiedEvent) {\n        if (cb.handleEvent) {\n          cb.handleEvent(modifiedEvent);\n        } else {\n          cb(modifiedEvent);\n        }\n      }\n    };\n    this._eventMap = this._eventMap || {};\n    if (!this._eventMap[eventNameToWrap]) {\n      this._eventMap[eventNameToWrap] = new Map();\n    }\n    this._eventMap[eventNameToWrap].set(cb, wrappedCallback);\n    return nativeAddEventListener.apply(this, [nativeEventName,\n      wrappedCallback]);\n  };\n\n  const nativeRemoveEventListener = proto.removeEventListener;\n  proto.removeEventListener = function(nativeEventName, cb) {\n    if (nativeEventName !== eventNameToWrap || !this._eventMap\n        || !this._eventMap[eventNameToWrap]) {\n      return nativeRemoveEventListener.apply(this, arguments);\n    }\n    if (!this._eventMap[eventNameToWrap].has(cb)) {\n      return nativeRemoveEventListener.apply(this, arguments);\n    }\n    const unwrappedCb = this._eventMap[eventNameToWrap].get(cb);\n    this._eventMap[eventNameToWrap].delete(cb);\n    if (this._eventMap[eventNameToWrap].size === 0) {\n      delete this._eventMap[eventNameToWrap];\n    }\n    if (Object.keys(this._eventMap).length === 0) {\n      delete this._eventMap;\n    }\n    return nativeRemoveEventListener.apply(this, [nativeEventName,\n      unwrappedCb]);\n  };\n\n  Object.defineProperty(proto, 'on' + eventNameToWrap, {\n    get() {\n      return this['_on' + eventNameToWrap];\n    },\n    set(cb) {\n      if (this['_on' + eventNameToWrap]) {\n        this.removeEventListener(eventNameToWrap,\n            this['_on' + eventNameToWrap]);\n        delete this['_on' + eventNameToWrap];\n      }\n      if (cb) {\n        this.addEventListener(eventNameToWrap,\n            this['_on' + eventNameToWrap] = cb);\n      }\n    },\n    enumerable: true,\n    configurable: true\n  });\n}\n\nexport function disableLog(bool) {\n  if (typeof bool !== 'boolean') {\n    return new Error('Argument type: ' + typeof bool +\n        '. Please use a boolean.');\n  }\n  logDisabled_ = bool;\n  return (bool) ? 'adapter.js logging disabled' :\n      'adapter.js logging enabled';\n}\n\n/**\n * Disable or enable deprecation warnings\n * @param {!boolean} bool set to true to disable warnings.\n */\nexport function disableWarnings(bool) {\n  if (typeof bool !== 'boolean') {\n    return new Error('Argument type: ' + typeof bool +\n        '. Please use a boolean.');\n  }\n  deprecationWarnings_ = !bool;\n  return 'adapter.js deprecation warnings ' + (bool ? 'disabled' : 'enabled');\n}\n\nexport function log() {\n  if (typeof window === 'object') {\n    if (logDisabled_) {\n      return;\n    }\n    if (typeof console !== 'undefined' && typeof console.log === 'function') {\n      console.log.apply(console, arguments);\n    }\n  }\n}\n\n/**\n * Shows a deprecation warning suggesting the modern and spec-compatible API.\n */\nexport function deprecated(oldMethod, newMethod) {\n  if (!deprecationWarnings_) {\n    return;\n  }\n  console.warn(oldMethod + ' is deprecated, please use ' + newMethod +\n      ' instead.');\n}\n\n/**\n * Browser detector.\n *\n * @return {object} result containing browser and version\n *     properties.\n */\nexport function detectBrowser(window) {\n  // Returned result object.\n  const result = {browser: null, version: null};\n\n  // Fail early if it's not a browser\n  if (typeof window === 'undefined' || !window.navigator) {\n    result.browser = 'Not a browser.';\n    return result;\n  }\n\n  const {navigator} = window;\n\n  if (navigator.mozGetUserMedia) { // Firefox.\n    result.browser = 'firefox';\n    result.version = extractVersion(navigator.userAgent,\n        /Firefox\\/(\\d+)\\./, 1);\n  } else if (navigator.webkitGetUserMedia ||\n      (window.isSecureContext === false && window.webkitRTCPeerConnection &&\n       !window.RTCIceGatherer)) {\n    // Chrome, Chromium, Webview, Opera.\n    // Version matches Chrome/WebRTC version.\n    // Chrome 74 removed webkitGetUserMedia on http as well so we need the\n    // more complicated fallback to webkitRTCPeerConnection.\n    result.browser = 'chrome';\n    result.version = extractVersion(navigator.userAgent,\n        /Chrom(e|ium)\\/(\\d+)\\./, 2);\n  } else if (window.RTCPeerConnection &&\n      navigator.userAgent.match(/AppleWebKit\\/(\\d+)\\./)) { // Safari.\n    result.browser = 'safari';\n    result.version = extractVersion(navigator.userAgent,\n        /AppleWebKit\\/(\\d+)\\./, 1);\n    result.supportsUnifiedPlan = window.RTCRtpTransceiver &&\n        'currentDirection' in window.RTCRtpTransceiver.prototype;\n  } else { // Default fallthrough: not supported.\n    result.browser = 'Not a supported browser.';\n    return result;\n  }\n\n  return result;\n}\n\n/**\n * Checks if something is an object.\n *\n * @param {*} val The something you want to check.\n * @return true if val is an object, false otherwise.\n */\nfunction isObject(val) {\n  return Object.prototype.toString.call(val) === '[object Object]';\n}\n\n/**\n * Remove all empty objects and undefined values\n * from a nested object -- an enhanced and vanilla version\n * of Lodash's `compact`.\n */\nexport function compactObject(data) {\n  if (!isObject(data)) {\n    return data;\n  }\n\n  return Object.keys(data).reduce(function(accumulator, key) {\n    const isObj = isObject(data[key]);\n    const value = isObj ? compactObject(data[key]) : data[key];\n    const isEmptyObject = isObj && !Object.keys(value).length;\n    if (value === undefined || isEmptyObject) {\n      return accumulator;\n    }\n    return Object.assign(accumulator, {[key]: value});\n  }, {});\n}\n\n/* iterates the stats graph recursively. */\nexport function walkStats(stats, base, resultSet) {\n  if (!base || resultSet.has(base.id)) {\n    return;\n  }\n  resultSet.set(base.id, base);\n  Object.keys(base).forEach(name => {\n    if (name.endsWith('Id')) {\n      walkStats(stats, stats.get(base[name]), resultSet);\n    } else if (name.endsWith('Ids')) {\n      base[name].forEach(id => {\n        walkStats(stats, stats.get(id), resultSet);\n      });\n    }\n  });\n}\n\n/* filter getStats for a sender/receiver track. */\nexport function filterStats(result, track, outbound) {\n  const streamStatsType = outbound ? 'outbound-rtp' : 'inbound-rtp';\n  const filteredResult = new Map();\n  if (track === null) {\n    return filteredResult;\n  }\n  const trackStats = [];\n  result.forEach(value => {\n    if (value.type === 'track' &&\n        value.trackIdentifier === track.id) {\n      trackStats.push(value);\n    }\n  });\n  trackStats.forEach(trackStat => {\n    result.forEach(stats => {\n      if (stats.type === streamStatsType && stats.trackId === trackStat.id) {\n        walkStats(result, stats, filteredResult);\n      }\n    });\n  });\n  return filteredResult;\n}\n\n","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n'use strict';\nimport * as utils from '../utils.js';\nconst logging = utils.log;\n\nexport function shimGetUserMedia(window, browserDetails) {\n  const navigator = window && window.navigator;\n\n  if (!navigator.mediaDevices) {\n    return;\n  }\n\n  const constraintsToChrome_ = function(c) {\n    if (typeof c !== 'object' || c.mandatory || c.optional) {\n      return c;\n    }\n    const cc = {};\n    Object.keys(c).forEach(key => {\n      if (key === 'require' || key === 'advanced' || key === 'mediaSource') {\n        return;\n      }\n      const r = (typeof c[key] === 'object') ? c[key] : {ideal: c[key]};\n      if (r.exact !== undefined && typeof r.exact === 'number') {\n        r.min = r.max = r.exact;\n      }\n      const oldname_ = function(prefix, name) {\n        if (prefix) {\n          return prefix + name.charAt(0).toUpperCase() + name.slice(1);\n        }\n        return (name === 'deviceId') ? 'sourceId' : name;\n      };\n      if (r.ideal !== undefined) {\n        cc.optional = cc.optional || [];\n        let oc = {};\n        if (typeof r.ideal === 'number') {\n          oc[oldname_('min', key)] = r.ideal;\n          cc.optional.push(oc);\n          oc = {};\n          oc[oldname_('max', key)] = r.ideal;\n          cc.optional.push(oc);\n        } else {\n          oc[oldname_('', key)] = r.ideal;\n          cc.optional.push(oc);\n        }\n      }\n      if (r.exact !== undefined && typeof r.exact !== 'number') {\n        cc.mandatory = cc.mandatory || {};\n        cc.mandatory[oldname_('', key)] = r.exact;\n      } else {\n        ['min', 'max'].forEach(mix => {\n          if (r[mix] !== undefined) {\n            cc.mandatory = cc.mandatory || {};\n            cc.mandatory[oldname_(mix, key)] = r[mix];\n          }\n        });\n      }\n    });\n    if (c.advanced) {\n      cc.optional = (cc.optional || []).concat(c.advanced);\n    }\n    return cc;\n  };\n\n  const shimConstraints_ = function(constraints, func) {\n    if (browserDetails.version >= 61) {\n      return func(constraints);\n    }\n    constraints = JSON.parse(JSON.stringify(constraints));\n    if (constraints && typeof constraints.audio === 'object') {\n      const remap = function(obj, a, b) {\n        if (a in obj && !(b in obj)) {\n          obj[b] = obj[a];\n          delete obj[a];\n        }\n      };\n      constraints = JSON.parse(JSON.stringify(constraints));\n      remap(constraints.audio, 'autoGainControl', 'googAutoGainControl');\n      remap(constraints.audio, 'noiseSuppression', 'googNoiseSuppression');\n      constraints.audio = constraintsToChrome_(constraints.audio);\n    }\n    if (constraints && typeof constraints.video === 'object') {\n      // Shim facingMode for mobile & surface pro.\n      let face = constraints.video.facingMode;\n      face = face && ((typeof face === 'object') ? face : {ideal: face});\n      const getSupportedFacingModeLies = browserDetails.version < 66;\n\n      if ((face && (face.exact === 'user' || face.exact === 'environment' ||\n                    face.ideal === 'user' || face.ideal === 'environment')) &&\n          !(navigator.mediaDevices.getSupportedConstraints &&\n            navigator.mediaDevices.getSupportedConstraints().facingMode &&\n            !getSupportedFacingModeLies)) {\n        delete constraints.video.facingMode;\n        let matches;\n        if (face.exact === 'environment' || face.ideal === 'environment') {\n          matches = ['back', 'rear'];\n        } else if (face.exact === 'user' || face.ideal === 'user') {\n          matches = ['front'];\n        }\n        if (matches) {\n          // Look for matches in label, or use last cam for back (typical).\n          return navigator.mediaDevices.enumerateDevices()\n          .then(devices => {\n            devices = devices.filter(d => d.kind === 'videoinput');\n            let dev = devices.find(d => matches.some(match =>\n              d.label.toLowerCase().includes(match)));\n            if (!dev && devices.length && matches.includes('back')) {\n              dev = devices[devices.length - 1]; // more likely the back cam\n            }\n            if (dev) {\n              constraints.video.deviceId = face.exact ? {exact: dev.deviceId} :\n                                                        {ideal: dev.deviceId};\n            }\n            constraints.video = constraintsToChrome_(constraints.video);\n            logging('chrome: ' + JSON.stringify(constraints));\n            return func(constraints);\n          });\n        }\n      }\n      constraints.video = constraintsToChrome_(constraints.video);\n    }\n    logging('chrome: ' + JSON.stringify(constraints));\n    return func(constraints);\n  };\n\n  const shimError_ = function(e) {\n    if (browserDetails.version >= 64) {\n      return e;\n    }\n    return {\n      name: {\n        PermissionDeniedError: 'NotAllowedError',\n        PermissionDismissedError: 'NotAllowedError',\n        InvalidStateError: 'NotAllowedError',\n        DevicesNotFoundError: 'NotFoundError',\n        ConstraintNotSatisfiedError: 'OverconstrainedError',\n        TrackStartError: 'NotReadableError',\n        MediaDeviceFailedDueToShutdown: 'NotAllowedError',\n        MediaDeviceKillSwitchOn: 'NotAllowedError',\n        TabCaptureError: 'AbortError',\n        ScreenCaptureError: 'AbortError',\n        DeviceCaptureError: 'AbortError'\n      }[e.name] || e.name,\n      message: e.message,\n      constraint: e.constraint || e.constraintName,\n      toString() {\n        return this.name + (this.message && ': ') + this.message;\n      }\n    };\n  };\n\n  const getUserMedia_ = function(constraints, onSuccess, onError) {\n    shimConstraints_(constraints, c => {\n      navigator.webkitGetUserMedia(c, onSuccess, e => {\n        if (onError) {\n          onError(shimError_(e));\n        }\n      });\n    });\n  };\n  navigator.getUserMedia = getUserMedia_.bind(navigator);\n\n  // Even though Chrome 45 has navigator.mediaDevices and a getUserMedia\n  // function which returns a Promise, it does not accept spec-style\n  // constraints.\n  if (navigator.mediaDevices.getUserMedia) {\n    const origGetUserMedia = navigator.mediaDevices.getUserMedia.\n        bind(navigator.mediaDevices);\n    navigator.mediaDevices.getUserMedia = function(cs) {\n      return shimConstraints_(cs, c => origGetUserMedia(c).then(stream => {\n        if (c.audio && !stream.getAudioTracks().length ||\n            c.video && !stream.getVideoTracks().length) {\n          stream.getTracks().forEach(track => {\n            track.stop();\n          });\n          throw new DOMException('', 'NotFoundError');\n        }\n        return stream;\n      }, e => Promise.reject(shimError_(e))));\n    };\n  }\n}\n","/*\n *  Copyright (c) 2018 The adapter.js project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n'use strict';\nexport function shimGetDisplayMedia(window, getSourceId) {\n  if (window.navigator.mediaDevices &&\n    'getDisplayMedia' in window.navigator.mediaDevices) {\n    return;\n  }\n  if (!(window.navigator.mediaDevices)) {\n    return;\n  }\n  // getSourceId is a function that returns a promise resolving with\n  // the sourceId of the screen/window/tab to be shared.\n  if (typeof getSourceId !== 'function') {\n    console.error('shimGetDisplayMedia: getSourceId argument is not ' +\n        'a function');\n    return;\n  }\n  window.navigator.mediaDevices.getDisplayMedia =\n    function getDisplayMedia(constraints) {\n      return getSourceId(constraints)\n        .then(sourceId => {\n          const widthSpecified = constraints.video && constraints.video.width;\n          const heightSpecified = constraints.video &&\n            constraints.video.height;\n          const frameRateSpecified = constraints.video &&\n            constraints.video.frameRate;\n          constraints.video = {\n            mandatory: {\n              chromeMediaSource: 'desktop',\n              chromeMediaSourceId: sourceId,\n              maxFrameRate: frameRateSpecified || 3\n            }\n          };\n          if (widthSpecified) {\n            constraints.video.mandatory.maxWidth = widthSpecified;\n          }\n          if (heightSpecified) {\n            constraints.video.mandatory.maxHeight = heightSpecified;\n          }\n          return window.navigator.mediaDevices.getUserMedia(constraints);\n        });\n    };\n}\n","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\nimport * as utils from '../utils.js';\n\nexport {shimGetUserMedia} from './getusermedia';\nexport {shimGetDisplayMedia} from './getdisplaymedia';\n\nexport function shimMediaStream(window) {\n  window.MediaStream = window.MediaStream || window.webkitMediaStream;\n}\n\nexport function shimOnTrack(window) {\n  if (typeof window === 'object' && window.RTCPeerConnection && !('ontrack' in\n      window.RTCPeerConnection.prototype)) {\n    Object.defineProperty(window.RTCPeerConnection.prototype, 'ontrack', {\n      get() {\n        return this._ontrack;\n      },\n      set(f) {\n        if (this._ontrack) {\n          this.removeEventListener('track', this._ontrack);\n        }\n        this.addEventListener('track', this._ontrack = f);\n      },\n      enumerable: true,\n      configurable: true\n    });\n    const origSetRemoteDescription =\n        window.RTCPeerConnection.prototype.setRemoteDescription;\n    window.RTCPeerConnection.prototype.setRemoteDescription =\n      function setRemoteDescription() {\n        if (!this._ontrackpoly) {\n          this._ontrackpoly = (e) => {\n            // onaddstream does not fire when a track is added to an existing\n            // stream. But stream.onaddtrack is implemented so we use that.\n            e.stream.addEventListener('addtrack', te => {\n              let receiver;\n              if (window.RTCPeerConnection.prototype.getReceivers) {\n                receiver = this.getReceivers()\n                  .find(r => r.track && r.track.id === te.track.id);\n              } else {\n                receiver = {track: te.track};\n              }\n\n              const event = new Event('track');\n              event.track = te.track;\n              event.receiver = receiver;\n              event.transceiver = {receiver};\n              event.streams = [e.stream];\n              this.dispatchEvent(event);\n            });\n            e.stream.getTracks().forEach(track => {\n              let receiver;\n              if (window.RTCPeerConnection.prototype.getReceivers) {\n                receiver = this.getReceivers()\n                  .find(r => r.track && r.track.id === track.id);\n              } else {\n                receiver = {track};\n              }\n              const event = new Event('track');\n              event.track = track;\n              event.receiver = receiver;\n              event.transceiver = {receiver};\n              event.streams = [e.stream];\n              this.dispatchEvent(event);\n            });\n          };\n          this.addEventListener('addstream', this._ontrackpoly);\n        }\n        return origSetRemoteDescription.apply(this, arguments);\n      };\n  } else {\n    // even if RTCRtpTransceiver is in window, it is only used and\n    // emitted in unified-plan. Unfortunately this means we need\n    // to unconditionally wrap the event.\n    utils.wrapPeerConnectionEvent(window, 'track', e => {\n      if (!e.transceiver) {\n        Object.defineProperty(e, 'transceiver',\n          {value: {receiver: e.receiver}});\n      }\n      return e;\n    });\n  }\n}\n\nexport function shimGetSendersWithDtmf(window) {\n  // Overrides addTrack/removeTrack, depends on shimAddTrackRemoveTrack.\n  if (typeof window === 'object' && window.RTCPeerConnection &&\n      !('getSenders' in window.RTCPeerConnection.prototype) &&\n      'createDTMFSender' in window.RTCPeerConnection.prototype) {\n    const shimSenderWithDtmf = function(pc, track) {\n      return {\n        track,\n        get dtmf() {\n          if (this._dtmf === undefined) {\n            if (track.kind === 'audio') {\n              this._dtmf = pc.createDTMFSender(track);\n            } else {\n              this._dtmf = null;\n            }\n          }\n          return this._dtmf;\n        },\n        _pc: pc\n      };\n    };\n\n    // augment addTrack when getSenders is not available.\n    if (!window.RTCPeerConnection.prototype.getSenders) {\n      window.RTCPeerConnection.prototype.getSenders = function getSenders() {\n        this._senders = this._senders || [];\n        return this._senders.slice(); // return a copy of the internal state.\n      };\n      const origAddTrack = window.RTCPeerConnection.prototype.addTrack;\n      window.RTCPeerConnection.prototype.addTrack =\n        function addTrack(track, stream) {\n          let sender = origAddTrack.apply(this, arguments);\n          if (!sender) {\n            sender = shimSenderWithDtmf(this, track);\n            this._senders.push(sender);\n          }\n          return sender;\n        };\n\n      const origRemoveTrack = window.RTCPeerConnection.prototype.removeTrack;\n      window.RTCPeerConnection.prototype.removeTrack =\n        function removeTrack(sender) {\n          origRemoveTrack.apply(this, arguments);\n          const idx = this._senders.indexOf(sender);\n          if (idx !== -1) {\n            this._senders.splice(idx, 1);\n          }\n        };\n    }\n    const origAddStream = window.RTCPeerConnection.prototype.addStream;\n    window.RTCPeerConnection.prototype.addStream = function addStream(stream) {\n      this._senders = this._senders || [];\n      origAddStream.apply(this, [stream]);\n      stream.getTracks().forEach(track => {\n        this._senders.push(shimSenderWithDtmf(this, track));\n      });\n    };\n\n    const origRemoveStream = window.RTCPeerConnection.prototype.removeStream;\n    window.RTCPeerConnection.prototype.removeStream =\n      function removeStream(stream) {\n        this._senders = this._senders || [];\n        origRemoveStream.apply(this, [stream]);\n\n        stream.getTracks().forEach(track => {\n          const sender = this._senders.find(s => s.track === track);\n          if (sender) { // remove sender\n            this._senders.splice(this._senders.indexOf(sender), 1);\n          }\n        });\n      };\n  } else if (typeof window === 'object' && window.RTCPeerConnection &&\n             'getSenders' in window.RTCPeerConnection.prototype &&\n             'createDTMFSender' in window.RTCPeerConnection.prototype &&\n             window.RTCRtpSender &&\n             !('dtmf' in window.RTCRtpSender.prototype)) {\n    const origGetSenders = window.RTCPeerConnection.prototype.getSenders;\n    window.RTCPeerConnection.prototype.getSenders = function getSenders() {\n      const senders = origGetSenders.apply(this, []);\n      senders.forEach(sender => sender._pc = this);\n      return senders;\n    };\n\n    Object.defineProperty(window.RTCRtpSender.prototype, 'dtmf', {\n      get() {\n        if (this._dtmf === undefined) {\n          if (this.track.kind === 'audio') {\n            this._dtmf = this._pc.createDTMFSender(this.track);\n          } else {\n            this._dtmf = null;\n          }\n        }\n        return this._dtmf;\n      }\n    });\n  }\n}\n\nexport function shimGetStats(window) {\n  if (!window.RTCPeerConnection) {\n    return;\n  }\n\n  const origGetStats = window.RTCPeerConnection.prototype.getStats;\n  window.RTCPeerConnection.prototype.getStats = function getStats() {\n    const [selector, onSucc, onErr] = arguments;\n\n    // If selector is a function then we are in the old style stats so just\n    // pass back the original getStats format to avoid breaking old users.\n    if (arguments.length > 0 && typeof selector === 'function') {\n      return origGetStats.apply(this, arguments);\n    }\n\n    // When spec-style getStats is supported, return those when called with\n    // either no arguments or the selector argument is null.\n    if (origGetStats.length === 0 && (arguments.length === 0 ||\n        typeof selector !== 'function')) {\n      return origGetStats.apply(this, []);\n    }\n\n    const fixChromeStats_ = function(response) {\n      const standardReport = {};\n      const reports = response.result();\n      reports.forEach(report => {\n        const standardStats = {\n          id: report.id,\n          timestamp: report.timestamp,\n          type: {\n            localcandidate: 'local-candidate',\n            remotecandidate: 'remote-candidate'\n          }[report.type] || report.type\n        };\n        report.names().forEach(name => {\n          standardStats[name] = report.stat(name);\n        });\n        standardReport[standardStats.id] = standardStats;\n      });\n\n      return standardReport;\n    };\n\n    // shim getStats with maplike support\n    const makeMapStats = function(stats) {\n      return new Map(Object.keys(stats).map(key => [key, stats[key]]));\n    };\n\n    if (arguments.length >= 2) {\n      const successCallbackWrapper_ = function(response) {\n        onSucc(makeMapStats(fixChromeStats_(response)));\n      };\n\n      return origGetStats.apply(this, [successCallbackWrapper_,\n        selector]);\n    }\n\n    // promise-support\n    return new Promise((resolve, reject) => {\n      origGetStats.apply(this, [\n        function(response) {\n          resolve(makeMapStats(fixChromeStats_(response)));\n        }, reject]);\n    }).then(onSucc, onErr);\n  };\n}\n\nexport function shimSenderReceiverGetStats(window) {\n  if (!(typeof window === 'object' && window.RTCPeerConnection &&\n      window.RTCRtpSender && window.RTCRtpReceiver)) {\n    return;\n  }\n\n  // shim sender stats.\n  if (!('getStats' in window.RTCRtpSender.prototype)) {\n    const origGetSenders = window.RTCPeerConnection.prototype.getSenders;\n    if (origGetSenders) {\n      window.RTCPeerConnection.prototype.getSenders = function getSenders() {\n        const senders = origGetSenders.apply(this, []);\n        senders.forEach(sender => sender._pc = this);\n        return senders;\n      };\n    }\n\n    const origAddTrack = window.RTCPeerConnection.prototype.addTrack;\n    if (origAddTrack) {\n      window.RTCPeerConnection.prototype.addTrack = function addTrack() {\n        const sender = origAddTrack.apply(this, arguments);\n        sender._pc = this;\n        return sender;\n      };\n    }\n    window.RTCRtpSender.prototype.getStats = function getStats() {\n      const sender = this;\n      return this._pc.getStats().then(result =>\n        /* Note: this will include stats of all senders that\n         *   send a track with the same id as sender.track as\n         *   it is not possible to identify the RTCRtpSender.\n         */\n        utils.filterStats(result, sender.track, true));\n    };\n  }\n\n  // shim receiver stats.\n  if (!('getStats' in window.RTCRtpReceiver.prototype)) {\n    const origGetReceivers = window.RTCPeerConnection.prototype.getReceivers;\n    if (origGetReceivers) {\n      window.RTCPeerConnection.prototype.getReceivers =\n        function getReceivers() {\n          const receivers = origGetReceivers.apply(this, []);\n          receivers.forEach(receiver => receiver._pc = this);\n          return receivers;\n        };\n    }\n    utils.wrapPeerConnectionEvent(window, 'track', e => {\n      e.receiver._pc = e.srcElement;\n      return e;\n    });\n    window.RTCRtpReceiver.prototype.getStats = function getStats() {\n      const receiver = this;\n      return this._pc.getStats().then(result =>\n        utils.filterStats(result, receiver.track, false));\n    };\n  }\n\n  if (!('getStats' in window.RTCRtpSender.prototype &&\n      'getStats' in window.RTCRtpReceiver.prototype)) {\n    return;\n  }\n\n  // shim RTCPeerConnection.getStats(track).\n  const origGetStats = window.RTCPeerConnection.prototype.getStats;\n  window.RTCPeerConnection.prototype.getStats = function getStats() {\n    if (arguments.length > 0 &&\n        arguments[0] instanceof window.MediaStreamTrack) {\n      const track = arguments[0];\n      let sender;\n      let receiver;\n      let err;\n      this.getSenders().forEach(s => {\n        if (s.track === track) {\n          if (sender) {\n            err = true;\n          } else {\n            sender = s;\n          }\n        }\n      });\n      this.getReceivers().forEach(r => {\n        if (r.track === track) {\n          if (receiver) {\n            err = true;\n          } else {\n            receiver = r;\n          }\n        }\n        return r.track === track;\n      });\n      if (err || (sender && receiver)) {\n        return Promise.reject(new DOMException(\n          'There are more than one sender or receiver for the track.',\n          'InvalidAccessError'));\n      } else if (sender) {\n        return sender.getStats();\n      } else if (receiver) {\n        return receiver.getStats();\n      }\n      return Promise.reject(new DOMException(\n        'There is no sender or receiver for the track.',\n        'InvalidAccessError'));\n    }\n    return origGetStats.apply(this, arguments);\n  };\n}\n\nexport function shimAddTrackRemoveTrackWithNative(window) {\n  // shim addTrack/removeTrack with native variants in order to make\n  // the interactions with legacy getLocalStreams behave as in other browsers.\n  // Keeps a mapping stream.id => [stream, rtpsenders...]\n  window.RTCPeerConnection.prototype.getLocalStreams =\n    function getLocalStreams() {\n      this._shimmedLocalStreams = this._shimmedLocalStreams || {};\n      return Object.keys(this._shimmedLocalStreams)\n        .map(streamId => this._shimmedLocalStreams[streamId][0]);\n    };\n\n  const origAddTrack = window.RTCPeerConnection.prototype.addTrack;\n  window.RTCPeerConnection.prototype.addTrack =\n    function addTrack(track, stream) {\n      if (!stream) {\n        return origAddTrack.apply(this, arguments);\n      }\n      this._shimmedLocalStreams = this._shimmedLocalStreams || {};\n\n      const sender = origAddTrack.apply(this, arguments);\n      if (!this._shimmedLocalStreams[stream.id]) {\n        this._shimmedLocalStreams[stream.id] = [stream, sender];\n      } else if (this._shimmedLocalStreams[stream.id].indexOf(sender) === -1) {\n        this._shimmedLocalStreams[stream.id].push(sender);\n      }\n      return sender;\n    };\n\n  const origAddStream = window.RTCPeerConnection.prototype.addStream;\n  window.RTCPeerConnection.prototype.addStream = function addStream(stream) {\n    this._shimmedLocalStreams = this._shimmedLocalStreams || {};\n\n    stream.getTracks().forEach(track => {\n      const alreadyExists = this.getSenders().find(s => s.track === track);\n      if (alreadyExists) {\n        throw new DOMException('Track already exists.',\n            'InvalidAccessError');\n      }\n    });\n    const existingSenders = this.getSenders();\n    origAddStream.apply(this, arguments);\n    const newSenders = this.getSenders()\n      .filter(newSender => existingSenders.indexOf(newSender) === -1);\n    this._shimmedLocalStreams[stream.id] = [stream].concat(newSenders);\n  };\n\n  const origRemoveStream = window.RTCPeerConnection.prototype.removeStream;\n  window.RTCPeerConnection.prototype.removeStream =\n    function removeStream(stream) {\n      this._shimmedLocalStreams = this._shimmedLocalStreams || {};\n      delete this._shimmedLocalStreams[stream.id];\n      return origRemoveStream.apply(this, arguments);\n    };\n\n  const origRemoveTrack = window.RTCPeerConnection.prototype.removeTrack;\n  window.RTCPeerConnection.prototype.removeTrack =\n    function removeTrack(sender) {\n      this._shimmedLocalStreams = this._shimmedLocalStreams || {};\n      if (sender) {\n        Object.keys(this._shimmedLocalStreams).forEach(streamId => {\n          const idx = this._shimmedLocalStreams[streamId].indexOf(sender);\n          if (idx !== -1) {\n            this._shimmedLocalStreams[streamId].splice(idx, 1);\n          }\n          if (this._shimmedLocalStreams[streamId].length === 1) {\n            delete this._shimmedLocalStreams[streamId];\n          }\n        });\n      }\n      return origRemoveTrack.apply(this, arguments);\n    };\n}\n\nexport function shimAddTrackRemoveTrack(window, browserDetails) {\n  if (!window.RTCPeerConnection) {\n    return;\n  }\n  // shim addTrack and removeTrack.\n  if (window.RTCPeerConnection.prototype.addTrack &&\n      browserDetails.version >= 65) {\n    return shimAddTrackRemoveTrackWithNative(window);\n  }\n\n  // also shim pc.getLocalStreams when addTrack is shimmed\n  // to return the original streams.\n  const origGetLocalStreams = window.RTCPeerConnection.prototype\n      .getLocalStreams;\n  window.RTCPeerConnection.prototype.getLocalStreams =\n    function getLocalStreams() {\n      const nativeStreams = origGetLocalStreams.apply(this);\n      this._reverseStreams = this._reverseStreams || {};\n      return nativeStreams.map(stream => this._reverseStreams[stream.id]);\n    };\n\n  const origAddStream = window.RTCPeerConnection.prototype.addStream;\n  window.RTCPeerConnection.prototype.addStream = function addStream(stream) {\n    this._streams = this._streams || {};\n    this._reverseStreams = this._reverseStreams || {};\n\n    stream.getTracks().forEach(track => {\n      const alreadyExists = this.getSenders().find(s => s.track === track);\n      if (alreadyExists) {\n        throw new DOMException('Track already exists.',\n            'InvalidAccessError');\n      }\n    });\n    // Add identity mapping for consistency with addTrack.\n    // Unless this is being used with a stream from addTrack.\n    if (!this._reverseStreams[stream.id]) {\n      const newStream = new window.MediaStream(stream.getTracks());\n      this._streams[stream.id] = newStream;\n      this._reverseStreams[newStream.id] = stream;\n      stream = newStream;\n    }\n    origAddStream.apply(this, [stream]);\n  };\n\n  const origRemoveStream = window.RTCPeerConnection.prototype.removeStream;\n  window.RTCPeerConnection.prototype.removeStream =\n    function removeStream(stream) {\n      this._streams = this._streams || {};\n      this._reverseStreams = this._reverseStreams || {};\n\n      origRemoveStream.apply(this, [(this._streams[stream.id] || stream)]);\n      delete this._reverseStreams[(this._streams[stream.id] ?\n          this._streams[stream.id].id : stream.id)];\n      delete this._streams[stream.id];\n    };\n\n  window.RTCPeerConnection.prototype.addTrack =\n    function addTrack(track, stream) {\n      if (this.signalingState === 'closed') {\n        throw new DOMException(\n          'The RTCPeerConnection\\'s signalingState is \\'closed\\'.',\n          'InvalidStateError');\n      }\n      const streams = [].slice.call(arguments, 1);\n      if (streams.length !== 1 ||\n          !streams[0].getTracks().find(t => t === track)) {\n        // this is not fully correct but all we can manage without\n        // [[associated MediaStreams]] internal slot.\n        throw new DOMException(\n          'The adapter.js addTrack polyfill only supports a single ' +\n          ' stream which is associated with the specified track.',\n          'NotSupportedError');\n      }\n\n      const alreadyExists = this.getSenders().find(s => s.track === track);\n      if (alreadyExists) {\n        throw new DOMException('Track already exists.',\n            'InvalidAccessError');\n      }\n\n      this._streams = this._streams || {};\n      this._reverseStreams = this._reverseStreams || {};\n      const oldStream = this._streams[stream.id];\n      if (oldStream) {\n        // this is using odd Chrome behaviour, use with caution:\n        // https://bugs.chromium.org/p/webrtc/issues/detail?id=7815\n        // Note: we rely on the high-level addTrack/dtmf shim to\n        // create the sender with a dtmf sender.\n        oldStream.addTrack(track);\n\n        // Trigger ONN async.\n        Promise.resolve().then(() => {\n          this.dispatchEvent(new Event('negotiationneeded'));\n        });\n      } else {\n        const newStream = new window.MediaStream([track]);\n        this._streams[stream.id] = newStream;\n        this._reverseStreams[newStream.id] = stream;\n        this.addStream(newStream);\n      }\n      return this.getSenders().find(s => s.track === track);\n    };\n\n  // replace the internal stream id with the external one and\n  // vice versa.\n  function replaceInternalStreamId(pc, description) {\n    let sdp = description.sdp;\n    Object.keys(pc._reverseStreams || []).forEach(internalId => {\n      const externalStream = pc._reverseStreams[internalId];\n      const internalStream = pc._streams[externalStream.id];\n      sdp = sdp.replace(new RegExp(internalStream.id, 'g'),\n          externalStream.id);\n    });\n    return new RTCSessionDescription({\n      type: description.type,\n      sdp\n    });\n  }\n  function replaceExternalStreamId(pc, description) {\n    let sdp = description.sdp;\n    Object.keys(pc._reverseStreams || []).forEach(internalId => {\n      const externalStream = pc._reverseStreams[internalId];\n      const internalStream = pc._streams[externalStream.id];\n      sdp = sdp.replace(new RegExp(externalStream.id, 'g'),\n          internalStream.id);\n    });\n    return new RTCSessionDescription({\n      type: description.type,\n      sdp\n    });\n  }\n  ['createOffer', 'createAnswer'].forEach(function(method) {\n    const nativeMethod = window.RTCPeerConnection.prototype[method];\n    const methodObj = {[method]() {\n      const args = arguments;\n      const isLegacyCall = arguments.length &&\n          typeof arguments[0] === 'function';\n      if (isLegacyCall) {\n        return nativeMethod.apply(this, [\n          (description) => {\n            const desc = replaceInternalStreamId(this, description);\n            args[0].apply(null, [desc]);\n          },\n          (err) => {\n            if (args[1]) {\n              args[1].apply(null, err);\n            }\n          }, arguments[2]\n        ]);\n      }\n      return nativeMethod.apply(this, arguments)\n      .then(description => replaceInternalStreamId(this, description));\n    }};\n    window.RTCPeerConnection.prototype[method] = methodObj[method];\n  });\n\n  const origSetLocalDescription =\n      window.RTCPeerConnection.prototype.setLocalDescription;\n  window.RTCPeerConnection.prototype.setLocalDescription =\n    function setLocalDescription() {\n      if (!arguments.length || !arguments[0].type) {\n        return origSetLocalDescription.apply(this, arguments);\n      }\n      arguments[0] = replaceExternalStreamId(this, arguments[0]);\n      return origSetLocalDescription.apply(this, arguments);\n    };\n\n  // TODO: mangle getStats: https://w3c.github.io/webrtc-stats/#dom-rtcmediastreamstats-streamidentifier\n\n  const origLocalDescription = Object.getOwnPropertyDescriptor(\n      window.RTCPeerConnection.prototype, 'localDescription');\n  Object.defineProperty(window.RTCPeerConnection.prototype,\n      'localDescription', {\n        get() {\n          const description = origLocalDescription.get.apply(this);\n          if (description.type === '') {\n            return description;\n          }\n          return replaceInternalStreamId(this, description);\n        }\n      });\n\n  window.RTCPeerConnection.prototype.removeTrack =\n    function removeTrack(sender) {\n      if (this.signalingState === 'closed') {\n        throw new DOMException(\n          'The RTCPeerConnection\\'s signalingState is \\'closed\\'.',\n          'InvalidStateError');\n      }\n      // We can not yet check for sender instanceof RTCRtpSender\n      // since we shim RTPSender. So we check if sender._pc is set.\n      if (!sender._pc) {\n        throw new DOMException('Argument 1 of RTCPeerConnection.removeTrack ' +\n            'does not implement interface RTCRtpSender.', 'TypeError');\n      }\n      const isLocal = sender._pc === this;\n      if (!isLocal) {\n        throw new DOMException('Sender was not created by this connection.',\n            'InvalidAccessError');\n      }\n\n      // Search for the native stream the senders track belongs to.\n      this._streams = this._streams || {};\n      let stream;\n      Object.keys(this._streams).forEach(streamid => {\n        const hasTrack = this._streams[streamid].getTracks()\n          .find(track => sender.track === track);\n        if (hasTrack) {\n          stream = this._streams[streamid];\n        }\n      });\n\n      if (stream) {\n        if (stream.getTracks().length === 1) {\n          // if this is the last track of the stream, remove the stream. This\n          // takes care of any shimmed _senders.\n          this.removeStream(this._reverseStreams[stream.id]);\n        } else {\n          // relying on the same odd chrome behaviour as above.\n          stream.removeTrack(sender.track);\n        }\n        this.dispatchEvent(new Event('negotiationneeded'));\n      }\n    };\n}\n\nexport function shimPeerConnection(window, browserDetails) {\n  if (!window.RTCPeerConnection && window.webkitRTCPeerConnection) {\n    // very basic support for old versions.\n    window.RTCPeerConnection = window.webkitRTCPeerConnection;\n  }\n  if (!window.RTCPeerConnection) {\n    return;\n  }\n\n  // shim implicit creation of RTCSessionDescription/RTCIceCandidate\n  if (browserDetails.version < 53) {\n    ['setLocalDescription', 'setRemoteDescription', 'addIceCandidate']\n        .forEach(function(method) {\n          const nativeMethod = window.RTCPeerConnection.prototype[method];\n          const methodObj = {[method]() {\n            arguments[0] = new ((method === 'addIceCandidate') ?\n                window.RTCIceCandidate :\n                window.RTCSessionDescription)(arguments[0]);\n            return nativeMethod.apply(this, arguments);\n          }};\n          window.RTCPeerConnection.prototype[method] = methodObj[method];\n        });\n  }\n}\n\n// Attempt to fix ONN in plan-b mode.\nexport function fixNegotiationNeeded(window, browserDetails) {\n  utils.wrapPeerConnectionEvent(window, 'negotiationneeded', e => {\n    const pc = e.target;\n    if (browserDetails.version < 72 || (pc.getConfiguration &&\n        pc.getConfiguration().sdpSemantics === 'plan-b')) {\n      if (pc.signalingState !== 'stable') {\n        return;\n      }\n    }\n    return e;\n  });\n}\n","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n'use strict';\n\nimport * as utils from '../utils';\n\nexport function shimGetUserMedia(window, browserDetails) {\n  const navigator = window && window.navigator;\n  const MediaStreamTrack = window && window.MediaStreamTrack;\n\n  navigator.getUserMedia = function(constraints, onSuccess, onError) {\n    // Replace Firefox 44+'s deprecation warning with unprefixed version.\n    utils.deprecated('navigator.getUserMedia',\n        'navigator.mediaDevices.getUserMedia');\n    navigator.mediaDevices.getUserMedia(constraints).then(onSuccess, onError);\n  };\n\n  if (!(browserDetails.version > 55 &&\n      'autoGainControl' in navigator.mediaDevices.getSupportedConstraints())) {\n    const remap = function(obj, a, b) {\n      if (a in obj && !(b in obj)) {\n        obj[b] = obj[a];\n        delete obj[a];\n      }\n    };\n\n    const nativeGetUserMedia = navigator.mediaDevices.getUserMedia.\n        bind(navigator.mediaDevices);\n    navigator.mediaDevices.getUserMedia = function(c) {\n      if (typeof c === 'object' && typeof c.audio === 'object') {\n        c = JSON.parse(JSON.stringify(c));\n        remap(c.audio, 'autoGainControl', 'mozAutoGainControl');\n        remap(c.audio, 'noiseSuppression', 'mozNoiseSuppression');\n      }\n      return nativeGetUserMedia(c);\n    };\n\n    if (MediaStreamTrack && MediaStreamTrack.prototype.getSettings) {\n      const nativeGetSettings = MediaStreamTrack.prototype.getSettings;\n      MediaStreamTrack.prototype.getSettings = function() {\n        const obj = nativeGetSettings.apply(this, arguments);\n        remap(obj, 'mozAutoGainControl', 'autoGainControl');\n        remap(obj, 'mozNoiseSuppression', 'noiseSuppression');\n        return obj;\n      };\n    }\n\n    if (MediaStreamTrack && MediaStreamTrack.prototype.applyConstraints) {\n      const nativeApplyConstraints =\n        MediaStreamTrack.prototype.applyConstraints;\n      MediaStreamTrack.prototype.applyConstraints = function(c) {\n        if (this.kind === 'audio' && typeof c === 'object') {\n          c = JSON.parse(JSON.stringify(c));\n          remap(c, 'autoGainControl', 'mozAutoGainControl');\n          remap(c, 'noiseSuppression', 'mozNoiseSuppression');\n        }\n        return nativeApplyConstraints.apply(this, [c]);\n      };\n    }\n  }\n}\n","/*\n *  Copyright (c) 2018 The adapter.js project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n'use strict';\n\nexport function shimGetDisplayMedia(window, preferredMediaSource) {\n  if (window.navigator.mediaDevices &&\n    'getDisplayMedia' in window.navigator.mediaDevices) {\n    return;\n  }\n  if (!(window.navigator.mediaDevices)) {\n    return;\n  }\n  window.navigator.mediaDevices.getDisplayMedia =\n    function getDisplayMedia(constraints) {\n      if (!(constraints && constraints.video)) {\n        const err = new DOMException('getDisplayMedia without video ' +\n            'constraints is undefined');\n        err.name = 'NotFoundError';\n        // from https://heycam.github.io/webidl/#idl-DOMException-error-names\n        err.code = 8;\n        return Promise.reject(err);\n      }\n      if (constraints.video === true) {\n        constraints.video = {mediaSource: preferredMediaSource};\n      } else {\n        constraints.video.mediaSource = preferredMediaSource;\n      }\n      return window.navigator.mediaDevices.getUserMedia(constraints);\n    };\n}\n","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n'use strict';\n\nimport * as utils from '../utils';\nexport {shimGetUserMedia} from './getusermedia';\nexport {shimGetDisplayMedia} from './getdisplaymedia';\n\nexport function shimOnTrack(window) {\n  if (typeof window === 'object' && window.RTCTrackEvent &&\n      ('receiver' in window.RTCTrackEvent.prototype) &&\n      !('transceiver' in window.RTCTrackEvent.prototype)) {\n    Object.defineProperty(window.RTCTrackEvent.prototype, 'transceiver', {\n      get() {\n        return {receiver: this.receiver};\n      }\n    });\n  }\n}\n\nexport function shimPeerConnection(window, browserDetails) {\n  if (typeof window !== 'object' ||\n      !(window.RTCPeerConnection || window.mozRTCPeerConnection)) {\n    return; // probably media.peerconnection.enabled=false in about:config\n  }\n  if (!window.RTCPeerConnection && window.mozRTCPeerConnection) {\n    // very basic support for old versions.\n    window.RTCPeerConnection = window.mozRTCPeerConnection;\n  }\n\n  if (browserDetails.version < 53) {\n    // shim away need for obsolete RTCIceCandidate/RTCSessionDescription.\n    ['setLocalDescription', 'setRemoteDescription', 'addIceCandidate']\n        .forEach(function(method) {\n          const nativeMethod = window.RTCPeerConnection.prototype[method];\n          const methodObj = {[method]() {\n            arguments[0] = new ((method === 'addIceCandidate') ?\n                window.RTCIceCandidate :\n                window.RTCSessionDescription)(arguments[0]);\n            return nativeMethod.apply(this, arguments);\n          }};\n          window.RTCPeerConnection.prototype[method] = methodObj[method];\n        });\n  }\n\n  const modernStatsTypes = {\n    inboundrtp: 'inbound-rtp',\n    outboundrtp: 'outbound-rtp',\n    candidatepair: 'candidate-pair',\n    localcandidate: 'local-candidate',\n    remotecandidate: 'remote-candidate'\n  };\n\n  const nativeGetStats = window.RTCPeerConnection.prototype.getStats;\n  window.RTCPeerConnection.prototype.getStats = function getStats() {\n    const [selector, onSucc, onErr] = arguments;\n    return nativeGetStats.apply(this, [selector || null])\n      .then(stats => {\n        if (browserDetails.version < 53 && !onSucc) {\n          // Shim only promise getStats with spec-hyphens in type names\n          // Leave callback version alone; misc old uses of forEach before Map\n          try {\n            stats.forEach(stat => {\n              stat.type = modernStatsTypes[stat.type] || stat.type;\n            });\n          } catch (e) {\n            if (e.name !== 'TypeError') {\n              throw e;\n            }\n            // Avoid TypeError: \"type\" is read-only, in old versions. 34-43ish\n            stats.forEach((stat, i) => {\n              stats.set(i, Object.assign({}, stat, {\n                type: modernStatsTypes[stat.type] || stat.type\n              }));\n            });\n          }\n        }\n        return stats;\n      })\n      .then(onSucc, onErr);\n  };\n}\n\nexport function shimSenderGetStats(window) {\n  if (!(typeof window === 'object' && window.RTCPeerConnection &&\n      window.RTCRtpSender)) {\n    return;\n  }\n  if (window.RTCRtpSender && 'getStats' in window.RTCRtpSender.prototype) {\n    return;\n  }\n  const origGetSenders = window.RTCPeerConnection.prototype.getSenders;\n  if (origGetSenders) {\n    window.RTCPeerConnection.prototype.getSenders = function getSenders() {\n      const senders = origGetSenders.apply(this, []);\n      senders.forEach(sender => sender._pc = this);\n      return senders;\n    };\n  }\n\n  const origAddTrack = window.RTCPeerConnection.prototype.addTrack;\n  if (origAddTrack) {\n    window.RTCPeerConnection.prototype.addTrack = function addTrack() {\n      const sender = origAddTrack.apply(this, arguments);\n      sender._pc = this;\n      return sender;\n    };\n  }\n  window.RTCRtpSender.prototype.getStats = function getStats() {\n    return this.track ? this._pc.getStats(this.track) :\n        Promise.resolve(new Map());\n  };\n}\n\nexport function shimReceiverGetStats(window) {\n  if (!(typeof window === 'object' && window.RTCPeerConnection &&\n      window.RTCRtpSender)) {\n    return;\n  }\n  if (window.RTCRtpSender && 'getStats' in window.RTCRtpReceiver.prototype) {\n    return;\n  }\n  const origGetReceivers = window.RTCPeerConnection.prototype.getReceivers;\n  if (origGetReceivers) {\n    window.RTCPeerConnection.prototype.getReceivers = function getReceivers() {\n      const receivers = origGetReceivers.apply(this, []);\n      receivers.forEach(receiver => receiver._pc = this);\n      return receivers;\n    };\n  }\n  utils.wrapPeerConnectionEvent(window, 'track', e => {\n    e.receiver._pc = e.srcElement;\n    return e;\n  });\n  window.RTCRtpReceiver.prototype.getStats = function getStats() {\n    return this._pc.getStats(this.track);\n  };\n}\n\nexport function shimRemoveStream(window) {\n  if (!window.RTCPeerConnection ||\n      'removeStream' in window.RTCPeerConnection.prototype) {\n    return;\n  }\n  window.RTCPeerConnection.prototype.removeStream =\n    function removeStream(stream) {\n      utils.deprecated('removeStream', 'removeTrack');\n      this.getSenders().forEach(sender => {\n        if (sender.track && stream.getTracks().includes(sender.track)) {\n          this.removeTrack(sender);\n        }\n      });\n    };\n}\n\nexport function shimRTCDataChannel(window) {\n  // rename DataChannel to RTCDataChannel (native fix in FF60):\n  // https://bugzilla.mozilla.org/show_bug.cgi?id=1173851\n  if (window.DataChannel && !window.RTCDataChannel) {\n    window.RTCDataChannel = window.DataChannel;\n  }\n}\n\nexport function shimAddTransceiver(window) {\n  // https://github.com/webrtcHacks/adapter/issues/998#issuecomment-516921647\n  // Firefox ignores the init sendEncodings options passed to addTransceiver\n  // https://bugzilla.mozilla.org/show_bug.cgi?id=1396918\n  if (!(typeof window === 'object' && window.RTCPeerConnection)) {\n    return;\n  }\n  const origAddTransceiver = window.RTCPeerConnection.prototype.addTransceiver;\n  if (origAddTransceiver) {\n    window.RTCPeerConnection.prototype.addTransceiver =\n      function addTransceiver() {\n        this.setParametersPromises = [];\n        const initParameters = arguments[1];\n        const shouldPerformCheck = initParameters &&\n                                  'sendEncodings' in initParameters;\n        if (shouldPerformCheck) {\n          // If sendEncodings params are provided, validate grammar\n          initParameters.sendEncodings.forEach((encodingParam) => {\n            if ('rid' in encodingParam) {\n              const ridRegex = /^[a-z0-9]{0,16}$/i;\n              if (!ridRegex.test(encodingParam.rid)) {\n                throw new TypeError('Invalid RID value provided.');\n              }\n            }\n            if ('scaleResolutionDownBy' in encodingParam) {\n              if (!(parseFloat(encodingParam.scaleResolutionDownBy) >= 1.0)) {\n                throw new RangeError('scale_resolution_down_by must be >= 1.0');\n              }\n            }\n            if ('maxFramerate' in encodingParam) {\n              if (!(parseFloat(encodingParam.maxFramerate) >= 0)) {\n                throw new RangeError('max_framerate must be >= 0.0');\n              }\n            }\n          });\n        }\n        const transceiver = origAddTransceiver.apply(this, arguments);\n        if (shouldPerformCheck) {\n          // Check if the init options were applied. If not we do this in an\n          // asynchronous way and save the promise reference in a global object.\n          // This is an ugly hack, but at the same time is way more robust than\n          // checking the sender parameters before and after the createOffer\n          // Also note that after the createoffer we are not 100% sure that\n          // the params were asynchronously applied so we might miss the\n          // opportunity to recreate offer.\n          const {sender} = transceiver;\n          const params = sender.getParameters();\n          if (!('encodings' in params) ||\n              // Avoid being fooled by patched getParameters() below.\n              (params.encodings.length === 1 &&\n               Object.keys(params.encodings[0]).length === 0)) {\n            params.encodings = initParameters.sendEncodings;\n            sender.sendEncodings = initParameters.sendEncodings;\n            this.setParametersPromises.push(sender.setParameters(params)\n              .then(() => {\n                delete sender.sendEncodings;\n              }).catch(() => {\n                delete sender.sendEncodings;\n              })\n            );\n          }\n        }\n        return transceiver;\n      };\n  }\n}\n\nexport function shimGetParameters(window) {\n  if (!(typeof window === 'object' && window.RTCRtpSender)) {\n    return;\n  }\n  const origGetParameters = window.RTCRtpSender.prototype.getParameters;\n  if (origGetParameters) {\n    window.RTCRtpSender.prototype.getParameters =\n      function getParameters() {\n        const params = origGetParameters.apply(this, arguments);\n        if (!('encodings' in params)) {\n          params.encodings = [].concat(this.sendEncodings || [{}]);\n        }\n        return params;\n      };\n  }\n}\n\nexport function shimCreateOffer(window) {\n  // https://github.com/webrtcHacks/adapter/issues/998#issuecomment-516921647\n  // Firefox ignores the init sendEncodings options passed to addTransceiver\n  // https://bugzilla.mozilla.org/show_bug.cgi?id=1396918\n  if (!(typeof window === 'object' && window.RTCPeerConnection)) {\n    return;\n  }\n  const origCreateOffer = window.RTCPeerConnection.prototype.createOffer;\n  window.RTCPeerConnection.prototype.createOffer = function createOffer() {\n    if (this.setParametersPromises && this.setParametersPromises.length) {\n      return Promise.all(this.setParametersPromises)\n      .then(() => {\n        return origCreateOffer.apply(this, arguments);\n      })\n      .finally(() => {\n        this.setParametersPromises = [];\n      });\n    }\n    return origCreateOffer.apply(this, arguments);\n  };\n}\n\nexport function shimCreateAnswer(window) {\n  // https://github.com/webrtcHacks/adapter/issues/998#issuecomment-516921647\n  // Firefox ignores the init sendEncodings options passed to addTransceiver\n  // https://bugzilla.mozilla.org/show_bug.cgi?id=1396918\n  if (!(typeof window === 'object' && window.RTCPeerConnection)) {\n    return;\n  }\n  const origCreateAnswer = window.RTCPeerConnection.prototype.createAnswer;\n  window.RTCPeerConnection.prototype.createAnswer = function createAnswer() {\n    if (this.setParametersPromises && this.setParametersPromises.length) {\n      return Promise.all(this.setParametersPromises)\n      .then(() => {\n        return origCreateAnswer.apply(this, arguments);\n      })\n      .finally(() => {\n        this.setParametersPromises = [];\n      });\n    }\n    return origCreateAnswer.apply(this, arguments);\n  };\n}\n","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n'use strict';\nimport * as utils from '../utils';\n\nexport function shimLocalStreamsAPI(window) {\n  if (typeof window !== 'object' || !window.RTCPeerConnection) {\n    return;\n  }\n  if (!('getLocalStreams' in window.RTCPeerConnection.prototype)) {\n    window.RTCPeerConnection.prototype.getLocalStreams =\n      function getLocalStreams() {\n        if (!this._localStreams) {\n          this._localStreams = [];\n        }\n        return this._localStreams;\n      };\n  }\n  if (!('addStream' in window.RTCPeerConnection.prototype)) {\n    const _addTrack = window.RTCPeerConnection.prototype.addTrack;\n    window.RTCPeerConnection.prototype.addStream = function addStream(stream) {\n      if (!this._localStreams) {\n        this._localStreams = [];\n      }\n      if (!this._localStreams.includes(stream)) {\n        this._localStreams.push(stream);\n      }\n      // Try to emulate Chrome's behaviour of adding in audio-video order.\n      // Safari orders by track id.\n      stream.getAudioTracks().forEach(track => _addTrack.call(this, track,\n        stream));\n      stream.getVideoTracks().forEach(track => _addTrack.call(this, track,\n        stream));\n    };\n\n    window.RTCPeerConnection.prototype.addTrack =\n      function addTrack(track, ...streams) {\n        if (streams) {\n          streams.forEach((stream) => {\n            if (!this._localStreams) {\n              this._localStreams = [stream];\n            } else if (!this._localStreams.includes(stream)) {\n              this._localStreams.push(stream);\n            }\n          });\n        }\n        return _addTrack.apply(this, arguments);\n      };\n  }\n  if (!('removeStream' in window.RTCPeerConnection.prototype)) {\n    window.RTCPeerConnection.prototype.removeStream =\n      function removeStream(stream) {\n        if (!this._localStreams) {\n          this._localStreams = [];\n        }\n        const index = this._localStreams.indexOf(stream);\n        if (index === -1) {\n          return;\n        }\n        this._localStreams.splice(index, 1);\n        const tracks = stream.getTracks();\n        this.getSenders().forEach(sender => {\n          if (tracks.includes(sender.track)) {\n            this.removeTrack(sender);\n          }\n        });\n      };\n  }\n}\n\nexport function shimRemoteStreamsAPI(window) {\n  if (typeof window !== 'object' || !window.RTCPeerConnection) {\n    return;\n  }\n  if (!('getRemoteStreams' in window.RTCPeerConnection.prototype)) {\n    window.RTCPeerConnection.prototype.getRemoteStreams =\n      function getRemoteStreams() {\n        return this._remoteStreams ? this._remoteStreams : [];\n      };\n  }\n  if (!('onaddstream' in window.RTCPeerConnection.prototype)) {\n    Object.defineProperty(window.RTCPeerConnection.prototype, 'onaddstream', {\n      get() {\n        return this._onaddstream;\n      },\n      set(f) {\n        if (this._onaddstream) {\n          this.removeEventListener('addstream', this._onaddstream);\n          this.removeEventListener('track', this._onaddstreampoly);\n        }\n        this.addEventListener('addstream', this._onaddstream = f);\n        this.addEventListener('track', this._onaddstreampoly = (e) => {\n          e.streams.forEach(stream => {\n            if (!this._remoteStreams) {\n              this._remoteStreams = [];\n            }\n            if (this._remoteStreams.includes(stream)) {\n              return;\n            }\n            this._remoteStreams.push(stream);\n            const event = new Event('addstream');\n            event.stream = stream;\n            this.dispatchEvent(event);\n          });\n        });\n      }\n    });\n    const origSetRemoteDescription =\n      window.RTCPeerConnection.prototype.setRemoteDescription;\n    window.RTCPeerConnection.prototype.setRemoteDescription =\n      function setRemoteDescription() {\n        const pc = this;\n        if (!this._onaddstreampoly) {\n          this.addEventListener('track', this._onaddstreampoly = function(e) {\n            e.streams.forEach(stream => {\n              if (!pc._remoteStreams) {\n                pc._remoteStreams = [];\n              }\n              if (pc._remoteStreams.indexOf(stream) >= 0) {\n                return;\n              }\n              pc._remoteStreams.push(stream);\n              const event = new Event('addstream');\n              event.stream = stream;\n              pc.dispatchEvent(event);\n            });\n          });\n        }\n        return origSetRemoteDescription.apply(pc, arguments);\n      };\n  }\n}\n\nexport function shimCallbacksAPI(window) {\n  if (typeof window !== 'object' || !window.RTCPeerConnection) {\n    return;\n  }\n  const prototype = window.RTCPeerConnection.prototype;\n  const origCreateOffer = prototype.createOffer;\n  const origCreateAnswer = prototype.createAnswer;\n  const setLocalDescription = prototype.setLocalDescription;\n  const setRemoteDescription = prototype.setRemoteDescription;\n  const addIceCandidate = prototype.addIceCandidate;\n\n  prototype.createOffer =\n    function createOffer(successCallback, failureCallback) {\n      const options = (arguments.length >= 2) ? arguments[2] : arguments[0];\n      const promise = origCreateOffer.apply(this, [options]);\n      if (!failureCallback) {\n        return promise;\n      }\n      promise.then(successCallback, failureCallback);\n      return Promise.resolve();\n    };\n\n  prototype.createAnswer =\n    function createAnswer(successCallback, failureCallback) {\n      const options = (arguments.length >= 2) ? arguments[2] : arguments[0];\n      const promise = origCreateAnswer.apply(this, [options]);\n      if (!failureCallback) {\n        return promise;\n      }\n      promise.then(successCallback, failureCallback);\n      return Promise.resolve();\n    };\n\n  let withCallback = function(description, successCallback, failureCallback) {\n    const promise = setLocalDescription.apply(this, [description]);\n    if (!failureCallback) {\n      return promise;\n    }\n    promise.then(successCallback, failureCallback);\n    return Promise.resolve();\n  };\n  prototype.setLocalDescription = withCallback;\n\n  withCallback = function(description, successCallback, failureCallback) {\n    const promise = setRemoteDescription.apply(this, [description]);\n    if (!failureCallback) {\n      return promise;\n    }\n    promise.then(successCallback, failureCallback);\n    return Promise.resolve();\n  };\n  prototype.setRemoteDescription = withCallback;\n\n  withCallback = function(candidate, successCallback, failureCallback) {\n    const promise = addIceCandidate.apply(this, [candidate]);\n    if (!failureCallback) {\n      return promise;\n    }\n    promise.then(successCallback, failureCallback);\n    return Promise.resolve();\n  };\n  prototype.addIceCandidate = withCallback;\n}\n\nexport function shimGetUserMedia(window) {\n  const navigator = window && window.navigator;\n\n  if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {\n    // shim not needed in Safari 12.1\n    const mediaDevices = navigator.mediaDevices;\n    const _getUserMedia = mediaDevices.getUserMedia.bind(mediaDevices);\n    navigator.mediaDevices.getUserMedia = (constraints) => {\n      return _getUserMedia(shimConstraints(constraints));\n    };\n  }\n\n  if (!navigator.getUserMedia && navigator.mediaDevices &&\n    navigator.mediaDevices.getUserMedia) {\n    navigator.getUserMedia = function getUserMedia(constraints, cb, errcb) {\n      navigator.mediaDevices.getUserMedia(constraints)\n      .then(cb, errcb);\n    }.bind(navigator);\n  }\n}\n\nexport function shimConstraints(constraints) {\n  if (constraints && constraints.video !== undefined) {\n    return Object.assign({},\n      constraints,\n      {video: utils.compactObject(constraints.video)}\n    );\n  }\n\n  return constraints;\n}\n\nexport function shimRTCIceServerUrls(window) {\n  if (!window.RTCPeerConnection) {\n    return;\n  }\n  // migrate from non-spec RTCIceServer.url to RTCIceServer.urls\n  const OrigPeerConnection = window.RTCPeerConnection;\n  window.RTCPeerConnection =\n    function RTCPeerConnection(pcConfig, pcConstraints) {\n      if (pcConfig && pcConfig.iceServers) {\n        const newIceServers = [];\n        for (let i = 0; i < pcConfig.iceServers.length; i++) {\n          let server = pcConfig.iceServers[i];\n          if (!server.hasOwnProperty('urls') &&\n              server.hasOwnProperty('url')) {\n            utils.deprecated('RTCIceServer.url', 'RTCIceServer.urls');\n            server = JSON.parse(JSON.stringify(server));\n            server.urls = server.url;\n            delete server.url;\n            newIceServers.push(server);\n          } else {\n            newIceServers.push(pcConfig.iceServers[i]);\n          }\n        }\n        pcConfig.iceServers = newIceServers;\n      }\n      return new OrigPeerConnection(pcConfig, pcConstraints);\n    };\n  window.RTCPeerConnection.prototype = OrigPeerConnection.prototype;\n  // wrap static methods. Currently just generateCertificate.\n  if ('generateCertificate' in OrigPeerConnection) {\n    Object.defineProperty(window.RTCPeerConnection, 'generateCertificate', {\n      get() {\n        return OrigPeerConnection.generateCertificate;\n      }\n    });\n  }\n}\n\nexport function shimTrackEventTransceiver(window) {\n  // Add event.transceiver member over deprecated event.receiver\n  if (typeof window === 'object' && window.RTCTrackEvent &&\n      'receiver' in window.RTCTrackEvent.prototype &&\n      !('transceiver' in window.RTCTrackEvent.prototype)) {\n    Object.defineProperty(window.RTCTrackEvent.prototype, 'transceiver', {\n      get() {\n        return {receiver: this.receiver};\n      }\n    });\n  }\n}\n\nexport function shimCreateOfferLegacy(window) {\n  const origCreateOffer = window.RTCPeerConnection.prototype.createOffer;\n  window.RTCPeerConnection.prototype.createOffer =\n    function createOffer(offerOptions) {\n      if (offerOptions) {\n        if (typeof offerOptions.offerToReceiveAudio !== 'undefined') {\n          // support bit values\n          offerOptions.offerToReceiveAudio =\n            !!offerOptions.offerToReceiveAudio;\n        }\n        const audioTransceiver = this.getTransceivers().find(transceiver =>\n          transceiver.receiver.track.kind === 'audio');\n        if (offerOptions.offerToReceiveAudio === false && audioTransceiver) {\n          if (audioTransceiver.direction === 'sendrecv') {\n            if (audioTransceiver.setDirection) {\n              audioTransceiver.setDirection('sendonly');\n            } else {\n              audioTransceiver.direction = 'sendonly';\n            }\n          } else if (audioTransceiver.direction === 'recvonly') {\n            if (audioTransceiver.setDirection) {\n              audioTransceiver.setDirection('inactive');\n            } else {\n              audioTransceiver.direction = 'inactive';\n            }\n          }\n        } else if (offerOptions.offerToReceiveAudio === true &&\n            !audioTransceiver) {\n          this.addTransceiver('audio', {direction: 'recvonly'});\n        }\n\n        if (typeof offerOptions.offerToReceiveVideo !== 'undefined') {\n          // support bit values\n          offerOptions.offerToReceiveVideo =\n            !!offerOptions.offerToReceiveVideo;\n        }\n        const videoTransceiver = this.getTransceivers().find(transceiver =>\n          transceiver.receiver.track.kind === 'video');\n        if (offerOptions.offerToReceiveVideo === false && videoTransceiver) {\n          if (videoTransceiver.direction === 'sendrecv') {\n            if (videoTransceiver.setDirection) {\n              videoTransceiver.setDirection('sendonly');\n            } else {\n              videoTransceiver.direction = 'sendonly';\n            }\n          } else if (videoTransceiver.direction === 'recvonly') {\n            if (videoTransceiver.setDirection) {\n              videoTransceiver.setDirection('inactive');\n            } else {\n              videoTransceiver.direction = 'inactive';\n            }\n          }\n        } else if (offerOptions.offerToReceiveVideo === true &&\n            !videoTransceiver) {\n          this.addTransceiver('video', {direction: 'recvonly'});\n        }\n      }\n      return origCreateOffer.apply(this, arguments);\n    };\n}\n\nexport function shimAudioContext(window) {\n  if (typeof window !== 'object' || window.AudioContext) {\n    return;\n  }\n  window.AudioContext = window.webkitAudioContext;\n}\n\n","/*\n *  Copyright (c) 2017 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n'use strict';\n\nimport SDPUtils from 'sdp';\nimport * as utils from './utils';\n\nexport function shimRTCIceCandidate(window) {\n  // foundation is arbitrarily chosen as an indicator for full support for\n  // https://w3c.github.io/webrtc-pc/#rtcicecandidate-interface\n  if (!window.RTCIceCandidate || (window.RTCIceCandidate && 'foundation' in\n      window.RTCIceCandidate.prototype)) {\n    return;\n  }\n\n  const NativeRTCIceCandidate = window.RTCIceCandidate;\n  window.RTCIceCandidate = function RTCIceCandidate(args) {\n    // Remove the a= which shouldn't be part of the candidate string.\n    if (typeof args === 'object' && args.candidate &&\n        args.candidate.indexOf('a=') === 0) {\n      args = JSON.parse(JSON.stringify(args));\n      args.candidate = args.candidate.substr(2);\n    }\n\n    if (args.candidate && args.candidate.length) {\n      // Augment the native candidate with the parsed fields.\n      const nativeCandidate = new NativeRTCIceCandidate(args);\n      const parsedCandidate = SDPUtils.parseCandidate(args.candidate);\n      const augmentedCandidate = Object.assign(nativeCandidate,\n          parsedCandidate);\n\n      // Add a serializer that does not serialize the extra attributes.\n      augmentedCandidate.toJSON = function toJSON() {\n        return {\n          candidate: augmentedCandidate.candidate,\n          sdpMid: augmentedCandidate.sdpMid,\n          sdpMLineIndex: augmentedCandidate.sdpMLineIndex,\n          usernameFragment: augmentedCandidate.usernameFragment,\n        };\n      };\n      return augmentedCandidate;\n    }\n    return new NativeRTCIceCandidate(args);\n  };\n  window.RTCIceCandidate.prototype = NativeRTCIceCandidate.prototype;\n\n  // Hook up the augmented candidate in onicecandidate and\n  // addEventListener('icecandidate', ...)\n  utils.wrapPeerConnectionEvent(window, 'icecandidate', e => {\n    if (e.candidate) {\n      Object.defineProperty(e, 'candidate', {\n        value: new window.RTCIceCandidate(e.candidate),\n        writable: 'false'\n      });\n    }\n    return e;\n  });\n}\n\nexport function shimMaxMessageSize(window, browserDetails) {\n  if (!window.RTCPeerConnection) {\n    return;\n  }\n\n  if (!('sctp' in window.RTCPeerConnection.prototype)) {\n    Object.defineProperty(window.RTCPeerConnection.prototype, 'sctp', {\n      get() {\n        return typeof this._sctp === 'undefined' ? null : this._sctp;\n      }\n    });\n  }\n\n  const sctpInDescription = function(description) {\n    if (!description || !description.sdp) {\n      return false;\n    }\n    const sections = SDPUtils.splitSections(description.sdp);\n    sections.shift();\n    return sections.some(mediaSection => {\n      const mLine = SDPUtils.parseMLine(mediaSection);\n      return mLine && mLine.kind === 'application'\n          && mLine.protocol.indexOf('SCTP') !== -1;\n    });\n  };\n\n  const getRemoteFirefoxVersion = function(description) {\n    // TODO: Is there a better solution for detecting Firefox?\n    const match = description.sdp.match(/mozilla...THIS_IS_SDPARTA-(\\d+)/);\n    if (match === null || match.length < 2) {\n      return -1;\n    }\n    const version = parseInt(match[1], 10);\n    // Test for NaN (yes, this is ugly)\n    return version !== version ? -1 : version;\n  };\n\n  const getCanSendMaxMessageSize = function(remoteIsFirefox) {\n    // Every implementation we know can send at least 64 KiB.\n    // Note: Although Chrome is technically able to send up to 256 KiB, the\n    //       data does not reach the other peer reliably.\n    //       See: https://bugs.chromium.org/p/webrtc/issues/detail?id=8419\n    let canSendMaxMessageSize = 65536;\n    if (browserDetails.browser === 'firefox') {\n      if (browserDetails.version < 57) {\n        if (remoteIsFirefox === -1) {\n          // FF < 57 will send in 16 KiB chunks using the deprecated PPID\n          // fragmentation.\n          canSendMaxMessageSize = 16384;\n        } else {\n          // However, other FF (and RAWRTC) can reassemble PPID-fragmented\n          // messages. Thus, supporting ~2 GiB when sending.\n          canSendMaxMessageSize = 2147483637;\n        }\n      } else if (browserDetails.version < 60) {\n        // Currently, all FF >= 57 will reset the remote maximum message size\n        // to the default value when a data channel is created at a later\n        // stage. :(\n        // See: https://bugzilla.mozilla.org/show_bug.cgi?id=1426831\n        canSendMaxMessageSize =\n          browserDetails.version === 57 ? 65535 : 65536;\n      } else {\n        // FF >= 60 supports sending ~2 GiB\n        canSendMaxMessageSize = 2147483637;\n      }\n    }\n    return canSendMaxMessageSize;\n  };\n\n  const getMaxMessageSize = function(description, remoteIsFirefox) {\n    // Note: 65536 bytes is the default value from the SDP spec. Also,\n    //       every implementation we know supports receiving 65536 bytes.\n    let maxMessageSize = 65536;\n\n    // FF 57 has a slightly incorrect default remote max message size, so\n    // we need to adjust it here to avoid a failure when sending.\n    // See: https://bugzilla.mozilla.org/show_bug.cgi?id=1425697\n    if (browserDetails.browser === 'firefox'\n         && browserDetails.version === 57) {\n      maxMessageSize = 65535;\n    }\n\n    const match = SDPUtils.matchPrefix(description.sdp,\n      'a=max-message-size:');\n    if (match.length > 0) {\n      maxMessageSize = parseInt(match[0].substr(19), 10);\n    } else if (browserDetails.browser === 'firefox' &&\n                remoteIsFirefox !== -1) {\n      // If the maximum message size is not present in the remote SDP and\n      // both local and remote are Firefox, the remote peer can receive\n      // ~2 GiB.\n      maxMessageSize = 2147483637;\n    }\n    return maxMessageSize;\n  };\n\n  const origSetRemoteDescription =\n      window.RTCPeerConnection.prototype.setRemoteDescription;\n  window.RTCPeerConnection.prototype.setRemoteDescription =\n    function setRemoteDescription() {\n      this._sctp = null;\n      // Chrome decided to not expose .sctp in plan-b mode.\n      // As usual, adapter.js has to do an 'ugly worakaround'\n      // to cover up the mess.\n      if (browserDetails.browser === 'chrome' && browserDetails.version >= 76) {\n        const {sdpSemantics} = this.getConfiguration();\n        if (sdpSemantics === 'plan-b') {\n          Object.defineProperty(this, 'sctp', {\n            get() {\n              return typeof this._sctp === 'undefined' ? null : this._sctp;\n            },\n            enumerable: true,\n            configurable: true,\n          });\n        }\n      }\n\n      if (sctpInDescription(arguments[0])) {\n        // Check if the remote is FF.\n        const isFirefox = getRemoteFirefoxVersion(arguments[0]);\n\n        // Get the maximum message size the local peer is capable of sending\n        const canSendMMS = getCanSendMaxMessageSize(isFirefox);\n\n        // Get the maximum message size of the remote peer.\n        const remoteMMS = getMaxMessageSize(arguments[0], isFirefox);\n\n        // Determine final maximum message size\n        let maxMessageSize;\n        if (canSendMMS === 0 && remoteMMS === 0) {\n          maxMessageSize = Number.POSITIVE_INFINITY;\n        } else if (canSendMMS === 0 || remoteMMS === 0) {\n          maxMessageSize = Math.max(canSendMMS, remoteMMS);\n        } else {\n          maxMessageSize = Math.min(canSendMMS, remoteMMS);\n        }\n\n        // Create a dummy RTCSctpTransport object and the 'maxMessageSize'\n        // attribute.\n        const sctp = {};\n        Object.defineProperty(sctp, 'maxMessageSize', {\n          get() {\n            return maxMessageSize;\n          }\n        });\n        this._sctp = sctp;\n      }\n\n      return origSetRemoteDescription.apply(this, arguments);\n    };\n}\n\nexport function shimSendThrowTypeError(window) {\n  if (!(window.RTCPeerConnection &&\n      'createDataChannel' in window.RTCPeerConnection.prototype)) {\n    return;\n  }\n\n  // Note: Although Firefox >= 57 has a native implementation, the maximum\n  //       message size can be reset for all data channels at a later stage.\n  //       See: https://bugzilla.mozilla.org/show_bug.cgi?id=1426831\n\n  function wrapDcSend(dc, pc) {\n    const origDataChannelSend = dc.send;\n    dc.send = function send() {\n      const data = arguments[0];\n      const length = data.length || data.size || data.byteLength;\n      if (dc.readyState === 'open' &&\n          pc.sctp && length > pc.sctp.maxMessageSize) {\n        throw new TypeError('Message too large (can send a maximum of ' +\n          pc.sctp.maxMessageSize + ' bytes)');\n      }\n      return origDataChannelSend.apply(dc, arguments);\n    };\n  }\n  const origCreateDataChannel =\n    window.RTCPeerConnection.prototype.createDataChannel;\n  window.RTCPeerConnection.prototype.createDataChannel =\n    function createDataChannel() {\n      const dataChannel = origCreateDataChannel.apply(this, arguments);\n      wrapDcSend(dataChannel, this);\n      return dataChannel;\n    };\n  utils.wrapPeerConnectionEvent(window, 'datachannel', e => {\n    wrapDcSend(e.channel, e.target);\n    return e;\n  });\n}\n\n\n/* shims RTCConnectionState by pretending it is the same as iceConnectionState.\n * See https://bugs.chromium.org/p/webrtc/issues/detail?id=6145#c12\n * for why this is a valid hack in Chrome. In Firefox it is slightly incorrect\n * since DTLS failures would be hidden. See\n * https://bugzilla.mozilla.org/show_bug.cgi?id=1265827\n * for the Firefox tracking bug.\n */\nexport function shimConnectionState(window) {\n  if (!window.RTCPeerConnection ||\n      'connectionState' in window.RTCPeerConnection.prototype) {\n    return;\n  }\n  const proto = window.RTCPeerConnection.prototype;\n  Object.defineProperty(proto, 'connectionState', {\n    get() {\n      return {\n        completed: 'connected',\n        checking: 'connecting'\n      }[this.iceConnectionState] || this.iceConnectionState;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(proto, 'onconnectionstatechange', {\n    get() {\n      return this._onconnectionstatechange || null;\n    },\n    set(cb) {\n      if (this._onconnectionstatechange) {\n        this.removeEventListener('connectionstatechange',\n            this._onconnectionstatechange);\n        delete this._onconnectionstatechange;\n      }\n      if (cb) {\n        this.addEventListener('connectionstatechange',\n            this._onconnectionstatechange = cb);\n      }\n    },\n    enumerable: true,\n    configurable: true\n  });\n\n  ['setLocalDescription', 'setRemoteDescription'].forEach((method) => {\n    const origMethod = proto[method];\n    proto[method] = function() {\n      if (!this._connectionstatechangepoly) {\n        this._connectionstatechangepoly = e => {\n          const pc = e.target;\n          if (pc._lastConnectionState !== pc.connectionState) {\n            pc._lastConnectionState = pc.connectionState;\n            const newEvent = new Event('connectionstatechange', e);\n            pc.dispatchEvent(newEvent);\n          }\n          return e;\n        };\n        this.addEventListener('iceconnectionstatechange',\n          this._connectionstatechangepoly);\n      }\n      return origMethod.apply(this, arguments);\n    };\n  });\n}\n\nexport function removeExtmapAllowMixed(window, browserDetails) {\n  /* remove a=extmap-allow-mixed for webrtc.org < M71 */\n  if (!window.RTCPeerConnection) {\n    return;\n  }\n  if (browserDetails.browser === 'chrome' && browserDetails.version >= 71) {\n    return;\n  }\n  if (browserDetails.browser === 'safari' && browserDetails.version >= 605) {\n    return;\n  }\n  const nativeSRD = window.RTCPeerConnection.prototype.setRemoteDescription;\n  window.RTCPeerConnection.prototype.setRemoteDescription =\n  function setRemoteDescription(desc) {\n    if (desc && desc.sdp && desc.sdp.indexOf('\\na=extmap-allow-mixed') !== -1) {\n      const sdp = desc.sdp.split('\\n').filter((line) => {\n        return line.trim() !== 'a=extmap-allow-mixed';\n      }).join('\\n');\n      // Safari enforces read-only-ness of RTCSessionDescription fields.\n      if (window.RTCSessionDescription &&\n          desc instanceof window.RTCSessionDescription) {\n        arguments[0] = new window.RTCSessionDescription({\n          type: desc.type,\n          sdp,\n        });\n      } else {\n        desc.sdp = sdp;\n      }\n    }\n    return nativeSRD.apply(this, arguments);\n  };\n}\n\nexport function shimAddIceCandidateNullOrEmpty(window, browserDetails) {\n  // Support for addIceCandidate(null or undefined)\n  // as well as addIceCandidate({candidate: \"\", ...})\n  // https://bugs.chromium.org/p/chromium/issues/detail?id=978582\n  // Note: must be called before other polyfills which change the signature.\n  if (!(window.RTCPeerConnection && window.RTCPeerConnection.prototype)) {\n    return;\n  }\n  const nativeAddIceCandidate =\n      window.RTCPeerConnection.prototype.addIceCandidate;\n  if (!nativeAddIceCandidate || nativeAddIceCandidate.length === 0) {\n    return;\n  }\n  window.RTCPeerConnection.prototype.addIceCandidate =\n    function addIceCandidate() {\n      if (!arguments[0]) {\n        if (arguments[1]) {\n          arguments[1].apply(null);\n        }\n        return Promise.resolve();\n      }\n      // Firefox 68+ emits and processes {candidate: \"\", ...}, ignore\n      // in older versions.\n      // Native support for ignoring exists for Chrome M77+.\n      // Safari ignores as well, exact version unknown but works in the same\n      // version that also ignores addIceCandidate(null).\n      if (((browserDetails.browser === 'chrome' && browserDetails.version < 78)\n           || (browserDetails.browser === 'firefox'\n               && browserDetails.version < 68)\n           || (browserDetails.browser === 'safari'))\n          && arguments[0] && arguments[0].candidate === '') {\n        return Promise.resolve();\n      }\n      return nativeAddIceCandidate.apply(this, arguments);\n    };\n}\n\n// Note: Make sure to call this ahead of APIs that modify\n// setLocalDescription.length\nexport function shimParameterlessSetLocalDescription(window, browserDetails) {\n  if (!(window.RTCPeerConnection && window.RTCPeerConnection.prototype)) {\n    return;\n  }\n  const nativeSetLocalDescription =\n      window.RTCPeerConnection.prototype.setLocalDescription;\n  if (!nativeSetLocalDescription || nativeSetLocalDescription.length === 0) {\n    return;\n  }\n  window.RTCPeerConnection.prototype.setLocalDescription =\n    function setLocalDescription() {\n      let desc = arguments[0] || {};\n      if (typeof desc !== 'object' || (desc.type && desc.sdp)) {\n        return nativeSetLocalDescription.apply(this, arguments);\n      }\n      // The remaining steps should technically happen when SLD comes off the\n      // RTCPeerConnection's operations chain (not ahead of going on it), but\n      // this is too difficult to shim. Instead, this shim only covers the\n      // common case where the operations chain is empty. This is imperfect, but\n      // should cover many cases. Rationale: Even if we can't reduce the glare\n      // window to zero on imperfect implementations, there's value in tapping\n      // into the perfect negotiation pattern that several browsers support.\n      desc = {type: desc.type, sdp: desc.sdp};\n      if (!desc.type) {\n        switch (this.signalingState) {\n          case 'stable':\n          case 'have-local-offer':\n          case 'have-remote-pranswer':\n            desc.type = 'offer';\n            break;\n          default:\n            desc.type = 'answer';\n            break;\n        }\n      }\n      if (desc.sdp || (desc.type !== 'offer' && desc.type !== 'answer')) {\n        return nativeSetLocalDescription.apply(this, [desc]);\n      }\n      const func = desc.type === 'offer' ? this.createOffer : this.createAnswer;\n      return func.apply(this)\n        .then(d => nativeSetLocalDescription.apply(this, [d]));\n    };\n}\n","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\nimport * as utils from './utils';\n\n  // Browser shims.\nimport * as chromeShim from './chrome/chrome_shim';\nimport * as firefoxShim from './firefox/firefox_shim';\nimport * as safariShim from './safari/safari_shim';\nimport * as commonShim from './common_shim';\nimport * as sdp from 'sdp';\n\n// Shimming starts here.\nexport function adapterFactory({window} = {}, options = {\n  shimChrome: true,\n  shimFirefox: true,\n  shimSafari: true,\n}) {\n  // Utils.\n  const logging = utils.log;\n  const browserDetails = utils.detectBrowser(window);\n\n  const adapter = {\n    browserDetails,\n    commonShim,\n    extractVersion: utils.extractVersion,\n    disableLog: utils.disableLog,\n    disableWarnings: utils.disableWarnings,\n    // Expose sdp as a convenience. For production apps include directly.\n    sdp,\n  };\n\n  // Shim browser if found.\n  switch (browserDetails.browser) {\n    case 'chrome':\n      if (!chromeShim || !chromeShim.shimPeerConnection ||\n          !options.shimChrome) {\n        logging('Chrome shim is not included in this adapter release.');\n        return adapter;\n      }\n      if (browserDetails.version === null) {\n        logging('Chrome shim can not determine version, not shimming.');\n        return adapter;\n      }\n      logging('adapter.js shimming chrome.');\n      // Export to the adapter global object visible in the browser.\n      adapter.browserShim = chromeShim;\n\n      // Must be called before shimPeerConnection.\n      commonShim.shimAddIceCandidateNullOrEmpty(window, browserDetails);\n      commonShim.shimParameterlessSetLocalDescription(window, browserDetails);\n\n      chromeShim.shimGetUserMedia(window, browserDetails);\n      chromeShim.shimMediaStream(window, browserDetails);\n      chromeShim.shimPeerConnection(window, browserDetails);\n      chromeShim.shimOnTrack(window, browserDetails);\n      chromeShim.shimAddTrackRemoveTrack(window, browserDetails);\n      chromeShim.shimGetSendersWithDtmf(window, browserDetails);\n      chromeShim.shimGetStats(window, browserDetails);\n      chromeShim.shimSenderReceiverGetStats(window, browserDetails);\n      chromeShim.fixNegotiationNeeded(window, browserDetails);\n\n      commonShim.shimRTCIceCandidate(window, browserDetails);\n      commonShim.shimConnectionState(window, browserDetails);\n      commonShim.shimMaxMessageSize(window, browserDetails);\n      commonShim.shimSendThrowTypeError(window, browserDetails);\n      commonShim.removeExtmapAllowMixed(window, browserDetails);\n      break;\n    case 'firefox':\n      if (!firefoxShim || !firefoxShim.shimPeerConnection ||\n          !options.shimFirefox) {\n        logging('Firefox shim is not included in this adapter release.');\n        return adapter;\n      }\n      logging('adapter.js shimming firefox.');\n      // Export to the adapter global object visible in the browser.\n      adapter.browserShim = firefoxShim;\n\n      // Must be called before shimPeerConnection.\n      commonShim.shimAddIceCandidateNullOrEmpty(window, browserDetails);\n      commonShim.shimParameterlessSetLocalDescription(window, browserDetails);\n\n      firefoxShim.shimGetUserMedia(window, browserDetails);\n      firefoxShim.shimPeerConnection(window, browserDetails);\n      firefoxShim.shimOnTrack(window, browserDetails);\n      firefoxShim.shimRemoveStream(window, browserDetails);\n      firefoxShim.shimSenderGetStats(window, browserDetails);\n      firefoxShim.shimReceiverGetStats(window, browserDetails);\n      firefoxShim.shimRTCDataChannel(window, browserDetails);\n      firefoxShim.shimAddTransceiver(window, browserDetails);\n      firefoxShim.shimGetParameters(window, browserDetails);\n      firefoxShim.shimCreateOffer(window, browserDetails);\n      firefoxShim.shimCreateAnswer(window, browserDetails);\n\n      commonShim.shimRTCIceCandidate(window, browserDetails);\n      commonShim.shimConnectionState(window, browserDetails);\n      commonShim.shimMaxMessageSize(window, browserDetails);\n      commonShim.shimSendThrowTypeError(window, browserDetails);\n      break;\n    case 'safari':\n      if (!safariShim || !options.shimSafari) {\n        logging('Safari shim is not included in this adapter release.');\n        return adapter;\n      }\n      logging('adapter.js shimming safari.');\n      // Export to the adapter global object visible in the browser.\n      adapter.browserShim = safariShim;\n\n      // Must be called before shimCallbackAPI.\n      commonShim.shimAddIceCandidateNullOrEmpty(window, browserDetails);\n      commonShim.shimParameterlessSetLocalDescription(window, browserDetails);\n\n      safariShim.shimRTCIceServerUrls(window, browserDetails);\n      safariShim.shimCreateOfferLegacy(window, browserDetails);\n      safariShim.shimCallbacksAPI(window, browserDetails);\n      safariShim.shimLocalStreamsAPI(window, browserDetails);\n      safariShim.shimRemoteStreamsAPI(window, browserDetails);\n      safariShim.shimTrackEventTransceiver(window, browserDetails);\n      safariShim.shimGetUserMedia(window, browserDetails);\n      safariShim.shimAudioContext(window, browserDetails);\n\n      commonShim.shimRTCIceCandidate(window, browserDetails);\n      commonShim.shimMaxMessageSize(window, browserDetails);\n      commonShim.shimSendThrowTypeError(window, browserDetails);\n      commonShim.removeExtmapAllowMixed(window, browserDetails);\n      break;\n    default:\n      logging('Unsupported browser!');\n      break;\n  }\n\n  return adapter;\n}\n","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n\n'use strict';\n\nimport {adapterFactory} from './adapter_factory.js';\n\nconst adapter =\n  adapterFactory({window: typeof window === 'undefined' ? undefined : window});\nexport default adapter;\n","const Resolutions = {\n    '1080': {\n        height: 1080,\n        width: 1920\n    },\n    '180': {\n        height: 180,\n        width: 320\n    },\n    '2160': {\n        height: 2160,\n        width: 3840\n    },\n    '240': {\n        height: 240,\n        width: 320\n    },\n    '360': {\n        height: 360,\n        width: 640\n    },\n    '480': {\n        height: 480,\n        width: 640\n    },\n    '4k': {\n        height: 2160,\n        width: 3840\n    },\n    '540': {\n        height: 540,\n        width: 960\n    },\n    '720': {\n        height: 720,\n        width: 1280\n    },\n    'fullhd': {\n        height: 1080,\n        width: 1920\n    },\n    'hd': {\n        height: 720,\n        width: 1280\n    },\n    'qhd': {\n        height: 540,\n        width: 960\n    },\n    'vga': {\n        height: 480,\n        width: 640\n    }\n};\n\nexport default Resolutions;\n\n","import { getLogger } from '@jitsi/logger';\n\nimport JitsiTrackError from '../../JitsiTrackError';\nimport * as JitsiTrackErrors from '../../JitsiTrackErrors';\nimport browser from '../browser';\n\nconst logger = getLogger('rtc:ScreenObtainer');\n\n/**\n * Interface for desktop sharing frame rate configuration.\n */\ninterface IFrameRateConfig {\n    max?: number;\n    min?: number;\n}\n\n/**\n * Interface for desktop sharing resolution configuration.\n */\ninterface IResolutionConfig {\n    height?: {\n        max?: number;\n        min?: number;\n    };\n    width?: {\n        max?: number;\n        min?: number;\n    };\n}\n\n/**\n * Interface for audio quality configuration.\n */\ninterface IAudioQuality {\n    autoGainControl?: boolean;\n    channelCount?: number;\n    echoCancellation?: boolean;\n    noiseSuppression?: boolean;\n    restrictOwnAudio?: boolean;\n    stereo?: boolean;\n}\n\n/**\n * Interface for screen share settings.\n */\ninterface IScreenShareSettings {\n    desktopDisplaySurface?: string;\n    desktopPreferCurrentTab?: boolean;\n    desktopSelfBrowserSurface?: string;\n    desktopSurfaceSwitching?: string;\n    desktopSystemAudio?: string;\n}\n\n\n/**\n * Interface for options parameter in obtainScreen methods.\n */\ninterface IObtainScreenOptions {\n    desktopSharingFrameRate?: IFrameRateConfig;\n    desktopSharingSources?: string[];\n    resolution?: number;\n    screenShareSettings?: IScreenShareSettings;\n}\n\n/**\n * Interface for audio constraints.\n */\ninterface IAudioConstraints {\n    mandatory?: {\n        chromeMediaSource?: string;\n        chromeMediaSourceId?: string;\n    };\n    optional?: {\n        autoGainControl?: boolean;\n        channelCount?: number;\n        echoCancellation?: boolean;\n        noiseSuppression?: boolean;\n    };\n}\n\n/**\n * Interface for legacy video constraints.\n */\ninterface ILegacyVideoConstraints {\n    mandatory: {\n        chromeMediaSource: string;\n        chromeMediaSourceId: string;\n        maxFrameRate: number;\n        maxHeight: number;\n        maxWidth: number;\n        minFrameRate: number;\n        minHeight?: number;\n        minWidth?: number;\n    };\n}\n\n/**\n * Interface for modern video constraints.\n */\ninterface IVideoConstraints {\n    displaySurface?: string;\n    frameRate?: IFrameRateConfig;\n    height?: number;\n    width?: number;\n}\n\n/**\n * Interface for constraint options.\n */\ninterface IConstraintOptions {\n    preferCurrentTab?: boolean;\n    selfBrowserSurface?: string;\n    surfaceSwitching?: string;\n    systemAudio?: string;\n}\n\n/**\n * Interface for getDisplayMedia constraints.\n */\ninterface IDisplayMediaConstraints {\n    audio: boolean | object;\n    cursor?: string;\n    preferCurrentTab?: boolean;\n    selfBrowserSurface?: string;\n    surfaceSwitching?: string;\n    systemAudio?: string;\n    video: boolean | IVideoConstraints;\n}\n\n/**\n * Interface for screen obtainer options.\n */\ninterface IScreenObtainerOptions {\n    audioQuality?: IAudioQuality;\n    desktopSharingFrameRate?: IFrameRateConfig;\n    desktopSharingResolution?: IResolutionConfig;\n    desktopSharingSources?: string[];\n    resolution?: number;\n    screenShareSettings?: IScreenShareSettings;\n    testing?: {\n        testMode?: boolean;\n    };\n}\n\n/**\n * Interface for screen capture result.\n */\ninterface IScreenCaptureResult {\n    sourceId: string;\n    sourceType?: string;\n    stream: MediaStream;\n}\n\n/**\n * The default frame rate for Screen Sharing.\n */\nexport const SS_DEFAULT_FRAME_RATE = 5;\n\n/**\n * Handles obtaining a stream from a screen capture on different browsers.\n */\nclass ScreenObtainer {\n    private _electronSkipDisplayMedia: boolean;\n    public obtainStream: Nullable<((\n        onSuccess: (result: IScreenCaptureResult) => void,\n        onFailure: (error: JitsiTrackError) => void,\n        options?: any\n    ) => void)>;\n\n    /**\n     * @internal\n     */\n    options: IScreenObtainerOptions;\n\n    constructor() {\n        this.obtainStream = this._createObtainStreamMethod();\n        this.options = {};\n        this._electronSkipDisplayMedia = false;\n    }\n\n    /**\n     * Initializes the function used to obtain a screen capture\n     * (this.obtainStream).\n     *\n     * @param {object} options\n     */\n    private init(options: IScreenObtainerOptions = {}) {\n        this.options = options;\n\n        if (!this.obtainStream) {\n            logger.warn('Desktop sharing not supported');\n        }\n    }\n\n    /**\n     * Returns a method which will be used to obtain the screen sharing stream\n     * (based on the browser type).\n     *\n     * @returns {Function}\n     * @private\n     */\n    private _createObtainStreamMethod() {\n        const supportsGetDisplayMedia = browser.supportsGetDisplayMedia();\n\n        if (browser.isElectron()) {\n            return this._obtainScreenOnElectron;\n        } else if (browser.isReactNative() && supportsGetDisplayMedia) {\n            return this.obtainScreenFromGetDisplayMediaRN;\n        } else if (supportsGetDisplayMedia) {\n            return this._obtainScreenFromGetDisplayMedia;\n        }\n        logger.warn('Screen sharing not supported on ', browser.getName());\n\n        return null;\n    }\n\n    /**\n     * Gets the appropriate constraints for audio sharing.\n     *\n     * @returns {IAudioQuality | boolean}\n     */\n    private _getAudioConstraints(): boolean | IAudioQuality {\n        const { audioQuality } = this.options;\n        const isTestModeEnabled = this.options.testing?.testMode;\n\n        // Chrome 140+ requires 'restrictOwnAudio' for proper audio sharing when not using stereo.\n        // Starting Chrome 137 'echoCancellation' was turned off by default for screen share audio and needs to be\n        // enabled explicity to avoid echo issues.\n        // See https://issues.chromium.org/issues/422611724 and https://chromestatus.com/feature/5128140732760064 for more details.\n        const supportsRestrictOwnAudio = browser.isChromiumBased()\n            && browser.isEngineVersionGreaterThan(141)\n            && !browser.isElectron();\n        const needsEchoCancellation = !audioQuality?.stereo\n            && browser.isChromiumBased()\n            && browser.isEngineVersionGreaterThan(136)\n            && !supportsRestrictOwnAudio;\n\n        const defaultAudioConstraints: IAudioQuality = {\n            autoGainControl: !audioQuality?.stereo,\n            channelCount: audioQuality?.stereo ? 2 : 1,\n            echoCancellation: !audioQuality?.stereo,\n            noiseSuppression: !audioQuality?.stereo\n        };\n\n        let audio: boolean | IAudioQuality = (audioQuality?.stereo || needsEchoCancellation)\n            ? defaultAudioConstraints\n            : !isTestModeEnabled;\n\n        if (supportsRestrictOwnAudio && !isTestModeEnabled) {\n            if (typeof audio === 'boolean') {\n                audio = {\n                    restrictOwnAudio: true\n                };\n            } else {\n                audio.restrictOwnAudio = true;\n            }\n        }\n\n        return audio;\n    }\n\n    /**\n     * Obtains a screen capture stream on Electron.\n     *\n     * @param onSuccess - Success callback.\n     * @param onFailure - Failure callback.\n     * @param {Object} options - Optional parameters.\n     */\n    private _obtainScreenOnElectron(onSuccess: (result: IScreenCaptureResult) => void, onFailure: (error: JitsiTrackError) => void, options: IObtainScreenOptions = {}) {\n        if (!this._electronSkipDisplayMedia) {\n            // Fall-back to the old API in case of not supported error. This can happen if\n            // an old Electron SDK is used with a new Jitsi Meet + lib-jitsi-meet version.\n            this._obtainScreenFromGetDisplayMedia(onSuccess, err => {\n                if (err.name === JitsiTrackErrors.SCREENSHARING_NOT_SUPPORTED_ERROR) {\n                    // Make sure we don't recurse infinitely.\n                    this._electronSkipDisplayMedia = true;\n                    this._obtainScreenOnElectron(onSuccess, onFailure);\n                } else {\n                    onFailure(err);\n                }\n            });\n\n            return;\n        }\n\n        // @ts-ignore TODO: legacy flow, remove after the Electron SDK supporting gDM has been out for a while.\n        if (typeof window.JitsiMeetScreenObtainer?.openDesktopPicker === 'function') {\n            const { desktopSharingFrameRate, desktopSharingResolution, desktopSharingSources } = this.options;\n\n            // @ts-ignore TODO: legacy flow, remove after the Electron SDK supporting gDM has been out for a while.\n            window.JitsiMeetScreenObtainer.openDesktopPicker(\n                {\n                    desktopSharingSources:\n                        options.desktopSharingSources || desktopSharingSources || [ 'screen', 'window' ]\n                },\n                (streamId: string, streamType: string, screenShareAudio = false) => {\n                    if (streamId) {\n                        let audioConstraints: boolean | IAudioConstraints = false;\n\n                        if (screenShareAudio) {\n                            audioConstraints = {};\n                            const optionalConstraints = this._getAudioConstraints();\n\n                            if (typeof optionalConstraints !== 'boolean') {\n                                audioConstraints = {\n                                    optional: optionalConstraints\n                                };\n                            }\n\n                            // Audio screen sharing for electron only works for screen type devices.\n                            // i.e. when the user shares the whole desktop.\n                            // Note. The documentation specifies that chromeMediaSourceId should not be present\n                            // which, in the case a users has multiple monitors, leads to them being shared all\n                            // at once. However we tested with chromeMediaSourceId present and it seems to be\n                            // working properly.\n                            if (streamType === 'screen') {\n                                (audioConstraints as IAudioConstraints).mandatory = {\n                                    chromeMediaSource: 'desktop'\n                                };\n                            }\n                        }\n\n                        const constraints: any = {\n                            audio: audioConstraints,\n                            video: {\n                                mandatory: {\n                                    chromeMediaSource: 'desktop',\n                                    chromeMediaSourceId: streamId,\n                                    maxFrameRate: desktopSharingFrameRate?.max ?? SS_DEFAULT_FRAME_RATE,\n                                    maxHeight: desktopSharingResolution?.height?.max ?? window.screen.height,\n                                    maxWidth: desktopSharingResolution?.width?.max ?? window.screen.width,\n                                    minFrameRate: desktopSharingFrameRate?.min ?? SS_DEFAULT_FRAME_RATE,\n                                    minHeight: desktopSharingResolution?.height?.min,\n                                    minWidth: desktopSharingResolution?.width?.min\n                                }\n                            } as ILegacyVideoConstraints\n                        };\n\n                        // We have to use the old API on Electron to get a desktop stream.\n                        navigator.mediaDevices.getUserMedia(constraints)\n                            .then(stream => {\n                                this.setContentHint(stream);\n                                onSuccess({\n                                    sourceId: streamId,\n                                    sourceType: streamType,\n                                    stream\n                                });\n                            })\n                            .catch(err => onFailure(err));\n                    } else {\n                        // As noted in Chrome Desktop Capture API:\n                        // If user didn't select any source (i.e. canceled the prompt)\n                        // then the callback is called with an empty streamId.\n                        onFailure(new JitsiTrackError(JitsiTrackErrors.SCREENSHARING_USER_CANCELED));\n                    }\n                },\n                err => onFailure(new JitsiTrackError(\n                    JitsiTrackErrors.ELECTRON_DESKTOP_PICKER_ERROR,\n                    err\n                ))\n            );\n        } else {\n            onFailure(new JitsiTrackError(JitsiTrackErrors.ELECTRON_DESKTOP_PICKER_NOT_FOUND));\n        }\n    }\n\n    /**\n     * Obtains a screen capture stream using getDisplayMedia.\n     *\n     * @param callback - The success callback.\n     * @param errorCallback - The error callback.\n     * @param {Object} options - Optional parameters.\n     */\n    private _obtainScreenFromGetDisplayMedia(callback: (result: IScreenCaptureResult) => void, errorCallback: (error: JitsiTrackError) => void, options: IObtainScreenOptions = {}) {\n        let getDisplayMedia;\n\n        // @ts-ignore Property 'getDisplayMedia' does not exist on type 'Navigator'\n        if (navigator.getDisplayMedia) {\n            // @ts-ignore Property 'getDisplayMedia' does not exist on type 'Navigator'\n            getDisplayMedia = navigator.getDisplayMedia.bind(navigator);\n        } else {\n            // eslint-disable-next-line max-len\n            getDisplayMedia = navigator.mediaDevices.getDisplayMedia.bind(navigator.mediaDevices);\n        }\n\n        const audio = this._getAudioConstraints();\n        let video: boolean | IVideoConstraints = {};\n        const constraintOpts: IConstraintOptions = {};\n\n        // The options passed to this method should take precedence over the global settings.\n        const {\n            desktopSharingFrameRate = this.options?.desktopSharingFrameRate,\n            resolution = this.options?.resolution,\n            screenShareSettings = this.options?.screenShareSettings\n        } = options;\n\n        if (typeof desktopSharingFrameRate === 'object') {\n            video.frameRate = desktopSharingFrameRate;\n        }\n\n        // At the time of this writing 'min' constraint for fps is not supported by getDisplayMedia on any of the\n        // browsers. getDisplayMedia will fail with an error \"invalid constraints\" in this case.\n        video.frameRate && delete video.frameRate.min;\n\n        if (browser.isChromiumBased()) {\n            // Show users the current tab is the preferred capture source, default: false.\n            browser.isEngineVersionGreaterThan(93)\n                && (constraintOpts.preferCurrentTab = screenShareSettings?.desktopPreferCurrentTab || false);\n\n            // Allow users to select system audio, default: include.\n            browser.isEngineVersionGreaterThan(104)\n                && (constraintOpts.systemAudio = screenShareSettings?.desktopSystemAudio || 'include');\n\n            // Allow users to seamlessly switch which tab they are sharing without having to select the tab again.\n            browser.isEngineVersionGreaterThan(106)\n                && (constraintOpts.surfaceSwitching = screenShareSettings?.desktopSurfaceSwitching || 'include');\n\n            // Allow a user to be shown a preference for what screen is to be captured, default: unset.\n            browser.isEngineVersionGreaterThan(106) && screenShareSettings?.desktopDisplaySurface\n                && (video.displaySurface = screenShareSettings?.desktopDisplaySurface);\n\n            // Allow users to select the current tab as a capture source, default: exclude.\n            browser.isEngineVersionGreaterThan(111)\n                && (constraintOpts.selfBrowserSurface = screenShareSettings?.desktopSelfBrowserSurface || 'exclude');\n\n            // Set bogus resolution constraints to work around\n            // https://bugs.chromium.org/p/chromium/issues/detail?id=1056311 for low fps screenshare. Capturing SS at\n            // very high resolutions restricts the framerate. Therefore, skip this hack when capture fps > 5 fps.\n            if (!(desktopSharingFrameRate?.max > SS_DEFAULT_FRAME_RATE)) {\n                video.height = 99999;\n                video.width = 99999;\n            }\n        }\n\n        // Allow a user to be shown a preference for what screen is to be captured.\n        if (browser.isSafari() && screenShareSettings?.desktopDisplaySurface) {\n            video.displaySurface = screenShareSettings?.desktopDisplaySurface;\n        }\n\n        if (Object.keys(video).length === 0) {\n            video = true;\n        }\n\n        const constraints = {\n            audio,\n            video,\n            ...constraintOpts,\n            cursor: 'always'\n        } as IDisplayMediaConstraints;\n\n        logger.info('Using getDisplayMedia for screen sharing', constraints);\n\n        getDisplayMedia(constraints)\n            .then(stream => {\n                this.setContentHint(stream);\n\n                // Apply min fps constraints to the track so that 0Hz mode doesn't kick in.\n                // https://bugs.chromium.org/p/webrtc/issues/detail?id=15539\n                if (browser.isChromiumBased()) {\n                    const track = stream.getVideoTracks()[0];\n                    let minFps = SS_DEFAULT_FRAME_RATE;\n\n                    if (typeof desktopSharingFrameRate?.min === 'number' && desktopSharingFrameRate.min > 0) {\n                        minFps = desktopSharingFrameRate.min;\n                    }\n\n                    const trackConstraints: any = {\n                        frameRate: {\n                            min: minFps\n                        }\n                    };\n\n                    // Set the resolution if it is specified in the options. This is currently only enabled for testing.\n                    // Note that this may result in browser crashes if the shared window is resized due to browser bugs\n                    // like https://issues.chromium.org/issues/40672396\n                    if (resolution && this.options.testing?.testMode) {\n                        trackConstraints.height = resolution;\n                        trackConstraints.width = Math.floor(resolution * 16 / 9);\n                    }\n\n                    try {\n                        track.applyConstraints(trackConstraints);\n                    } catch (err) {\n                        logger.warn(`Min fps=${minFps} constraint could not be applied on the desktop track,`\n                            + `${err.message}`);\n                    }\n                }\n\n                const videoTracks = stream?.getVideoTracks();\n                const track = videoTracks?.length > 0 ? videoTracks[0] : undefined;\n                const { deviceId } = track?.getSettings() ?? {};\n\n                callback({\n                    // Used by remote-control to identify the display that is currently shared.\n                    sourceId: deviceId ?? stream.id,\n                    stream\n                });\n            })\n            .catch(error => {\n                const errorDetails = {\n                    errorCode: error.code,\n                    errorMsg: error.message,\n                    errorName: error.name,\n                    errorStack: error.stack\n                };\n\n                logger.warn('getDisplayMedia error', JSON.stringify(constraints), JSON.stringify(errorDetails));\n\n                if (errorDetails.errorCode === DOMException.NOT_SUPPORTED_ERR) {\n                    // This error is thrown when an Electron client has not set a permissions handler.\n                    errorCallback(new JitsiTrackError(JitsiTrackErrors.SCREENSHARING_NOT_SUPPORTED_ERROR));\n                } else if (errorDetails.errorMsg?.indexOf('denied by system') !== -1) {\n                    // On Chrome this is the only thing different between error returned when user cancels\n                    // and when no permission was given on the OS level.\n                    errorCallback(new JitsiTrackError(JitsiTrackErrors.PERMISSION_DENIED));\n                } else if (errorDetails.errorMsg === 'NotReadableError') {\n                    // This can happen under some weird conditions:\n                    //  - https://issues.chromium.org/issues/369103607\n                    //  - https://issues.chromium.org/issues/353555347\n                    errorCallback(new JitsiTrackError(JitsiTrackErrors.SCREENSHARING_GENERIC_ERROR));\n                } else {\n                    errorCallback(new JitsiTrackError(JitsiTrackErrors.SCREENSHARING_USER_CANCELED));\n                }\n            });\n    }\n\n    /**\n     * Obtains a screen capture stream using getDisplayMedia.\n     *\n     * @param callback - The success callback.\n     * @param errorCallback - The error callback.\n     * @internal\n     */\n    obtainScreenFromGetDisplayMediaRN(callback: (result: IScreenCaptureResult) => void, errorCallback: (error: JitsiTrackError) => void) {\n        logger.info('Using getDisplayMedia for screen sharing');\n\n        navigator.mediaDevices.getDisplayMedia({ video: true })\n            .then(stream => {\n                this.setContentHint(stream);\n                callback({\n                    sourceId: stream.id,\n                    stream\n                });\n            })\n            .catch(() => {\n                errorCallback(new JitsiTrackError(JitsiTrackErrors\n                    .SCREENSHARING_USER_CANCELED));\n            });\n    }\n\n    /** Sets the contentHint on the transmitted MediaStreamTrack to indicate charaterstics in the video stream, which\n     * informs RTCPeerConnection on how to encode the track (to prefer motion or individual frame detail).\n     *\n     * @param {MediaStream} stream - The captured desktop stream.\n     * @returns {void}\n     */\n    public setContentHint(stream: MediaStream): void {\n        const { desktopSharingFrameRate } = this.options;\n        const desktopTrack = stream.getVideoTracks()[0];\n\n        // Set contentHint on the desktop track based on the fps requested.\n        if ('contentHint' in desktopTrack) {\n            desktopTrack.contentHint = desktopSharingFrameRate?.max > SS_DEFAULT_FRAME_RATE ? 'motion' : 'detail';\n        } else {\n            logger.warn('MediaStreamTrack contentHint attribute not supported');\n        }\n    }\n\n    /**\n     * Checks whether obtaining a screen capture is supported in the current\n     * environment.\n     * @returns {boolean}\n     */\n    public isSupported(): boolean {\n        return this.obtainStream !== null;\n    }\n\n    /**\n     * Sets the max frame rate to be used for a desktop track capture.\n     *\n     * @param {number} maxFps capture frame rate to be used for desktop tracks.\n     * @returns {void}\n     */\n    public setDesktopSharingFrameRate(maxFps: number): void {\n        logger.info(`Setting the desktop capture rate to ${maxFps}`);\n\n        this.options.desktopSharingFrameRate = {\n            max: maxFps,\n            min: SS_DEFAULT_FRAME_RATE\n        };\n    }\n}\n\nexport default new ScreenObtainer();\n","import { getLogger } from '@jitsi/logger';\nimport { cloneDeep } from 'lodash-es';\nimport 'webrtc-adapter';\n\nimport JitsiTrackError from '../../JitsiTrackError';\nimport * as JitsiTrackErrors from '../../JitsiTrackErrors';\nimport { CameraFacingMode } from '../../service/RTC/CameraFacingMode';\nimport { RTCEvents } from '../../service/RTC/RTCEvents';\nimport Resolutions from '../../service/RTC/Resolutions';\nimport { VideoType } from '../../service/RTC/VideoType';\nimport { AnalyticsEvents } from '../../service/statistics/AnalyticsEvents';\nimport browser from '../browser';\nimport Statistics from '../statistics/statistics';\nimport Listenable from '../util/Listenable';\nimport { isValidNumber } from '../util/MathUtil';\n\nimport screenObtainer from './ScreenObtainer';\n\nconst logger = getLogger('rtc:RTCUtils');\n\nconst AVAILABLE_DEVICES_POLL_INTERVAL_TIME = 3000; // ms\n\n/**\n * Default MediaStreamConstraints to use for calls to getUserMedia.\n *\n * @private\n */\nconst DEFAULT_CONSTRAINTS = {\n    video: {\n        frameRate: {\n            max: 30,\n            min: 15\n        },\n        height: {\n            ideal: 720,\n            max: 720,\n            min: 180\n        },\n        width: {\n            ideal: 1280,\n            max: 1280,\n            min: 320\n        }\n    }\n};\n\n// Currently audio output device change is supported only in Chrome and\n// default output always has 'default' device ID\nlet audioOutputDeviceId = 'default'; // default device\n// whether user has explicitly set a device to use\nlet audioOutputChanged = false;\n\n// Disables all audio processing\nlet disableAP = false;\n\n// Disables Acoustic Echo Cancellation\nlet disableAEC = false;\n\n// Disables Noise Suppression\nlet disableNS = false;\n\n// Disables Automatic Gain Control\nlet disableAGC = false;\n\n// Enables stereo.\nlet stereo = null;\n\nconst featureDetectionAudioEl = document.createElement('audio');\nconst isAudioOutputDeviceChangeAvailable\n    = typeof featureDetectionAudioEl.setSinkId !== 'undefined';\n\nlet availableDevices = [];\nlet availableDevicesPollTimer;\n\n/**\n * An empty function.\n */\nfunction emptyFuncton() {\n    // no-op\n}\n\n/**\n * Creates a constraints object to be passed into a call to getUserMedia.\n *\n * @param {Array} um - An array of user media types to get. The accepted types are \"video\", \"audio\", and \"desktop.\"\n * @param {Object} options - Various values to be added to the constraints.\n * @param {string} options.cameraDeviceId - The device id for the video capture device to get video from.\n * @param {Object} options.constraints - Default constraints object to use as a base for the returned constraints.\n * @param {Object} options.desktopStream - The desktop source id from which to capture a desktop sharing video.\n * @param {string} options.facingMode - Which direction the camera is pointing to (applicable on mobile)\n * @param {string} options.micDeviceId - The device id for the audio capture device to get audio from.\n * @private\n * @returns {Object}\n */\nfunction getConstraints(um = [], options = {}) {\n    // Create a deep copy of the constraints to avoid any modification of the passed in constraints object.\n    const constraints = cloneDeep(options.constraints || DEFAULT_CONSTRAINTS);\n\n    if (um.indexOf('video') >= 0) {\n        if (!constraints.video) {\n            constraints.video = {};\n        }\n\n        // The \"resolution\" option is a shortcut and takes precendence.\n        if (Resolutions[options.resolution]) {\n            const r = Resolutions[options.resolution];\n\n            constraints.video.height = { ideal: r.height };\n            constraints.video.width = { ideal: r.width };\n        }\n\n        if (!constraints.video.frameRate) {\n            constraints.video.frameRate = DEFAULT_CONSTRAINTS.video.frameRate;\n        }\n\n        // Override the constraints on Safari because of the following webkit bug.\n        // https://bugs.webkit.org/show_bug.cgi?id=210932\n        // Camera doesn't start on older macOS versions if min/max constraints are specified.\n        // TODO: remove this hack when the bug fix is available on Mojave, Sierra and High Sierra.\n        if (browser.isWebKitBased()) {\n            if (constraints.video.height && constraints.video.height.ideal) {\n                constraints.video.height = { ideal: constraints.video.height.ideal };\n            } else {\n                logger.warn('Ideal camera height missing, camera may not start properly');\n            }\n            if (constraints.video.width && constraints.video.width.ideal) {\n                constraints.video.width = { ideal: constraints.video.width.ideal };\n            } else {\n                logger.warn('Ideal camera width missing, camera may not start properly');\n            }\n        }\n        if (options.cameraDeviceId) {\n            constraints.video.deviceId = { exact: options.cameraDeviceId };\n        } else if (browser.isMobileDevice()) {\n            constraints.video.facingMode = options.facingMode || CameraFacingMode.USER;\n        }\n    } else {\n        constraints.video = false;\n    }\n\n    if (um.indexOf('audio') >= 0) {\n        if (!constraints.audio || typeof constraints.audio === 'boolean') {\n            constraints.audio = {\n                autoGainControl: !disableAGC && !disableAP,\n                echoCancellation: !disableAEC && !disableAP,\n                noiseSuppression: !disableNS && !disableAP\n            };\n            if (stereo) {\n                Object.assign(constraints.audio, { channelCount: 2 });\n            }\n        } else {\n            const allowedAudioProps = {\n                autoGainControl: 'boolean',\n                channelCount: 'number',\n                echoCancellation: 'boolean',\n                noiseSuppression: 'boolean'\n            };\n\n            const validConstraints = {};\n\n            for (const [ key, value ] of Object.entries(constraints.audio)) {\n                if (allowedAudioProps[key]) {\n                    if (typeof value !== allowedAudioProps[key]) {\n                        continue;\n                    }\n                    if (key === 'channelCount' && ![ 1, 2 ].includes(value)) {\n                        continue;\n                    }\n                    validConstraints[key] = value;\n                }\n            }\n            constraints.audio = validConstraints;\n        }\n\n        if (options.micDeviceId) {\n            constraints.audio.deviceId = { exact: options.micDeviceId };\n        }\n    } else {\n        constraints.audio = false;\n    }\n\n    return constraints;\n}\n\n/**\n * Checks if new list of available media devices differs from previous one.\n * @param {MediaDeviceInfo[]} newDevices - list of new devices.\n * @returns {boolean} - true if list is different, false otherwise.\n */\nfunction compareAvailableMediaDevices(newDevices) {\n    if (newDevices.length !== availableDevices.length) {\n        return true;\n    }\n\n    /* eslint-disable newline-per-chained-call */\n\n    return (\n        newDevices.map(mediaDeviceInfoToJSON).sort().join('')\n            !== availableDevices\n                .map(mediaDeviceInfoToJSON).sort().join(''));\n\n    /* eslint-enable newline-per-chained-call */\n\n    /**\n     *\n     * @param info\n     */\n    function mediaDeviceInfoToJSON(info) {\n        return JSON.stringify({\n            deviceId: info.deviceId,\n            facing: info.facing,\n            groupId: info.groupId,\n            kind: info.kind,\n            label: info.label\n        });\n    }\n}\n\n/**\n * Sends analytics event with the passed device list.\n *\n * @param {Array<MediaDeviceInfo>} deviceList - List with info about the\n * available devices.\n * @returns {void}\n */\nfunction sendDeviceListToAnalytics(deviceList) {\n    const audioInputDeviceCount\n        = deviceList.filter(d => d.kind === 'audioinput').length;\n    const audioOutputDeviceCount\n        = deviceList.filter(d => d.kind === 'audiooutput').length;\n    const videoInputDeviceCount\n        = deviceList.filter(d => d.kind === 'videoinput').length;\n    const videoOutputDeviceCount\n        = deviceList.filter(d => d.kind === 'videooutput').length;\n\n    deviceList.forEach(device => {\n        const attributes = {\n            'audio_input_device_count': audioInputDeviceCount,\n            'audio_output_device_count': audioOutputDeviceCount,\n            'device_group_id': device.groupId,\n            'device_id': device.deviceId,\n            'device_kind': device.kind,\n            'device_label': device.label,\n            'video_input_device_count': videoInputDeviceCount,\n            'video_output_device_count': videoOutputDeviceCount\n        };\n\n        Statistics.sendAnalytics(AnalyticsEvents.AVAILABLE_DEVICE, attributes);\n    });\n}\n\n/**\n *\n */\nclass RTCUtils extends Listenable {\n    /**\n     *\n     */\n    constructor() {\n        super();\n\n        this._initOnce = false;\n    }\n\n    /**\n     * Depending on the browser, sets difference instance methods for\n     * interacting with user media and adds methods to native WebRTC-related\n     * objects. Also creates an instance variable for peer connection\n     * constraints.\n     *\n     * @param {Object} options\n     * @returns {void}\n     */\n    init(options = {}) {\n        if (typeof options.disableAEC === 'boolean') {\n            disableAEC = options.disableAEC;\n            logger.info(`Disable AEC: ${disableAEC}`);\n        }\n        if (typeof options.disableNS === 'boolean') {\n            disableNS = options.disableNS;\n            logger.info(`Disable NS: ${disableNS}`);\n        }\n        if (typeof options.disableAP === 'boolean') {\n            disableAP = options.disableAP;\n            logger.info(`Disable AP: ${disableAP}`);\n        }\n        if (typeof options.disableAGC === 'boolean') {\n            disableAGC = options.disableAGC;\n            logger.info(`Disable AGC: ${disableAGC}`);\n        }\n        if (typeof options.audioQuality?.stereo === 'boolean') {\n            stereo = options.audioQuality.stereo;\n            logger.info(`Stereo: ${stereo}`);\n        }\n\n        if (this._initOnce) {\n            return;\n        }\n\n        // Anything beyond this point needs to be initialized only once.\n        this._initOnce = true;\n\n        window.clearInterval(availableDevicesPollTimer);\n        availableDevicesPollTimer = undefined;\n\n        screenObtainer.init(options);\n\n        this.enumerateDevices(ds => {\n            availableDevices = ds.slice(0);\n\n            logger.debug('Available devices: ', availableDevices);\n            sendDeviceListToAnalytics(availableDevices);\n\n            this.eventEmitter.emit(\n                RTCEvents.DEVICE_LIST_AVAILABLE,\n                availableDevices);\n\n            if (browser.supportsDeviceChangeEvent()) {\n                navigator.mediaDevices.addEventListener(\n                    'devicechange',\n                    () => this.enumerateDevices(emptyFuncton));\n            } else {\n                // Periodically poll enumerateDevices() method to check if\n                // list of media devices has changed.\n                availableDevicesPollTimer = window.setInterval(\n                    () => this.enumerateDevices(emptyFuncton),\n                    AVAILABLE_DEVICES_POLL_INTERVAL_TIME);\n            }\n        });\n    }\n\n    /**\n     * Attaches the given media stream to the given element.\n     *\n     * @param {*} element DOM element.\n     * @param {*} stream MediaStream.\n     * @returns Promise<void>\n     */\n    attachMediaStream(element, stream) {\n        if (element) {\n            element.srcObject = stream;\n        }\n\n        if (element && stream\n                && this.isDeviceChangeAvailable('output')\n                && stream.getAudioTracks().length\n\n                // we skip setting audio output if there was no explicit change\n                && audioOutputChanged) {\n            return element.setSinkId(this.getAudioOutputDevice()).catch(ex => {\n                const err\n                    = new JitsiTrackError(ex, null, [ 'audiooutput' ]);\n\n                logger.warn(\n                    'Failed to set audio output device for the element.'\n                        + ' Default audio output device will be used'\n                        + ' instead',\n                    element?.id,\n                    err);\n\n                throw err;\n            });\n        }\n\n        return Promise.resolve();\n    }\n\n    /**\n     *\n     * @param {Function} callback\n     */\n    enumerateDevices(callback) {\n        navigator.mediaDevices.enumerateDevices()\n            .then(devices => {\n                this._updateKnownDevices(devices);\n                callback(devices);\n            })\n            .catch(error => {\n                logger.warn(`Failed to  enumerate devices. ${error}`);\n                this._updateKnownDevices([]);\n                callback([]);\n            });\n    }\n\n    /**\n     * Acquires a media stream via getUserMedia that\n     * matches the given constraints\n     *\n     * @param {array} umDevices which devices to acquire (e.g. audio, video)\n     * @param {Object} constraints - Stream specifications to use.\n     * @param {number} timeout - The timeout in ms for GUM.\n     * @returns {Promise}\n     */\n    _getUserMedia(umDevices, constraints = {}, timeout = 0) {\n        return new Promise((resolve, reject) => {\n            let gumTimeout, timeoutExpired = false;\n\n            if (isValidNumber(timeout) && timeout > 0) {\n                gumTimeout = setTimeout(() => {\n                    timeoutExpired = true;\n                    gumTimeout = undefined;\n                    reject(new JitsiTrackError(JitsiTrackErrors.TIMEOUT));\n                }, timeout);\n            }\n\n            navigator.mediaDevices.getUserMedia(constraints)\n                .then(stream => {\n                    logger.info('onUserMediaSuccess');\n                    this._updateGrantedPermissions(umDevices, stream);\n                    if (!timeoutExpired) {\n                        if (typeof gumTimeout !== 'undefined') {\n                            clearTimeout(gumTimeout);\n                        }\n                        resolve(stream);\n                    }\n                })\n                .catch(error => {\n                    logger.warn(`Failed to get access to local media. ${error} ${JSON.stringify(constraints)}`);\n                    const jitsiError = new JitsiTrackError(error, constraints, umDevices);\n\n                    if (!timeoutExpired) {\n                        if (typeof gumTimeout !== 'undefined') {\n                            clearTimeout(gumTimeout);\n                        }\n                        reject(jitsiError);\n                    }\n\n                    if (jitsiError.name === JitsiTrackErrors.PERMISSION_DENIED) {\n                        this._updateGrantedPermissions(umDevices, undefined);\n                    }\n                });\n        });\n    }\n\n    /**\n     * Acquire a display stream via the screenObtainer. This requires extra\n     * logic compared to use screenObtainer versus normal device capture logic\n     * in RTCUtils#_getUserMedia.\n     *\n     * @param {Object} options - Optional parameters.\n     * @returns {Promise} A promise which will be resolved with an object which\n     * contains the acquired display stream. If desktop sharing is not supported\n     * then a rejected promise will be returned.\n     */\n    _getDesktopMedia(options) {\n        if (!screenObtainer.isSupported()) {\n            return Promise.reject(new Error('Desktop sharing is not supported!'));\n        }\n\n        return new Promise((resolve, reject) => {\n            screenObtainer.obtainStream(\n                stream => {\n                    resolve(stream);\n                },\n                error => {\n                    reject(error);\n                },\n                options);\n        });\n    }\n\n    /**\n     * Private utility for determining if the passed in MediaStream contains\n     * tracks of the type(s) specified in the requested devices.\n     *\n     * @param {string[]} requestedDevices - The track types that are expected to\n     * be includes in the stream.\n     * @param {MediaStream} stream - The MediaStream to check if it has the\n     * expected track types.\n     * @returns {string[]} An array of string with the missing track types. The\n     * array will be empty if all requestedDevices are found in the stream.\n     */\n    _getMissingTracks(requestedDevices = [], stream) {\n        const missingDevices = [];\n\n        const audioDeviceRequested = requestedDevices.includes('audio');\n        const audioTracksReceived\n            = stream && stream.getAudioTracks().length > 0;\n\n        if (audioDeviceRequested && !audioTracksReceived) {\n            missingDevices.push('audio');\n        }\n\n        const videoDeviceRequested = requestedDevices.includes('video');\n        const videoTracksReceived\n            = stream && stream.getVideoTracks().length > 0;\n\n        if (videoDeviceRequested && !videoTracksReceived) {\n            missingDevices.push('video');\n        }\n\n        return missingDevices;\n    }\n\n    /**\n     * Event handler for the 'devicechange' event.\n     *\n     * @param {MediaDeviceInfo[]} devices - list of media devices.\n     * @emits RTCEvents.DEVICE_LIST_CHANGED\n     */\n    _onMediaDevicesListChanged(devicesReceived) {\n        availableDevices = devicesReceived.slice(0);\n        logger.info('list of media devices has changed:', availableDevices);\n\n        sendDeviceListToAnalytics(availableDevices);\n\n        // Used by tracks to update the real device id before the consumer of lib-jitsi-meet receives the\n        // new device list.\n        this.eventEmitter.emit(RTCEvents.DEVICE_LIST_WILL_CHANGE, availableDevices);\n\n        this.eventEmitter.emit(RTCEvents.DEVICE_LIST_CHANGED, availableDevices);\n    }\n\n    /**\n     * Update known devices.\n     *\n     * @param {Array<Object>} pds - The new devices.\n     * @returns {void}\n     *\n     * NOTE: Use this function as a shared callback to handle both the devicechange event and the\n     * polling implementations.\n     * This prevents duplication and works around a chrome bug (verified to occur on 68) where devicechange\n     * fires twice in a row, which can cause async post devicechange processing to collide.\n     */\n    _updateKnownDevices(pds) {\n        if (compareAvailableMediaDevices(pds)) {\n            this._onMediaDevicesListChanged(pds);\n        }\n    }\n\n    /**\n     * Updates the granted permissions based on the options we requested and the\n     * streams we received.\n     * @param um the options we requested to getUserMedia.\n     * @param stream the stream we received from calling getUserMedia.\n     */\n    _updateGrantedPermissions(um, stream) {\n        const audioTracksReceived\n            = Boolean(stream) && stream.getAudioTracks().length > 0;\n        const videoTracksReceived\n            = Boolean(stream) && stream.getVideoTracks().length > 0;\n        const grantedPermissions = {};\n\n        if (um.indexOf('video') !== -1) {\n            grantedPermissions.video = videoTracksReceived;\n        }\n        if (um.indexOf('audio') !== -1) {\n            grantedPermissions.audio = audioTracksReceived;\n        }\n\n        this.eventEmitter.emit(RTCEvents.PERMISSIONS_CHANGED, grantedPermissions);\n    }\n\n    /**\n     * Gets streams from specified device types. This function intentionally\n     * ignores errors for upstream to catch and handle instead.\n     *\n     * @param {Object} options - A hash describing what devices to get and\n     * relevant constraints.\n     * @param {string[]} options.devices - The types of media to capture. Valid\n     * values are \"desktop\", \"audio\", and \"video\".\n     * @param {Object} [options.desktopSharingFrameRate]\n     * @param {Object} [options.desktopSharingFrameRate.min] - Minimum fps\n     * @param {Object} [options.desktopSharingFrameRate.max] - Maximum fps\n     * @param {string} [options.desktopSharingSourceDevice] - The device id or\n     * label for a video input source that should be used for screensharing.\n     * @param {string[]} [options.desktopSharingSources] - The types of sources (\"screen\", \"window\", etc)\n     * from which the user can select what to share.\n     * @param {string} [options.cameraDeviceId] - Camera device id\n     * @param {string} [options.micDeviceId] - Microphone device id\n     * @param {string} [options.resolution] - Resolution constraints\n     * @param {IStreamEffect[]} [options.effects] - Optional effects array for the track\n     * @param {ITrackConstraints} [options.constraints] - The constraints to use for\n     * the audio and video tracks.\n     * @returns {Promise<IStreamInfo[]>} The promise, when successful, will return an array of\n     * meta data for the requested device type, which includes the stream and\n     * track. If an error occurs, it will be deferred to the caller for\n     * handling.\n     */\n    obtainAudioAndVideoPermissions(options) {\n        const {\n            timeout,\n            ...otherOptions\n        } = options;\n\n        const mediaStreamsMetaData = [];\n        let constraints = {};\n\n        // Declare private functions to be used in the promise chain below.\n        // These functions are declared in the scope of this function because\n        // they are not being used anywhere else, so only this function needs to\n        // know about them.\n\n        /**\n         * Executes a request for desktop media if specified in options.\n         *\n         * @returns {Promise}\n         */\n        const maybeRequestDesktopDevice = function() {\n            const umDevices = otherOptions.devices || [];\n            const isDesktopDeviceRequested\n                = umDevices.indexOf('desktop') !== -1;\n\n            if (!isDesktopDeviceRequested) {\n                return Promise.resolve();\n            }\n\n            const {\n                desktopSharingSourceDevice,\n                desktopSharingSources,\n                resolution\n            } = otherOptions;\n\n            // Attempt to use a video input device as a screenshare source if\n            // the option is defined.\n            if (desktopSharingSourceDevice) {\n                const matchingDevice\n                    = availableDevices && availableDevices.find(device =>\n                        device.kind === 'videoinput'\n                            && (device.deviceId === desktopSharingSourceDevice\n                            || device.label === desktopSharingSourceDevice));\n\n                if (!matchingDevice) {\n                    return Promise.reject(new JitsiTrackError(\n                        { name: 'ConstraintNotSatisfiedError' },\n                        {},\n                        [ desktopSharingSourceDevice ]\n                    ));\n                }\n\n                const requestedDevices = [ 'video' ];\n                const deviceConstraints = {\n                    video: {\n                        deviceId: matchingDevice.deviceId\n\n                        // frameRate is omited here on purpose since this is a device that we'll pretend is a screen.\n                    }\n                };\n\n                return this._getUserMedia(requestedDevices, deviceConstraints, timeout)\n                    .then(stream => {\n                        return {\n                            sourceType: 'device',\n                            stream\n                        };\n                    });\n            }\n\n            return this._getDesktopMedia({\n                desktopSharingSources,\n                resolution });\n        }.bind(this);\n\n        /**\n         * Creates a meta data object about the passed in desktopStream and\n         * pushes the meta data to the internal array mediaStreamsMetaData to be\n         * returned later.\n         *\n         * @param {MediaStreamTrack} desktopStream - A track for a desktop\n         * capture.\n         * @returns {void}\n         */\n        const maybeCreateAndAddDesktopTrack = function(desktopStream) {\n            if (!desktopStream) {\n                return;\n            }\n\n            const { stream, sourceId, sourceType } = desktopStream;\n\n            const desktopAudioTracks = stream.getAudioTracks();\n\n            if (desktopAudioTracks.length) {\n                const desktopAudioStream = new MediaStream(desktopAudioTracks);\n\n                mediaStreamsMetaData.push({\n                    sourceId,\n                    sourceType,\n                    stream: desktopAudioStream,\n                    track: desktopAudioStream.getAudioTracks()[0]\n                });\n            }\n\n            const desktopVideoTracks = stream.getVideoTracks();\n\n            if (desktopVideoTracks.length) {\n                const desktopVideoStream = new MediaStream(desktopVideoTracks);\n\n                mediaStreamsMetaData.push({\n                    sourceId,\n                    sourceType,\n                    stream: desktopVideoStream,\n                    track: desktopVideoStream.getVideoTracks()[0],\n                    videoType: VideoType.DESKTOP\n                });\n            }\n        };\n\n        /**\n         * Executes a request for audio and/or video, as specified in options.\n         * By default both audio and video will be captured if options.devices\n         * is not defined.\n         *\n         * @returns {Promise}\n         */\n        const maybeRequestCaptureDevices = function() {\n            const umDevices = otherOptions.devices || [ 'audio', 'video' ];\n            const requestedCaptureDevices = umDevices.filter(device => device === 'audio' || device === 'video');\n\n            if (!requestedCaptureDevices.length) {\n                return Promise.resolve();\n            }\n\n            constraints = getConstraints(requestedCaptureDevices, otherOptions);\n\n            logger.info('Got media constraints: ', JSON.stringify(constraints));\n\n            return this._getUserMedia(requestedCaptureDevices, constraints, timeout);\n        }.bind(this);\n\n        /**\n         * Splits the passed in media stream into separate audio and video\n         * streams and creates meta data objects for each and pushes them to the\n         * internal array mediaStreamsMetaData to be returned later.\n         *\n         * @param {MediaStreamTrack} avStream - A track for with audio and/or\n         * video track.\n         * @returns {void}\n         */\n        const maybeCreateAndAddAVTracks = function(avStream) {\n            if (!avStream) {\n                return;\n            }\n\n            const audioTracks = avStream.getAudioTracks();\n\n            if (audioTracks.length) {\n                const audioStream = new MediaStream(audioTracks);\n\n                mediaStreamsMetaData.push({\n                    constraints: constraints.audio,\n                    effects: otherOptions.effects,\n                    stream: audioStream,\n                    track: audioStream.getAudioTracks()[0]\n                });\n            }\n\n            const videoTracks = avStream.getVideoTracks();\n\n            if (videoTracks.length) {\n                const videoStream = new MediaStream(videoTracks);\n\n                mediaStreamsMetaData.push({\n                    constraints: constraints.video,\n                    effects: otherOptions.effects,\n                    stream: videoStream,\n                    track: videoStream.getVideoTracks()[0],\n                    videoType: VideoType.CAMERA\n                });\n            }\n        };\n\n        return maybeRequestDesktopDevice()\n            .then(maybeCreateAndAddDesktopTrack)\n            .then(maybeRequestCaptureDevices)\n            .then(maybeCreateAndAddAVTracks)\n            .then(() => mediaStreamsMetaData)\n            .catch(error => {\n                mediaStreamsMetaData.forEach(({ stream }) => {\n                    this.stopMediaStream(stream);\n                });\n\n                return Promise.reject(error);\n            });\n    }\n\n    /**\n     * Returns true if changing the input (camera / microphone) or output\n     * (audio) device is supported and false if not.\n     * @params {string} [deviceType] - type of device to change. Default is\n     *      undefined or 'input', 'output' - for audio output device change.\n     * @returns {boolean} true if available, false otherwise.\n     */\n    isDeviceChangeAvailable(deviceType) {\n        if (deviceType === 'output' || deviceType === 'audiooutput') {\n            return isAudioOutputDeviceChangeAvailable;\n        }\n\n        return true;\n    }\n\n    /**\n     * A method to handle stopping of the stream.\n     * One point to handle the differences in various implementations.\n     * @param mediaStream MediaStream object to stop.\n     */\n    stopMediaStream(mediaStream) {\n        if (!mediaStream) {\n            return;\n        }\n\n        mediaStream.getTracks().forEach(track => {\n            if (track.stop) {\n                track.stop();\n            }\n        });\n\n        // leave stop for implementation still using it\n        if (mediaStream.stop) {\n            mediaStream.stop();\n        }\n\n        // The MediaStream implementation of the react-native-webrtc project has\n        // an explicit release method that is to be invoked in order to release\n        // used resources such as memory.\n        if (mediaStream.release) {\n            mediaStream.release();\n        }\n    }\n\n    /**\n     * Returns whether the desktop sharing is enabled or not.\n     * @returns {boolean}\n     */\n    isDesktopSharingEnabled() {\n        return screenObtainer.isSupported();\n    }\n\n    /**\n     * Sets current audio output device.\n     * @param {string} deviceId - id of 'audiooutput' device from\n     *      navigator.mediaDevices.enumerateDevices(), 'default' for default\n     *      device\n     * @returns {Promise} - resolves when audio output is changed, is rejected\n     *      otherwise\n     */\n    setAudioOutputDevice(deviceId) {\n        if (!this.isDeviceChangeAvailable('output')) {\n            return Promise.reject(\n                new Error('Audio output device change is not supported'));\n        }\n\n        return featureDetectionAudioEl.setSinkId(deviceId)\n            .then(() => {\n                audioOutputDeviceId = deviceId;\n                audioOutputChanged = true;\n\n                logger.debug(`Audio output device set to ${deviceId}`);\n\n                this.eventEmitter.emit(RTCEvents.AUDIO_OUTPUT_DEVICE_CHANGED,\n                    deviceId);\n            });\n    }\n\n    /**\n     * Sets the capture frame rate for desktop tracks.\n     *\n     * @param {number} maxFps - max fps to be used as the capture frame rate.\n     * @returns {void}\n     */\n    setDesktopSharingFrameRate(maxFps) {\n        screenObtainer.setDesktopSharingFrameRate(maxFps);\n    }\n\n    /**\n     * Returns currently used audio output device id, '' stands for default\n     * device\n     * @returns {string}\n     */\n    getAudioOutputDevice() {\n        return audioOutputDeviceId;\n    }\n\n    /**\n     * Returns list of available media devices if its obtained, otherwise an\n     * empty array is returned/\n     * @returns {Array} list of available media devices.\n     */\n    getCurrentlyAvailableMediaDevices() {\n        return availableDevices;\n    }\n\n    /**\n     * Returns event data for device to be reported to stats.\n     * @returns {MediaDeviceInfo} device.\n     */\n    getEventDataForActiveDevice(device) {\n        const deviceList = [];\n        const deviceData = {\n            deviceId: device.deviceId,\n            groupId: device.groupId,\n            kind: device.kind,\n            label: device.label\n        };\n\n        deviceList.push(deviceData);\n\n        return { deviceList };\n    }\n\n    /**\n     * Returns <tt>true<tt/> if a WebRTC MediaStream identified by given stream\n     * ID is considered a valid \"user\" stream which means that it's not a\n     * \"receive only\" stream nor a \"mixed\" JVB stream.\n     *\n     * Clients that implement Unified Plan, such as Firefox use recvonly\n     * \"streams/channels/tracks\" for receiving remote stream/tracks, as opposed\n     * to Plan B where there are only 3 channels: audio, video and data.\n     *\n     * @param {string} streamId The id of WebRTC MediaStream.\n     * @returns {boolean}\n     */\n    isUserStreamById(streamId) {\n        return streamId && streamId !== 'mixedmslabel' && streamId !== 'default';\n    }\n}\n\n\nexport default new RTCUtils();\n","import { getLogger } from '@jitsi/logger';\n\nimport JitsiConference from '../../JitsiConference';\nimport { JitsiTrackEvents } from '../../JitsiTrackEvents';\nimport { MediaType } from '../../service/RTC/MediaType';\nimport { VideoType } from '../../service/RTC/VideoType';\nimport browser from '../browser';\nimport Listenable from '../util/Listenable';\n\nimport RTCUtils from './RTCUtils';\nimport TraceablePeerConnection from './TraceablePeerConnection';\n\n\nconst logger = getLogger('rtc:JitsiTrack');\n\n/**\n * Type for MediaStreamTrack event handler functions.\n */\ntype MediaStreamTrackEventHandler = Optional<((this: MediaStreamTrack, ev: Event) => void)>;\n\n/**\n * Maps our handler types to MediaStreamTrack properties.\n */\nconst trackHandler2Prop = {\n    'track_ended': 'onended',\n    'track_mute': 'onmute', // Not supported on FF\n    'track_unmute': 'onunmute'\n};\n\n/**\n * Extended MediaStreamTrack interface that includes mobile-specific camera methods.\n */\nexport interface IExtendedMediaStreamTrack extends MediaStreamTrack {\n    _switchCamera?: () => void;\n}\n\n/**\n * Extended MediaStream interface that allows setting the muted property.\n */\nexport interface IExtendedMediaStream extends MediaStream {\n    muted?: boolean;\n}\n\n\n/**\n * Represents a single media track (either audio or video).\n *\n * @noInheritDoc\n */\nexport default class JitsiTrack extends Listenable {\n    private _streamInactiveHandler: MediaStreamTrackEventHandler;\n    private audioLevel: number;\n    private type: MediaType;\n    private handlers: Map<string, MediaStreamTrackEventHandler>;\n    protected containers: HTMLElement[];\n    /**\n     *  @internal\n     */\n    stream: IExtendedMediaStream;\n    /**\n     * @internal\n     */\n    track: IExtendedMediaStreamTrack;\n    public conference: JitsiConference;\n    public videoType: Optional<VideoType>;\n    public disposed: boolean;\n\n    /* eslint-disable max-params */\n    /**\n     * Represents a single media track (either audio or video).\n     * @param conference the rtc instance\n     * @param stream the WebRTC MediaStream instance\n     * @param track the WebRTC MediaStreamTrack instance, must be part of\n     * the given <tt>stream</tt>.\n     * @param streamInactiveHandler the function that will handle\n     *        onended/oninactive events of the stream.\n     * @param trackMediaType the media type of the JitsiTrack\n     * @param videoType the VideoType for this track if any\n     */\n    constructor(\n            conference: JitsiConference,\n            stream: MediaStream,\n            track: MediaStreamTrack,\n            streamInactiveHandler: MediaStreamTrackEventHandler,\n            trackMediaType: MediaType,\n            videoType?: VideoType\n    ) {\n        super();\n\n        /**\n         * Array with the HTML elements that are displaying the streams.\n         * @type {Array}\n         */\n        this.containers = [];\n        this.conference = conference;\n        this.audioLevel = -1;\n        this.type = trackMediaType;\n        this.track = track;\n        this.videoType = videoType;\n        this.handlers = new Map();\n\n        /**\n         * Indicates whether this JitsiTrack has been disposed. If true, this\n         * JitsiTrack is to be considered unusable and operations involving it\n         * are to fail (e.g. {@link JitsiConference#addTrack(JitsiTrack)},\n         * {@link JitsiConference#removeTrack(JitsiTrack)}).\n         * @type {boolean}\n         */\n        this.disposed = false;\n\n        /**\n         * The inactive handler which will be triggered when the underlying\n         * <tt>MediaStream</tt> ends.\n         *\n         * @private\n         * @type {Function}\n         */\n        this._streamInactiveHandler = streamInactiveHandler;\n\n        this._setStream(stream);\n    }\n\n    /**\n     * Adds onended/oninactive handler to a MediaStream or a MediaStreamTrack.\n     * Firefox doesn't fire a inactive event on the MediaStream, instead it fires\n     * a onended event on the MediaStreamTrack.\n     * @param {Function} handler the handler\n     */\n    private _addMediaStreamInactiveHandler(handler: MediaStreamTrackEventHandler): void {\n        if (browser.isFirefox() || browser.isWebKitBased()) {\n            this.track.onended = handler;\n        } else {\n            this.stream.oninactive = handler;\n        }\n    }\n\n    /**\n     * Attach time to first media tracker only if there is conference and only\n     * for the first element.\n     *\n     * @param {HTMLElement} container the HTML container which can be 'video' or\n     * 'audio' element.\n     * @internal\n     */\n    protected _attachTTFMTracker(_container: HTMLElement): void {\n        // Should be defined by the classes that are extending JitsiTrack\n    }\n\n    /**\n     * Called when the track has been attached to a new container.\n     *\n     * @param {HTMLElement} container the HTML container which can be 'video' or\n     * 'audio' element.\n     */\n    protected _onTrackAttach(_container: HTMLElement): void {\n        // Should be defined by the classes that are extending JitsiTrack\n    }\n\n    /**\n     * Called when the track has been detached from a container.\n     *\n     * @param {HTMLElement} container the HTML container which can be 'video' or\n     * 'audio' element.\n     */\n    protected _onTrackDetach(_container: HTMLElement): void {\n        // Should be defined by the classes that are extending JitsiTrack\n    }\n\n    /**\n     * Sets the stream property of JitsiTrack object and sets all stored\n     * handlers to it.\n     *\n     * @param {MediaStream} stream the new stream.\n     */\n    protected _setStream(stream: MediaStream): void {\n        if (this.stream === stream) {\n            return;\n        }\n\n        this.stream = stream;\n\n        // TODO Practically, that's like the opposite of _unregisterHandlers\n        // i.e. may be abstracted into a function/method called\n        // _registerHandlers for clarity and easing the maintenance of the two\n        // pieces of source code.\n        if (this.stream) {\n            for (const type of this.handlers.keys()) {\n                this._setHandler(type, this.handlers.get(type));\n            }\n            if (this._streamInactiveHandler) {\n                this._addMediaStreamInactiveHandler(this._streamInactiveHandler);\n            }\n        }\n    }\n\n    /**\n     * Unregisters all event handlers bound to the underlying media stream/track.\n     */\n    protected _unregisterHandlers(): void {\n        if (!this.stream) {\n            logger.warn(\n                `${this}: unable to unregister handlers - no stream object`);\n\n            return;\n        }\n\n        for (const type of this.handlers.keys()) {\n            // FIXME Why only video tracks?\n            for (const videoTrack of this.stream.getVideoTracks()) {\n                videoTrack[trackHandler2Prop[type]] = undefined;\n            }\n        }\n        if (this._streamInactiveHandler) {\n            this._addMediaStreamInactiveHandler(undefined);\n        }\n    }\n\n\n    /**\n     * Sets handler to the WebRTC MediaStream or MediaStreamTrack object\n     * depending on the passed type.\n     * @param {string} type the type of the handler that is going to be set\n     * @param {Function} handler the handler.\n     * @internal\n     */\n    _setHandler(type: string, handler: MediaStreamTrackEventHandler): void {\n        if (!trackHandler2Prop.hasOwnProperty(type)) {\n            logger.error(`Invalid handler type ${type}`);\n\n            return;\n        }\n        if (handler) {\n            this.handlers.set(type, handler);\n        } else {\n            this.handlers.delete(type);\n        }\n\n        if (this.stream) {\n            for (const track of this.stream.getTracks()) {\n                track[trackHandler2Prop[type]] = handler;\n            }\n        }\n    }\n\n    /**\n     * Checks whether the underlying WebRTC <tt>MediaStreamTrack</tt> is muted\n     * according to it's 'muted' field status.\n     * @return {boolean} <tt>true</tt> if the underlying\n     * <tt>MediaStreamTrack</tt> is muted or <tt>false</tt> otherwise.\n     * @internal\n     */\n    isWebRTCTrackMuted(): boolean {\n        return this.track?.muted;\n    }\n\n    /**\n     * Attaches the MediaStream of this track to an HTML container.\n     * Adds the container to the list of containers that are displaying the\n     * track.\n     *\n     * @param container the HTML container which can be 'video' or 'audio'\n     * element.\n     *\n     * @returns {void}\n     */\n    public attach(container: HTMLElement): Promise<void> {\n        let result = Promise.resolve();\n\n        if (this.stream) {\n            this._onTrackAttach(container);\n            result = RTCUtils.attachMediaStream(container, this.stream);\n        }\n        this.containers.push(container);\n        this._attachTTFMTracker(container);\n\n        return result;\n    }\n\n    /**\n     * Removes this JitsiTrack from the passed HTML container.\n     *\n     * @param container the HTML container to detach from this JitsiTrack. If\n     * <tt>null</tt> or <tt>undefined</tt>, all containers are removed. A\n     * container can be a 'video', 'audio' or 'object' HTML element instance to\n     * which this JitsiTrack is currently attached.\n     */\n    public detach(container?: HTMLElement): void {\n        for (let cs = this.containers, i = cs.length - 1; i >= 0; --i) {\n            const c = cs[i];\n\n            if (!container) {\n                this._onTrackDetach(c);\n                RTCUtils.attachMediaStream(c, null).catch(() => {\n                    logger.error(`Detach for ${this} failed!`);\n                });\n            }\n            if (!container || c === container) {\n                cs.splice(i, 1);\n            }\n        }\n\n        if (container) {\n            this._onTrackDetach(container);\n            RTCUtils.attachMediaStream(container, null).catch(() => {\n                logger.error(`Detach for ${this} failed!`);\n            });\n        }\n    }\n\n    /**\n     * Removes attached event listeners.\n     *\n     * @returns {Promise}\n     */\n    public dispose(): Promise<void> {\n        const p = Promise.resolve();\n\n        if (this.disposed) {\n            return p;\n        }\n\n        this.detach();\n        this.removeAllListeners();\n\n        this.disposed = true;\n\n        return p;\n    }\n\n    /**\n     * Returns id of the track.\n     * @returns {string|null} id of the track or null if this is fake track.\n     */\n    public getId(): Nullable<string> {\n        return this.getStreamId();\n    }\n\n    /**\n     * Returns the WebRTC MediaStream instance.\n     */\n    public getOriginalStream(): MediaStream {\n        return this.stream;\n    }\n\n    /**\n     * Returns the source name of the track.\n     * @returns {String|undefined}\n     */\n    public getSourceName(): Optional<string> {\n        // Should be defined by the classes that are extending JitsiTrack\n        return undefined;\n    }\n\n    /**\n     * Returns the primary SSRC associated with the track.\n     * @returns {number}\n     */\n    public getSsrc(): Optional<number> { // eslint-disable-line no-unused-vars\n        // Should be defined by the classes that are extending JitsiTrack\n        return undefined;\n    }\n\n    /**\n     * Returns the ID of the underlying WebRTC Media Stream(if any)\n     * @returns {String|null}\n     */\n    public getStreamId(): Nullable<string> {\n        return this.stream ? this.stream.id : null;\n    }\n\n    /**\n     * Return the underlying WebRTC MediaStreamTrack\n     * @returns {MediaStreamTrack}\n     */\n    public getTrack(): MediaStreamTrack {\n        return this.track;\n    }\n\n    /**\n     * Return the underlying WebRTC MediaStreamTrack label\n     * @returns {string}\n     */\n    public getTrackLabel(): string {\n        return this.track.label;\n    }\n\n    /**\n     * Returns the ID of the underlying WebRTC MediaStreamTrack(if any)\n     * @returns {String|null}\n     */\n    public getTrackId(): Nullable<string> {\n        return this.track ? this.track.id : null;\n    }\n\n    /**\n     * Returns the type (audio or video) of this track.\n     */\n    public getType(): MediaType {\n        return this.type;\n    }\n\n    /**\n     * Return meaningful usage label for this track depending on it's media and\n     * eventual video type.\n     * @returns {string}\n     */\n    public getUsageLabel(): string {\n        if (this.isAudioTrack()) {\n            return 'mic';\n        }\n\n        return this.videoType ? this.videoType : 'default';\n    }\n\n    /**\n     * Returns the video type (camera or desktop) of this track.\n     */\n    public getVideoType(): Optional<VideoType> {\n        return this.videoType;\n    }\n\n    /**\n     * Returns the height of the track in normalized landscape format.\n     */\n    public getHeight(): number {\n        return Math.min(this.track.getSettings().height, this.track.getSettings().width);\n    }\n\n    /**\n     * Returns the width of the track in normalized landscape format.\n     */\n    public getWidth(): number {\n        return Math.max(this.track.getSettings().height, this.track.getSettings().width);\n    }\n\n    /**\n     * Checks whether the MediaStream is active/not ended.\n     * When there is no check for active we don't have information and so\n     * will return that stream is active (in case of FF).\n     * @returns {boolean} whether MediaStream is active.\n     */\n    public isActive(): boolean {\n        if (typeof this.stream.active !== 'undefined') {\n            return this.stream.active;\n        }\n\n        return true;\n    }\n\n    /**\n     * Check if this is an audio track.\n     */\n    public isAudioTrack(): boolean {\n        return this.getType() === MediaType.AUDIO;\n    }\n\n    /**\n     * Checks whether this is a local track.\n     * @abstract\n     * @return {boolean} 'true' if it's a local track or 'false' otherwise.\n     */\n    public isLocal() {\n        return false;\n    }\n\n    /**\n     * Check whether this is a local audio track.\n     *\n     * @return {boolean} -  true if track represents a local audio track, false otherwise.\n     */\n    public isLocalAudioTrack(): boolean {\n        return this.isAudioTrack() && this.isLocal();\n    }\n\n    /**\n     * Check if this is a video track.\n     */\n    public isVideoTrack(): boolean {\n        return this.getType() === MediaType.VIDEO;\n    }\n\n    /**\n     * Checks whether this track is muted.\n     * @abstract\n     * @return {boolean}\n     */\n    public isMuted(): boolean {\n        return false;\n    }\n\n    /**\n     * Sets the audio level for the stream\n     * @param {number} audioLevel value between 0 and 1\n     * @param {TraceablePeerConnection} [tpc] the peerconnection instance which\n     * is source for the audio level. It can be <tt>undefined</tt> for\n     * a local track if the audio level was measured outside of the\n     * peerconnection (see /modules/statistics/LocalStatsCollector.js).\n     */\n    public setAudioLevel(audioLevel: number, tpc?: TraceablePeerConnection): void {\n        let newAudioLevel = audioLevel;\n\n        // When using getSynchornizationSources on the audio receiver to gather audio levels for\n        // remote tracks, browser reports last known audio levels even when the remote user is\n        // audio muted, we need to reset the value to zero here so that the audio levels are cleared.\n        // Remote tracks have the tpc info present while local tracks do not.\n        if (browser.supportsReceiverStats() && typeof tpc !== 'undefined' && this.isMuted()) {\n            newAudioLevel = 0;\n        }\n\n        if (this.audioLevel !== newAudioLevel) {\n            this.audioLevel = newAudioLevel;\n            this.emit(\n                JitsiTrackEvents.TRACK_AUDIO_LEVEL_CHANGED,\n                newAudioLevel,\n                tpc);\n\n        // LocalStatsCollector reports a value of 0.008 for muted mics\n        // and a value of 0 when there is no audio input.\n        } else if (this.audioLevel === 0\n            && newAudioLevel === 0\n            && this.isLocal()\n            && !this.isWebRTCTrackMuted()) {\n            this.emit(\n                JitsiTrackEvents.NO_AUDIO_INPUT,\n                newAudioLevel);\n        }\n    }\n\n    /**\n     * Sets new audio output device for track's DOM elements. Video tracks are\n     * ignored. Emits `JitsiTrackEvents.TRACK_AUDIO_OUTPUT_CHANGED`.\n     * @param {string} audioOutputDeviceId - id of 'audiooutput' device from\n     *      navigator.mediaDevices.enumerateDevices(), '' for default device\n     * @returns {Promise}\n     */\n    public setAudioOutput(audioOutputDeviceId: string): Promise<void> {\n        if (!RTCUtils.isDeviceChangeAvailable('output')) {\n            return Promise.reject(\n                new Error('Audio output device change is not supported'));\n        }\n\n        // All audio communication is done through audio tracks, so ignore\n        // changing audio output for video tracks at all.\n        if (this.isVideoTrack()) {\n            return Promise.resolve();\n        }\n\n        return (\n            Promise.all(\n                this.containers.map(\n                    element =>\n                        (element as HTMLAudioElement | HTMLVideoElement).setSinkId(audioOutputDeviceId)\n                            .catch(error => {\n                                logger.warn(\n                                    'Failed to change audio output device on'\n                                        + ' element. Default or previously set'\n                                        + ' audio output device will be used.',\n                                    element,\n                                    error);\n                                throw error;\n                            }))\n            )\n                .then(() => {\n                    this.emit(\n                        JitsiTrackEvents.TRACK_AUDIO_OUTPUT_CHANGED,\n                        audioOutputDeviceId);\n                }));\n    }\n\n    /**\n     * Assigns the source name to a track.\n     * @param {String} _name - The name to be assigned to the track.\n     * @returns {void}\n     */\n    public setSourceName(_name: string): void {\n        // Should be defined by the classes that are extending JitsiTrack\n    }\n}\n","import { getLogger } from '@jitsi/logger';\n\nimport JitsiConference from '../../JitsiConference';\nimport JitsiTrackError from '../../JitsiTrackError';\nimport {\n    JitsiTrackErrors,\n    TRACK_IS_DISPOSED,\n    TRACK_NO_STREAM_FOUND\n} from '../../JitsiTrackErrors';\nimport { JitsiTrackEvents } from '../../JitsiTrackEvents';\nimport { CameraFacingMode } from '../../service/RTC/CameraFacingMode';\nimport { MediaType } from '../../service/RTC/MediaType';\nimport { RTCEvents } from '../../service/RTC/RTCEvents';\nimport { VideoType } from '../../service/RTC/VideoType';\nimport {\n    AnalyticsEvents,\n    createNoDataFromSourceEvent\n} from '../../service/statistics/AnalyticsEvents';\nimport RTCStats from '../RTCStats/RTCStats';\nimport { RTCStatsEvents } from '../RTCStats/RTCStatsEvents';\nimport browser from '../browser';\nimport VADAudioAnalyser from '../detection/VADAudioAnalyser';\nimport Statistics from '../statistics/statistics';\nimport { isValidNumber } from '../util/MathUtil';\n\nimport JitsiTrack from './JitsiTrack';\nimport RTCUtils from './RTCUtils';\nimport TraceablePeerConnection from './TraceablePeerConnection';\n\nconst logger = getLogger('rtc:JitsiLocalTrack');\n\nexport interface IStreamEffect {\n    isEnabled: (track: JitsiLocalTrack) => boolean;\n    isMuted?: () => boolean;\n    setMuted?: (muted: boolean) => void;\n    startEffect: (stream: MediaStream) => MediaStream;\n    stopEffect: () => void;\n}\n\nexport interface ITrackMetadata {\n    displaySurface?: string;\n    timestamp: number;\n}\n\nexport interface ITrackConstraints {\n    [key: string]: any;\n    height?: any;\n    width?: any;\n}\n\nexport interface ITrackInfo {\n    constraints: ITrackConstraints;\n    deviceId: string;\n    effects?: IStreamEffect[];\n    facingMode?: CameraFacingMode;\n    mediaType: MediaType;\n    rtcId: number;\n    sourceId?: string;\n    sourceType?: string;\n    stream: MediaStream;\n    track: MediaStreamTrack;\n    videoType?: VideoType;\n}\n\nexport interface IStreamInfo {\n    stream: MediaStream;\n    track: MediaStreamTrack;\n    videoType?: VideoType;\n}\n\nexport interface IAudioConstraints {\n    autoGainControl?: boolean;\n    channelCount?: number;\n    echoCancellation?: boolean;\n    noiseSuppression?: boolean;\n}\n\n/**\n * Represents a single media track(either audio or video).\n * One <tt>JitsiLocalTrack</tt> corresponds to one WebRTC MediaStreamTrack.\n */\nexport default class JitsiLocalTrack extends JitsiTrack {\n    private _setEffectInProgress: boolean;\n    private _constraints: ITrackConstraints;\n    private _prevSetMuted: Promise<void>;\n    private _facingMode?: CameraFacingMode;\n    private _trackEnded: boolean;\n    private _hasSentData: boolean;\n    private _testDataSent: boolean;\n    private _realDeviceId?: string;\n    private _sourceName?: string;\n    private _ssrc?: number;\n    private _trackMutedTS: number;\n    private _onDeviceListWillChange: (devices: MediaDeviceInfo[]) => void;\n    private _onAudioOutputDeviceChanged?: () => void;\n    private _streamEffect?: IStreamEffect;\n    private _originalStream?: MediaStream;\n    private _stopStreamInProgress: boolean;\n    private _effectEnabled?: boolean;\n    public metadata: ITrackMetadata;\n    public rtcId: number;\n    public sourceId?: string;\n    public sourceType?: string;\n    public deviceId: string;\n    public resolution?: number;\n    public maxEnabledResolution?: number;\n\n    /**\n     * Constructs a new JitsiLocalTrack instance.\n     *\n     * @param {Object} trackInfo\n     * @param {Object} trackInfo.constraints - The contraints used for creating the track.\n     * @param {number} trackInfo.rtcId - The ID assigned by the RTC module.\n     * @param {Object} trackInfo.stream - The WebRTC MediaStream, parent of the track.\n     * @param {Object} trackInfo.track - The underlying WebRTC MediaStreamTrack for new JitsiLocalTrack.\n     * @param {string} trackInfo.mediaType - The MediaType of the JitsiLocalTrack.\n     * @param {string} trackInfo.videoType - The VideoType of the JitsiLocalTrack.\n     * @param {Array<Object>} trackInfo.effects - The effects to be applied to the JitsiLocalTrack.\n     * @param {string} trackInfo.deviceId - The ID of the local device for this track.\n     * @param {string} trackInfo.facingMode - Thehe camera facing mode used in getUserMedia call (for mobile only).\n     * @param {string} trackInfo.sourceId - The id of the desktop sharing source, which is the Chrome media source ID,\n     * returned by Desktop Picker on Electron. NOTE: defined for desktop sharing tracks only.\n     * @param {string} trackInfo.sourceType - The type of source the track originates from.\n     *\n     * @noInheritDoc\n     */\n    constructor({\n        constraints,\n        deviceId,\n        facingMode,\n        mediaType,\n        rtcId,\n        sourceId,\n        sourceType,\n        stream,\n        track,\n        videoType,\n        effects = []\n    }: ITrackInfo) {\n        super(\n            /* conference */ null,\n            stream,\n            track,\n            /* streamInactiveHandler */ () => this.emit(JitsiTrackEvents.LOCAL_TRACK_STOPPED, this),\n            mediaType,\n            videoType);\n\n        this._setEffectInProgress = false;\n        const effect = effects.find(e => e.isEnabled(this));\n\n        if (effect) {\n            this._startStreamEffect(effect);\n        }\n\n        const displaySurface = videoType === VideoType.DESKTOP\n            ? track.getSettings().displaySurface\n            : null;\n\n        /**\n         * Track metadata.\n         */\n        this.metadata = {\n            timestamp: Date.now(),\n            ...displaySurface ? { displaySurface } : {}\n        };\n\n\n        /**\n         * The ID assigned by the RTC module on instance creation.\n         *\n         * @type {number}\n         */\n        this.rtcId = rtcId;\n        this.sourceId = sourceId;\n        this.sourceType = sourceType ?? displaySurface;\n\n        // Cache the constraints of the track in case of any this track\n        // model needs to call getUserMedia again, such as when unmuting.\n        this._constraints = track.getConstraints();\n\n        if (mediaType === MediaType.VIDEO) {\n            if (videoType === VideoType.CAMERA) {\n                // Safari returns an empty constraints object, construct the constraints using getSettings.\n                // Firefox in \"fingerprint resistance mode\" does a similar thing, except a `mediaSource` key is set.\n                if (!this._constraints.height || !this._constraints.width) {\n                    this._constraints = {\n                        height: { ideal: this.getHeight() },\n                        width: { ideal: this.getWidth() }\n                    };\n                }\n\n                // If the constraints are still empty, fallback to the constraints used for initial gUM.\n                if (!isValidNumber(this._constraints.height.ideal) && !isValidNumber(this._constraints.width.ideal)) {\n                    this._constraints.height = { ideal: constraints.height.ideal };\n                    this._constraints.width = { ideal: constraints.width.ideal };\n                }\n            }\n\n            // Get the resolution from the track itself since we do not know what camera capability the browser has\n            // picked for the given constraints, fallback to the constraints if MediaStreamTrack.getSettings() doesn't\n            // return the height.\n            this.resolution = this.getHeight();\n            if (!isValidNumber(this.resolution) && this._constraints.height?.ideal) {\n                this.resolution = this._constraints.height.ideal;\n            }\n            this.maxEnabledResolution = this.resolution;\n        }\n\n        this.deviceId = deviceId;\n\n        /**\n         * The <tt>Promise</tt> which represents the progress of a previously\n         * queued/scheduled {@link _setMuted} (from the point of view of\n         * {@link _queueSetMuted}).\n         *\n         * @private\n         * @type {Promise}\n         */\n        this._prevSetMuted = Promise.resolve();\n\n        /**\n         * The facing mode of the camera from which this JitsiLocalTrack\n         * instance was obtained.\n         *\n         * @private\n         * @type {CameraFacingMode|undefined}\n         */\n        this._facingMode = facingMode;\n\n        // Currently there is no way to know the MediaStreamTrack ended due to\n        // to device disconnect in Firefox through e.g. \"readyState\" property.\n        // Instead we will compare current track's label with device labels from\n        // enumerateDevices() list.\n        this._trackEnded = false;\n\n        /**\n         * Indicates whether data has been sent or not.\n         */\n        this._hasSentData = false;\n\n        /**\n         * Used only for detection of audio problems. We want to check only once\n         * whether the track is sending data ot not. This flag is set to false\n         * after the check.\n         */\n        this._testDataSent = true;\n\n        // Currently there is no way to determine with what device track was\n        // created (until getConstraints() support), however we can associate\n        // tracks with real devices obtained from enumerateDevices() call as\n        // soon as it's called.\n        // NOTE: this.deviceId corresponds to the device id specified in GUM constraints and this._realDeviceId seems to\n        // correspond to the id of a matching device from the available device list.\n        this._realDeviceId = this.deviceId === '' ? undefined : this.deviceId;\n\n        // The source name that will be signaled for this track.\n        this._sourceName = null;\n\n        // The primary SSRC associated with the local media track. This will be set after the local desc\n        // is processed once the track is added to the peerconnection.\n        this._ssrc = null;\n\n        this._trackMutedTS = 0;\n\n        this._onDeviceListWillChange = (devices: MediaDeviceInfo[]) => {\n            const oldRealDeviceId = this._realDeviceId;\n\n            this._setRealDeviceIdFromDeviceList(devices);\n\n            if (\n                // Mark track as ended for those browsers that do not support\n                // \"readyState\" property. We do not touch tracks created with\n                // default device ID \"\".\n                (typeof this.getTrack().readyState === 'undefined'\n                    && typeof this._realDeviceId !== 'undefined'\n                    && !devices.find(d => d.deviceId === this._realDeviceId))\n\n                // If there was an associated realDeviceID and after the device change the realDeviceId is undefined\n                // then the associated device has been disconnected and the _trackEnded flag needs to be set. In\n                // addition on some Chrome versions the readyState property is set after the device change event is\n                // triggered which causes issues in jitsi-meet with the selection of a new device because we don't\n                // detect that the old one was removed.\n                || (typeof oldRealDeviceId !== 'undefined' && typeof this._realDeviceId === 'undefined')\n            ) {\n                this._trackEnded = true;\n            }\n        };\n\n        // Subscribe each created local audio track to\n        // RTCEvents.AUDIO_OUTPUT_DEVICE_CHANGED event. This is different from\n        // handling this event for remote tracks (which are handled in RTC.js),\n        // because there might be local tracks not attached to a conference.\n        if (this.isAudioTrack() && RTCUtils.isDeviceChangeAvailable('output')) {\n            this._onAudioOutputDeviceChanged = this.setAudioOutput.bind(this);\n            RTCUtils.addListener(\n                RTCEvents.AUDIO_OUTPUT_DEVICE_CHANGED,\n                this._onAudioOutputDeviceChanged);\n        }\n\n        RTCUtils.addListener(RTCEvents.DEVICE_LIST_WILL_CHANGE, this._onDeviceListWillChange);\n\n        this._initNoDataFromSourceHandlers();\n    }\n\n    /**\n     * Adds stream to conference and marks it as \"unmute\" operation.\n     *\n     * @private\n     * @returns {Promise}\n     */\n    private _addStreamToConferenceAsUnmute(): Promise<void> {\n        if (!this.conference) {\n            return Promise.resolve();\n        }\n\n        // FIXME it would be good to not included conference as part of this process. Only TraceablePeerConnections to\n        // which the track is attached should care about this action. The TPCs to which the track is not attached can\n        // sync up when track is re-attached. A problem with that is that the \"modify sources\" queue is part of the\n        // JingleSessionPC and it would be excluded from the process. One solution would be to extract class between\n        // TPC and JingleSessionPC which would contain the queue and would notify the signaling layer when local SSRCs\n        // are changed. This would help to separate XMPP from the RTC module.\n        return new Promise((resolve, reject) => {\n            this.conference._addLocalTrackToPc(this)\n                .then(resolve, (error: any) => reject(new Error(error)));\n        });\n    }\n\n    /**\n     * Fires NO_DATA_FROM_SOURCE event and logs it to analytics\n     *\n     * @private\n     * @returns {void}\n     */\n    private _fireNoDataFromSourceEvent(): void {\n        const value = !this.isReceivingData();\n\n        this.emit(JitsiTrackEvents.NO_DATA_FROM_SOURCE, value);\n\n        logger.debug(`NO_DATA_FROM_SOURCE event with value ${value} detected for track: ${this}`);\n\n        // FIXME: Should we report all of those events\n        Statistics.sendAnalytics(createNoDataFromSourceEvent(this.getType(), value));\n    }\n\n    /**\n     * Sets handlers to the MediaStreamTrack object that will detect camera issues.\n     *\n     * @private\n     * @returns {void}\n     */\n    private _initNoDataFromSourceHandlers(): void {\n        if (!this._isNoDataFromSourceEventsEnabled()) {\n            return;\n        }\n\n        this._setHandler('track_mute', () => {\n            this._trackMutedTS = window.performance.now();\n            this._fireNoDataFromSourceEvent();\n        });\n\n        this._setHandler('track_unmute', () => {\n            this._fireNoDataFromSourceEvent();\n            Statistics.sendAnalyticsAndLog(\n                AnalyticsEvents.TRACK_UNMUTED,\n                {\n                    'media_type': this.getType(),\n                    'track_type': 'local',\n                    value: window.performance.now() - this._trackMutedTS\n                });\n        });\n\n        if (this.isVideoTrack() && this.videoType === VideoType.CAMERA) {\n            this._setHandler('track_ended', () => {\n                if (!this.isReceivingData()) {\n                    this._fireNoDataFromSourceEvent();\n                }\n            });\n        }\n    }\n\n    /**\n     * Returns true if no data from source events are enabled for this JitsiLocalTrack and false otherwise.\n     *\n     * @private\n     * @returns {boolean} - True if no data from source events are enabled for this JitsiLocalTrack and false otherwise.\n     */\n    private _isNoDataFromSourceEventsEnabled(): boolean {\n        // Disable the events for screen sharing.\n        return !this.isVideoTrack() || this.videoType !== VideoType.DESKTOP;\n    }\n\n    /**\n     * Initializes a new Promise to execute {@link #_setMuted}. May be called multiple times in a row and the\n     * invocations of {@link #_setMuted} and, consequently, {@link #mute} and/or {@link #unmute} will be resolved in a\n     * serialized fashion.\n     *\n     * @param {boolean} muted - The value to invoke <tt>_setMuted</tt> with.\n     * @private\n     * @returns {Promise}\n     */\n    private _queueSetMuted(muted: boolean): Promise<void> {\n        const setMuted = this._setMuted.bind(this, muted);\n\n        this._prevSetMuted = this._prevSetMuted.then(setMuted, setMuted);\n\n        return this._prevSetMuted;\n    }\n\n    /**\n     * Removes stream from conference and marks it as \"mute\" operation.\n     *\n     * @param {Function} successCallback - Callback that will be called when the operation is successful.\n     * @param {Function} errorCallback - Callback that will be called when the operation fails.\n     * @private\n     * @returns {Promise}\n     */\n    private _removeStreamFromConferenceAsMute(successCallback: () => void, errorCallback: (error: Error) => void): void {\n        if (!this.conference) {\n            successCallback();\n\n            return;\n        }\n        this.conference._removeLocalTrackFromPc(this).then(\n            successCallback,\n            (error: any) => errorCallback(new Error(error)));\n    }\n\n    /**\n     * Mutes / unmutes this track.\n     *\n     * @param {boolean} muted - If <tt>true</tt>, this track will be muted; otherwise, this track will be unmuted.\n     * @private\n     * @returns {Promise}\n     */\n    private _setMuted(muted: boolean): Promise<void> {\n        if (this.isMuted() === muted && this.videoType !== VideoType.DESKTOP) {\n            return Promise.resolve();\n        }\n\n        if (this.disposed) {\n            return Promise.reject(new JitsiTrackError(TRACK_IS_DISPOSED));\n        }\n\n        let promise: Promise<void | IStreamInfo[]> = Promise.resolve();\n\n        // A function that will print info about muted status transition\n        const logMuteInfo = () => logger.info(`Mute ${this}: ${muted}`);\n\n        // In React Native we mute the camera by setting track.enabled but that doesn't\n        // work for screen-share tracks, so do the remove-as-mute for those.\n        const doesVideoMuteByStreamRemove\n            = browser.isReactNative() ? this.videoType === VideoType.DESKTOP : browser.doesVideoMuteByStreamRemove();\n\n        // In the multi-stream mode, desktop tracks are muted from jitsi-meet instead of being removed from the\n        // conference. This is needed because we don't want the client to signal a source-remove to the remote peer for\n        // the desktop track when screenshare is stopped. Later when screenshare is started again, the same sender will\n        // be re-used without the need for signaling a new ssrc through source-add.\n        if (this.isAudioTrack() || !doesVideoMuteByStreamRemove) {\n            logMuteInfo();\n\n            // If we have a stream effect that implements its own mute functionality, prioritize it before\n            // normal mute e.g. the stream effect that implements system audio sharing has a custom\n            // mute state in which if the user mutes, system audio still has to go through.\n            if (this._streamEffect?.setMuted) {\n                this._streamEffect.setMuted(muted);\n            } else if (this.track) {\n                this.track.enabled = !muted;\n            }\n        } else if (muted) {\n            promise = new Promise((resolve, reject) => {\n                logMuteInfo();\n                this._removeStreamFromConferenceAsMute(\n                    () => {\n                        if (this._streamEffect) {\n                            this._stopStreamEffect();\n                        }\n\n                        // FIXME: Maybe here we should set the SRC for the\n                        // containers to something\n                        // We don't want any events to be fired on this stream\n                        this._unregisterHandlers();\n                        this.stopStream();\n                        this._setStream(null);\n\n                        resolve();\n                    },\n                    reject);\n            });\n        } else {\n            logMuteInfo();\n\n            let streamOptions;\n\n            if (this.videoType === VideoType.CAMERA) {\n                streamOptions = {\n                    cameraDeviceId: this.getDeviceId(),\n                    devices: [ MediaType.VIDEO ],\n                    effects: this._streamEffect ? [ this._streamEffect ] : [],\n                    facingMode: this.getCameraFacingMode()\n                };\n            } else {\n                streamOptions = {\n                    devices: [ MediaType.DESKTOP ],\n                };\n            }\n\n            promise\n                = RTCUtils.obtainAudioAndVideoPermissions({\n\n                    ...streamOptions,\n                    constraints: { video: this._constraints } }) as Promise<IStreamInfo[]>;\n\n            promise = promise.then((streamsInfo: IStreamInfo[]) => {\n                const streamInfo = streamsInfo.find(info => info.track.kind === this.getType());\n\n                if (streamInfo) {\n                    this._setStream(streamInfo.stream);\n                    this.track = streamInfo.track;\n\n                    // This is not good when video type changes after\n                    // unmute, but let's not crash here\n                    if (this.videoType !== streamInfo.videoType) {\n                        logger.warn(\n                            `${this}: video type has changed after unmute!`,\n                            this.videoType, streamInfo.videoType);\n                        this.videoType = streamInfo.videoType;\n                    }\n                } else {\n                    throw new JitsiTrackError(TRACK_NO_STREAM_FOUND);\n                }\n\n                if (this._streamEffect) {\n                    this._startStreamEffect(this._streamEffect);\n                }\n\n                this.containers.map(cont => RTCUtils.attachMediaStream(cont, this.stream).catch(() => {\n                    logger.error(`Attach media failed for ${this} on video unmute!`);\n                }));\n\n                return this._addStreamToConferenceAsUnmute();\n            });\n        }\n\n        return promise\n            .then(() => {\n                this._sendMuteStatus(muted);\n                const event = this.isAudioTrack() ? RTCStatsEvents.AUDIO_MUTE_CHANGED_EVENT : RTCStatsEvents.VIDEO_MUTE_CHANGED_EVENT;\n\n                RTCStats.sendStatsEntry(event, null, muted);\n\n                // Send the videoType message to the bridge.\n                this.isVideoTrack() && this.conference?._sendBridgeVideoTypeMessage(this);\n                this.emit(JitsiTrackEvents.TRACK_MUTE_CHANGED, this);\n            });\n    }\n\n    /**\n     * Sets real device ID by comparing track information with device information. This is temporary solution until\n     * getConstraints() method will be implemented in browsers.\n     *\n     * @param {MediaDeviceInfo[]} devices - The list of devices obtained from enumerateDevices() call.\n     * @private\n     * @returns {void}\n     */\n    private _setRealDeviceIdFromDeviceList(devices: MediaDeviceInfo[]): void {\n        const track = this.getTrack();\n        const kind = `${track.kind}input`;\n\n        // We need to match by deviceId as well, in case of multiple devices with the same label.\n        let device = devices.find(d => d.kind === kind && d.label === track.label && d.deviceId === this.deviceId);\n\n        if (!device && this._realDeviceId === 'default') { // the default device has been changed.\n            // If the default device was 'A' and the default device is changed to 'B' the label for the track will\n            // remain 'Default - A' but the label for the device in the device list will be updated to 'A'. That's\n            // why in order to match it we need to remove the 'Default - ' part.\n            const label = (track.label || '').replace('Default - ', '');\n\n            device = devices.find(d => d.kind === kind && d.label === label);\n        }\n\n        if (device) {\n            this._realDeviceId = device.deviceId;\n        } else {\n            this._realDeviceId = undefined;\n        }\n    }\n\n    /**\n     * Starts the effect process and returns the modified stream.\n     *\n     * @param {Object} effect - Represents effect instance\n     * @private\n     * @returns {void}\n     */\n    private _startStreamEffect(effect: IStreamEffect): void {\n        this._streamEffect = effect;\n        this._originalStream = this.stream;\n        this._setStream(this._streamEffect.startEffect(this._originalStream));\n        this.track = this.stream.getTracks()[0];\n    }\n\n    /**\n     * Stops the effect process and returns the original stream.\n     *\n     * @private\n     * @returns {void}\n     */\n    private _stopStreamEffect(): void {\n        if (this._streamEffect) {\n            this._streamEffect.stopEffect();\n            this._setStream(this._originalStream);\n            this._originalStream = null;\n            this.track = this.stream ? this.stream.getTracks()[0] : null;\n        }\n    }\n\n    /**\n     * Switches the camera facing mode if the WebRTC implementation supports the custom MediaStreamTrack._switchCamera\n     * method. Currently, the method in question is implemented in react-native-webrtc only. When such a WebRTC\n     * implementation is executing, the method is the preferred way to switch between the front/user-facing and the\n     * back/environment-facing cameras because it will likely be (as is the case of react-native-webrtc) noticeably\n     * faster that creating a new MediaStreamTrack via a new getUserMedia call with the switched facingMode constraint\n     * value. Moreover, the approach with a new getUserMedia call may not even work: WebRTC on Android and iOS is\n     * either very slow to open the camera a second time or plainly freezes attempting to do that.\n     *\n     * @returns {void}\n     */\n    private _switchCamera(): void {\n        if (this.isVideoTrack()\n            && this.videoType === VideoType.CAMERA\n            && typeof this.track._switchCamera === 'function') {\n            this.track._switchCamera();\n\n            this._facingMode\n                = this._facingMode === CameraFacingMode.ENVIRONMENT\n                    ? CameraFacingMode.USER\n                    : CameraFacingMode.ENVIRONMENT;\n        }\n    }\n\n    /**\n     * Stops the currently used effect (if there is one) and starts the passed effect (if there is one).\n     *\n     * @param {Object|undefined} effect - The new effect to be set.\n     * @private\n     * @returns {void}\n     */\n    private _switchStreamEffect(effect?: IStreamEffect): void {\n        if (this._streamEffect) {\n            this._stopStreamEffect();\n            this._streamEffect = undefined;\n        }\n        if (effect) {\n            this._startStreamEffect(effect);\n        }\n    }\n\n    /**\n     * @inheritdoc\n     *\n     * Stops sending the media track. And removes it from the HTML. NOTE: Works for local tracks only.\n     *\n     * @returns {Promise}\n     */\n    override async dispose(): Promise<void> {\n        if (this.disposed) {\n            return;\n        }\n\n        // Remove the effect instead of stopping it so that the original stream is restored\n        // on both the local track and on the peerconnection.\n        if (this._streamEffect) {\n            await this.setEffect(undefined);\n        }\n\n        if (this.conference) {\n            await this.conference.removeTrack(this);\n        }\n\n        if (this.stream) {\n            this.stopStream();\n        }\n\n        RTCUtils.removeListener(RTCEvents.DEVICE_LIST_WILL_CHANGE, this._onDeviceListWillChange);\n\n        if (this._onAudioOutputDeviceChanged) {\n            RTCUtils.removeListener(RTCEvents.AUDIO_OUTPUT_DEVICE_CHANGED,\n                this._onAudioOutputDeviceChanged);\n        }\n\n        return super.dispose();\n    }\n\n    /**\n     * Sends mute status for a track to conference if any.\n     *\n     * @param {boolean} mute - If track is muted.\n     * @internal\n     * @returns {void}\n     */\n    _sendMuteStatus(mute: boolean): void {\n        if (this.conference) {\n            this.conference._setTrackMuteStatus(this, mute) && this.conference.room.sendPresence();\n        }\n    }\n\n    /**\n     * Returns facing mode for video track from camera. For other cases (e.g. audio track or 'desktop' video track)\n     * returns undefined.\n     *\n     * @returns {Optional<CameraFacingMode>}\n     */\n    getCameraFacingMode(): Optional<CameraFacingMode> {\n        if (this.isVideoTrack() && this.videoType === VideoType.CAMERA) {\n            // MediaStreamTrack#getSettings() is not implemented in many\n            // browsers, so we need feature checking here. Progress on the\n            // respective browser's implementation can be tracked at\n            // https://bugs.chromium.org/p/webrtc/issues/detail?id=2481 for\n            // Chromium and https://bugzilla.mozilla.org/show_bug.cgi?id=1213517\n            // for Firefox. Even if a browser implements getSettings() already,\n            // it might still not return anything for 'facingMode'.\n            const trackSettings = this.track.getSettings?.();\n\n            if (trackSettings && 'facingMode' in trackSettings) {\n                return trackSettings.facingMode as CameraFacingMode;\n            }\n\n            if (typeof this._facingMode !== 'undefined') {\n                return this._facingMode;\n            }\n\n            // In most cases we are showing a webcam. So if we've gotten here,\n            // it should be relatively safe to assume that we are probably\n            // showing the user-facing camera.\n            return CameraFacingMode.USER;\n        }\n\n        return undefined;\n    }\n\n    /**\n     * Returns the capture resolution of the video track.\n     *\n     * @returns {Number}\n     */\n    getCaptureResolution(): number {\n        if (this.videoType === VideoType.CAMERA || !browser.isWebKitBased()) {\n            return this.resolution!;\n        }\n\n        return this.getHeight();\n    }\n\n    /**\n     * Returns device id associated with track.\n     *\n     * @returns {string}\n     */\n    getDeviceId(): string {\n        return this._realDeviceId || this.deviceId;\n    }\n\n    /**\n     * Get the duration of the track.\n     *\n     * @returns {Number} the duration of the track in seconds\n     */\n    getDuration(): number {\n        return (Date.now() / 1000) - (this.metadata.timestamp / 1000);\n    }\n\n    /**\n     * Returns the participant id which owns the track.\n     *\n     * @returns {string} the id of the participants. It corresponds to the\n     * Colibri endpoint id/MUC nickname in case of Jitsi-meet.\n     */\n    getParticipantId(): string {\n        return this.conference?.myUserId();\n    }\n\n    /**\n     * Returns the source name associated with the jitsi track.\n     *\n     * @returns {Nullable<string>} source name\n     */\n    override getSourceName(): Nullable<string> {\n        return this._sourceName;\n    }\n\n    /**\n     * Returns the primary SSRC associated with the track.\n     * @returns {Nullable<number>}\n     */\n    override getSsrc(): Nullable<number> {\n        return this._ssrc;\n    }\n\n    /**\n     * Returns if associated MediaStreamTrack is in the 'ended' state\n     *\n     * @returns {boolean}\n     */\n    isEnded(): boolean {\n        if (this.isVideoTrack() && this.isMuted()) {\n            // If a video track is muted the readyState will be ended, that's why we need to rely only on the\n            // _trackEnded flag.\n            return this._trackEnded;\n        }\n\n        return this.getTrack().readyState === 'ended' || this._trackEnded;\n    }\n\n    /**\n     * Returns <tt>true</tt>.\n     *\n     * @returns {boolean} <tt>true</tt>\n     */\n    override isLocal(): boolean {\n        return true;\n    }\n\n    /**\n     * Returns <tt>true</tt> - if the stream is muted and <tt>false</tt> otherwise.\n     *\n     * @returns {boolean} <tt>true</tt> - if the stream is muted and <tt>false</tt> otherwise.\n     */\n    override isMuted(): boolean {\n        // this.stream will be null when we mute local video on Chrome\n        if (!this.stream) {\n            return true;\n        }\n        if (this.isVideoTrack() && !this.isActive()) {\n            return true;\n        }\n\n        // If currently used stream effect has its own muted state, use that.\n        if (this._streamEffect?.isMuted) {\n            return this._streamEffect.isMuted();\n        }\n\n        return !this.track?.enabled;\n    }\n\n    /**\n     * Checks whether the attached MediaStream is receiving data from source or not. If the stream property is null\n     * (because of mute or another reason) this method will return false.\n     * NOTE: This method doesn't indicate problem with the streams directly. For example in case of video mute the\n     * method will return false or if the user has disposed the track.\n     *\n     * @returns {boolean} true if the stream is receiving data and false this otherwise.\n     */\n    isReceivingData(): boolean {\n        if (this.isVideoTrack()\n            && (this.isMuted() || this._stopStreamInProgress || this.videoType === VideoType.DESKTOP)) {\n            return true;\n        }\n\n        if (!this.stream) {\n            return false;\n        }\n\n        // In older version of the spec there is no muted property and readyState can have value muted. In the latest\n        // versions readyState can have values \"live\" and \"ended\" and there is muted boolean property. If the stream is\n        // muted that means that we aren't receiving any data from the source. We want to notify the users for error if\n        // the stream is muted or ended on it's creation.\n\n        // For video blur enabled use the original video stream\n        const stream = this._effectEnabled ? this._originalStream : this.stream;\n\n        return stream.getTracks().some(track =>\n            (!('readyState' in track) || track.readyState === 'live')\n            && (!('muted' in track) || track.muted !== true));\n    }\n\n    /**\n     * Asynchronously mutes this track.\n     *\n     * @returns {Promise}\n     */\n    mute(): Promise<void> {\n        return this._queueSetMuted(true);\n    }\n\n    /**\n     * Handles bytes sent statistics. NOTE: used only for audio tracks to detect audio issues.\n     *\n     * @param {TraceablePeerConnection} tpc - The peerconnection that is reporting the bytes sent stat.\n     * @param {number} bytesSent - The new value.\n     * @returns {void}\n     */\n    onByteSentStatsReceived(tpc: TraceablePeerConnection, bytesSent: number): void {\n        if (bytesSent > 0) {\n            this._hasSentData = true;\n        }\n        const iceConnectionState = tpc.getConnectionState();\n\n        if (this._testDataSent && iceConnectionState === 'connected') {\n            setTimeout(() => {\n                if (!this._hasSentData) {\n                    logger.warn(`${this} 'bytes sent' <= 0: \\\n                        ${bytesSent}`);\n\n                    Statistics.analytics.sendEvent(AnalyticsEvents.NO_BYTES_SENT, { 'media_type': this.getType() });\n                }\n            }, 3000);\n            this._testDataSent = false;\n        }\n    }\n\n    /**\n     * Sets the JitsiConference object associated with the track. This is temp solution.\n     *\n     * @param conference - JitsiConference object.\n     * @returns {void}\n     */\n    setConference(conference: JitsiConference): void {\n        this.conference = conference;\n    }\n\n    /**\n     * Sets the effect and switches between the modified stream and original one.\n     *\n     * @param {Object} effect - Represents the effect instance to be used.\n     * @returns {Promise}\n     */\n    setEffect(effect?: IStreamEffect): Promise<void> {\n        if (typeof this._streamEffect === 'undefined' && typeof effect === 'undefined') {\n            return Promise.resolve();\n        }\n\n        if (typeof effect !== 'undefined' && !effect.isEnabled(this)) {\n            return Promise.reject(new Error('Incompatible effect instance!'));\n        }\n\n        if (this._setEffectInProgress === true) {\n            return Promise.reject(new Error('setEffect already in progress!'));\n        }\n\n        // In case we have an audio track that is being enhanced with an effect, we still want it to be applied,\n        // even if the track is muted. Where as for video the actual track doesn't exists if it's muted.\n        if (this.isMuted() && !this.isAudioTrack()) {\n            this._streamEffect = effect;\n\n            return Promise.resolve();\n        }\n\n        const conference = this.conference;\n\n        if (!conference) {\n            this._switchStreamEffect(effect);\n            if (this.isVideoTrack()) {\n                this.containers.forEach(cont => {\n                    RTCUtils.attachMediaStream(cont, this.stream).catch(() => {\n                        logger.error(`Attach media failed for ${this} when trying to set effect.`);\n                    });\n                });\n            }\n\n            return Promise.resolve();\n        }\n\n        this._setEffectInProgress = true;\n\n        return conference._removeLocalTrackFromPc(this)\n            .then(() => {\n                this._switchStreamEffect(effect);\n                if (this.isVideoTrack()) {\n                    this.containers.forEach(cont => {\n                        RTCUtils.attachMediaStream(cont, this.stream).catch(() => {\n                            logger.error(`Attach media failed for ${this} when trying to set effect.`);\n                        });\n                    });\n                }\n\n                return conference._addLocalTrackToPc(this);\n            })\n            .then(() => {\n                this._setEffectInProgress = false;\n            })\n            .catch((error: any) => {\n                // Any error will be not recovarable and will trigger CONFERENCE_FAILED event. But let's try to cleanup\n                // everyhting related to the effect functionality.\n                this._setEffectInProgress = false;\n                this._switchStreamEffect();\n                logger.error('Failed to switch to the new stream!', error);\n                throw error;\n            });\n    }\n\n    /**\n     * Sets the source name to be used for signaling the jitsi track.\n     *\n     * @param {string} name The source name.\n     * @internal\n     */\n    override setSourceName(name: string): void {\n        this._sourceName = name;\n    }\n\n    /**\n     * Sets the primary SSRC for the track.\n     *\n     * @param {number} ssrc The SSRC.\n     */\n    setSsrc(ssrc: number): void {\n        if (isValidNumber(ssrc)) {\n            this._ssrc = ssrc;\n        }\n    }\n\n    /**\n     * Stops the associated MediaStream.\n     *\n     * @returns {void}\n     */\n    stopStream(): void {\n        /**\n         * Indicates that we are executing {@link #stopStream} i.e.\n         * {@link RTCUtils#stopMediaStream} for the <tt>MediaStream</tt>\n         * associated with this <tt>JitsiTrack</tt> instance.\n         *\n         * @private\n         * @type {boolean}\n         */\n        this._stopStreamInProgress = true;\n\n        try {\n            RTCUtils.stopMediaStream(this.stream);\n        } finally {\n            this._stopStreamInProgress = false;\n        }\n    }\n\n    /**\n     * Creates a text representation of this local track instance.\n     *\n     * @return {string}\n     */\n    override toString(): string {\n        return `LocalTrack[${this.rtcId},${this.getType()}]`;\n    }\n\n    /**\n     * Asynchronously unmutes this track.\n     *\n     * @returns {Promise}\n     */\n    unmute(): Promise<void> {\n        return this._queueSetMuted(false);\n    }\n\n    /**\n     * Applies media constraints to the current MediaStreamTrack.\n     *\n     * @param {IAudioConstraints} constraints - Media constraints to apply.\n     * @returns {Promise<void>}\n     */\n    async applyConstraints(constraints: IAudioConstraints): Promise<void> {\n        const mediaType = this.getType();\n\n        if (!this.isAudioTrack()) {\n            throw new Error(`Media ${mediaType} is not supported, track must be audio`);\n        }\n\n        const hasAudioMixEffect = typeof this._streamEffect?.setMuted === 'function';\n\n        if (this._streamEffect && !hasAudioMixEffect) {\n            throw new Error(`Cannot apply constraints while the effect ${JSON.stringify(\n                this._streamEffect)} is active`\n            );\n        }\n\n        const hasConference = Boolean(this.conference);\n        let audioAnalyser: VADAudioAnalyser | undefined;\n\n        if (hasConference) {\n            audioAnalyser = this.conference.getAudioAnalyser();\n\n            if (audioAnalyser) {\n                logger.debug(`Removing track ${this} from audio analyser`);\n                audioAnalyser._trackRemoved(this);\n            }\n\n            logger.debug(`Removing track ${this} from conference`);\n            await this.conference._removeLocalTrackFromPc(this);\n        }\n\n        const isMuted = this.isMuted();\n\n        if (hasAudioMixEffect) {\n            this._stopStreamEffect();\n        }\n\n        this.stopStream();\n\n        const initialSettings = this.track.getSettings();\n        const constraintsToApply = {\n            ...initialSettings,\n            ...constraints\n        };\n\n        const deviceIdKey = mediaType === MediaType.AUDIO ? 'micDeviceId' : 'cameraDeviceId';\n        let mediaStreamData: IStreamInfo | undefined;\n\n        try {\n            logger.debug(`applyConstraints for track ${this} with constraints: ${JSON.stringify(constraints)}`);\n\n            [ mediaStreamData ] = await RTCUtils.obtainAudioAndVideoPermissions({\n                constraints: { [mediaType]: constraintsToApply },\n                [deviceIdKey]: constraintsToApply.deviceId,\n                devices: [ mediaType ]\n            });\n\n            if (!mediaStreamData?.stream) {\n                throw new JitsiTrackError(JitsiTrackErrors.CONSTRAINT_FAILED);\n            }\n\n        } catch (error) {\n            logger.error(\n                `applyConstraints failed for track ${this} with constraints: ${JSON.stringify(\n                    constraints\n                )}: `,\n                error\n            );\n\n            [ mediaStreamData ] = await RTCUtils.obtainAudioAndVideoPermissions({\n                constraints: { [mediaType]: initialSettings },\n                [deviceIdKey]: constraintsToApply.deviceId,\n                devices: [ mediaType ]\n            });\n        }\n\n        if (!mediaStreamData?.stream) {\n            throw new JitsiTrackError(JitsiTrackErrors.GENERAL);\n        }\n\n        logger.debug('Setting updated stream and track');\n\n        this._setStream(mediaStreamData.stream);\n        this.track = mediaStreamData.track;\n\n        if (hasAudioMixEffect) {\n            this._startStreamEffect(this._streamEffect);\n        }\n\n        if (isMuted) {\n            this._setMuted(true);\n        }\n\n        if (hasConference) {\n            logger.debug(`Adding track ${this} to conference`);\n            await this.conference._addLocalTrackToPc(this);\n\n            if (audioAnalyser) {\n                logger.debug(`Adding track ${this} to audio analyser`);\n                audioAnalyser._trackAdded(this);\n            }\n        }\n    }\n}\n","/**\n * Enumeration of the codec mime types\n * @type {{AV1: string, H264: string, OPUS: string, RED: string, ULPFEC: string, VP8: string, VP9: string}}\n */\nexport enum CodecMimeType {\n\n    /**\n     * AV1 codec mime type.\n     */\n    AV1 = 'av1',\n\n    /**\n     * The h264 codec mime type.\n     */\n    H264 = 'h264',\n\n    /**\n     * The opus codec mime type.\n     */\n    OPUS = 'opus',\n\n    /**\n     * The red codec mime type.\n     */\n    RED = 'red',\n\n    /**\n     * The ulpfec codec mime type.\n     */\n    ULPFEC = 'ulpfec',\n\n    /**\n     * The vp8 codec mime type.\n     */\n    VP8 = 'vp8',\n\n    /**\n     * The vp9 codec mime type.\n     */\n    VP9 = 'vp9'\n}\n","/**\n * Enumeration of the media direction types.\n */\nexport enum MediaDirection {\n\n    /**\n     * Media is send and receive is suspended.\n     */\n    INACTIVE = 'inactive',\n\n    /**\n     * Media is only received from remote peer.\n     */\n    RECVONLY = 'recvonly',\n\n    /**\n     * Media is only sent to the remote peer.\n     */\n    SENDONLY = 'sendonly',\n\n    /**\n     * Media is sent and received.\n     */\n    SENDRECV = 'sendrecv'\n}\n","export enum SignalingEvents {\n\n    /**\n     * Event triggered when participant's muted status changes.\n     *\n     * @param {string} endpointId the track owner's identifier (MUC nickname)\n     * @param {MediaType} mediaType \"audio\" or \"video\"\n     * @param {boolean} isMuted the new muted state\n     */\n    PEER_MUTED_CHANGED = 'signaling.peerMuted',\n\n    /**\n     * Event triggered when participant's video type changes.\n     *\n     * @param {string} endpointId the video owner's ID (MUC nickname)\n     * @param {VideoType} videoType the new value\n     */\n    PEER_VIDEO_TYPE_CHANGED = 'signaling.peerVideoType',\n\n    /**\n     * Event triggered when source's muted status changes.\n     *\n     * @param {string} sourceName - The name of the source.\n     * @param {boolean} isMuted - The new muted state.\n     */\n    SOURCE_MUTED_CHANGED = 'signaling.sourceMuted',\n\n    /**\n     * Event triggered when presence for a source is received.\n     *\n     * @param {string} sourceName - The name of the source.\n     * @param {string} endpointId - The endpoint id.\n     * @param {boolean} muted - The new muted state.\n     * @param {string} videoType - The video type of the source.\n     */\n    SOURCE_UPDATED = 'signaling.sourceUpdated',\n\n    /**\n     * Event triggered when source's video type changes.\n     *\n     * @param {string} source - The name of the source.\n     * @param {VideoType} videoType - The new value.\n     */\n    SOURCE_VIDEO_TYPE_CHANGED = 'signaling.sourceVideoType'\n}\n","import Listenable from '../../modules/util/Listenable';\nimport { isValidNumber } from '../../modules/util/MathUtil';\n\nimport { MediaType } from './MediaType';\nimport { VideoType } from './VideoType';\n\nexport type EndpointId = string;\nexport type SourceName = string;\n\nexport interface ISourceInfo {\n    muted?: boolean;\n    sourceName: SourceName;\n    videoType?: string;\n}\n\nexport interface IPeerMediaInfo {\n    codecList?: string[];\n    codecType?: string;\n    muted?: boolean;\n    videoType?: string;\n}\n/* eslint-disable @typescript-eslint/no-unused-vars */\n/* eslint-disable @typescript-eslint/no-empty-function */\n\n/**\n * Generates a source name.\n *\n * @param {EndpointId} endpointId - Jitsi Endpoint Id.\n * @param {MediaType} mediaType - the media type string.\n * @param {number} trackIdx - Track index (or sender idx? - to be figured out) starting from 0.\n * @returns {SourceName} eg. endpointA-v0\n */\nexport function getSourceNameForJitsiTrack(endpointId: EndpointId, mediaType: MediaType, trackIdx: number): SourceName {\n    const firstLetterOfMediaType = mediaType.substring(0, 1);\n\n    return `${endpointId}-${firstLetterOfMediaType}${trackIdx}`;\n}\n\n/**\n * Extracts MediaType from give source name (must be in the correct format as generated by\n * {@link getSourceNameForJitsiTrack}).\n *\n * @param {SourceName} sourceName - the source name.\n * @returns {MediaType}\n */\nexport function getMediaTypeFromSourceName(sourceName: SourceName): MediaType {\n    const firstLetterOfMediaTypeIdx = sourceName.lastIndexOf('-') + 1;\n\n    if (firstLetterOfMediaTypeIdx <= 0) {\n        throw new Error(`Invalid source name: ${sourceName}`);\n    }\n\n    const firstLetterOfMediaType = sourceName.substr(firstLetterOfMediaTypeIdx, 1);\n\n    if (firstLetterOfMediaType === 'v') {\n        return MediaType.VIDEO;\n    } else if (firstLetterOfMediaType === 'a') {\n        return MediaType.AUDIO;\n    }\n\n    throw new Error(`Invalid source name: ${sourceName}`);\n}\n\n/**\n * Extracts source index (zero based) from a given source name (must be in the correct format as generated by\n * {@link getSourceNameForJitsiTrack}).\n *\n * @param {SourceName} sourceName - the source name, eg. endpointA-v0.\n * @returns {number}\n */\nexport function getSourceIndexFromSourceName(sourceName: SourceName): number {\n    const nameParts = sourceName.split('-');\n    const trackIdx = Number(nameParts[nameParts.length - 1].substring(1));\n\n    if (!isValidNumber(trackIdx)) {\n        throw new Error(`Failed to parse track idx for source name: ${sourceName}`);\n    }\n\n    return trackIdx;\n}\n\n/**\n * An object that carries the info about specific media type advertised by\n * participant in the signaling channel.\n * @typedef {Object} IPeerMediaInfo\n * @property {boolean} muted indicates if the media is currently muted\n * @property {VideoType|undefined} videoType the type of the video if applicable\n */\n\n/**\n * Interface used to expose the information carried over the signaling channel\n * which is not available to the RTC module in the media SDP.\n *\n * @interface SignalingLayer\n */\nexport default class SignalingLayer extends Listenable {\n    /**\n     * Obtains the info about given media advertised in the MUC presence of\n     * the participant identified by the given MUC JID.\n     * @param {string} owner the MUC jid of the participant for whom\n     * {@link PeerMediaInfo} will be obtained.\n     * @param {MediaType} mediaType the type of the media for which presence\n     * @param {SourceName} sourceName - The name of the source for which the info is to be obtained.\n     * info will be obtained.\n     * @return {Nullable<IPeerMediaInfo>} presenceInfo an object with media presence\n     * info or <tt>null</tt> either if there is no presence available for given\n     * JID or if the media type given is invalid.\n     *\n     * @deprecated This method is to be replaced with getPeerSourceInfo.\n     */\n    getPeerMediaInfo(\n            owner: string, mediaType: MediaType, sourceName: SourceName\n    ): Nullable<IPeerMediaInfo> {\n        throw new Error('not implemented');\n    }\n\n    /**\n     * Obtains the info about a source for given name and endpoint ID.\n     * @param {EndpointId} owner - The owner's endpoint ID.\n     * @param {SourceName} sourceName - The name of the source for which the info is to be obtained.\n     * @returns {Optional<ITPCSourceInfo>}\n     */\n    getPeerSourceInfo(\n            owner: EndpointId, sourceName: SourceName\n    ): Optional<ISourceInfo> {\n        throw new Error('not implemented');\n    }\n\n    /**\n     * Obtains the endpoint ID for given SSRC.\n     * @param {number} ssrc the SSRC number.\n     * @return {Nullable<string>} the endpoint ID for given media SSRC.\n     */\n    getSSRCOwner(ssrc: number): Nullable<string> {\n        throw new Error('not implemented');\n    }\n\n    /**\n     * Obtains the source name for given SSRC.\n     * @param {number} ssrc the track's SSRC identifier.\n     * @returns {Optional<SourceName>} the track's source name.\n     */\n    getTrackSourceName(ssrc: number): Optional<SourceName> {\n        throw new Error('not implemented');\n    }\n\n    /**\n     * Removes the association between a given SSRC and its current owner so that it can re-used when the SSRC gets\n     * remapped to another source from a different endpoint.\n     * @param {number} ssrc a list of SSRCs.\n     */\n    removeSSRCOwners(ssrcList: number[]): void {\n    }\n\n    /**\n     * Set an SSRC owner.\n     *\n     * @param {number} ssrc - An SSRC to be owned.\n     * @param {string} endpointId - Owner's ID (MUC nickname).\n     * @param {SourceName} sourceName - The related source name.\n     * @throws TypeError if <tt>ssrc</tt> is not a number.\n     */\n    setSSRCOwner(ssrc: number, endpointId: string, sourceName: SourceName): void {\n    }\n\n    /**\n     * Adjusts muted status of given track.\n     *\n     * @param {SourceName} sourceName - the name of the track's source.\n     * @param {boolean} muted - the new muted status.\n     * @returns {boolean}\n     */\n    setTrackMuteStatus(sourceName: SourceName, muted: boolean) {\n    }\n\n    /**\n     * Sets track's video type.\n     * @param {SourceName} sourceName - the track's source name.\n     * @param {VideoType} videoType - the new video type.\n     * @returns {boolean}\n     */\n    setTrackVideoType(sourceName: SourceName, videoType: VideoType) {\n    }\n\n    /**\n     * Removes the SSRCs associated with a given endpoint from the SSRC owners.\n     *\n     * @param {string} id endpoint id of the participant leaving the call.\n     * @returns {void}\n     */\n    updateSsrcOwnersOnLeave(id: string): void {\n    }\n}\n","import browser from '../../modules/browser';\n\nimport { CodecMimeType } from './CodecMimeType';\n\n// Default value for assumed downlink bandwidth for the local endpoint which tells the bridge to use its own calculated\n// BWE value while determining the number of video streams to route to the endpoint.\nexport const ASSUMED_BANDWIDTH_BPS = -1;\n\n// Default lastN value to be used while ramping up lastN after a cpu limitation ceases to exist (if -1 or no value is\n// passed in config.js for channelLastN).\nexport const DEFAULT_LAST_N = 25;\n\n// LastN value to be signaled to the bridge when the local endpoint wants to receive all the remote video sources in\n// the call.\nexport const LAST_N_UNLIMITED = -1;\n\n// Default simulcast encodings config.\nexport const SIM_LAYERS = [\n    {\n        rid: '1',\n        scaleFactor: 4.0\n    },\n    {\n        rid: '2',\n        scaleFactor: 2.0\n    },\n    {\n        rid: '3',\n        scaleFactor: 1.0\n    }\n];\n\n/**\n * The ssrc-group semantics for SSRCs related to the video streams.\n */\nexport enum SSRC_GROUP_SEMANTICS {\n\n    // The semantics for group of SSRCs belonging to the same stream, primary and RTX.\n    FID = 'FID',\n\n    // The semantics for group with primary SSRCs for each of the simulcast streams.\n    SIM = 'SIM'\n}\n\n/**\n * Standard scalability mode settings for different video codecs and the default bitrates.\n */\nexport const STANDARD_CODEC_SETTINGS = {\n    av1: {\n        maxBitratesVideo: {\n            fullHd: 2000000,\n            high: 1000000,\n            low: 100000,\n            none: 0,\n            ssHigh: 2500000,\n            standard: 300000,\n            ultraHd: 4000000\n        },\n        scalabilityModeEnabled: browser.supportsScalabilityModeAPI(),\n        useKSVC: browser.supportsSVC(),\n        useSimulcast: !browser.supportsSVC(),\n    },\n    h264: {\n        maxBitratesVideo: {\n            fullHd: 4000000,\n            high: 2000000,\n            low: 400000,\n            none: 0,\n            ssHigh: 2500000,\n            standard: 800000,\n            ultraHd: 8000000,\n        },\n        scalabilityModeEnabled: browser.supportsScalabilityModeAPI()\n    },\n    vp8: {\n        maxBitratesVideo: {\n            fullHd: 3000000,\n            high: 1500000,\n            low: 200000,\n            none: 0,\n            ssHigh: 2500000,\n            standard: 500000,\n            ultraHd: 6000000,\n        },\n        scalabilityModeEnabled: false\n    },\n    vp9: {\n        maxBitratesVideo: {\n            fullHd: 2500000,\n            high: 1200000,\n            low: 100000,\n            none: 0,\n            ssHigh: 2500000,\n            standard: 300000,\n            ultraHd: 5000000\n        },\n        scalabilityModeEnabled: browser.supportsScalabilityModeAPI(),\n        useKSVC: browser.supportsSVC(),\n        useSimulcast: !browser.supportsSVC(),\n    }\n};\n\n/**\n * Video codecs in descending order of complexity for camera and desktop video types based on the results of manual\n * performance tests on different platforms. When a CPU limitation is encountered, client switches the call to use the\n * next codec in the list.\n */\nexport const VIDEO_CODECS_BY_COMPLEXITY = {\n    'camera': [\n        CodecMimeType.AV1,\n        CodecMimeType.VP9,\n        CodecMimeType.VP8\n    ],\n    'desktop': [\n        CodecMimeType.VP9,\n        CodecMimeType.VP8,\n        CodecMimeType.AV1\n    ]\n};\n\n/**\n * Standard video resolutions and the corresponding quality level that will be picked for the given resolution.\n * For quality levels:\n * 'high' and above - the encoder will be configured to encode 3 spatial layers.\n * 'standard' - the encoder will be configured to encode 2 spatial laters.\n * 'low' - the encoder will be configured to encode only 1 spatial layer.\n * In all the above cases, each of the layers will again have 3 temporal layers, except for VP8 codec for which only\n * 2 temporal layers are configured by default.\n */\nexport const VIDEO_QUALITY_LEVELS = [\n    {\n        height: 2160,\n        level: 'ultraHd'\n    },\n    {\n        height: 1080,\n        level: 'fullHd'\n    },\n    {\n        height: 720,\n        level: 'high'\n    },\n    {\n        height: 540,\n        level: 'standard'\n    },\n    {\n        height: 480,\n        level: 'standard'\n    },\n    {\n        height: 360,\n        level: 'standard'\n    },\n    {\n        height: 270,\n        level: 'low'\n    },\n    {\n        height: 180,\n        level: 'low'\n    },\n    {\n        height: 90,\n        level: 'low'\n    },\n    {\n        height: 0,\n        level: 'none'\n    }\n];\n\n/**\n * Enumerate the supported video resolutions.\n */\nexport enum VIDEO_QUALITY_SETTINGS {\n\n    // 1920x1080 or full High Definition.\n    FULL = 'fullHd',\n\n    // 1280x720 or High Definition.\n    HIGH = 'high',\n\n    // 320x180 or Low Definition.\n    LOW = 'low',\n\n    // When the camera is turned off.\n    NONE = 'none',\n\n    // 640x360 or Standard Definition.\n    STANDARD = 'standard',\n\n    // 3840x2160 or 4k.\n    ULTRA = 'ultraHd'\n}\n","import transform, { type MediaDescription } from 'sdp-transform';\n\nimport { MediaDirection } from '../../service/RTC/MediaDirection';\nimport { SSRC_GROUP_SEMANTICS } from '../../service/RTC/StandardVideoQualitySettings';\n\n/**\n * Parses the primary SSRC of given SSRC group.\n * @param {object} group the SSRC group object as defined by the 'sdp-transform'\n * @return {Number} the primary SSRC number\n */\nexport function parsePrimarySSRC(group: { ssrcs: string; }): number {\n    return parseInt(group.ssrcs.split(' ')[0], 10);\n}\n\n/**\n * Parses the secondary SSRC of given SSRC group.\n * @param {object} group the SSRC group object as defined by the 'sdp-transform'\n * @return {Number} the secondary SSRC number\n */\nexport function parseSecondarySSRC(group: { ssrcs: string; }): number {\n    return parseInt(group.ssrcs.split(' ')[1], 10);\n}\n\n/**\n * Tells how many distinct SSRCs are contained in given media line.\n * @param {Object} MediaDescription the media line object as defined by 'sdp-transform' lib\n * @return {number}\n */\nfunction _getSSRCCount(mLine: MediaDescription): number {\n    if (!mLine.ssrcs) {\n        return 0;\n    }\n\n    return mLine.ssrcs\n        .map(ssrcInfo => ssrcInfo.id)\n        .filter((ssrc, index, array) => array.indexOf(ssrc) === index)\n        .length;\n}\n\n/**\n * A wrapper around 'sdp-transform' media description object which provides\n * utility methods for common SDP/SSRC related operations.\n */\nexport class MLineWrap {\n    /*\n    * The underlying media line object as defined by 'sdp-transform'\n    * @internal\n    */\n    _mLine: MediaDescription;\n\n    /**\n     * Creates new <tt>MLineWrap</t>>\n     * @param {Object} _mLine the media line object as defined by 'sdp-transform'\n     * lib.\n     */\n    constructor(mLine: MediaDescription) {\n        if (!mLine) {\n            throw new Error('mLine is undefined');\n        }\n\n        this._mLine = mLine;\n    }\n\n    /**\n     * Getter for the mLine's \"ssrcs\" array. If the array was undefined an empty\n     * one will be preassigned.\n     *\n     * @return {Array<Object>} an array of 'sdp-transform' SSRC attributes\n     * objects.\n     */\n    get ssrcs(): MediaDescription['ssrcs'] {\n        if (!this._mLine.ssrcs) {\n            this._mLine.ssrcs = [];\n        }\n\n        return this._mLine.ssrcs;\n    }\n\n    /**\n     * Setter for the mLine's \"ssrcs\" array.\n     *\n     * @param {Array<Object>} ssrcs an array of 'sdp-transform' SSRC attributes\n     * objects.\n     */\n    set ssrcs(ssrcs: MediaDescription['ssrcs']) {\n        this._mLine.ssrcs = ssrcs;\n    }\n\n    /**\n     * Returns the direction of the underlying media description.\n     * @return {Optional<string>} the media direction name as defined in the SDP.\n     */\n    get direction(): Optional<string> {\n        return this._mLine.direction;\n    }\n\n    /**\n     * Modifies the direction of the underlying media description.\n     * @param {Optional<string>} direction the new direction to be set\n     */\n    set direction(direction: Optional<MediaDirection>) {\n        this._mLine.direction = direction;\n    }\n\n    /**\n     * Exposes the SSRC group array of the underlying media description object.\n     * @return {MediaDescription['ssrcGroups']}\n     */\n    get ssrcGroups(): MediaDescription['ssrcGroups'] {\n        if (!this._mLine.ssrcGroups) {\n            this._mLine.ssrcGroups = [];\n        }\n\n        return this._mLine.ssrcGroups;\n    }\n\n    /**\n     * Modifies the SSRC groups array of the underlying media description\n     * object.\n     * @param {MediaDescription['ssrcGroups']} ssrcGroups\n     */\n    set ssrcGroups(ssrcGroups: MediaDescription['ssrcGroups']) {\n        this._mLine.ssrcGroups = ssrcGroups;\n    }\n\n    /**\n     * Obtains value from SSRC attribute.\n     * @param {number} ssrcNumber the SSRC number for which attribute is to be\n     * found\n     * @param {string} attrName the name of the SSRC attribute to be found.\n     * @return {Optional<string>} the value of SSRC attribute or\n     * <tt>undefined</tt> if no such attribute exists.\n     */\n    getSSRCAttrValue(ssrcNumber: number, attrName: string): Optional<string> {\n        const attribute = this.ssrcs.find(\n            ssrcObj => ssrcObj.id === ssrcNumber\n            && ssrcObj.attribute === attrName);\n\n        return attribute?.value;\n    }\n\n    /**\n     * Removes all attributes for given SSRC number.\n     * @param {number} ssrcNum the SSRC number for which all attributes will be\n     * removed.\n     */\n    removeSSRC(ssrcNum: number): void {\n        if (!this._mLine.ssrcs?.length) {\n            return;\n        }\n\n        this._mLine.ssrcs\n            = this._mLine.ssrcs.filter(ssrcObj => ssrcObj.id !== ssrcNum);\n    }\n\n    /**\n     * Adds SSRC attribute\n     * @param {object} ssrcObj the SSRC attribute object as defined in\n     * the 'sdp-transform' lib.\n     */\n    addSSRCAttribute(ssrcObj: MediaDescription['ssrcs'][number]): void {\n        this.ssrcs.push(ssrcObj);\n    }\n\n    /**\n     * Finds a SSRC group matching both semantics and SSRCs in order.\n     * @param {string} semantics the name of the semantics\n     * @param {string} [ssrcs] group SSRCs as a string (like it's defined in\n     * SSRC group object of the 'sdp-transform' lib) e.g. \"1232546 342344 25434\"\n     * @return {Optional<MediaDescription['ssrcGroups'][number]>} the SSRC group object or <tt>undefined</tt> if not found.\n     */\n    findGroup(semantics: string, ssrcs?: string): Optional<MediaDescription['ssrcGroups'][number]> {\n        return this.ssrcGroups.find(\n            group =>\n                group.semantics === semantics\n                    && (!ssrcs || ssrcs === group.ssrcs));\n    }\n\n    /**\n     * Finds all groups matching given semantic's name.\n     * @param {string} semantics the name of the semantics\n     * @return {MediaDescription['ssrcGroups']} an array of SSRC group objects as defined by the 'sdp-transform' lib.\n     */\n    findGroups(semantics: string): MediaDescription['ssrcGroups'] {\n        return this.ssrcGroups.filter(\n            group => group.semantics === semantics);\n    }\n\n    /**\n     * Finds all groups matching given semantic's name and group's primary SSRC.\n     * @param {string} semantics the name of the semantics\n     * @param {number} primarySSRC the primary SSRC number to be matched\n     * @return {Optional<MediaDescription['ssrcGroups'][number]>} SSRC group object as defined by the 'sdp-transform' lib.\n     */\n    findGroupByPrimarySSRC(semantics: string, primarySSRC: number): Optional<MediaDescription['ssrcGroups'][number]> {\n        return this.ssrcGroups.find(\n            group => group.semantics === semantics\n                && parsePrimarySSRC(group) === primarySSRC);\n    }\n\n    /**\n     * Gets the SSRC count for the underlying media description.\n     * @return {number}\n     */\n    getSSRCCount(): number {\n        return _getSSRCCount(this._mLine);\n    }\n\n    /**\n     * Checks whether the underlying media description contains any SSRC groups.\n     * @return {boolean} <tt>true</tt> if there are any SSRC groups or\n     * <tt>false</tt> otherwise.\n     */\n    containsAnySSRCGroups(): boolean {\n        return this._mLine.ssrcGroups !== undefined;\n    }\n\n    /**\n     * Finds the primary video SSRC.\n     * @returns {Optional<number>} the primary video ssrc\n     * @throws Error if the underlying media description is not a video\n     */\n    getPrimaryVideoSsrc(): Optional<number> {\n        const mediaType = this._mLine.type;\n\n        if (mediaType !== 'video') {\n            throw new Error(\n                `getPrimarySsrc doesn't work with '${mediaType}'`);\n        }\n\n        const numSsrcs = _getSSRCCount(this._mLine);\n\n        if (numSsrcs === 1) {\n            // Not using \"ssrcs\" getter on purpose here\n            return this._mLine.ssrcs![0].id;\n        }\n\n        // Look for a SIM, FID, or FEC-FR group\n        if (this._mLine.ssrcGroups) {\n            const simGroup = this.findGroup(SSRC_GROUP_SEMANTICS.SIM);\n\n            if (simGroup) {\n                return parsePrimarySSRC(simGroup);\n            }\n            const fidGroup = this.findGroup(SSRC_GROUP_SEMANTICS.FID);\n\n            if (fidGroup) {\n                return parsePrimarySSRC(fidGroup);\n            }\n            const fecGroup = this.findGroup('FEC-FR');\n\n            if (fecGroup) {\n                return parsePrimarySSRC(fecGroup);\n            }\n        }\n    }\n\n    /**\n     * Obtains RTX SSRC from the underlying video description (the\n     * secondary SSRC of the first \"FID\" group found)\n     * @param {number} primarySsrc the video ssrc for which to find the\n     * corresponding rtx ssrc\n     * @returns {Optional<number>} the rtx ssrc (or undefined if there isn't\n     * one)\n     */\n    getRtxSSRC(primarySsrc: number): Optional<number> {\n        const fidGroup = this.findGroupByPrimarySSRC(SSRC_GROUP_SEMANTICS.FID, primarySsrc);\n\n        return fidGroup && parseSecondarySSRC(fidGroup);\n    }\n\n    /**\n     * Obtains all SSRCs contained in the underlying media description.\n     * @return {Array.<number>} an array with all SSRC as numbers.\n     */\n    getSSRCs(): number[] {\n        return this.ssrcs\n            .map(ssrcInfo => ssrcInfo.id)\n            .filter((ssrc, index, array) => array.indexOf(ssrc) === index);\n    }\n\n    /**\n     * Obtains primary video SSRCs.\n     * @return {Array.<number>} an array of all primary video SSRCs as numbers.\n     * @throws Error if the wrapped media description is not a video.\n     */\n    getPrimaryVideoSSRCs(): number[] {\n        const mediaType = this._mLine.type;\n\n        if (mediaType !== 'video') {\n            throw new Error(\n                `getPrimaryVideoSSRCs doesn't work with ${mediaType}`);\n        }\n\n        const videoSSRCs = this.getSSRCs();\n\n        for (const ssrcGroupInfo of this.ssrcGroups) {\n            // Right now, FID and FEC-FR groups are the only ones we parse to\n            // disqualify streams.  If/when others arise we'll\n            // need to add support for them here\n            if (ssrcGroupInfo.semantics === SSRC_GROUP_SEMANTICS.FID\n                    || ssrcGroupInfo.semantics === 'FEC-FR') {\n                // secondary streams should be filtered out\n                const secondarySsrc = parseSecondarySSRC(ssrcGroupInfo);\n\n                videoSSRCs.splice(\n                    videoSSRCs.indexOf(secondarySsrc), 1);\n            }\n        }\n\n        return videoSSRCs;\n    }\n\n    /**\n     * Removes all SSRC groups which contain given SSRC number at any position.\n     * @param {number} ssrc the SSRC for which all matching groups are to be\n     * removed.\n     */\n    removeGroupsWithSSRC(ssrc: number): void {\n        if (!this._mLine.ssrcGroups) {\n            return;\n        }\n\n        this._mLine.ssrcGroups = this._mLine.ssrcGroups\n            .filter(groupInfo => groupInfo.ssrcs.indexOf(`${ssrc}`) === -1);\n    }\n\n    /**\n     * Removes groups that match given semantics.\n     * @param {string} semantics e.g. \"SIM\" or \"FID\"\n     */\n    removeGroupsBySemantics(semantics: string): void {\n        if (!this._mLine.ssrcGroups) {\n            return;\n        }\n\n        this._mLine.ssrcGroups\n            = this._mLine.ssrcGroups\n                .filter(groupInfo => groupInfo.semantics !== semantics);\n    }\n\n    /**\n     * Adds given SSRC group to this media description.\n     * @param {object} group the SSRC group object as defined by\n     * the 'sdp-transform' lib.\n     */\n    addSSRCGroup(group: MediaDescription['ssrcGroups'][number]): void {\n        this.ssrcGroups.push(group);\n    }\n}\n\n/**\n * Utility class for SDP manipulation using the 'sdp-transform' library.\n *\n * Typical use usage scenario:\n *\n * const transformer = new SdpTransformWrap(rawSdp);\n * const videoMLine = transformer.selectMedia('video);\n * if (videoMLine) {\n *     videoMLiner.addSSRCAttribute({\n *         id: 2342343,\n *         attribute: \"cname\",\n *         value: \"someCname\"\n *     });\n *     rawSdp = transformer.toRawSdp();\n * }\n */\nexport class SdpTransformWrap {\n    private parsedSDP: transform.SessionDescription;\n\n    /**\n     * Creates new instance and parses the raw SDP into objects using\n     * 'sdp-transform' lib.\n     * @param {string} rawSDP the SDP in raw text format.\n     */\n    constructor(rawSDP: string) {\n        this.parsedSDP = transform.parse(rawSDP);\n    }\n\n    /**\n     * Selects all the m-lines from the SDP for a given media type.\n     *\n     * @param {string} mediaType the name of the media e.g. 'audio', 'video', 'data'.\n     * @return {MLineWrap|null} return {@link MLineWrap} instance for the media line or <tt>null</tt> if not found. The\n     * object returned references the underlying SDP state held by this <tt>SdpTransformWrap</tt> instance (it's not a\n     * copy).\n     */\n    selectMedia(mediaType: string): Nullable<MLineWrap[]> {\n        const selectedMLines = this.parsedSDP.media\n            .filter(mLine => mLine.type === mediaType)\n            .map(mLine => new MLineWrap(mLine as MediaDescription));\n\n        return selectedMLines ?? null;\n    }\n\n    /**\n     * Converts the currently stored SDP state in this instance to raw text SDP\n     * format.\n     * @return {string}\n     */\n    toRawSDP(): string {\n        return transform.write(this.parsedSDP);\n    }\n}\n","import { isEqual } from 'lodash-es';\n\nimport { MediaDirection } from '../../service/RTC/MediaDirection';\nimport { MediaType } from '../../service/RTC/MediaType';\nimport TraceablePeerConnection from '../RTC/TraceablePeerConnection';\nimport browser from '../browser';\n\nimport { MLineWrap, SdpTransformWrap } from './SdpTransformUtil';\nimport { ISsrcInfo } from './constants';\n\n/**\n * Fakes local SDP exposed to {@link JingleSessionPC} through the local description getter. Modifies the SDP, so that\n * the stream identifiers are unique across all of the local PeerConnections and that the source names and video types\n * are injected so that Jicofo can use them to identify the sources.\n */\nexport default class LocalSdpMunger {\n    private _localEndpointId: string;\n    private _tpc: TraceablePeerConnection;\n\n    /**\n     * Creates new <tt>LocalSdpMunger</tt> instance.\n     *\n     * @param {TraceablePeerConnection} tpc\n     * @param {string} localEndpointId - The endpoint id of the local user.\n     */\n    constructor(tpc: TraceablePeerConnection, localEndpointId: string) {\n        this._tpc = tpc;\n        this._localEndpointId = localEndpointId;\n    }\n\n    /**\n     * Updates or adds a 'msid' attribute for the local sources in the SDP. Also adds 'sourceName' and 'videoType'\n     * (if applicable) attributes. All other source attributes like 'cname', 'label' and 'mslabel' are removed since\n     * these are not processed by Jicofo.\n     *\n     * @param {MLineWrap} mediaSection - The media part (audio or video) of the session description which will be\n     * modified in place.\n     * @returns {void}\n     * @private\n     */\n    private _transformMediaIdentifiers(mediaSection: MLineWrap, ssrcMap: Map<string, ISsrcInfo>): void {\n        const mediaType = mediaSection._mLine.type;\n        const mediaDirection = mediaSection._mLine.direction;\n        const sources = [ ...new Set(mediaSection._mLine.ssrcs?.map(s => s.id)) ];\n        let trackId = mediaSection._mLine.msid?.split(' ')[1];\n        let sourceName: string | undefined;\n\n        if (ssrcMap.size) {\n            const sortedSources = sources.slice().sort();\n\n            for (const [ id, trackSsrcs ] of ssrcMap.entries()) {\n                if (isEqual(sortedSources, [ ...trackSsrcs.ssrcs ].sort())) {\n                    sourceName = id;\n                }\n            }\n            for (const source of sources) {\n                if ((mediaDirection === MediaDirection.SENDONLY || mediaDirection === MediaDirection.SENDRECV)\n                    && sourceName) {\n                    const msid = mediaSection.ssrcs.find(ssrc => ssrc.id === source && ssrc.attribute === 'msid');\n\n                    if (msid) {\n                        trackId = msid.value.split(' ')[1];\n                    }\n                    const generatedMsid = `${ssrcMap.get(sourceName).msid}-${this._tpc.id} ${trackId}-${this._tpc.id}`;\n                    const existingMsid = mediaSection.ssrcs\n                        .find(ssrc => ssrc.id === source && ssrc.attribute === 'msid');\n\n                    // Always overwrite msid since we want the msid to be in this format even if the browser generates\n                    // one. '<endpoint_id>-<mediaType>-<trackIndex>-<tpcId>' example - d8ff91-video-0-1\n                    if (existingMsid) {\n                        existingMsid.value = generatedMsid;\n                    } else {\n                        mediaSection.ssrcs.push({\n                            attribute: 'msid',\n                            id: source,\n                            value: generatedMsid\n                        });\n                    }\n\n                    // Inject source names as a=ssrc:3124985624 name:endpointA-v0\n                    mediaSection.ssrcs.push({\n                        attribute: 'name',\n                        id: source,\n                        value: sourceName\n                    });\n\n                    const videoType = this._tpc.getLocalVideoTracks()\n                        .find(track => track.getSourceName() === sourceName)\n                        ?.getVideoType();\n\n                    if (mediaType === MediaType.VIDEO && videoType) {\n                        // Inject videoType as a=ssrc:1234 videoType:desktop.\n                        mediaSection.ssrcs.push({\n                            attribute: 'videoType',\n                            id: source,\n                            value: videoType\n                        });\n                    }\n                }\n            }\n        }\n\n        // Ignore the 'label' and 'mslabel' attributes.\n        mediaSection.ssrcs\n            = mediaSection.ssrcs.filter(ssrc => ssrc.attribute !== 'label' && ssrc.attribute !== 'mslabel');\n\n        // Remove the 'cname' attribute on Firefox as a=ssrc line with only 'cname' attribute are present in the SDP\n        // for recvonly SSRCs generated by createAnswer. These do not have to be signaled to the peers.\n        if (browser.isFirefox()) {\n            mediaSection.ssrcs = mediaSection.ssrcs.filter(ssrc => ssrc.attribute !== 'cname');\n        }\n\n        // On FF when the user has started muted create answer will generate a recv only SSRC. We don't want to signal\n        // this SSRC in order to reduce the load of the xmpp server for large calls. Therefore the SSRC needs to be\n        // removed from the SDP.\n        //\n        // For all other use cases (when the user has had media but then the user has stopped it) we want to keep the\n        // receive only SSRCs in the SDP. Otherwise source-remove will be triggered and the next time the user add a\n        // track we will reuse the SSRCs and send source-add with the same SSRCs. This is problematic because of issues\n        // on Chrome and FF (https://bugzilla.mozilla.org/show_bug.cgi?id=1768729) when removing and then adding the\n        // same SSRC in the remote sdp the remote track is not rendered.\n        if (browser.isFirefox()\n            && (mediaDirection === MediaDirection.RECVONLY || mediaDirection === MediaDirection.INACTIVE)\n            && (\n                (mediaType === MediaType.VIDEO && !this._tpc._hasHadVideoTrack)\n                || (mediaType === MediaType.AUDIO && !this._tpc._hasHadAudioTrack)\n            )\n        ) {\n            mediaSection.ssrcs = undefined;\n            mediaSection.ssrcGroups = undefined;\n        }\n    }\n\n    /**\n     * This transformation will make sure that stream identifiers are unique across all of the local PeerConnections\n     * even if the same stream is used by multiple instances at the same time. It also injects 'sourceName' and\n     * 'videoType' attribute.\n     *\n     * @param {RTCSessionDescription} sessionDesc - The local session description (this instance remains unchanged).\n     * @param {Map<string, TPCSSRCInfo>} ssrcMap - The SSRC and source map for the local tracks.\n     * @return {RTCSessionDescription} - Transformed local session description\n     * (a modified copy of the one given as the input).\n     */\n    transformStreamIdentifiers(sessionDesc: RTCSessionDescription, ssrcMap: Map<string, ISsrcInfo>): RTCSessionDescription {\n        if (!sessionDesc?.sdp || !sessionDesc.type) {\n            return sessionDesc;\n        }\n\n        const transformer = new SdpTransformWrap(sessionDesc.sdp);\n        const audioMLine = transformer.selectMedia(MediaType.AUDIO)?.[0];\n\n        if (audioMLine) {\n            this._transformMediaIdentifiers(audioMLine, ssrcMap);\n        }\n\n        const videoMlines = transformer.selectMedia(MediaType.VIDEO);\n\n        if (videoMlines && Array.isArray(videoMlines)) {\n            for (const videoMLine of videoMlines) {\n                this._transformMediaIdentifiers(videoMLine, ssrcMap);\n            }\n        }\n\n        return {\n            sdp: transformer.toRawSDP(),\n            type: sessionDesc.type\n        } as RTCSessionDescription;\n    }\n}\n","import { getLogger } from '@jitsi/logger';\nimport type { MediaDescription } from 'sdp-transform';\n\nimport { CodecMimeType } from '../../service/RTC/CodecMimeType';\nimport { MediaDirection } from '../../service/RTC/MediaDirection';\nimport { SSRC_GROUP_SEMANTICS } from '../../service/RTC/StandardVideoQualitySettings';\nimport browser from '../browser';\nimport RandomUtil from '../util/RandomUtil';\n\nimport { ICryptoData, IExtmapData, IFingerprintData, IFmtpParameter, IICECandidate, IICEParams, IMediaLine, IRTCPFBData, IRTPMapData, ISsrcGroup } from './constants';\n\nconst logger = getLogger('sdp:SDPUtils');\n\nconst SDPUtil = {\n    /**\n     * Builds an ICE candidate line for SDP.\n     *\n     * @param {IICECandidate} cand - The ICE candidate object.\n     * @returns {string} - The SDP line for the ICE candidate.\n     */\n    buildICECandidate(cand: IICECandidate): string {\n        let line = [\n            `a=candidate:${cand.foundation}`,\n            cand.component,\n            cand.protocol,\n            cand.priority,\n            cand.ip,\n            cand.port,\n            'typ',\n            cand.type\n        ].join(' ');\n\n        line += ' ';\n        switch (cand.type) {\n        case 'srflx':\n        case 'prflx':\n        case 'relay':\n            if (cand.hasOwnAttribute('rel-addr')\n                    && cand.hasOwnAttribute('rel-port')) {\n                line += 'raddr';\n                line += ' ';\n                line += cand['rel-addr'];\n                line += ' ';\n                line += 'rport';\n                line += ' ';\n                line += cand['rel-port'];\n                line += ' ';\n            }\n            break;\n        }\n        if (cand.hasOwnAttribute('tcptype')) {\n            line += 'tcptype';\n            line += ' ';\n            line += cand.tcptype;\n            line += ' ';\n        }\n        line += 'generation';\n        line += ' ';\n        line += cand.hasOwnAttribute('generation') ? cand.generation : '0';\n\n        return line;\n    },\n\n    /**\n     * Builds an ICE password line for SDP.\n     *\n     * @param {string} pwd - The ICE password.\n     * @returns {string} - The SDP line for the ICE password.\n     */\n    buildICEPwd(pwd: string): string {\n        return `a=ice-pwd:${pwd}`;\n    },\n\n    /**\n     * Builds an ICE ufrag line for SDP.\n     *\n     * @param {string} frag - The ICE ufrag.\n     * @returns {string} - The SDP line for the ICE ufrag.\n     */\n    buildICEUfrag(frag: string): string {\n        return `a=ice-ufrag:${frag}`;\n    },\n\n    /**\n     * Builds an SDP media line.\n     *\n     * @param {IMediaLine} mline - The media line object.\n     * @returns {string} - The SDP media line.\n     */\n    buildMLine(mline: IMediaLine): string {\n        return (\n            `m=${mline.media} ${mline.port} ${mline.proto} ${\n                mline.fmt.join(' ')}`);\n    },\n\n    /**\n     * Builds an RTP map line for SDP.\n     *\n     * @param {Element} el - The RTP map element.\n     * @returns {String} - The SDP line for the RTP map.\n     */\n    buildRTPMap(el: Element): string {\n        let line\n            = `a=rtpmap:${el.getAttribute('id')} ${el.getAttribute('name')}/${\n                el.getAttribute('clockrate')}`;\n\n        if (el.getAttribute('channels')\n            && el.getAttribute('channels') !== '1') {\n            line += `/${el.getAttribute('channels')}`;\n        }\n\n        return line;\n    },\n\n    /**\n     * Builds an ICE candidate line for SDP.\n     *\n     * @param {Element} cand - The ICE candidate object.\n     * @returns {string} - The SDP line for the ICE candidate.\n     */\n    candidateFromJingle(cand: Element): string {\n        let line = 'a=candidate:';\n\n        line += cand.getAttribute('foundation');\n        line += ' ';\n        line += cand.getAttribute('component');\n        line += ' ';\n\n        let protocol = cand.getAttribute('protocol');\n\n        // use tcp candidates for FF\n\n        if (browser.isFirefox() && protocol.toLowerCase() === 'ssltcp') {\n            protocol = 'tcp';\n        }\n\n        line += protocol; // .toUpperCase(); // chrome M23 doesn't like this\n        line += ' ';\n        line += cand.getAttribute('priority');\n        line += ' ';\n        line += cand.getAttribute('ip');\n        line += ' ';\n        line += cand.getAttribute('port');\n        line += ' ';\n        line += 'typ';\n        line += ` ${cand.getAttribute('type')}`;\n        line += ' ';\n        switch (cand.getAttribute('type')) {\n        case 'srflx':\n        case 'prflx':\n        case 'relay':\n            if (cand.getAttribute('rel-addr')\n                    && cand.getAttribute('rel-port')) {\n                line += 'raddr';\n                line += ' ';\n                line += cand.getAttribute('rel-addr');\n                line += ' ';\n                line += 'rport';\n                line += ' ';\n                line += cand.getAttribute('rel-port');\n                line += ' ';\n            }\n            break;\n        }\n        if (protocol.toLowerCase() === 'tcp') {\n            line += 'tcptype';\n            line += ' ';\n            line += cand.getAttribute('tcptype');\n            line += ' ';\n        }\n        line += 'generation';\n        line += ' ';\n        line += cand.getAttribute('generation') || '0';\n\n        return `${line}\\r\\n`;\n    },\n\n    /**\n     * Builds an ICE candidate from SDP.\n     *\n     * @param {string} line - The SDP line for the ICE candidate.\n     * @returns {Nullable<IICECandidate>} - The Jingle XML representation of the ICE candidate.\n     */\n    candidateToJingle(line: string): Nullable<IICECandidate> {\n        // a=candidate:2979166662 1 udp 2113937151 192.168.2.100 57698 typ host\n        // generation 0\n        //      <candidate component=... foundation=... generation=... id=...\n        // ip=... network=... port=... priority=... protocol=... type=.../>\n        if (line.indexOf('candidate:') === 0) {\n            // eslint-disable-next-line no-param-reassign\n            line = `a=${line}`;\n        } else if (line.substring(0, 12) !== 'a=candidate:') {\n            logger.warn(\n                'parseCandidate called with a line that is not a candidate'\n                    + ' line');\n            logger.warn(line);\n\n            return null;\n        }\n        if (line.substring(line.length - 2) === '\\r\\n') { // chomp it\n            // eslint-disable-next-line no-param-reassign\n            line = line.substring(0, line.length - 2);\n        }\n        const candidate: Partial<IICECandidate> = {};\n        const elems = line.split(' ');\n\n        if (elems[6] !== 'typ') {\n            logger.warn('did not find typ in the right place');\n            logger.warn(line);\n\n            return null;\n        }\n        candidate.foundation = elems[0].substring(12);\n        candidate.component = elems[1];\n        candidate.protocol = elems[2].toLowerCase();\n        candidate.priority = elems[3];\n        candidate.ip = elems[4];\n        candidate.port = elems[5];\n\n        // elems[6] => \"typ\"\n        candidate.type = elems[7];\n\n        candidate.generation = '0'; // default, may be overwritten below\n        for (let i = 8; i < elems.length; i += 2) {\n            switch (elems[i]) {\n            case 'raddr':\n                candidate['rel-addr'] = elems[i + 1];\n                break;\n            case 'rport':\n                candidate['rel-port'] = elems[i + 1];\n                break;\n            case 'generation':\n                candidate.generation = elems[i + 1];\n                break;\n            case 'tcptype':\n                candidate.tcptype = elems[i + 1];\n                break;\n            default: // TODO\n                logger.debug(`not translating \"${elems[i]}\" = \"${elems[i + 1]}\"`);\n            }\n        }\n        candidate.network = '1';\n\n        // not applicable to SDP -- FIXME: should be unique, not just random\n        // eslint-disable-next-line newline-per-chained-call\n        candidate.id = Math.random().toString(36).substr(2, 10);\n\n        return candidate as IICECandidate;\n    },\n\n    filterSpecialChars(text: Nullable<Optional<string>>): Nullable<Optional<string>> {\n        // XXX Neither one of the falsy values (e.g. null, undefined, false,\n        // \"\", etc.) \"contain\" special chars.\n        // eslint-disable-next-line no-useless-escape\n        return text ? text.replace(/[\\\\\\/\\{,\\}\\+]/g, '') : text;\n    },\n\n    /**\n     * Finds a line in the SDP that starts with the given search pattern.\n     *\n     * @param {string} haystack - The SDP string to search.\n     * @param {string} needle - The line prefix to find.\n     * @param {string} sessionpart - The session part to search within.\n     * @returns {Optional<string>} - The found line or false if not found.\n     */\n    findLine(haystack: string, needle: string, sessionpart?: string): Optional<string> {\n        let lines = haystack.split('\\r\\n');\n\n        for (let i = 0; i < lines.length; i++) {\n            if (lines[i].substring(0, needle.length) === needle) {\n                return lines[i];\n            }\n        }\n        if (!sessionpart) {\n            return undefined;\n        }\n\n        // search session part\n        lines = sessionpart.split('\\r\\n');\n        for (let j = 0; j < lines.length; j++) {\n            if (lines[j].substring(0, needle.length) === needle) {\n                return lines[j];\n            }\n        }\n\n        return undefined;\n    },\n\n    /**\n     * Finds all lines in the SDP that start with the given search pattern.\n     *\n     * @param {string} haystack - The SDP string to search.\n     * @param {string} needle - The line prefix to find.\n     * @param {string} sessionpart - The session part to search within.\n     * @returns {string[]} - An array of found lines.\n     */\n    findLines(haystack: string, needle: string, sessionpart?: string): string[] {\n        let lines = haystack.split('\\r\\n');\n        const needles = [];\n\n        for (let i = 0; i < lines.length; i++) {\n            if (lines[i].substring(0, needle.length) === needle) {\n                needles.push(lines[i]);\n            }\n        }\n        if (needles.length || !sessionpart) {\n            return needles;\n        }\n\n        // search session part\n        lines = sessionpart.split('\\r\\n');\n        for (let j = 0; j < lines.length; j++) {\n            if (lines[j].substring(0, needle.length) === needle) {\n                needles.push(lines[j]);\n            }\n        }\n\n        return needles;\n    },\n\n    /**\n     * Generates a random SSRC value.\n     *\n     * @returns {number} - A random SSRC value.\n     */\n    generateSsrc(): number {\n        return RandomUtil.randomInt(1, 0xffffffff);\n    },\n\n    /**\n     * Gets the SSRC attribute value from the media line.\n     *\n     * @param {MediaDescription} mLine - The media line object.\n     * @param {number} ssrc - The SSRC value to search for.\n     * @param {string} attributeName - The attribute name to search for.\n     * @returns {string|null} - The attribute value or null if not found.\n     */\n    getSsrcAttribute(mLine: MediaDescription, ssrc: number, attributeName: string): Nullable<string> {\n        for (let i = 0; i < mLine.ssrcs.length; ++i) {\n            const ssrcLine = mLine.ssrcs[i];\n\n            if (ssrcLine.id === ssrc\n                && ssrcLine.attribute === attributeName) {\n                return ssrcLine.value;\n            }\n        }\n    },\n\n    /**\n     * Gets the ICE ufrag from the SDP.\n     *\n     * @param {string} sdp - The SDP string to search.\n     * @returns {Optional<string>} - The ICE ufrag value or undefined if not found.\n     */\n    getUfrag(sdp: string): Optional<string> {\n        const ufragLines\n            = sdp.split('\\n').filter(line => line.startsWith('a=ice-ufrag:'));\n\n        if (ufragLines.length > 0) {\n            return ufragLines[0].substr('a=ice-ufrag:'.length);\n        }\n    },\n\n    /**\n     * Gets the ICE parameters from the media description and session description.\n     *\n     * @param {string} mediadesc - The media description string.\n     * @param {string} sessiondesc - The session description string.\n     * @returns {Nullable<IICEParams>} - The ICE parameters object or null if not found.\n     */\n    iceparams(mediadesc: string, sessiondesc: string): Nullable<IICEParams> {\n        let data = null;\n        let pwd, ufrag;\n\n        if ((ufrag = SDPUtil.findLine(mediadesc, 'a=ice-ufrag:', sessiondesc))\n                && (pwd\n                    = SDPUtil.findLine(\n                        mediadesc,\n                        'a=ice-pwd:',\n                        sessiondesc))) {\n            data = {\n                pwd: SDPUtil.parseICEPwd(pwd),\n                ufrag: SDPUtil.parseICEUfrag(ufrag)\n            };\n        }\n\n        return data;\n    },\n\n    /**\n     * Parses a crypto line from the SDP.\n     *\n     * @param {string} line - The crypto line to parse.\n     * @returns {ICryptoData} - The parsed crypto parameters.\n     */\n    parseCrypto(line: string): ICryptoData {\n        const data: Partial<ICryptoData> = {};\n        const parts = line.substring(9).split(' ');\n\n        data.tag = parts.shift();\n        data['crypto-suite'] = parts.shift();\n        data['key-params'] = parts.shift();\n        if (parts.length) {\n            data['session-params'] = parts.join(' ');\n        }\n\n        return data as ICryptoData;\n    },\n\n    /**\n     * Parses an extmap line from the SDP.\n     *\n     * @param {string} line - The extmap line to parse.\n     * @returns {IExtmapData} - The parsed extmap parameters.\n     */\n    parseExtmap(line: string): IExtmapData {\n        const parts = line.substr(9).split(' ');\n        const data: Partial<IExtmapData> = {};\n\n        data.value = parts.shift();\n        if (data.value.indexOf('/') === -1) {\n            data.direction = 'both';\n        } else {\n            data.direction = data.value.substr(data.value.indexOf('/') + 1);\n            data.value = data.value.substr(0, data.value.indexOf('/'));\n        }\n        data.uri = parts.shift();\n        data.params = parts;\n\n        return data as IExtmapData;\n    },\n\n    /**\n     * Parses a fingerprint line from the SDP.\n     *\n     * @param {string} line - The fingerprint line to parse.\n     * @returns {IFingerprintData} - The parsed fingerprint parameters.\n     */\n    parseFingerprint(line: string): IFingerprintData { // RFC 4572\n        const data: Partial<IFingerprintData> = {};\n        const parts = line.substring(14).split(' ');\n\n        data.hash = parts.shift();\n        data.fingerprint = parts.shift();\n\n        // TODO assert that fingerprint satisfies 2UHEX *(\":\" 2UHEX) ?\n        return data as IFingerprintData;\n    },\n\n    /**\n     * Parses a fmtp line from the SDP.\n     *\n     * @param {string} line - The fmtp line to parse.\n     * @returns {IFmtpParameter[]} - The parsed fmtp parameters.\n     */\n    parseFmtp(line: string): IFmtpParameter[] {\n        const data = [];\n        let parts = line.split(' ');\n\n        parts.shift();\n        parts = parts.join(' ').split(';');\n        for (let i = 0; i < parts.length; i++) {\n            let key = parts[i].split('=')[0];\n\n            while (key.length && key[0] === ' ') {\n                key = key.substring(1);\n            }\n            const value = parts[i].split('=')[1];\n\n            if (key && value) {\n                data.push({ name: key,\n                    value });\n            } else if (key) {\n                // rfc 4733 (DTMF) style stuff\n                data.push({ name: '',\n                    value: key });\n            }\n        }\n\n        return data;\n    },\n\n    /**\n     * Parses the SSRCs from a group description.\n     *\n     * @param {MediaDescription['ssrcGroups'][number]} ssrcGroup - The SSRC group object.\n     * @returns {number[]} - The list of SSRCs in the group.\n     */\n    parseGroupSsrcs(ssrcGroup: MediaDescription['ssrcGroups'][number]): number[] {\n        return ssrcGroup\n            .ssrcs\n            .split(' ')\n            .map(ssrcStr => parseInt(ssrcStr, 10));\n    },\n\n    /**\n     * Parses an ICE candidate line from the SDP.\n     *\n     * @param {string} line - The ICE candidate line to parse.\n     * @returns {IICECandidate} - The parsed ICE candidate parameters.\n     */\n    parseICECandidate(line: string): IICECandidate {\n        const candidate: Partial<IICECandidate> = {};\n        const elems = line.split(' ');\n\n        candidate.foundation = elems[0].substring(12);\n        candidate.component = elems[1];\n        candidate.protocol = elems[2].toLowerCase();\n        candidate.priority = elems[3];\n        candidate.ip = elems[4];\n        candidate.port = elems[5];\n\n        // elems[6] => \"typ\"\n        candidate.type = elems[7];\n        candidate.generation = '0'; // default value, may be overwritten below\n        for (let i = 8; i < elems.length; i += 2) {\n            switch (elems[i]) {\n            case 'raddr':\n                candidate['rel-addr'] = elems[i + 1];\n                break;\n            case 'rport':\n                candidate['rel-port'] = elems[i + 1];\n                break;\n            case 'generation':\n                candidate.generation = elems[i + 1];\n                break;\n            case 'tcptype':\n                candidate.tcptype = elems[i + 1];\n                break;\n            default: // TODO\n                logger.debug(\n                    `parseICECandidate not translating \"${\n                        elems[i]}\" = \"${elems[i + 1]}\"`);\n            }\n        }\n        candidate.network = '1';\n\n        // not applicable to SDP -- FIXME: should be unique, not just random\n        // eslint-disable-next-line newline-per-chained-call\n        candidate.id = Math.random().toString(36).substr(2, 10);\n\n        return candidate as IICECandidate;\n    },\n\n    /**\n     * Parses an ICE password line from the SDP.\n     *\n     * @param {string} line - The ICE password line to parse.\n     * @returns {string} - The parsed ICE password.\n     */\n    parseICEPwd(line: string): string {\n        return line.substring(10);\n    },\n\n    /**\n     * Parses an ICE ufrag line from the SDP.\n     *\n     * @param {string} line - The ICE ufrag line to parse.\n     * @returns {string} - The parsed ICE ufrag.\n     */\n    parseICEUfrag(line: string): string {\n        return line.substring(12);\n    },\n\n    /**\n     * Parses a media ID line from the SDP.\n     *\n     * @param {string} line - The media ID line to parse.\n     * @returns {string} - The parsed media ID.\n     */\n    parseMID(line: string): string {\n        return line.substring(6);\n    },\n\n    /**\n     * Parses a media line from the SDP.\n     *\n     * @param {string} line - The media line to parse.\n     * @returns {IMediaLine} - The parsed media line data.\n     */\n    parseMLine(line: string): IMediaLine {\n        const data: Partial<IMediaLine> = {};\n        const parts = line.substring(2).split(' ');\n\n        data.media = parts.shift();\n        data.port = parts.shift();\n        data.proto = parts.shift();\n        if (parts[parts.length - 1] === '') { // trailing whitespace\n            parts.pop();\n        }\n        data.fmt = parts;\n\n        return data as IMediaLine;\n    },\n\n    /**\n     * Parses the MSID attribute from the given SSRC lines.\n     *\n     * @param {string[]} ssrcLines - The SSRC lines to search.\n     * @returns {Optional<string>} - The parsed MSID or undefined if not found.\n     */\n    parseMSIDAttribute(ssrcLines: string[]): Optional<string> {\n        const msidLine = ssrcLines.find(line => line.indexOf(' msid:') > 0);\n\n        if (!msidLine) {\n            return undefined;\n        }\n\n        const v = msidLine.substring(msidLine.indexOf(' msid:') + 6 /* the length of ' msid:' */);\n\n        return SDPUtil.filterSpecialChars(v);\n    },\n\n    /**\n     * Parse the 'most' primary video ssrc from the given m line\n     * @param {MediaDescription} videoMLine object as parsed from transform.parse\n     * @return {Optional<number>} the primary video ssrc from the given m line\n     */\n    parsePrimaryVideoSsrc(videoMLine: MediaDescription): Optional<number> {\n        const numSsrcs = (videoMLine.ssrcs)\n            .map(ssrcInfo => ssrcInfo.id)\n            .filter((ssrc, index, array) => array.indexOf(ssrc) === index)\n            .length;\n        const numGroups\n            = (videoMLine?.ssrcGroups?.length) || 0;\n\n        if (numSsrcs > 1 && numGroups === 0) {\n            // Ambiguous, can't figure out the primary\n            return;\n        }\n        let primarySsrc: Nullable<number> = null;\n\n        if (numSsrcs === 1) {\n            primarySsrc = videoMLine.ssrcs[0].id;\n        } else if (numSsrcs === 2) {\n            // Can figure it out if there's an FID group\n            const fidGroup\n                = videoMLine.ssrcGroups.find(\n                    group => group.semantics === SSRC_GROUP_SEMANTICS.FID);\n\n            if (fidGroup) {\n                primarySsrc = parseInt(fidGroup.ssrcs.split(' ')[0], 10);\n            }\n        } else if (numSsrcs >= 3) {\n            // Can figure it out if there's a sim group\n            const simGroup\n                = videoMLine.ssrcGroups.find(\n                    group => group.semantics === SSRC_GROUP_SEMANTICS.SIM);\n\n            if (simGroup) {\n                primarySsrc = parseInt(simGroup.ssrcs.split(' ')[0], 10);\n            }\n        }\n\n        return primarySsrc;\n    },\n\n    /**\n     * Parses an RTCP feedback line from the SDP.\n     *\n     * @param {string} line - The RTCP feedback line to parse.\n     * @returns {IRTCPFBData} - The parsed RTCP feedback data.\n     */\n    parseRTCPFB(line: string): IRTCPFBData {\n        const parts = line.substr(10).split(' ');\n        const data: Partial<IRTCPFBData> = {};\n\n        data.pt = parts.shift();\n        data.type = parts.shift();\n        data.params = parts;\n\n        return data as IRTCPFBData;\n    },\n\n    /**\n     * Parses an RTP map line from the SDP.\n     *\n     * @param {string} line - The RTP map line to parse.\n     * @returns {IRTPMapData} - The parsed RTP map data.\n     */\n    parseRTPMap(line: string): IRTPMapData {\n        const data: Partial<IRTPMapData> = {};\n        let parts = line.substring(9).split(' ');\n\n        data.id = parts.shift();\n        parts = parts[0].split('/');\n        data.name = parts.shift();\n        data.clockrate = parts.shift();\n        data.channels = parts.length ? parts.shift() : '1';\n\n        return data as IRTPMapData;\n    },\n\n    /**\n     * Parses SDP line \"a=sctpmap:...\" and extracts SCTP port from it.\n     *\n     * @param {string} line eg. \"a=sctpmap:5000 webrtc-datachannel\"\n     * @returns {[string, string, Nullable<string>]} [SCTP port number, protocol, streams]\n     */\n    parseSCTPMap(line: string): [string, string, Nullable<string>] {\n        const parts = line.substring(10).split(' ');\n        const sctpPort = parts[0];\n        const protocol = parts[1];\n\n        // Stream count is optional\n        const streamCount = parts.length > 2 ? parts[2] : null;\n\n\n        return [ sctpPort, protocol, streamCount ];// SCTP port\n    },\n\n    /**\n     * Parses the SCTP port line from the SDP.\n     *\n     * @param {string} line - The SCTP port line to parse.\n     * @returns {string} - The parsed SCTP port.\n     */\n    parseSCTPPort(line: string): string {\n        return line.substring(12);\n    },\n\n    /**\n     * Parses the SSRC lines from the SDP.\n     *\n     * @param {string} desc - The SDP description to parse.\n     * @returns {Map<string, string[]>} - A map of SSRCs to their corresponding lines.\n     */\n    parseSSRC(desc: string): Map<string, string[]> {\n        // proprietary mapping of a=ssrc lines\n        // TODO: see \"Jingle RTP Source Description\" by Juberti and P. Thatcher\n        // on google docs and parse according to that\n        const data = new Map();\n        const lines = desc.split('\\r\\n');\n\n        for (let i = 0; i < lines.length; i++) {\n            if (lines[i].substring(0, 7) === 'a=ssrc:') {\n                // FIXME: Use regex to smartly find the ssrc.\n                const ssrc = lines[i].split('a=ssrc:')[1].split(' ')[0];\n\n                if (!data.get(ssrc)) {\n                    data.set(ssrc, []);\n                }\n\n                data.get(ssrc).push(lines[i]);\n            }\n        }\n\n        return data;\n    },\n\n    /**\n     * Parses the 'a=ssrc-group' line.\n     *\n     * @param {string} line - The media line to parse.\n     * @returns {ISsrcGroup}\n     */\n    parseSSRCGroupLine(line: string): ISsrcGroup {\n        const parts = line.substr(13).split(' ');\n\n        return {\n            semantics: parts.shift(),\n            ssrcs: parts\n        };\n    },\n\n    /**\n     * Gets the source name out of the name attribute \"a=ssrc:254321 name:name1\".\n     *\n     * @param {string[]} ssrcLines\n     * @returns {Optional<string>}\n     */\n    parseSourceNameLine(ssrcLines: string[]): Optional<string> {\n        const sourceNameLine = ssrcLines.find(ssrcSdpLine => ssrcSdpLine.indexOf(' name:') > 0);\n\n        // Everything past the \"name:\" part\n        return sourceNameLine?.substring(sourceNameLine.indexOf(' name:') + 6);\n    },\n\n    /**\n     * Parse the \"videoType\" attribute encoded in a set of SSRC attributes (e.g.\n     * \"a=ssrc:1234 videoType:desktop\")\n     *\n     * @param {string[]} ssrcLines\n     * @returns {Optional<string>}\n     */\n    parseVideoTypeLine(ssrcLines: string[]): Optional<string> {\n        const s = ' videoType:';\n        const videoTypeLine = ssrcLines.find(ssrcSdpLine => ssrcSdpLine.indexOf(s) > 0);\n\n        return videoTypeLine?.substring(videoTypeLine.indexOf(s) + s.length);\n    },\n\n    /**\n     * Sets the given codecName as the preferred codec by moving it to the beginning\n     * of the payload types list (modifies the given mline in place). All instances\n     * of the codec are moved up.\n     * @param {MediaDescription} mLine the mline object from an sdp as parsed by transform.parse.\n     * @param {string} codecName the name of the preferred codec.\n     * @param {boolean} sortPayloadTypes whether the payloadtypes need to be sorted for a given codec.\n     */\n    preferCodec(mline: MediaDescription, codecName: string, sortPayloadTypes: boolean = false): void {\n        if (!mline || !codecName) {\n            return;\n        }\n\n        const matchingPayloadTypes = mline.rtp\n            .filter(rtp => rtp.codec && rtp.codec.toLowerCase() === codecName.toLowerCase())\n            .map(rtp => rtp.payload);\n\n        if (matchingPayloadTypes) {\n            if (sortPayloadTypes && codecName === CodecMimeType.H264) {\n                // Move all the H.264 codecs with packetization-mode=0 to top of the list.\n                const payloadsWithMode0 = matchingPayloadTypes.filter(payload => {\n                    const fmtp = mline.fmtp.find(item => item.payload === payload);\n\n                    if (fmtp) {\n                        return fmtp.config.includes('packetization-mode=0');\n                    }\n\n                    return false;\n                });\n\n                for (const pt of payloadsWithMode0.reverse()) {\n                    const idx = matchingPayloadTypes.findIndex(payloadType => payloadType === pt);\n\n                    if (idx >= 0) {\n                        matchingPayloadTypes.splice(idx, 1);\n                        matchingPayloadTypes.unshift(pt);\n                    }\n                }\n            }\n\n            // Call toString() on payloads to get around an issue within SDPTransform that sets\n            // payloads as a number, instead of a string, when there is only one payload.\n            const payloadTypes\n                = mline.payloads\n                .toString()\n                .split(' ')\n                .map(p => parseInt(p, 10));\n\n            for (const pt of matchingPayloadTypes.reverse()) {\n                const payloadIndex = payloadTypes.indexOf(pt);\n\n                payloadTypes.splice(payloadIndex, 1);\n                payloadTypes.unshift(pt);\n            }\n            mline.payloads = payloadTypes.join(' ');\n        } else {\n            logger.error(`No matching RTP payload type found for ${codecName}, failed to set preferred codecs`);\n        }\n    },\n\n    /**\n     * Strips the given codec from the given mline. All related RTX payload\n     * types are also stripped. If the resulting mline would have no codecs,\n     * it's disabled.\n     *\n     * @param {MediaDescription} mLine the mline object from an sdp as parsed by transform.parse.\n     * @param {string} codecName the name of the codec which will be stripped.\n     * @param {boolean} highProfile determines if only the high profile codec needs to be stripped from the sdp for a\n     * given codec type.\n     */\n    stripCodec(mLine: MediaDescription, codecName: string, highProfile: boolean = false): void {\n        if (!mLine || !codecName) {\n            return;\n        }\n\n        const highProfileCodecs = new Map();\n        let removePts = [];\n\n        for (const rtp of mLine.rtp) {\n            if (rtp.codec && rtp.codec.toLowerCase() === codecName.toLowerCase()) {\n                if (highProfile) {\n                    highProfileCodecs.set(rtp.payload, rtp.codec);\n                } else {\n                    removePts.push(rtp.payload);\n                }\n            }\n        }\n\n        if (highProfile) {\n            removePts = mLine.fmtp\n                .filter(item => {\n                    const codec = highProfileCodecs.get(item.payload);\n\n                    if (codec) {\n                        return codec.toLowerCase() === CodecMimeType.VP9\n                            ? !item.config.includes('profile-id=0')\n                            : !item.config.includes('profile-level-id=42');\n                    }\n\n                    return false;\n                })\n                .map(item => item.payload);\n        }\n\n        if (removePts.length > 0) {\n            // We also need to remove the payload types that are related to RTX\n            // for the codecs we want to disable.\n            const rtxApts = removePts.map(item => `apt=${item}`);\n            const rtxPts = mLine.fmtp.filter(\n                item => rtxApts.indexOf(item.config) !== -1);\n\n            removePts.push(...rtxPts.map(item => item.payload));\n\n            // Call toString() on payloads to get around an issue within\n            // SDPTransform that sets payloads as a number, instead of a string,\n            // when there is only one payload.\n            const allPts = mLine.payloads\n                .toString()\n                .split(' ')\n                .map(Number);\n            const keepPts = allPts.filter(pt => removePts.indexOf(pt) === -1);\n\n            if (keepPts.length === 0) {\n                // There are no other codecs, disable the stream.\n                mLine.port = 0;\n                mLine.direction = MediaDirection.INACTIVE;\n                mLine.payloads = '*';\n            } else {\n                mLine.payloads = keepPts.join(' ');\n            }\n\n            mLine.rtp = mLine.rtp.filter(\n                item => keepPts.indexOf(item.payload) !== -1);\n            mLine.fmtp = mLine.fmtp.filter(\n                item => keepPts.indexOf(item.payload) !== -1);\n            if (mLine.rtcpFb) {\n                mLine.rtcpFb = mLine.rtcpFb.filter(\n                    item => keepPts.indexOf(Number(item.payload)) !== -1);\n            }\n        }\n    }\n};\n\nexport default SDPUtil;\n","import { getLogger } from '@jitsi/logger';\n\nimport { MediaDirection } from '../../service/RTC/MediaDirection';\nimport { MediaType } from '../../service/RTC/MediaType';\nimport { SSRC_GROUP_SEMANTICS } from '../../service/RTC/StandardVideoQualitySettings';\n\nimport SDPUtil from './SDPUtil';\nimport { SdpTransformWrap, parseSecondarySSRC } from './SdpTransformUtil';\n\nconst logger = getLogger('sdp:RtxModifier');\n\n/**\n * Begin helper functions\n */\n/**\n * Updates or inserts the appropriate rtx information for primarySsrc with\n *  the given rtxSsrc.  If no rtx ssrc for primarySsrc currently exists, it will\n *  add the appropriate ssrc and ssrc group lines.  If primarySsrc already has\n *  an rtx ssrc, the appropriate ssrc and group lines will be updated\n * @param {MLineWrap} mLine\n * @param {object} primarySsrcInfo the info (ssrc, msid & cname) for the\n *  primary ssrc\n * @param {number} rtxSsrc the rtx ssrc to associate with the primary ssrc\n */\nfunction updateAssociatedRtxStream(mLine, primarySsrcInfo, rtxSsrc) {\n    const primarySsrc = primarySsrcInfo.id;\n    const primarySsrcMsid = primarySsrcInfo.msid;\n    const primarySsrcCname = primarySsrcInfo.cname;\n\n    const previousRtxSSRC = mLine.getRtxSSRC(primarySsrc);\n\n    if (previousRtxSSRC === rtxSsrc) {\n        return;\n    }\n    if (previousRtxSSRC) {\n        // Stream already had an rtx ssrc that is different than the one given,\n        //  remove all trace of the old one\n        mLine.removeSSRC(previousRtxSSRC);\n        mLine.removeGroupsWithSSRC(previousRtxSSRC);\n    }\n    mLine.addSSRCAttribute({\n        attribute: 'cname',\n        id: rtxSsrc,\n        value: primarySsrcCname\n    });\n    primarySsrcMsid && mLine.addSSRCAttribute({\n        attribute: 'msid',\n        id: rtxSsrc,\n        value: primarySsrcMsid\n    });\n    mLine.addSSRCGroup({\n        semantics: SSRC_GROUP_SEMANTICS.FID,\n        ssrcs: `${primarySsrc} ${rtxSsrc}`\n    });\n}\n\n/**\n * End helper functions\n */\n\n/**\n * Adds any missing RTX streams for video streams\n *  and makes sure that they remain consistent\n */\nexport default class RtxModifier {\n    /**\n     * Constructor\n     */\n    constructor() {\n        /**\n         * Map of video ssrc to corresponding RTX\n         *  ssrc\n         */\n        this.correspondingRtxSsrcs = new Map();\n    }\n\n    /**\n     * Clear the cached map of primary video ssrcs to\n     *  their corresponding rtx ssrcs so that they will\n     *  not be used for the next call to modifyRtxSsrcs\n     */\n    clearSsrcCache() {\n        this.correspondingRtxSsrcs.clear();\n    }\n\n    /**\n     * Explicitly set the primary video ssrc -> rtx ssrc\n     *  mapping to be used in modifyRtxSsrcs\n     * @param {Map} ssrcMapping a mapping of primary video\n     *  ssrcs to their corresponding rtx ssrcs\n     */\n    setSsrcCache(ssrcMapping) {\n        logger.debug('Setting ssrc cache to ', ssrcMapping);\n        this.correspondingRtxSsrcs = ssrcMapping;\n    }\n\n    /**\n     * Adds RTX ssrcs for any video ssrcs that don't already have them.  If the video ssrc has been seen before, and\n     * already had an RTX ssrc generated, the same RTX ssrc will be used again.\n     *\n     * @param {string} sdpStr sdp in raw string format\n     * @returns {string} The modified sdp in raw string format.\n     */\n    modifyRtxSsrcs(sdpStr) {\n        let modified = false;\n        const sdpTransformer = new SdpTransformWrap(sdpStr);\n        const videoMLines = sdpTransformer.selectMedia(MediaType.VIDEO);\n\n        if (!videoMLines?.length) {\n            logger.debug(`No 'video' media found in the sdp: ${sdpStr}`);\n\n            return sdpStr;\n        }\n\n        for (const videoMLine of videoMLines) {\n            if (this.modifyRtxSsrcs2(videoMLine)) {\n                modified = true;\n            }\n        }\n\n        return modified ? sdpTransformer.toRawSDP() : sdpStr;\n    }\n\n    /**\n     * Does the same thing as {@link modifyRtxSsrcs}, but takes the {@link MLineWrap} instance wrapping video media as\n     * an argument.\n     * @param {MLineWrap} videoMLine\n     * @return {boolean} <tt>true</tt> if the SDP wrapped by {@link SdpTransformWrap} has been modified or\n     * <tt>false</tt> otherwise.\n     */\n    modifyRtxSsrcs2(videoMLine) {\n        if (videoMLine.direction === MediaDirection.RECVONLY) {\n            return false;\n        }\n        if (videoMLine.getSSRCCount() < 1) {\n            return false;\n        }\n        const primaryVideoSsrcs = videoMLine.getPrimaryVideoSSRCs();\n\n        for (const ssrc of primaryVideoSsrcs) {\n            const msid = videoMLine.getSSRCAttrValue(ssrc, 'msid');\n            const cname = videoMLine.getSSRCAttrValue(ssrc, 'cname');\n            let correspondingRtxSsrc = this.correspondingRtxSsrcs.get(ssrc);\n\n            if (!correspondingRtxSsrc) {\n                // If there's one in the sdp already for it, we'll just set\n                //  that as the corresponding one\n                const previousAssociatedRtxStream = videoMLine.getRtxSSRC(ssrc);\n\n                if (previousAssociatedRtxStream) {\n                    correspondingRtxSsrc = previousAssociatedRtxStream;\n                } else {\n                    correspondingRtxSsrc = SDPUtil.generateSsrc();\n                }\n                this.correspondingRtxSsrcs.set(ssrc, correspondingRtxSsrc);\n            }\n            updateAssociatedRtxStream(\n                videoMLine,\n                {\n                    cname,\n                    id: ssrc,\n                    msid\n                },\n                correspondingRtxSsrc);\n        }\n\n        // FIXME we're not looking into much details whether the SDP has been\n        // modified or not once the precondition requirements are met.\n        return true;\n    }\n\n    /**\n     * Strip all rtx streams from the given sdp.\n     *\n     * @param {string} sdpStr sdp in raw string format\n     * @returns {string} sdp string with all rtx streams stripped\n     */\n    stripRtx(sdpStr) {\n        const sdpTransformer = new SdpTransformWrap(sdpStr);\n        const videoMLines = sdpTransformer.selectMedia(MediaType.VIDEO);\n\n        if (!videoMLines?.length) {\n            logger.debug(`No 'video' media found in the sdp: ${sdpStr}`);\n\n            return sdpStr;\n        }\n\n        for (const videoMLine of videoMLines) {\n            if (videoMLine.direction !== MediaDirection.RECVONLY\n                && videoMLine.getSSRCCount()\n                && videoMLine.containsAnySSRCGroups()) {\n                const fidGroups = videoMLine.findGroups(SSRC_GROUP_SEMANTICS.FID);\n\n                // Remove the fid groups from the mline\n                videoMLine.removeGroupsBySemantics(SSRC_GROUP_SEMANTICS.FID);\n\n                // Get the rtx ssrcs and remove them from the mline\n                for (const fidGroup of fidGroups) {\n                    const rtxSsrc = parseSecondarySSRC(fidGroup);\n\n                    videoMLine.removeSSRC(rtxSsrc);\n                }\n            }\n        }\n\n        return sdpTransformer.toRawSDP();\n    }\n}\n","\nexport enum XEP {\n\n    /**\n     * XEP-0338 - Signals the usage of bundled media, i.e., allows the use of a single set of ICE candidates for\n     * multiple media descriptions.\n     * https://xmpp.org/extensions/attic/xep-0338-1.0.0.html\n     */\n    BUNDLE_MEDIA = 'urn:xmpp:jingle:apps:grouping:0',\n\n    /**\n     * XEP-0320 - Signals the use of DTLS-SRTP in Jingle session.\n     * https://xmpp.org/extensions/xep-0320.html\n     */\n    DTLS_SRTP = 'urn:xmpp:jingle:apps:dtls:0',\n\n    /**\n     * XEP-0176 - Signaling ICE-UDP transport method.\n     * https://xmpp.org/extensions/xep-0176.html\n     */\n    ICE_UDP_TRANSPORT = 'urn:xmpp:jingle:transports:ice-udp:1',\n\n    /**\n     * XEP-0166 - Jingle.\n     * https://xmpp.org/extensions/xep-0166.html\n     */\n    JINGLE = 'urn:xmpp:jingle:1',\n\n    /**\n     * XEP-0327 - Rayo for allowing third-party control over media sessions.\n     */\n    RAYO = 'urn:xmpp:rayo:client:1',\n\n    /**\n     * XEP-0167 - Signals support for RTP audio.\n     * https://xmpp.org/extensions/xep-0167.html#support\n     */\n    RTP_AUDIO = 'urn:xmpp:jingle:apps:rtp:audio',\n\n    /**\n     * XEP-0293 - Signals the use of RTP Feedback Negotiation.\n     * https://xmpp.org/extensions/xep-0293.html\n     */\n    RTP_FEEDBACK = 'urn:xmpp:jingle:apps:rtp:rtcp-fb:0',\n\n    /**\n     * XEP-0294 - Signals the use of RTP Header Extensions.\n     * https://xmpp.org/extensions/xep-0294.html\n     */\n    RTP_HEADER_EXTENSIONS = 'urn:xmpp:jingle:apps:rtp:rtp-hdrext:0',\n\n    /**\n     * XEP-0167 - Signals parameters necessary for media sessions using RTP.\n     * https://xmpp.org/extensions/xep-0167.html\n     */\n    RTP_MEDIA = 'urn:xmpp:jingle:apps:rtp:1',\n\n    /**\n     * XEP-0167 - Signals support for RTP video.\n     * https://xmpp.org/extensions/xep-0167.html#support\n     */\n    RTP_VIDEO = 'urn:xmpp:jingle:apps:rtp:video',\n\n    /**\n     * XEP-0343 - Signaling WebRTC datachannels (bridge channel) in Jingle that uses DTLS/SCTP on top of ICE.\n     * https://xmpp.org/extensions/xep-0343.html\n     */\n    SCTP_DATA_CHANNEL = 'urn:xmpp:jingle:transports:dtls-sctp:1',\n\n    /**\n     * XEP-0339 - Signals Source-Specific Media Attributes in Jingle.\n     * https://xmpp.org/extensions/xep-0339.html\n     */\n    SOURCE_ATTRIBUTES = 'urn:xmpp:jingle:apps:rtp:ssma:0'\n}\n","import { getLogger } from '@jitsi/logger';\n\nconst logger = getLogger('util:XMLUtils');\n\n/**\n * Parses an XML string into a Document.\n * @param xmlString - The XML string to parse.\n * @returns Parsed XML Document or null if parsing fails.\n */\nexport function parseXML(xmlString: string): Nullable<Document> {\n    if (!xmlString || typeof xmlString !== 'string') {\n        return null;\n    }\n\n    const parser = new DOMParser();\n    const doc = parser.parseFromString(xmlString, 'text/xml');\n\n    // Check for parser errors.\n    const parserError = findFirst(doc, 'parsererror');\n\n    if (parserError) {\n        logger.error('XML parsing error:', parserError.textContent || '');\n        // Return the document anyway for compatibility\n        // jQuery also returns a document with parser errors\n    }\n\n    return doc;\n}\n\n/**\n * Finds all elements matching the CSS selector within the given element.\n * @param element - The element or document to search within.\n * @param selector - CSS selector string.\n * @returns Array of matching elements.\n */\nexport function findAll(element: Element | Document, selector: string): Element[] {\n    if (!element) {\n        return [];\n    }\n\n    try {\n        return Array.from(element.querySelectorAll(selector));\n    } catch (error) {\n        logger.error('findAll error:', selector, error);\n\n        return [];\n    }\n}\n\n/**\n * Gets the value of an attribute from an element.\n * @param element - The element to get the attribute from.\n * @param name - The attribute name.\n * @returns The attribute value or null if not found.\n */\nexport function getAttribute(element: Element | null, name: string): string | null {\n    if (!element || !name) {\n        return null;\n    }\n\n    return element.getAttribute(name);\n}\n\n/**\n * Sets an attribute on an element.\n * @param element - The element to set the attribute on.\n * @param name - The attribute name.\n * @param value - The attribute value.\n */\nexport function setAttribute(element: Element | null, name: string, value: string): void {\n    if (!element || !name) {\n        return;\n    }\n\n    element.setAttribute(name, value);\n}\n\n/**\n * Gets the text content of an element.\n * @param element - The element to get text from.\n * @returns The text content or empty string if element is null.\n */\nexport function getText(element: Element | null): string {\n    if (!element) {\n        return '';\n    }\n\n    return element.textContent || '';\n}\n\n/**\n * Sets the text content of an element.\n * @param element - The element to set text on.\n * @param text - The text content to set.\n */\nexport function setText(element: Element | null, text: string): void {\n    if (!element) {\n        return;\n    }\n\n    element.textContent = text;\n}\n\n/**\n * Gets the child elements of an element (excluding text nodes).\n * @param element - The parent element.\n * @returns Array of child elements.\n */\nexport function getChildren(element: Element): Element[] {\n    if (!element) {\n        return [];\n    }\n\n    return Array.from(element.children);\n}\n\n/**\n * Checks if any elements match the selector within the given element.\n * @param element - The element or document to search within.\n * @param selector - CSS selector string.\n * @returns True if at least one element matches the selector.\n */\nexport function exists(element: Element | Document, selector: string): boolean {\n    if (!element) {\n        return false;\n    }\n\n    try {\n        return element.querySelector(selector) !== null;\n    } catch (error) {\n        logger.error('exists error:', selector, error);\n\n        return false;\n    }\n}\n\n/**\n * Gets the first element matching the selector, or null if none found.\n * This is a convenience function equivalent to findAll(...)[0] || null.\n * @param element - The element or document to search within.\n * @param selector - CSS selector string.\n * @returns The first matching element or null.\n */\nexport function findFirst(element: Element | Document, selector: string): Element | null {\n    if (!element) {\n        return null;\n    }\n\n    try {\n        return element.querySelector(selector);\n    } catch (error) {\n        logger.error('findFirst error:', selector, error);\n\n        return null;\n    }\n}\n","\nimport { cloneDeep } from 'lodash-es';\nimport transform from 'sdp-transform';\nimport { Strophe } from 'strophe.js';\n\nimport { MediaDirection } from '../../service/RTC/MediaDirection';\nimport { MediaType } from '../../service/RTC/MediaType';\nimport { SourceName } from '../../service/RTC/SignalingLayer';\nimport { SSRC_GROUP_SEMANTICS } from '../../service/RTC/StandardVideoQualitySettings';\nimport { XEP } from '../../service/xmpp/XMPPExtensioProtocols';\nimport { ITPCSourceInfo } from '../RTC/TraceablePeerConnection';\nimport browser from '../browser';\nimport { exists, findAll, findFirst, getAttribute, getText } from '../util/XMLUtils';\n\nimport SDPUtil from './SDPUtil';\nimport { IMediaInfo } from './constants';\n\n\n/**\n * A class that translates the Jingle messages received from the signaling server into SDP format that the\n * browser understands and vice versa. This is needed for media session establishment and for signaling local and\n * remote sources across peers.\n */\nexport default class SDP {\n    public raw: string;\n    public session: string;\n    public media: string[];\n    public isP2P: boolean;\n    public failICE: boolean;\n    public removeTcpCandidates: boolean;\n    public removeUdpCandidates: boolean;\n    public initialLastN?: number;\n\n    /**\n     * Constructor.\n     *\n     * @param {string} sdp - The SDP generated by the browser when SDP->Jingle conversion is needed, an empty string\n     * when Jingle->SDP conversion is needed.\n     * @param {boolean} isP2P - Whether this SDP belongs to a p2p peerconnection.\n     */\n    constructor(sdp: string, isP2P: boolean = false) {\n        this._updateSessionAndMediaSections(sdp);\n        this.isP2P = isP2P;\n        this.raw = this.session + this.media.join('');\n\n        // This flag will make {@link transportToJingle} and {@link jingle2media} replace ICE candidates IPs with\n        // invalid value of '1.1.1.1' which will cause ICE failure. The flag is used in the automated testing.\n        this.failICE = false;\n\n        // Whether or not to remove TCP ice candidates when translating from/to jingle.\n        this.removeTcpCandidates = false;\n\n        // Whether or not to remove UDP ice candidates when translating from/to jingle.\n        this.removeUdpCandidates = false;\n    }\n\n    /**\n     * Adjusts the msid semantic for a remote source based on the media type and the index of the m-line.\n     * This is needed for browsers that need both the streamId and trackId to be reported in the msid attribute.\n     *\n     * @param {String} msid - The msid attribute value.\n     * @param {MediaType} mediaType - The media type.\n     * @param {Number|String} idx - The index of the m-line in the SDP.\n     * @returns {String} - The adjusted msid semantic.\n     */\n    private _adjustMsidSemantic(msid: string, mediaType: MediaType, idx: number | string): string {\n        if (mediaType === MediaType.AUDIO || !browser.isChromiumBased() || browser.isEngineVersionGreaterThan(116)) {\n            return msid;\n        }\n\n        const msidParts = msid.split(' ');\n\n        if (msidParts.length === 2) {\n            return msid;\n        }\n\n        return `${msid} ${msid}-${idx}`;\n    }\n\n    /**\n     * Updates the media and session sections of the SDP based on the raw SDP string.\n     *\n     * @param {string} sdp - The SDP generated by the browser.\n     * @returns {void}\n     * @private\n     */\n    private _updateSessionAndMediaSections(sdp?: string): void {\n        const media = typeof sdp === 'string' ? sdp.split('\\r\\nm=') : this.raw.split('\\r\\nm=');\n\n        for (let i = 1, length = media.length; i < length; i++) {\n            let mediaI = `m=${media[i]}`;\n\n            if (i !== length - 1) {\n                mediaI += '\\r\\n';\n            }\n            media[i] = mediaI;\n        }\n        this.session = `${media.shift()}\\r\\n`;\n        this.media = media;\n    }\n\n    /**\n     * Adds or removes the sources from the SDP.\n     *\n     * @param {Map<SourceName, ITPCSourceInfo>} sourceMap - The map of the sources that are being added/removed.\n     * @param {boolean} isAdd - Whether the sources are being added or removed.\n     * @returns {Array<number>} - The indices of the new m-lines that were added/modifed in the SDP.\n     */\n    public updateRemoteSources(sourceMap: Map<SourceName, ITPCSourceInfo>, isAdd: boolean = true): number[] {\n        const updatedMidIndices = [];\n\n        for (const source of sourceMap.values()) {\n            const { mediaType, msid, ssrcList, groups } = source;\n            let idx;\n\n            if (isAdd) {\n                // For P2P, check if there is an m-line with the matching mediaType that doesn't have any ssrc lines.\n                // Update the existing m-line if it exists, otherwise create a new m-line and add the sources.\n                idx = this.media.findIndex(mLine => mLine.includes(`m=${mediaType}`) && !mLine.includes('a=ssrc'));\n                if (!this.isP2P || idx === -1) {\n                    this.addMlineForNewSource(mediaType, true);\n                    idx = this.media.length - 1;\n                }\n            } else {\n                idx = this.media.findIndex(mLine => mLine.includes(`a=ssrc:${ssrcList[0]}`));\n\n                if (idx === -1) {\n                    continue; // eslint-disable-line no-continue\n                }\n            }\n\n            updatedMidIndices.push(idx);\n\n            if (isAdd) {\n                const updatedMsid = this._adjustMsidSemantic(msid, mediaType, idx);\n\n                ssrcList.forEach(ssrc => {\n                    this.media[idx] += `a=ssrc:${ssrc} msid:${updatedMsid}\\r\\n`;\n                });\n                groups?.forEach(group => {\n                    this.media[idx] += `a=ssrc-group:${group.semantics} ${group.ssrcs.join(' ')}\\r\\n`;\n                });\n            } else {\n                ssrcList.forEach(ssrc => {\n                    this.media[idx] = this.media[idx].replace(new RegExp(`a=ssrc:${ssrc}.*\\r\\n`, 'g'), '');\n                });\n                groups?.forEach(group => {\n                    this.media[idx] = this.media[idx]\n                        .replace(new RegExp(`a=ssrc-group:${group.semantics}.*\\r\\n`, 'g'), '');\n                });\n\n                if (!this.isP2P) {\n                    // Reject the m-line so that the browser removes the associated transceiver from the list of\n                    // available transceivers. This will prevent the client from trying to re-use these inactive\n                    // transceivers when additional video sources are added to the peerconnection.\n                    const { media, port } = SDPUtil.parseMLine(this.media[idx].split('\\r\\n')[0]);\n\n                    this.media[idx] = this.media[idx]\n                        .replace(`a=${MediaDirection.SENDONLY}`, `a=${MediaDirection.INACTIVE}`);\n                    this.media[idx] = this.media[idx].replace(`m=${media} ${port}`, `m=${media} 0`);\n                }\n            }\n            this.raw = this.session + this.media.join('');\n        }\n\n        return updatedMidIndices;\n    }\n\n    /**\n     * Adds a new m-line to the description so that a new local or remote source can be added to the conference.\n     *\n     * @param {MediaType} mediaType media type of the new source that is being added.\n     * @param {boolean} isRemote - Whether this is for a remote source.\n     * @returns {void}\n     */\n    public addMlineForNewSource(mediaType: MediaType, isRemote: boolean = false): void {\n        const mid = this.media.length;\n        const sdp = transform.parse(this.raw);\n        const mline = cloneDeep(sdp.media.find(m => m.type === mediaType));\n\n        // Edit media direction, mid and remove the existing ssrc lines in the m-line.\n        mline.mid = mid.toString();\n        mline.direction = isRemote ? MediaDirection.SENDONLY : MediaDirection.RECVONLY;\n        mline.msid = undefined;\n        mline.ssrcs = undefined;\n        mline.ssrcGroups = undefined;\n\n        sdp.media = [ ...sdp.media, mline ];\n\n        // We regenerate the BUNDLE group (since we added a new m-line).\n        sdp.groups.forEach(group => {\n            if (group.type === 'BUNDLE') {\n                group.mids = [ ...group.mids.split(' '), mid ].join(' ');\n            }\n        });\n\n        this.raw = transform.write(sdp);\n        this._updateSessionAndMediaSections();\n    }\n\n    /**\n     * Converts the Jingle message element to SDP.\n     *\n     * @param {*} jingle - The Jingle message element.\n     * @returns {void}\n     */\n    public fromJingle(jingle: any): void {\n        const sessionId = Date.now();\n\n        // Use a unique session id for every TPC.\n        this.raw = 'v=0\\r\\n'\n            + `o=- ${sessionId} 2 IN IP4 0.0.0.0\\r\\n`\n            + 's=-\\r\\n'\n            + 't=0 0\\r\\n';\n\n        // Use *|xmlns to match xmlns attributes across any namespace (CSS Selectors Level 3)\n        const groups = findAll(jingle, `:scope>group[*|xmlns='${XEP.BUNDLE_MEDIA}']`);\n\n        if (this.isP2P && groups.length) {\n            groups.forEach(group => {\n                const contents = findAll(group, ':scope>content')?.map(content => content.getAttribute('name'));\n\n                if (contents?.length > 0) {\n                    this.raw\n                        += `a=group:${\n                            group.getAttribute('semantics')\n                                || group.getAttribute('type')} ${\n                            contents.join(' ')}\\r\\n`;\n                }\n            });\n        }\n\n        this.session = this.raw;\n\n        findAll(jingle, ':scope>content').forEach(content => {\n            const m = this.jingle2media(content);\n\n            this.media.push(m);\n        });\n\n        this.raw = this.session + this.media.join('');\n\n        if (this.isP2P) {\n            return;\n        }\n\n        // For offers from Jicofo, a new m-line needs to be created for each new remote source that is added to the\n        // conference.\n        const newSession = transform.parse(this.raw);\n        const newMedia = [];\n\n        newSession.media.forEach(mLine => {\n            const type = mLine.type;\n\n            if (type === MediaType.APPLICATION) {\n                const newMline = cloneDeep(mLine);\n\n                newMline.mid = newMedia.length.toString();\n                newMedia.push(newMline);\n\n                return;\n            }\n\n            if (!mLine.ssrcs?.length) {\n                const newMline = cloneDeep(mLine);\n\n                newMline.mid = newMedia.length.toString();\n                newMedia.push(newMline);\n\n                return;\n            }\n\n            mLine.ssrcs.forEach((ssrc, idx) => {\n                // Do nothing if the m-line with the given SSRC already exists.\n                if (newMedia.some(mline => mline.ssrcs?.some(source => source.id === ssrc.id))) {\n                    return;\n                }\n                const newMline = cloneDeep(mLine);\n\n                newMline.ssrcs = [];\n                newMline.ssrcGroups = [];\n                newMline.mid = newMedia.length.toString();\n                (newMline as any).bundleOnly = undefined;\n                newMline.direction = idx ? 'sendonly' : 'sendrecv';\n\n                // Add the sources and the related FID source group to the new m-line.\n                const ssrcId = ssrc.id.toString();\n                const group = mLine.ssrcGroups?.find(g => g.ssrcs.includes(ssrcId));\n\n                if (group) {\n                    if (ssrc.attribute === 'msid') {\n                        ssrc.value = this._adjustMsidSemantic(ssrc.value, type as MediaType, parseInt(newMline.mid, 10));\n                    }\n                    newMline.ssrcs.push(ssrc);\n                    const otherSsrc = group.ssrcs.split(' ').find(s => s !== ssrcId);\n\n                    if (otherSsrc) {\n                        const otherSource = mLine.ssrcs.find(source => source.id.toString() === otherSsrc);\n\n                        if (otherSource.attribute === 'msid') {\n                            otherSource.value = this._adjustMsidSemantic(otherSource.value, type as MediaType, parseInt(newMline.mid, 10));\n                        }\n                        newMline.ssrcs.push(otherSource);\n                    }\n                    newMline.ssrcGroups.push(group);\n                } else {\n                    newMline.ssrcs.push(ssrc);\n                }\n                newMedia.push(newMline);\n            });\n        });\n\n        newSession.media = newMedia;\n        const mids = [];\n\n        newMedia.forEach(mLine => {\n            mids.push(mLine.mid);\n        });\n\n        if (groups.length) {\n            // We regenerate the BUNDLE group (since we regenerated the mids)\n            newSession.groups = [ {\n                mids: mids.join(' '),\n                type: 'BUNDLE'\n            } ];\n        }\n\n        // msid semantic\n        newSession.msidSemantic = {\n            semantic: 'WMS',\n            token: '*'\n        };\n\n        // Increment the session version every time.\n        newSession.origin.sessionVersion++;\n\n        this.raw = transform.write(newSession);\n        this._updateSessionAndMediaSections();\n    }\n\n    /**\n     * Returns an SSRC Map by extracting SSRCs and SSRC groups from all the m-lines in the SDP.\n     *\n     * @returns {Map<number, IMediaInfo>}\n     */\n    public getMediaSsrcMap(): Map<number, IMediaInfo> {\n        const sourceInfo = new Map();\n\n        this.media.forEach((mediaItem, mediaindex) => {\n            const midLine = SDPUtil.findLine(mediaItem, 'a=mid:');\n            const mid = typeof midLine === 'string' ? SDPUtil.parseMID(midLine) : '';\n            const mline = SDPUtil.parseMLine(mediaItem.split('\\r\\n')[0]);\n            const isRecvOnly = SDPUtil.findLine(mediaItem, `a=${MediaDirection.RECVONLY}`);\n\n            // Do not process recvonly m-lines. Firefox generates recvonly SSRCs for all remote sources.\n            if (isRecvOnly && browser.isFirefox()) {\n                return;\n            }\n\n            const media = {\n                mediaType: mline.media,\n                mediaindex,\n                mid,\n                ssrcGroups: [],\n                ssrcs: {}\n            };\n\n            SDPUtil.findLines(mediaItem, 'a=ssrc:').forEach((line: string) => {\n                const linessrc = line.substring(7).split(' ')[0];\n\n                // Allocate new ChannelSsrc.\n                if (!media.ssrcs[linessrc]) {\n                    media.ssrcs[linessrc] = {\n                        lines: [],\n                        ssrc: linessrc\n                    };\n                }\n                media.ssrcs[linessrc].lines.push(line);\n            });\n\n            SDPUtil.findLines(mediaItem, 'a=ssrc-group:').forEach((line: string) => {\n                const idx = line.indexOf(' ');\n                const semantics = line.substr(0, idx).substr(13);\n                const ssrcs = line.substr(14 + semantics.length).split(' ');\n\n                if (ssrcs.length) {\n                    media.ssrcGroups.push({\n                        semantics,\n                        ssrcs\n                    });\n                }\n            });\n\n            sourceInfo.set(mediaindex, media);\n        });\n\n        return sourceInfo;\n    }\n\n    /**\n     * Converts the content section from Jingle to a media section that can be appended to the SDP.\n     *\n     * @param {Element} content - The content section from the Jingle message element.\n     * @returns {string} - The constructed media sections.\n     */\n    public jingle2media(content: Element): string {\n        const desc = findFirst(content, ':scope>description');\n\n        // Use *|xmlns to match xmlns attributes across any namespace (CSS Selectors Level 3)\n        const transport = findFirst(content, `:scope>transport[*|xmlns='${XEP.ICE_UDP_TRANSPORT}']`);\n        let sdp = '';\n\n        // Use *|xmlns to match xmlns attributes across any namespace (CSS Selectors Level 3)\n        const sctp = findFirst(transport, `:scope>sctpmap[*|xmlns='${XEP.SCTP_DATA_CHANNEL}']`);\n        const media: any = { media: getAttribute(desc, 'media') };\n        const mid = getAttribute(content, 'name');\n\n        media.port = '9';\n        if (getAttribute(content, 'senders') === 'rejected') {\n            media.port = '0';\n        }\n\n        // Use *|xmlns to match xmlns attributes across any namespace (CSS Selectors Level 3)\n        if (exists(transport, `:scope>fingerprint[*|xmlns='${XEP.DTLS_SRTP}']`)) {\n            media.proto = sctp ? 'UDP/DTLS/SCTP' : 'UDP/TLS/RTP/SAVPF';\n        } else {\n            media.proto = 'UDP/TLS/RTP/SAVPF';\n        }\n        if (sctp) {\n            sdp += `m=application ${media.port} UDP/DTLS/SCTP webrtc-datachannel\\r\\n`;\n            sdp += `a=sctp-port:${getAttribute(sctp, 'number')}\\r\\n`;\n            sdp += 'a=max-message-size:262144\\r\\n';\n        } else {\n            media.fmt = findAll(desc, ':scope>payload-type').map(payloadType => getAttribute(payloadType, 'id'));\n            sdp += `${SDPUtil.buildMLine(media)}\\r\\n`;\n        }\n\n        sdp += 'c=IN IP4 0.0.0.0\\r\\n';\n        if (!sctp) {\n            sdp += 'a=rtcp:1 IN IP4 0.0.0.0\\r\\n';\n        }\n\n        if (transport) {\n            const ufrag = getAttribute(transport, 'ufrag');\n            const pwd = getAttribute(transport, 'pwd');\n\n            if (ufrag) {\n                sdp += `${SDPUtil.buildICEUfrag(ufrag)}\\r\\n`;\n            }\n            if (pwd) {\n                sdp += `${SDPUtil.buildICEPwd(pwd)}\\r\\n`;\n            }\n\n            // Use *|xmlns to match xmlns attributes across any namespace (CSS Selectors Level 3)\n            findAll(transport, `:scope>fingerprint[*|xmlns='${XEP.DTLS_SRTP}']`).forEach(fingerprint => {\n                sdp += `a=fingerprint:${getAttribute(fingerprint, 'hash')} ${getText(fingerprint)}\\r\\n`;\n\n                const setup = getAttribute(fingerprint, 'setup');\n\n                if (setup) {\n                    sdp += `a=setup:${setup}\\r\\n`;\n                }\n            });\n        }\n\n        if (transport) {\n            findAll(transport, ':scope>candidate').forEach(candidate => {\n                let protocol = getAttribute(candidate, 'protocol');\n\n                protocol = typeof protocol === 'string' ? protocol.toLowerCase() : '';\n\n                if ((this.removeTcpCandidates && (protocol === 'tcp' || protocol === 'ssltcp'))\n                    || (this.removeUdpCandidates && protocol === 'udp')) {\n                    return;\n                } else if (this.failICE) {\n                    candidate.setAttribute('ip', '1.1.1.1');\n                }\n\n                sdp += SDPUtil.candidateFromJingle(candidate);\n            });\n        }\n\n        switch (getAttribute(content, 'senders')) {\n        case 'initiator':\n            sdp += `a=${MediaDirection.SENDONLY}\\r\\n`;\n            break;\n        case 'responder':\n            sdp += `a=${MediaDirection.RECVONLY}\\r\\n`;\n            break;\n        case 'none':\n            sdp += `a=${MediaDirection.INACTIVE}\\r\\n`;\n            break;\n        case 'both':\n            sdp += `a=${MediaDirection.SENDRECV}\\r\\n`;\n            break;\n        }\n        sdp += `a=mid:${mid}\\r\\n`;\n\n        // <description><rtcp-mux/></description>\n        // see http://code.google.com/p/libjingle/issues/detail?id=309 -- no spec though\n        // and http://mail.jabber.org/pipermail/jingle/2011-December/001761.html\n        if (exists(desc, ':scope>rtcp-mux')) {\n            sdp += 'a=rtcp-mux\\r\\n';\n        }\n\n        if (desc) {\n            findAll(desc, ':scope>payload-type').forEach(payloadType => {\n                sdp += `${SDPUtil.buildRTPMap(payloadType)}\\r\\n`;\n                const parameters = findAll(payloadType, ':scope>parameter');\n\n                if (parameters.length) {\n                    sdp += `a=fmtp:${getAttribute(payloadType, 'id')} `;\n                    sdp += parameters\n                        .map(parameter => {\n                            const name = getAttribute(parameter, 'name');\n\n                            return (name ? `${name}=` : '') + getAttribute(parameter, 'value');\n                        })\n                        .join(';');\n                    sdp += '\\r\\n';\n                }\n\n                sdp += this.rtcpFbFromJingle(payloadType, getAttribute(payloadType, 'id'));\n            });\n\n            sdp += this.rtcpFbFromJingle(desc, '*');\n\n            // Use *|xmlns to match xmlns attributes across any namespace (CSS Selectors Level 3)\n            findAll(desc, `:scope>rtp-hdrext[*|xmlns='${XEP.RTP_HEADER_EXTENSIONS}']`).forEach(hdrExt => {\n                sdp += `a=extmap:${getAttribute(hdrExt, 'id')} ${getAttribute(hdrExt, 'uri')}\\r\\n`;\n            });\n\n            // Use *|xmlns to match xmlns attributes across any namespace (CSS Selectors Level 3)\n            if (exists(desc, `:scope>extmap-allow-mixed[*|xmlns='${XEP.RTP_HEADER_EXTENSIONS}']`)) {\n                sdp += 'a=extmap-allow-mixed\\r\\n';\n            }\n        }\n\n        if (desc) {\n\n            // Use *|xmlns to match xmlns attributes across any namespace (CSS Selectors Level 3)\n            findAll(desc, `:scope>ssrc-group[*|xmlns='${XEP.SOURCE_ATTRIBUTES}']`).forEach(ssrcGroup => {\n                const semantics = getAttribute(ssrcGroup, 'semantics');\n                const children = Array.from(ssrcGroup.children || []);\n                const ssrcs = children.filter(child => child.localName === 'source')\n                    .map(source => getAttribute(source, 'ssrc'));\n\n                if (ssrcs.length) {\n                    sdp += `a=ssrc-group:${semantics} ${ssrcs.join(' ')}\\r\\n`;\n                }\n            });\n        }\n\n        let userSources = '';\n        let nonUserSources = '';\n\n        if (desc) {\n            // Use *|xmlns to match xmlns attributes across any namespace (CSS Selectors Level 3)\n            findAll(desc, `:scope>source[*|xmlns='${XEP.SOURCE_ATTRIBUTES}']`).forEach(source => {\n                const ssrc = getAttribute(source, 'ssrc');\n                let isUserSource = true;\n                let sourceStr = '';\n\n                findAll(source, ':scope>parameter')\n                    .forEach(parameter => {\n                        const name = getAttribute(parameter, 'name');\n                        let value = getAttribute(parameter, 'value');\n\n                        value = SDPUtil.filterSpecialChars(value);\n                        sourceStr += `a=ssrc:${ssrc} ${name}`;\n\n                        if (name === 'msid') {\n                            value = this._adjustMsidSemantic(value, media.media, mid);\n                        }\n                        if (value?.length) {\n                            sourceStr += `:${value}`;\n                        }\n\n                        sourceStr += '\\r\\n';\n\n                        if (value?.includes('mixedmslabel')) {\n                            isUserSource = false;\n                        }\n                    });\n\n                if (isUserSource) {\n                    userSources += sourceStr;\n                } else {\n                    nonUserSources += sourceStr;\n                }\n            });\n        }\n\n        // Append sources in the correct order, the mixedmslable m-line which has the JVB's SSRC for RTCP termination\n        // is expected to be in the first m-line.\n        sdp += nonUserSources + userSources;\n\n        return sdp;\n    }\n\n    /**\n     * Coverts the RTCP attributes for the session from XMPP format to SDP.\n     * https://xmpp.org/extensions/xep-0293.html\n     *\n     * @param {*} elem - Jingle message element.\n     * @param {*} payloadtype - Payload type for the codec.\n     * @returns {string}\n     */\n    public rtcpFbFromJingle(elem: any, payloadtype: any): string {\n        let sdp = '';\n\n        // Use *|xmlns to match xmlns attributes across any namespace (CSS Selectors Level 3)\n        const feedbackElementTrrInt = findFirst(elem, `:scope>rtcp-fb-trr-int[*|xmlns='${XEP.RTP_FEEDBACK}']`);\n\n        if (feedbackElementTrrInt) {\n            sdp += 'a=rtcp-fb:* trr-int ';\n            sdp += getAttribute(feedbackElementTrrInt, 'value') || '0';\n            sdp += '\\r\\n';\n        }\n\n        // Use *|xmlns to match xmlns attributes across any namespace (CSS Selectors Level 3)\n        const feedbackElements = findAll(elem, `:scope>rtcp-fb[*|xmlns='${XEP.RTP_FEEDBACK}']`);\n\n        feedbackElements.forEach(fb => {\n            sdp += `a=rtcp-fb:${payloadtype} ${fb.getAttribute('type')}`;\n            if (fb.hasAttribute('subtype')) {\n                sdp += ` ${fb.getAttribute('subtype')}`;\n            }\n            sdp += '\\r\\n';\n        });\n\n        return sdp;\n    }\n\n    /**\n     * Converts the RTCP attributes for the session from SDP to XMPP format.\n     * https://xmpp.org/extensions/xep-0293.html\n     *\n     * @param {number} mediaIndex - The index of the media section in the SDP.\n     * @param {*} elem - The Jingle message element.\n     * @param {string} payloadtype - payload type for the codec.\n     */\n    public rtcpFbToJingle(mediaIndex: number, elem: any, payloadtype: string): void {\n        const lines = SDPUtil.findLines(this.media[mediaIndex], `a=rtcp-fb:${payloadtype}`);\n\n        lines.forEach((line: string) => {\n            const feedback = SDPUtil.parseRTCPFB(line);\n\n            if (feedback.type === 'trr-int') {\n                elem.c('rtcp-fb-trr-int', {\n                    value: feedback.params[0],\n                    xmlns: XEP.RTP_FEEDBACK\n                });\n                elem.up();\n            } else {\n                elem.c('rtcp-fb', {\n                    type: feedback.type,\n                    xmlns: XEP.RTP_FEEDBACK\n                });\n                if (feedback.params.length > 0) {\n                    elem.attrs({ 'subtype': feedback.params[0] });\n                }\n                elem.up();\n            }\n        });\n    }\n\n    /**\n     * Converts the current SDP to a Jingle message that can be sent over the wire to a signaling server.\n     *\n     * @param {*} elem - The Jingle message element.\n     * @param {*} thecreator - Sender role, whether it is an 'initiator' or 'responder'.\n     * @returns - The updated Jingle message element.\n     */\n    public toJingle(elem: any, thecreator: any): any {\n        SDPUtil.findLines(this.session, 'a=group:').forEach((line: string) => {\n            const parts = line.split(' ');\n            const semantics = parts.shift().substr(8);\n\n            elem.c('group', {\n                semantics,\n                xmlns: XEP.BUNDLE_MEDIA\n            });\n\n            // Bundle all the media types. Jicofo expects the 'application' media type to be signaled as 'data'.\n            let mediaTypes = [ MediaType.AUDIO, MediaType.VIDEO, 'data' ];\n\n            // For p2p connection, 'mid' will be used in the bundle group.\n            if (this.isP2P) {\n                mediaTypes = this.media.map(mediaItem => {\n                    const midLine = SDPUtil.findLine(mediaItem, 'a=mid:');\n\n                    return typeof midLine === 'string' ? SDPUtil.parseMID(midLine) : '';\n                });\n            }\n            mediaTypes.forEach(type => elem.c('content', { name: type }).up());\n            elem.up();\n        });\n\n        this.media.forEach((mediaItem, i) => {\n            const mline = SDPUtil.parseMLine(mediaItem.split('\\r\\n')[0]);\n            const mediaType = mline.media === MediaType.APPLICATION ? 'data' : mline.media;\n\n            let ssrc: string | false = false;\n            const assrcline = SDPUtil.findLine(mediaItem, 'a=ssrc:', '');\n            const isRecvOnly = SDPUtil.findLine(mediaItem, `a=${MediaDirection.RECVONLY}`, '');\n\n            if (assrcline && typeof assrcline === 'string') {\n                ssrc = assrcline.substring(7).split(' ')[0];\n            }\n\n            const contents = findAll(elem.tree(), `content[name='${mediaType}']`);\n\n            // Append source groups from the new m-lines to the existing media description. The SDP will have multiple\n            // m-lines for audio and video including the recv-only ones for remote sources but there needs to be only\n            // one media description for a given media type that should include all the sources, i.e., both the camera\n            // and screenshare sources should be added to the 'video' description.\n            for (const content of contents) {\n                if (!content.hasAttribute('creator')) {\n                    // eslint-disable-next-line no-continue\n                    continue;\n                }\n\n                if (ssrc && !(isRecvOnly && browser.isFirefox())) {\n                    const description = findFirst(content, 'description');\n                    const ssrcMap = SDPUtil.parseSSRC(mediaItem);\n\n                    for (const [ availableSsrc, ssrcParameters ] of ssrcMap) {\n                        const sourceName = SDPUtil.parseSourceNameLine(ssrcParameters);\n                        const videoType = SDPUtil.parseVideoTypeLine(ssrcParameters);\n                        const source = Strophe.xmlElement('source', {\n                            name: sourceName,\n                            ssrc: availableSsrc,\n                            videoType,\n                            xmlns: XEP.SOURCE_ATTRIBUTES\n                        });\n\n                        const msid = SDPUtil.parseMSIDAttribute(ssrcParameters);\n\n                        if (msid) {\n                            const param = Strophe.xmlElement('parameter', {\n                                name: 'msid',\n                                value: msid\n                            });\n\n                            source.append(param);\n                        }\n                        description.append(source);\n                    }\n\n                    const ssrcGroupLines = SDPUtil.findLines(mediaItem, 'a=ssrc-group:');\n\n                    ssrcGroupLines.forEach((line: string) => {\n                        const { semantics, ssrcs } = SDPUtil.parseSSRCGroupLine(line);\n\n                        if (ssrcs.length) {\n                            const group = Strophe.xmlElement('ssrc-group', {\n                                semantics,\n                                xmlns: XEP.SOURCE_ATTRIBUTES\n                            });\n\n                            for (const val of ssrcs) {\n                                const src = Strophe.xmlElement('source', {\n                                    ssrc: val\n                                });\n\n                                group.append(src);\n                            }\n                            description.append(group);\n                        }\n                    });\n                }\n\n                return;\n            }\n            const midLine = SDPUtil.findLine(mediaItem, 'a=mid:', '');\n            const mid = typeof midLine === 'string' ? SDPUtil.parseMID(midLine) : '';\n\n            elem.c('content', {\n                creator: thecreator,\n                name: this.isP2P ? mid : mediaType\n            });\n\n            if (mediaType === MediaType.VIDEO && typeof this.initialLastN === 'number') {\n                elem.c('initial-last-n', {\n                    value: this.initialLastN,\n                    xmlns: 'jitsi:colibri2'\n                }).up();\n            }\n\n            if ([ MediaType.AUDIO, MediaType.VIDEO ].includes(mediaType as MediaType)) {\n                elem.c('description', {\n                    media: mediaType,\n                    xmlns: XEP.RTP_MEDIA\n                });\n\n                mline.fmt.forEach((format: string) => {\n                    const rtpmap = SDPUtil.findLine(mediaItem, `a=rtpmap:${format}`, '');\n\n                    if (typeof rtpmap === 'string') {\n                        elem.c('payload-type', SDPUtil.parseRTPMap(rtpmap));\n\n                        const afmtpline = SDPUtil.findLine(mediaItem, `a=fmtp:${format}`, '');\n\n                        if (afmtpline && typeof afmtpline === 'string') {\n                            const fmtpParameters = SDPUtil.parseFmtp(afmtpline);\n\n                            fmtpParameters.forEach((param: any) => elem.c('parameter', param).up());\n                        }\n\n                        this.rtcpFbToJingle(i, elem, format);\n                        elem.up();\n                    }\n                });\n\n                if (ssrc && !(isRecvOnly && browser.isFirefox())) {\n                    const ssrcMap = SDPUtil.parseSSRC(mediaItem);\n\n                    for (const [ availableSsrc, ssrcParameters ] of ssrcMap) {\n                        const sourceName = SDPUtil.parseSourceNameLine(ssrcParameters);\n                        const videoType = SDPUtil.parseVideoTypeLine(ssrcParameters);\n\n                        elem.c('source', {\n                            name: sourceName,\n                            ssrc: availableSsrc,\n                            videoType,\n                            xmlns: XEP.SOURCE_ATTRIBUTES\n                        });\n\n                        const msid = SDPUtil.parseMSIDAttribute(ssrcParameters);\n\n                        if (msid) {\n                            elem.c('parameter').attrs({\n                                name: 'msid',\n                                value: msid\n                            });\n                            elem.up();\n                        }\n\n                        elem.up();\n                    }\n\n                    const ssrcGroupLines = SDPUtil.findLines(mediaItem, 'a=ssrc-group:');\n\n                    ssrcGroupLines.forEach((line: string) => {\n                        const { semantics, ssrcs } = SDPUtil.parseSSRCGroupLine(line);\n\n                        if (ssrcs.length) {\n                            elem.c('ssrc-group', {\n                                semantics,\n                                xmlns: XEP.SOURCE_ATTRIBUTES\n                            });\n                            ssrcs.forEach(s => elem.c('source', { ssrc: s }).up());\n                            elem.up();\n                        }\n                    });\n                }\n\n                const ridLines = SDPUtil.findLines(mediaItem, 'a=rid:');\n\n                if (ridLines.length && browser.usesRidsForSimulcast()) {\n                    // Map a line which looks like \"a=rid:2 send\" to just the rid (\"2\").\n                    const rids = ridLines.map(ridLine => ridLine.split(':')[1].split(' ')[0]);\n\n                    rids.forEach(rid => {\n                        elem.c('source', {\n                            rid,\n                            xmlns: XEP.SOURCE_ATTRIBUTES\n                        });\n                        elem.up();\n                    });\n\n                    const unifiedSimulcast = SDPUtil.findLine(mediaItem, 'a=simulcast:');\n\n                    if (unifiedSimulcast) {\n                        elem.c('rid-group', {\n                            semantics: SSRC_GROUP_SEMANTICS.SIM,\n                            xmlns: XEP.SOURCE_ATTRIBUTES\n                        });\n                        rids.forEach(rid => elem.c('source', { rid }).up());\n                        elem.up();\n                    }\n                }\n\n                if (SDPUtil.findLine(mediaItem, 'a=rtcp-mux')) {\n                    elem.c('rtcp-mux').up();\n                }\n\n                this.rtcpFbToJingle(i, elem, '*');\n\n                const extmapLines = SDPUtil.findLines(mediaItem, 'a=extmap:', this.session);\n\n                extmapLines.forEach(extmapLine => {\n                    const extmap = SDPUtil.parseExtmap(extmapLine);\n\n                    elem.c('rtp-hdrext', {\n                        id: extmap.value,\n                        uri: extmap.uri,\n                        xmlns: XEP.RTP_HEADER_EXTENSIONS\n                    });\n\n                    if (extmap.hasOwnProperty('direction')) {\n                        switch (extmap.direction) {\n                        case MediaDirection.SENDONLY:\n                            elem.attrs({ senders: 'responder' });\n                            break;\n                        case MediaDirection.RECVONLY:\n                            elem.attrs({ senders: 'initiator' });\n                            break;\n                        case MediaDirection.SENDRECV:\n                            elem.attrs({ senders: 'both' });\n                            break;\n                        case MediaDirection.INACTIVE:\n                            elem.attrs({ senders: 'none' });\n                            break;\n                        }\n                    }\n\n                    elem.up();\n                });\n\n                if (SDPUtil.findLine(mediaItem, 'a=extmap-allow-mixed', this.session)) {\n                    elem.c('extmap-allow-mixed', {\n                        xmlns: XEP.RTP_HEADER_EXTENSIONS\n                    });\n                    elem.up();\n                }\n                elem.up(); // end of description\n            }\n\n            // Map ice-ufrag/pwd, dtls fingerprint, candidates.\n            this.transportToJingle(i, elem);\n\n            // Set senders attribute based on media direction\n            if (SDPUtil.findLine(mediaItem, `a=${MediaDirection.SENDRECV}`)) {\n                elem.attrs({ senders: 'both' });\n            } else if (SDPUtil.findLine(mediaItem, `a=${MediaDirection.SENDONLY}`)) {\n                elem.attrs({ senders: 'initiator' });\n            } else if (SDPUtil.findLine(mediaItem, `a=${MediaDirection.RECVONLY}`)) {\n                elem.attrs({ senders: 'responder' });\n            } else if (SDPUtil.findLine(mediaItem, `a=${MediaDirection.INACTIVE}`)) {\n                elem.attrs({ senders: 'none' });\n            }\n\n            // Reject an m-line only when port is 0 and a=bundle-only is not present in the section.\n            // The port is automatically set to 0 when bundle-only is used.\n            if (mline.port === '0' && !SDPUtil.findLine(mediaItem, 'a=bundle-only', this.session)) {\n                elem.attrs({ senders: 'rejected' });\n            }\n            elem.up(); // end of content\n        });\n        elem.up();\n\n        return elem;\n    }\n\n    /**\n     * Converts the session transport information from SDP to XMPP format.\n     *\n     * @param {*} mediaIndex The index for the m-line in the SDP.\n     * @param {*} elem The transport element.\n     */\n    public transportToJingle(mediaIndex: number, elem: any): void {\n        elem.c('transport');\n\n        const sctpport = SDPUtil.findLine(this.media[mediaIndex], 'a=sctp-port:', this.session);\n        const sctpmap = SDPUtil.findLine(this.media[mediaIndex], 'a=sctpmap:', this.session);\n\n        if (sctpport && typeof sctpport === 'string') {\n            const sctpAttrs = SDPUtil.parseSCTPPort(sctpport);\n\n            elem.c('sctpmap', {\n                number: sctpAttrs, // SCTP port\n                protocol: 'webrtc-datachannel', // protocol\n                xmlns: XEP.SCTP_DATA_CHANNEL\n            });\n\n            // The parser currently requires streams to be present.\n            elem.attrs({ streams: 0 });\n            elem.up();\n        } else if (sctpmap) {\n            const sctpAttrs = SDPUtil.parseSCTPMap(sctpmap);\n\n            elem.c('sctpmap', {\n                number: sctpAttrs[0], // SCTP port\n                protocol: sctpAttrs[1], // protocol\n                xmlns: XEP.SCTP_DATA_CHANNEL\n            });\n\n            // Optional stream count attribute.\n            elem.attrs({ streams: sctpAttrs.length > 2 ? sctpAttrs[2] : 0 });\n            elem.up();\n        }\n\n        const fingerprints = SDPUtil.findLines(this.media[mediaIndex], 'a=fingerprint:', this.session);\n\n        fingerprints.forEach(line => {\n            const fingerprint = SDPUtil.parseFingerprint(line);\n\n            fingerprint.xmlns = XEP.DTLS_SRTP;\n\n            elem.c('fingerprint').t(fingerprint.fingerprint);\n            delete fingerprint.fingerprint;\n\n            const setupLine = SDPUtil.findLine(this.media[mediaIndex], 'a=setup:', this.session);\n\n            if (setupLine && typeof setupLine === 'string') {\n                fingerprint.setup = setupLine.substr(8);\n            }\n            elem.attrs(fingerprint);\n            elem.up(); // end of fingerprint\n        });\n\n        const iceParameters = SDPUtil.iceparams(this.media[mediaIndex], this.session);\n\n        if (iceParameters) {\n            iceParameters.xmlns = XEP.ICE_UDP_TRANSPORT;\n            elem.attrs(iceParameters);\n\n            const candidateLines = SDPUtil.findLines(this.media[mediaIndex], 'a=candidate:', this.session);\n\n            candidateLines.forEach(line => { // add any a=candidate lines\n                const candidate = SDPUtil.candidateToJingle(line);\n\n                if (this.failICE) {\n                    candidate.ip = '1.1.1.1';\n                }\n\n                const protocol = candidate && typeof candidate.protocol === 'string'\n                    ? candidate.protocol.toLowerCase() : '';\n\n                if ((this.removeTcpCandidates && (protocol === 'tcp' || protocol === 'ssltcp'))\n                    || (this.removeUdpCandidates && protocol === 'udp')) {\n                    return;\n                }\n                elem.c('candidate', candidate).up();\n            });\n        }\n        elem.up(); // end of transport\n    }\n}\n","import * as transform from 'sdp-transform';\n\nimport { MediaDirection } from '../../service/RTC/MediaDirection';\nimport { MediaType } from '../../service/RTC/MediaType';\nimport { SIM_LAYERS, SSRC_GROUP_SEMANTICS } from '../../service/RTC/StandardVideoQualitySettings';\n\n/**\n * This class handles SDP munging for enabling simulcast for local video streams in Unified plan. A set of random SSRCs\n * are generated for the higher layer streams and they are cached for a given mid. The cached SSRCs are then reused on\n * the subsequent iterations while munging the local description. This class also handles imploding of the simulcast\n * SSRCs for remote endpoints into the primary FID group in remote description since Jicofo signals all SSRCs relevant\n * to a given endpoint.\n */\nexport default class SdpSimulcast {\n    private _numOfLayers: number;\n    private _ssrcCache: Map<string, Array<number>>;\n\n    /**\n     * Creates a new instance.\n     *\n     * @param options\n     */\n    constructor() {\n        this._ssrcCache = new Map();\n        this._numOfLayers = SIM_LAYERS.length;\n    }\n\n    /**\n     * Updates the given media description using the SSRCs that were cached for the mid associated\n     * with the media description and returns the modified media description.\n     *\n     * @param mLine\n     * @returns\n     */\n    _fillSsrcsFromCache(mLine: transform.MediaDescription): any {\n        const mid = mLine.mid;\n        const cachedSsrcs = this._ssrcCache.get(mid);\n        const newSsrcs = this._parseSimLayers(mLine);\n        const newMsid = this._getSsrcAttribute(mLine, newSsrcs[0], 'msid');\n        const newCname = this._getSsrcAttribute(mLine, newSsrcs[0], 'cname');\n\n        mLine.ssrcs = [];\n        mLine.ssrcGroups = [];\n\n        for (const ssrc of cachedSsrcs) {\n            mLine.ssrcs.push({\n                attribute: 'msid',\n                id: ssrc,\n                value: newMsid\n            });\n            mLine.ssrcs.push({\n                attribute: 'cname',\n                id: ssrc,\n                value: newCname\n            });\n        }\n\n        mLine.ssrcGroups.push({\n            semantics: SSRC_GROUP_SEMANTICS.SIM,\n            ssrcs: cachedSsrcs.join(' ')\n        });\n\n        return mLine;\n    }\n\n    /**\n     * Generates a new set of SSRCs for the higher simulcast layers/streams and adds the attributes and SIM group to\n     * the given media description and returns the modified media description.\n     *\n     * @param mLine\n     * @param primarySsrc\n     * @returns\n     */\n    _generateNewSsrcsForSimulcast(mLine: transform.MediaDescription, primarySsrc: number): any {\n        const cname = this._getSsrcAttribute(mLine, primarySsrc, 'cname');\n        let msid = this._getSsrcAttribute(mLine, primarySsrc, 'msid');\n\n        // In Unified-plan mode, the a=ssrc lines with the msid attribute are not present (only cname attributes are\n        // present) in the answers that Chrome and Safari generate for an offer received from Jicofo. Generate these\n        // a=ssrc lines using the msid values from the a=msid line.\n        if (!msid) {\n            msid = mLine.msid;\n            const primarySsrcs = mLine.ssrcs;\n\n            primarySsrcs.forEach(ssrc => {\n                mLine.ssrcs.push({\n                    attribute: 'msid',\n                    id: ssrc.id,\n                    value: msid\n                });\n            });\n        }\n\n        // Generate SIM layers.\n        const simSsrcs = [];\n\n        for (let i = 0; i < this._numOfLayers - 1; ++i) {\n            const simSsrc = this._generateSsrc();\n\n            mLine.ssrcs.push({\n                attribute: 'cname',\n                id: simSsrc,\n                value: cname\n            });\n            mLine.ssrcs.push({\n                attribute: 'msid',\n                id: simSsrc,\n                value: msid\n            });\n\n            simSsrcs.push(simSsrc);\n        }\n\n        mLine.ssrcGroups = mLine.ssrcGroups || [];\n        mLine.ssrcGroups.push({\n            semantics: SSRC_GROUP_SEMANTICS.SIM,\n            ssrcs: `${primarySsrc} ${simSsrcs.join(' ')}`\n        });\n\n        return mLine;\n    }\n\n    /**\n     * Returns a random number to be used for the SSRC.\n     *\n     * @returns\n     */\n    _generateSsrc(): number {\n        const max = 0xffffffff;\n\n        return Math.floor(Math.random() * max);\n    }\n\n    /**\n     * Returns the requested attribute value for a SSRC from a given media description.\n     *\n     * @param mLine\n     * @param ssrc\n     * @param attributeName\n     * @returns\n     */\n    _getSsrcAttribute(mLine: transform.MediaDescription, ssrc: number, attributeName: string): Optional<string> {\n        return mLine.ssrcs?.find(\n            ssrcInfo => Number(ssrcInfo.id) === ssrc\n            && ssrcInfo.attribute === attributeName)?.value;\n    }\n\n    /**\n     * Returns an array of all the primary SSRCs in the SIM group for a given media description.\n     *\n     * @param mLine\n     * @returns\n     */\n    _parseSimLayers(mLine: transform.MediaDescription): Nullable<Array<number>> {\n        const simGroup = mLine.ssrcGroups?.find(group => group.semantics === SSRC_GROUP_SEMANTICS.SIM);\n\n        if (simGroup) {\n            return simGroup.ssrcs.split(' ').map(ssrc => Number(ssrc));\n        }\n\n        if (mLine.ssrcs?.length) {\n            return [ Number(mLine.ssrcs[0].id) ];\n        }\n\n        return null;\n    }\n\n    /**\n     * Munges the given media description to enable simulcast for the video media sections that are in either have\n     * SENDRECV or SENDONLY as the media direction thereby ignoring all the RECVONLY transceivers created for remote\n     * endpoints.\n     * NOTE: This needs to be called only when simulcast is enabled.\n     *\n     * @param description\n     * @returns\n     */\n    mungeLocalDescription(description: RTCSessionDescription): RTCSessionDescription {\n        if (!description?.sdp) {\n            return description;\n        }\n        const session = transform.parse(description.sdp);\n\n        for (let media of session.media) {\n            // Ignore recvonly and inactive transceivers created for remote sources.\n            if (media.direction === MediaDirection.RECVONLY || media.direction === MediaDirection.INACTIVE) {\n                continue;\n            }\n\n            // Ignore audio m-lines.\n            if (media.type !== MediaType.VIDEO) {\n                continue;\n            }\n            const mid = media.mid;\n            const numSsrcs = new Set(media.ssrcs?.map(ssrcInfo => ssrcInfo.id));\n            const numGroups = media.ssrcGroups?.length ?? 0;\n            let primarySsrc: number;\n\n            // Do not munge if the description has no ssrcs or if simulcast is already enabled.\n            if (numSsrcs.size === 0 || numSsrcs.size > 2 || (numSsrcs.size === 2 && numGroups === 0)) {\n                continue;\n            }\n            if (numSsrcs.size === 1) {\n                primarySsrc = Number(media.ssrcs[0]?.id);\n            } else {\n                const fidGroup = media.ssrcGroups.find(group => group.semantics === SSRC_GROUP_SEMANTICS.FID);\n\n                if (fidGroup) {\n                    primarySsrc = Number(fidGroup.ssrcs.split(' ')[0]);\n                }\n            }\n\n            if (this._ssrcCache.has(mid)) {\n                media = this._fillSsrcsFromCache(media);\n            } else {\n                media = this._generateNewSsrcsForSimulcast(media, primarySsrc);\n                const simulcastSsrcs = this._parseSimLayers(media);\n\n                // Update the SSRCs in the cache so that they can re-used for the same mid again.\n                this._ssrcCache.set(mid, simulcastSsrcs);\n            }\n        }\n\n        return new RTCSessionDescription({\n            sdp: transform.write(session),\n            type: description.type\n        });\n    }\n}\n","import { getLogger } from '@jitsi/logger';\n\nimport JitsiConference from '../../JitsiConference';\nimport { JitsiConferenceEvents } from '../../JitsiConferenceEvents';\nimport { JitsiTrackEvents } from '../../JitsiTrackEvents';\nimport { RTCEvents } from '../../service/RTC/RTCEvents';\nimport { VideoType } from '../../service/RTC/VideoType';\nimport { createTrackStreamingStatusEvent } from '../../service/statistics/AnalyticsEvents';\nimport JitsiRemoteTrack from '../RTC/JitsiRemoteTrack';\nimport RTC from '../RTC/RTC';\nimport RTCStats from '../RTCStats/RTCStats';\nimport { RTCStatsEvents } from '../RTCStats/RTCStatsEvents';\nimport browser from '../browser';\nimport Statistics from '../statistics/statistics';\n\n/** Track streaming statuses. */\nexport enum TrackStreamingStatus {\n\n    /**\n     * Status indicating that streaming is currently active.\n     */\n    ACTIVE = 'active',\n\n    /**\n     * Status indicating that streaming is currently inactive.\n     * Inactive means the streaming was stopped on purpose from the bridge, like exiting forwarded sources or\n     * adaptivity decided to drop video because of not enough bandwidth.\n     */\n    INACTIVE = 'inactive',\n\n    /**\n     * Status indicating that streaming is currently interrupted.\n     */\n    INTERRUPTED = 'interrupted',\n\n    /**\n     * Status indicating that streaming is currently restoring.\n     */\n    RESTORING = 'restoring',\n}\n\ntype StreamingStatusMap = {\n    p2p?: boolean;\n    startedMs?: number;\n    streamingStatus?: string;\n    value?: number;\n    videoType?: VideoType;\n};\n\nconst logger = getLogger('connectivity:TrackStreamingStatus');\n\n/**\n * Default value of 500 milliseconds for {@link TrackStreamingStatusImpl.outOfForwardedSourcesTimeout}.\n */\nconst DEFAULT_NOT_IN_FORWARDED_SOURCES_TIMEOUT = 500;\n\n/**\n * Default value of 2500 milliseconds for {@link TrackStreamingStatusImpl.p2pRtcMuteTimeout}.\n */\nconst DEFAULT_P2P_RTC_MUTE_TIMEOUT = 2500;\n\n/**\n * Default value of 10000 milliseconds for {@link TrackStreamingStatusImpl.rtcMuteTimeout}.\n */\nconst DEFAULT_RTC_MUTE_TIMEOUT = 10000;\n\n/**\n * The time to wait a track to be restored. Track which was out of forwarded sources should be inactive and when\n * entering forwarded sources it becomes restoring and when data is received from bridge it will become active, but if\n * no data is received for some time we set status of that track streaming to interrupted.\n */\nconst DEFAULT_RESTORING_TIMEOUT = 10000;\n\n/**\n * Class is responsible for emitting JitsiTrackEvents.TRACK_STREAMING_STATUS_CHANGED events.\n */\nexport class TrackStreamingStatusImpl {\n    rtc: RTC;\n    conference: JitsiConference;\n    track: JitsiRemoteTrack;\n\n    /**  This holds the timeout callback ID scheduled using window.setTimeout. */\n    trackTimer: Nullable<number>;\n\n    /**\n     * If video track frozen detection through RTC mute event is supported, we wait some time until video track is\n     * considered frozen. But because when the track falls out of forwarded sources it is expected for the video to\n     * freeze this timeout must be significantly reduced in \"out of forwarded sources\" case.\n     *\n     * Basically this value is used instead of {@link rtcMuteTimeout} when track is not in forwarded sources.\n     */\n    outOfForwardedSourcesTimeout: number;\n\n    /**\n     * How long we are going to wait for the corresponding signaling mute event after the RTC video track muted\n     * event is fired on the Media stream, before the connection interrupted is fired. The default value is\n     * {@link DEFAULT_P2P_RTC_MUTE_TIMEOUT}.\n     */\n    p2pRtcMuteTimeout: number;\n\n    /**\n     * How long we're going to wait after the RTC video track muted event for the corresponding signalling mute\n     * event, before the connection interrupted is fired. The default value is {@link DEFAULT_RTC_MUTE_TIMEOUT}.\n     *\n     * @returns amount of time in milliseconds\n     */\n    rtcMuteTimeout: number;\n\n    /**\n     * This holds a timestamp indicating  when remote video track was RTC muted. The purpose of storing the\n     * timestamp is to avoid the transition to disconnected status in case of legitimate video mute operation where\n     * the signalling video muted event can arrive shortly after RTC muted event.\n     *\n     * The timestamp is measured in milliseconds obtained with <tt>Date.now()</tt>.\n     *\n     * FIXME merge this logic with NO_DATA_FROM_SOURCE event implemented in JitsiLocalTrack by extending the event\n     * to the remote track and allowing to set different timeout for local and remote tracks.\n     */\n    rtcMutedTimestamp: Nullable<number>;\n\n    /** This holds the restoring timeout callback ID scheduled using window.setTimeout. */\n    restoringTimer: Nullable<ReturnType<typeof setTimeout>>;\n\n    /**\n     * This holds the current streaming status (along with all the internal events that happen while in that\n     * state).\n     *\n     * The goal is to send this information to the analytics backend for post-mortem analysis.\n     */\n    streamingStatusMap: StreamingStatusMap;\n\n    _onP2PStatus: () => void;\n    _onUserLeft: () => void;\n    _onTrackRtcMuted: () => void;\n    _onTrackRtcUnmuted: () => void;\n    _onSignallingMuteChanged: () => void;\n    _onTrackVideoTypeChanged: () => void;\n    _onLastNValueChanged: () => void;\n    _onForwardedSourcesChanged: () => void;\n\n    /* eslint-disable max-params */\n    /**\n     * Calculates the new {@link TrackStreamingStatus} based on the values given for some specific remote track. It is\n     * assumed that the conference is currently in the JVB mode (in contrary to the P2P mode)\n     * @param isInForwardedSources - indicates whether the track is in the forwarded sources set. When set to\n     * false it means that JVB is not sending any video for the track.\n     * @param isRestoringTimedout - if true it means that the track has been outside of forwarded sources too\n     * long to be considered {@link TrackStreamingStatus.RESTORING}.\n     * @param isVideoMuted - true if the track is video muted and we should not expect to receive any video.\n     * @param isVideoTrackFrozen - if the current browser support video frozen detection then it will be set to\n     * true when the video track is frozen. If the current browser does not support frozen detection the it's always\n     * false.\n     * @return {TrackStreamingStatus} the new streaming status for the track for whom the values above were provided.\n     * @private\n     */\n    static _getNewStateForJvbMode(\n            isInForwardedSources: boolean,\n            isRestoringTimedout: boolean,\n            isVideoMuted: boolean,\n            isVideoTrackFrozen: boolean): TrackStreamingStatus {\n\n        // We are currently not checking the endpoint connection status received from the JVB.\n        if (isVideoMuted) {\n            // If the connection is active according to JVB and the track is video muted there is no way for the\n            // connection to be inactive, because the detection logic below only makes sense for video.\n            return TrackStreamingStatus.ACTIVE;\n        }\n\n        // Logic when isVideoTrackFrozen is supported\n        if (browser.supportsVideoMuteOnConnInterrupted()) {\n            if (!isVideoTrackFrozen) {\n                // If the video is playing we're good\n                return TrackStreamingStatus.ACTIVE;\n            } else if (isInForwardedSources) {\n                return isRestoringTimedout ? TrackStreamingStatus.INTERRUPTED : TrackStreamingStatus.RESTORING;\n            }\n\n            return TrackStreamingStatus.INACTIVE;\n        }\n\n        // Because this browser is incapable of detecting frozen video we must rely on the forwarded sources value\n        return isInForwardedSources ? TrackStreamingStatus.ACTIVE : TrackStreamingStatus.INACTIVE;\n    }\n\n    /* eslint-enable max-params */\n\n    /**\n     * In P2P mode we don't care about any values coming from the JVB and the streaming status can be only active or\n     * interrupted.\n     * @param isVideoMuted - true if video muted\n     * @param isVideoTrackFrozen - true if the video track for the remote track is currently frozen. If the\n     * current browser does not support video frozen detection then it's always false.\n     * @return {TrackStreamingStatus}\n     * @private\n     */\n    static _getNewStateForP2PMode(isVideoMuted: boolean, isVideoTrackFrozen: boolean): TrackStreamingStatus {\n        if (!browser.supportsVideoMuteOnConnInterrupted()) {\n            // There's no way to detect problems in P2P when there's no video track frozen detection...\n            return TrackStreamingStatus.ACTIVE;\n        }\n\n        return isVideoMuted || !isVideoTrackFrozen\n            ? TrackStreamingStatus.ACTIVE : TrackStreamingStatus.INTERRUPTED;\n    }\n\n    /**\n     * Creates new instance of <tt>TrackStreamingStatus</tt>.\n     *\n     * @constructor\n     * @param rtc - the RTC service instance\n     * @param conference - parent conference instance // TODO: Needs JitsiConference Type\n     * @param {Object} options\n     * @param {number} [options.p2pRtcMuteTimeout=2500] custom value for\n     * {@link TrackStreamingStatusImpl.p2pRtcMuteTimeout}.\n     * @param {number} [options.rtcMuteTimeout=2000] custom value for\n     * {@link TrackStreamingStatusImpl.rtcMuteTimeout}.\n     * @param {number} [options.outOfForwardedSourcesTimeout=500] custom value for\n     * {@link TrackStreamingStatusImpl.outOfForwardedSourcesTimeout}.\n     */\n    constructor(rtc: RTC, conference: JitsiConference, track: JitsiRemoteTrack, options: {\n        outOfForwardedSourcesTimeout: number;\n        p2pRtcMuteTimeout: number;\n        rtcMuteTimeout: number;\n    }) {\n        this.rtc = rtc;\n        this.conference = conference;\n        this.track = track;\n\n        this.restoringTimer = null;\n        this.rtcMutedTimestamp = null;\n        this.streamingStatusMap = {};\n        this.trackTimer = null;\n\n        this.outOfForwardedSourcesTimeout = typeof options.outOfForwardedSourcesTimeout === 'number'\n            ? options.outOfForwardedSourcesTimeout : DEFAULT_NOT_IN_FORWARDED_SOURCES_TIMEOUT;\n\n        this.p2pRtcMuteTimeout = typeof options.p2pRtcMuteTimeout === 'number'\n            ? options.p2pRtcMuteTimeout : DEFAULT_P2P_RTC_MUTE_TIMEOUT;\n\n        this.rtcMuteTimeout = typeof options.rtcMuteTimeout === 'number'\n            ? options.rtcMuteTimeout : DEFAULT_RTC_MUTE_TIMEOUT;\n        logger.info(`RtcMuteTimeout set to: ${this.rtcMuteTimeout}`);\n    }\n\n    /**\n     * Gets the video frozen timeout for given source name.\n     * @return how long are we going to wait since RTC video muted even, before a video track is considered\n     * frozen.\n     * @private\n     */\n    _getVideoFrozenTimeout(): number {\n        const sourceName = this.track.getSourceName();\n\n        return this.rtc.isInForwardedSources(sourceName)\n            ? this.rtcMuteTimeout\n            : this.conference.isP2PActive() ? this.p2pRtcMuteTimeout : this.outOfForwardedSourcesTimeout;\n    }\n\n    /**\n     * Initializes <tt>TrackStreamingStatus</tt> and bind required event listeners.\n     */\n    init(): void {\n        // Handles P2P status changes\n        this._onP2PStatus = this.figureOutStreamingStatus.bind(this);\n        this.conference.on(JitsiConferenceEvents.P2P_STATUS, this._onP2PStatus);\n\n        // Used to send analytics events for the participant that left the call.\n        this._onUserLeft = this.onUserLeft.bind(this);\n        this.conference.on(JitsiConferenceEvents.USER_LEFT, this._onUserLeft);\n\n        // On some browsers MediaStreamTrack trigger \"onmute\"/\"onunmute\" events for video type tracks when they stop\n        // receiving data which is often a sign that remote user is having connectivity issues.\n        if (browser.supportsVideoMuteOnConnInterrupted()) {\n\n            this._onTrackRtcMuted = this.onTrackRtcMuted.bind(this);\n            this.rtc.addListener(RTCEvents.REMOTE_TRACK_MUTE, this._onTrackRtcMuted);\n\n            this._onTrackRtcUnmuted = this.onTrackRtcUnmuted.bind(this);\n            this.rtc.addListener(RTCEvents.REMOTE_TRACK_UNMUTE, this._onTrackRtcUnmuted);\n\n            // Listened which will be bound to JitsiRemoteTrack to listen for signalling mute/unmute events.\n            this._onSignallingMuteChanged = this.onSignallingMuteChanged.bind(this);\n            this.track.on(JitsiTrackEvents.TRACK_MUTE_CHANGED, this._onSignallingMuteChanged);\n\n            // Used to send an analytics event when the video type changes.\n            this._onTrackVideoTypeChanged = this.onTrackVideoTypeChanged.bind(this);\n            this.track.on(JitsiTrackEvents.TRACK_VIDEOTYPE_CHANGED, this._onTrackVideoTypeChanged);\n        }\n\n        this._onForwardedSourcesChanged = this.onForwardedSourcesChanged.bind(this);\n        this.conference.on(JitsiConferenceEvents.FORWARDED_SOURCES_CHANGED, this._onForwardedSourcesChanged);\n\n        this._onLastNValueChanged = this.figureOutStreamingStatus.bind(this);\n        this.rtc.on(RTCEvents.LASTN_VALUE_CHANGED, this._onLastNValueChanged);\n    }\n\n    /**\n     * Removes all event listeners and disposes of all resources held by this instance.\n     */\n    dispose(): void {\n        if (browser.supportsVideoMuteOnConnInterrupted()) {\n            this.rtc.removeListener(RTCEvents.REMOTE_TRACK_MUTE, this._onTrackRtcMuted);\n            this.rtc.removeListener(RTCEvents.REMOTE_TRACK_UNMUTE, this._onTrackRtcUnmuted);\n\n            this.track.off(JitsiTrackEvents.TRACK_MUTE_CHANGED, this._onSignallingMuteChanged);\n            this.track.off(JitsiTrackEvents.TRACK_VIDEOTYPE_CHANGED, this._onTrackVideoTypeChanged);\n        }\n\n        this.conference.off(JitsiConferenceEvents.FORWARDED_SOURCES_CHANGED, this._onForwardedSourcesChanged);\n        this.conference.off(JitsiConferenceEvents.P2P_STATUS, this._onP2PStatus);\n        this.conference.off(JitsiConferenceEvents.USER_LEFT, this._onUserLeft);\n        this.rtc.removeListener(RTCEvents.LASTN_VALUE_CHANGED, this._onLastNValueChanged);\n\n        this.clearTimeout();\n        this.clearRtcMutedTimestamp();\n        this.maybeSendTrackStreamingStatusEvent(Date.now());\n        this.figureOutStreamingStatus();\n    }\n\n    /**\n     * Changes streaming status.\n     * @param newStatus\n     */\n    _changeStreamingStatus(newStatus: TrackStreamingStatus): void {\n        if (this.track.getTrackStreamingStatus() !== newStatus) {\n\n            const sourceName = this.track.getSourceName();\n\n            this.track._setTrackStreamingStatus(newStatus);\n\n            logger.debug(`Emit track streaming status(${Date.now()}) ${sourceName}: ${newStatus}`);\n\n            // It's common for the event listeners to access the JitsiRemoteTrack. Thus pass it as a parameter here.\n            this.track.emit(JitsiTrackEvents.TRACK_STREAMING_STATUS_CHANGED, this.track, newStatus);\n            if (newStatus === TrackStreamingStatus.INACTIVE) {\n                RTCStats.sendStatsEntry(RTCStatsEvents.REMOTE_SOURCE_SUSPENDED_EVENT);\n            } else if (newStatus === TrackStreamingStatus.INTERRUPTED) {\n                RTCStats.sendStatsEntry(RTCStatsEvents.REMOTE_SOURCE_INTERRUPTED_EVENT);\n            }\n        }\n    }\n\n    /**\n     * Reset the postponed \"streaming interrupted\" event which was previously scheduled as a timeout on RTC 'onmute'\n     * event.\n     */\n    clearTimeout(): void {\n        if (this.trackTimer) {\n            window.clearTimeout(this.trackTimer);\n            this.trackTimer = null;\n        }\n    }\n\n    /**\n     * Clears the timestamp of the RTC muted event for remote video track.\n     */\n    clearRtcMutedTimestamp(): void {\n        this.rtcMutedTimestamp = null;\n    }\n\n    /**\n     * Checks if track is considered frozen.\n     * @return <tt>true</tt> if the video has frozen or <tt>false</tt> when it's either not considered frozen\n     * (yet) or if freeze detection is not supported by the current browser.\n     *\n     * FIXME merge this logic with NO_DATA_FROM_SOURCE event implemented in JitsiLocalTrack by extending the event to\n     *       the remote track and allowing to set different timeout for local and remote tracks.\n     */\n    isVideoTrackFrozen(): boolean {\n        if (!browser.supportsVideoMuteOnConnInterrupted()) {\n            return false;\n        }\n\n        const isVideoRTCMuted = this.track.isWebRTCTrackMuted();\n        const rtcMutedTimestamp = this.rtcMutedTimestamp;\n        const timeout = this._getVideoFrozenTimeout();\n\n        return isVideoRTCMuted && typeof rtcMutedTimestamp === 'number' && (Date.now() - rtcMutedTimestamp) >= timeout;\n    }\n\n    /**\n     * Figures out (and updates) the current streaming status for the track identified by the source name.\n     */\n    figureOutStreamingStatus(): void {\n        const sourceName = this.track.getSourceName();\n        const inP2PMode = this.conference.isP2PActive();\n        const isRestoringTimedOut = this._isRestoringTimedout();\n        const audioOnlyMode = this.conference.getLastN() === 0;\n\n        // NOTE Overriding videoMuted to true for audioOnlyMode should disable any detection based on video playback or\n        // forwarded sources.\n        const isVideoMuted = this.track.isMuted() || audioOnlyMode;\n        const isVideoTrackFrozen = this.isVideoTrackFrozen();\n        const isInForwardedSources = this.rtc.isInForwardedSources(sourceName);\n\n        const newState\n            = inP2PMode\n                ? TrackStreamingStatusImpl._getNewStateForP2PMode(\n                    isVideoMuted,\n                    isVideoTrackFrozen)\n                : TrackStreamingStatusImpl._getNewStateForJvbMode(\n                    isInForwardedSources,\n                    isRestoringTimedOut,\n                    isVideoMuted,\n                    isVideoTrackFrozen);\n\n        // if the new state is not restoring clear timers and timestamps that we use to track the restoring state\n        if (newState !== TrackStreamingStatus.RESTORING) {\n            this._clearRestoringTimer();\n        }\n\n        logger.debug(\n            `Figure out conn status for ${sourceName}, is video muted: ${\n                isVideoMuted} video track frozen: ${\n                isVideoTrackFrozen} p2p mode: ${\n                inP2PMode} is in forwarded sources: ${\n                isInForwardedSources} currentStatus => newStatus: ${\n                this.track.getTrackStreamingStatus()} => ${newState}`);\n\n        const oldStreamingStatus = this.streamingStatusMap || {};\n\n        // Send an analytics event (guard on either the p2p flag or the streaming status has changed since the last\n        // time this code block run).\n        if (!('p2p' in oldStreamingStatus)\n            || !('streamingStatus' in oldStreamingStatus)\n            || oldStreamingStatus.p2p !== inP2PMode\n            || oldStreamingStatus.streamingStatus !== newState) {\n\n            const nowMs = Date.now();\n\n            this.maybeSendTrackStreamingStatusEvent(nowMs);\n\n            this.streamingStatusMap = {\n                ...oldStreamingStatus,\n                p2p: inP2PMode,\n                startedMs: nowMs,\n                streamingStatus: newState\n            };\n\n            // sometimes (always?) we're late to hook the TRACK_VIDEOTYPE_CHANGED event and the video type is not in\n            // oldStreamingStatus.\n            if (!('videoType' in this.streamingStatusMap)) {\n                this.streamingStatusMap.videoType = this.track.getVideoType();\n            }\n        }\n        this._changeStreamingStatus(newState);\n    }\n\n    /**\n     * Computes the duration of the current streaming status for the track (i.e. 15 seconds in the INTERRUPTED state)\n     * and sends a track streaming status event.\n     * @param nowMs - The current time (in millis).\n     */\n    maybeSendTrackStreamingStatusEvent(nowMs: number): void {\n        const trackStreamingStatus = this.streamingStatusMap;\n\n        if (trackStreamingStatus\n            && 'startedMs' in trackStreamingStatus\n            && 'videoType' in trackStreamingStatus\n            && 'streamingStatus' in trackStreamingStatus\n            && 'p2p' in trackStreamingStatus) {\n            trackStreamingStatus.value = nowMs - trackStreamingStatus.startedMs;\n            Statistics.sendAnalytics(createTrackStreamingStatusEvent(trackStreamingStatus));\n        }\n    }\n\n    /**\n     * On change in forwarded sources set check all leaving and entering track to change their corresponding statuses.\n     *\n     * @param leavingForwardedSources - The array of sourceName leaving forwarded sources.\n     * @param enteringForwardedSources - The array of sourceName entering forwarded sources.\n     * @param timestamp - The time in millis\n     * @private\n     */\n    onForwardedSourcesChanged(\n            leavingForwardedSources: string[] = [],\n            enteringForwardedSources: string[] = [],\n            timestamp: number): void {\n\n        const sourceName = this.track.getSourceName();\n\n        // If the browser doesn't fire the mute/onmute events when the remote peer stops/starts sending media,\n        // calculate the streaming status for all the tracks since it won't get triggered automatically on the track\n        // that has started/stopped receiving media.\n        if (!browser.supportsVideoMuteOnConnInterrupted()) {\n            this.figureOutStreamingStatus();\n        }\n\n        if (leavingForwardedSources.includes(sourceName)) {\n            this.track._clearEnteredForwardedSourcesTimestamp();\n            this._clearRestoringTimer();\n            browser.supportsVideoMuteOnConnInterrupted() && this.figureOutStreamingStatus();\n        }\n\n        if (enteringForwardedSources.includes(sourceName)) {\n            // store the timestamp this track is entering forwarded sources\n            this.track._setEnteredForwardedSourcesTimestamp(timestamp);\n            browser.supportsVideoMuteOnConnInterrupted() && this.figureOutStreamingStatus();\n        }\n    }\n\n    /**\n     * Clears the restoring timer for video track and the timestamp for entering forwarded sources.\n     */\n    _clearRestoringTimer(): void {\n        const rTimer = this.restoringTimer;\n\n        if (rTimer) {\n            clearTimeout(rTimer);\n            this.restoringTimer = null;\n        }\n    }\n\n    /**\n     * Checks whether a track had stayed enough in restoring state, compares current time and the time the track\n     * entered in forwarded sources. If it hasn't timedout and there is no timer added, add new timer in order to give\n     * it more time to become active or mark it as interrupted on next check.\n     *\n     * @returns <tt>true</tt> if the track was in restoring state more than the timeout\n     * ({@link DEFAULT_RESTORING_TIMEOUT}.) in order to set its status to interrupted.\n     * @private\n     */\n    _isRestoringTimedout(): boolean {\n        const enteredForwardedSourcesTimestamp = this.track._getEnteredForwardedSourcesTimestamp();\n\n        if (enteredForwardedSourcesTimestamp\n            && (Date.now() - enteredForwardedSourcesTimestamp) >= DEFAULT_RESTORING_TIMEOUT) {\n            return true;\n        }\n\n        // still haven't reached timeout, if there is no timer scheduled, schedule one so we can track the restoring\n        // state and change it after reaching the timeout\n        const rTimer = this.restoringTimer;\n\n        if (!rTimer) {\n            this.restoringTimer = setTimeout(() => this.figureOutStreamingStatus(), DEFAULT_RESTORING_TIMEOUT);\n        }\n\n        return false;\n    }\n\n    /** Checks whether a track is the current track. */\n    _isCurrentTrack(track: JitsiRemoteTrack): boolean {\n        return track.getSourceName() === this.track.getSourceName();\n    }\n\n    /**\n     * Sends a last/final track streaming status event for the track of the user that left the conference.\n     * @param id - The id of the participant that left the conference.\n     */\n    onUserLeft(id: string): void {\n        if (this.track.getParticipantId() === id) {\n            this.maybeSendTrackStreamingStatusEvent(Date.now());\n            this.streamingStatusMap = {};\n        }\n    }\n\n    /**\n     * Handles RTC 'onmute' event for the video track.\n     *\n     * @param track - The video track for which 'onmute' event will be processed.\n     */\n    onTrackRtcMuted(track: JitsiRemoteTrack): void {\n        if (!this._isCurrentTrack(track)) {\n            return;\n        }\n\n        const sourceName = track.getSourceName();\n\n        logger.debug(`Detector track RTC muted: ${sourceName}`, Date.now());\n\n        this.rtcMutedTimestamp = Date.now();\n        if (!track.isMuted()) {\n            // If the user is not muted according to the signalling we'll give it some time, before the streaming\n            // interrupted event is triggered.\n            this.clearTimeout();\n\n            // The timeout is reduced when track is not in the forwarded sources\n            const timeout = this._getVideoFrozenTimeout();\n\n            this.trackTimer = window.setTimeout(() => {\n                logger.debug(`Set track RTC muted for: ${sourceName} after the timeout of ${timeout} ms`);\n                this.clearTimeout();\n                this.figureOutStreamingStatus();\n            }, timeout);\n        }\n    }\n\n    /**\n     * Handles RTC 'onunmute' event for the video track.\n     *\n     * @param track - The video track for which 'onunmute' event will be processed.\n     */\n    onTrackRtcUnmuted(track: JitsiRemoteTrack): void {\n        if (!this._isCurrentTrack(track)) {\n            return;\n        }\n\n        const sourceName = this.track.getSourceName();\n\n        logger.debug(`Detector track RTC unmuted: ${sourceName}`, Date.now());\n\n        this.clearTimeout();\n        this.clearRtcMutedTimestamp();\n\n        this.figureOutStreamingStatus();\n    }\n\n    /**\n     * Here the signalling \"mute\"/\"unmute\" events are processed.\n     *\n     * @param track - The remote video track for which the signalling mute/unmute event will be\n     * processed.\n     */\n    onSignallingMuteChanged(track: JitsiRemoteTrack): void {\n        if (!this._isCurrentTrack(track)) {\n            return;\n        }\n\n        this.figureOutStreamingStatus();\n    }\n\n    /**\n     * Sends a track streaming status event as a result of the video type changing.\n     * @deprecated this will go away with full multiple streams support\n     * @param type - The video type.\n     */\n    onTrackVideoTypeChanged(type: VideoType): void {\n        const nowMs = Date.now();\n\n        this.maybeSendTrackStreamingStatusEvent(nowMs);\n\n        this.streamingStatusMap = {\n            ...this.streamingStatusMap || {},\n            startedMs: nowMs,\n            videoType: type\n        };\n    }\n}\n\nexport default TrackStreamingStatusImpl;\n","import { getLogger } from '@jitsi/logger';\n\nimport JitsiConference from '../../JitsiConference';\nimport { JitsiTrackEvents } from '../../JitsiTrackEvents';\nimport { MediaType } from '../../service/RTC/MediaType';\nimport { RTCEvents } from '../../service/RTC/RTCEvents';\nimport { VideoType } from '../../service/RTC/VideoType';\nimport { createTtfmEvent } from '../../service/statistics/AnalyticsEvents';\nimport TrackStreamingStatusImpl, { TrackStreamingStatus } from '../connectivity/TrackStreamingStatus';\nimport Statistics from '../statistics/statistics';\nimport { isValidNumber } from '../util/MathUtil';\n\nimport JitsiTrack from './JitsiTrack';\nimport RTC from './RTC';\n\nconst logger = getLogger('rtc:JitsiRemoteTrack');\n\nlet ttfmTrackerAudioAttached = false;\nlet ttfmTrackerVideoAttached = false;\n\n/**\n * List of container events that we are going to process. _onContainerEventHandler will be added as listener to the\n * container for every event in the list.\n */\nconst containerEvents = [ 'abort', 'canplaythrough', 'ended', 'error', 'stalled', 'suspend', 'waiting' ];\n\n/* eslint-disable max-params */\n\n/**\n * Represents a single media track (either audio or video).\n *\n * @noInheritDoc\n */\nexport default class JitsiRemoteTrack extends JitsiTrack {\n    private _sourceName: string;\n    private _trackStreamingStatus: Nullable<TrackStreamingStatus>;\n    private _trackStreamingStatusImpl: Nullable<TrackStreamingStatusImpl>;\n\n    /**\n     * This holds the timestamp indicating when remote video track entered forwarded sources set. Track entering\n     * forwardedSources will have streaming status restoring and when we start receiving video will become active,\n     * but if video is not received for certain time {@link DEFAULT_RESTORING_TIMEOUT} that track streaming status\n     * will become interrupted.\n     */\n    private _enteredForwardedSourcesTimestamp: Nullable<number>;\n    private _containerHandlers: { [key: string]: (event: Event) => void; };\n    private _rtc: RTC;\n    private _muted: boolean;\n    private _hasBeenMuted: boolean;\n    private _ssrc: number;\n\n    public ownerEndpointId: string;\n    public isP2P: boolean;\n    public rtcId: Nullable<string>;\n\n    /**\n     * Creates new JitsiRemoteTrack instance.\n     * @param {RTC} rtc the RTC service instance.\n     * @param {JitsiConference} conference the conference to which this track\n     *        belongs to\n     * @param {string} ownerEndpointId the endpoint ID of the track owner\n     * @param {MediaStream} stream WebRTC MediaStream, parent of the track\n     * @param {MediaStreamTrack} track underlying WebRTC MediaStreamTrack for\n     *        the new JitsiRemoteTrack\n     * @param {MediaType} mediaType the type of the media\n     * @param {VideoType} videoType the type of the video if applicable\n     * @param {number} ssrc the SSRC number of the Media Stream\n     * @param {boolean} muted the initial muted state\n     * @param {boolean} isP2P indicates whether or not this track belongs to a\n     * P2P session\n     * @param {String} sourceName the source name signaled for the track\n     * @throws {TypeError} if <tt>ssrc</tt> is not a number.\n     */\n    constructor(\n            rtc: RTC,\n            conference: JitsiConference,\n            ownerEndpointId: string,\n            stream: MediaStream,\n            track: MediaStreamTrack,\n            mediaType: MediaType,\n            videoType: VideoType,\n            ssrc: number,\n            muted: boolean,\n            isP2P: boolean,\n            sourceName: string) {\n        super(\n            conference,\n            stream,\n            track,\n            () => {\n                // Nothing to do if the track is inactive.\n            },\n            mediaType,\n            videoType);\n        this._rtc = rtc;\n\n        // Prevent from mixing up type of SSRC which should be a number\n        if (typeof ssrc !== 'number') {\n            throw new TypeError(`SSRC ${ssrc} is not a number`);\n        }\n        this._ssrc = ssrc;\n        this.ownerEndpointId = ownerEndpointId;\n        this._muted = muted;\n        this.isP2P = isP2P;\n        this._sourceName = sourceName;\n        this._trackStreamingStatus = null;\n        this._trackStreamingStatusImpl = null;\n        this.rtcId = null;\n\n        /**\n         * This holds the timestamp indicating when remote video track entered forwarded sources set. Track entering\n         * forwardedSources will have streaming status restoring and when we start receiving video will become active,\n         * but if video is not received for certain time {@link DEFAULT_RESTORING_TIMEOUT} that track streaming status\n         * will become interrupted.\n         */\n        this._enteredForwardedSourcesTimestamp = null;\n\n        this.addEventListener = this.on = this._addEventListener.bind(this);\n        this.removeEventListener = this.off = this._removeEventListener.bind(this);\n\n        logger.debug(`New remote track created: ${this}`);\n\n        // we want to mark whether the track has been ever muted\n        // to detect ttfm events for startmuted conferences, as it can\n        // significantly increase ttfm values\n        this._hasBeenMuted = muted;\n\n        // Bind 'onmute' and 'onunmute' event handlers\n        this._bindTrackHandlers();\n        this._containerHandlers = {};\n        containerEvents.forEach(event => {\n            this._containerHandlers[event] = this._containerEventHandler.bind(this, event);\n        });\n    }\n\n    /* eslint-enable max-params */\n    /**\n     * Attaches the track handlers.\n     *\n     * @returns {void}\n     */\n    private _bindTrackHandlers(): void {\n        this.track.addEventListener('mute', () => this._onTrackMute());\n        this.track.addEventListener('unmute', () => this._onTrackUnmute());\n        this.track.addEventListener('ended', () => {\n            logger.debug(`\"onended\" event(${Date.now()}): ${this}`);\n        });\n    }\n\n    /**\n     * Overrides addEventListener method to init TrackStreamingStatus instance when there are listeners for the\n     * {@link JitsiTrackEvents.TRACK_STREAMING_STATUS_CHANGED} event.\n     *\n     * @param {string} event - event name\n     * @param {function} handler - event handler\n     */\n    private _addEventListener(event: string, handler: (...args: any[]) => void): void {\n        super.addListener(event, handler);\n\n        if (event === JitsiTrackEvents.TRACK_STREAMING_STATUS_CHANGED\n            && this.listenerCount(JitsiTrackEvents.TRACK_STREAMING_STATUS_CHANGED)\n            && !this._trackStreamingStatusImpl\n        ) {\n            this._initTrackStreamingStatus();\n            logger.debug(`Initializing track streaming status: ${this._sourceName}`);\n        }\n    }\n\n    /**\n     * Overrides removeEventListener method to dispose TrackStreamingStatus instance.\n     *\n     * @param {string} event - event name\n     * @param {function} handler - event handler\n     */\n    private _removeEventListener(event: string, handler: (...args: any[]) => void): void {\n        super.removeListener(event, handler);\n\n        if (event === JitsiTrackEvents.TRACK_STREAMING_STATUS_CHANGED\n            && !this.listenerCount(JitsiTrackEvents.TRACK_STREAMING_STATUS_CHANGED)\n        ) {\n            this._disposeTrackStreamingStatus();\n            logger.debug(`Disposing track streaming status: ${this._sourceName}`);\n        }\n    }\n\n    /**\n     * Callback invoked when the track is muted. Emits an event notifying\n     * listeners of the mute event.\n     *\n     * @private\n     * @returns {void}\n     */\n    private _onTrackMute(): void {\n        logger.debug(`\"onmute\" event(${Date.now()}): ${this}`);\n\n        // Ignore mute events that get fired on desktop tracks because of 0Hz screensharing introduced in Chromium.\n        // The sender stops sending frames if the content of the captured window doesn't change resulting in the\n        // receiver showing avatar instead of the shared content.\n        if (this.videoType === VideoType.DESKTOP) {\n            logger.debug('Ignoring mute event on desktop tracks.');\n\n            return;\n        }\n\n        this._rtc.eventEmitter.emit(RTCEvents.REMOTE_TRACK_MUTE, this);\n    }\n\n    /**\n     * Callback invoked when the track is unmuted. Emits an event notifying\n     * listeners of the mute event.\n     *\n     * @private\n     * @returns {void}\n     */\n    private _onTrackUnmute(): void {\n        logger.debug(`\"onunmute\" event(${Date.now()}): ${this}`);\n\n        this._rtc.eventEmitter.emit(RTCEvents.REMOTE_TRACK_UNMUTE, this);\n    }\n\n    /**\n     * Handles track play events.\n     */\n    private _playCallback(): void {\n        if (!this.conference.room) {\n            return;\n        }\n\n        const type = this.isVideoTrack() ? 'video' : 'audio';\n\n        const now = window.performance.now();\n\n        logger.info(`(TIME) Render ${type}:\\t`, now);\n        this.conference.getConnectionTimes()[`${type}.render`] = now;\n\n        // The conference can be started without calling GUM\n        // FIXME if there would be a module for connection times this kind\n        // of logic (gumDuration or ttfm) should end up there\n        const gumStart = window.connectionTimes['obtainPermissions.start'];\n        const gumEnd = window.connectionTimes['obtainPermissions.end'];\n        const gumDuration\n            = isValidNumber(gumEnd) && isValidNumber(gumStart) ? gumEnd - gumStart : 0;\n\n        // Subtract the muc.joined-to-session-initiate duration because jicofo\n        // waits until there are 2 participants to start Jingle sessions.\n        const ttfm = now\n            - (this.conference.getConnectionTimes()['session.initiate']\n                - this.conference.getConnectionTimes()['muc.joined'])\n            - gumDuration;\n\n        this.conference.getConnectionTimes()[`${type}.ttfm`] = ttfm;\n        logger.info(`(TIME) TTFM ${type}:\\t`, ttfm);\n\n        Statistics.sendAnalytics(createTtfmEvent(\n            {\n                'media_type': type,\n                muted: this._hasBeenMuted,\n                value: ttfm\n            }));\n\n    }\n\n    /**\n     * An event handler for events triggered by the attached container.\n     *\n     * @param {string} type - The type of the event.\n     */\n    private _containerEventHandler(type: string): void {\n        logger.debug(`${type} handler was called for a container with attached ${this}`);\n    }\n\n    /**\n     * Returns a string with a description of the current status of the track.\n     *\n     * @returns {string}\n     */\n    private _getStatus(): string {\n        const { enabled, muted, readyState } = this.track;\n\n        return `readyState: ${readyState}, muted: ${muted}, enabled: ${enabled}`;\n    }\n\n    /**\n     * Initializes trackStreamingStatusImpl.\n     */\n    private _initTrackStreamingStatus(): void {\n        const config = this.conference.options.config;\n\n        this._trackStreamingStatus = TrackStreamingStatus.ACTIVE;\n\n        this._trackStreamingStatusImpl = new TrackStreamingStatusImpl(\n            this._rtc,\n            this.conference,\n            this,\n            {\n                // These options are not public API, leaving it here only as an entry point through config for\n                // tuning up purposes. Default values should be adjusted as soon as optimal values are discovered.\n                outOfForwardedSourcesTimeout: config._peerConnStatusOutOfLastNTimeout,\n                p2pRtcMuteTimeout: config._p2pConnStatusRtcMuteTimeout,\n                rtcMuteTimeout: config._peerConnStatusRtcMuteTimeout\n            });\n\n        this._trackStreamingStatusImpl.init();\n\n        // In some edge cases, both browser 'unmute' and bridge's forwarded sources events are received before a\n        // LargeVideoUpdate is scheduled for auto-pinning a new screenshare track. If there are no layout changes and\n        // no further track events are received for the SS track, a black tile will be displayed for screenshare on\n        // stage. Fire a TRACK_STREAMING_STATUS_CHANGED event if the media is already being received for the remote\n        // track to prevent this from happening.\n        !this._trackStreamingStatusImpl.isVideoTrackFrozen()\n            && this._rtc.eventEmitter.emit(\n                JitsiTrackEvents.TRACK_STREAMING_STATUS_CHANGED,\n                this,\n                this._trackStreamingStatus);\n    }\n\n    /**\n     * Disposes trackStreamingStatusImpl and clears trackStreamingStatus.\n     */\n    private _disposeTrackStreamingStatus(): void {\n        if (this._trackStreamingStatusImpl) {\n            this._trackStreamingStatusImpl.dispose();\n            this._trackStreamingStatusImpl = null;\n            this._trackStreamingStatus = null;\n        }\n    }\n\n    /**\n     * Called when the track has been attached to a new container.\n     *\n     * @param {HTMLElement} container the HTML container which can be 'video' or 'audio' element.\n     * @internal\n     */\n    protected override _onTrackAttach(container: HTMLElement): void {\n        containerEvents.forEach(event => {\n            container.addEventListener(event, this._containerHandlers[event]);\n        });\n    }\n\n    /**\n     * Called when the track has been detached from a container.\n     *\n     * @param {HTMLElement} container the HTML container which can be 'video' or 'audio' element.\n     * @internal\n     */\n    protected override _onTrackDetach(container: HTMLElement): void {\n        containerEvents.forEach(event => {\n            container.removeEventListener(event, this._containerHandlers[event]);\n        });\n    }\n\n    /**\n     * Attach time to first media tracker only if there is conference and only\n     * for the first element.\n     * @param container the HTML container which can be 'video' or 'audio'\n     * element.\n     */\n    protected override _attachTTFMTracker(container: HTMLElement): void {\n        if ((ttfmTrackerAudioAttached && this.isAudioTrack())\n                || (ttfmTrackerVideoAttached && this.isVideoTrack())) {\n            return;\n        }\n\n        if (this.isAudioTrack()) {\n            ttfmTrackerAudioAttached = true;\n        }\n        if (this.isVideoTrack()) {\n            ttfmTrackerVideoAttached = true;\n        }\n\n        container.addEventListener('canplay', this._playCallback.bind(this));\n    }\n\n    /**\n     * Changes the video type of the track.\n     *\n     * @param {string} type - The new video type(\"camera\", \"desktop\").\n     * @internal\n     */\n    _setVideoType(type: VideoType): void {\n        if (this.videoType === type) {\n            return;\n        }\n        this.videoType = type;\n        this.emit(JitsiTrackEvents.TRACK_VIDEOTYPE_CHANGED, type);\n    }\n\n    /**\n     * Updates track's streaming status.\n     *\n     * @param {string} state the current track streaming state. {@link TrackStreamingStatus}.\n     * @internal\n     */\n    _setTrackStreamingStatus(status: TrackStreamingStatus): void {\n        this._trackStreamingStatus = status;\n    }\n\n    /**\n     * Clears the timestamp of when the track entered forwarded sources.\n     * @internal\n     */\n    _clearEnteredForwardedSourcesTimestamp(): void {\n        this._enteredForwardedSourcesTimestamp = null;\n    }\n\n    /**\n     * Updates the timestamp of when the track entered forwarded sources.\n     *\n     * @param {number} timestamp the time in millis\n     * @internal\n     */\n    _setEnteredForwardedSourcesTimestamp(timestamp: number): void {\n        this._enteredForwardedSourcesTimestamp = timestamp;\n    }\n\n    /**\n     * Returns the timestamp of when the track entered forwarded sources.\n     *\n     * @returns {number} the time in millis\n     * @internal\n     */\n    _getEnteredForwardedSourcesTimestamp(): number | null {\n        return this._enteredForwardedSourcesTimestamp;\n    }\n\n    /**\n     * Removes attached event listeners and dispose TrackStreamingStatus .\n     *\n     * @returns {Promise}\n     */\n    override async dispose(): Promise<void> {\n        if (this.disposed) {\n            return;\n        }\n\n        this._disposeTrackStreamingStatus();\n\n        return super.dispose();\n    }\n\n    /**\n     * Sets current muted status and fires an events for the change.\n     * @param value the muted status.\n     * @internal\n     */\n    setMute(value: boolean): void {\n        if (this._muted === value) {\n            return;\n        }\n\n        if (value) {\n            this._hasBeenMuted = true;\n        }\n\n        // we can have a fake video stream\n        if (this.stream) {\n            this.stream.muted = value;\n        }\n\n        this._muted = value;\n\n        logger.info(`Mute ${this}: ${value}`);\n        this.emit(JitsiTrackEvents.TRACK_MUTE_CHANGED, this);\n    }\n\n    /**\n     * Returns the current muted status of the track.\n     * @returns {boolean|*|JitsiRemoteTrack.muted} <tt>true</tt> if the track is\n     * muted and <tt>false</tt> otherwise.\n     */\n    override isMuted(): boolean {\n        return this._muted;\n    }\n\n    /**\n     * Returns the participant id which owns the track.\n     *\n     * @returns {string} the id of the participants. It corresponds to the\n     * Colibri endpoint id/MUC nickname in case of Jitsi-meet.\n     */\n    getParticipantId(): string {\n        return this.ownerEndpointId;\n    }\n\n    /**\n     * Returns the synchronization source identifier (SSRC) of this remote\n     * track.\n     *\n     * @override\n     * @returns {number} the SSRC of this remote track.\n     */\n    override getSsrc() {\n        return this._ssrc;\n    }\n\n\n    /**\n     * Returns the tracks source name\n     *\n     * @override\n     * @returns {string} the track's source name\n     */\n    override getSourceName(): string {\n        return this._sourceName;\n    }\n\n    /**\n     * Update the properties when the track is remapped to another source.\n     *\n     * @param {string} owner The endpoint ID of the new owner.\n     * @internal\n     */\n    setOwner(owner: string): void {\n        this.ownerEndpointId = owner;\n    }\n\n    /**\n     * Sets the name of the source associated with the remote track.\n     *\n     * @override\n     * @param {string} name - The source name to be associated with the track.\n     * @internal\n     */\n    override setSourceName(name: string): void {\n        this._sourceName = name;\n    }\n\n    /**\n     * Returns track's streaming status.\n     *\n     * @returns {string} the streaming status <tt>TrackStreamingStatus</tt> of the track. Returns null\n     * if trackStreamingStatusImpl hasn't been initialized.\n     *\n     * {@link TrackStreamingStatus}.\n     */\n    getTrackStreamingStatus(): Nullable<TrackStreamingStatus> {\n        return this._trackStreamingStatus;\n    }\n\n    /**\n     * Creates a text representation of this remote track instance.\n     * @return {string}\n     */\n    override toString(): string {\n        return `RemoteTrack[userID: ${this.getParticipantId()}, type: ${this.getType()}, ssrc: ${\n            this.getSsrc()}, p2p: ${this.isP2P}, sourceName: ${this._sourceName}, status: {${this._getStatus()}}]`;\n    }\n}\n","/**\n * Enumeration of the scalability modes supported by the video encoders.\n * For more information, check https://www.w3.org/TR/webrtc-svc/#dependencydiagrams*\n *\n * enum VideoEncoderScalabilityMode {\n *  L1T3: string;\n *  L2T3: string;\n *  L2T3_KEY: string;\n *  L3T3: string;\n *  L3T3_KEY: string;\n * }\n */\nexport enum VideoEncoderScalabilityMode {\n\n    /**\n     * L1T3 mode: 1-layer spatial and 3-layer temporal scalabilty encoding.\n     */\n    L1T3 = 'L1T3',\n\n    /**\n     * L2T2 mode: 2-layer spatial and 3-layer temporal scalability encoding.\n     */\n    L2T3 = 'L2T3',\n\n    /**\n     * L2T3_KEY mode: 2-layer spatial and 3-layer temporal scalability K-SVC encoding.\n     */\n    L2T3_KEY = 'L2T3_KEY',\n\n    /**\n     * L3T3 mode: -layer spatial and 3-layer temporal scalability encoding.\n     */\n    L3T3 = 'L3T3',\n\n    /**\n     * L3T3_Key mode: 3-layer spatial and 3-layer temporal scalability K-SVC encoding.\n     */\n    L3T3_KEY = 'L3T3_KEY'\n}\n","import { getLogger } from '@jitsi/logger';\nimport { cloneDeep } from 'lodash-es';\nimport transform, { type SessionDescription } from 'sdp-transform';\n\nimport { CodecMimeType } from '../../service/RTC/CodecMimeType';\nimport { MediaDirection } from '../../service/RTC/MediaDirection';\nimport { MediaType } from '../../service/RTC/MediaType';\nimport {\n    SIM_LAYERS,\n    SSRC_GROUP_SEMANTICS,\n    STANDARD_CODEC_SETTINGS,\n    VIDEO_QUALITY_LEVELS,\n    VIDEO_QUALITY_SETTINGS\n} from '../../service/RTC/StandardVideoQualitySettings';\nimport { VideoEncoderScalabilityMode } from '../../service/RTC/VideoEncoderScalabilityMode';\nimport { VideoType } from '../../service/RTC/VideoType';\nimport browser from '../browser';\nimport SDPUtil from '../sdp/SDPUtil';\n\nimport JitsiLocalTrack from './JitsiLocalTrack';\nimport TraceablePeerConnection, { IAudioQuality, IRTCRtpEncodingParameters, IVideoQuality } from './TraceablePeerConnection';\n\nconst logger = getLogger('rtc:TPCUtils');\nconst VIDEO_CODECS = [ CodecMimeType.AV1, CodecMimeType.H264, CodecMimeType.VP8, CodecMimeType.VP9 ];\n\n\n// Codec configuration interface (reusable for all video codecs)\nexport interface ICodecConfig {\n    maxBitratesVideo?: {\n        [key: string]: number;\n    };\n    scalabilityModeEnabled?: boolean;\n    useKSVC?: boolean;\n    useSimulcast?: boolean;\n}\n\nexport interface ITPCUtilsOptions {\n    audioQuality?: IAudioQuality;\n    isP2P?: boolean;\n    videoQuality?: IVideoQuality;\n}\n\n/**\n * Handles all the utility functions for the TraceablePeerConnection class, like calculating the encoding parameters,\n * determining the media direction, calculating bitrates based on the current codec settings, etc.\n */\nexport class TPCUtils {\n    private pc: TraceablePeerConnection;\n    private options: ITPCUtilsOptions;\n    /**\n     * @internal\n     */\n    codecSettings: IVideoQuality;\n    /**\n     * Creates a new instance for a given TraceablePeerConnection\n     *\n     * @param peerconnection - the tpc instance for which we have utility functions.\n     * @param options - additional options that can be passed to the utility functions.\n     * @param options.audioQuality - the audio quality settings that are used to calculate the audio codec parameters.\n     * @param options.isP2P - whether the connection is a P2P connection.\n     * @param options.videoQuality - the video quality settings that are used to calculate the encoding parameters.\n     */\n    constructor(peerconnection: TraceablePeerConnection, options: ITPCUtilsOptions = {}) {\n        this.pc = peerconnection;\n        this.options = options;\n        this.codecSettings = cloneDeep(STANDARD_CODEC_SETTINGS);\n\n        /**\n         * Reads videoQuality settings from config.js and overrides the code defaults for video codecs.\n         */\n        const videoQualitySettings = this.options.videoQuality;\n\n        if (videoQualitySettings) {\n            for (const codec of VIDEO_CODECS) {\n                const codecConfig = videoQualitySettings[codec];\n                const bitrateSettings = codecConfig?.maxBitratesVideo\n\n                    // Read the deprecated settings for max bitrates.\n                    ?? (videoQualitySettings?.maxbitratesvideo?.[codec.toUpperCase()]);\n\n                if (bitrateSettings) {\n                    const settings = Object.values(VIDEO_QUALITY_SETTINGS);\n\n                    [ ...settings, 'ssHigh' ].forEach(value => {\n                        if (bitrateSettings[value]) {\n                            this.codecSettings[codec].maxBitratesVideo[value] = bitrateSettings[value];\n                        }\n                    });\n                }\n\n                if (!codecConfig) {\n                    continue; // eslint-disable-line no-continue\n                }\n\n                const scalabilityModeEnabled = this.codecSettings[codec].scalabilityModeEnabled\n                    && (typeof codecConfig.scalabilityModeEnabled === 'undefined'\n                        || codecConfig.scalabilityModeEnabled);\n\n                if (scalabilityModeEnabled) {\n                    typeof codecConfig.useSimulcast !== 'undefined'\n                        && (this.codecSettings[codec].useSimulcast = codecConfig.useSimulcast);\n                    typeof codecConfig.useKSVC !== 'undefined'\n                        && (this.codecSettings[codec].useKSVC = codecConfig.useKSVC);\n                } else {\n                    this.codecSettings[codec].scalabilityModeEnabled = false;\n                }\n            }\n        }\n    }\n\n    /**\n     * Calculates the configuration of the active encoding when the browser sends only one stream, i,e,, when there is\n     * no spatial scalability configure (p2p) or when it is running in full SVC mode.\n     *\n     * @param {JitsiLocalTrack} localVideoTrack - The local video track.\n     * @param {CodecMimeType} codec - The video codec.\n     * @param {number} newHeight - The resolution that needs to be configured for the local video track.\n     * @returns {Object} configuration.\n     * @private\n     */\n    private _calculateActiveEncodingParams(localVideoTrack: JitsiLocalTrack, codec: CodecMimeType, newHeight: number): IRTCRtpEncodingParameters {\n        const codecBitrates = this.codecSettings[codec].maxBitratesVideo;\n        const trackCaptureHeight = localVideoTrack.getCaptureResolution();\n        const effectiveNewHeight = newHeight > trackCaptureHeight ? trackCaptureHeight : newHeight;\n        const desktopShareBitrate = this.options.videoQuality?.desktopbitrate || codecBitrates.ssHigh;\n        const isScreenshare = localVideoTrack.getVideoType() === VideoType.DESKTOP;\n        let scalabilityMode = this.codecSettings[codec].useKSVC\n            ? VideoEncoderScalabilityMode.L3T3_KEY : VideoEncoderScalabilityMode.L3T3;\n        const { height, level } = VIDEO_QUALITY_LEVELS.find(lvl => lvl.height <= effectiveNewHeight);\n        let maxBitrate;\n        let scaleResolutionDownBy = SIM_LAYERS[2].scaleFactor;\n\n        if (this._isScreenshareBitrateCapped(localVideoTrack)) {\n            scalabilityMode = VideoEncoderScalabilityMode.L1T3;\n            maxBitrate = desktopShareBitrate;\n        } else if (isScreenshare) {\n            maxBitrate = codecBitrates.ssHigh;\n        } else {\n            maxBitrate = codecBitrates[level];\n            effectiveNewHeight && (scaleResolutionDownBy = trackCaptureHeight / effectiveNewHeight);\n\n            if (height !== effectiveNewHeight) {\n                logger.debug(`Quality level with height=${height} was picked when requested height=${newHeight} for`\n                    + `track with capture height=${trackCaptureHeight}`);\n            }\n        }\n\n        const config: IRTCRtpEncodingParameters = {\n            active: effectiveNewHeight > 0,\n            maxBitrate,\n            rid: undefined,\n            scalabilityMode,\n            scaleResolutionDownBy\n        };\n\n        if (!config.active || isScreenshare) {\n            return config;\n        }\n\n        // Configure the sender to send all 3 spatial layers for resolutions 720p and higher.\n        switch (level) {\n        case VIDEO_QUALITY_SETTINGS.ULTRA:\n        case VIDEO_QUALITY_SETTINGS.FULL:\n        case VIDEO_QUALITY_SETTINGS.HIGH:\n            config.scalabilityMode = this.codecSettings[codec].useKSVC\n                ? VideoEncoderScalabilityMode.L3T3_KEY : VideoEncoderScalabilityMode.L3T3;\n            break;\n        case VIDEO_QUALITY_SETTINGS.STANDARD:\n            config.scalabilityMode = this.codecSettings[codec].useKSVC\n                ? VideoEncoderScalabilityMode.L2T3_KEY : VideoEncoderScalabilityMode.L2T3;\n            break;\n        default:\n            config.scalabilityMode = VideoEncoderScalabilityMode.L1T3;\n        }\n\n        return config;\n    }\n\n    /**\n     * Returns the codecs in the current order of preference in the SDP provided.\n     *\n     * @param {SessionDescription} parsedSdp the parsed SDP object.\n     * @returns {Array<CodecMimeType>}\n     * @private\n     */\n    private _getConfiguredVideoCodecsImpl(parsedSdp: SessionDescription): CodecMimeType[] {\n        const mLine = parsedSdp.media.find(m => m.type === MediaType.VIDEO);\n        const codecs = new Set(mLine.rtp\n            .filter(pt => pt.codec.toLowerCase() !== 'rtx')\n            .map(pt => pt.codec.toLowerCase()));\n\n        return Array.from(codecs) as CodecMimeType[];\n    }\n\n    /**\n     * The startup configuration for the stream encodings that are applicable to the video stream when a new sender is\n     * created on the peerconnection. The initial config takes into account the differences in browser's simulcast\n     * implementation.\n     *\n     * Encoding parameters:\n     * active - determine the on/off state of a particular encoding.\n     * maxBitrate - max. bitrate value to be applied to that particular encoding based on the encoding's resolution and\n     *  config.js videoQuality settings if applicable.\n     * rid - Rtp Stream ID that is configured for a particular simulcast stream.\n     * scaleResolutionDownBy - the factor by which the encoding is scaled down from the original resolution of the\n     *  captured video.\n     *\n     * @param {JitsiLocalTrack} localTrack - The local video track.\n     * @param {String} codec - The codec currently in use.\n     * @returns {Array<Object>} - The initial configuration for the stream encodings.\n     * @private\n     */\n    private _getVideoStreamEncodings(localTrack: JitsiLocalTrack, codec: string): Partial<IRTCRtpEncodingParameters>[] {\n        const captureResolution = localTrack.getCaptureResolution();\n        const codecBitrates = this.codecSettings[codec].maxBitratesVideo;\n        const videoType = localTrack.getVideoType();\n        let effectiveScaleFactors = SIM_LAYERS.map(sim => sim.scaleFactor);\n        let cameraMaxbitrate;\n\n        if (videoType === VideoType.CAMERA) {\n            const { level } = VIDEO_QUALITY_LEVELS.find(lvl => lvl.height <= captureResolution);\n\n            cameraMaxbitrate = codecBitrates[level];\n            if (level === VIDEO_QUALITY_SETTINGS.ULTRA) {\n                effectiveScaleFactors[1] = 6.0; // 360p\n                effectiveScaleFactors[0] = 12.0; // 180p\n            } else if (level === VIDEO_QUALITY_SETTINGS.FULL) {\n                effectiveScaleFactors[1] = 3.0; // 360p\n                effectiveScaleFactors[0] = 6.0; // 180p\n            }\n        }\n        const maxBitrate = videoType === VideoType.DESKTOP\n            ? codecBitrates.ssHigh : cameraMaxbitrate;\n        let effectiveBitrates = [ codecBitrates.low, codecBitrates.standard, maxBitrate ];\n\n        // The SSRCs on older versions of Firefox are reversed in SDP, i.e., they have resolution order of 1:2:4 as\n        // opposed to Chromium and other browsers. This has been reverted in Firefox 117 as part of the below commit.\n        // https://hg.mozilla.org/mozilla-central/rev/b0348f1f8d7197fb87158ba74542d28d46133997\n        // This revert seems to be applied only to camera tracks, the desktop stream encodings still have the\n        // resolution order of 4:2:1.\n        if (browser.isFirefox()\n            && !browser.supportsScalabilityModeAPI()\n            && (videoType === VideoType.DESKTOP || browser.isVersionLessThan(117))) {\n            effectiveBitrates = effectiveBitrates.reverse();\n            effectiveScaleFactors = effectiveScaleFactors.reverse();\n        }\n\n        const standardSimulcastEncodings: IRTCRtpEncodingParameters[] = [\n            {\n                active: this.pc.videoTransferActive,\n                maxBitrate: effectiveBitrates[0],\n                rid: SIM_LAYERS[0].rid,\n                scaleResolutionDownBy: effectiveScaleFactors[0]\n            },\n            {\n                active: this.pc.videoTransferActive,\n                maxBitrate: effectiveBitrates[1],\n                rid: SIM_LAYERS[1].rid,\n                scaleResolutionDownBy: effectiveScaleFactors[1]\n            },\n            {\n                active: this.pc.videoTransferActive,\n                maxBitrate: effectiveBitrates[2],\n                rid: SIM_LAYERS[2].rid,\n                scaleResolutionDownBy: effectiveScaleFactors[2]\n            }\n        ];\n\n        if (this.codecSettings[codec].scalabilityModeEnabled) {\n            // Configure all 3 encodings when simulcast is requested through config.js for AV1 and VP9 and for H.264\n            // always since that is the only supported mode when DD header extension is negotiated for H.264.\n            if (this.codecSettings[codec].useSimulcast || codec === CodecMimeType.H264) {\n                for (const encoding of standardSimulcastEncodings) {\n                    encoding.scalabilityMode = VideoEncoderScalabilityMode.L1T3;\n                }\n\n                return standardSimulcastEncodings;\n            }\n\n            // Configure only one encoding for the SVC mode.\n            return [\n                {\n                    active: this.pc.videoTransferActive,\n                    maxBitrate: effectiveBitrates[2],\n                    rid: SIM_LAYERS[0].rid,\n                    scalabilityMode: this.codecSettings[codec].useKSVC\n                        ? VideoEncoderScalabilityMode.L3T3_KEY : VideoEncoderScalabilityMode.L3T3,\n                    scaleResolutionDownBy: effectiveScaleFactors[2]\n                },\n                {\n                    active: false,\n                    maxBitrate: 0\n                },\n                {\n                    active: false,\n                    maxBitrate: 0\n                }\n            ];\n        }\n\n        return standardSimulcastEncodings;\n    }\n\n    /**\n     * Returns a boolean indicating whether the video encoder is running in full SVC mode, i.e., it sends only one\n     * video stream that has both temporal and spatial scalability.\n     *\n     * @param {CodecMimeType} codec - The video codec in use.\n     * @returns boolean - true if the video encoder is running in full SVC mode, false otherwise.\n     * @private\n     */\n    private _isRunningInFullSvcMode(codec: CodecMimeType): boolean {\n        return (codec === CodecMimeType.VP9 || codec === CodecMimeType.AV1)\n            && this.codecSettings[codec].scalabilityModeEnabled\n            && !this.codecSettings[codec].useSimulcast;\n    }\n\n    /**\n     * Returns a boolean indicating whether the bitrate needs to be capped for the local video track if it happens to\n     * be a screenshare track. The lower spatial layers for screensharing are disabled when low fps screensharing is in\n     * progress. Sending all three streams often results in the browser suspending the high resolution in low b/w and\n     * and low cpu conditions, especially on the low end machines. Suspending the low resolution streams ensures that\n     * the highest resolution stream is available always. Safari is an exception here since it does not send the\n     * desktop stream at all if only the high resolution stream is enabled.\n     *\n     * @param {JitsiLocalTrack} localVideoTrack - The local video track.\n     * @returns {boolean} - true if the bitrate needs to be capped for the screenshare track, false otherwise.\n     * @private\n     */\n    private _isScreenshareBitrateCapped(localVideoTrack: JitsiLocalTrack): boolean {\n        return localVideoTrack.getVideoType() === VideoType.DESKTOP\n            && this.pc._capScreenshareBitrate\n            && !browser.isWebKitBased();\n    }\n\n    /**\n     * Returns the calculated active state of the stream encodings based on the frame height requested for the send\n     * stream. All the encodings that have a resolution lower than the frame height requested will be enabled.\n     *\n     * @param {JitsiLocalTrack} localVideoTrack The local video track.\n     * @param {CodecMimeType} codec - The codec currently in use.\n     * @param {number} newHeight The resolution requested for the video track.\n     * @returns {Array<boolean>}\n     * @internal\n     */\n    calculateEncodingsActiveState(localVideoTrack: JitsiLocalTrack, codec: CodecMimeType, newHeight: number): boolean[] {\n        const height = localVideoTrack.getCaptureResolution();\n        const videoStreamEncodings = this._getVideoStreamEncodings(localVideoTrack, codec);\n        const encodingsState = videoStreamEncodings\n        .map(encoding => height / encoding.scaleResolutionDownBy)\n        .map((frameHeight, idx) => {\n            let activeState = false;\n\n            // When video is suspended on the media session.\n            if (!this.pc.videoTransferActive) {\n                return activeState;\n            }\n\n            // Single video stream.\n            if (!this.pc.isSpatialScalabilityOn() || this._isRunningInFullSvcMode(codec)) {\n                const { active } = this._calculateActiveEncodingParams(localVideoTrack, codec, newHeight);\n\n                return idx === 0 ? active : activeState;\n            }\n\n            if (newHeight > 0) {\n                if (localVideoTrack.getVideoType() === VideoType.CAMERA) {\n                    activeState = frameHeight <= newHeight\n\n                        // Keep the LD stream enabled even when the LD stream's resolution is higher than of the\n                        // requested resolution. This can happen when camera is captured at high resolutions like 4k\n                        // but the requested resolution is 180. Since getParameters doesn't give us information about\n                        // the resolutions of the simulcast encodings, we have to rely on our initial config for the\n                        // simulcast streams.\n                        || videoStreamEncodings[idx]?.scaleResolutionDownBy === SIM_LAYERS[0].scaleFactor;\n                } else {\n                    // For screenshare, keep the HD layer enabled always and the lower layers only for high fps\n                    // screensharing.\n                    activeState = videoStreamEncodings[idx].scaleResolutionDownBy === SIM_LAYERS[2].scaleFactor\n                        || !this._isScreenshareBitrateCapped(localVideoTrack);\n                }\n            }\n\n            return activeState;\n        });\n\n        return encodingsState;\n    }\n\n    /**\n     * Returns the calculated max bitrates that need to be configured on the stream encodings based on the video\n     * type and other considerations associated with screenshare.\n     *\n     * @param {JitsiLocalTrack} localVideoTrack The local video track.\n     * @param {CodecMimeType} codec - The codec currently in use.\n     * @param {number} newHeight The resolution requested for the video track.\n     * @returns {Array<number>}\n     * @internal\n     */\n    calculateEncodingsBitrates(localVideoTrack: JitsiLocalTrack, codec: CodecMimeType, newHeight: number): number[] {\n        const codecBitrates = this.codecSettings[codec].maxBitratesVideo;\n        const desktopShareBitrate = this.options.videoQuality?.desktopbitrate || codecBitrates.ssHigh;\n        const encodingsBitrates = this._getVideoStreamEncodings(localVideoTrack, codec)\n        .map((encoding, idx) => {\n            let bitrate = encoding.maxBitrate;\n\n            // Single video stream.\n            if (!this.pc.isSpatialScalabilityOn() || this._isRunningInFullSvcMode(codec)) {\n                const { maxBitrate } = this._calculateActiveEncodingParams(localVideoTrack, codec, newHeight);\n\n                return idx === 0 ? maxBitrate : 0;\n            }\n\n            // Multiple video streams.\n            if (this._isScreenshareBitrateCapped(localVideoTrack)) {\n                bitrate = desktopShareBitrate;\n            }\n\n            return bitrate;\n        });\n\n        return encodingsBitrates;\n    }\n\n    /**\n     * Returns the calculated scalability modes for the video encodings when scalability modes are supported.\n     *\n     * @param {JitsiLocalTrack} localVideoTrack The local video track.\n     * @param {CodecMimeType} codec - The codec currently in use.\n     * @param {number} maxHeight The resolution requested for the video track.\n     * @returns {Optional<Array<VideoEncoderScalabilityMode>>}\n     * @internal\n     */\n    calculateEncodingsScalabilityMode(localVideoTrack: JitsiLocalTrack, codec: CodecMimeType, maxHeight: number): Optional<Optional<VideoEncoderScalabilityMode>[]> {\n        if (!this.codecSettings[codec].scalabilityModeEnabled) {\n            return;\n        }\n\n        // Use LIT3 for P2P wherever its supported.\n        if (!this.pc.isSpatialScalabilityOn()) {\n            return [ VideoEncoderScalabilityMode.L1T3 ];\n        }\n\n        // Default modes for simulcast.\n        const scalabilityModes = [\n            VideoEncoderScalabilityMode.L1T3,\n            VideoEncoderScalabilityMode.L1T3,\n            VideoEncoderScalabilityMode.L1T3\n        ];\n\n        // Full SVC mode.\n        if (this._isRunningInFullSvcMode(codec)) {\n            const { scalabilityMode }\n                = this._calculateActiveEncodingParams(localVideoTrack, codec, maxHeight);\n\n            scalabilityModes[0] = scalabilityMode as VideoEncoderScalabilityMode;\n            scalabilityModes[1] = undefined;\n            scalabilityModes[2] = undefined;\n\n            return scalabilityModes;\n        }\n\n        return scalabilityModes;\n    }\n\n    /**\n     * Returns the scale factor that needs to be applied on the local video stream based on the desired resolution\n     * and the codec in use.\n     *\n     * @param {JitsiLocalTrack} localVideoTrack The local video track.\n     * @param {CodecMimeType} codec - The codec currently in use.\n     * @param {number} maxHeight The resolution requested for the video track.\n     * @returns {Array<float>}\n     * @internal\n     */\n    calculateEncodingsScaleFactor(localVideoTrack: JitsiLocalTrack, codec: CodecMimeType, maxHeight: number): number[] {\n        if (this.pc.isSpatialScalabilityOn() && this.isRunningInSimulcastMode(codec)) {\n            return this._getVideoStreamEncodings(localVideoTrack, codec)\n                .map(encoding => encoding.scaleResolutionDownBy);\n        }\n\n        // Single video stream.\n        const { scaleResolutionDownBy }\n            = this._calculateActiveEncodingParams(localVideoTrack, codec, maxHeight);\n\n        return [ scaleResolutionDownBy, undefined, undefined ];\n    }\n\n    /**\n     * Ensures that the ssrcs associated with a FID ssrc-group appear in the correct order, i.e., the primary ssrc\n     * first and the secondary rtx ssrc later. This is important for unified plan since we have only one FID group per\n     * media description.\n     * @param {Object} description the webRTC session description instance for the remote description.\n     * @returns {Object} the modified webRTC session description instance.\n     * @internal\n     */\n    ensureCorrectOrderOfSsrcs(description: RTCSessionDescription) {\n        const parsedSdp = transform.parse(description.sdp);\n\n        parsedSdp.media.forEach(mLine => {\n            if (mLine.type === MediaType.AUDIO) {\n                return;\n            }\n            if (!mLine.ssrcGroups?.length) {\n                return;\n            }\n            let reorderedSsrcs = [];\n\n            const ssrcs = new Set();\n\n            mLine.ssrcGroups.map(group =>\n                group.ssrcs\n                    .split(' ')\n                    .filter(Boolean)\n                    .forEach(ssrc => ssrcs.add(ssrc))\n            );\n\n            ssrcs.forEach(ssrc => {\n                const sources = mLine.ssrcs.filter(source => source.id.toString() === ssrc);\n\n                reorderedSsrcs = reorderedSsrcs.concat(sources);\n            });\n            mLine.ssrcs = reorderedSsrcs;\n        });\n\n        return new RTCSessionDescription({\n            sdp: transform.write(parsedSdp),\n            type: description.type\n        });\n    }\n\n    /**\n     * Returns the codec that is configured on the client as the preferred video codec for the given local video track.\n     *\n     * @param {JitsiLocalTrack} localTrack - The local video track.\n     * @returns {CodecMimeType} The codec that is set as the preferred codec for the given local video track.\n     * @internal\n     */\n    getConfiguredVideoCodec(localTrack: JitsiLocalTrack): CodecMimeType | string {\n        const localVideoTrack = localTrack ?? this.pc.getLocalVideoTracks()[0];\n        const rtpSender = this.pc.findSenderForTrack(localVideoTrack.getTrack());\n\n        if (this.pc.usesCodecSelectionAPI() && rtpSender) {\n            // added any to remove the subsequrnt @ts-ignore comments\n            const { encodings } = rtpSender.getParameters() as any;\n\n            if (encodings[0].codec) {\n                return encodings[0].codec.mimeType.split('/')[1].toLowerCase();\n            }\n        }\n\n        const sdp = this.pc.remoteDescription?.sdp;\n\n        if (!sdp) {\n            return CodecMimeType.VP8;\n        }\n        const parsedSdp = transform.parse(sdp);\n        const mLine = parsedSdp.media\n            .find(m => m.mid.toString() === this.pc.localTrackTransceiverMids.get(localVideoTrack.rtcId));\n        const payload = mLine.payloads.split(' ')[0];\n        const { codec } = mLine.rtp.find(rtp => rtp.payload === Number(payload));\n\n        if (codec) {\n            return Object.values(CodecMimeType).find(value => value === codec.toLowerCase());\n        }\n\n        return CodecMimeType.VP8;\n    }\n\n    /**\n     * Returns the codecs in the current order of preference as configured on the peerconnection.\n     *\n     * @param {string} - The local SDP to be used.\n     * @returns {Array}\n     * @internal\n     */\n    getConfiguredVideoCodecs(sdp: Optional<string>): CodecMimeType[] {\n        const currentSdp = sdp ?? this.pc.localDescription?.sdp;\n\n        if (!currentSdp) {\n            return [];\n        }\n        const parsedSdp = transform.parse(currentSdp);\n\n        return this._getConfiguredVideoCodecsImpl(parsedSdp);\n    }\n\n    /**\n     * Returns the desired media direction for the given media type based on the current state of the peerconnection.\n     *\n     * @param {MediaType} mediaType - The media type for which the desired media direction is to be obtained.\n     * @param {boolean} isAddOperation - Whether the direction is being set for a source add operation.\n     * @returns {MediaDirection} - The desired media direction for the given media type.\n     * @internal\n     */\n    getDesiredMediaDirection(mediaType: MediaType, isAddOperation = false): MediaDirection {\n        const hasLocalSource = this.pc.getLocalTracks(mediaType).length > 0;\n\n        if (isAddOperation) {\n            return hasLocalSource ? MediaDirection.SENDRECV : MediaDirection.SENDONLY;\n        }\n\n        return hasLocalSource ? MediaDirection.RECVONLY : MediaDirection.INACTIVE;\n    }\n\n    /**\n     * Obtains stream encodings that need to be configured on the given track based\n     * on the track media type and the simulcast setting.\n     * @param {JitsiLocalTrack} localTrack\n     * @internal\n     */\n    getStreamEncodings(localTrack: JitsiLocalTrack): Partial<IRTCRtpEncodingParameters>[] {\n        if (localTrack.isAudioTrack()) {\n            return [ { active: this.pc.audioTransferActive } ];\n        }\n        const codec = this.getConfiguredVideoCodec(localTrack);\n\n        if (this.pc.isSpatialScalabilityOn()) {\n            return this._getVideoStreamEncodings(localTrack, codec);\n        }\n\n        return [ {\n            active: this.pc.videoTransferActive,\n            maxBitrate: this.codecSettings[codec].maxBitratesVideo.high\n        } ];\n    }\n\n    /**\n     * Injects a 'SIM' ssrc-group line for simulcast into the given session description object to make Jicofo happy.\n     * This is needed only for Firefox since it does not generate it when simulcast is enabled but we run the check\n     * on all browsers just in case as it would break the functionality otherwise.\n     *\n     * @param desc A session description object (with 'type' and 'sdp' fields)\n     * @return A session description object with its sdp field modified to contain an inject ssrc-group for simulcast.\n     * @internal\n     */\n    injectSsrcGroupForSimulcast(desc: RTCSessionDescription): RTCSessionDescription {\n        const sdp = transform.parse(desc.sdp);\n        const video = sdp.media.find(mline => mline.type === 'video');\n\n        // Check if the browser supports RTX, add only the primary ssrcs to the SIM group if that is the case.\n        video.ssrcGroups = video.ssrcGroups || [];\n        const fidGroups = video.ssrcGroups.filter(group => group.semantics === SSRC_GROUP_SEMANTICS.FID);\n\n        if (video.simulcast || video.simulcast_03) {\n            const ssrcs = [];\n\n            if (fidGroups?.length) {\n                fidGroups.forEach(group => {\n                    ssrcs.push(group.ssrcs.split(' ')[0]);\n                });\n            } else {\n                video.ssrcs.forEach(ssrc => {\n                    if (ssrc.attribute === 'msid') {\n                        ssrcs.push(ssrc.id);\n                    }\n                });\n            }\n            if (video.ssrcGroups.find(group => group.semantics === SSRC_GROUP_SEMANTICS.SIM)) {\n                // Group already exists, no need to do anything\n                return desc;\n            }\n\n            // Add a SIM group for every 3 FID groups.\n            for (let i = 0; i < ssrcs.length; i += 3) {\n                const simSsrcs = ssrcs.slice(i, i + 3);\n\n                video.ssrcGroups.push({\n                    semantics: SSRC_GROUP_SEMANTICS.SIM,\n                    ssrcs: simSsrcs.join(' ')\n                });\n            }\n        }\n\n        return new RTCSessionDescription({\n            sdp: transform.write(sdp),\n            type: desc.type\n        });\n    }\n\n    /**\n     * Takes in a *unified plan* offer and inserts the appropriate parameters for adding simulcast receive support.\n     * @param {Object} desc - A session description object\n     * @param {String} desc.type - the type (offer/answer)\n     * @param {String} desc.sdp - the sdp content\n     * @internal\n     * @return {Object} A session description (same format as above) object with its sdp field modified to advertise\n     * simulcast receive support.\n     */\n    insertUnifiedPlanSimulcastReceive(desc: RTCSessionDescription): RTCSessionDescription {\n        // a=simulcast line is not needed on browsers where we SDP munging is used for enabling on simulcast.\n        // Remove this check when the client switches to RID/MID based simulcast on all browsers.\n        if (browser.usesSdpMungingForSimulcast()) {\n            return desc;\n        }\n        const rids = [\n            {\n                direction: 'recv',\n                id: SIM_LAYERS[0].rid\n            },\n            {\n                direction: 'recv',\n                id: SIM_LAYERS[1].rid\n            },\n            {\n                direction: 'recv',\n                id: SIM_LAYERS[2].rid\n            }\n        ];\n\n        const ridLine = rids.map(val => val.id).join(';');\n        const simulcastLine = `recv ${ridLine}`;\n        const sdp = transform.parse(desc.sdp);\n        const mLines = sdp.media.filter(m => m.type === MediaType.VIDEO);\n        const senderMids = Array.from(this.pc.localTrackTransceiverMids.values());\n\n        mLines.forEach((mLine, idx) => {\n            // Make sure the simulcast recv line is only set on video descriptions that are associated with senders.\n            if (senderMids.find(sender => mLine.mid.toString() === sender.toString()) || idx === 0) {\n                if (!mLine.simulcast_03 || !mLine.simulcast) {\n                    mLine.rids = rids;\n\n                    // eslint-disable-next-line camelcase\n                    mLine.simulcast_03 = {\n                        value: simulcastLine\n                    };\n                }\n            } else {\n                mLine.rids = undefined;\n                mLine.simulcast = undefined;\n\n                // eslint-disable-next-line camelcase\n                mLine.simulcast_03 = undefined;\n            }\n        });\n\n        return new RTCSessionDescription({\n            sdp: transform.write(sdp),\n            type: desc.type\n        });\n    }\n\n    /**\n     * Returns a boolean indicating whether the video encoder is running in Simulcast mode, i.e., three encodings need\n     * to be configured in 4:2:1 resolution order with temporal scalability.\n     *\n     * @param {CodecMimeType} videoCodec - The video codec in use.\n     * @returns {boolean}\n     * @internal\n     */\n    isRunningInSimulcastMode(videoCodec: CodecMimeType): boolean {\n        if (!this.codecSettings?.[videoCodec]) {\n            // If codec settings are not available, assume no simulcast\n            return false;\n        }\n\n        return videoCodec === CodecMimeType.VP8 // VP8 always\n\n            // For FF: scalabilityModeEnabled is not supported and we have to use simulcast.\n            // For other browsers we use K-SVC mode for VP9 when no scalability mode is set. Although\n            // only one outbound-rtp stream is present, three separate encodings have to be configured.\n            || (!this.codecSettings[videoCodec].scalabilityModeEnabled && videoCodec === CodecMimeType.VP9)\n\n            // FF uses simulcast with AV1.\n            || (!this.codecSettings[videoCodec].scalabilityModeEnabled\n                && this.codecSettings[videoCodec].useSimulcast\n                && videoCodec === CodecMimeType.AV1)\n\n            // When scalability is enabled, always for H.264, and only when simulcast is explicitly enabled via\n            // config.js for VP9 and AV1 since full SVC is the default mode for these 2 codecs.\n            || (this.codecSettings[videoCodec].scalabilityModeEnabled\n                && (videoCodec === CodecMimeType.H264 || this.codecSettings[videoCodec].useSimulcast));\n    }\n\n    /**\n     * Munges the session description to ensure that the codec order is as per the preferred codec settings.\n     *\n     * @param {SessionDescription} parsedSdp that needs to be munged\n     * @returns {SessionDescription} the munged SDP.\n     * @internal\n     */\n    mungeCodecOrder(parsedSdp: SessionDescription): SessionDescription {\n        const codecSettings = this.pc.codecSettings;\n\n        if (!codecSettings) {\n            return parsedSdp;\n        }\n\n        const mungedSdp = parsedSdp;\n        const { isP2P } = this.options;\n        const mLines = mungedSdp.media.filter(m => m.type === codecSettings.mediaType);\n\n        for (const mLine of mLines) {\n            const currentCodecs = this._getConfiguredVideoCodecsImpl(mungedSdp);\n\n            for (const codec of currentCodecs) {\n                if (isP2P) {\n                    // 1. Strip the high profile H264 codecs on all clients. macOS started offering encoder for H.264\n                    //   level 5.2 but a decoder only for level 3.1. Therfore, strip all main and high level codecs for\n                    //   H.264.\n                    // 2. There are multiple VP9 payload types generated by the browser, more payload types are added\n                    //   if the endpoint doesn't have a local video source. Therefore, strip all the high profile codec\n                    //   variants for VP9 so that only one payload type for VP9 is negotiated between the peers.\n                    if (codec === CodecMimeType.H264 || codec === CodecMimeType.VP9) {\n                        SDPUtil.stripCodec(mLine, codec, true /* high profile */);\n                    }\n\n                    // Do not negotiate ULPFEC and RED either.\n                    if (codec === CodecMimeType.ULPFEC || codec === CodecMimeType.RED) {\n                        SDPUtil.stripCodec(mLine, codec, false);\n                    }\n                }\n            }\n\n            // Reorder the codecs based on the preferred settings.\n            if (!this.pc.usesCodecSelectionAPI()) {\n                for (const codec of codecSettings.codecList.slice().reverse()) {\n                    SDPUtil.preferCodec(mLine, codec, isP2P);\n                }\n            }\n        }\n\n        return mungedSdp;\n    }\n\n    /**\n     * Munges the stereo flag as well as the opusMaxAverageBitrate in the SDP, based on values set through config.js,\n     * if present.\n     *\n     * @param {SessionDescription} parsedSdp that needs to be munged.\n     * @returns {SessionDescription} the munged SDP.\n     * @internal\n     */\n    mungeOpus(parsedSdp: SessionDescription): SessionDescription {\n        const { audioQuality } = this.options;\n\n        if (!audioQuality?.enableOpusDtx && !audioQuality?.stereo && !audioQuality?.opusMaxAverageBitrate) {\n            return parsedSdp;\n        }\n\n        const mungedSdp = parsedSdp;\n        const mLines = mungedSdp.media.filter(m => m.type === MediaType.AUDIO);\n\n        for (const mLine of mLines) {\n            const { payload } = mLine.rtp.find(protocol => protocol.codec === CodecMimeType.OPUS);\n\n            if (!payload) {\n                // eslint-disable-next-line no-continue\n                continue;\n            }\n\n            let fmtpOpus = mLine.fmtp.find(protocol => protocol.payload === payload);\n\n            if (!fmtpOpus) {\n                fmtpOpus = {\n                    config: '',\n                    payload\n                };\n            }\n\n            const fmtpConfig = transform.parseParams(fmtpOpus.config);\n            let sdpChanged = false;\n\n            if (audioQuality?.stereo) {\n                fmtpConfig.stereo = 1;\n                sdpChanged = true;\n            }\n\n            if (audioQuality?.opusMaxAverageBitrate) {\n                fmtpConfig.maxaveragebitrate = audioQuality.opusMaxAverageBitrate;\n                sdpChanged = true;\n            }\n\n            // On Firefox, the OpusDtx enablement has no effect\n            if (!browser.isFirefox() && audioQuality?.enableOpusDtx) {\n                fmtpConfig.usedtx = 1;\n                sdpChanged = true;\n            }\n\n            if (!sdpChanged) {\n                // eslint-disable-next-line no-continue\n                continue;\n            }\n\n            let mungedConfig = '';\n\n            for (const key of Object.keys(fmtpConfig)) {\n                mungedConfig += `${key}=${fmtpConfig[key]}; `;\n            }\n\n            fmtpOpus.config = mungedConfig.trim();\n        }\n\n        return mungedSdp;\n    }\n\n    /**\n     * Munges the session SDP by setting the max bitrates on the video m-lines when VP9 K-SVC codec is in use.\n     *\n     * @param {SessionDescription} parsedSdp that needs to be munged.\n     * @param {boolean} isLocalSdp - Whether the max bitrate (via b=AS line in SDP) is set on local SDP.\n     * @returns {SessionDescription} The munged SDP.\n     * @internal\n     */\n    setMaxBitrates(parsedSdp: SessionDescription, isLocalSdp = false): SessionDescription {\n        const pcCodecSettings = this.pc.codecSettings;\n\n        if (!pcCodecSettings) {\n            return parsedSdp;\n        }\n\n        // Find all the m-lines associated with the local sources.\n        const mungedSdp = parsedSdp;\n        const direction = isLocalSdp ? MediaDirection.RECVONLY : MediaDirection.SENDONLY;\n        const mLines = mungedSdp.media.filter(m => m.type === MediaType.VIDEO && m.direction !== direction);\n        const currentCodec = pcCodecSettings.codecList[0];\n        const codecScalabilityModeSettings = this.codecSettings[currentCodec];\n\n        for (const mLine of mLines) {\n            const isDoingVp9KSvc = currentCodec === CodecMimeType.VP9\n                && !codecScalabilityModeSettings.scalabilityModeEnabled;\n            const localTrack = this.pc.getLocalVideoTracks()\n                .find(track => this.pc.localTrackTransceiverMids.get(track.rtcId) === mLine.mid.toString());\n\n            if (localTrack\n                && (isDoingVp9KSvc\n\n                    // Setting bitrates in the SDP for SVC codecs is no longer needed in the newer versions where\n                    // maxBitrates from the RTCRtpEncodingParameters directly affect the target bitrate for the encoder.\n                    || (this._isRunningInFullSvcMode(currentCodec) && !this.pc.usesCodecSelectionAPI()))) {\n                let maxBitrate;\n\n                if (localTrack.getVideoType() === VideoType.DESKTOP) {\n                    maxBitrate = codecScalabilityModeSettings.maxBitratesVideo.ssHigh;\n                } else {\n                    const { level } = VIDEO_QUALITY_LEVELS.find(lvl => lvl.height <= localTrack.getCaptureResolution());\n\n                    maxBitrate = codecScalabilityModeSettings.maxBitratesVideo[level];\n                }\n\n                const limit = Math.floor(maxBitrate / 1000);\n\n                // Use only the highest spatial layer bitrates for now as there is no API available yet for configuring\n                // the bitrates on the individual SVC layers.\n                mLine.bandwidth = [ {\n                    limit,\n                    type: 'AS'\n                } ];\n            } else {\n                // Clear the bandwidth limit in SDP when VP9 is no longer the preferred codec.\n                // This is needed on react native clients as react-native-webrtc returns the\n                // SDP that the application passed instead of returning the SDP off the native side.\n                // This line automatically gets cleared on web on every renegotiation.\n                mLine.bandwidth = undefined;\n            }\n        }\n\n        return mungedSdp;\n    }\n}\n","import { getLogger } from '@jitsi/logger';\nimport { cloneDeep } from 'lodash-es';\nimport transform from 'sdp-transform';\n\nimport { CodecMimeType } from '../../service/RTC/CodecMimeType';\nimport { MediaDirection } from '../../service/RTC/MediaDirection';\nimport { MediaType } from '../../service/RTC/MediaType';\nimport { RTCEvents } from '../../service/RTC/RTCEvents';\nimport { SignalingEvents } from '../../service/RTC/SignalingEvents';\nimport SignalingLayer, { getSourceIndexFromSourceName } from '../../service/RTC/SignalingLayer';\nimport { SSRC_GROUP_SEMANTICS, VIDEO_QUALITY_LEVELS } from '../../service/RTC/StandardVideoQualitySettings';\nimport { VideoEncoderScalabilityMode } from '../../service/RTC/VideoEncoderScalabilityMode';\nimport { VideoType } from '../../service/RTC/VideoType';\nimport { AnalyticsEvents } from '../../service/statistics/AnalyticsEvents';\nimport RTCStats from '../RTCStats/RTCStats';\nimport { RTCStatsEvents } from '../RTCStats/RTCStatsEvents';\nimport browser from '../browser';\nimport FeatureFlags from '../flags/FeatureFlags';\nimport LocalSdpMunger from '../sdp/LocalSdpMunger';\nimport RtxModifier from '../sdp/RtxModifier';\nimport SDP from '../sdp/SDP';\nimport SDPUtil from '../sdp/SDPUtil';\nimport SdpSimulcast from '../sdp/SdpSimulcast';\nimport { SdpTransformWrap } from '../sdp/SdpTransformUtil';\nimport { ISsrcGroupInfo, ISsrcInfo } from '../sdp/constants';\nimport Statistics from '../statistics/statistics';\nimport EventEmitter from '../util/EventEmitter';\nimport { isValidNumber } from '../util/MathUtil';\n\nimport JitsiLocalTrack from './JitsiLocalTrack';\nimport JitsiRemoteTrack from './JitsiRemoteTrack';\nimport RTC from './RTC';\nimport RTCUtils from './RTCUtils';\nimport { SS_DEFAULT_FRAME_RATE } from './ScreenObtainer';\nimport { ICodecConfig, TPCUtils } from './TPCUtils';\n\n\nconst logger = getLogger('rtc:TraceablePeerConnection');\nconst DEGRADATION_PREFERENCE_CAMERA = 'maintain-framerate';\nconst DEGRADATION_PREFERENCE_DESKTOP = 'maintain-resolution';\n\n/**\n * Interface for legacy WebRTC stats report (pre-standard)\n */\ninterface ILegacyStatsReport {\n    id: string;\n    names: () => string[];\n    stat: (name: string) => string | number;\n}\n\n/**\n * Interface for legacy stats response with result() method\n */\ninterface ILegacyStatsResponse {\n    result: () => ILegacyStatsReport[];\n}\nexport interface IRTCRtpEncodingParameters extends RTCRtpEncodingParameters {\n    codec?: RTCRtpCodec;\n    degradationPreference?: string;\n    rid: string;\n    // Firefox only supports the non-standard way.\n    scalabilityMode?: VideoEncoderScalabilityMode;\n}\n\n/**\n * Union type for getStats() return value (legacy vs modern)\n */\ntype StatsResponse = RTCStatsReport | ILegacyStatsResponse;\n\ninterface ITouchToneRequest {\n    duration: number;\n    interToneGap: number;\n    tones: string;\n}\n\nexport interface ITPCSourceInfo {\n    groups?: Array<ISsrcGroupInfo>;\n    mediaType?: MediaType;\n    msid?: string;\n    ssrcList?: Array<string>;\n    ssrcs?: Array<string>;\n    videoType?: VideoType;\n}\n\nexport interface ITPCOptions {\n    audioQuality: IAudioQuality;\n    capScreenshareBitrate: boolean;\n    codecSettings: ICodecSettings;\n    disableRtx: boolean;\n    disableSimulcast: boolean;\n    maxstats: number;\n    startSilent: boolean;\n    usesCodecSelectionAPI: boolean;\n    videoQuality: IVideoQuality;\n}\n\nexport interface IAudioQuality {\n    enableOpusDtx?: boolean;\n    opusMaxAverageBitrate?: number;\n    stereo?: boolean;\n}\n\nexport interface IVideoQuality {\n    desktopbitrate?: number;\n    maxBitratesVideo?: Record<string, number>;\n    preferredCodec?: CodecMimeType;\n    [CodecMimeType.AV1]?: ICodecConfig;\n    [CodecMimeType.H264]?: ICodecConfig;\n    [CodecMimeType.VP8]?: ICodecConfig;\n    [CodecMimeType.VP9]?: ICodecConfig;\n    maxbitratesvideo?: {\n        [codec: string]: {\n            [quality: string]: number;\n        };\n    };\n}\n\nexport interface ICodecSettings {\n    codecList: CodecMimeType[];\n    mediaType?: MediaType;\n    screenshareCodec?: CodecMimeType;\n}\n\ninterface IUpdateLogEntry {\n    time: Date;\n    type: string;\n    value: string;\n}\n\ninterface IStatsEntry {\n    endTime: Date;\n    startTime: Date;\n    times: number[];\n    values: any[];\n}\n\ninterface ITraceFunction {\n    (what: string, info?: string, opts?: any): void;\n}\n\n\n/* eslint-disable max-params */\n/**\n * Creates new instance of 'TraceablePeerConnection'.\n */\nexport default class TraceablePeerConnection {\n    // Private properties\n    private _dtmfSender?: RTCDTMFSender;\n    private _dtmfTonesQueue: ITouchToneRequest[];\n    private _dtlsTransport?: RTCDtlsTransport;\n    private _usesCodecSelectionAPI: boolean;\n    private _senderMaxHeights: Map<string, number>;\n    private _localSsrcMap?: Map<string, ISsrcInfo>;\n    private _remoteSsrcMap: Map<string, ITPCSourceInfo>;\n    private _lastVideoSenderUpdatePromise: Promise<void>;\n    private _localUfrag: string;\n    private _pcId: string;\n    private _remoteUfrag: string;\n    private _signalingLayer: SignalingLayer;\n    /**\n     * @internal\n     */\n    _capScreenshareBitrate: boolean;\n    /**\n     * @internal\n     */\n    _hasHadAudioTrack: boolean;\n    /**\n     * @internal\n     */\n    _hasHadVideoTrack: boolean;\n\n    // public property declarations\n    audioTransferActive: boolean;\n    videoTransferActive: boolean;\n    id: number;\n    isP2P: boolean;\n    remoteTracksBySsrc: Map<number, JitsiRemoteTrack>;\n    remoteTracks: Map<string, Map<MediaType, Set<JitsiRemoteTrack>>>;\n    localTracks: Map<number, JitsiLocalTrack>;\n    localSSRCs: Map<number, ISsrcInfo>;\n    remoteSSRCs: Set<number>;\n    remoteSources: Map<string, number>;\n    options: ITPCOptions;\n    peerconnection: RTCPeerConnection;\n    tpcUtils: TPCUtils;\n    updateLog: Array<IUpdateLogEntry>;\n    stats: Record<string, IStatsEntry>;\n    statsinterval?: number;\n    simulcast: SdpSimulcast;\n    localSdpMunger: LocalSdpMunger;\n    eventEmitter: EventEmitter;\n    rtxModifier: RtxModifier;\n    localTrackTransceiverMids: Map<number, string>;\n    codecSettings: ICodecSettings;\n    maxstats: number;\n    rtc: RTC;\n    trace: ITraceFunction;\n    onicecandidate?: ((event: RTCPeerConnectionIceEvent) => void);\n    onTrack: (evt: RTCTrackEvent) => void;\n    onsignalingstatechange?: ((event: Event) => void);\n    oniceconnectionstatechange?: ((event: Event) => void);\n    onnegotiationneeded?: ((event: Event) => void);\n    onconnectionstatechange?: ((event: Event) => void);\n    ondatachannel?: ((event: RTCDataChannelEvent) => void);\n\n    /**\n     * @param {RTC} rtc the instance of <tt>RTC</tt> service\n     * @param {number} id the peer connection id assigned by the parent RTC module.\n     * @param {SignalingLayer} signalingLayer the signaling layer instance\n     * @param {object} pcConfig The {@code RTCConfiguration} to use for the WebRTC peer connection.\n     * @param {object} constraints WebRTC 'PeerConnection' constraints\n     * @param {boolean} isP2P indicates whether or not the new instance will be used in a peer to peer connection.\n     * @param {object} options <tt>TracablePeerConnection</tt> config options.\n     * @param {Object} options.audioQuality - Quality settings to applied on the outbound audio stream.\n     * @param {boolean} options.capScreenshareBitrate if set to true, lower layers will be disabled for screenshare.\n     * @param {Array<CodecMimeType>} options.codecSettings - codec settings to be applied for video streams.\n     * @param {boolean} options.disableSimulcast if set to 'true' will disable the simulcast.\n     * @param {boolean} options.disableRtx if set to 'true' will disable the RTX.\n     * @param {boolean} options.enableInsertableStreams set to true when the insertable streams constraints is to be\n     * enabled on the PeerConnection.\n     * @param {boolean} options.forceTurnRelay If set to true, the browser will generate only Relay ICE candidates.\n     * @param {boolean} options.startSilent If set to 'true' no audio will be sent or received.\n     * @param {Object} options.videoQuality - Quality settings to applied on the outbound video streams.\n     *\n     * FIXME: initially the purpose of TraceablePeerConnection was to be able to\n     * debug the peer connection. Since many other responsibilities have been added\n     * it would make sense to extract a separate class from it and come up with\n     * a more suitable name.\n     *\n     * @constructor\n     */\n    constructor(\n            rtc: RTC,\n            id: number,\n            signalingLayer: SignalingLayer,\n            pcConfig: RTCConfiguration,\n            constraints: { optional?: any[]; },\n            isP2P: boolean,\n            options: ITPCOptions\n    ) {\n        /**\n         * Indicates whether or not this peer connection instance is actively\n         * sending/receiving audio media. When set to <tt>false</tt> the SDP audio\n         * media direction will be adjusted to 'inactive' in order to suspend\n         * the transmission.\n         * @type {boolean}\n         * @internal\n         */\n        this.audioTransferActive = !(options.startSilent === true);\n\n        /**\n         * The DTMF sender instance used to send DTMF tones.\n         *\n         * @type {RTCDTMFSender|undefined}\n         * @private\n         */\n        this._dtmfSender = undefined;\n\n        /**\n         * @typedef {Object} TouchToneRequest\n         * @property {string} tones - The DTMF tones string as defined by\n         * {@code RTCDTMFSender.insertDTMF}, 'tones' argument.\n         * @property {number} duration - The amount of time in milliseconds that\n         * each DTMF should last.\n         * @property {string} interToneGap - The length of time in miliseconds to\n         * wait between tones.\n         */\n        /**\n         * TouchToneRequests which are waiting to be played. This queue is filled\n         * if there are touch tones currently being played.\n         *\n         * @type {Array<TouchToneRequest>}\n         * @private\n         */\n        this._dtmfTonesQueue = [];\n\n        /**\n         * Indicates whether or not this peer connection instance is actively\n         * sending/receiving video media. When set to <tt>false</tt> the SDP video\n         * media direction will be adjusted to 'inactive' in order to suspend\n         * the transmission.\n         * @type {boolean}\n         * @internal\n         */\n        this.videoTransferActive = true;\n\n        /**\n         * The parent instance of RTC service which created this\n         * <tt>TracablePeerConnection</tt>.\n         * @type {RTC}\n         */\n        this.rtc = rtc;\n\n        /**\n         * The peer connection identifier assigned by the RTC module.\n         * @type {number}\n         */\n        this.id = id;\n\n        /**\n         * RTCStats identifier for this peerconnection.\n         */\n        this._pcId = `PC_${this.id}`;\n\n        /**\n         * Indicates whether or not this instance is used in a peer to peer\n         * connection.\n         * @type {boolean}\n         */\n        this.isP2P = isP2P;\n\n        /**\n         * A map that holds remote tracks signaled on the peerconnection indexed by their SSRC.\n         * @type {Map<number, JitsiRemoteTrack>}\n         */\n        this.remoteTracksBySsrc = new Map();\n\n        /**\n         * The map holds remote tracks associated with this peer connection.\n         * It maps user's JID to media type and a set of\n         * remote tracks.\n         * @type {Map<string, Map<MediaType, Set<JitsiRemoteTrack>>>}\n         */\n        this.remoteTracks = new Map();\n\n        /**\n         * A map which stores local tracks mapped by {@link JitsiLocalTrack.rtcId}\n         * @type {Map<number, JitsiLocalTrack>}\n         */\n        this.localTracks = new Map();\n\n        /**\n         * @typedef {Object} TPCGroupInfo\n         * @property {string} semantics the SSRC groups semantics\n         * @property {Array<number>} ssrcs group's SSRCs in order where the first\n         * one is group's primary SSRC, the second one is secondary (RTX) and so\n         * on...\n         */\n        /**\n         * @typedef {Object} TPCSSRCInfo\n         * @property {Array<number>} ssrcs an array which holds all track's SSRCs\n         * @property {Array<TPCGroupInfo>} groups an array stores all track's SSRC\n         * groups\n         */\n        /**\n         * Holds the info about local track's SSRCs mapped per their\n         * {@link JitsiLocalTrack.rtcId}\n         * @type {Map<number, TPCSSRCInfo>}\n         */\n        this.localSSRCs = new Map();\n\n        /**\n         * The set of remote SSRCs seen so far.\n         * Distinguishes new SSRCs from those that have been remapped.\n         * @type {Set<number>}\n         */\n        this.remoteSSRCs = new Set();\n\n        /**\n         * Mapping of source-names and their associated SSRCs that have been signaled by the JVB.\n         * @type {Map<string, number>}\n         */\n        this.remoteSources = new Map();\n\n        /**\n         * The local ICE username fragment for this session.\n         */\n        this._localUfrag = null;\n\n        /**\n         * The remote ICE username fragment for this session.\n         */\n        this._remoteUfrag = null;\n\n        /**\n         * The DTLS transport object for the PeerConnection.\n         * Note: this assume only one shared transport exists because we bundled\n         *       all streams on the same underlying transport.\n         */\n        this._dtlsTransport = null;\n\n        /**\n         * The signaling layer which operates this peer connection.\n         * @type {SignalingLayer}\n         */\n        this._signalingLayer = signalingLayer;\n\n        // SignalingLayer listeners\n        this._peerVideoTypeChanged = this._peerVideoTypeChanged.bind(this);\n        this._signalingLayer.on(SignalingEvents.PEER_VIDEO_TYPE_CHANGED, this._peerVideoTypeChanged);\n\n        this._peerMutedChanged = this._peerMutedChanged.bind(this);\n        this._signalingLayer.on(SignalingEvents.PEER_MUTED_CHANGED, this._peerMutedChanged);\n        this.options = options;\n\n        // Setup SignalingLayer listeners for source-name based events.\n        this._signalingLayer.on(SignalingEvents.SOURCE_MUTED_CHANGED,\n            (sourceName, isMuted) => this._sourceMutedChanged(sourceName, isMuted));\n        this._signalingLayer.on(SignalingEvents.SOURCE_VIDEO_TYPE_CHANGED,\n            (sourceName, videoType) => this._sourceVideoTypeChanged(sourceName, videoType));\n\n        // Make sure constraints is properly formatted in order to provide information about whether or not this\n        // connection is P2P to rtcstats.\n        const safeConstraints = constraints || {};\n\n        safeConstraints.optional = safeConstraints.optional || [];\n\n        // The `optional` parameter needs to be of type array, otherwise chrome will throw an error.\n        // Firefox and Safari just ignore it.\n        if (Array.isArray(safeConstraints.optional)) {\n            safeConstraints.optional.push({ rtcStatsSFUP2P: this.isP2P });\n        } else {\n            logger.warn('Optional param is not an array, rtcstats p2p data is omitted.');\n        }\n\n        // RTCPeerConnection constructor only accepts RTCConfiguration\n        // @ts-ignore\n        this.peerconnection = new RTCPeerConnection(pcConfig, safeConstraints);\n\n        this.tpcUtils = new TPCUtils(this, {\n            audioQuality: options.audioQuality,\n            isP2P: this.isP2P,\n            videoQuality: options.videoQuality\n        });\n        this.updateLog = [];\n        this.stats = {};\n        this.statsinterval = null;\n\n        /**\n         * Flag used to indicate if low fps screenshare is desired.\n         */\n        this._capScreenshareBitrate = this.options.capScreenshareBitrate;\n\n        /**\n         * Codec preferences set for the peerconnection through config.js.\n         */\n        this.codecSettings = this.options.codecSettings;\n\n        /**\n         * Flag used to indicate if RTCRtpTransceiver#setCodecPreferences is to be used instead of SDP\n         * munging for codec selection.\n         */\n        browser.supportsCodecPreferences()\n            && logger.info('Using RTCRtpTransceiver#setCodecPreferences for codec selection');\n\n        /**\n         * Flag used to indicate if the codecs are configured using the codec selection API without having the need to\n         * trigger a renegotiation for the change to be effective.\n         */\n        this._usesCodecSelectionAPI = this.options.usesCodecSelectionAPI;\n\n        /**\n         * Indicates whether an audio track has ever been added to the peer connection.\n         */\n        this._hasHadAudioTrack = false;\n\n        /**\n         * Indicates whether a video track has ever been added to the peer connection.\n         */\n        this._hasHadVideoTrack = false;\n\n        /**\n         * @type {number} The max number of stats to keep in this.stats. Limit to\n         * 300 values, i.e. 5 minutes; set to 0 to disable\n         */\n        this.maxstats = options.maxstats;\n\n        this.simulcast = new SdpSimulcast();\n\n        /**\n         * Munges local SDP provided to the Jingle Session in order to prevent from\n         * sending SSRC updates on attach/detach and mute/unmute (for video).\n         * @type {LocalSdpMunger}\n         */\n        this.localSdpMunger = new LocalSdpMunger(this, this.rtc.getLocalEndpointId());\n\n        /**\n         * TracablePeerConnection uses RTC's eventEmitter\n         * @type {EventEmitter}\n         */\n        this.eventEmitter = rtc.eventEmitter;\n        this.rtxModifier = new RtxModifier();\n\n        /**\n         * The height constraints to be applied on the sender per local video source (source name as the key).\n         * @type {Map<string, number>}\n         */\n        this._senderMaxHeights = new Map();\n\n        /**\n         * Holds the RTCRtpTransceiver mids that the local tracks are attached to, mapped per their\n         * {@link JitsiLocalTrack.rtcId}.\n         * @type {Map<string, string>}\n         */\n        this.localTrackTransceiverMids = new Map();\n\n        /**\n         * Holds the SSRC map for the local tracks mapped by their source names.\n         *\n         * @type {Map<string, TPCSourceInfo>}\n         * @property {string} msid - The track's MSID.\n         * @property {Array<string>} ssrcs - The SSRCs associated with the track.\n         * @property {Array<TPCGroupInfo>} groups - The SSRC groups associated with the track.\n         */\n        this._localSsrcMap = null;\n\n        /**\n         * Holds the SSRC map for the remote tracks mapped by their source names.\n         *\n         * @type {Map<string, TPCSourceInfo>}\n         * @property {string} mediaType - The media type of the track.\n         * @property {string} msid - The track's MSID.\n         * @property {Array<TPCGroupInfo>} groups - The SSRC groups associated with the track.\n         * @property {Array<string>} ssrcList - The SSRCs associated with the track.\n         * @property {VideoType} videoType - The videoType of the track (undefined for audio tracks).\n         */\n        this._remoteSsrcMap = new Map();\n\n        // override as desired\n        this.trace = (what, info) => {\n            logger.trace(what, info);\n\n            this.updateLog.push({\n                time: new Date(),\n                type: what,\n                value: info || ''\n            });\n        };\n        this.onicecandidate = null;\n        this.peerconnection.onicecandidate = event => {\n            this.trace(\n                'onicecandidate',\n                JSON.stringify(event.candidate, null, ' '));\n\n            if (this.onicecandidate !== null) {\n                this.onicecandidate(event);\n            }\n        };\n\n        this.onTrack = evt => {\n            const stream = evt.streams[0];\n\n            this._remoteTrackAdded(stream, evt.track, evt.transceiver);\n            stream.addEventListener('removetrack', e => {\n                this._remoteTrackRemoved(stream, e.track);\n            });\n        };\n        this.peerconnection.addEventListener('track', this.onTrack);\n\n        this.onsignalingstatechange = null;\n        this.peerconnection.onsignalingstatechange = event => {\n            this.trace('onsignalingstatechange', this.signalingState);\n            if (this.onsignalingstatechange !== null) {\n                this.onsignalingstatechange(event);\n            }\n        };\n        this.oniceconnectionstatechange = null;\n        this.peerconnection.oniceconnectionstatechange = event => {\n            this.trace('oniceconnectionstatechange', this.iceConnectionState);\n            if (this.oniceconnectionstatechange !== null) {\n                this.oniceconnectionstatechange(event);\n            }\n        };\n        this.onnegotiationneeded = null;\n        this.peerconnection.onnegotiationneeded = event => {\n            this.trace('onnegotiationneeded');\n            if (this.onnegotiationneeded !== null) {\n                this.onnegotiationneeded(event);\n            }\n        };\n        this.onconnectionstatechange = null;\n        this.peerconnection.onconnectionstatechange = event => {\n            this.trace('onconnectionstatechange', this.connectionState);\n            if (this.onconnectionstatechange !== null) {\n                this.onconnectionstatechange(event);\n            }\n        };\n        this.ondatachannel = null;\n        this.peerconnection.ondatachannel = event => {\n            this.trace('ondatachannel');\n            if (this.ondatachannel !== null) {\n                this.ondatachannel(event);\n            }\n        };\n\n        if (this.maxstats) {\n            this.statsinterval = window.setInterval(() => {\n                this.getStats().then((stats: StatsResponse) => {\n                    if (typeof (stats as ILegacyStatsResponse)?.result === 'function') {\n                        const results = (stats as ILegacyStatsResponse).result();\n\n                        for (let i = 0; i < results.length; ++i) {\n                            const res = results[i];\n\n                            res.names().forEach(name => {\n                                this._processStat(res, name, res.stat(name));\n                            });\n                        }\n                    } else {\n                        (stats as RTCStatsReport).forEach(r => this._processStat(r, '', r));\n                    }\n                });\n            }, 1000);\n        }\n\n        this._lastVideoSenderUpdatePromise = Promise.resolve();\n\n        logger.info(`Create new ${this}`);\n    }\n\n\n    /**\n     * Returns a string representation of a SessionDescription object.\n     */\n    static dumpSDP = function(description: Optional<Nullable<RTCSessionDescription>>): string {\n        if (!description?.sdp) {\n            return '';\n        }\n\n        return `type: ${description.type}\\r\\n${description.sdp}`;\n    };\n\n    /**\n     * Handles remote track mute / unmute events.\n     * @param {string} endpointId the track owner's identifier (MUC nickname)\n     * @param {MediaType} mediaType \"audio\" or \"video\"\n     * @param {boolean} isMuted the new mute state\n     * @private\n     */\n    private _peerMutedChanged(endpointId: string, mediaType: MediaType, isMuted: boolean): void {\n        // Check if endpointId is a value to avoid doing action on all remote tracks\n        if (!endpointId) {\n            logger.error(`${this} On peerMuteChanged - no endpoint ID`);\n\n            return;\n        }\n        const track = this.getRemoteTracks(endpointId, mediaType);\n\n        if (track.length) {\n            // NOTE 1 track per media type is assumed\n            track[0].setMute(isMuted);\n        }\n    }\n\n    /**\n     * Handles remote source videoType changed events.\n     *\n     * @param {string} sourceName - The name of the remote source.\n     * @param {boolean} isMuted - The new value.\n     */\n    private _sourceVideoTypeChanged(sourceName: string, videoType: VideoType): void {\n        const track = this.getRemoteTracks().slice().reverse().find(t => t.getSourceName() === sourceName);\n\n        if (!track) {\n            return;\n        }\n\n        track._setVideoType(videoType);\n    }\n\n\n    /**\n     * Configures the RTCRtpEncodingParameters of the outbound rtp stream associated with the given track.\n     *\n     * @param {JitsiLocalTracj} localTrack - The local track whose outbound stream needs to be configured.\n     * @returns {Promise} - A promise that resolves when the operation is successful, rejected otherwise.\n     */\n    private _configureSenderEncodings = async (localTrack: JitsiLocalTrack): Promise<void> => {\n        const mediaType = localTrack.getType();\n        const transceiver = localTrack?.track && localTrack.getOriginalStream()\n            ? this.peerconnection.getTransceivers().find(t => t.sender?.track?.id === localTrack.getTrackId())\n            : this.peerconnection.getTransceivers().find(t => t.receiver?.track?.kind === mediaType);\n        const parameters = transceiver?.sender?.getParameters() as RTCRtpSendParameters;\n\n        // Resolve if the encodings are not available yet. This happens immediately after the track is added to the\n        // peerconnection on chrome in unified-plan. It is ok to ignore and not report the error here since the\n        // action that triggers 'addTrack' (like unmute) will also configure the encodings and set bitrates after that.\n        if (!parameters?.encodings?.length) {\n            return;\n        }\n\n        parameters.encodings = this.tpcUtils.getStreamEncodings(localTrack) as RTCRtpEncodingParameters[];\n        await transceiver.sender.setParameters(parameters);\n    };\n\n    /**\n     * Enables/disables the streams by changing the active field on RTCRtpEncodingParameters for a given RTCRtpSender.\n     *\n     * @param {RTCRtpSender} sender - the sender associated with a MediaStreamTrack.\n     * @param {boolean} enable - whether the streams needs to be enabled or disabled.\n     * @returns {Promise} - A promise that resolves when the operation is successful, rejected otherwise.\n     */\n    private _enableSenderEncodings = async (sender: RTCRtpSender, enable: boolean): Promise<void> => {\n        const parameters: RTCRtpSendParameters = sender.getParameters() as RTCRtpSendParameters;\n\n        if (parameters?.encodings?.length) {\n            for (const encoding of parameters.encodings) {\n                encoding.active = enable;\n            }\n        }\n\n        await sender.setParameters(parameters);\n    };\n\n\n    /**\n     * Returns the list of RTCRtpReceivers created for the source of the given media type associated with\n     * the set of remote endpoints specified.\n     * @param {Array<string>} endpoints list of the endpoints\n     * @param {string} mediaType 'audio' or 'video'\n     * @returns {Array<RTCRtpReceiver>} list of receivers created by the peerconnection.\n     */\n    private _getReceiversByEndpointIds(endpoints: string[], mediaType: MediaType): RTCRtpReceiver[] {\n        let remoteTracks = [];\n        let receivers = [];\n\n        for (const endpoint of endpoints) {\n            remoteTracks = remoteTracks.concat(this.getRemoteTracks(endpoint, mediaType));\n        }\n\n        // Get the ids of the MediaStreamTracks associated with each of these remote tracks.\n        const remoteTrackIds = remoteTracks.map(remote => remote.track?.id);\n\n        receivers = this.peerconnection.getReceivers()\n            .filter(receiver => receiver.track\n                && receiver.track.kind === mediaType\n                && remoteTrackIds.find(trackId => trackId === receiver.track.id));\n\n        return receivers;\n    }\n\n\n    /**\n     * Handles {@link SignalingEvents.PEER_VIDEO_TYPE_CHANGED}\n     * @param {string} endpointId the video owner's ID (MUC nickname)\n     * @param {VideoType} videoType the new value\n     * @private\n     */\n    private _peerVideoTypeChanged(endpointId: string, videoType: VideoType): void {\n        // Check if endpointId has a value to avoid action on random track\n        if (!endpointId) {\n            logger.error(`${this} No endpointID on peerVideoTypeChanged`);\n\n            return;\n        }\n        const videoTrack = this.getRemoteTracks(endpointId, MediaType.VIDEO);\n\n        if (videoTrack.length) {\n            // NOTE 1 track per media type is assumed\n            videoTrack[0]._setVideoType(videoType);\n        }\n    }\n\n\n    /**\n     * Adjusts the media direction on the remote description based on availability of local and remote sources in a p2p\n     * media connection.\n     *\n     * @param {RTCSessionDescription} remoteDescription the WebRTC session description\n     *  instance for the remote description.\n     * @returns the transformed remoteDescription.\n     * @private\n     */\n    private _adjustRemoteMediaDirection(remoteDescription: RTCSessionDescription): RTCSessionDescription {\n        const transformer = new SdpTransformWrap(remoteDescription?.sdp);\n\n        [ MediaType.AUDIO, MediaType.VIDEO ].forEach(mediaType => {\n            const media = transformer.selectMedia(mediaType);\n            const localSources = this.getLocalTracks(mediaType).length;\n            const remoteSources = this.getRemoteTracks(null, mediaType).length;\n\n            media.forEach((mLine, idx) => {\n                if (localSources && localSources === remoteSources) {\n                    mLine.direction = MediaDirection.SENDRECV;\n                } else if (!localSources && !remoteSources) {\n                    mLine.direction = MediaDirection.INACTIVE;\n                } else if (!localSources) {\n                    mLine.direction = MediaDirection.SENDONLY;\n                } else if (!remoteSources) {\n                    mLine.direction = MediaDirection.RECVONLY;\n\n                // When there are 2 local sources and 1 remote source,\n                // the first m-line should be set to 'sendrecv' while\n                // the second one needs to be set to 'recvonly'.\n                } else if (localSources > remoteSources) {\n                    mLine.direction = idx ? MediaDirection.RECVONLY : MediaDirection.SENDRECV;\n\n                // When there are 2 remote sources and 1 local source, the first m-line\n                // should be set to 'sendrecv' while\n                // the second one needs to be set to 'sendonly'.\n                } else {\n                    mLine.direction = idx ? MediaDirection.SENDONLY : MediaDirection.SENDRECV;\n                }\n            });\n        });\n\n        return new RTCSessionDescription({\n            sdp: transformer.toRawSDP(),\n            type: remoteDescription.type\n        });\n    }\n\n    /**\n     * Returns the codec to be used for screenshare based on the supported codecs and the preferred codec requested\n     * through config.js setting.\n     *\n     * @param {CodecMimeType} defaultCodec - the preferred codec for video tracks.\n     * @returns {CodecMimeType}\n     */\n    private _getPreferredCodecForScreenshare(defaultCodec: CodecMimeType): CodecMimeType {\n        // Use the same codec for both camera and screenshare if the client doesn't support the codec selection API.\n        if (!this.usesCodecSelectionAPI()) {\n            return defaultCodec;\n        }\n\n        const { screenshareCodec } = this.codecSettings;\n\n        if (screenshareCodec && this.codecSettings.codecList.find(c => c === screenshareCodec)) {\n            return screenshareCodec;\n        }\n\n        // Default to AV1 for screenshare if its supported and is not overriden through config.js.\n        if (this.codecSettings.codecList.find(c => c === CodecMimeType.AV1)) {\n            return CodecMimeType.AV1;\n        }\n\n        return defaultCodec;\n    }\n\n    /**\n     * Sets up the _dtlsTransport object and initializes callbacks for it.\n     */\n    private _initializeDtlsTransport(): void {\n        // We are assuming here that we only have one bundled transport here\n        if (!this.peerconnection.getSenders || this._dtlsTransport) {\n            return;\n        }\n\n        const senders = this.peerconnection.getSenders();\n\n        if (senders.length !== 0 && senders[0].transport) {\n            this._dtlsTransport = senders[0].transport;\n\n            this._dtlsTransport.onerror = error => {\n                logger.error(`${this} DtlsTransport error: ${error}`);\n            };\n\n            this._dtlsTransport.onstatechange = () => {\n                this.trace('dtlsTransport.onstatechange', this._dtlsTransport.state);\n            };\n        }\n    }\n\n\n    /**\n     * Set the simulcast stream encoding properties on the RTCRtpSender.\n     *\n     * @param {JitsiLocalTrack} localTrack - the current track in use for which the encodings are to be set.\n     * @returns {Promise<void>} - resolved when done.\n     */\n    private _setEncodings(localTrack: JitsiLocalTrack): Promise<void> {\n        if (localTrack.getType() === MediaType.VIDEO) {\n            return this._updateVideoSenderParameters(() => this._configureSenderEncodings(localTrack));\n        }\n\n        return this._configureSenderEncodings(localTrack);\n    }\n\n    /**\n     * Munges the provided description to update the codec order, set the max bitrates (for VP9 K-SVC), set stereo flag\n     * and update the DD Header extensions for AV1.\n     *\n     * @param {RTCSessionDescription} description - The description to be munged.\n     * @returns {RTCSessionDescription} - The munged description.\n     */\n    private _mungeDescription(description: RTCSessionDescription): RTCSessionDescription {\n        this.trace('RTCSessionDescription::preTransform', TraceablePeerConnection.dumpSDP(description));\n        let mungedSdp = transform.parse(description?.sdp);\n\n        mungedSdp = this.tpcUtils.mungeOpus(mungedSdp);\n        mungedSdp = this.tpcUtils.mungeCodecOrder(mungedSdp);\n        mungedSdp = this.tpcUtils.setMaxBitrates(mungedSdp, true);\n        const mungedDescription = new RTCSessionDescription({\n            sdp: transform.write(mungedSdp),\n            type: description.type\n        });\n\n        this.trace('RTCSessionDescription::postTransform', TraceablePeerConnection.dumpSDP(mungedDescription));\n\n        return mungedDescription;\n    }\n\n\n    /**\n     * Returns a wrapped-up promise so that the setParameters() call on the RTCRtpSender\n     * for video sources are chained.\n     * This is needed on Chrome as it resets the transaction id after\n     * executing setParameters() and can affect the next on\n     * the fly updates if they are not chained.\n     * https://chromium.googlesource.com/external/webrtc/+/master/pc/rtp_sender.cc#340\n     * @param {Function} nextFunction - The function to be called when the last video sender update promise is settled.\n     * @returns {Promise}\n     */\n    private _updateVideoSenderParameters(nextFunction: () => void): Promise<void> {\n        const nextPromise = this._lastVideoSenderUpdatePromise\n            .finally(nextFunction);\n\n        this._lastVideoSenderUpdatePromise = nextPromise;\n\n        return nextPromise;\n    }\n\n    /**\n     * Configures the video stream with resolution / degradation / maximum bitrates\n     *\n     * @param {number} frameHeight - The max frame height to be imposed on the outgoing video stream.\n     * @param {JitsiLocalTrack} - The local track for which the sender constraints have to be applied.\n     * @param {preferredCodec} - The video codec that needs to be configured on\n     * the sender associated with the video source.\n     * @returns {Promise} promise that will be resolved when the operation is successful and rejected otherwise.\n     */\n    private _updateVideoSenderEncodings(frameHeight: number, localVideoTrack: JitsiLocalTrack, preferredCodec: CodecMimeType): Promise<void> {\n        const videoSender = this.findSenderForTrack(localVideoTrack.getTrack());\n        const videoType = localVideoTrack.getVideoType();\n        const isScreensharingTrack = videoType === VideoType.DESKTOP;\n\n        if (!videoSender) {\n            return Promise.resolve();\n        }\n        const parameters = videoSender.getParameters() as RTCRtpSendParameters;\n\n        if (!parameters?.encodings?.length) {\n            return Promise.resolve();\n        }\n\n        const isSharingLowFpsScreen = isScreensharingTrack && this._capScreenshareBitrate;\n\n        // Set the degradation preference.\n        const preference = isSharingLowFpsScreen\n            ? DEGRADATION_PREFERENCE_DESKTOP // Prefer resolution for low fps share.\n            : DEGRADATION_PREFERENCE_CAMERA; // Prefer frame-rate for high fps share and camera.\n\n        parameters.degradationPreference = preference;\n\n        // Calculate the encodings active state based on the resolution requested by the bridge.\n        const codecForCamera = preferredCodec ?? this.tpcUtils.getConfiguredVideoCodec(localVideoTrack);\n        const codec = isScreensharingTrack ? this._getPreferredCodecForScreenshare(codecForCamera as CodecMimeType) : codecForCamera as CodecMimeType;\n        const activeState = this.tpcUtils.calculateEncodingsActiveState(localVideoTrack, codec, frameHeight);\n        let bitrates = this.tpcUtils.calculateEncodingsBitrates(localVideoTrack, codec, frameHeight);\n        const scalabilityModes = this.tpcUtils.calculateEncodingsScalabilityMode(localVideoTrack, codec, frameHeight);\n        let scaleFactors = this.tpcUtils.calculateEncodingsScaleFactor(localVideoTrack, codec, frameHeight);\n        let needsUpdate = false;\n\n        // Do not configure 'scaleResolutionDownBy' and 'maxBitrate' for encoders running in VP9 legacy K-SVC mode since\n        // the browser sends only the lowest resolution layer when those\n        // are configured. Those fields need to be reset in\n        // case they were set when the endpoint was encoding video using the other codecs before switching over to VP9\n        // K-SVC codec.\n        if (codec === CodecMimeType.VP9\n            && browser.supportsSVC()\n            && this.isSpatialScalabilityOn()\n            && !this.tpcUtils.codecSettings[codec].scalabilityModeEnabled) {\n            scaleFactors = scaleFactors.map(() => undefined);\n            bitrates = bitrates.map(() => undefined);\n        }\n\n        for (const idx in parameters.encodings) {\n            if (parameters.encodings.hasOwnProperty(idx)) {\n                const encoding = parameters.encodings[idx] as IRTCRtpEncodingParameters;\n                const {\n                    active = undefined,\n                    codec: currentCodec = undefined,\n                    maxBitrate = undefined,\n                    scalabilityMode = undefined,\n                    scaleResolutionDownBy = undefined\n                } = encoding;\n\n                if (active !== activeState[idx]) {\n                    encoding.active = activeState[idx];\n                    needsUpdate = true;\n                }\n\n                // Firefox doesn't follow the spec and lets application specify the degradation preference on the\n                // encodings.\n                browser.isFirefox() && (encoding.degradationPreference = preference);\n\n                if (scaleResolutionDownBy !== scaleFactors[idx]) {\n                    encoding.scaleResolutionDownBy = scaleFactors[idx];\n                    needsUpdate = true;\n                }\n                if (maxBitrate !== bitrates[idx]) {\n                    encoding.maxBitrate = bitrates[idx];\n                    needsUpdate = true;\n                }\n\n                // Configure scalability mode when its supported and enabled.\n                if (scalabilityModes) {\n                    if (scalabilityMode !== scalabilityModes[idx]) {\n                        encoding.scalabilityMode = scalabilityModes[idx];\n                        needsUpdate = true;\n                    }\n                } else {\n                    encoding.scalabilityMode = undefined;\n                }\n\n                const expectedPattern = `${MediaType.VIDEO}/${codec.toUpperCase()}`;\n\n                // Configure the codec here if its supported.\n                if (this.usesCodecSelectionAPI() && currentCodec?.mimeType !== expectedPattern) {\n                    const matchingCodec = parameters.codecs.find(pt => pt.mimeType === expectedPattern);\n\n                    encoding.codec = matchingCodec;\n                    needsUpdate = true;\n\n                    Statistics.sendAnalytics(\n                        AnalyticsEvents.VIDEO_CODEC_CHANGED,\n                        {\n                            value: codec,\n                            videoType\n                        });\n                }\n            }\n        }\n\n        if (!needsUpdate) {\n            return Promise.resolve();\n        }\n\n        logger.info(`${this} setting max height=${frameHeight},encodings=${JSON.stringify(parameters.encodings)}`);\n\n        return videoSender.setParameters(parameters).then(() => {\n            localVideoTrack.maxEnabledResolution = frameHeight;\n            this.eventEmitter.emit(RTCEvents.LOCAL_TRACK_MAX_ENABLED_RESOLUTION_CHANGED, localVideoTrack);\n        });\n    }\n\n\n    /**\n     * Callback ivoked by {@code this._dtmfSender} when it has finished playing\n     * a single tone.\n     *\n     * @param {Object} event - The tonechange event which indicates what characters\n     * are left to be played for the current tone.\n     * @private\n     * @returns {void}\n     */\n    private _onToneChange(event: { tone: string; }): void {\n        // An empty event.tone indicates the current tones have finished playing.\n        // Automatically start playing any queued tones on finish.\n        if (this._dtmfSender && event.tone === '' && this._dtmfTonesQueue.length) {\n            const { tones, duration, interToneGap } = this._dtmfTonesQueue.shift();\n\n            this._dtmfSender.insertDTMF(tones, duration, interToneGap);\n        }\n    }\n\n\n    /**\n     * Internal method to create an SDP offer or answer for the peer connection.\n     * Handles codec preferences, SDP munging for simulcast and RTX, and source information extraction.\n     * @private\n     */\n    private _createOfferOrAnswer(isOffer: boolean, constraints: Optional<RTCOfferOptions>): Promise<RTCSessionDescription> {\n        const logName = isOffer ? 'Offer' : 'Answer';\n\n        this.trace(`create${logName}`, JSON.stringify(constraints, null, ' '));\n\n        const handleSuccess = (resultSdp: Nullable<RTCSessionDescription>, resolveFn: (result: RTCSessionDescription) => void, rejectFn: (error: string) => void): void => {\n            try {\n                this.trace(\n                    `create${logName}OnSuccess::preTransform`, TraceablePeerConnection.dumpSDP(resultSdp));\n\n                // Munge local description to add 3 SSRCs for video tracks when spatial scalability is enabled.\n                if (this.isSpatialScalabilityOn() && browser.usesSdpMungingForSimulcast()) {\n                    // eslint-disable-next-line no-param-reassign\n                    resultSdp = this.simulcast.mungeLocalDescription(resultSdp);\n                    this.trace(`create${logName} OnSuccess::postTransform (simulcast)`,\n                         TraceablePeerConnection.dumpSDP(resultSdp));\n                }\n\n                if (!this.options.disableRtx && browser.usesSdpMungingForSimulcast()) {\n                    // eslint-disable-next-line no-param-reassign\n                    resultSdp = new RTCSessionDescription({\n                        sdp: this.rtxModifier.modifyRtxSsrcs(resultSdp?.sdp),\n                        type: resultSdp.type\n                    });\n\n                    this.trace(\n                        `create${logName}`\n                             + 'OnSuccess::postTransform (rtx modifier)',\n                        TraceablePeerConnection.dumpSDP(resultSdp));\n                }\n\n                if (resultSdp?.sdp) {\n                    this._processAndExtractSourceInfo(resultSdp.sdp);\n                }\n\n                resolveFn(resultSdp as RTCSessionDescription);\n            } catch (e) {\n                this.trace(`create${logName}OnError`, e);\n                this.trace(`create${logName}OnError`, TraceablePeerConnection.dumpSDP(resultSdp));\n                logger.error(`${this} create${logName}OnError`, e, TraceablePeerConnection.dumpSDP(resultSdp));\n\n                rejectFn(e);\n            }\n        };\n\n        const handleFailure = (err: string, rejectFn: (error: string) => void): void => {\n            this.trace(`create${logName}OnFailure`, err);\n            rejectFn(err);\n        };\n\n        // Set the codec preference before creating an offer or answer so that the generated SDP will have\n        // the correct preference order.\n        if (browser.supportsCodecPreferences() && this.codecSettings) {\n            const { codecList, mediaType } = this.codecSettings;\n            const transceivers = this.peerconnection.getTransceivers()\n                .filter(t => t.receiver && t.receiver?.track?.kind === mediaType);\n            let capabilities = RTCRtpReceiver.getCapabilities(mediaType)?.codecs;\n\n            if (transceivers.length && capabilities) {\n                // Rearrange the codec list as per the preference order.\n                for (const codec of codecList.slice().reverse()) {\n                    // Move the desired codecs (all variations of it as well) to the beginning of the list\n                    /* eslint-disable-next-line arrow-body-style */\n                    capabilities.sort(caps => {\n                        return caps.mimeType.toLowerCase() === `${mediaType}/${codec}` ? -1 : 1;\n                    });\n                }\n\n                // Disable ulpfec and RED on the p2p peerconnection.\n                if (this.isP2P && mediaType === MediaType.VIDEO) {\n                    capabilities = capabilities\n                        .filter(caps => caps.mimeType.toLowerCase() !== `${MediaType.VIDEO}/${CodecMimeType.ULPFEC}`\n                                && caps.mimeType.toLowerCase() !== `${MediaType.VIDEO}/${CodecMimeType.RED}`);\n                }\n\n                // Apply codec preference to all the transceivers associated with the given media type.\n                for (const transceiver of transceivers) {\n                    transceiver.setCodecPreferences(capabilities);\n                }\n            }\n        }\n\n        return new Promise((resolve, reject) => {\n            let oaPromise;\n\n            if (isOffer) {\n                oaPromise = this.peerconnection.createOffer(constraints);\n            } else {\n                oaPromise = this.peerconnection.createAnswer(constraints);\n            }\n\n            oaPromise\n                .then(\n                    sdp => handleSuccess(sdp, resolve, reject),\n                    error => handleFailure(error, reject));\n        });\n    }\n\n    /**\n     * Extract primary SSRC from given {@link ITPCSSRCInfo} object.\n     * @param {ITPCSSRCInfo} ssrcObj\n     * @return {Nullable<number>} the primary SSRC or <tt>null</tt>\n     */\n    private _extractPrimarySSRC(ssrcObj: ISsrcInfo): Nullable<number> {\n        if (ssrcObj?.groups?.length) {\n            return ssrcObj.groups[0].ssrcs[0];\n        } else if (ssrcObj?.ssrcs?.length) {\n            return ssrcObj.ssrcs[0];\n        }\n\n        return null;\n    }\n\n    /**\n     * Sends a stats entry to the rtcstats server about the mute state change for local track.\n     *\n     * @param {JitsiLocalTrack} track - The local track.\n     * @param {boolean} muted - muted state.\n     */\n    _sendRtcStatsEvent(track: JitsiLocalTrack, muted: boolean): void {\n        const mediaType = track.getType();\n\n        if (mediaType === MediaType.AUDIO) {\n            RTCStats.sendStatsEntry(RTCStatsEvents.AUDIO_MUTE_CHANGED_EVENT, this._pcId, muted);\n        } else if (track.getVideoType() === VideoType.DESKTOP) {\n            RTCStats.sendStatsEntry(RTCStatsEvents.SCREENSHARE_MUTE_CHANGED_EVENT, this._pcId, muted);\n        } else {\n            RTCStats.sendStatsEntry(RTCStatsEvents.VIDEO_MUTE_CHANGED_EVENT, this._pcId, muted);\n        }\n    }\n\n    /**\n     * Handles remote source mute and unmute changed events.\n     *\n     * @param {string} sourceName - The name of the remote source.\n     * @param {boolean} isMuted - The new mute state.\n     * @internal\n     */\n    _sourceMutedChanged(sourceName: string, isMuted: boolean): void {\n        const track = this.getRemoteTracks().slice().reverse().find(t => t.getSourceName() === sourceName);\n\n        if (!track) {\n            logger.debug(`Remote track not found for source=${sourceName}, mute update failed!`);\n\n            return;\n        }\n\n        track.setMute(isMuted);\n    }\n\n    /* eslint-enable max-params */\n\n    /**\n     * Process stat and adds it to the array of stats we store.\n     * @param report the current stats report.\n     * @param name the name of the report, if available\n     * @param statValue the value to add.\n     * @private\n     */\n    _processStat(report: RTCStats | ILegacyStatsReport, name: string, statValue: string | number | RTCStats): void {\n        const id = `${report.id}-${name}`;\n        let s = this.stats[id];\n        const now = new Date();\n\n        if (!s) {\n            this.stats[id] = s = {\n                endTime: now,\n                startTime: now,\n                times: [],\n                values: []\n            };\n        }\n        s.values.push(statValue);\n        s.times.push(now.getTime());\n        if (s.values.length > this.maxstats) {\n            s.values.shift();\n            s.times.shift();\n        }\n        s.endTime = now;\n    }\n\n\n    /**\n     * Forwards the {@link peerconnection.iceConnectionState} state except that it\n     * will convert \"completed\" into \"connected\" where both mean that the ICE has\n     * succeeded and is up and running. We never see \"completed\" state for\n     * the JVB connection, but it started appearing for the P2P one. This method\n     * allows to adapt old logic to this new situation.\n     * @return {RTCIceConnectionState}\n     */\n    getConnectionState(): RTCIceConnectionState {\n        const state = this.peerconnection.iceConnectionState;\n\n        if (state === 'completed') {\n            return 'connected';\n        }\n\n        return state;\n    }\n\n    /**\n     * Obtains the media direction for given {@link MediaType} that needs to be set on a p2p peerconnection's remote SDP\n     * after a source-add or source-remove action. The method takes into account whether or not there are any\n     * local tracks for the given media type.\n     * @param {MediaType} mediaType - The media type for which the direction is to be calculated.\n     * @param {boolean} isAddOperation whether the direction is to be calculated after a source-add action.\n     * @return {string} one of the SDP direction constants ('sendrecv, 'recvonly' etc.)\n     * which should be used when setting\n     * local description on the peerconnection.\n     * @internal\n     */\n    getDesiredMediaDirection(mediaType: MediaType, isAddOperation = false): MediaDirection {\n        return this.tpcUtils.getDesiredMediaDirection(mediaType, isAddOperation);\n    }\n\n    /**\n     * Tells whether or not this TPC instance has spatial scalability enabled.\n     * @return {boolean} <tt>true</tt> if spatial scalability is enabled and active or\n     * <tt>false</tt> if it's turned off.\n     */\n    isSpatialScalabilityOn(): boolean {\n        const h264SimulcastEnabled = this.tpcUtils.codecSettings[CodecMimeType.H264].scalabilityModeEnabled;\n\n        return !this.options.disableSimulcast\n            && (this.codecSettings.codecList[0] !== CodecMimeType.H264 || h264SimulcastEnabled);\n    }\n\n    /**\n     * Obtains audio levels of the remote audio tracks by getting the source information on the RTCRtpReceivers.\n     * The information relevant to the ssrc is updated each time a RTP packet constaining the ssrc is received.\n     * @param {Array<string>} speakerList list of endpoint ids for which audio levels are to be gathered.\n     * @returns {Object} containing ssrc and audio level information as a key-value pair.\n     */\n    getAudioLevels(speakerList: string[] = []): Record<string, number> {\n        const audioLevels = {};\n        const audioReceivers = speakerList.length\n            ? this._getReceiversByEndpointIds(speakerList, MediaType.AUDIO)\n            : this.peerconnection.getReceivers()\n                .filter(receiver => receiver.track\n                    && receiver.track.kind === MediaType.AUDIO && receiver.track.enabled);\n\n        audioReceivers.forEach(remote => {\n            const ssrc = remote.getSynchronizationSources();\n\n            if (ssrc?.length) {\n                // As per spec, this audiolevel is a value between 0..1 (linear), where 1.0\n                // represents 0 dBov, 0 represents silence, and 0.5 represents approximately\n                // 6 dBSPL change in the sound pressure level from 0 dBov.\n                // https://www.w3.org/TR/webrtc/#dom-rtcrtpcontributingsource-audiolevel\n                audioLevels[ssrc[0].source] = ssrc[0].audioLevel;\n            }\n        });\n\n        return audioLevels;\n    }\n\n    /**\n     * Checks if the browser is currently doing true simulcast where in three\n     * different media streams are being sent to the\n     * bridge. Currently this happens always for VP8 and only if simulcast is enabled for VP9/AV1/H264.\n     *\n     * @param {JitsiLocalTrack} localTrack - The local video track.\n     * @returns {boolean}\n     */\n    doesTrueSimulcast(localTrack: JitsiLocalTrack): boolean {\n        const currentCodec = this.tpcUtils.getConfiguredVideoCodec(localTrack);\n\n        return this.isSpatialScalabilityOn() && this.tpcUtils.isRunningInSimulcastMode(currentCodec as CodecMimeType);\n    }\n\n    /**\n     * Returns the SSRCs associated with a given local video track.\n     *\n     * @param {JitsiLocalTrack} localTrack\n     * @returns\n     */\n    getLocalVideoSSRCs(localTrack: JitsiLocalTrack): number[] {\n        const ssrcs = [];\n\n        if (!localTrack?.isVideoTrack()) {\n            return ssrcs;\n        }\n\n        const ssrcGroup = this.isSpatialScalabilityOn() ? SSRC_GROUP_SEMANTICS.SIM : SSRC_GROUP_SEMANTICS.FID;\n\n        return this.localSSRCs.get(localTrack.rtcId)\n            ?.groups?.find(group => group.semantics === ssrcGroup)?.ssrcs || ssrcs;\n    }\n\n    /**\n     * Obtains local tracks for given {@link MediaType}. If the <tt>mediaType</tt>\n     * argument is omitted the list of all local tracks will be returned.\n     * @param {MediaType} [mediaType]\n     * @return {Array<JitsiLocalTrack>}\n     */\n    getLocalTracks(mediaType: Optional<MediaType> = undefined): JitsiLocalTrack[] {\n        let tracks = Array.from(this.localTracks.values());\n\n        if (mediaType !== undefined) {\n            tracks = tracks.filter(track => track.getType() === mediaType);\n        }\n\n        return tracks;\n    }\n\n    /**\n     * Retrieves the local video tracks.\n     *\n     * @returns {Array<JitsiLocalTrack>} - local video tracks.\n     */\n    getLocalVideoTracks(): JitsiLocalTrack[] {\n        return this.getLocalTracks(MediaType.VIDEO);\n    }\n\n    /**\n     * Obtains all remote tracks currently known to this PeerConnection instance.\n     *\n     * @param {optional<string>} [endpointId] - The track owner's identifier (MUC nickname)\n     * @param {optional<MediaType>} [mediaType] - The remote tracks will be filtered by their media type if this argument is\n     * specified.\n     * @return {Array<JitsiRemoteTrack>}\n     */\n    getRemoteTracks(endpointId: Optional<string> = undefined, mediaType: Optional<MediaType> = undefined): JitsiRemoteTrack[] {\n        let remoteTracks = [];\n\n        if (FeatureFlags.isSsrcRewritingSupported()) {\n            for (const remoteTrack of this.remoteTracksBySsrc.values()) {\n                const owner = remoteTrack.getParticipantId();\n\n                if (owner && (!endpointId || owner === endpointId)) {\n                    if (!mediaType || remoteTrack.getType() === mediaType) {\n                        remoteTracks.push(remoteTrack);\n                    }\n                }\n            }\n\n            return remoteTracks;\n        }\n\n        const endpoints = endpointId ? [ endpointId ] : this.remoteTracks.keys();\n\n        for (const endpoint of endpoints) {\n            const endpointTracksByMediaType = this.remoteTracks.get(endpoint);\n\n            if (endpointTracksByMediaType) {\n                for (const trackMediaType of endpointTracksByMediaType.keys()) {\n                    // per media type filtering\n                    if (!mediaType || mediaType === trackMediaType) {\n                        remoteTracks = remoteTracks.concat(Array.from(endpointTracksByMediaType.get(trackMediaType)));\n                    }\n                }\n            }\n        }\n\n        return remoteTracks;\n    }\n\n    /**\n     * Returns the remote sourceInfo for a given source name.\n     *\n     * @param {string} sourceName - The source name.\n     * @returns {TPCSourceInfo}\n     */\n    getRemoteSourceInfoBySourceName(sourceName: string): ITPCSourceInfo {\n        return cloneDeep(this._remoteSsrcMap.get(sourceName));\n    }\n\n    /**\n     * Returns a map of source names and their associated SSRCs for the remote participant.\n     *\n     * @param {string} id Endpoint id of the remote participant.\n     * @returns {Map<string, TPCSourceInfo>} The map of source names and their associated SSRCs.\n     */\n    getRemoteSourceInfoByParticipant(id: string): Map<string, ITPCSourceInfo> {\n        const removeSsrcInfo = new Map();\n        const remoteTracks = this.getRemoteTracks(id);\n\n        if (!remoteTracks?.length) {\n            return removeSsrcInfo;\n        }\n        const primarySsrcs = remoteTracks.map(track => track.getSsrc());\n\n        for (const [ sourceName, sourceInfo ] of this._remoteSsrcMap) {\n            if (sourceInfo.ssrcList?.some(ssrc => primarySsrcs.includes(Number(ssrc)))) {\n                removeSsrcInfo.set(sourceName, sourceInfo);\n            }\n        }\n\n        return removeSsrcInfo;\n    }\n\n    /**\n     * Returns the target bitrates configured for the local video source.\n     *\n     * @param {JitsiLocalTrack} - The local video track.\n     * @returns {Object}\n     */\n    getTargetVideoBitrates(localTrack: JitsiLocalTrack): any {\n        const currentCodec = this.tpcUtils.getConfiguredVideoCodec(localTrack);\n\n        return this.tpcUtils.codecSettings[currentCodec].maxBitratesVideo;\n    }\n\n    /**\n     * Tries to find {@link JitsiTrack} for given SSRC number. It will search both local and remote tracks bound to this\n     * instance.\n     * @param {number} ssrc\n     * @return {Nullable<JitsiRemoteTrack | JitsiLocalTrack>}\n     */\n    getTrackBySSRC(ssrc: number): Nullable<JitsiRemoteTrack | JitsiLocalTrack> {\n        if (typeof ssrc !== 'number') {\n            throw new Error(`SSRC ${ssrc} is not a number`);\n        }\n        for (const localTrack of this.localTracks.values()) {\n            const { ssrcs } = this.localSSRCs.get(localTrack.rtcId) ?? { ssrcs: [] };\n\n            if (ssrcs.find(localSsrc => Number(localSsrc) === ssrc)) {\n                return localTrack;\n            }\n        }\n\n        if (FeatureFlags.isSsrcRewritingSupported()) {\n            return this.remoteTracksBySsrc.get(ssrc);\n        }\n\n        for (const remoteTrack of this.getRemoteTracks()) {\n            if (remoteTrack.getSsrc() === ssrc) {\n                return remoteTrack;\n            }\n        }\n\n        return null;\n    }\n\n    /**\n     * Tries to find SSRC number for given {@link JitsiTrack} id. It will search\n     * both local and remote tracks bound to this instance.\n     * @param {string} id\n     * @return {Nullable<number>}\n     */\n    getSsrcByTrackId(id: string): Nullable<number> {\n\n        const findTrackById = track => track.getTrack().id === id;\n        const localTrack = this.getLocalTracks().find(findTrackById);\n\n        if (localTrack) {\n            return this.getLocalSSRC(localTrack);\n        }\n\n        const remoteTrack = this.getRemoteTracks().find(findTrackById);\n\n        if (remoteTrack) {\n            return remoteTrack.getSsrc();\n        }\n\n        return null;\n    }\n\n    /**\n     * Called on \"track added\" and \"stream added\" PeerConnection events (because we\n     * handle streams on per track basis). Finds the owner and the SSRC for\n     * the track and passes that to ChatRoom for further processing.\n     * @param {MediaStream} stream the WebRTC MediaStream instance which is\n     * the parent of the track\n     * @param {MediaStreamTrack} track the WebRTC MediaStreamTrack added for remote\n     * participant.\n     * @param {RTCRtpTransceiver} transceiver the WebRTC transceiver that is created\n     * for the remote participant in unified plan.\n     */\n    _remoteTrackAdded(stream: MediaStream, track: MediaStreamTrack, transceiver: Nullable<RTCRtpTransceiver> = null): void {\n        const streamId = stream.id;\n        const mediaType = track.kind as MediaType;\n\n        // Do not create remote tracks for 'mixed' JVB SSRCs (used by JVB for RTCP termination).\n        if (!this.isP2P && !RTCUtils.isUserStreamById(streamId)) {\n            return;\n        }\n        logger.info(`${this} Received track event for remote stream[id=${streamId},type=${mediaType}]`);\n\n        // look up an associated JID for a stream id\n        if (!mediaType) {\n            logger.error(`MediaType undefined for remote track, stream id: ${streamId}, track creation failed!`);\n\n            return;\n        }\n\n        const remoteSDP = new SDP(this.remoteDescription?.sdp);\n        let mediaLine;\n\n        // Find the matching mline using 'mid' or the 'msid' attr of the stream.\n        if (transceiver?.mid) {\n            const mid = transceiver.mid;\n\n            // @ts-ignore\n            mediaLine = remoteSDP.media.find(mls => SDPUtil.findLine(mls, `a=mid:${mid}`));\n        } else {\n            mediaLine = remoteSDP.media.find(mls => {\n                // @ts-ignore\n                const msid = SDPUtil.findLine(mls, 'a=msid:');\n\n                return typeof msid === 'string' && streamId === msid.substring(7).split(' ')[0];\n            });\n        }\n\n        if (!mediaLine) {\n            logger.error(\n                `Matching media line not found in remote SDP for remote stream[id=${streamId},type=${mediaType}],`\n                    + 'track creation failed!');\n\n            return;\n        }\n        // @ts-ignore\n        let ssrcLines = SDPUtil.findLines(mediaLine, 'a=ssrc:');\n\n        ssrcLines = ssrcLines.filter(line => line.indexOf(`msid:${streamId}`) !== -1);\n        if (!ssrcLines.length) {\n            logger.error(`No SSRC lines found in remote SDP for remote stream[msid=${streamId},type=${mediaType}]`\n                    + 'track creation failed!');\n\n            return;\n        }\n\n        // FIXME the length of ssrcLines[0] not verified, but it will fail\n        // with global error handler anyway\n        const ssrcStr = ssrcLines[0].substring(7).split(' ')[0];\n        const trackSsrc = Number(ssrcStr);\n        const ownerEndpointId = this._signalingLayer.getSSRCOwner(trackSsrc);\n\n        if (!isValidNumber(trackSsrc) || trackSsrc < 0) {\n            logger.error(`Invalid SSRC for remote stream[ssrc=${trackSsrc},id=${streamId},type=${mediaType}]`\n                    + 'track creation failed!');\n\n            return;\n        }\n\n        if (!ownerEndpointId) {\n            logger.error(`No SSRC owner known for remote stream[ssrc=${trackSsrc},id=${streamId},type=${mediaType}]`\n                + 'track creation failed!');\n\n            return;\n        }\n\n        const sourceName = this._signalingLayer.getTrackSourceName(trackSsrc);\n        const peerMediaInfo = this._signalingLayer.getPeerMediaInfo(ownerEndpointId, mediaType, sourceName);\n        const trackDetails = {\n            mediaType,\n            muted: peerMediaInfo?.muted ?? true,\n            ssrc: trackSsrc,\n            stream,\n            track,\n            videoType: peerMediaInfo?.videoType\n        };\n\n        if (this._remoteSsrcMap.has(sourceName) && mediaType === MediaType.VIDEO) {\n            trackDetails.videoType = this._remoteSsrcMap.get(sourceName).videoType;\n        }\n\n        this._createRemoteTrack(ownerEndpointId, sourceName, trackDetails);\n    }\n\n    /**\n     * Initializes a new JitsiRemoteTrack instance with the data provided by the signaling layer and SDP.\n     *\n     * @param {string} ownerEndpointId - The owner's endpoint ID (MUC nickname)\n     * @param {String} sourceName - The track's source name\n     * @param {Object} trackDetails - The track's details.\n     * @param {MediaType} trackDetails.mediaType - media type, 'audio' or 'video'.\n     * @param {boolean} trackDetails.muted - The initial muted status.\n     * @param {number} trackDetails.ssrc - The track's main SSRC number.\n     * @param {MediaStream} trackDetails.stream - The WebRTC stream instance.\n     * @param {MediaStreamTrack} trackDetails.track - The WebRTC track instance.\n     * @param {VideoType} trackDetails.videoType - The track's type of the video (if applicable).\n     */\n    _createRemoteTrack(ownerEndpointId, sourceName, trackDetails) {\n        const { mediaType, muted, ssrc, stream, track, videoType } = trackDetails;\n\n        logger.info(`${this} creating remote track[endpoint=${ownerEndpointId},ssrc=${ssrc},`\n            + `type=${mediaType},sourceName=${sourceName}]`);\n        let remoteTracksMap;\n        let userTracksByMediaType;\n\n        if (FeatureFlags.isSsrcRewritingSupported()) {\n            const existingTrack = this.remoteTracksBySsrc.get(ssrc);\n\n            if (existingTrack) {\n                logger.info(`${this} ignored duplicated track event for SSRC[ssrc=${ssrc},type=${mediaType}]`);\n\n                return;\n            }\n        } else {\n            remoteTracksMap = this.remoteTracks.get(ownerEndpointId);\n\n            if (!remoteTracksMap) {\n                remoteTracksMap = new Map();\n                remoteTracksMap.set(MediaType.AUDIO, new Set());\n                remoteTracksMap.set(MediaType.VIDEO, new Set());\n                this.remoteTracks.set(ownerEndpointId, remoteTracksMap);\n            }\n\n            userTracksByMediaType = remoteTracksMap.get(mediaType);\n\n            if (userTracksByMediaType?.size\n                && Array.from(userTracksByMediaType).find((jitsiTrack: JitsiRemoteTrack) => jitsiTrack.getTrack() === track)) {\n                // Ignore duplicated event which can originate either from 'onStreamAdded' or 'onTrackAdded'.\n                logger.info(`${this} ignored duplicated track event for track[endpoint=${ownerEndpointId},`\n                    + `type=${mediaType}]`);\n\n                return;\n            }\n        }\n\n        const remoteTrack\n            = new JitsiRemoteTrack(\n                    this.rtc,\n                    this.rtc.conference,\n                    ownerEndpointId,\n                    stream,\n                    track,\n                    mediaType,\n                    videoType,\n                    ssrc,\n                    muted,\n                    this.isP2P,\n                    sourceName);\n\n        if (FeatureFlags.isSsrcRewritingSupported()) {\n            this.remoteTracksBySsrc.set(ssrc, remoteTrack);\n        } else {\n            userTracksByMediaType.add(remoteTrack);\n        }\n\n        this.eventEmitter.emit(RTCEvents.REMOTE_TRACK_ADDED, remoteTrack, this);\n    }\n\n    /**\n     * Handles remote media track removal.\n     *\n     * @param {MediaStream} stream - WebRTC MediaStream instance which is the parent of the track.\n     * @param {MediaStreamTrack} track - WebRTC MediaStreamTrack which has been removed from the PeerConnection.\n     * @returns {void}\n     */\n    _remoteTrackRemoved(stream: MediaStream, track: MediaStreamTrack): void {\n        const streamId = stream.id;\n        const trackId = track?.id;\n\n        // Ignore stream removed events for JVB \"mixed\" sources (used for RTCP termination).\n        if (!RTCUtils.isUserStreamById(streamId)) {\n            return;\n        }\n\n        if (!streamId) {\n            logger.error(`${this} remote track removal failed - no stream ID`);\n\n            return;\n        }\n\n        if (!trackId) {\n            logger.error(`${this} remote track removal failed - no track ID`);\n\n            return;\n        }\n\n        const toBeRemoved = this.getRemoteTracks().find(\n            remoteTrack => remoteTrack.getStreamId() === streamId && remoteTrack.getTrackId() === trackId);\n\n        if (!toBeRemoved) {\n            logger.error(`${this} remote track removal failed - track not found`);\n\n            return;\n        }\n\n        this._removeRemoteTrack(toBeRemoved);\n    }\n\n    /**\n     * Removes and disposes given <tt>JitsiRemoteTrack</tt> instance. Emits {@link RTCEvents.REMOTE_TRACK_REMOVED}.\n     *\n     * @param {JitsiRemoteTrack} toBeRemoved - The remote track to be removed.\n     * @returns {void}\n     */\n    _removeRemoteTrack(toBeRemoved: JitsiRemoteTrack): void {\n        logger.info(`${this} Removing remote track stream[id=${toBeRemoved.getStreamId()},`\n            + `trackId=${toBeRemoved.getTrackId()}]`);\n\n        toBeRemoved.dispose();\n        const participantId = toBeRemoved.getParticipantId();\n\n        if (FeatureFlags.isSsrcRewritingSupported() && !participantId) {\n            return;\n        } else if (!FeatureFlags.isSsrcRewritingSupported()) {\n            const userTracksByMediaType = this.remoteTracks.get(participantId);\n\n            if (!userTracksByMediaType) {\n                logger.error(`${this} removeRemoteTrack: no remote tracks map for endpoint=${participantId}`);\n            } else if (!userTracksByMediaType.get(toBeRemoved.getType())?.delete(toBeRemoved)) {\n                logger.error(`${this} Failed to remove ${toBeRemoved} - type mapping messed up ?`);\n            }\n        }\n\n        this.eventEmitter.emit(RTCEvents.REMOTE_TRACK_REMOVED, toBeRemoved);\n    }\n\n    /**\n     * Processes the local SDP and creates an SSRC map for every local track.\n     *\n     * @param {string} localSDP - SDP from the local description.\n     * @returns {void}\n     */\n    _processAndExtractSourceInfo(localSDP: string): void {\n        /**\n         * @type {Map<string, TPCSourceInfo>} The map of source names and their associated SSRCs.\n         */\n        const ssrcMap = new Map();\n\n        if (!localSDP || typeof localSDP !== 'string') {\n            throw new Error('Local SDP must be a valid string, aborting!!');\n        }\n        const session = transform.parse(localSDP);\n        const media = session.media.filter(mline => mline.direction === MediaDirection.SENDONLY\n            || mline.direction === MediaDirection.SENDRECV);\n\n        if (!media.length) {\n            this._localSsrcMap = ssrcMap;\n\n            return;\n        }\n\n        for (const localTrack of this.localTracks.values()) {\n            const sourceName = localTrack.getSourceName();\n            const trackIndex = getSourceIndexFromSourceName(sourceName);\n            const mediaType = localTrack.getType();\n            const mLines = media.filter(m => m.type === mediaType);\n            const ssrcGroups = mLines[trackIndex].ssrcGroups;\n            let ssrcs = mLines[trackIndex].ssrcs;\n\n            if (ssrcs?.length) {\n                // Filter the ssrcs with 'cname' attribute.\n                ssrcs = ssrcs.filter(s => s.attribute === 'cname');\n\n                const msid = `${this.rtc.getLocalEndpointId()}-${mediaType}-${trackIndex}`;\n                const ssrcInfo = {\n                    groups: [],\n                    msid,\n                    ssrcs: []\n                };\n\n                ssrcs.forEach(ssrc => ssrcInfo.ssrcs.push(ssrc.id));\n\n                if (ssrcGroups?.length) {\n                    for (const group of ssrcGroups) {\n                        const parsedGroup = {\n                            semantics: group.semantics,\n                            ssrcs: group.ssrcs.split(' ').map(ssrcStr => parseInt(ssrcStr, 10))\n                        };\n\n                        ssrcInfo.groups.push(parsedGroup);\n                    }\n\n                    const simGroup = ssrcGroups.find(group => group.semantics === SSRC_GROUP_SEMANTICS.SIM);\n\n                    // Add a SIM group if its missing in the description (happens on Firefox).\n                    if (this.isSpatialScalabilityOn() && !simGroup) {\n                        const groupSsrcs = ssrcGroups.map(group => group.ssrcs[0]);\n\n                        ssrcInfo.groups.push({\n                            semantics: SSRC_GROUP_SEMANTICS.SIM,\n                            ssrcs: groupSsrcs\n                        });\n                    }\n                }\n\n                ssrcMap.set(sourceName, ssrcInfo);\n\n                const oldSsrcInfo = this.localSSRCs.get(localTrack.rtcId);\n                const oldSsrc = this._extractPrimarySSRC(oldSsrcInfo);\n                const newSsrc = this._extractPrimarySSRC(ssrcInfo);\n\n                if (oldSsrc !== newSsrc) {\n                    oldSsrc && logger.debug(`${this} Overwriting SSRC for track=${localTrack}] with ssrc=${newSsrc}`);\n                    this.localSSRCs.set(localTrack.rtcId, ssrcInfo);\n                    localTrack.setSsrc(newSsrc);\n                }\n            }\n        }\n        this._localSsrcMap = ssrcMap;\n    }\n\n    /**\n     * @param {JitsiLocalTrack} localTrack\n     * @returns {Nullable<number>}\n     */\n    getLocalSSRC(localTrack: JitsiLocalTrack): Nullable<number> {\n        const ssrcInfo = this._getSSRC(localTrack.rtcId.toString());\n\n        return ssrcInfo?.ssrcs[0];\n    }\n\n    /**\n     * Gets the signaling state of the peer connection.\n     */\n    get signalingState(): string {\n        return this.peerconnection.signalingState;\n    }\n\n    /**\n     * Gets the ICE connection state of the peer connection.\n     */\n    get iceConnectionState(): string {\n        return this.peerconnection.iceConnectionState;\n    }\n\n    /**\n     * Gets the connection state of the peer connection.\n     */\n    get connectionState(): string {\n        return this.peerconnection.connectionState;\n    }\n\n    /**\n     * Gets the local description of the peer connection, with optional transformations for\n     * simulcast and stream identifiers.\n     */\n    get localDescription(): RTCSessionDescription {\n        let desc = this.peerconnection.localDescription;\n\n        if (!desc) {\n            logger.debug(`${this} getLocalDescription no localDescription found`);\n\n            // @ts-ignore\n            return {};\n        }\n\n        this.trace('getLocalDescription::preTransform', TraceablePeerConnection.dumpSDP(desc));\n\n        if (!this.isP2P) {\n            desc = this.tpcUtils.injectSsrcGroupForSimulcast(desc);\n            this.trace('getLocalDescription::postTransform (inject ssrc group)', TraceablePeerConnection.dumpSDP(desc));\n        }\n\n        desc = this.localSdpMunger.transformStreamIdentifiers(desc, this._localSsrcMap);\n\n        return desc;\n    }\n\n    /**\n     * Gets the remote description of the peer connection, with optional adjustments for media direction in P2P mode.\n     */\n    get remoteDescription(): RTCSessionDescription {\n        let desc = this.peerconnection.remoteDescription;\n\n        if (!desc) {\n            logger.debug(`${this} getRemoteDescription no remoteDescription found`);\n\n            // @ts-ignore\n            return {};\n        }\n        this.trace('getRemoteDescription::preTransform', TraceablePeerConnection.dumpSDP(desc));\n\n        if (this.isP2P) {\n            desc = this._adjustRemoteMediaDirection(desc);\n        }\n\n        return desc;\n    }\n\n    /**\n     * Retrieves the SSRC (Synchronization Source) identifier associated with the given RTC ID.\n     * @private\n     */\n    _getSSRC(rtcId: string): Nullable<ISsrcInfo> {\n        return this.localSSRCs.get(Number(rtcId));\n    }\n\n    /**\n     * Checks if low fps screensharing is in progress.\n     *\n     * @private\n     * @returns {boolean} Returns true if 5 fps screensharing is in progress, false otherwise.\n     */\n    isSharingLowFpsScreen(): boolean {\n        return this._isSharingScreen() && this._capScreenshareBitrate;\n    }\n\n    /**\n     * Checks if screensharing is in progress.\n     *\n     * @returns {boolean}  Returns true if a desktop track has been added to the peerconnection, false otherwise.\n     */\n    _isSharingScreen(): boolean {\n        const tracks = this.getLocalVideoTracks();\n\n        return Boolean(tracks.find(track => track.videoType === VideoType.DESKTOP));\n    }\n\n    /**\n     * Add {@link JitsiLocalTrack} to this TPC.\n     * @param {JitsiLocalTrack} track\n     * @param {boolean} isInitiator indicates if the endpoint is the offerer.\n     * @returns {Promise<void>} - resolved when done.\n     */\n    addTrack = async (track: JitsiLocalTrack, isInitiator = false): Promise<void> => {\n        const rtcId = track.rtcId;\n\n        if (this.localTracks.has(rtcId)) {\n            throw new Error(`${track} is already in ${this}`);\n        }\n\n        logger.info(`${this} adding ${track}`);\n        const webrtcStream = track.getOriginalStream();\n        const mediaStreamTrack = track.getTrack();\n        let transceiver;\n\n        if (isInitiator) {\n            const streams = [];\n\n            webrtcStream && streams.push(webrtcStream);\n\n            // Use pc.addTransceiver() for the initiator case when local tracks are getting added\n            // to the peerconnection before a session-initiate is sent over to the peer.\n            const transceiverInit = {\n                direction: MediaDirection.SENDRECV,\n                sendEncodings: [],\n                streams\n            };\n\n            if (!browser.isFirefox()) {\n                transceiverInit.sendEncodings = this.tpcUtils.getStreamEncodings(track);\n            }\n\n            transceiver = this.peerconnection.addTransceiver(mediaStreamTrack, transceiverInit);\n        } else {\n            // Use pc.addTrack() for responder case so that we can re-use the m-lines that were created\n            // when setRemoteDescription was called. pc.addTrack() automatically  attaches to any existing\n            // unused \"recv-only\" transceiver.\n            const sender = this.peerconnection.addTrack(mediaStreamTrack);\n\n            // Find the corresponding transceiver that the track was attached to.\n            transceiver = this.peerconnection.getTransceivers().find(t => t.sender === sender);\n        }\n\n        if (transceiver?.mid) {\n            this.localTrackTransceiverMids.set(track.rtcId, transceiver.mid.toString());\n        }\n\n        if (track) {\n            this.localTracks.set(rtcId, track);\n            if (track.isAudioTrack()) {\n                this._hasHadAudioTrack = true;\n            } else {\n                this._hasHadVideoTrack = true;\n            }\n        }\n\n        // On Firefox, the encodings have to be configured on the sender only after the transceiver is created.\n        if (browser.isFirefox() && webrtcStream && this.doesTrueSimulcast(track)) {\n            await this._setEncodings(track);\n        }\n    };\n\n    /**\n     * Adds local track to the RTCPeerConnection.\n     *\n     * @param {JitsiLocalTrack} track the track to be added to the pc.\n     * @return {Promise<boolean>} Promise that resolves to true if the underlying PeerConnection's state has changed and\n     * renegotiation is required, false if no renegotiation is needed or Promise is rejected when something goes wrong.\n     */\n    addTrackToPc(track: JitsiLocalTrack): Promise<boolean> {\n        logger.info(`${this} Adding track=${track} to PC`);\n\n        if (!this._assertTrackBelongs('addTrackToPc', track)) {\n            // Abort\n\n            return Promise.reject('Track not found on the peerconnection');\n        }\n\n        const webRtcStream = track.getOriginalStream();\n\n        if (!webRtcStream) {\n            logger.error(`${this} Unable to add track=${track} to PC - no WebRTC stream`);\n\n            return Promise.reject('Stream not found');\n        }\n\n        return this.replaceTrack(null, track, true /* isMuteOperation */).then(() => {\n            if (track) {\n                if (track.isAudioTrack()) {\n                    this._hasHadAudioTrack = true;\n                } else {\n                    this._hasHadVideoTrack = true;\n                }\n            }\n\n            return false;\n        });\n    }\n\n    /**\n     * This method when called will check if given <tt>localTrack</tt> belongs to\n     * this TPC (that it has been previously added using {@link addTrack}). If the\n     * track does not belong an error message will be logged.\n     * @param {string} methodName the method name that will be logged in an error\n     * message\n     * @param {JitsiLocalTrack} localTrack\n     * @return {boolean} <tt>true</tt> if given local track belongs to this TPC or\n     * <tt>false</tt> otherwise.\n     * @private\n     */\n    _assertTrackBelongs(methodName: string, localTrack: JitsiLocalTrack): boolean {\n        const doesBelong = this.localTracks.has(localTrack?.rtcId);\n\n        if (!doesBelong) {\n            logger.error(`${this} ${methodName}: track=${localTrack} does not belong to pc`);\n        }\n\n        return doesBelong;\n    }\n\n    /**\n     * Returns the codecs in the current order of preference as configured on the peerconnection.\n     *\n     * @param {RTCSessionDescription} - The local description to be used.\n     * @returns {Array}\n     */\n    getConfiguredVideoCodecs(description?: RTCSessionDescription): CodecMimeType[] {\n        return this.tpcUtils.getConfiguredVideoCodecs(description?.sdp);\n    }\n\n    /**\n     * Enables or disables simulcast for screenshare based on the frame rate requested for desktop track capture.\n     *\n     * @param {number} maxFps framerate to be used for desktop track capture.\n     */\n    setDesktopSharingFrameRate(maxFps: number): void {\n        const lowFps = maxFps <= SS_DEFAULT_FRAME_RATE;\n\n        this._capScreenshareBitrate = this.isSpatialScalabilityOn() && lowFps;\n    }\n\n    /**\n     * Sets the codec preference on the peerconnection. The codec preference goes into effect when\n     * the next renegotiation happens for older clients that do not support the codec selection API.\n     *\n     * @param {Array<CodecMimeType>} codecList - Preferred codecs for video.\n     * @param {CodecMimeType} screenshareCodec - The preferred codec for screenshare.\n     * @returns {boolean} - Returns true if the codec settings were updated, false otherwise.\n     */\n    setVideoCodecs(codecList: CodecMimeType[], screenshareCodec: CodecMimeType): boolean {\n        let updated = false;\n\n        if (!this.codecSettings || !codecList?.length) {\n            return updated;\n        }\n\n        this.codecSettings.codecList = codecList;\n        if (screenshareCodec) {\n            this.codecSettings.screenshareCodec = screenshareCodec;\n        }\n\n        if (!this.usesCodecSelectionAPI()) {\n            return updated;\n        }\n\n        for (const track of this.getLocalVideoTracks()) {\n            const currentCodec = this.tpcUtils.getConfiguredVideoCodec(track);\n\n            if (screenshareCodec && track.getVideoType() === VideoType.DESKTOP && screenshareCodec !== currentCodec) {\n                this.configureVideoSenderEncodings(track, screenshareCodec);\n                updated = true;\n            } else if (currentCodec !== codecList[0]) {\n                this.configureVideoSenderEncodings(track);\n                updated = true;\n            }\n        }\n\n        updated && RTCStats.sendStatsEntry(RTCStatsEvents.CODEC_CHANGED_EVENT, this._pcId, {\n            camera: codecList[0],\n            screenshare: screenshareCodec\n        });\n\n        return updated;\n    }\n\n    /**\n     * Remove local track from this TPC.\n     * @param {JitsiLocalTrack} localTrack the track to be removed from this TPC.\n     *\n     * FIXME It should probably remove a boolean just like {@link removeTrackFromPc}\n     *       The same applies to addTrack.\n     */\n    removeTrack(localTrack: JitsiLocalTrack): void {\n        const webRtcStream = localTrack.getOriginalStream();\n\n        this.trace(\n            'removeStream',\n            localTrack.rtcId.toString(), webRtcStream ? webRtcStream.id : undefined);\n\n        if (!this._assertTrackBelongs('removeStream', localTrack)) {\n            // Abort - nothing to be done here\n            return;\n        }\n        this.localTracks.delete(localTrack.rtcId);\n        this.localSSRCs.delete(localTrack.rtcId);\n\n        if (webRtcStream) {\n            // @ts-ignore\n            this.peerconnection.removeStream(webRtcStream);\n        }\n    }\n\n    /**\n     * Returns the receiver corresponding to the given MediaStreamTrack.\n     *\n     * @param {MediaSreamTrack} track - The media stream track used for the search.\n     * @returns {Optional<RTCRtpReceiver>} - The found receiver or undefined if no receiver\n     * was found.\n     */\n    findReceiverForTrack(track: MediaStreamTrack): Optional<RTCRtpReceiver> {\n        return this.peerconnection.getReceivers().find(r => r.track === track);\n    }\n\n    /**\n     * Returns the sender corresponding to the given MediaStreamTrack.\n     *\n     * @param {MediaSreamTrack} track - The media stream track used for the search.\n     * @returns {Optional<RTCRtpSender>} - The found sender or undefined if no sender\n     * was found.\n     */\n    findSenderForTrack(track: MediaStreamTrack): Optional<RTCRtpSender> {\n        return this.peerconnection.getSenders().find(s => s.track === track);\n    }\n\n    /**\n     * Processes the local description SDP and caches the mids of the mlines associated with the given tracks.\n     *\n     * @param {Array<JitsiLocalTrack>} localTracks - local tracks that are added to the peerconnection.\n     * @returns {void}\n     */\n    processLocalSdpForTransceiverInfo(localTracks: JitsiLocalTrack[]): void {\n        const localSdp = this.localDescription?.sdp;\n\n        if (!localSdp) {\n            return;\n        }\n\n        [ MediaType.AUDIO, MediaType.VIDEO ].forEach(mediaType => {\n            const tracks = localTracks.filter(t => t.getType() === mediaType);\n            const parsedSdp = transform.parse(localSdp);\n            const mLines = parsedSdp.media.filter(mline => mline.type === mediaType);\n\n            tracks.forEach((track, idx) => {\n                if (!this.localTrackTransceiverMids.has(track.rtcId)) {\n                    this.localTrackTransceiverMids.set(track.rtcId, mLines[idx].mid.toString());\n                }\n            });\n        });\n    }\n\n    /**\n     * Replaces <tt>oldTrack</tt> with <tt>newTrack</tt> from the peer connection.\n     * Either <tt>oldTrack</tt> or <tt>newTrack</tt> can be null; replacing a valid\n     * <tt>oldTrack</tt> with a null <tt>newTrack</tt> effectively just removes\n     * <tt>oldTrack</tt>\n     *\n     * @param {Nullable<JitsiLocalTrack>} oldTrack - The current track in use to be replaced on the pc.\n     * @param {Nullable<JitsiLocalTrack>} newTrack - The new track to be used.\n     * @param {boolean} isMuteOperation - Whether the operation is a mute/unmute operation.\n     * @returns {Promise<boolean>} - If the promise resolves with true, renegotiation will be needed.\n     * Otherwise no renegotiation is needed.\n     */\n    replaceTrack(oldTrack: Nullable<JitsiLocalTrack>, newTrack: Nullable<JitsiLocalTrack>, isMuteOperation = false): Promise<boolean> {\n        if (!(oldTrack || newTrack)) {\n            logger.info(`${this} replaceTrack called with no new track and no old track`);\n\n            return Promise.resolve(false);\n        }\n\n        logger.info(`${this} TPC.replaceTrack old=${oldTrack}, new=${newTrack}`);\n\n        let transceiver;\n        const mediaType = newTrack?.getType() ?? oldTrack?.getType();\n        const localTracks = this.getLocalTracks(mediaType);\n        const track = newTrack?.getTrack() ?? null;\n        const isNewLocalSource = localTracks?.length\n            && !oldTrack\n            && newTrack\n            && !localTracks.find(t => t === newTrack);\n\n        // If old track exists, replace the track on the corresponding sender.\n        if (oldTrack && !oldTrack.isMuted()) {\n            transceiver = this.peerconnection.getTransceivers().find(t => t.sender.track === oldTrack.getTrack());\n\n        // Find the first recvonly transceiver when more than one track of the same media type is being added to the pc.\n        // As part of the track addition, a new m-line was added to the remote description with direction set to\n        // recvonly.\n        } else if (isNewLocalSource) {\n            transceiver = this.peerconnection.getTransceivers().find(\n                t => t.receiver.track.kind === mediaType\n                && t.direction === MediaDirection.RECVONLY\n\n                // Re-use any existing recvonly transceiver (if available) for p2p case.\n                && ((this.isP2P && t.currentDirection === MediaDirection.RECVONLY)\n                // @ts-ignore\n                    || (t.currentDirection === MediaDirection.INACTIVE && !t.stopped)));\n\n        // For mute/unmute operations, find the transceiver based on the track index in the source name if present,\n        // otherwise it is assumed to be the first local track that was added to the peerconnection.\n        } else {\n            transceiver = this.peerconnection.getTransceivers().find(t => t.receiver.track.kind === mediaType);\n            const sourceName = newTrack?.getSourceName() ?? oldTrack?.getSourceName();\n\n            if (sourceName) {\n                const trackIndex = getSourceIndexFromSourceName(sourceName);\n\n                if (this.isP2P) {\n                    transceiver = this.peerconnection.getTransceivers()\n                        .filter(t => t.receiver.track.kind === mediaType)[trackIndex];\n                } else if (oldTrack) {\n                    const transceiverMid = this.localTrackTransceiverMids.get(oldTrack.rtcId);\n\n                    transceiver = this.peerconnection.getTransceivers().find(t => t.mid === transceiverMid);\n                } else if (trackIndex) {\n                    transceiver = this.peerconnection.getTransceivers()\n                            .filter(t => t.receiver.track.kind === mediaType\n                                && t.direction !== MediaDirection.RECVONLY)[trackIndex];\n                }\n            }\n        }\n\n        if (!transceiver) {\n            return Promise.reject(\n                new Error(`Replace track failed - no transceiver for old: ${oldTrack}, new: ${newTrack}`));\n        }\n\n        return transceiver.sender.replaceTrack(track)\n            .then(() => {\n                if (isMuteOperation) {\n                    // Send RTCStats events for mute operations.\n                    this._sendRtcStatsEvent((oldTrack ?? newTrack), (oldTrack && !newTrack));\n\n                    return Promise.resolve();\n                }\n                if (oldTrack) {\n                    this.localTracks.delete(oldTrack.rtcId);\n                    this.localTrackTransceiverMids.delete(oldTrack.rtcId);\n                }\n\n                if (newTrack) {\n                    if (newTrack.isAudioTrack()) {\n                        this._hasHadAudioTrack = true;\n                    } else {\n                        this._hasHadVideoTrack = true;\n                    }\n                    this.localTrackTransceiverMids.set(newTrack.rtcId, transceiver?.mid?.toString());\n                    this.localTracks.set(newTrack.rtcId, newTrack);\n\n                    // Send RTCStats event when the track is added for the first time.\n                    this._sendRtcStatsEvent(newTrack, false);\n                }\n\n                // Update the local SSRC cache for the case when one track gets replaced with another and no\n                // renegotiation is triggered as a result of this.\n                if (oldTrack && newTrack) {\n                    const oldTrackSSRC = this.localSSRCs.get(oldTrack.rtcId);\n\n                    if (oldTrackSSRC) {\n                        this.localSSRCs.delete(oldTrack.rtcId);\n                        this.localSSRCs.set(newTrack.rtcId, oldTrackSSRC);\n                        const oldSsrcNum = this._extractPrimarySSRC(oldTrackSSRC);\n\n                        newTrack.setSsrc(oldSsrcNum);\n                    }\n\n                    // When a screenshare is stopped and started again, replace track will be called.\n                    if (oldTrack.getVideoType() === VideoType.DESKTOP) {\n                        RTCStats.sendStatsEntry(RTCStatsEvents.SCREENSHARE_MUTE_CHANGED_EVENT, this._pcId, false);\n                    }\n                }\n\n                // In the scenario where we remove the oldTrack (oldTrack is not null and newTrack is null) on FF\n                // if we change the direction to RECVONLY, create answer will generate SDP with only 1 receive\n                // only ssrc instead of keeping all 6 ssrcs that we currently have. Stopping the screen sharing\n                // and then starting it again will trigger 2 rounds of source-remove and source-add replacing\n                // the 6 ssrcs for the screen sharing with 1 receive only ssrc and then removing the receive\n                // only ssrc and adding the same 6 ssrcs. On the remote participant's side the same ssrcs will\n                // be reused on a new m-line and if the remote participant is FF due to\n                // https://bugzilla.mozilla.org/show_bug.cgi?id=1768729 the video stream won't be rendered.\n                // That's why we need keep the direction to SENDRECV for FF.\n                //\n                // NOTE: If we return to the approach of not removing the track for FF and instead using the\n                // enabled property for muting the track, we may need to change the direction to\n                // RECVONLY if FF still sends the media even though the enabled flag is set to false.\n                transceiver.direction\n                    = newTrack || browser.isFirefox() ? MediaDirection.SENDRECV : MediaDirection.RECVONLY;\n\n                // Configure simulcast encodings on Firefox when a track is added to the\n                // peerconnection for the first time.\n                const configureEncodingsPromise\n                    = browser.isFirefox() && !oldTrack && newTrack && this.doesTrueSimulcast(newTrack)\n                        ? this._setEncodings(newTrack)\n                        : Promise.resolve();\n\n                return configureEncodingsPromise.then(() => this.isP2P);\n            });\n    }\n\n    /**\n     * Removes local track from the RTCPeerConnection.\n     *\n     * @param {JitsiLocalTrack} localTrack the local track to be removed.\n     * @return {Promise<boolean>} Promise that resolves to true if the underlying PeerConnection's state has changed and\n     * renegotiation is required, false if no renegotiation is needed or Promise is rejected when something goes wrong.\n     */\n    removeTrackFromPc(localTrack: JitsiLocalTrack): Promise<boolean> {\n        const webRtcStream = localTrack.getOriginalStream();\n\n        this.trace('removeTrack', `${localTrack.rtcId} ${webRtcStream ? webRtcStream.id : 'null'}`);\n\n        if (!this._assertTrackBelongs('removeTrack', localTrack)) {\n            // Abort - nothing to be done here\n            return Promise.reject('Track not found in the peerconnection');\n        }\n\n        return this.replaceTrack(localTrack, null, true /* isMuteOperation */).then(() => false);\n    }\n\n    /**\n     * Updates the remote source map with the given source map for adding or removing sources.\n     *\n     * @param {Map<string, TPCSourceInfo>} sourceMap - The map of source names to their corresponding SSRCs.\n     * @param {boolean} isAdd - Whether the sources are being added or removed.\n     * @returns {void}\n     */\n    updateRemoteSources(sourceMap: Map<string, ITPCSourceInfo>, isAdd: boolean): void {\n        for (const [ sourceName, ssrcInfo ] of sourceMap) {\n            if (isAdd) {\n                this._remoteSsrcMap.set(sourceName, ssrcInfo);\n            } else {\n                this._remoteSsrcMap.delete(sourceName);\n            }\n        }\n    }\n\n    /**\n     * Returns true if the codec selection API is used for switching between codecs for the video sources.\n     *\n     * @returns {boolean}\n     */\n    usesCodecSelectionAPI(): boolean {\n        // Browser throws an error when H.264 is set on the encodings. Therefore, munge the SDP when H.264 needs to be\n        // selected.\n        // TODO: Remove this check when the above issue is fixed.\n        return this._usesCodecSelectionAPI && this.codecSettings.codecList[0] !== CodecMimeType.H264;\n    }\n\n    /**\n     * Creates a new data channel on the peer connection with the specified label and options.\n     */\n    createDataChannel(label: string, opts: RTCDataChannelInit): RTCDataChannel {\n        this.trace('createDataChannel', label, opts);\n\n        return this.peerconnection.createDataChannel(label, opts);\n    }\n\n    /**\n     * Returns the expected send resolution for a local video track based on what encodings are currently active.\n     *\n     * @param {JitsiLocalTrack} localTrack - The local video track.\n     * @returns {number}\n     */\n    calculateExpectedSendResolution(localTrack: JitsiLocalTrack): number {\n        const captureResolution = localTrack.getCaptureResolution();\n        let result = Math.min(localTrack.maxEnabledResolution, captureResolution);\n\n        if (localTrack.getVideoType() === VideoType.CAMERA) {\n            // Find the closest matching resolution based on the current codec, simulcast config and the requested\n            // resolution by the bridge or the peer.\n            if (this.doesTrueSimulcast(localTrack)) {\n                const sender = this.findSenderForTrack(localTrack.getTrack());\n\n                if (!sender) {\n                    return result;\n                }\n\n                const { encodings } = sender.getParameters() as RTCRtpSendParameters;\n\n                result = encodings.reduce((maxValue, encoding) => {\n                    if (encoding.active) {\n                        // eslint-disable-next-line no-param-reassign\n                        maxValue = Math.max(maxValue, Math.floor(captureResolution / encoding.scaleResolutionDownBy));\n                    }\n\n                    return maxValue;\n                }, 0);\n            }\n        }\n\n        return result;\n    }\n\n    /**\n     * Configures the stream encodings for the audio tracks that are added to the peerconnection.\n     *\n     * @param {Nullable<JitsiLocalTrack>} localAudioTrack - The local audio track.\n     * @returns {Promise} promise that will be resolved when the operation is successful and rejected otherwise.\n     */\n    configureAudioSenderEncodings(localAudioTrack: Nullable<JitsiLocalTrack> = null): Promise<PromiseSettledResult<void>[]> | Promise<void> {\n        if (localAudioTrack) {\n            return this._setEncodings(localAudioTrack);\n        }\n        const promises = [];\n\n        for (const track of this.getLocalTracks(MediaType.AUDIO)) {\n            promises.push(this._setEncodings(track));\n        }\n\n        return Promise.allSettled(promises);\n    }\n\n    /**\n     * Configures the stream encodings depending on the video type,\n     * scalability mode and the bitrate settings for the codec\n     * that is currently selected.\n     *\n     * @param {Nullable<JitsiLocalTrack>} - The local track for which the sender encodings have to configured.\n     * @param {CodecMimeType} - The preferred codec for the video track.\n     * @returns {Promise} promise that will be resolved when the operation is successful and rejected otherwise.\n     */\n    configureVideoSenderEncodings(localVideoTrack: Nullable<JitsiLocalTrack> = null, codec: Nullable<CodecMimeType> = null): Promise<PromiseSettledResult<void>[]> | Promise<void> {\n        const preferredCodec = codec ?? this.codecSettings.codecList[0];\n\n        if (localVideoTrack) {\n            const height = this._senderMaxHeights.get(localVideoTrack.getSourceName())\n            ?? VIDEO_QUALITY_LEVELS[0].height;\n\n            return this.setSenderVideoConstraints(height, localVideoTrack, preferredCodec);\n        }\n        const promises = [];\n\n        for (const track of this.getLocalVideoTracks()) {\n            const maxHeight = this._senderMaxHeights.get(track.getSourceName()) ?? VIDEO_QUALITY_LEVELS[0].height;\n\n            promises.push(this.setSenderVideoConstraints(maxHeight, track, preferredCodec));\n        }\n\n        return Promise.allSettled(promises);\n    }\n\n    /**\n     * Sets the local description on the peerconnection.\n     *\n     * @param {RTCSessionDescription} description - The local description to be set.\n     * @returns {Promise<void>} - Resolved when the operation is successful and rejected with an error otherwise.\n     */\n    setLocalDescription(description: RTCSessionDescription): Promise<void> {\n        let localDescription = description;\n\n        localDescription = this._mungeDescription(localDescription);\n\n        return new Promise((resolve, reject) => {\n            this.peerconnection.setLocalDescription(localDescription)\n                .then(() => {\n                    this.trace('setLocalDescriptionOnSuccess');\n                    const localUfrag = SDPUtil.getUfrag(localDescription.sdp);\n\n                    if (localUfrag !== this._localUfrag) {\n                        this._localUfrag = localUfrag;\n                        this.eventEmitter.emit(RTCEvents.LOCAL_UFRAG_CHANGED, this, localUfrag);\n                    }\n\n                    this._initializeDtlsTransport();\n\n                    resolve();\n                }, err => {\n                    this.trace('setLocalDescriptionOnFailure', err);\n                    reject(err);\n                });\n        });\n    }\n\n    /**\n     * Sets the remote description on the peerconnection.\n     *\n     * @param {RTCSessionDescription} description - The remote description to be set.\n     * @returns {Promise<void>} - Resolved when the operation is successful and rejected with an error otherwise.\n     */\n    setRemoteDescription(description: RTCSessionDescription): Promise<void> {\n        let remoteDescription = description;\n\n        if (this.isSpatialScalabilityOn()) {\n            remoteDescription = this.tpcUtils.insertUnifiedPlanSimulcastReceive(remoteDescription);\n            this.trace(\n                'setRemoteDescription::postTransform (sim receive)',\n                TraceablePeerConnection.dumpSDP(remoteDescription));\n        }\n        remoteDescription = this.tpcUtils.ensureCorrectOrderOfSsrcs(remoteDescription);\n        this.trace(\n            'setRemoteDescription::postTransform (correct ssrc order)',\n             TraceablePeerConnection.dumpSDP(remoteDescription));\n\n        remoteDescription = this._mungeDescription(remoteDescription);\n\n        return new Promise((resolve, reject) => {\n            this.peerconnection.setRemoteDescription(remoteDescription)\n                .then(() => {\n                    this.trace('setRemoteDescriptionOnSuccess');\n                    const remoteUfrag = SDPUtil.getUfrag(remoteDescription.sdp);\n\n                    if (remoteUfrag !== this._remoteUfrag) {\n                        this._remoteUfrag = remoteUfrag;\n                        this.eventEmitter.emit(RTCEvents.REMOTE_UFRAG_CHANGED, this, remoteUfrag);\n                    }\n\n                    this._initializeDtlsTransport();\n\n                    resolve();\n                })\n                .catch(err => {\n                    this.trace('setRemoteDescriptionOnFailure', err);\n                    reject(err);\n                });\n        });\n    }\n\n    /**\n     * Changes the resolution of the video stream that is sent to the peer based on the resolution requested by the peer\n     * and user preference, sets the degradation preference on the sender\n     * based on the video type, configures the maximum\n     * bitrates on the send stream.\n     *\n     * @param {number} frameHeight - The max frame height to be imposed on the outgoing video stream.\n     * @param {JitsiLocalTrack} - The local track for which the sender constraints have to be applied.\n     * @param {preferredCodec} - The video codec that needs to be configured on the\n     * sender associated with the video source.\n     * @returns {Promise} promise that will be resolved when the operation is successful and rejected otherwise.\n     */\n    setSenderVideoConstraints(frameHeight: number, localVideoTrack: JitsiLocalTrack, preferredCodec?: Optional<CodecMimeType>): Promise<void> {\n        if (frameHeight < 0 || !isValidNumber(frameHeight)) {\n            throw new Error(`Invalid frameHeight: ${frameHeight}`);\n        }\n        if (!localVideoTrack) {\n            throw new Error('Local video track is missing');\n        }\n        const sourceName = localVideoTrack.getSourceName();\n\n        this._senderMaxHeights.set(sourceName, frameHeight);\n\n        // Ignore sender constraints if the video track is muted.\n        if (localVideoTrack.isMuted()) {\n            return Promise.resolve();\n        }\n\n        const codec = preferredCodec ?? this.codecSettings.codecList[0];\n\n        return this._updateVideoSenderParameters(\n            () => this._updateVideoSenderEncodings(frameHeight, localVideoTrack, codec));\n    }\n\n    /**\n     * Resumes or suspends media on the peerconnection by setting the active state on RTCRtpEncodingParameters\n     * associated with all the senders that have a track attached to it.\n     *\n     * @param {boolean} enable - whether outgoing media needs to be enabled or disabled.\n     * @param {string} mediaType - media type, 'audio' or 'video', if neither is passed, all outgoing media will either\n     * be enabled or disabled.\n     * @returns {Promise} - A promise that is resolved when the change is succesful on all the senders, rejected\n     * otherwise.\n     */\n    setMediaTransferActive(enable: boolean, mediaType?: Optional<MediaType>): Promise<void> {\n        logger.info(`${this} ${enable ? 'Resuming' : 'Suspending'} media transfer.`);\n\n        const senders = this.peerconnection.getSenders()\n            .filter(s => Boolean(s.track) && (!mediaType || s.track.kind === mediaType));\n        const promises = [];\n\n        for (const sender of senders) {\n            if (sender.track.kind === MediaType.VIDEO) {\n                promises.push(this._updateVideoSenderParameters(() => this._enableSenderEncodings(sender, enable)));\n            } else {\n                promises.push(this._enableSenderEncodings(sender, enable));\n            }\n        }\n\n        return Promise.allSettled(promises)\n            .then(settledResult => {\n                const errors = settledResult\n                    .filter(result => result.status === 'rejected')\n                    .map(result => result.reason);\n\n                if (errors.length) {\n                    return Promise.reject(new Error('Failed to change encodings on the RTCRtpSenders'\n                        + `${errors.join(' ')}`));\n                }\n\n                return Promise.resolve();\n            });\n    }\n\n    /**\n     * Enables/disables outgoing video media transmission on this peer connection. When disabled the stream encoding's\n     * active state is enabled or disabled to send or stop the media.\n     * @param {boolean} active <tt>true</tt> to enable video media transmission\n     * or <tt>false</tt> to disable. If the value\n     * is not a boolean the call will have no effect.\n     * @return {Promise} A promise that is resolved when the change is succesful, rejected otherwise.\n     * @public\n     */\n    setVideoTransferActive(active: boolean): Promise<void> {\n        logger.debug(`${this} video transfer active: ${active}`);\n        const changed = this.videoTransferActive !== active;\n\n        this.videoTransferActive = active;\n\n        if (changed) {\n            return this.setMediaTransferActive(active, MediaType.VIDEO);\n        }\n\n        return Promise.resolve();\n    }\n\n    /**\n     * Sends DTMF tones if possible.\n     *\n     * @param {string} tones - The DTMF tones string as defined by {@code RTCDTMFSender.insertDTMF}, 'tones' argument.\n     * @param {number} duration - The amount of time in milliseconds that each DTMF should last. It's 200ms by default.\n     * @param {number} interToneGap - The length of time in miliseconds to wait between tones. It's 200ms by default.\n     *\n     * @returns {void}\n     */\n    sendTones(tones: string, duration = 200, interToneGap = 200): void {\n        if (!this._dtmfSender) {\n            if (this.peerconnection.getSenders) {\n                const rtpSender = this.peerconnection.getSenders().find(s => s.dtmf);\n\n                this._dtmfSender = rtpSender?.dtmf;\n                this._dtmfSender && logger.info(`${this} initialized DTMFSender using getSenders`);\n            }\n\n            if (!this._dtmfSender) {\n                const localAudioTrack = Array.from(this.localTracks.values()).find(t => t.isAudioTrack());\n\n                // @ts-ignore\n                if (this.peerconnection.createDTMFSender && localAudioTrack) {\n                    // @ts-ignore\n                    this._dtmfSender = this.peerconnection.createDTMFSender(localAudioTrack.getTrack());\n                }\n                this._dtmfSender && logger.info(`${this} initialized DTMFSender using deprecated createDTMFSender`);\n            }\n\n            if (this._dtmfSender) {\n                this._dtmfSender.ontonechange = this._onToneChange.bind(this);\n            }\n        }\n\n        if (this._dtmfSender) {\n            if (this._dtmfSender.toneBuffer) {\n                this._dtmfTonesQueue.push({\n                    duration,\n                    interToneGap,\n                    tones\n                });\n\n                return;\n            }\n\n            this._dtmfSender.insertDTMF(tones, duration, interToneGap);\n        } else {\n            logger.warn(`${this} sendTones - failed to select DTMFSender`);\n        }\n    }\n\n    /**\n     * Closes underlying WebRTC PeerConnection instance and removes all remote\n     * tracks by emitting {@link RTCEvents.REMOTE_TRACK_REMOVED} for each one of\n     * them.\n     */\n    close(): void {\n        this.trace('stop');\n\n        // Off SignalingEvents\n        this._signalingLayer.off(SignalingEvents.PEER_MUTED_CHANGED, this._peerMutedChanged);\n        this._signalingLayer.off(SignalingEvents.PEER_VIDEO_TYPE_CHANGED, this._peerVideoTypeChanged);\n        this.peerconnection.removeEventListener('track', this.onTrack);\n\n        if (FeatureFlags.isSsrcRewritingSupported()) {\n            for (const remoteTrack of this.remoteTracksBySsrc.values()) {\n                this._removeRemoteTrack(remoteTrack);\n            }\n            this.remoteTracksBySsrc.clear();\n        } else {\n            for (const peerTracks of this.remoteTracks.values()) {\n                for (const remoteTracks of peerTracks.values()) {\n                    for (const remoteTrack of remoteTracks) {\n                        this._removeRemoteTrack(remoteTrack);\n                    }\n                }\n            }\n            this.remoteTracks.clear();\n        }\n\n        this._dtmfSender = null;\n        this._dtmfTonesQueue = [];\n\n        if (!this.rtc._removePeerConnection(this)) {\n            logger.error(`${this} rtc._removePeerConnection returned false`);\n        }\n        if (this.statsinterval !== null) {\n            window.clearInterval(this.statsinterval);\n            this.statsinterval = null;\n        }\n        logger.info(`${this} Closing peerconnection`);\n        this.peerconnection.close();\n    }\n\n    /**\n     * Creates an SDP answer for the peer connection based on the provided constraints.\n     */\n    createAnswer(constraints: Optional<RTCOfferOptions>): Promise<RTCSessionDescription> {\n        return this._createOfferOrAnswer(false /* answer */, constraints);\n    }\n\n    /**\n     * Creates an SDP offer for the peer connection based on the provided constraints.\n     */\n    createOffer(constraints: Optional<RTCOfferOptions>): Promise<RTCSessionDescription> {\n        return this._createOfferOrAnswer(true /* offer */, constraints);\n    }\n\n    /**\n     * Track the SSRCs seen so far.\n     * @param {number} ssrc - SSRC.\n     * @return {boolean} - Whether this is a new SSRC.\n     */\n    addRemoteSsrc(ssrc: number): boolean {\n        const existing = this.remoteSSRCs.has(ssrc);\n\n        if (!existing) {\n            this.remoteSSRCs.add(ssrc);\n        }\n\n        return !existing;\n    }\n\n    /**\n     * Adds an ICE candidate to the peer connection.\n     */\n    addIceCandidate(candidate: RTCIceCandidate): Promise<void> {\n        this.trace('addIceCandidate', JSON.stringify({\n            candidate: candidate.candidate,\n            sdpMLineIndex: candidate.sdpMLineIndex,\n            sdpMid: candidate.sdpMid,\n            usernameFragment: candidate.usernameFragment\n        }, null, ' '));\n\n        return this.peerconnection.addIceCandidate(candidate);\n    }\n\n    /**\n     * Obtains call-related stats from the peer connection.\n     *\n     * @returns {Promise<Object>} Promise which resolves with data providing statistics about\n     * the peerconnection.\n     */\n    getStats(): Promise<RTCStatsReport> {\n        return this.peerconnection.getStats();\n    }\n\n    /**\n     * Creates a text representation of this <tt>TraceablePeerConnection</tt>\n     * instance.\n     * @return {string}\n     */\n    toString(): string {\n        return `TPC[id=${this.id},type=${this.isP2P ? 'P2P' : 'JVB'}]`;\n    }\n}\n","import { getLogger } from '@jitsi/logger';\nimport { cloneDeep, isEqual } from 'lodash-es';\n\nimport { JitsiConferenceEvents } from '../../JitsiConferenceEvents';\nimport { MediaType } from '../../service/RTC/MediaType';\nimport { RTCEvents } from '../../service/RTC/RTCEvents';\nimport { VideoType } from '../../service/RTC/VideoType';\nimport browser from '../browser';\nimport Listenable from '../util/Listenable';\nimport { safeCounterIncrement } from '../util/MathUtil';\n\nimport BridgeChannel from './BridgeChannel';\nimport JitsiLocalTrack from './JitsiLocalTrack';\nimport RTCUtils from './RTCUtils';\nimport TraceablePeerConnection from './TraceablePeerConnection';\n\n\nconst logger = getLogger('rtc:RTC');\n\n/**\n * The counter used to generated id numbers assigned to peer connections\n * @type {number}\n */\nlet peerConnectionIdCounter = 0;\n\n/**\n * The counter used to generate id number for the local\n * <code>MediaStreamTrack</code>s.\n * @type {number}\n */\nlet rtcTrackIdCounter = 0;\n\n/**\n * Creates {@code JitsiLocalTrack} instances from the passed in meta information\n * about MedieaTracks.\n *\n * @param {Object[]} mediaStreamMetaData - An array of meta information with\n * MediaTrack instances. Each can look like:\n * {{\n *     stream: MediaStream instance that holds a track with audio or video,\n *     track: MediaTrack within the MediaStream,\n *     videoType: \"camera\" or \"desktop\" or falsy,\n *     sourceId: ID of the desktopsharing source,\n *     sourceType: The desktopsharing source type,\n *     effects: Array of effect types\n * }}\n */\nfunction _createLocalTracks(mediaStreamMetaData = []) {\n    return mediaStreamMetaData.map(metaData => {\n        const {\n            constraints,\n            sourceId,\n            sourceType,\n            stream,\n            track,\n            videoType,\n            effects\n        } = metaData;\n\n        const { deviceId, facingMode } = track.getSettings();\n\n        // FIXME Move rtcTrackIdCounter to a static method in JitsiLocalTrack\n        // so RTC does not need to handle ID management. This move would be\n        // safer to do once the old createLocalTracks is removed.\n        rtcTrackIdCounter = safeCounterIncrement(rtcTrackIdCounter);\n\n        return new JitsiLocalTrack({\n            constraints,\n            deviceId,\n            effects,\n            facingMode,\n            mediaType: track.kind,\n            rtcId: rtcTrackIdCounter,\n            sourceId,\n            sourceType,\n            stream,\n            track,\n            videoType: videoType || null\n        });\n    });\n}\n\n/**\n *\n */\nexport default class RTC extends Listenable {\n    /**\n     *\n     * @param conference\n     * @param options\n     */\n    constructor(conference, options = {}) {\n        super();\n        this.conference = conference;\n\n        /**\n         * A map of active <tt>TraceablePeerConnection</tt>.\n         * @type {Map.<number, TraceablePeerConnection>}\n         */\n        this.peerConnections = new Map();\n\n        this.localTracks = [];\n\n        this.options = options;\n\n        // BridgeChannel instance.\n        // @private\n        // @type {BridgeChannel}\n        this._channel = null;\n\n        /**\n         * The value specified to the last invocation of setLastN before the\n         * channel completed opening. If non-null, the value will be sent\n         * through a channel (once) as soon as it opens and will then be\n         * discarded.\n         * @private\n         * @type {number}\n         */\n        this._lastN = undefined;\n\n        /**\n         * Defines the forwarded sources list. It can be null or an array once initialised with a channel forwarded\n         * sources event.\n         *\n         * @type {Array<string>|null}\n         * @private\n         */\n        this._forwardedSources = null;\n\n        // The forwarded sources change listener.\n        this._forwardedSourcesChangeListener = this._onForwardedSourcesChanged.bind(this);\n\n        this._onDeviceListChanged = this._onDeviceListChanged.bind(this);\n        this._updateAudioOutputForAudioTracks = this._updateAudioOutputForAudioTracks.bind(this);\n\n        // Switch audio output device on all remote audio tracks. Local audio\n        // tracks handle this event by themselves.\n        if (RTCUtils.isDeviceChangeAvailable('output')) {\n            RTCUtils.addListener(\n                RTCEvents.AUDIO_OUTPUT_DEVICE_CHANGED,\n                this._updateAudioOutputForAudioTracks\n            );\n\n            RTCUtils.addListener(\n                RTCEvents.DEVICE_LIST_CHANGED,\n                this._onDeviceListChanged\n            );\n        }\n    }\n\n    /**\n     * Removes any listeners and stored state from this {@code RTC} instance.\n     *\n     * @returns {void}\n     */\n    destroy() {\n        RTCUtils.removeListener(RTCEvents.AUDIO_OUTPUT_DEVICE_CHANGED, this._updateAudioOutputForAudioTracks);\n        RTCUtils.removeListener(RTCEvents.DEVICE_LIST_CHANGED, this._onDeviceListChanged);\n\n        if (this._channelOpenListener) {\n            this.removeListener(RTCEvents.DATA_CHANNEL_OPEN, this._channelOpenListener);\n        }\n    }\n\n    /**\n     * Exposes the private helper for converting a WebRTC MediaStream to a\n     * JitsiLocalTrack.\n     *\n     * @param {Array<Object>} tracksInfo\n     * @returns {Array<JitsiLocalTrack>}\n     */\n    static createLocalTracks(tracksInfo) {\n        return _createLocalTracks(tracksInfo);\n    }\n\n    /**\n     * Creates the local MediaStreams.\n     * @param {object} [options] Optional parameters.\n     * @param {Array=} options.devices The devices that will be requested.\n     * @param {string=} options.resolution Resolution constraints.\n     * @param {string=} options.cameraDeviceId\n     * @param {string=} options.micDeviceId\n     * @returns {*} Promise object that will receive the new JitsiTracks\n     */\n    static obtainAudioAndVideoPermissions(options) {\n        return RTCUtils.obtainAudioAndVideoPermissions(options)\n            .then(tracksInfo => _createLocalTracks(tracksInfo));\n    }\n\n    /**\n     * Initializes the bridge channel of this instance.\n     * At least one of both, peerconnection or wsUrl parameters, must be\n     * given.\n     * @param {RTCPeerConnection} [peerconnection] WebRTC peer connection\n     * instance.\n     * @param {string} [wsUrl] WebSocket URL.\n     */\n    initializeBridgeChannel(peerconnection, wsUrl) {\n        this._channel = new BridgeChannel(peerconnection, wsUrl, this.eventEmitter, this.conference);\n\n        this._channelOpenListener = () => {\n            const logError = (error, msgType, value) => {\n                logger.error(`Cannot send ${msgType}(${JSON.stringify(value)}) endpoint message`, error);\n            };\n\n            // When the channel becomes available, tell the bridge about video selections so that it can do adaptive\n            // simulcast, we want the notification to trigger even if userJid is undefined, or null.\n            if (this._receiverVideoConstraints) {\n                try {\n                    this._channel.sendReceiverVideoConstraintsMessage(this._receiverVideoConstraints);\n                } catch (error) {\n                    logError(error, 'ReceiverVideoConstraints', this._receiverVideoConstraints);\n                }\n            }\n            if (typeof this._lastN !== 'undefined' && this._lastN !== -1) {\n                try {\n                    this._channel.sendSetLastNMessage(this._lastN);\n                } catch (error) {\n                    logError(error, 'LastNChangedEvent', this._lastN);\n                }\n            }\n        };\n        this.addListener(RTCEvents.DATA_CHANNEL_OPEN, this._channelOpenListener);\n\n        // Add forwarded sources change listener.\n        this.addListener(RTCEvents.FORWARDED_SOURCES_CHANGED, this._forwardedSourcesChangeListener);\n    }\n\n    /**\n     * Callback invoked when the list of known audio and video devices has\n     * been updated. Attempts to update the known available audio output\n     * devices.\n     *\n     * @private\n     * @returns {void}\n     */\n    _onDeviceListChanged() {\n        this._updateAudioOutputForAudioTracks(RTCUtils.getAudioOutputDevice());\n    }\n\n    /**\n     * Receives events when forwarded sources had changed.\n     *\n     * @param {array} forwardedSources The new forwarded sources.\n     * @private\n     */\n    _onForwardedSourcesChanged(forwardedSources = []) {\n        const oldForwardedSources = this._forwardedSources || [];\n        let leavingForwardedSources = [];\n        let enteringForwardedSources = [];\n        const timestamp = Date.now();\n\n        this._forwardedSources = forwardedSources;\n\n        leavingForwardedSources = oldForwardedSources.filter(sourceName => !this.isInForwardedSources(sourceName));\n\n        enteringForwardedSources = forwardedSources.filter(\n            sourceName => oldForwardedSources.indexOf(sourceName) === -1);\n\n        logger.debug(`Fowarded sources changed leaving=${leavingForwardedSources}, entering=`\n            + `${enteringForwardedSources} at ${timestamp}`);\n        this.conference.eventEmitter.emit(\n            JitsiConferenceEvents.FORWARDED_SOURCES_CHANGED,\n            leavingForwardedSources,\n            enteringForwardedSources,\n            timestamp);\n    }\n\n    /**\n     * Should be called when current media session ends and after the\n     * PeerConnection has been closed using PeerConnection.close() method.\n     */\n    onCallEnded() {\n        if (this._channel) {\n            // The BridgeChannel is not explicitly closed as the PeerConnection\n            // is closed on call ended which triggers datachannel onclose\n            // events. If using a WebSocket, the channel must be closed since\n            // it is not managed by the PeerConnection.\n            // The reference is cleared to disable any logic related to the\n            // channel.\n            if (this._channel && this._channel.mode === 'websocket') {\n                this._channel.close();\n            }\n\n            this._channel = null;\n        }\n    }\n\n    /**\n     * Sets the capture frame rate to be used for desktop tracks.\n     *\n     * @param {number} maxFps framerate to be used for desktop track capture.\n     */\n    setDesktopSharingFrameRate(maxFps) {\n        RTCUtils.setDesktopSharingFrameRate(maxFps);\n    }\n\n    /**\n     * Sets the receiver video constraints that determine how bitrate is allocated to each of the video streams\n     * requested from the bridge. The constraints are cached and sent through the bridge channel once the channel\n     * is established.\n     * @param {*} constraints\n     */\n    setReceiverVideoConstraints(constraints) {\n        if (isEqual(this._receiverVideoConstraints, constraints)) {\n            return;\n        }\n\n        this._receiverVideoConstraints = cloneDeep(constraints);\n\n        if (this._channel && this._channel.isOpen()) {\n            this._channel.sendReceiverVideoConstraintsMessage(constraints);\n        }\n    }\n\n    /**\n     * Sends the track's  video type to the JVB.\n     * @param {SourceName} sourceName - the track's source name.\n     * @param {BridgeVideoType} videoType - the track's video type.\n     */\n    sendSourceVideoType(sourceName, videoType) {\n        if (this._channel && this._channel.isOpen()) {\n            this._channel.sendSourceVideoTypeMessage(sourceName, videoType);\n        }\n    }\n\n    /**\n     *\n     * @param eventType\n     * @param listener\n     */\n    static addListener(eventType, listener) {\n        RTCUtils.addListener(eventType, listener);\n    }\n\n    /**\n     *\n     * @param eventType\n     * @param listener\n     */\n    static removeListener(eventType, listener) {\n        RTCUtils.removeListener(eventType, listener);\n    }\n\n    /**\n     *\n     * @param options\n     */\n    static init(options = {}) {\n        this.options = options;\n\n        return RTCUtils.init(this.options);\n    }\n\n    /* eslint-disable max-params */\n\n    /**\n     * Creates new <tt>TraceablePeerConnection</tt>\n     * @param {SignalingLayer} signaling The signaling layer that will provide information about the media or\n     * participants which is not carried over SDP.\n     * @param {object} pcConfig The {@code RTCConfiguration} to use for the WebRTC peer connection.\n     * @param {boolean} isP2P Indicates whether or not the new TPC will be used in a peer to peer type of session.\n     * @param {object} options The config options.\n     * @param {Object} options.audioQuality - Quality settings to applied on the outbound audio stream.\n     * @param {boolean} options.capScreenshareBitrate if set to true, lower layers will be disabled for screenshare.\n     * @param {Array<CodecMimeType>} options.codecSettings - codec settings to be applied for video streams.\n     * @param {boolean} options.disableSimulcast if set to 'true' will disable the simulcast.\n     * @param {boolean} options.disableRtx if set to 'true' will disable the RTX.\n     * @param {boolean} options.enableInsertableStreams set to true when the insertable streams constraints is to be\n     * enabled on the PeerConnection.\n     * @param {boolean} options.forceTurnRelay If set to true, the browser will generate only Relay ICE candidates.\n     * @param {boolean} options.startSilent If set to 'true' no audio will be sent or received.\n     * @param {Object} options.videoQuality - Quality settings to applied on the outbound video streams.\n     * @return {TraceablePeerConnection}\n     */\n    createPeerConnection(signaling, pcConfig, isP2P, options) {\n        const pcConstraints = {};\n\n        if (options.enableInsertableStreams) {\n            logger.debug('E2EE - setting insertable streams constraints');\n            pcConfig.encodedInsertableStreams = true;\n        }\n\n        if (options.forceTurnRelay) {\n            pcConfig.iceTransportPolicy = 'relay';\n        }\n\n        // Set the RTCBundlePolicy to max-bundle so that only one set of ice candidates is generated.\n        // The default policy generates separate ice candidates for audio and video connections.\n        // This change is necessary for Unified plan to work properly on Chrome and Safari.\n        pcConfig.bundlePolicy = 'max-bundle';\n\n        peerConnectionIdCounter = safeCounterIncrement(peerConnectionIdCounter);\n\n        const newConnection\n            = new TraceablePeerConnection(\n                this,\n                peerConnectionIdCounter,\n                signaling,\n                pcConfig, pcConstraints,\n                isP2P, options);\n\n        this.peerConnections.set(newConnection.id, newConnection);\n\n        return newConnection;\n    }\n\n    /* eslint-enable max-params */\n\n    /**\n     * Removed given peer connection from this RTC module instance.\n     * @param {TraceablePeerConnection} traceablePeerConnection\n     * @return {boolean} <tt>true</tt> if the given peer connection was removed\n     * successfully or <tt>false</tt> if there was no peer connection mapped in\n     * this RTC instance.\n     */\n    _removePeerConnection(traceablePeerConnection) {\n        const id = traceablePeerConnection.id;\n\n        if (this.peerConnections.has(id)) {\n            // NOTE Remote tracks are not removed here.\n            this.peerConnections.delete(id);\n\n            return true;\n        }\n\n        return false;\n\n    }\n\n    /**\n     *\n     * @param track\n     */\n    addLocalTrack(track) {\n        if (!track) {\n            throw new Error('track must not be null nor undefined');\n        }\n\n        this.localTracks.push(track);\n\n        track.conference = this.conference;\n    }\n\n    /**\n     * Get forwarded sources list.\n     * @returns {Array<string>|null}\n     */\n    getForwardedSources() {\n        return this._forwardedSources;\n    }\n\n    /**\n     * Get local video track.\n     * @returns {JitsiLocalTrack|undefined}\n     */\n    getLocalVideoTrack() {\n        const localVideo = this.getLocalTracks(MediaType.VIDEO);\n\n        return localVideo.length ? localVideo[0] : undefined;\n    }\n\n    /**\n     * Returns all the local video tracks.\n     * @returns {Array<JitsiLocalTrack>}\n     */\n    getLocalVideoTracks() {\n        return this.getLocalTracks(MediaType.VIDEO);\n    }\n\n    /**\n     * Get local audio track.\n     * @returns {JitsiLocalTrack|undefined}\n     */\n    getLocalAudioTrack() {\n        const localAudio = this.getLocalTracks(MediaType.AUDIO);\n\n        return localAudio.length ? localAudio[0] : undefined;\n    }\n\n    /**\n     * Returns the endpoint id for the local user.\n     * @returns {string}\n     */\n    getLocalEndpointId() {\n        return this.conference.myUserId();\n    }\n\n    /**\n     * Returns the local tracks of the given media type, or all local tracks if\n     * no specific type is given.\n     * @param {MediaType} [mediaType] Optional media type filter.\n     * (audio or video).\n     */\n    getLocalTracks(mediaType) {\n        if (!mediaType) {\n            return this.localTracks.slice();\n        }\n\n        return this.localTracks.filter(\n                track => track.getType() === mediaType);\n    }\n\n    /**\n     * Obtains all remote tracks currently known to this RTC module instance.\n     * @param {MediaType} [mediaType] The remote tracks will be filtered\n     *      by their media type if this argument is specified.\n     * @return {Array<JitsiRemoteTrack>}\n     */\n    getRemoteTracks(mediaType) {\n        let remoteTracks = [];\n\n        for (const tpc of this.peerConnections.values()) {\n            const pcRemoteTracks = tpc.getRemoteTracks(undefined, mediaType);\n\n            if (pcRemoteTracks) {\n                remoteTracks = remoteTracks.concat(pcRemoteTracks);\n            }\n        }\n\n        return remoteTracks;\n    }\n\n    /**\n     * Set mute for all local audio streams attached to the conference.\n     * @returns {Promise}\n     */\n    setAudioMute() {\n        const mutePromises = [];\n\n        this.getLocalTracks(MediaType.AUDIO).forEach(audioTrack => {\n            mutePromises.push(audioTrack.mute());\n        });\n\n        return Promise.all(mutePromises);\n    }\n\n    /**\n    * Set mute for all local video streams attached to the conference.\n    * @returns {Promise}\n    */\n    setVideoMute() {\n        const mutePromises = [];\n        const tracks = this.localTracks.filter(\n                track => track.getType() === MediaType.VIDEO\n                && track.getVideoType() === VideoType.CAMERA);\n\n        tracks.forEach(track => mutePromises.push(track.mute()));\n\n        return Promise.all(mutePromises);\n    }\n\n    /**\n    * Set mute for all local desktop video streams attached to the conference.\n    * @returns {Promise}\n    */\n    setDesktopMute() {\n        const mutePromises = [];\n        const tracks = this.localTracks.filter(\n                track => track.getType() === MediaType.VIDEO\n                && track.getVideoType() === VideoType.DESKTOP);\n\n        tracks.forEach(track => mutePromises.push(track.mute()));\n\n        return Promise.all(mutePromises);\n    }\n\n    /**\n     *\n     * @param track\n     */\n    removeLocalTrack(track) {\n        const pos = this.localTracks.indexOf(track);\n\n        if (pos === -1) {\n            return;\n        }\n\n        this.localTracks.splice(pos, 1);\n    }\n\n    /**\n     *\n     * @param elSelector\n     * @param stream\n     */\n    static attachMediaStream(elSelector, stream) {\n        return RTCUtils.attachMediaStream(elSelector, stream);\n    }\n\n    /**\n     * Returns true if changing the input (camera / microphone) or output\n     * (audio) device is supported and false if not.\n     * @param {string} [deviceType] Type of device to change. Default is\n     *      undefined or 'input', 'output' - for audio output device change.\n     * @returns {boolean} true if available, false otherwise.\n     */\n    static isDeviceChangeAvailable(deviceType) {\n        return RTCUtils.isDeviceChangeAvailable(deviceType);\n    }\n\n    /**\n     * Returns whether the current execution environment supports WebRTC (for\n     * use within this library).\n     *\n     * @returns {boolean} {@code true} if WebRTC is supported in the current\n     * execution environment (for use within this library); {@code false},\n     * otherwise.\n     */\n    static isWebRtcSupported() {\n        return browser.isSupported();\n    }\n\n    /**\n     * Returns currently used audio output device id, '' stands for default\n     * device\n     * @returns {string}\n     */\n    static getAudioOutputDevice() {\n        return RTCUtils.getAudioOutputDevice();\n    }\n\n    /**\n     * Returns list of available media devices if its obtained, otherwise an\n     * empty array is returned/\n     * @returns {array} list of available media devices.\n     */\n    static getCurrentlyAvailableMediaDevices() {\n        return RTCUtils.getCurrentlyAvailableMediaDevices();\n    }\n\n    /**\n     * Returns event data for device to be reported to stats.\n     * @returns {MediaDeviceInfo} device.\n     */\n    static getEventDataForActiveDevice(device) {\n        return RTCUtils.getEventDataForActiveDevice(device);\n    }\n\n    /**\n     * Sets current audio output device.\n     * @param {string} deviceId Id of 'audiooutput' device from\n     *      navigator.mediaDevices.enumerateDevices().\n     * @returns {Promise} resolves when audio output is changed, is rejected\n     *      otherwise\n     */\n    static setAudioOutputDevice(deviceId) {\n        return RTCUtils.setAudioOutputDevice(deviceId);\n    }\n\n    /**\n     * Allows to receive list of available cameras/microphones.\n     * @param {function} callback Would receive array of devices as an\n     *      argument.\n     */\n    static enumerateDevices(callback) {\n        RTCUtils.enumerateDevices(callback);\n    }\n\n    /**\n     * A method to handle stopping of the stream.\n     * One point to handle the differences in various implementations.\n     * @param {MediaStream} mediaStream MediaStream object to stop.\n     */\n    static stopMediaStream(mediaStream) {\n        RTCUtils.stopMediaStream(mediaStream);\n    }\n\n    /**\n     * Returns whether the desktop sharing is enabled or not.\n     * @returns {boolean}\n     */\n    static isDesktopSharingEnabled() {\n        return RTCUtils.isDesktopSharingEnabled();\n    }\n\n    /**\n     * Closes the currently opened bridge channel.\n     */\n    closeBridgeChannel() {\n        if (this._channel) {\n            this._channel.close();\n            this._channel = null;\n        }\n    }\n\n    /* eslint-disable max-params */\n    /**\n     *\n     * @param {TraceablePeerConnection} tpc\n     * @param {number} ssrc\n     * @param {number} audioLevel\n     * @param {boolean} isLocal\n     */\n    setAudioLevel(tpc, ssrc, audioLevel, isLocal) {\n        const track = tpc.getTrackBySSRC(ssrc);\n\n        if (!track) {\n            return;\n        } else if (!track.isAudioTrack()) {\n            logger.warn(`Received audio level for non-audio track: ${ssrc}`);\n\n            return;\n        } else if (track.isLocal() !== isLocal) {\n            logger.error(\n                `${track} was expected to ${isLocal ? 'be' : 'not be'} local`);\n        }\n\n        track.setAudioLevel(audioLevel, tpc);\n    }\n\n    /**\n     * Sends message via the bridge channel.\n     * @param {string} to The id of the endpoint that should receive the\n     *      message. If \"\" the message will be sent to all participants.\n     * @param {object} payload The payload of the message.\n     * @throws NetworkError or InvalidStateError or Error if the operation\n     * fails or there is no data channel created.\n     */\n    sendChannelMessage(to, payload) {\n        if (this._channel) {\n            this._channel.sendMessage(to, payload);\n        } else {\n            throw new Error('BridgeChannel has not been initialized yet');\n        }\n    }\n\n    /**\n     * Sends the local stats via the bridge channel.\n     * @param {Object} payload The payload of the message.\n     * @throws NetworkError/InvalidStateError/Error if the operation fails or if there is no data channel created.\n     */\n    sendEndpointStatsMessage(payload) {\n        if (this._channel && this._channel.isOpen()) {\n            this._channel.sendEndpointStatsMessage(payload);\n        }\n    }\n\n    /**\n     * Sends a receiver audio subscription message.\n     * @param {*} message\n     */\n    sendReceiverAudioSubscriptionMessage(message) {\n        if (this._channel && this._channel.isOpen()) {\n            this._channel.sendReceiverAudioSubscriptionMessage(message);\n        }\n    }\n\n    /**\n     * Selects a new value for \"lastN\". The requested amount of videos are going\n     * to be delivered after the value is in effect. Set to -1 for unlimited or\n     * all available videos.\n     * @param {number} value the new value for lastN.\n     */\n    setLastN(value) {\n        if (this._lastN !== value) {\n            this._lastN = value;\n            if (this._channel && this._channel.isOpen()) {\n                this._channel.sendSetLastNMessage(value);\n            }\n            this.eventEmitter.emit(RTCEvents.LASTN_VALUE_CHANGED, value);\n        }\n    }\n\n    /**\n     * Indicates if the source name is currently included in the forwarded sources.\n     *\n     * @param {string} sourceName The source name that we check for forwarded sources.\n     * @returns {boolean} true if the source name is in the forwarded sources or if we don't have bridge channel\n     * support, otherwise we return false.\n     */\n    isInForwardedSources(sourceName) {\n        return !this._forwardedSources // forwardedSources not initialised yet.\n            || this._forwardedSources.indexOf(sourceName) > -1;\n    }\n\n    /**\n     * Updates the target audio output device for all remote audio tracks.\n     *\n     * @param {string} deviceId - The device id of the audio ouput device to\n     * use for all remote tracks.\n     * @private\n     * @returns {void}\n     */\n    _updateAudioOutputForAudioTracks(deviceId) {\n        const remoteAudioTracks = this.getRemoteTracks(MediaType.AUDIO);\n\n        for (const track of remoteAudioTracks) {\n            track.setAudioOutput(deviceId);\n        }\n    }\n}\n","export enum ConnectionQualityEvents {\n\n    /**\n     * Indicates that the local connection statistics were updated.\n     */\n    LOCAL_STATS_UPDATED = 'cq.local_stats_updated',\n\n    /**\n     * Indicates that the connection statistics for a particular remote participant\n     * were updated.\n     */\n    REMOTE_STATS_UPDATED = 'cq.remote_stats_updated'\n}\n","import { getLogger } from '@jitsi/logger';\n\nimport JitsiConference, { IConferenceOptions } from '../../JitsiConference';\nimport { JitsiConferenceEvents as ConferenceEvents } from '../../JitsiConferenceEvents';\nimport JitsiParticipant from '../../JitsiParticipant';\nimport { RTCEvents } from '../../service/RTC/RTCEvents';\nimport Resolutions from '../../service/RTC/Resolutions';\nimport { VIDEO_QUALITY_LEVELS } from '../../service/RTC/StandardVideoQualitySettings';\nimport { VideoType } from '../../service/RTC/VideoType';\nimport { ConnectionQualityEvents } from '../../service/connectivity/ConnectionQualityEvents';\nimport { XMPPEvents } from '../../service/xmpp/XMPPEvents';\nimport TraceablePeerConnection from '../RTC/TraceablePeerConnection';\nimport EventEmitter from '../util/EventEmitter';\nimport JingleSessionPC from '../xmpp/JingleSessionPC';\n\nconst logger = getLogger('connectivity:ConnectionQuality');\n\n/**\n * The value to use for the \"type\" field for messages sent by ConnectionQuality\n * over the data channel.\n */\nconst STATS_MESSAGE_TYPE = 'stats';\n\n/**\n * The maximum bitrate to use as a measurement against the participant's current\n * bitrate. This cap helps in the cases where the participant's bitrate is high\n * but not enough to fulfill high targets, such as with 1080p.\n */\nconst MAX_TARGET_BITRATE = 2500;\n\n/**\n * The initial bitrate for video in kbps.\n */\nconst startBitrate = 800;\n\n/**\n * Gets the expected bitrate (in kbps) in perfect network conditions.\n * @param simulcast {boolean} whether simulcast is enabled or not.\n * @param resolution {Resolution} the resolution.\n * @param millisSinceStart {number} the number of milliseconds since sending video started.\n * @param bitrates {Object} the bitrates for the local video source.\n */\nfunction getTarget(simulcast: boolean, resolution: { height: number; width: number; }, millisSinceStart: number, bitrates?: { download: number; upload: number; }): number {\n    let target = 0;\n    let height = Math.min(resolution.height, resolution.width);\n\n    // Find the first format with height no bigger than ours.\n    let qualityLevel = VIDEO_QUALITY_LEVELS.find(f => f.height <= height);\n\n    if (qualityLevel && simulcast) {\n        // Sum the target fields from all simulcast layers for the given\n        // resolution (e.g. 720p + 360p + 180p) for VP8 simulcast.\n        for (height = qualityLevel.height; height >= 180; height /= 2) {\n            const targetHeight = height;\n\n            qualityLevel = VIDEO_QUALITY_LEVELS.find(f => f.height === targetHeight);\n            if (qualityLevel) {\n                target += bitrates[qualityLevel.level];\n            } else {\n                break;\n            }\n        }\n    } else if (qualityLevel) {\n        // For VP9 SVC, H.264 (simulcast automatically disabled) and p2p, target bitrate will be\n        // same as that of the individual stream bitrate.\n        target = bitrates[qualityLevel.level];\n    }\n\n    // Allow for an additional 1 second for ramp up -- delay any initial drop\n    // of connection quality by 1 second. Convert target from bps to kbps.\n    return Math.min(target / 1000, rampUp(Math.max(0, millisSinceStart - 1000)));\n}\n\n/**\n * Gets the bitrate to which GCC would have ramped up in perfect network\n * conditions after millisSinceStart milliseconds.\n * @param millisSinceStart {number} the number of milliseconds since sending\n * video was enabled.\n */\nfunction rampUp(millisSinceStart: number): number {\n    if (millisSinceStart > 60000) {\n        return Number.MAX_SAFE_INTEGER;\n    }\n\n    // According to GCC the send side bandwidth estimation grows with at most\n    // 8% per second.\n    // https://tools.ietf.org/html/draft-ietf-rmcat-gcc-02#section-5.5\n    return startBitrate * Math.pow(1.08, millisSinceStart / 1000);\n}\n\nexport interface ILocalStats {\n    bandwidth?: {\n        download?: number;\n        upload?: number;\n    };\n    bitrate?: {\n        upload: number;\n    };\n    bridgeCount?: number;\n    connectionQuality: number;\n    jvbRTT?: number;\n    maxEnabledResolution?: { height: number; width: number; };\n    packetLoss?: {\n        upload?: number;\n    };\n    serverRegion?: string;\n}\n\nexport type IRemoteStats = Pick<\n    ILocalStats,\n    'bitrate' | 'connectionQuality' | 'jvbRTT' | 'maxEnabledResolution' | 'packetLoss' | 'serverRegion'\n>;\n\n/**\n * A class which monitors the local statistics coming from the RTC modules, and\n * calculates a \"connection quality\" value, in percent, for the media\n * connection. A value of 100% indicates a very good network connection, and a\n * value of 0% indicates a poor connection.\n */\nexport default class ConnectionQuality {\n    private eventEmitter: EventEmitter;\n    private _conference: JitsiConference;\n    private _localStats: ILocalStats;\n    private _lastConnectionQualityUpdate: number;\n    private _options: IConferenceOptions;\n    private _remoteStats: { [key: string]: any; };\n    private _timeIceConnected: number;\n    private _timeVideoUnmuted: number;\n\n    /**\n     *\n     * @param conference\n     * @param eventEmitter\n     * @param options\n     */\n    constructor(conference: JitsiConference, eventEmitter: EventEmitter, options: IConferenceOptions) {\n        this.eventEmitter = eventEmitter;\n\n        /**\n         * The owning JitsiConference.\n         */\n        this._conference = conference;\n\n        /**\n         * Holds statistics about the local connection quality.\n         */\n        this._localStats = {\n            connectionQuality: 100,\n            jvbRTT: undefined\n        };\n\n        /**\n         * The time this._localStats.connectionQuality was last updated.\n         */\n        this._lastConnectionQualityUpdate = -1;\n\n        /**\n         * Conference options.\n         */\n        this._options = options;\n\n        /**\n         * Maps a participant ID to an object holding connection quality\n         * statistics received from this participant.\n         */\n        this._remoteStats = {};\n\n        /**\n         * The time that the ICE state last changed to CONNECTED. We use this\n         * to calculate how much time we as a sender have had to ramp-up.\n         */\n        this._timeIceConnected = -1;\n\n        /**\n         * The time that local video was unmuted. We use this to calculate how\n         * much time we as a sender have had to ramp-up.\n         */\n        this._timeVideoUnmuted = -1;\n\n        conference.on(\n            ConferenceEvents.BRIDGE_BWE_STATS_RECEIVED,\n            bwe => {\n                if (bwe && this._localStats?.bandwidth) {\n                    this._localStats.bandwidth.download = Math.floor(bwe / 1000);\n                }\n            });\n\n        // TODO: consider ignoring these events and letting the user of\n        // lib-jitsi-meet handle these separately.\n        conference.on(\n            ConferenceEvents.CONNECTION_INTERRUPTED,\n            () => {\n                this._updateLocalConnectionQuality(0);\n                this.eventEmitter.emit(ConnectionQualityEvents.LOCAL_STATS_UPDATED, this._localStats);\n                this._broadcastLocalStats();\n            });\n\n        conference.room.addListener(\n            XMPPEvents.ICE_CONNECTION_STATE_CHANGED,\n            (jingleSession: JingleSessionPC, newState: string) => {\n                if (!jingleSession.isP2P && newState === 'connected') {\n                    this._timeIceConnected = window.performance.now();\n                }\n            });\n\n        // Listen to DataChannel message from other participants in the\n        // conference, and update the _remoteStats field accordingly.\n        // TODO - Delete this when all the mobile endpoints switch to using the new Colibri\n        // message format for sending the endpoint stats.\n        conference.on(\n            ConferenceEvents.ENDPOINT_MESSAGE_RECEIVED,\n            (participant: JitsiParticipant, payload: { type: string; values: any; }) => {\n                if (payload.type === STATS_MESSAGE_TYPE) {\n                    this._updateRemoteStats(participant.getId(), payload.values);\n                }\n            });\n\n        conference.on(\n            ConferenceEvents.ENDPOINT_STATS_RECEIVED,\n            (participant: JitsiParticipant, payload: IRemoteStats) => {\n                this._updateRemoteStats(participant.getId(), payload);\n            });\n\n        if (!this._options.config.disableLocalStats) {\n            // Listen to local statistics events originating from the RTC module and update the _localStats field.\n            conference.statistics.addConnectionStatsListener(this._updateLocalStats.bind(this));\n        }\n\n        // Save the last time we were unmuted.\n        conference.on(\n            ConferenceEvents.TRACK_MUTE_CHANGED,\n            track => {\n                if (track.isVideoTrack()) {\n                    if (track.isMuted()) {\n                        this._timeVideoUnmuted = -1;\n                    } else {\n                        this._maybeUpdateUnmuteTime();\n                    }\n                }\n            });\n        conference.on(\n            ConferenceEvents.TRACK_ADDED,\n            track => {\n                if (track.isVideoTrack() && !track.isMuted()) {\n                    this._maybeUpdateUnmuteTime();\n                }\n            });\n\n        conference.on(ConferenceEvents.VIDEO_CODEC_CHANGED, this._resetVideoUnmuteTime.bind(this));\n\n        conference.on(ConferenceEvents._MEDIA_SESSION_ACTIVE_CHANGED, this._resetVideoUnmuteTime.bind(this));\n\n        conference.rtc.on(\n            RTCEvents.LOCAL_TRACK_MAX_ENABLED_RESOLUTION_CHANGED,\n            track => {\n                this._localStats.maxEnabledResolution = track.maxEnabledResolution;\n            });\n\n        conference.on(\n            ConferenceEvents.SERVER_REGION_CHANGED,\n            serverRegion => {\n                this._localStats.serverRegion = serverRegion;\n            });\n\n        conference.on(\n            ConferenceEvents.PROPERTIES_CHANGED,\n            properties => {\n                this._localStats.bridgeCount\n                    = Number(properties?.['bridge-count']);\n            }\n        );\n    }\n\n    /**\n     * Broadcasts the local statistics to all other participants in the\n     * conference.\n     */\n    private _broadcastLocalStats(): void {\n        // broadcasting local stats is disabled\n        if (this._options.config.disableLocalStatsBroadcast) {\n            return;\n        }\n\n        // Send only the data that remote participants care about.\n        const data = {\n            bitrate: this._localStats.bitrate,\n            connectionQuality: this._localStats.connectionQuality,\n            jvbRTT: this._localStats.jvbRTT,\n            maxEnabledResolution: this._localStats.maxEnabledResolution,\n            packetLoss: this._localStats.packetLoss,\n            serverRegion: this._localStats.serverRegion\n        };\n\n        try {\n            this._conference.sendEndpointStatsMessage(data);\n        } catch (err) {\n            // Ignore the error as we might hit it in the beginning of the call before the channel is ready.\n            // The statistics will be sent again after few seconds and error is logged elseware as well.\n        }\n    }\n\n    /**\n     * Calculates a new \"connection quality\" value.\n     * @param videoType {VideoType} the type of the video source (camera or a screen capture).\n     * @param isMuted {boolean} whether the local video is muted.\n     * @param resolutionName {Resolution} the input resolution used by the camera.\n     * @returns {*} the newly calculated connection quality.\n     */\n    private _calculateConnectionQuality(videoType: VideoType, isMuted: boolean, resolutionName: keyof typeof Resolutions): number {\n\n        // resolutionName is an index into Resolutions (where \"720\" is\n        // \"1280x720\" and \"960\" is \"960x720\" ...).\n        const resolution = Resolutions[resolutionName];\n\n        let quality = 100;\n        let packetLoss;\n\n        // TODO: take into account packet loss for received streams\n        if (this._localStats.packetLoss) {\n            packetLoss = this._localStats.packetLoss.upload;\n        }\n\n        if (isMuted || !resolution || videoType === VideoType.DESKTOP\n            || this._timeIceConnected < 0\n            || this._timeVideoUnmuted < 0) {\n\n            // Calculate a value based on packet loss only.\n            if (packetLoss === undefined) {\n                logger.error('Cannot calculate connection quality, unknown '\n                    + 'packet loss.');\n                quality = 100;\n            } else if (packetLoss <= 2) {\n                quality = 100; // Full 5 bars.\n            } else if (packetLoss <= 4) {\n                quality = 70; // 4 bars\n            } else if (packetLoss <= 6) {\n                quality = 50; // 3 bars\n            } else if (packetLoss <= 8) {\n                quality = 30; // 2 bars\n            } else if (packetLoss <= 12) {\n                quality = 10; // 1 bars\n            } else {\n                quality = 0; // Still 1 bar, but slower climb-up.\n            }\n        } else {\n            // Calculate a value based on the send video bitrate on the active TPC.\n            const activeTPC = this._conference.getActivePeerConnection();\n\n            if (activeTPC) {\n                // Time since sending of video was enabled.\n                const millisSinceStart = window.performance.now()\n                    - Math.max(this._timeVideoUnmuted, this._timeIceConnected);\n                const statsInterval = this._options.config?.pcStatsInterval ?? 10000;\n\n                // Expected sending bitrate in perfect conditions.\n                let target = getTarget(\n                    activeTPC.doesTrueSimulcast(undefined),\n                    resolution,\n                    millisSinceStart,\n                    activeTPC.getTargetVideoBitrates(undefined));\n\n                target = Math.min(target, MAX_TARGET_BITRATE);\n\n                // Calculate the quality only after the stats are available (after video was enabled).\n                if (millisSinceStart > statsInterval) {\n                    quality = 100 * this._localStats.bitrate.upload / target;\n                }\n            }\n\n            // Whatever the bitrate, drop early if there is significant loss\n            if (packetLoss && packetLoss >= 10) {\n                quality = Math.min(quality, 30);\n            }\n        }\n\n        // Make sure that the quality doesn't climb quickly\n        if (this._lastConnectionQualityUpdate > 0) {\n            const maxIncreasePerSecond = 2;\n            const prevConnectionQuality = this._localStats.connectionQuality;\n            const diffSeconds = (window.performance.now() - this._lastConnectionQualityUpdate) / 1000;\n\n            quality = Math.min(quality, prevConnectionQuality + (diffSeconds * maxIncreasePerSecond));\n        }\n\n        return Math.min(100, quality);\n    }\n\n    /**\n     * Sets _timeVideoUnmuted if it was previously unset. If it was already set,\n     * doesn't change it.\n     */\n    private _maybeUpdateUnmuteTime(): void {\n        if (this._timeVideoUnmuted < 0) {\n            this._timeVideoUnmuted = window.performance.now();\n        }\n    }\n\n    /**\n     * Resets the time video was unmuted and triggers a new ramp-up.\n     *\n     * @private\n     * @returns {void}\n     */\n    private _resetVideoUnmuteTime(): void {\n        this._timeVideoUnmuted = -1;\n        this._maybeUpdateUnmuteTime();\n    }\n\n    /**\n     * Updates the localConnectionQuality value\n     * @param values {number} the new value. Should be in [0, 100].\n     */\n    private _updateLocalConnectionQuality(value: number): void {\n        this._localStats.connectionQuality = value;\n        this._lastConnectionQualityUpdate = window.performance.now();\n    }\n\n    /**\n     * Updates the local statistics\n     * @param {TraceablePeerConnection} tpc the peerconnection which emitted\n     * the stats\n     * @param data new statistics\n     */\n    private _updateLocalStats(tpc: TraceablePeerConnection, data: { transport: { rtt: number; }[]; }): void {\n        // Update jvbRTT\n        if (!tpc.isP2P) {\n            const jvbRTT\n                = data.transport?.length && data.transport[0].rtt;\n\n            this._localStats.jvbRTT = jvbRTT ? jvbRTT : undefined;\n        }\n\n        // Do not continue with processing of other stats if they do not\n        // originate from the active peerconnection\n        if (tpc !== this._conference.getActivePeerConnection()) {\n            return;\n        }\n\n        let key;\n        const updateLocalConnectionQuality = !this._conference.isConnectionInterrupted();\n        const localVideoTrack = this._conference.getLocalVideoTrack();\n        const videoType = localVideoTrack?.videoType;\n        const isMuted = localVideoTrack ? localVideoTrack.isMuted() : true;\n        const resolutionName = localVideoTrack\n            ? Math.min(localVideoTrack.resolution, localVideoTrack.maxEnabledResolution).toString() as keyof typeof Resolutions : null;\n\n        if (!isMuted) {\n            this._maybeUpdateUnmuteTime();\n        }\n\n        // Copy the fields already in 'data'.\n        for (key in data) {\n            if (data.hasOwnProperty(key)) {\n                // Prevent overwriting available download bandwidth as this statistic is provided by the bridge.\n                if (key === 'bandwidth' && data[key].hasOwnProperty('download') && !tpc.isP2P) {\n                    if (!this._localStats[key]) {\n                        this._localStats[key] = {};\n                    }\n                    this._localStats[key].download = this._localStats[key].download || data[key].download;\n                    this._localStats[key].upload = data[key].upload;\n                } else {\n                    this._localStats[key] = data[key];\n                }\n            }\n        }\n\n        // And re-calculate the connectionQuality field.\n        if (updateLocalConnectionQuality) {\n            this._updateLocalConnectionQuality(\n                this._calculateConnectionQuality(\n                    videoType,\n                    isMuted,\n                    resolutionName));\n        }\n\n        this.eventEmitter.emit(ConnectionQualityEvents.LOCAL_STATS_UPDATED, this._localStats);\n        this._broadcastLocalStats();\n    }\n\n    /**\n     * Updates remote statistics\n     * @param id the id of the remote participant\n     * @param data the statistics received\n     */\n    private _updateRemoteStats(id: string, data: IRemoteStats): void {\n        // Use only the fields we need\n        this._remoteStats[id] = {\n            bitrate: data.bitrate,\n            connectionQuality: data.connectionQuality,\n            jvbRTT: data.jvbRTT,\n            maxEnabledResolution: data.maxEnabledResolution,\n            packetLoss: data.packetLoss,\n            serverRegion: data.serverRegion\n        };\n\n        this.eventEmitter.emit(\n            ConnectionQualityEvents.REMOTE_STATS_UPDATED,\n            id,\n            this._remoteStats[id]);\n    }\n\n    /**\n     * Returns the local statistics.\n     * Exported only for use in jitsi-meet-torture.\n     */\n    public getStats(): ILocalStats {\n        return this._localStats;\n    }\n}\n","import { getLogger } from '@jitsi/logger';\n\nimport JitsiConference from '../../JitsiConference';\nimport RTCStats from '../RTCStats/RTCStats';\nimport { RTCStatsEvents } from '../RTCStats/RTCStatsEvents';\n\nconst logger = getLogger('connectivity:IceFailedHandling');\n\n/**\n * This class deals with shenanigans around JVB media session's ICE failed status handling.\n *\n * If ICE connection is not re-established within 2 secs after the internet comes back online, the client will initiate\n * a session restart via 'session-terminate'. This results in Jicofo re-inviting the participant into the conference by\n * recreating the jvb media session so that there is minimla disruption to the user by default.\n */\nexport default class IceFailedHandling {\n    private _conference: JitsiConference;\n    private _canceled: boolean = false;\n    private _iceFailedTimeout?: number;\n\n    /**\n     * Creates new {@code DelayedIceFailed} task.\n     * @param {JitsiConference} conference\n     */\n    constructor(conference: JitsiConference) {\n        this._conference = conference;\n    }\n\n    /**\n     * After making sure there's no way for the ICE connection to recover this method either sends ICE failed\n     * notification to Jicofo or emits the ice failed conference event.\n     * @private\n     * @returns {void}\n     */\n    _actOnIceFailed(): void {\n        if (!this._conference.room) {\n            return;\n        }\n\n        const jvbConnection = this._conference.jvbJingleSession;\n        const jvbConnIceState = jvbConnection?.getIceConnectionState();\n\n        if (!jvbConnection) {\n            logger.warn('Not sending ICE failed - no JVB connection');\n        } else if (jvbConnIceState === 'connected') {\n            logger.info('ICE connection restored - not sending ICE failed');\n        } else {\n            logger.info(`Sending ICE failed - the connection did not recover, ICE state: ${jvbConnIceState}`);\n            RTCStats.sendStatsEntry(RTCStatsEvents.JVB_ICE_RESTARTED_EVENT);\n            this._conference._stopJvbSession({\n                reason: 'connectivity-error',\n                reasonDescription: 'ICE FAILED',\n                requestRestart: true,\n                sendSessionTerminate: true\n            });\n        }\n    }\n\n    /**\n     * Starts the task.\n     * @returns {void}\n     */\n    start(): void {\n        //  Using xmpp.ping allows to handle both XMPP being disconnected and internet offline cases. The ping function\n        // uses sendIQ2 method which is resilient to XMPP connection disconnected state and will patiently wait until it\n        // gets reconnected.\n        //  This also handles the case about waiting for the internet to come back online, because ping\n        // will only succeed when the internet is online and then there's a chance for the ICE to recover from FAILED to\n        // CONNECTED which is the extra 2 second timeout after ping.\n        //  The 65 second timeout is given on purpose as there's no chance for XMPP to recover after 65 seconds of no\n        // communication with the server. Such resume attempt will result in unrecoverable conference failed event due\n        // to 'item-not-found' error returned by the server.\n        this._conference.xmpp.ping(65000).then(\n            () => {\n                if (!this._canceled) {\n                    this._iceFailedTimeout = window.setTimeout(() => {\n                        this._iceFailedTimeout = undefined;\n                        this._actOnIceFailed();\n                    }, 2000);\n                }\n            },\n            error => {\n                logger.error('PING error/timeout - not sending ICE failed', error);\n            });\n    }\n\n    /**\n     * Cancels the task.\n     * @returns {void}\n     */\n    cancel(): void {\n        this._canceled = true;\n        window.clearTimeout(this._iceFailedTimeout);\n    }\n}\n","export enum DetectionEvents {\n\n    /** Event triggered by {@link NoAudioSignalDetector} when the local audio device associated with a JitsiConference\n     * starts receiving audio levels with the value of 0 meaning no audio is being captured on that device, or when\n     * it starts receiving audio levels !== 0 after being in a state of no audio.\n     * @event\n     * @type {boolean} - true when the current conference audio track has audio input false otherwise.\n     */\n    AUDIO_INPUT_STATE_CHANGE = 'audio_input_state_changed',\n\n    /**\n     * Event triggered by a audio detector indicating that its active state has changed from active to inactive or vice\n     * versa.\n     * @event\n     * @type {boolean} - true when service has changed to active false otherwise.\n     */\n    DETECTOR_STATE_CHANGE = 'detector_state_change',\n\n    /** Event triggered by NoAudioSignalDetector when the local audio device associated with a JitsiConference goes\n     * silent for a period of time, meaning that the device is either broken or hardware/software muted.\n     * @event\n     * @type {void}\n     */\n    NO_AUDIO_INPUT = 'no_audio_input_detected',\n\n    /**\n     *  Event generated by {@link VADNoiseDetection} when the tracked device is considered noisy.\n     *  @event\n     *  @type {Object}\n     */\n    VAD_NOISY_DEVICE = 'detection.vad_noise_device',\n\n    /**\n     * Event generated by VADReportingService when if finishes creating a VAD report for the monitored devices.\n     * The generated objects are of type Array<Object>, one score for each monitored device.\n     * @event VAD_REPORT_PUBLISHED\n     * @type Array<Object> with the following structure:\n     * @property {Date} timestamp - Timestamp at which the compute took place.\n     * @property {number} avgVAD - Average VAD score over monitored period of time.\n     * @property {string} deviceId - Associate local audio device ID.\n     */\n    VAD_REPORT_PUBLISHED = 'vad-report-published',\n\n    /**\n     * Event generated by {@link TrackVADEmitter} when PCM sample VAD score is available.\n     *\n     * @event\n     * @type {Object}\n     * @property {Date}   timestamp - Exact time at which processed PCM sample was generated.\n     * @property {number} score - VAD score on a scale from 0 to 1 (i.e. 0.7)\n     * @property {Float32Array} pcmData - Raw PCM data with which the VAD score was calculated.\n     * @property {string} deviceId - Device id of the associated track.\n     */\n    VAD_SCORE_PUBLISHED = 'detection.vad_score_published',\n\n    /**\n     *  Event generated by {@link VADTalkMutedDetection} when a user is talking while the mic is muted.\n     *\n     *  @event\n     *  @type {Object}\n     */\n    VAD_TALK_WHILE_MUTED = 'detection.vad_talk_while_muted'\n}\n","import type JitsiConference from '../../JitsiConference';\nimport { JitsiConferenceEvents } from '../../JitsiConferenceEvents';\nimport { JitsiTrackEvents } from '../../JitsiTrackEvents';\nimport type JitsiLocalTrack from '../RTC/JitsiLocalTrack';\nimport type TraceablePeerConnection from '../RTC/TraceablePeerConnection';\nimport EventEmitter from '../util/EventEmitter';\n\nimport { DetectionEvents } from './DetectionEvents';\n\n// We wait a certain time interval for constant silence input from the current device to account for\n// potential abnormalities and for a better use experience i.e. don't generate event the instant\n// an audio track is added to the tcr.\n// Potential improvement - add this as a configurable parameter.\nconst SILENCE_PERIOD_MS = 4000;\n\n/**\n * Detect if there is no audio input on the current TraceAblePeerConnection selected track. The no audio\n * state must be constant for a configured amount of time in order for the event to be triggered.\n * @fires DetectionEvents.AUDIO_INPUT_STATE_CHANGE\n * @fires DetectionEvents.NO_AUDIO_INPUT\n */\nexport default class NoAudioSignalDetection extends EventEmitter {\n    private _conference: JitsiConference;\n    private _timeoutTrigger: Nullable<Timeout>;\n    private _hasAudioInput: Nullable<boolean>;\n    private _audioTrack: Nullable<JitsiLocalTrack>;\n    private _eventFired: boolean;\n\n    /**\n     * Creates new NoAudioSignalDetection.\n     *\n     * @param conference the JitsiConference instance that created us.\n     * @constructor\n     */\n    constructor(conference: JitsiConference) {\n        super();\n\n        this._conference = conference;\n        this._timeoutTrigger = null;\n        this._hasAudioInput = null;\n        this._audioTrack = null;\n        this._eventFired = false;\n\n        conference.on(JitsiConferenceEvents.TRACK_ADDED, this._trackAdded.bind(this));\n    }\n\n    /**\n     * Clear the timeout state.\n     */\n    private _clearTriggerTimeout(): void {\n        if (this._timeoutTrigger) {\n            clearTimeout(this._timeoutTrigger);\n            this._timeoutTrigger = null;\n        }\n    }\n\n    /**\n     * Generated event triggered by a change in the current conference audio input state.\n     *\n     * @param {number} audioLevel - The audio level of the ssrc.\n     * @fires DetectionEvents.AUDIO_INPUT_STATE_CHANGE\n     */\n    private _handleAudioInputStateChange(audioLevel: number): void {\n        // Current audio input state of the active local track in the conference, true for audio input false for no\n        // audio input.\n        const status = audioLevel !== 0;\n\n        // If this is the first audio event picked up or the current status is different from the previous trigger\n        // the event.\n        if (this._hasAudioInput === null || this._hasAudioInput !== status) {\n            this._hasAudioInput = status;\n            this.emit(DetectionEvents.AUDIO_INPUT_STATE_CHANGE, this._hasAudioInput);\n        }\n    }\n\n    /**\n     * Generate event triggered by a prolonged period of no audio input.\n     *\n     * @param {number} audioLevel - The audio level of the ssrc.\n     * @fires DetectionEvents.NO_AUDIO_INPUT\n     */\n    private _handleNoAudioInputDetection(audioLevel: number): void {\n        if (this._eventFired) {\n            return;\n        }\n\n        if (audioLevel === 0 && !this._timeoutTrigger) {\n            this._timeoutTrigger = setTimeout(() => {\n                this._eventFired = true;\n\n                this.emit(DetectionEvents.NO_AUDIO_INPUT);\n            }, SILENCE_PERIOD_MS);\n        } else if (audioLevel !== 0 && this._timeoutTrigger) {\n            this._clearTriggerTimeout();\n        }\n    }\n\n    /**\n     * Receives audio level events for all send and receive streams on the current TraceablePeerConnection.\n     *\n     * @param {TraceablePeerConnection} tpc - TraceablePeerConnection of the owning conference.\n     * @param {number} ssrc - The synchronization source identifier (SSRC) of the endpoint/participant/stream\n     * being reported.\n     * @param {number} audioLevel - The audio level of the ssrc.\n     * @param {boolean} isLocal - true for local/send streams or false for remote/receive streams.\n     */\n    private _audioLevel(tpc: TraceablePeerConnection, ssrc: number, audioLevel: number, isLocal: boolean): void {\n        // We are interested in the local audio streams\n        if (!isLocal || !this._audioTrack) {\n            return;\n        }\n\n        // Get currently active local tracks from the TraceablePeerConnection\n        const localSSRCs = tpc.localSSRCs.get(this._audioTrack.rtcId);\n\n        // Only target the current active track in the tpc. For some reason audio levels for previous\n        // devices are also picked up from the PeerConnection so we filter them out.\n        if (!localSSRCs?.ssrcs.includes(ssrc)) {\n            return;\n        }\n\n        // First handle audio input state change. In case the state changed to no input the no audio input event\n        // can try to fire again.\n        this._handleAudioInputStateChange(audioLevel);\n        this._handleNoAudioInputDetection(audioLevel);\n    }\n\n    /**\n     * Notifies NoAudioSignalDetection that a JitsiTrack was added to the associated JitsiConference.\n     * Only take into account local audio tracks.\n     *\n     * @param {JitsiTrack} track - The added JitsiTrack.\n     */\n    private _trackAdded(track: JitsiLocalTrack): void {\n        if (track.isLocalAudioTrack()) {\n            // Reset state for the new track.\n            this._audioTrack = track;\n            this._eventFired = false;\n            this._clearTriggerTimeout();\n\n            // Listen for the audio levels on the newly added audio track\n            track.on(\n                JitsiTrackEvents.NO_AUDIO_INPUT,\n                (audioLevel: number) => {\n                    this._handleNoAudioInputDetection(audioLevel);\n                }\n            );\n            track.on(\n                JitsiTrackEvents.TRACK_AUDIO_LEVEL_CHANGED,\n                (audioLevel: number) => {\n                    this._handleNoAudioInputDetection(audioLevel);\n                    this._handleAudioInputStateChange(audioLevel);\n                }\n            );\n        }\n    }\n}\n","import JitsiConference from '../../JitsiConference';\nimport { JitsiConferenceEvents } from '../../JitsiConferenceEvents';\nimport { RTCEvents } from '../../service/RTC/RTCEvents';\n\n/**\n * The value which we use to say, every sound over this threshold\n * is talking on the mic.\n * @type {number}\n */\nconst SPEECH_DETECT_THRESHOLD: number = 0.6;\n\n/**\n * The <tt>P2PDominantSpeakerDetection</tt> is activated only when p2p is\n * currently used.\n * Listens for changes in the audio level changes of the local p2p audio track\n * or remote p2p one and fires dominant speaker events to be able to use\n * features depending on those events (speaker stats), to make them work without\n * the video bridge.\n */\nexport default class P2PDominantSpeakerDetection {\n    private conference: JitsiConference;\n    private myUserID: string;\n\n    /**\n     * Creates P2PDominantSpeakerDetection\n     * @param conference the JitsiConference instance that created us.\n     * @constructor\n     */\n    constructor(conference: JitsiConference) {\n        this.conference = conference;\n\n        conference.addEventListener(\n            JitsiConferenceEvents.TRACK_AUDIO_LEVEL_CHANGED,\n            this._audioLevel.bind(this));\n\n        this.myUserID = this.conference.myUserId();\n    }\n\n    /**\n     * Receives audio level events for all streams in the conference.\n     *\n     * @param {String} id - The participant id\n     * @param {number} audioLevel - The audio level.\n     */\n    private _audioLevel(id: string, audioLevel: number): void {\n        // we do not process if p2p is not active\n        // or audio level is under certain threshold\n        // or if the audio level is for local audio track which is muted\n        if (!this.conference.isP2PActive()\n            || audioLevel <= SPEECH_DETECT_THRESHOLD\n            || (id === this.myUserID\n                    && this.conference.getLocalAudioTrack().isMuted())) {\n            return;\n        }\n\n        this.conference.rtc.eventEmitter.emit(\n            RTCEvents.DOMINANT_SPEAKER_CHANGED,\n            id);\n    }\n}\n","/**\n * Adapter that creates AudioContext objects depending on the browser.\n *\n * @returns {Optional<AudioContext>} - Return a new AudioContext or undefined if the browser does not support it.\n */\nexport function createAudioContext(options?: AudioContextOptions): Optional<AudioContext> {\n    const AudioContextImpl = window.AudioContext || (window as any).webkitAudioContext;\n\n    if (!AudioContextImpl) {\n        return undefined;\n    }\n\n    return new AudioContextImpl(options);\n}\n","import JitsiLocalTrack from '../RTC/JitsiLocalTrack';\nimport RTC from '../RTC/RTC';\nimport EventEmitter from '../util/EventEmitter';\nimport { createAudioContext } from '../webaudio/WebAudioUtils';\n\nimport { DetectionEvents } from './DetectionEvents';\n\nexport interface IVadProcessor {\n    calculateAudioFrameVAD: (pcmSample: Float32Array | number[]) => number;\n    getRequiredPCMFrequency: () => number;\n    getSampleLength: () => number;\n}\n\nexport type AudioContextType = AudioContext;\nexport type ScriptProcessorNodeType = ScriptProcessorNode;\nexport type MediaStreamAudioSourceNodeType = MediaStreamAudioSourceNode;\n\n/**\n * Connects an audio JitsiLocalTrack to a vadProcessor using WebAudio ScriptProcessorNode.\n * Once an object is created audio from the local track flows through the ScriptProcessorNode as raw PCM.\n * The PCM is processed by the injected vad module and a voice activity detection score is obtained, the\n * score is published to consumers via an EventEmitter.\n * After work is done with this service the destroy method needs to be called for a proper cleanup.\n *\n * @fires VAD_SCORE_PUBLISHED\n */\nexport default class TrackVADEmitter extends EventEmitter {\n    private _procNodeSampleRate: number;\n    private _vadProcessor: IVadProcessor;\n    private _localTrack: JitsiLocalTrack;\n    private _bufferResidue: Float32Array;\n    private _audioContext: AudioContextType;\n    private _vadSampleSize: number;\n    private _audioSource!: MediaStreamAudioSourceNodeType;\n    private _audioProcessingNode!: ScriptProcessorNodeType;\n    private _destroyed?: boolean;\n\n    /**\n     * Constructor.\n     *\n     * @param {number} procNodeSampleRate - Sample rate of the ScriptProcessorNode. Possible values  256, 512, 1024,\n     *  2048, 4096, 8192, 16384. Passing other values will default to closes neighbor.\n     * @param {Object} vadProcessor - VAD processor that allows us to calculate VAD score for PCM samples.\n     * @param {JitsiLocalTrack} jitsiLocalTrack - JitsiLocalTrack corresponding to micDeviceId.\n     */\n    constructor(procNodeSampleRate: number, vadProcessor: IVadProcessor, jitsiLocalTrack: JitsiLocalTrack) {\n        super();\n\n        /**\n         * Sample rate of the ScriptProcessorNode.\n         */\n        this._procNodeSampleRate = procNodeSampleRate;\n\n        /**\n         * VAD Processor that allows us to calculate VAD score for PCM samples\n         */\n        this._vadProcessor = vadProcessor;\n\n        /**\n         * The JitsiLocalTrack instance.\n         */\n        this._localTrack = jitsiLocalTrack;\n\n        /**\n         * Buffer to hold residue PCM resulting after a ScriptProcessorNode callback\n         */\n        this._bufferResidue = new Float32Array([]);\n\n        /**\n         * The AudioContext instance with the preferred sample frequency.\n         */\n        this._audioContext = createAudioContext({ sampleRate: vadProcessor.getRequiredPCMFrequency() });\n\n        /**\n         * PCM Sample size expected by the VAD Processor instance. We cache it here as this value is used extensively,\n         * saves a couple of function calls.\n         */\n        this._vadSampleSize = vadProcessor.getSampleLength();\n\n        /**\n         * Event listener function that will be called by the ScriptProcessNode with raw PCM data, depending on the set\n         * sample rate.\n         */\n        this._onAudioProcess = this._onAudioProcess.bind(this);\n\n        this._initializeAudioContext();\n    }\n\n    /**\n     * Factory method that sets up all the necessary components for the creation of the TrackVADEmitter.\n     *\n     * @param {string} micDeviceId - Target microphone device id.\n     * @param {number} procNodeSampleRate - Sample rate of the proc node.\n     * @param {Object} vadProcessor -Module that calculates the voice activity score for a certain audio PCM sample.\n     * The processor needs to implement the following functions:\n     * - <tt>getSampleLength()</tt> - Returns the sample size accepted by getSampleLength.\n     * - <tt>getRequiredPCMFrequency()</tt> - Returns the PCM frequency at which the processor operates.\n     * - <tt>calculateAudioFrameVAD(pcmSample)</tt> - Process a 32 float pcm sample of getSampleLength size.\n     * @returns {Promise<TrackVADEmitter>} - Promise resolving in a new instance of TrackVADEmitter.\n     */\n    static create(\n            micDeviceId: string,\n            procNodeSampleRate: number,\n            vadProcessor: IVadProcessor\n    ): Promise<TrackVADEmitter> {\n        return RTC.obtainAudioAndVideoPermissions({\n            devices: [ 'audio' ],\n            micDeviceId\n        }).then((localTrack: JitsiLocalTrack[]) => {\n            // We only expect one audio track when specifying a device id.\n            if (!localTrack[0]) {\n                throw new Error(`Failed to create jitsi local track for device id: ${micDeviceId}`);\n            }\n\n            return new TrackVADEmitter(procNodeSampleRate, vadProcessor, localTrack[0]);\n\n            // We have no exception handling at this point as there is nothing to clean up, the vadProcessor\n            // life cycle is handled by whoever created this instance.\n        });\n    }\n\n    /**\n     * Sets up the audio graph in the AudioContext.\n     *\n     * @returns {void}\n     */\n    _initializeAudioContext(): void {\n        this._audioSource = this._audioContext.createMediaStreamSource(this._localTrack.stream);\n\n        // TODO AudioProcessingNode is deprecated in the web audio specifications and the recommended replacement\n        // is audio worklet, however at the point of implementation AudioProcessingNode was still de de facto way\n        // of achieving this functionality and supported in all major browsers as opposed to audio worklet which\n        // was only available in Chrome. This todo is just a reminder that we should replace AudioProcessingNode\n        // with audio worklet when it's mature enough and has more browser support.\n        // We don't need stereo for determining the VAD score so we create a single channel processing node.\n        this._audioProcessingNode = this._audioContext.createScriptProcessor(this._procNodeSampleRate, 1, 1);\n    }\n\n    /**\n     * ScriptProcessorNode callback, the input parameters contains the PCM audio that is then sent to rnnoise.\n     * Rnnoise only accepts PCM samples of 480 bytes whereas the webaudio processor node can't sample at a multiple\n     * of 480 thus after each _onAudioProcess callback there will remain and PCM buffer residue equal\n     * to _procNodeSampleRate / 480 which will be added to the next sample buffer and so on.\\\n     *\n     *\n     * @param {AudioProcessingEvent} audioEvent - Audio event.\n     * @returns {void}\n     * @fires VAD_SCORE_PUBLISHED\n     */\n    _onAudioProcess(audioEvent: AudioProcessingEvent): void {\n        // Prepend the residue PCM buffer from the previous process callback.\n        const inData = audioEvent.inputBuffer.getChannelData(0);\n        const completeInData = [ ...this._bufferResidue, ...inData ];\n        const sampleTimestamp = Date.now();\n\n        let i = 0;\n\n        for (; i + this._vadSampleSize < completeInData.length; i += this._vadSampleSize) {\n            const pcmSample = completeInData.slice(i, i + this._vadSampleSize);\n\n            // The VAD processor might change the values inside the array so we make a copy.\n            const vadScore = this._vadProcessor.calculateAudioFrameVAD(pcmSample.slice());\n\n            this.emit(DetectionEvents.VAD_SCORE_PUBLISHED, {\n                deviceId: this._localTrack.getDeviceId(),\n                pcmData: pcmSample,\n                score: vadScore,\n                timestamp: sampleTimestamp\n            });\n        }\n\n        this._bufferResidue = new Float32Array(completeInData.slice(i, completeInData.length));\n    }\n\n    /**\n     * Connects the nodes in the AudioContext to start the flow of audio data.\n     *\n     * @returns {void}\n     */\n    _connectAudioGraph(): void {\n        this._audioProcessingNode.onaudioprocess = this._onAudioProcess;\n        this._audioSource.connect(this._audioProcessingNode);\n        this._audioProcessingNode.connect(this._audioContext.destination);\n    }\n\n    /**\n     * Disconnects the nodes in the AudioContext.\n     *\n     * @returns {void}\n     */\n    _disconnectAudioGraph(): void {\n        // Even thought we disconnect the processing node it seems that some callbacks remain queued,\n        // resulting in calls with and uninitialized context.\n        // eslint-disable-next-line  @typescript-eslint/no-empty-function\n        this._audioProcessingNode.onaudioprocess = () => {};\n        this._audioProcessingNode.disconnect();\n        this._audioSource.disconnect();\n    }\n\n    /**\n     * Cleanup potentially acquired resources.\n     *\n     * @returns {void}\n     */\n    _cleanupResources(): void {\n        this._disconnectAudioGraph();\n        this._localTrack.stopStream();\n    }\n\n    /**\n     * Start the emitter by connecting the audio graph.\n     *\n     * @returns {void}\n     */\n    start(): void {\n        this._connectAudioGraph();\n    }\n\n    /**\n     * Stops the emitter by disconnecting the audio graph.\n     *\n     * @returns {void}\n     */\n    stop(): void {\n        this._disconnectAudioGraph();\n        this._bufferResidue = new Float32Array([]);\n    }\n\n    /**\n     * Destroy TrackVADEmitter instance (release resources and stop callbacks).\n     *\n     * @returns {void}\n     */\n    destroy(): void {\n        if (this._destroyed) {\n            return;\n        }\n\n        this._cleanupResources();\n        this._destroyed = true;\n    }\n}\n","import { getLogger } from '@jitsi/logger';\n\nimport JitsiConference from '../../JitsiConference';\nimport { JitsiConferenceEvents } from '../../JitsiConferenceEvents';\nimport JitsiLocalTrack from '../RTC/JitsiLocalTrack';\nimport EventEmitter from '../util/EventEmitter';\n\nimport { DetectionEvents } from './DetectionEvents';\nimport TrackVADEmitter from './TrackVADEmitter';\n\nconst logger = getLogger('vad:VADAudioAnalyser');\n\n/**\n * Sample rate of TrackVADEmitter, it defines how many audio samples are processed at a time.\n * @type {number}\n */\nconst VAD_EMITTER_SAMPLE_RATE: number = 4096;\n\nexport interface IVADProcessor {\n    calculateAudioFrameVAD: (pcmSample: Float32Array | number[]) => number;\n    getRequiredPCMFrequency: () => number;\n    getSampleLength: () => number;\n}\n\nexport interface IVADDetectionService {\n    changeMuteState: (isMuted: boolean) => void;\n    isActive: () => boolean;\n    on: (event: string, handler: () => void) => void;\n    processVADScore: (vadScore: IVADScore) => void;\n    reset: () => void;\n}\n\nexport interface IVADScore {\n    deviceId: string;\n    pcmData: Float32Array | number[];\n    score: number;\n    timestamp: number;\n}\n\n/**\n * Connects a TrackVADEmitter to the target conference local audio track and manages various services that use\n * the data to produce audio analytics (VADTalkMutedDetection and VADNoiseDetection).\n */\nexport default class VADAudioAnalyser extends EventEmitter {\n    private _createVADProcessor: () => IVADProcessor;\n    private _vadEmitter: Nullable<TrackVADEmitter>;\n    private _isVADEmitterRunning: boolean;\n    private _detectionServices: IVADDetectionService[];\n    private _vadInitTracker: Promise<void>;\n\n    /**\n     * Creates <tt>VADAudioAnalyser</tt>\n     * @param {JitsiConference} conference - JitsiConference instance that created us.\n     * @param {Object} createVADProcessor - Function that creates a Voice activity detection processor. The processor\n     * needs to implement the following functions:\n     * - <tt>getSampleLength()</tt> - Returns the sample size accepted by getSampleLength.\n     * - <tt>getRequiredPCMFrequency()</tt> - Returns the PCM frequency at which the processor operates.\n     * - <tt>calculateAudioFrameVAD(pcmSample)</tt> - Process a 32 float pcm sample of getSampleLength size.\n     * @constructor\n     */\n    constructor(conference: JitsiConference, createVADProcessor: () => IVADProcessor) {\n        super();\n\n        /**\n         * Member function that instantiates a VAD processor.\n         */\n        this._createVADProcessor = createVADProcessor;\n\n        /**\n         * Current {@link TrackVADEmitter}. VAD Emitter uses a {@link JitsiLocalTrack} and VAD processor to generate\n         * period voice probability scores.\n         */\n        this._vadEmitter = null;\n\n        /**\n         * Current state of the _vadEmitter\n         */\n        this._isVADEmitterRunning = false;\n\n        /**\n         * Array of currently attached VAD processing services.\n         */\n        this._detectionServices = [];\n\n        /**\n         * Promise used to chain create and destroy operations associated with TRACK_ADDED and TRACK_REMOVED events\n         * coming from the conference.\n         * Because we have an async created component (VAD Processor) we need to make sure that it's initialized before\n         * we destroy it ( when changing the device for instance), or when we use it from an external point of entry\n         * i.e. (TRACK_MUTE_CHANGED event callback).\n         */\n        this._vadInitTracker = Promise.resolve();\n\n        /**\n         * Listens for {@link TrackVADEmitter} events and processes them.\n         */\n        this._processVADScore = this._processVADScore.bind(this);\n\n        conference.on(JitsiConferenceEvents.TRACK_ADDED, this._trackAdded.bind(this));\n        conference.on(JitsiConferenceEvents.TRACK_REMOVED, this._trackRemoved.bind(this));\n        conference.on(JitsiConferenceEvents.TRACK_MUTE_CHANGED, this._trackMuteChanged.bind(this));\n    }\n\n    /**\n     * Attach a VAD detector service to the analyser and handle it's state changes.\n     *\n     * @param {Object} vadTMDetector\n     */\n    addVADDetectionService(vadService: IVADDetectionService): void {\n        this._detectionServices.push(vadService);\n        vadService.on(DetectionEvents.DETECTOR_STATE_CHANGE, () => {\n            // When the state of a detector changes check if there are any active detectors attached so that\n            // the _vadEmitter doesn't run needlessly.\n            const activeDetector = this._detectionServices.filter(detector => detector.isActive() === true);\n\n            // If there are no active detectors running and the vadEmitter is running then stop the emitter as it is\n            // uses a considerable amount of CPU. Otherwise start the service if it's stopped and there is a detector\n            // that needs it.\n            if (!activeDetector.length && this._isVADEmitterRunning) {\n                this._stopVADEmitter();\n            } else if (!this._isVADEmitterRunning) {\n                this._startVADEmitter();\n            }\n        });\n    }\n\n    /**\n     * Start the {@link TrackVADEmitter} and attach the event listener.\n     * @returns {void}\n     */\n    _startVADEmitter(): void {\n        if (this._vadEmitter) {\n            this._vadEmitter.on(DetectionEvents.VAD_SCORE_PUBLISHED, this._processVADScore);\n            this._vadEmitter.start();\n            this._isVADEmitterRunning = true;\n        }\n    }\n\n    /**\n     * Stop the {@link TrackVADEmitter} and detach the event listener.\n     * @returns {void}\n     */\n    _stopVADEmitter(): void {\n        if (this._vadEmitter) {\n            this._vadEmitter.removeListener(DetectionEvents.VAD_SCORE_PUBLISHED, this._processVADScore);\n            this._vadEmitter.stop();\n        }\n        this._isVADEmitterRunning = false;\n    }\n\n    /**\n     * Listens for {@link TrackVADEmitter} events and directs them to attached services as needed.\n     *\n     * @param {Object} vadScore -VAD score emitted by {@link TrackVADEmitter}\n     * @param {Date}   vadScore.timestamp - Exact time at which processed PCM sample was generated.\n     * @param {number} vadScore.score - VAD score on a scale from 0 to 1 (i.e. 0.7)\n     * @param {Float32Array} pcmData - Raw PCM data with which the VAD score was calculated.\n     * @param {string} vadScore.deviceId - Device id of the associated track.\n     * @listens VAD_SCORE_PUBLISHED\n     */\n    _processVADScore(vadScore: IVADScore): void {\n        for (const detector of this._detectionServices) {\n            detector.processVADScore(vadScore);\n        }\n    }\n\n    /**\n     * Change the isMuted state of all attached detection services.\n     *\n     * @param {boolean} isMuted\n     */\n    _changeDetectorsMuteState(isMuted: boolean): void {\n        for (const detector of this._detectionServices) {\n            detector.changeMuteState(isMuted);\n        }\n    }\n\n    /**\n     * Notifies the detector that a track was added to the associated {@link JitsiConference}.\n     * Only take into account local audio tracks.\n     * @param {JitsiLocalTrack} track - The added track.\n     * @returns {void}\n     * @listens TRACK_ADDED\n     */\n    _trackAdded(track: JitsiLocalTrack): void {\n        if (track.isLocalAudioTrack()) {\n            // Keep a track promise so we take into account successive TRACK_ADD events being generated so that we\n            // destroy/create the processing context in the proper order.\n            this._vadInitTracker = this._vadInitTracker.then(() => this._createVADProcessor())\n                .then((vadProcessor: IVADProcessor) =>\n                    TrackVADEmitter.create(track.getDeviceId(), VAD_EMITTER_SAMPLE_RATE, vadProcessor)\n                )\n                .then((vadEmitter: TrackVADEmitter) => {\n                    logger.debug('Created VAD emitter for track: ', track.getTrackLabel());\n\n                    this._vadEmitter = vadEmitter;\n\n                    // Iterate through the detection services and set their appropriate mute state, depending on\n                    // service this will trigger a DETECTOR_STATE_CHANGE which in turn might start the _vadEmitter.\n                    this._changeDetectorsMuteState(track.isMuted());\n                })\n                .catch(error => {\n                    logger.warn('Failed to start VADAudioAnalyser', error);\n                });\n        }\n    }\n\n    /**\n     * Notifies the detector that the mute state of a {@link JitsiConference} track has changed. Only takes into account\n     * local audio tracks.\n     * @param {JitsiLocalTrack} track - The track whose mute state has changed.\n     * @returns {void}\n     * @listens TRACK_MUTE_CHANGED\n     */\n    _trackMuteChanged(track: JitsiLocalTrack): void {\n        if (track.isLocalAudioTrack()) {\n            // On a mute toggle reset the state.\n            this._vadInitTracker = this._vadInitTracker.then(() => {\n                // Set mute status for the attached detection services.\n                this._changeDetectorsMuteState(track.isMuted());\n            });\n        }\n    }\n\n    /**\n     * Notifies the detector that a track associated with the {@link JitsiConference} was removed. Only takes into\n     * account local audio tracks. Cleans up resources associated with the track and resets the processing context.\n     *\n     * @param {JitsiLocalTrack} track - The removed track.\n     * @returns {void}\n     * @listens TRACK_REMOVED\n     */\n    _trackRemoved(track: JitsiLocalTrack): void {\n        if (track.isLocalAudioTrack()) {\n            // Use the promise to make sure operations are in sequence.\n            this._vadInitTracker = this._vadInitTracker.then(() => {\n                logger.debug('Removing track from VAD detection - ', track.getTrackLabel());\n\n                // Track was removed, clean up and set appropriate states.\n                if (this._vadEmitter) {\n                    this._stopVADEmitter();\n                    this._vadEmitter.destroy();\n                    this._vadEmitter = null;\n                }\n\n                // Reset state of detectors when active track is removed.\n                for (const detector of this._detectionServices) {\n                    detector.reset();\n                }\n            });\n        }\n    }\n}\n","import EventEmitter from '../util/EventEmitter';\nimport { calculateAverage, filterPositiveValues } from '../util/MathUtil';\n\nimport { DetectionEvents } from './DetectionEvents';\nimport { IVADScore } from './VADAudioAnalyser';\n\n/**\n * The average value VAD needs to be under over a period of time to be considered noise.\n * @type {number}\n */\nconst VAD_NOISE_AVG_THRESHOLD: number = 0.2;\n\n/**\n * The average values that audio input need to be over to be considered loud.\n * @type {number}\n */\nconst NOISY_AUDIO_LEVEL_THRESHOLD: number = 0.040;\n\n/**\n * The value that a VAD score needs to be under in order for processing to begin.\n * @type {number}\n */\nconst VAD_SCORE_TRIGGER: number = 0.2;\n\n/**\n * The value that a VAD score needs to be under in order for processing to begin.\n * @type {number}\n */\nconst AUDIO_LEVEL_SCORE_TRIGGER: number = 0.020;\n\n/**\n * Time span over which we calculate an average score used to determine if we trigger the event.\n * @type {number}\n */\nconst PROCESS_TIME_FRAME_SPAN_MS: number = 1500;\n\n/**\n * Detect if provided VAD score and PCM data is considered noise.\n */\nexport default class VADNoiseDetection extends EventEmitter {\n    /**\n     * Flag which denotes the current state of the detection service i.e.if there is already a processing operation\n     * ongoing.\n     */\n    private _processing: boolean;\n\n    /**\n     * Buffer that keeps the VAD scores for a period of time.\n     */\n    private _scoreArray: number[];\n\n    /**\n     * Buffer that keeps audio level samples for a period of time.\n     */\n    private _audioLvlArray: number[];\n\n    /**\n     * Current state of the service, if it's not active no processing will occur.\n     */\n    private _active: boolean;\n\n    /**\n     * Timeout reference for processing VAD scores.\n     */\n    private _processTimeout?: NodeJS.Timeout;\n\n    /**\n     * Creates <tt>VADNoiseDetection</tt>\n     *\n     * @constructor\n     */\n    constructor() {\n        super();\n\n        /**\n         * Flag which denotes the current state of the detection service i.e.if there is already a processing operation\n         * ongoing.\n         */\n        this._processing = false;\n\n        /**\n         * Buffer that keeps the VAD scores for a period of time.\n         */\n        this._scoreArray = [];\n\n        /**\n         * Buffer that keeps audio level samples for a period of time.\n         */\n        this._audioLvlArray = [];\n\n        /**\n         * Current state of the service, if it's not active no processing will occur.\n         */\n        this._active = false;\n\n        /**\n         * Timeout reference for processing VAD scores.\n         */\n        this._processTimeout = null;\n\n        this._calculateNoisyScore = this._calculateNoisyScore.bind(this);\n    }\n\n    /**\n     * Compute cumulative VAD score and PCM audio levels once the PROCESS_TIME_FRAME_SPAN_MS timeout has elapsed.\n     * If the score is above the set threshold fire the event.\n     * @returns {void}\n     * @fires VAD_NOISY_DEVICE\n     */\n    private _calculateNoisyScore(): void {\n        const scoreAvg = calculateAverage(new Float32Array(this._scoreArray));\n        const audioLevelAvg = calculateAverage(new Float32Array(this._audioLvlArray));\n\n        if (scoreAvg < VAD_NOISE_AVG_THRESHOLD && audioLevelAvg > NOISY_AUDIO_LEVEL_THRESHOLD) {\n            this.emit(DetectionEvents.VAD_NOISY_DEVICE);\n\n            this._setActiveState(false);\n        }\n\n        // We reset the context in case a new process phase needs to be triggered.\n        this.reset();\n    }\n\n    /**\n     * Set the active state of the detection service and notify any listeners.\n     *\n     * @param {boolean} active\n     * @fires DETECTOR_STATE_CHANGE\n     */\n    private _setActiveState(active: boolean): void {\n        this._active = active;\n        this.emit(DetectionEvents.DETECTOR_STATE_CHANGE, this._active);\n    }\n\n    /**\n     * Record the vad score and average volume in the appropriate buffers.\n     *\n     * @param {number} vadScore\n     * @param {number} avgAudioLvl - average audio level of the PCM sample associated with the VAD score.s\n     */\n    private _recordValues(vadScore: number, avgAudioLvl: number): void {\n        this._scoreArray.push(vadScore);\n        this._audioLvlArray.push(avgAudioLvl);\n    }\n\n    /**\n     * Change the state according to the muted status of the tracked device.\n     *\n     * @param {boolean} isMuted - Is the device muted or not.\n     */\n    public changeMuteState(isMuted: boolean): void {\n        // This service only needs to run when the microphone is not muted.\n        this._setActiveState(!isMuted);\n        this.reset();\n    }\n\n    /**\n     * Check whether or not the service is active or not.\n     *\n     * @returns {boolean}\n     */\n    public isActive(): boolean {\n        return this._active;\n    }\n\n    /**\n     * Listens for {@link TrackVADEmitter} events and processes them.\n     *\n     * @param {Object} vadScore -VAD score emitted by {@link TrackVADEmitter}\n     * @param {number}   vadScore.timestamp - Exact time at which processed PCM sample was generated.\n     * @param {number} vadScore.score - VAD score on a scale from 0 to 1 (i.e. 0.7)\n     * @param {Float32Array} vadScore.pcmData - Raw PCM Data associated with the VAD score.\n     * @param {string} vadScore.deviceId - Device id of the associated track.\n     * @listens VAD_SCORE_PUBLISHED\n     */\n    public processVADScore(vadScore: IVADScore): void {\n        if (!this._active) {\n            return;\n        }\n\n        // There is a processing phase on going, add score to buffer array.\n        if (this._processing) {\n        // Filter and calculate sample average so we don't have to process one large array at a time.\n            const pcmDataArray = Array.isArray(vadScore.pcmData) ? new Float32Array(vadScore.pcmData) : vadScore.pcmData;\n            const posAudioLevels = filterPositiveValues(pcmDataArray);\n\n            this._recordValues(vadScore.score, calculateAverage(new Float32Array(posAudioLevels)));\n\n            return;\n        }\n\n        // If the VAD score for the sample is low and audio level has a high enough level we can start listening for\n        // noise\n        if (vadScore.score < VAD_SCORE_TRIGGER) {\n            const pcmDataArray = Array.isArray(vadScore.pcmData) ? new Float32Array(vadScore.pcmData) : vadScore.pcmData;\n            const posAudioLevels = filterPositiveValues(pcmDataArray);\n            const avgAudioLvl = calculateAverage(new Float32Array(posAudioLevels));\n\n            if (avgAudioLvl > AUDIO_LEVEL_SCORE_TRIGGER) {\n                this._processing = true;\n                this._recordValues(vadScore.score, avgAudioLvl);\n\n                // Once the preset timeout executes the final score will be calculated.\n                this._processTimeout = setTimeout(this._calculateNoisyScore, PROCESS_TIME_FRAME_SPAN_MS);\n            }\n        }\n    }\n\n    /**\n     * Reset the processing context, clear buffers, cancel the timeout trigger.\n     *\n     * @returns {void}\n     */\n    public reset(): void {\n        this._processing = false;\n        this._scoreArray = [];\n        this._audioLvlArray = [];\n        if (this._processTimeout) {\n            clearTimeout(this._processTimeout);\n            this._processTimeout = null;\n        }\n    }\n}\n","import EventEmitter from '../util/EventEmitter';\nimport { calculateAverage } from '../util/MathUtil';\n\nimport { DetectionEvents } from './DetectionEvents';\n\n/**\n * The threshold which the average VAD values for a span of time needs to exceed to trigger an event.\n * @type {number}\n */\nconst VAD_AVG_THRESHOLD = 0.6;\n\n/**\n * The VAD score needed to trigger the processing algorithm, i.e. if a sample has the VAD score >= VAD_VOICE_LEVEL\n * we start processing all scores for a time span defined by const PROCESS_TIME_FRAME_SPAN_MS.\n * @type {number}\n */\nconst VAD_VOICE_LEVEL = 0.9;\n\n/**\n * Sample rate of TrackVADEmitter, it defines how many audio samples are processed at a time.\n * @type {number}\n */\n\n/**\n * Time span over which we calculate an average score used to determine if we trigger the event.\n * @type {number}\n */\nconst PROCESS_TIME_FRAME_SPAN_MS = 700;\n\nexport interface IVADScore {\n    deviceId: string;\n    score: number;\n    timestamp: number;\n}\n\n/**\n * Detect if provided VAD score which is generated on a muted device is voice and fires an event.\n */\nexport default class VADTalkMutedDetection extends EventEmitter {\n    private _processing: boolean;\n    private _scoreArray: number[];\n    private _active: boolean;\n    private _processTimeout?: ReturnType<typeof setTimeout>;\n\n    /**\n     * Creates <tt>VADTalkMutedDetection</tt>\n     * @constructor\n     */\n    constructor() {\n        super();\n\n        /**\n         * Flag which denotes the current state of the detection service i.e.if there is already a processing operation\n         * ongoing.\n         */\n        this._processing = false;\n\n        /**\n         * Buffer that keeps the VAD scores for a period of time.\n         */\n        this._scoreArray = [];\n\n        /**\n         * Current mute state of the audio track being monitored.\n         */\n        this._active = false;\n        this._calculateVADScore = this._calculateVADScore.bind(this);\n    }\n\n    /**\n     * Compute cumulative VAD score function called once the PROCESS_TIME_FRAME_SPAN_MS timeout has elapsed.\n     * @returns {void}\n     * @fires VAD_TALK_WHILE_MUTED\n     */\n    private _calculateVADScore(): void {\n        const score = calculateAverage(new Float32Array(this._scoreArray));\n\n        if (score > VAD_AVG_THRESHOLD) {\n            this.emit(DetectionEvents.VAD_TALK_WHILE_MUTED);\n\n            // Event was fired. Stop event emitter and remove listeners so no residue events kick off after this point\n            // and a single VAD_TALK_WHILE_MUTED is generated per mic muted state.\n            this._setActiveState(false);\n        }\n\n        // We reset the context in case a new process phase needs to be triggered.\n        this.reset();\n    }\n\n    /**\n     * Set the active state of the detection service and notify any listeners.\n     *\n     * @param {boolean} active\n     * @fires DETECTOR_STATE_CHANGE\n     */\n    private _setActiveState(active: boolean): void {\n        this._active = active;\n        this.emit(DetectionEvents.DETECTOR_STATE_CHANGE, this._active);\n    }\n\n    /**\n     * Change the state according to the muted status of the tracked device.\n     *\n     * @param {boolean} isMuted - Is the device muted or not.\n     */\n    public changeMuteState(isMuted: boolean): void {\n        // This service only needs to run when the microphone is muted.\n        this._setActiveState(isMuted);\n        this.reset();\n    }\n\n    /**\n     * Check whether or not the service is active or not.\n     *\n     * @returns {boolean}\n     */\n    public isActive(): boolean {\n        return this._active;\n    }\n\n    /**\n     * Listens for {@link TrackVADEmitter} events and processes them.\n     *\n     * @param {Object} vadScore -VAD score emitted by {@link TrackVADEmitter}\n     * @param {number}   vadScore.timestamp - Exact time at which processed PCM sample was generated.\n     * @param {number} vadScore.score - VAD score on a scale from 0 to 1 (i.e. 0.7)\n     * @param {string} vadScore.deviceId - Device id of the associated track.\n     * @listens VAD_SCORE_PUBLISHED\n     */\n    public processVADScore(vadScore: IVADScore): void {\n        if (!this._active) {\n            return;\n        }\n        // There is a processing phase on going, add score to buffer array.\n\n\n        if (this._processing) {\n            this._scoreArray.push(vadScore.score);\n\n            return;\n        }\n\n        // Because we remove all listeners on the vadEmitter once the main event is triggered,\n        // there is no need to check for rogue events.\n        if (vadScore.score > VAD_VOICE_LEVEL) {\n            this._processing = true;\n            this._scoreArray.push(vadScore.score);\n\n            // Start gathering VAD scores for the configured period of time.\n            this._processTimeout = setTimeout(this._calculateVADScore, PROCESS_TIME_FRAME_SPAN_MS);\n        }\n    }\n\n    /**\n     * Reset the processing context, clear buffer, cancel the timeout trigger.\n     *\n     * @returns {void}\n     */\n    public reset(): void {\n        this._processing = false;\n        this._scoreArray = [];\n        clearTimeout(this._processTimeout);\n    }\n}\n","/**\n * Promise-like object which can be passed around for resolving it later. It\n * implements the \"thenable\" interface, so it can be used wherever a Promise\n * could be used.\n *\n * In addition a \"reject on timeout\" functionality is provided.\n */\nexport default class Deferred<T = any> {\n    private _timeout?: Timeout;\n    promise: Promise<T>;\n    resolve: (value: T | PromiseLike<T>) => void;\n    reject: (reason?: any) => void;\n    then: Promise<T>['then'];\n    catch: Promise<T>['catch'];\n\n    /**\n     * Instantiates a Deferred object.\n     */\n    constructor() {\n        this.promise = new Promise<T>((resolve, reject) => {\n            this.resolve = (value: T | PromiseLike<T>) => {\n                this.clearRejectTimeout();\n                resolve(value);\n            };\n            this.reject = (reason?: any) => {\n                this.clearRejectTimeout();\n                reject(reason);\n            };\n        });\n        this.then = this.promise.then.bind(this.promise);\n        this.catch = this.promise.catch.bind(this.promise);\n    }\n\n    /**\n     * Clears the reject timeout.\n     */\n    clearRejectTimeout(): void {\n        clearTimeout(this._timeout);\n    }\n\n    /**\n     * Rejects the promise after the given timeout.\n     */\n    setRejectTimeout(ms: number): void {\n        this._timeout = setTimeout(() => {\n            this.reject(new Error('timeout'));\n        }, ms);\n    }\n}\n","/* global RTCRtpScriptTransform */\n\nimport { getLogger } from '@jitsi/logger';\n\nconst logger = getLogger('e2ee:E2EEContext');\n\n// Flag to set on senders / receivers to avoid setting up the encryption transform\n// more than once.\nconst kJitsiE2EE = Symbol('kJitsiE2EE');\n\n/**\n * Context encapsulating the cryptography bits required for E2EE.\n * This uses the WebRTC Insertable Streams API which is explained in\n *   https://github.com/alvestrand/webrtc-media-streams/blob/master/explainer.md\n * that provides access to the encoded frames and allows them to be transformed.\n *\n * The encoded frame format is explained below in the _encodeFunction method.\n * High level design goals were:\n * - do not require changes to existing SFUs and retain (VP8) metadata.\n * - allow the SFU to rewrite SSRCs, timestamp, pictureId.\n * - allow for the key to be rotated frequently.\n */\nexport default class E2EEcontext {\n    /**\n     * Build a new E2EE context instance, which will be used in a given conference.\n     * @param {boolean} [options.sharedKey] - whether there is a uniques key shared amoung all participants.\n     */\n    constructor({ sharedKey } = {}) {\n        // Determine the URL for the worker script. Relative URLs are relative to\n        // the entry point, not the script that launches the worker.\n        let baseUrl = '';\n        const ljm = document.querySelector('script[src*=\"lib-jitsi-meet\"]');\n\n        if (ljm) {\n            const idx = ljm.src.lastIndexOf('/');\n\n            baseUrl = `${ljm.src.substring(0, idx)}/`;\n        }\n\n        let workerUrl = `${baseUrl}lib-jitsi-meet.e2ee-worker.js`;\n\n        // If there is no baseUrl then we create the worker in a normal way\n        // as you cant load scripts inside blobs from relative paths.\n        // See: https://www.html5rocks.com/en/tutorials/workers/basics/#toc-inlineworkers-loadingscripts\n        if (baseUrl && baseUrl !== '/') {\n            // Initialize the E2EE worker. In order to avoid CORS issues, start the worker and have it\n            // synchronously load the JS.\n            const workerBlob\n                = new Blob([ `importScripts(\"${workerUrl}\");` ], { type: 'application/javascript' });\n\n            workerUrl = window.URL.createObjectURL(workerBlob);\n        }\n\n        this._worker = new Worker(workerUrl, { name: 'E2EE Worker' });\n\n        this._worker.onerror = e => logger.error(e);\n\n        this._worker.postMessage({\n            operation: 'initialize',\n            sharedKey\n        });\n    }\n\n    /**\n     * Cleans up all state associated with the given participant. This is needed when a\n     * participant leaves the current conference.\n     *\n     * @param {string} participantId - The participant that just left.\n     */\n    cleanup(participantId) {\n        this._worker.postMessage({\n            operation: 'cleanup',\n            participantId\n        });\n    }\n\n    /**\n     * Cleans up all state associated with all participants in the conference. This is needed when disabling e2ee.\n     *\n     */\n    cleanupAll() {\n        this._worker.postMessage({\n            operation: 'cleanupAll'\n        });\n    }\n\n    /**\n     * Handles the given {@code RTCRtpReceiver} by creating a {@code TransformStream} which will inject\n     * a frame decoder.\n     *\n     * @param {RTCRtpReceiver} receiver - The receiver which will get the decoding function injected.\n     * @param {string} kind - The kind of track this receiver belongs to.\n     * @param {string} participantId - The participant id that this receiver belongs to.\n     */\n    handleReceiver(receiver, kind, participantId) {\n        if (receiver[kJitsiE2EE]) {\n            return;\n        }\n        receiver[kJitsiE2EE] = true;\n\n        if (window.RTCRtpScriptTransform) {\n            const options = {\n                operation: 'decode',\n                participantId\n            };\n\n            receiver.transform = new RTCRtpScriptTransform(this._worker, options);\n        } else {\n            const receiverStreams = receiver.createEncodedStreams();\n\n            this._worker.postMessage({\n                operation: 'decode',\n                participantId,\n                readableStream: receiverStreams.readable,\n                writableStream: receiverStreams.writable\n            }, [ receiverStreams.readable, receiverStreams.writable ]);\n        }\n    }\n\n    /**\n     * Handles the given {@code RTCRtpSender} by creating a {@code TransformStream} which will inject\n     * a frame encoder.\n     *\n     * @param {RTCRtpSender} sender - The sender which will get the encoding function injected.\n     * @param {string} kind - The kind of track this sender belongs to.\n     * @param {string} participantId - The participant id that this sender belongs to.\n     */\n    handleSender(sender, kind, participantId) {\n        if (sender[kJitsiE2EE]) {\n            return;\n        }\n        sender[kJitsiE2EE] = true;\n\n        if (window.RTCRtpScriptTransform) {\n            const options = {\n                operation: 'encode',\n                participantId\n            };\n\n            sender.transform = new RTCRtpScriptTransform(this._worker, options);\n        } else {\n            const senderStreams = sender.createEncodedStreams();\n\n            this._worker.postMessage({\n                operation: 'encode',\n                participantId,\n                readableStream: senderStreams.readable,\n                writableStream: senderStreams.writable\n            }, [ senderStreams.readable, senderStreams.writable ]);\n        }\n    }\n\n    /**\n     * Set the E2EE enabled state.\n     *\n     * @param {boolean} enabled - whether E2EE is enabled or not.\n     */\n    setEnabled(enabled) {\n        this._worker.postMessage({\n            enabled,\n            operation: 'setEnabled'\n        });\n    }\n\n    /**\n     * Set the E2EE key for the specified participant.\n     *\n     * @param {string} participantId - the ID of the participant who's key we are setting.\n     * @param {Uint8Array | boolean} key - they key for the given participant.\n     * @param {Number} keyIndex - the key index.\n     */\n    setKey(participantId, key, keyIndex) {\n        this._worker.postMessage({\n            key,\n            keyIndex,\n            operation: 'setKey',\n            participantId\n        });\n    }\n}\n","import { getLogger } from '@jitsi/logger';\n\nimport { JitsiConferenceEvents } from '../../JitsiConferenceEvents';\nimport { RTCEvents } from '../../service/RTC/RTCEvents';\nimport browser from '../browser';\nimport Deferred from '../util/Deferred';\nimport Listenable from '../util/Listenable';\n\nimport E2EEContext from './E2EEContext';\n\nconst logger = getLogger('e2ee:KeyHandler');\n\n/**\n * Abstract class that integrates {@link E2EEContext} with a key management system.\n */\nexport class KeyHandler extends Listenable {\n    /**\n     * Build a new KeyHandler instance, which will be used in a given conference.\n     * @param {JitsiConference} conference - the current conference.\n     * @param {object} options - the options passed to {E2EEContext}, see implemention.\n     */\n    constructor(conference, options = {}) {\n        super();\n\n        this.conference = conference;\n        this.e2eeCtx = new E2EEContext(options);\n\n        this.enabled = false;\n        this._enabling = undefined;\n        this._firstEnable = false;\n\n        // Conference media events in order to attach the encryptor / decryptor.\n        // FIXME add events to TraceablePeerConnection which will allow to see when there's new receiver or sender\n        // added instead of shenanigans around conference track events and track muted.\n        //\n\n        this.conference.on(\n            JitsiConferenceEvents._MEDIA_SESSION_STARTED,\n            this._onMediaSessionStarted.bind(this));\n        this.conference.on(\n            JitsiConferenceEvents.TRACK_ADDED,\n            track => track.isLocal() && this._onLocalTrackAdded(track));\n        this.conference.rtc.on(\n            RTCEvents.REMOTE_TRACK_ADDED,\n            (track, tpc) => this._setupReceiverE2EEForTrack(tpc, track));\n        this.conference.on(\n            JitsiConferenceEvents.TRACK_MUTE_CHANGED,\n            this._trackMuteChanged.bind(this));\n    }\n\n    /**\n     * Indicates whether E2EE is currently enabled or not.\n     *\n     * @returns {boolean}\n     */\n    isEnabled() {\n        return this.enabled;\n    }\n\n    /**\n     * Enables / disables End-To-End encryption.\n     *\n     * @param {boolean} enabled - whether E2EE should be enabled or not.\n     * @returns {void}\n     */\n    async setEnabled(enabled) {\n        this._enabling && await this._enabling;\n\n        if (enabled === this.enabled) {\n            return;\n        }\n\n        this._enabling = new Deferred();\n\n        this.enabled = enabled;\n\n        // Advertise E2EE support BEFORE establishing sessions so other participants\n        // know to establish sessions with us when they see our presence update.\n        this.conference.setLocalParticipantProperty('e2ee.enabled', enabled);\n\n        this._setEnabled && await this._setEnabled(enabled);\n\n        // Only restart media sessions if E2EE is enabled. If it's later disabled\n        // we'll continue to use the existing media sessions with an empty transform.\n        if (!this._firstEnable && enabled) {\n            this._firstEnable = true;\n            this.conference._restartMediaSessions();\n        }\n\n        this.e2eeCtx.setEnabled(enabled);\n\n        this._enabling.resolve();\n    }\n\n    /**\n     * Setup E2EE on the new track that has been added to the conference, apply it on all the open peerconnections.\n     * @param {JitsiLocalTrack} track - the new track that's being added to the conference.\n     * @private\n     */\n    _onLocalTrackAdded(track) {\n        for (const session of this.conference.getMediaSessions()) {\n            this._setupSenderE2EEForTrack(session, track);\n        }\n    }\n\n    /**\n     * Setups E2E encryption for the new session.\n     * @param {JingleSessionPC} session - the new media session.\n     * @private\n     */\n    _onMediaSessionStarted(session) {\n        const localTracks = this.conference.getLocalTracks();\n\n        for (const track of localTracks) {\n            this._setupSenderE2EEForTrack(session, track);\n        }\n    }\n\n    /**\n     * Setup E2EE for the receiving side.\n     *\n     * @private\n     */\n    _setupReceiverE2EEForTrack(tpc, track) {\n        if (!this.enabled && !this._firstEnable) {\n            return;\n        }\n\n        const receiver = tpc.findReceiverForTrack(track.track);\n\n        if (receiver) {\n            this.e2eeCtx.handleReceiver(receiver, track.getType(), track.getParticipantId());\n        } else {\n            logger.warn(`Could not handle E2EE for ${track}: receiver not found in: ${tpc}`);\n        }\n    }\n\n    /**\n     * Setup E2EE for the sending side.\n     *\n     * @param {JingleSessionPC} session - the session which sends the media produced by the track.\n     * @param {JitsiLocalTrack} track - the local track for which e2e encoder will be configured.\n     * @private\n     */\n    _setupSenderE2EEForTrack(session, track) {\n        if (!this.enabled && !this._firstEnable) {\n            return;\n        }\n\n        const pc = session.peerconnection;\n        const sender = pc && pc.findSenderForTrack(track.track);\n\n        if (sender) {\n            this.e2eeCtx.handleSender(sender, track.getType(), track.getParticipantId());\n        } else {\n            logger.warn(`Could not handle E2EE for ${track}: sender not found in ${pc}`);\n        }\n    }\n\n    /**\n     * Setup E2EE on the sender that is created for the unmuted local video track.\n     * @param {JitsiLocalTrack} track - the track for which muted status has changed.\n     * @private\n     */\n    _trackMuteChanged(track) {\n        if (browser.doesVideoMuteByStreamRemove() && track.isLocal() && track.isVideoTrack() && !track.isMuted()) {\n            for (const session of this.conference.getMediaSessions()) {\n                this._setupSenderE2EEForTrack(session, track);\n            }\n        }\n    }\n}\n","import { KeyHandler } from './KeyHandler';\n\n/**\n * This module integrates {@link E2EEContext} with {external} in order to set the keys for encryption.\n */\nexport class ExternallyManagedKeyHandler extends KeyHandler {\n    /**\n     * Build a new ExternallyManagedKeyHandler instance, which will be used in a given conference.\n     * @param conference - the current conference.\n     */\n    constructor(conference) {\n        super(conference, { sharedKey: true });\n    }\n\n    /**\n     * Sets the key and index for End-to-End encryption.\n     *\n     * @param {CryptoKey} [keyInfo.encryptionKey] - encryption key.\n     * @param {Number} [keyInfo.index] - the index of the encryption key.\n     * @returns {void}\n     */\n    setKey(keyInfo) {\n        this.e2eeCtx.setKey(undefined, { encryptionKey: keyInfo.encryptionKey }, keyInfo.index);\n    }\n}\n","import root from './_root.js';\n\n/**\n * Gets the timestamp of the number of milliseconds that have elapsed since\n * the Unix epoch (1 January 1970 00:00:00 UTC).\n *\n * @static\n * @memberOf _\n * @since 2.4.0\n * @category Date\n * @returns {number} Returns the timestamp.\n * @example\n *\n * _.defer(function(stamp) {\n *   console.log(_.now() - stamp);\n * }, _.now());\n * // => Logs the number of milliseconds it took for the deferred invocation.\n */\nvar now = function() {\n  return root.Date.now();\n};\n\nexport default now;\n","/** Used to match a single whitespace character. */\nvar reWhitespace = /\\s/;\n\n/**\n * Used by `_.trim` and `_.trimEnd` to get the index of the last non-whitespace\n * character of `string`.\n *\n * @private\n * @param {string} string The string to inspect.\n * @returns {number} Returns the index of the last non-whitespace character.\n */\nfunction trimmedEndIndex(string) {\n  var index = string.length;\n\n  while (index-- && reWhitespace.test(string.charAt(index))) {}\n  return index;\n}\n\nexport default trimmedEndIndex;\n","import trimmedEndIndex from './_trimmedEndIndex.js';\n\n/** Used to match leading whitespace. */\nvar reTrimStart = /^\\s+/;\n\n/**\n * The base implementation of `_.trim`.\n *\n * @private\n * @param {string} string The string to trim.\n * @returns {string} Returns the trimmed string.\n */\nfunction baseTrim(string) {\n  return string\n    ? string.slice(0, trimmedEndIndex(string) + 1).replace(reTrimStart, '')\n    : string;\n}\n\nexport default baseTrim;\n","import baseGetTag from './_baseGetTag.js';\nimport isObjectLike from './isObjectLike.js';\n\n/** `Object#toString` result references. */\nvar symbolTag = '[object Symbol]';\n\n/**\n * Checks if `value` is classified as a `Symbol` primitive or object.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a symbol, else `false`.\n * @example\n *\n * _.isSymbol(Symbol.iterator);\n * // => true\n *\n * _.isSymbol('abc');\n * // => false\n */\nfunction isSymbol(value) {\n  return typeof value == 'symbol' ||\n    (isObjectLike(value) && baseGetTag(value) == symbolTag);\n}\n\nexport default isSymbol;\n","import baseTrim from './_baseTrim.js';\nimport isObject from './isObject.js';\nimport isSymbol from './isSymbol.js';\n\n/** Used as references for various `Number` constants. */\nvar NAN = 0 / 0;\n\n/** Used to detect bad signed hexadecimal string values. */\nvar reIsBadHex = /^[-+]0x[0-9a-f]+$/i;\n\n/** Used to detect binary string values. */\nvar reIsBinary = /^0b[01]+$/i;\n\n/** Used to detect octal string values. */\nvar reIsOctal = /^0o[0-7]+$/i;\n\n/** Built-in method references without a dependency on `root`. */\nvar freeParseInt = parseInt;\n\n/**\n * Converts `value` to a number.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to process.\n * @returns {number} Returns the number.\n * @example\n *\n * _.toNumber(3.2);\n * // => 3.2\n *\n * _.toNumber(Number.MIN_VALUE);\n * // => 5e-324\n *\n * _.toNumber(Infinity);\n * // => Infinity\n *\n * _.toNumber('3.2');\n * // => 3.2\n */\nfunction toNumber(value) {\n  if (typeof value == 'number') {\n    return value;\n  }\n  if (isSymbol(value)) {\n    return NAN;\n  }\n  if (isObject(value)) {\n    var other = typeof value.valueOf == 'function' ? value.valueOf() : value;\n    value = isObject(other) ? (other + '') : other;\n  }\n  if (typeof value != 'string') {\n    return value === 0 ? value : +value;\n  }\n  value = baseTrim(value);\n  var isBinary = reIsBinary.test(value);\n  return (isBinary || reIsOctal.test(value))\n    ? freeParseInt(value.slice(2), isBinary ? 2 : 8)\n    : (reIsBadHex.test(value) ? NAN : +value);\n}\n\nexport default toNumber;\n","import isObject from './isObject.js';\nimport now from './now.js';\nimport toNumber from './toNumber.js';\n\n/** Error message constants. */\nvar FUNC_ERROR_TEXT = 'Expected a function';\n\n/* Built-in method references for those with the same name as other `lodash` methods. */\nvar nativeMax = Math.max,\n    nativeMin = Math.min;\n\n/**\n * Creates a debounced function that delays invoking `func` until after `wait`\n * milliseconds have elapsed since the last time the debounced function was\n * invoked. The debounced function comes with a `cancel` method to cancel\n * delayed `func` invocations and a `flush` method to immediately invoke them.\n * Provide `options` to indicate whether `func` should be invoked on the\n * leading and/or trailing edge of the `wait` timeout. The `func` is invoked\n * with the last arguments provided to the debounced function. Subsequent\n * calls to the debounced function return the result of the last `func`\n * invocation.\n *\n * **Note:** If `leading` and `trailing` options are `true`, `func` is\n * invoked on the trailing edge of the timeout only if the debounced function\n * is invoked more than once during the `wait` timeout.\n *\n * If `wait` is `0` and `leading` is `false`, `func` invocation is deferred\n * until to the next tick, similar to `setTimeout` with a timeout of `0`.\n *\n * See [David Corbacho's article](https://css-tricks.com/debouncing-throttling-explained-examples/)\n * for details over the differences between `_.debounce` and `_.throttle`.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Function\n * @param {Function} func The function to debounce.\n * @param {number} [wait=0] The number of milliseconds to delay.\n * @param {Object} [options={}] The options object.\n * @param {boolean} [options.leading=false]\n *  Specify invoking on the leading edge of the timeout.\n * @param {number} [options.maxWait]\n *  The maximum time `func` is allowed to be delayed before it's invoked.\n * @param {boolean} [options.trailing=true]\n *  Specify invoking on the trailing edge of the timeout.\n * @returns {Function} Returns the new debounced function.\n * @example\n *\n * // Avoid costly calculations while the window size is in flux.\n * jQuery(window).on('resize', _.debounce(calculateLayout, 150));\n *\n * // Invoke `sendMail` when clicked, debouncing subsequent calls.\n * jQuery(element).on('click', _.debounce(sendMail, 300, {\n *   'leading': true,\n *   'trailing': false\n * }));\n *\n * // Ensure `batchLog` is invoked once after 1 second of debounced calls.\n * var debounced = _.debounce(batchLog, 250, { 'maxWait': 1000 });\n * var source = new EventSource('/stream');\n * jQuery(source).on('message', debounced);\n *\n * // Cancel the trailing debounced invocation.\n * jQuery(window).on('popstate', debounced.cancel);\n */\nfunction debounce(func, wait, options) {\n  var lastArgs,\n      lastThis,\n      maxWait,\n      result,\n      timerId,\n      lastCallTime,\n      lastInvokeTime = 0,\n      leading = false,\n      maxing = false,\n      trailing = true;\n\n  if (typeof func != 'function') {\n    throw new TypeError(FUNC_ERROR_TEXT);\n  }\n  wait = toNumber(wait) || 0;\n  if (isObject(options)) {\n    leading = !!options.leading;\n    maxing = 'maxWait' in options;\n    maxWait = maxing ? nativeMax(toNumber(options.maxWait) || 0, wait) : maxWait;\n    trailing = 'trailing' in options ? !!options.trailing : trailing;\n  }\n\n  function invokeFunc(time) {\n    var args = lastArgs,\n        thisArg = lastThis;\n\n    lastArgs = lastThis = undefined;\n    lastInvokeTime = time;\n    result = func.apply(thisArg, args);\n    return result;\n  }\n\n  function leadingEdge(time) {\n    // Reset any `maxWait` timer.\n    lastInvokeTime = time;\n    // Start the timer for the trailing edge.\n    timerId = setTimeout(timerExpired, wait);\n    // Invoke the leading edge.\n    return leading ? invokeFunc(time) : result;\n  }\n\n  function remainingWait(time) {\n    var timeSinceLastCall = time - lastCallTime,\n        timeSinceLastInvoke = time - lastInvokeTime,\n        timeWaiting = wait - timeSinceLastCall;\n\n    return maxing\n      ? nativeMin(timeWaiting, maxWait - timeSinceLastInvoke)\n      : timeWaiting;\n  }\n\n  function shouldInvoke(time) {\n    var timeSinceLastCall = time - lastCallTime,\n        timeSinceLastInvoke = time - lastInvokeTime;\n\n    // Either this is the first call, activity has stopped and we're at the\n    // trailing edge, the system time has gone backwards and we're treating\n    // it as the trailing edge, or we've hit the `maxWait` limit.\n    return (lastCallTime === undefined || (timeSinceLastCall >= wait) ||\n      (timeSinceLastCall < 0) || (maxing && timeSinceLastInvoke >= maxWait));\n  }\n\n  function timerExpired() {\n    var time = now();\n    if (shouldInvoke(time)) {\n      return trailingEdge(time);\n    }\n    // Restart the timer.\n    timerId = setTimeout(timerExpired, remainingWait(time));\n  }\n\n  function trailingEdge(time) {\n    timerId = undefined;\n\n    // Only invoke if we have `lastArgs` which means `func` has been\n    // debounced at least once.\n    if (trailing && lastArgs) {\n      return invokeFunc(time);\n    }\n    lastArgs = lastThis = undefined;\n    return result;\n  }\n\n  function cancel() {\n    if (timerId !== undefined) {\n      clearTimeout(timerId);\n    }\n    lastInvokeTime = 0;\n    lastArgs = lastCallTime = lastThis = timerId = undefined;\n  }\n\n  function flush() {\n    return timerId === undefined ? result : trailingEdge(now());\n  }\n\n  function debounced() {\n    var time = now(),\n        isInvoking = shouldInvoke(time);\n\n    lastArgs = arguments;\n    lastThis = this;\n    lastCallTime = time;\n\n    if (isInvoking) {\n      if (timerId === undefined) {\n        return leadingEdge(lastCallTime);\n      }\n      if (maxing) {\n        // Handle invocations in a tight loop.\n        clearTimeout(timerId);\n        timerId = setTimeout(timerExpired, wait);\n        return invokeFunc(lastCallTime);\n      }\n    }\n    if (timerId === undefined) {\n      timerId = setTimeout(timerExpired, wait);\n    }\n    return result;\n  }\n  debounced.cancel = cancel;\n  debounced.flush = flush;\n  return debounced;\n}\n\nexport default debounce;\n","import Symbol from './_Symbol.js';\nimport arrayMap from './_arrayMap.js';\nimport isArray from './isArray.js';\nimport isSymbol from './isSymbol.js';\n\n/** Used as references for various `Number` constants. */\nvar INFINITY = 1 / 0;\n\n/** Used to convert symbols to primitives and strings. */\nvar symbolProto = Symbol ? Symbol.prototype : undefined,\n    symbolToString = symbolProto ? symbolProto.toString : undefined;\n\n/**\n * The base implementation of `_.toString` which doesn't convert nullish\n * values to empty strings.\n *\n * @private\n * @param {*} value The value to process.\n * @returns {string} Returns the string.\n */\nfunction baseToString(value) {\n  // Exit early for strings to avoid a performance hit in some environments.\n  if (typeof value == 'string') {\n    return value;\n  }\n  if (isArray(value)) {\n    // Recursively convert values (susceptible to call stack limits).\n    return arrayMap(value, baseToString) + '';\n  }\n  if (isSymbol(value)) {\n    return symbolToString ? symbolToString.call(value) : '';\n  }\n  var result = (value + '');\n  return (result == '0' && (1 / value) == -INFINITY) ? '-0' : result;\n}\n\nexport default baseToString;\n","/**\n * A specialized version of `_.map` for arrays without support for iteratee\n * shorthands.\n *\n * @private\n * @param {Array} [array] The array to iterate over.\n * @param {Function} iteratee The function invoked per iteration.\n * @returns {Array} Returns the new mapped array.\n */\nfunction arrayMap(array, iteratee) {\n  var index = -1,\n      length = array == null ? 0 : array.length,\n      result = Array(length);\n\n  while (++index < length) {\n    result[index] = iteratee(array[index], index, array);\n  }\n  return result;\n}\n\nexport default arrayMap;\n","import basePropertyOf from './_basePropertyOf.js';\n\n/** Used to map HTML entities to characters. */\nvar htmlUnescapes = {\n  '&amp;': '&',\n  '&lt;': '<',\n  '&gt;': '>',\n  '&quot;': '\"',\n  '&#39;': \"'\"\n};\n\n/**\n * Used by `_.unescape` to convert HTML entities to characters.\n *\n * @private\n * @param {string} chr The matched character to unescape.\n * @returns {string} Returns the unescaped character.\n */\nvar unescapeHtmlChar = basePropertyOf(htmlUnescapes);\n\nexport default unescapeHtmlChar;\n","/**\n * The base implementation of `_.propertyOf` without support for deep paths.\n *\n * @private\n * @param {Object} object The object to query.\n * @returns {Function} Returns the new accessor function.\n */\nfunction basePropertyOf(object) {\n  return function(key) {\n    return object == null ? undefined : object[key];\n  };\n}\n\nexport default basePropertyOf;\n","import toString from './toString.js';\nimport unescapeHtmlChar from './_unescapeHtmlChar.js';\n\n/** Used to match HTML entities and HTML characters. */\nvar reEscapedHtml = /&(?:amp|lt|gt|quot|#39);/g,\n    reHasEscapedHtml = RegExp(reEscapedHtml.source);\n\n/**\n * The inverse of `_.escape`; this method converts the HTML entities\n * `&amp;`, `&lt;`, `&gt;`, `&quot;`, and `&#39;` in `string` to\n * their corresponding characters.\n *\n * **Note:** No other HTML entities are unescaped. To unescape additional\n * HTML entities use a third-party library like [_he_](https://mths.be/he).\n *\n * @static\n * @memberOf _\n * @since 0.6.0\n * @category String\n * @param {string} [string=''] The string to unescape.\n * @returns {string} Returns the unescaped string.\n * @example\n *\n * _.unescape('fred, barney, &amp; pebbles');\n * // => 'fred, barney, & pebbles'\n */\nfunction unescape(string) {\n  string = toString(string);\n  return (string && reHasEscapedHtml.test(string))\n    ? string.replace(reEscapedHtml, unescapeHtmlChar)\n    : string;\n}\n\nexport default unescape;\n","import baseToString from './_baseToString.js';\n\n/**\n * Converts `value` to a string. An empty string is returned for `null`\n * and `undefined` values. The sign of `-0` is preserved.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to convert.\n * @returns {string} Returns the converted string.\n * @example\n *\n * _.toString(null);\n * // => ''\n *\n * _.toString(-0);\n * // => '-0'\n *\n * _.toString([1, 2, 3]);\n * // => '1,2,3'\n */\nfunction toString(value) {\n  return value == null ? '' : baseToString(value);\n}\n\nexport default toString;\n","/**\n * The errors for the connection.\n */\n\nexport enum JitsiConnectionErrors {\n\n    /**\n     * When the conference-request to jicofo fails.\n     */\n    CONFERENCE_REQUEST_FAILED = 'connection.conferenceRequestFailed',\n\n    /**\n     * Indicates that the connection was dropped with an error which was most likely\n     * caused by some networking issues. The dropped term in this context means that\n     * the connection was closed unexpectedly (not on user's request).\n     *\n     * One example is 'item-not-found' error thrown by Prosody when the BOSH session\n     * times out after 60 seconds of inactivity. On the other hand 'item-not-found'\n     * could also happen when BOSH request is sent to the server with the session-id\n     * that is not know to the server. But this should not happen in lib-jitsi-meet\n     * case as long as the service is configured correctly (there is no bug).\n     */\n    CONNECTION_DROPPED_ERROR = 'connection.droppedError',\n\n    /**\n     * Not ready error. When the conference error is not ready according to jicofo.\n     */\n    NOT_LIVE_ERROR = 'connection.notLiveError',\n\n    /**\n     * Not specified errors.\n     */\n    OTHER_ERROR = 'connection.otherError',\n\n    /**\n     * Indicates that a password is required in order to join the conference.\n     */\n    PASSWORD_REQUIRED = 'connection.passwordRequired',\n\n    /**\n     * Indicates that the connection was dropped, because of too many 5xx HTTP\n     * errors on BOSH requests.\n     */\n    SERVER_ERROR = 'connection.serverError',\n\n    /**\n     * Indicates that the connection was dropped, because of conference being moved to a new shard.\n     */\n    SHARD_CHANGED_ERROR = 'connection.shardChangedError'\n}\n\n// exported for backward compatibility\nexport const CONFERENCE_REQUEST_FAILED = JitsiConnectionErrors.CONFERENCE_REQUEST_FAILED;\nexport const CONNECTION_DROPPED_ERROR = JitsiConnectionErrors.CONNECTION_DROPPED_ERROR;\nexport const NOT_LIVE_ERROR = JitsiConnectionErrors.NOT_LIVE_ERROR;\nexport const OTHER_ERROR = JitsiConnectionErrors.OTHER_ERROR;\nexport const PASSWORD_REQUIRED = JitsiConnectionErrors.PASSWORD_REQUIRED;\nexport const SERVER_ERROR = JitsiConnectionErrors.SERVER_ERROR;\nexport const SHARD_CHANGED_ERROR = JitsiConnectionErrors.SHARD_CHANGED_ERROR;\n","/* eslint-disable */\n\n/*\n * A JavaScript implementation of the Secure Hash Algorithm, SHA-1, as defined\n * in FIPS PUB 180-1\n * Version 2.1a Copyright Paul Johnston 2000 - 2002.\n * Other contributors: Greg Holt, Andrew Kepert, Ydnar, Lostinet\n * Distributed under the BSD License\n * See http://pajhome.org.uk/crypt/md5 for details.\n */\n/* global define */\n\n/* Some functions and variables have been stripped for use with Strophe */\n\n/*\n * Calculate the SHA-1 of an array of big-endian words, and a bit length\n */\nfunction core_sha1(x: number[], len: number): number[] {\n    /* append padding */\n    x[len >> 5] |= 0x80 << (24 - len % 32);\n    x[((len + 64 >> 9) << 4) + 15] = len;\n\n    var w = new Array(80);\n    var a =  1732584193;\n    var b = -271733879;\n    var c = -1732584194;\n    var d =  271733878;\n    var e = -1009589776;\n\n    var i, j, t, olda, oldb, oldc, oldd, olde;\n    for (i = 0; i < x.length; i += 16) {\n        olda = a;\n        oldb = b;\n        oldc = c;\n        oldd = d;\n        olde = e;\n\n        for (j = 0; j < 80; j++) {\n            if (j < 16) {\n                w[j] = x[i + j];\n            } else {\n                w[j] = rol(w[j-3] ^ w[j-8] ^ w[j-14] ^ w[j-16], 1);\n            }\n\n            t = safe_add(safe_add(rol(a, 5), sha1_ft(j, b, c, d)),\n                         safe_add(safe_add(e, w[j]), sha1_kt(j)));\n            e = d;\n            d = c;\n            c = rol(b, 30);\n            b = a;\n            a = t;\n        }\n\n        a = safe_add(a, olda);\n        b = safe_add(b, oldb);\n        c = safe_add(c, oldc);\n        d = safe_add(d, oldd);\n        e = safe_add(e, olde);\n    }\n    return [a, b, c, d, e];\n}\n\n/*\n * Perform the appropriate triplet combination function for the current\n * iteration\n */\nfunction sha1_ft (t: number, b: number, c: number, d: number): number {\n    if (t < 20) { return (b & c) | ((~b) & d); }\n    if (t < 40) { return b ^ c ^ d; }\n    if (t < 60) { return (b & c) | (b & d) | (c & d); }\n    return b ^ c ^ d;\n}\n\n/*\n * Determine the appropriate additive constant for the current iteration\n */\nfunction sha1_kt(t: number): number {\n    return (t < 20) ?  1518500249 : (t < 40) ?  1859775393 : (t < 60) ? -1894007588 : -899497514;\n}\n\n/*\n * Calculate the HMAC-SHA1 of a key and some data\n */\nfunction core_hmac_sha1(key: string, data: string): number[] {\n    var bkey = str2binb(key);\n    if (bkey.length > 16) {\n        bkey = core_sha1(bkey, key.length * 8);\n    }\n\n    var ipad = new Array(16), opad = new Array(16);\n    for (var i = 0; i < 16; i++) {\n        ipad[i] = bkey[i] ^ 0x36363636;\n        opad[i] = bkey[i] ^ 0x5C5C5C5C;\n    }\n\n    var hash = core_sha1(ipad.concat(str2binb(data)), 512 + data.length * 8);\n    return core_sha1(opad.concat(hash), 512 + 160);\n}\n\n/*\n * Add integers, wrapping at 2^32. This uses 16-bit operations internally\n * to work around bugs in some JS interpreters.\n */\nfunction safe_add(x: number, y: number): number {\n    var lsw = (x & 0xFFFF) + (y & 0xFFFF);\n    var msw = (x >> 16) + (y >> 16) + (lsw >> 16);\n    return (msw << 16) | (lsw & 0xFFFF);\n}\n\n/*\n * Bitwise rotate a 32-bit number to the left.\n */\nfunction rol(num: number, cnt: number): number {\n    return (num << cnt) | (num >>> (32 - cnt));\n}\n\n/*\n * Convert an 8-bit or 16-bit string to an array of big-endian words\n * In 8-bit function, characters >255 have their hi-byte silently ignored.\n */\nfunction str2binb(str: string): number[] {\n    var bin = [];\n    var mask = 255;\n    for (var i = 0; i < str.length * 8; i += 8) {\n        bin[i>>5] |= (str.charCodeAt(i / 8) & mask) << (24 - i%32);\n    }\n    return bin;\n}\n\n/*\n * Convert an array of big-endian words to a base-64 string\n */\nfunction binb2b64 (binarray: number[]): string {\n    var tab = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\";\n    var str = \"\";\n    var triplet, j;\n    for (var i = 0; i < binarray.length * 4; i += 3) {\n        triplet = (((binarray[i   >> 2] >> 8 * (3 -  i   %4)) & 0xFF) << 16) |\n                  (((binarray[i+1 >> 2] >> 8 * (3 - (i+1)%4)) & 0xFF) << 8 ) |\n                  ((binarray[i+2 >> 2] >> 8 * (3 - (i+2)%4)) & 0xFF);\n\n        for (j = 0; j < 4; j++) {\n            if (i * 8 + j * 6 > binarray.length * 32) { str += \"=\"; }\n            else { str += tab.charAt((triplet >> 6*(3-j)) & 0x3F); }\n        }\n    }\n    return str;\n}\n\n/*\n * Convert an array of big-endian words to a string\n */\nfunction binb2str(bin: number[]): string {\n    var str = \"\";\n    var mask = 255;\n    for (var i = 0; i < bin.length * 32; i += 8) {\n        str += String.fromCharCode((bin[i>>5] >>> (24 - i%32)) & mask);\n    }\n    return str;\n}\n\n/*\n * These are the functions you'll usually want to call\n * They take string arguments and return either hex or base-64 encoded strings\n */\nconst SHA1 = {\n    b64_hmac_sha1:  function (key: string, data: string): string { return binb2b64(core_hmac_sha1(key, data)); },\n    b64_sha1:       function (s: string): string { return binb2b64(core_sha1(str2binb(s),s.length * 8)); },\n    binb2str:       binb2str,\n    core_hmac_sha1: core_hmac_sha1,\n    str_hmac_sha1:  function (key: string, data: string): string { return binb2str(core_hmac_sha1(key, data)); },\n    str_sha1:       function (s: string): string { return binb2str(core_sha1(str2binb(s),s.length * 8)); },\n};\nexport { SHA1 as default };\n","import { Strophe } from 'strophe.js'; // eslint-disable-line camelcase\n\nimport { XMPPEvents } from '../../service/xmpp/XMPPEvents';\nimport Listenable from '../util/Listenable';\nimport { findAll, getAttribute } from '../util/XMLUtils';\n\nimport ChatRoom from './ChatRoom';\nimport sha1 from './sha1';\n\n/**\n * The property\n */\nconst IDENTITY_PROPERTIES = [ 'category', 'type', 'lang', 'name' ];\nconst IDENTITY_PROPERTIES_FOR_COMPARE = [ 'category', 'type', 'lang' ];\nconst HASH = 'sha-1';\n\ntype Identity = {\n    category: string;\n    lang?: string;\n    name?: string;\n    type: string;\n};\n\n/**\n *\n * @param a\n * @param b\n */\nfunction compareIdentities(a: Identity, b: Identity): number {\n    let res = 0;\n\n    IDENTITY_PROPERTIES_FOR_COMPARE.some(key =>\n        (res = ((a[key as keyof Identity] > b[key as keyof Identity]) && 1) || ((a[key as keyof Identity] < b[key as keyof Identity]) && -1)) !== 0\n    );\n\n    return res;\n}\n\n/**\n * Produces a sha-1 from provided identity and features values.\n *\n * @param {Array<Object>} identities - The identity objects.\n * @param {Array<string>} features - The features.\n * @returns {string}\n */\nfunction generateSha(identities: Identity[], features: string[]): string {\n    const sortedIdentities = identities.sort(compareIdentities).reduce(\n        (accumulatedValue, identity) => `${\n            IDENTITY_PROPERTIES.reduce(\n                (tmp, key, idx) =>\n                    tmp\n                        + (idx === 0 ? '' : '/')\n                        + (identity[key as keyof Identity] ? identity[key as keyof Identity] : ''),\n                '')\n        }<`, '');\n    const sortedFeatures = features.sort().reduce(\n        (tmp, feature) => `${tmp + feature}<`, '');\n\n    return sha1.b64_sha1(sortedIdentities + sortedFeatures);\n}\n\n/**\n * Parses the disco-info node and returns the sets of features and identities.\n * @param {String} node The node with results to parse.\n * @returns {{features: Set<string>, identities: Set<Identity>}}\n */\nexport function parseDiscoInfo(node: Element): { features: Set<string>; identities: Set<Identity>; } {\n    const features = new Set<string>();\n    const identities = new Set<Identity>();\n\n    findAll(node, ':scope>query>feature').forEach(el => features.add(getAttribute(el, 'var')));\n    findAll(node, ':scope>query>identity').forEach(el => identities.add({\n        category: getAttribute(el, 'category'),\n        name: getAttribute(el, 'name'),\n        type: getAttribute(el, 'type')\n    }));\n\n    return {\n        features,\n        identities\n    };\n}\n\n/**\n * Implements xep-0115 ( http://xmpp.org/extensions/xep-0115.html )\n */\nexport default class Caps extends Listenable {\n    public node: string;\n    public disco: any; // Todo - strophe.disco\n    public version: string;\n    public rooms: Set<ChatRoom>;\n    public externalFeatures: Set<string>;\n    /**\n     * Constructs new Caps instance.\n     * @param {Strophe.Connection} connection the strophe connection object\n     * @param {String} node the value of the node attribute of the \"c\" xml node\n     * that will be sent to the other participants\n     */\n    constructor(connection: Strophe.Connection = {}, node: string = 'http://jitsi.org/jitsimeet') {\n        super();\n        this.node = node;\n        this.disco = connection.disco;\n        if (!this.disco) {\n            throw new Error(\n                'Missing strophe-plugins '\n                + '(disco plugin is required)!');\n        }\n\n        this.version = '';\n        this.rooms = new Set<ChatRoom>();\n\n        // We keep track of features added outside the library and we publish them\n        // in the presence of the participant for simplicity, avoiding the disco info request-response.\n        this.externalFeatures = new Set<string>();\n\n        const emuc = connection.emuc;\n\n        emuc.addListener(XMPPEvents.EMUC_ROOM_ADDED,\n            (room: ChatRoom) => this._addChatRoom(room));\n        emuc.addListener(XMPPEvents.EMUC_ROOM_REMOVED,\n            (room: ChatRoom) => this._removeChatRoom(room));\n        Object.keys(emuc.rooms).forEach((jid: string) => {\n            this._addChatRoom(emuc.rooms[jid]);\n        });\n\n        Strophe.addNamespace('CAPS', 'http://jabber.org/protocol/caps');\n        this.disco.addFeature(Strophe.NS.CAPS);\n    }\n\n\n    /**\n     * Returns a set with the features and identities for a host.\n     * @param {String} jid the jid of the host\n     * @param {String|null} node the node to query\n     * @param {int} timeout the timeout in ms for reply from the host.\n     * @returns {Promise<{features: Set<string>, identities: Set<Identity>}>}\n     * @private\n     */\n    private _getDiscoInfo(jid: string, node: string | null, timeout: number): Promise<{ features: Set<string>; identities: Set<Identity>; }> {\n        return new Promise((resolve, reject) =>\n            this.disco.info(jid, node, (response: Element) => {\n                resolve(parseDiscoInfo(response));\n            }, reject, timeout)\n        );\n    }\n\n    /**\n     * Adds ChatRoom instance to the list of rooms. Adds listeners to the room\n     * and adds \"c\" element to the presences of the room.\n     * @param {ChatRoom} room the room.\n     */\n    private _addChatRoom(room: ChatRoom): void {\n        this.rooms.add(room);\n        this._fixChatRoomPresenceMap(room);\n\n        this._updateRoomWithExternalFeatures(room);\n    }\n\n    /**\n     * Creates/updates the \"c\" xml node into the presence of the passed room.\n     * @param {ChatRoom} room the room.\n     */\n    private _fixChatRoomPresenceMap(room: ChatRoom): void {\n        room.addOrReplaceInPresence('c', {\n            attributes: {\n                hash: HASH,\n                node: this.node,\n                ver: this.version,\n                xmlns: Strophe.NS.CAPS\n            }\n        });\n    }\n\n    /**\n     * Generates the value for the \"ver\" attribute.\n     */\n    private _generateVersion(): void {\n        this.version\n            = generateSha(this.disco._identities, this.disco._features);\n\n        this._notifyVersionChanged();\n    }\n\n\n    /**\n     * Handles this.version changes.\n     */\n    private _notifyVersionChanged(): void {\n        // update the version for all rooms\n        this.rooms.forEach(room => this._fixChatRoomPresenceMap(room));\n    }\n\n    /**\n     * Removes ChatRoom instance from the list of rooms. Removes listeners\n     * added from the Caps class.\n     * @param {ChatRoom} room the room.\n     */\n    private _removeChatRoom(room: ChatRoom): void {\n        this.rooms.delete(room);\n    }\n\n    /**\n     * Updates the presences in the room based on the current values in externalFeatures.\n     * @param {ChatRoom} room the room to update.\n     * @private\n     */\n    private _updateRoomWithExternalFeatures(room: ChatRoom): void {\n        if (this.externalFeatures.size === 0) {\n            room.removeFromPresence('features');\n        } else {\n            const children: Array<{ attributes: { var: string; }; tagName: string; }> = [];\n\n            this.externalFeatures.forEach(f => {\n                children.push({\n                    attributes: { 'var': f },\n                    'tagName': 'feature'\n                });\n            });\n\n            room.addOrReplaceInPresence('features', { children });\n        }\n    }\n\n\n    /**\n     * Adds new feature to the list of supported features for the local\n     * participant\n     * @param {String} feature the name of the feature.\n     * @param {boolean} submit if true - new presence with updated \"c\" node\n     * will be sent.\n     * @param {boolean} external whether this feature was added externally to the library.\n     * We put features used directly by the clients (is jibri, remote-control enabled etc.) in the presence\n     * to avoid additional disco-info queries by those clients.\n     */\n    public addFeature(feature: string, submit: boolean = false, external: boolean = false): void {\n        this.disco.addFeature(feature);\n        this._generateVersion();\n\n        if (external && !this.externalFeatures.has(feature)) {\n            this.externalFeatures.add(feature);\n            this.rooms.forEach(room => this._updateRoomWithExternalFeatures(room));\n        }\n\n        if (submit) {\n            this.submit();\n        }\n    }\n\n    /**\n     * Returns a set with the features for a host.\n     * @param {String} jid the jid of the host\n     * @param {int} timeout the timeout in ms for reply from the host.\n     * @returns {Promise<{features: Set<string>, identities: Set<Identity>}>}\n     */\n    public getFeaturesAndIdentities(jid: string, node: string, timeout: number = 5000): Promise<{ features: Set<string>; identities: Set<Identity>; }> {\n        return this._getDiscoInfo(jid, node, timeout);\n    }\n\n    /**\n     * Removes a feature from the list of supported features for the local\n     * participant\n     * @param {String} feature the name of the feature.\n     * @param {boolean} submit if true - new presence with updated \"c\" node\n     * will be sent.\n     * @param {boolean} external whether this feature was added externally to the library.\n     */\n    public removeFeature(feature: string, submit: boolean = false, external: boolean = false): void {\n        this.disco.removeFeature(feature);\n        this._generateVersion();\n\n        if (external && this.externalFeatures.has(feature)) {\n            this.externalFeatures.delete(feature);\n            this.rooms.forEach(room => this._updateRoomWithExternalFeatures(room));\n        }\n\n        if (submit) {\n            this.submit();\n        }\n    }\n\n    /**\n         * Sends new presence stanza for every room from the list of rooms.\n         */\n    public submit(): void {\n        this.rooms.forEach(room => room.sendPresence(undefined));\n    }\n}\n","import { XMPPEvents } from '../../service/xmpp/XMPPEvents';\n\nimport ChatRoom from './ChatRoom';\nimport XMPP from './xmpp';\n\nexport const IDENTITY_TYPE = 'file-sharing';\n\n/**\n * The file metadata used in file sharing.\n * Fields like `authorParticipantId`, `authorParticipantJid`, and `authorParticipantName` and `conferenceFullName` will\n * be set by the backend, so passing them is optional.\n */\nexport type IFileMetadata = {\n    /**\n     * The ID of the participant who uploaded the file.\n     */\n    authorParticipantId?: string;\n\n    /**\n     * The connection JID of the participant who uploaded the file.\n     */\n    authorParticipantJid?: string;\n\n    /**\n     * The name of the participant who uploaded the file.\n     */\n    authorParticipantName?: string;\n\n    /**\n     * The jid of the conference where the file was uploaded.\n     */\n    conferenceFullName?: string;\n\n    /**\n     * The unique ID of the file.\n     */\n    fileId: string;\n\n    /**\n     * The name of the file.\n     */\n    fileName: string;\n\n    /**\n     * The size of the file in bytes.\n     */\n    fileSize: number;\n\n    /**\n     * The file type (file extension).\n     */\n    fileType: string;\n\n    /**\n     * The time when it was uploaded.\n     */\n    timestamp: number;\n};\n\n/**\n * The FileSharing logic.\n */\nexport default class FileSharing {\n    private _mainRoom: ChatRoom;\n    private _xmpp: XMPP;\n\n    /**\n     * Constructs File sharing manager for a room.\n     *\n     * @param {ChatRoom} room the main room.\n     */\n    constructor(room: ChatRoom) {\n        this._mainRoom = room;\n        this._xmpp = room.xmpp;\n\n        this._handleMessages = this._handleMessages.bind(this);\n        this._mainRoom.xmpp.addListener(XMPPEvents.FILE_SHARING_EVENT, this._handleMessages);\n    }\n\n    /**\n     * Stops listening for events.\n     */\n    dispose() {\n        this._mainRoom.xmpp.removeListener(XMPPEvents.FILE_SHARING_EVENT, this._handleMessages);\n    }\n\n    /**\n     * Whether file sharing is supported on backend.\n     *\n     * @returns {boolean} whether file sharing is supported on backend.\n     */\n    isSupported() {\n        return Boolean(this._xmpp.fileSharingComponentAddress);\n    }\n\n    /**\n     * Returns the file sharing identity type (service name).\n     *\n     * @returns {string} the file sharing service name.\n     */\n    getIdentityType() {\n        return IDENTITY_TYPE;\n    }\n\n    /**\n     * Adds a file to the file sharing component after the file has been uploaded.\n     * @param metadata - The metadata of the file to be added.\n     */\n    addFile(metadata: IFileMetadata) {\n        const message = {\n            type: 'add',\n            xmlns: 'http://jitsi.org/jitmeet'\n        };\n\n        this._sendMessage(message, metadata);\n    }\n\n    /**\n     * Removes a file from the file sharing component after the file was deleted.\n     * @param fileId - The file ID of the file to be removed.\n     */\n    removeFile(fileId: string) {\n        const message = {\n            fileId,\n            type: 'remove',\n            xmlns: 'http://jitsi.org/jitmeet'\n        };\n\n        this._sendMessage(message);\n    }\n\n    /**\n     * Helper to send a file sharing message to the component.\n     *\n     * @param {Object} message - Command that needs to be sent.\n     * @param {Object} content - The content to add to the element created if any.\n     */\n    _sendMessage(message: object, content?: object) {\n        const msg = $msg({ to: this._xmpp.fileSharingComponentAddress });\n\n        msg.c(IDENTITY_TYPE, message, content ? JSON.stringify(content) : undefined).up();\n\n        this._xmpp.connection.send(msg);\n    }\n\n    /**\n     * Handles a message for file sharing.\n     *\n     * @param {object} payload - Arbitrary data.\n     */\n    _handleMessages(payload) {\n        switch (payload.event) {\n        case 'add':\n\n            this._mainRoom.eventEmitter.emit(XMPPEvents.FILE_SHARING_FILE_ADDED, payload.file);\n\n            break;\n        case 'remove': {\n            this._mainRoom.eventEmitter.emit(XMPPEvents.FILE_SHARING_FILE_REMOVED, payload.fileId);\n            break;\n        }\n        case 'list': {\n            this._mainRoom.eventEmitter.emit(XMPPEvents.FILE_SHARING_FILES_RECEIVED, payload.files);\n            break;\n        }\n        }\n    }\n}\n","// Number of times the client attempts to reconnect to the XMPP server or JVB (in case of an ICE failure).\nexport const MAX_CONNECTION_RETRIES = 3;\n","import { getLogger } from '@jitsi/logger';\n\nimport Listenable from '../util/Listenable';\n\nexport const NETWORK_INFO_EVENT = 'NETWORK_INFO_CHANGED';\n\nconst logger = getLogger('connectivity:NetworkInfo');\n\nexport interface ICurrentNetworkInfo {\n    isOnline: boolean;\n}\n\n/**\n * Module provides information about the current status of the internet\n * connection. Lib-jitsi-meet doesn't have any logic for detecting internet\n * online/offline, but rather it relies on the information supplied by the app\n * that uses it. By default the online state is assumed and the lib acts as if\n * it was connected. See {@link JitsiMeetJS.setNetworkInfo}.\n */\nexport class NetworkInfo extends Listenable {\n    private _current: ICurrentNetworkInfo;\n\n    /**\n     * Creates new {@link NetworkInfo} instance.\n     */\n    constructor() {\n        super();\n        this._current = {\n            isOnline: true\n        };\n    }\n\n    /**\n     * Updates the network info state.\n     *\n     * @param {object} state - The network info state.\n     * @param {boolean} state.isOnline - {@code true} if the internet connectivity is online or {@code false}\n     * otherwise.\n     */\n    updateNetworkInfo({ isOnline }: { isOnline: boolean; }): void {\n        logger.debug('updateNetworkInfo', { isOnline });\n        this._current = {\n            isOnline: isOnline === true\n        };\n        this.eventEmitter.emit(NETWORK_INFO_EVENT, this._current);\n    }\n\n    /**\n     * Returns the online/offline internet status. By default the value is {@code true} and changes only if\n     * the lib's user wires the state through {@link JitsiMeetJS.setNetworkInfo} like the jitsi-meet does. Because of\n     * that any logic should still assume that the internet may be offline and should handle the failure gracefully.\n     * It's only a good hint in the other way around: to pause internet operations until it comes back online.\n     * @returns {boolean}\n     */\n    isOnline(): boolean {\n        return this._current.isOnline === true;\n    }\n}\n\nconst networkInfo = new NetworkInfo();\n\nexport default networkInfo;\n","/**\n * Gets next timeout using the full jitter pattern.\n *\n * NOTE that there are no checks for argument correctness, so either do the math or use defaults.\n *\n * @param {number} retry - The retry number.\n * @param {number} minDelay - The minimal delay in milliseconds.\n * @param {number} base - The exponent base.\n * @returns {number} - The amount of waiting before trying another time given in milliseconds.\n * @private\n */\nexport function getJitterDelay(retry: number, minDelay: number = 500, base: number = 2): number {\n    return Math.floor((Math.random() * ((Math.pow(base, retry) * 1000) - minDelay)) + minDelay);\n}\n","import { getLogger } from '@jitsi/logger';\nimport Strophe from 'strophe.js';\n\nimport {\n    NETWORK_INFO_EVENT,\n    default as NetworkInfo\n} from '../connectivity/NetworkInfo';\nimport { getJitterDelay } from '../util/Retry';\n\nconst logger = getLogger('xmpp:ResumeTask');\n\n\nexport interface INetworkInfoEvent {\n    isOnline: boolean;\n}\n\n/**\n * The class contains the logic for triggering connection resume via XEP-0198 stream management.\n * It does two things, the first one is it tracks the internet online/offline status and it makes sure that\n * the reconnect is attempted only while online. The seconds thing is that it tracks the retry attempts and extends\n * the retry interval using the full jitter pattern.\n */\nexport default class ResumeTask {\n    private _stropheConn: Strophe.Connection;\n    private _resumeRetryN: number;\n    private _retryDelay: Optional<number>;\n    private _resumeTimeout: Optional<NodeJS.Timeout>;\n    private _networkOnlineListener: Nullable<() => void>;\n\n    /**\n     * Initializes new {@code RetryTask}.\n     * @param {Strophe.Connection} stropheConnection - The Strophe connection instance.\n     */\n    constructor(stropheConnection: Strophe.Connection) {\n        this._stropheConn = stropheConnection;\n        this._resumeRetryN = 0;\n        this._retryDelay = undefined;\n        this._resumeTimeout = undefined;\n        this._networkOnlineListener = null;\n    }\n\n    /**\n     * @returns {number} - The amount of retries.\n     */\n    get retryCount(): number {\n        return this._resumeRetryN;\n    }\n\n    /**\n     * @returns {number|undefined} - How much the app will wait before trying to resume the XMPP connection. When\n     * 'undefined' it means that no resume task was not scheduled.\n     */\n    get retryDelay(): Optional<number> {\n        return this._retryDelay;\n    }\n\n    /**\n     * Cancels the delayed resume task.\n     *\n     * @private\n     * @returns {void}\n     */\n    private _cancelResume(): void {\n        if (this._resumeTimeout) {\n            logger.info('Canceling connection resume task');\n            clearTimeout(this._resumeTimeout);\n            this._resumeTimeout = undefined;\n            this._retryDelay = undefined;\n        }\n    }\n\n    /**\n     * Removes network online listener for the NETWORK_INFO_EVENT event.\n     *\n     * @private\n     * @returns {void}\n     */\n    private _removeNetworkOnlineListener(): void {\n        if (this._networkOnlineListener) {\n            this._networkOnlineListener();\n            this._networkOnlineListener = null;\n        }\n    }\n\n    /**\n     * Resumes the XMPP connection using the stream management plugin.\n     *\n     * @private\n     * @returns {void}\n     */\n    private _resumeConnection(): void {\n        this._resumeTimeout = undefined;\n\n        const { streamManagement } = this._stropheConn;\n        const resumeToken = streamManagement.getResumeToken();\n\n        // Things may have changed since when the task was scheduled\n        if (!resumeToken) {\n            return;\n        }\n\n        logger.info('Trying to resume the XMPP connection');\n\n        const url = new URL(this._stropheConn.service);\n        let { search } = url;\n        const pattern = /(previd=)([\\w-]+)/;\n        const oldToken = search.match(pattern);\n\n        // Replace previd if the previd value has changed.\n        if (oldToken && oldToken.indexOf(resumeToken) === -1) {\n            search = search.replace(pattern, `$1${resumeToken}`);\n\n        // Append previd if it doesn't exist.\n        } else if (!oldToken) {\n            search += search.indexOf('?') === -1 ? `?previd=${resumeToken}` : `&previd=${resumeToken}`;\n        }\n\n        url.search = search;\n\n        this._stropheConn.service = url.toString();\n\n        try {\n            streamManagement.resume();\n        } catch (e) {\n            logger.error('Failed to resume XMPP connection', e);\n        }\n    }\n\n    /**\n     * Schedules a delayed timeout which will execute the resume action.\n     * @private\n     * @returns {void}\n     */\n    private _scheduleResume(): void {\n        if (this._resumeTimeout) {\n            // NO-OP\n            return;\n        }\n\n        // The retry delay will be:\n        //   1st retry: 1.5s - 3s\n        //   2nd retry: 3s - 9s\n        //   3rd and next retry: 4.5s - 27s\n        this._retryDelay = getJitterDelay(\n            /* retry */ this._resumeRetryN,\n            /* minDelay */ this._resumeRetryN * 1500,\n            3\n        );\n\n        logger.info(`Will try to resume the XMPP connection in ${this.retryDelay}ms`);\n\n        this._resumeTimeout = setTimeout(() => this._resumeConnection(), this.retryDelay);\n    }\n\n    /**\n     * Cancels the retry task. It's called by {@link XmppConnection} when it's no longer interested in reconnecting for\n     * example when the disconnect method is called.\n     *\n     * @returns {void}\n     */\n    cancel(): void {\n        this._cancelResume();\n        this._removeNetworkOnlineListener();\n        this._resumeRetryN = 0;\n    }\n\n    /**\n     * Called by {@link XmppConnection} when the connection drops and it's a signal it wants to schedule a reconnect.\n     *\n     * @returns {void}\n     */\n    schedule(): void {\n        this._cancelResume();\n        this._removeNetworkOnlineListener();\n\n        this._resumeRetryN += 1;\n\n        this._networkOnlineListener = NetworkInfo.addCancellableListener(\n            NETWORK_INFO_EVENT,\n            ({ isOnline }: INetworkInfoEvent) => {\n                if (isOnline) {\n                    this._scheduleResume();\n                } else {\n                    this._cancelResume();\n                }\n            }\n        ) as () => void;\n\n        NetworkInfo.isOnline() && this._scheduleResume();\n    }\n}\n","/**\n * Attaches to the {@link Strophe.Connection.rawInput} which is called whenever any data is received from the server.\n */\n\nimport { Strophe } from 'strophe.js';\n\nimport XmppConnection from './XmppConnection';\n\n\nexport default class LastRequestTracker {\n    private _lastSuccess: Nullable<number>;\n    private _lastFailedMessage: Nullable<string>;\n\n    /**\n     * Initializes new instance.\n     */\n    constructor() {\n        this._lastSuccess = null;\n        this._lastFailedMessage = null;\n    }\n\n    /**\n     * Starts tracking requests on the given connection.\n     *\n     * @param {XmppConnection} xmppConnection - The XMPP connection which manages the given {@code stropheConnection}.\n     * @param {Strophe.Connection} stropheConnection - Strophe connection instance.\n     */\n    startTracking(xmppConnection: XmppConnection, stropheConnection: Strophe.Connection): void {\n        const originalRawInput = stropheConnection.rawInput;\n\n        stropheConnection.rawInput = (...args: any[]): void => {\n            const rawMessage = args[0];\n\n            if (rawMessage.includes('failure')) {\n                this._lastFailedMessage = rawMessage;\n            }\n\n            // It's okay to use rawInput callback only once the connection has been established, otherwise it will\n            // treat 'item-not-found' or other connection error on websocket reconnect as successful stanza received.\n            if (xmppConnection.connected) {\n                this._lastSuccess = Date.now();\n            }\n            originalRawInput.apply(stropheConnection, args);\n        };\n    }\n\n    /**\n     * Returns the last raw failed incoming message on the xmpp connection.\n     *\n     * @returns {Nullable<string>}\n     */\n    getLastFailedMessage(): Nullable<string> {\n        return this._lastFailedMessage;\n    }\n\n    /**\n     * Returns how many milliseconds have passed since the last successful BOSH request.\n     *\n     * @returns {Nullable<number>}\n     */\n    getTimeSinceLastSuccess(): Nullable<number> {\n        return this._lastSuccess\n            ? Date.now() - this._lastSuccess\n            : null;\n    }\n}\n","/* eslint-disable */\n\nimport { $build, Strophe } from 'strophe.js';\n\n/**\n* StropheJS - Stream Management XEP-0198\n*\n* This plugin implements stream management ACK capabilities of the specs XEP-0198.\n* Note: Resumption is not supported in this current implementation.\n*\n* Reference: http://xmpp.org/extensions/xep-0198.html\n*\n* @class streamManagement\n*/\ninterface IStreamManagementPlugin {\n\tlogging: boolean;\n\tautoSendCountOnEveryIncomingStanza: boolean;\n\trequestResponseInterval: number;\n\t_c: any;\n\t_NS: string;\n\t_isStreamManagementEnabled: boolean;\n\t_serverProcesssedStanzasCounter: number | null;\n\t_clientProcessedStanzasCounter: number | null;\n\t_clientSentStanzasCounter: number | null;\n\t_originalXMLOutput: ((elem: Element) => any) | null;\n\t_requestHandler: any;\n\t_incomingHandler: any;\n\t_requestResponseIntervalCount: number;\n\t_isSupported: boolean;\n\t_unacknowledgedStanzas: Element[];\n\t_acknowledgedStanzaListeners: ((stanza: Element) => void)[];\n\t_resumeToken?: string;\n\t_connectionStatus?: number;\n\t_resuming?: boolean;\n\t_connectArgs?: IArguments;\n\t_originalConnect?: (...args: any[]) => any;\n\t_originalOnStreamFeaturesAfterSASL?: (...args: any[]) => any;\n\t_originalDoDisconnect?: (...args: any[]) => any;\n\t_originalDisconnect?: (...args: any[]) => any;\n\t_resumeState?: any;\n\t_storedJid?: string;\n\t_ackHandler?: any;\n\t_enabledHandler?: any;\n\t_resumeFailedHandler?: any;\n\t_resumedHandler?: any;\n\n\taddAcknowledgedStanzaListener(listener: (stanza: Element) => void): void;\n\tenable(resume: boolean): void;\n\tgetResumeToken(): string | undefined;\n\tisSupported(): boolean;\n\tresume(): void;\n\trequestAcknowledgement(): void;\n\tgetOutgoingCounter(): number | null;\n\tgetIncomingCounter(): number | null;\n\tinit(conn: any): void;\n\tstatusChanged(status: number): void;\n\txmlOutput(elem: Element): any;\n\t_interceptDisconnect(): void;\n\t_interceptDoDisconnect(): void;\n\t_interceptConnectArgs(): void;\n\t_onStreamFeaturesAfterSASL(elem: Element): any;\n\t_incomingStanzaHandler(elem: Element): boolean;\n\t_handleEnabled(elem: Element): boolean;\n\t_handleResumeFailed(elem: Element): boolean;\n\t_handleResumed(elem: Element): boolean;\n\t_handleAcknowledgedStanzas(reportedHandledCount: number, lastKnownHandledCount: number): void;\n\t_handleServerRequestHandler(): boolean;\n\t_handleServerAck(elem: Element): boolean;\n\t_answerProcessedStanzas(): void;\n\t_increaseSentStanzasCounter(elem: Element): void;\n\t_increaseReceivedStanzasCounter(): void;\n\t_throwError(msg: string): never;\n}\n\nconst streamManagement: IStreamManagementPlugin = {\n\n\t/**\n\t* @property {Boolean} logging: Set to true to enable logging regarding out of sync stanzas.\n\t*/\n\tlogging: false,\n\n\t/**\n\t* @property {Boolean} autoSendCountOnEveryIncomingStanza: Set to true to send an 'a' response after every stanza.\n\t* @default false\n\t* @public\n\t*/\n\tautoSendCountOnEveryIncomingStanza: false,\n\n\t/**\n\t* @property {Integer} requestResponseInterval: Set this value to send a request for counter on very interval\n\t* number of stanzas sent. Set to 0 to disable.\n\t* @default 5\n\t* @public\n\t*/\n\trequestResponseInterval: 5,\n\n\t/**\n\t* @property {Pointer} _c: Strophe connection instance.\n\t* @private\n\t*/\n\t_c: null,\n\n\t/**\n\t* @property {String} _NS XMPP Namespace.\n\t* @private\n\t*/\n\t_NS: 'urn:xmpp:sm:3',\n\n\t/**\n\t* @property {Boolean} _isStreamManagementEnabled\n\t* @private\n\t*/\n\t_isStreamManagementEnabled: false,\n\n\t/**\n\t* @property {Integer} _serverProcesssedStanzasCounter: Keeps count of stanzas confirmed processed by the server.\n\t* The server is the source of truth of this value. It is the 'h' attribute on the latest 'a' element received\n\t* from the server.\n\t* @private\n\t*/\n\t_serverProcesssedStanzasCounter: null,\n\n\t/**\n\t* @property {Integer} _clientProcessedStanzasCounter: Counter of stanzas received by the client from the server.\n\t* Client is the source of truth of this value. It is the 'h' attribute in the 'a' sent from the client to\n\t* the server.\n\t* @private\n\t*/\n\t_clientProcessedStanzasCounter: null,\n\n\t/**\n\t* @property {Integer} _clientSentStanzasCounter\n\t* @private\n\t*/\n\t_clientSentStanzasCounter: null,\n\n\t/**\n\t* Stores a reference to Strophe connection xmlOutput function to wrap counting functionality.\n\t* @method _originalXMLOutput\n\t* @type {Handler}\n\t* @private\n\t*/\n\t_originalXMLOutput: null,\n\n\t/**\n\t* @property {Handler} _requestHandler: Stores reference to handler that process count request from server.\n\t* @private\n\t*/\n\t_requestHandler: null,\n\n\t/**\n\t* @property {Handler} _incomingHandler: Stores reference to handler that processes incoming stanzas count.\n\t* @private\n\t*/\n\t_incomingHandler: null,\n\n\t/**\n\t* @property {Integer} _requestResponseIntervalCount: Counts sent stanzas since last response request.\n\t*/\n\t_requestResponseIntervalCount: 0,\n\n\t/**\n\t * @property {boolean} _isSupported: indicates whether or not the server has advertised support for the stream\n\t * management namespace.\n\t */\n\t_isSupported: false,\n\n\t/**\n\t* @property {Queue} _unacknowledgedStanzas: Maintains a list of packet ids for stanzas which have yet to be acknowledged.\n\t*/\n\t_unacknowledgedStanzas: [],\n\n\t/**\n\t* @property {Array} _acknowledgedStanzaListeners: Stores callbacks for each stanza acknowledged by the server.\n\t* Provides the packet id of the stanza as a parameter.\n\t* @private\n\t*/\n\t_acknowledgedStanzaListeners: [],\n\n\taddAcknowledgedStanzaListener: function(listener: (stanza: Element) => void): void {\n\t\tthis._acknowledgedStanzaListeners.push(listener);\n\t},\n\n\tenable: function(resume: boolean): void {\n\t\tif (!this._isSupported) {\n\t\t\tthrow new Error('The server doesn\\'t support urn:xmpp:sm:3 namespace');\n\t\t} else if (this._connectionStatus !== Strophe.Status.CONNECTED) {\n\t\t\tthrow new Error('enable() can only be called in the CONNECTED state');\n\t\t}\n\t\tthis._c.send($build('enable', { xmlns: this._NS, resume }));\n\t\tthis._c.flush();\n\t\tthis._c.pause();\n\t},\n\n\tgetResumeToken: function(): Optional<string> {\n\t\treturn this._resumeToken;\n\t},\n\n\tisSupported(): boolean {\n\t\treturn this._isSupported;\n\t},\n\n\tresume: function(): void {\n\t\tif (!this.getResumeToken()) {\n\t\t\tthrow new Error('No resume token');\n\t\t}\n\t\tif (this._connectionStatus !== Strophe.Status.DISCONNECTED) {\n\t\t\tthrow new Error('resume() can only be called in the DISCONNECTED state');\n\t\t}\n\n\t\tthis._c.options.explicitResourceBinding = true;\n\t\tthis._resuming = true;\n\n\t\tthis._originalConnect!.apply(this._c, this._connectArgs);\n\t},\n\n\trequestAcknowledgement: function(): void {\n\t\tif (this._connectionStatus !== Strophe.Status.CONNECTED) {\n\t\t\tthrow new Error('requestAcknowledgement() can only be called in the CONNECTED state');\n\t\t}\n\t\tthis._requestResponseIntervalCount = 0;\n\t\tthis._c.send($build('r', { xmlns: this._NS }));\n\t},\n\n\tgetOutgoingCounter: function(): Nullable<number> {\n\t\treturn this._clientSentStanzasCounter;\n\t},\n\n\tgetIncomingCounter: function(): Nullable<number> {\n\t\treturn this._clientProcessedStanzasCounter;\n\t},\n\n\tinit: function(conn: any): void {\n\t\tthis._c = conn;\n\t\tStrophe.addNamespace('SM', this._NS);\n\n\t\t// Storing original xmlOutput function to use additional logic\n\t\tthis._originalXMLOutput = this._c.xmlOutput;\n\t\tthis._c.xmlOutput = this.xmlOutput.bind(this);\n\n\t\tthis._originalConnect = this._c.connect;\n\t\tthis._c.connect = this._interceptConnectArgs.bind(this);\n\n\t\tthis._originalOnStreamFeaturesAfterSASL = this._c._onStreamFeaturesAfterSASL;\n\t\tthis._c._onStreamFeaturesAfterSASL = this._onStreamFeaturesAfterSASL.bind(this);\n\n\t\tthis._originalDoDisconnect = this._c._doDisconnect;\n\t\tthis._c._doDisconnect = this._interceptDoDisconnect.bind(this);\n\n\t\tthis._originalDisconnect = this._c.disconnect;\n\t\tthis._c.disconnect = this._interceptDisconnect.bind(this);\n\t},\n\n\t_interceptDisconnect: function(): void {\n\t\tthis._resumeToken = undefined;\n\t\tthis._originalDisconnect!.apply(this._c, arguments);\n\t},\n\n\t_interceptDoDisconnect: function(): void {\n\t\tif (this.getResumeToken()\n\t\t\t\t&& !this._resuming\n\t\t\t\t&& this._c.connected && !this._c.disconnecting) {\n\t\t\tthis._resumeState = {\n\t\t\t\thandlers: this._c.handlers,\n\t\t\t\ttimedHandlers: this._c.timedHandlers,\n\t\t\t\tremoveTimeds: this._c.removeTimeds,\n\t\t\t\tremoveHandlers: this._c.removeHandlers,\n\t\t\t\taddTimeds: this._c.addTimeds,\n\t\t\t\taddHandlers: this._c.addHandlers\n\t\t\t};\n\t\t\tthis._storedJid = this._c.jid;\n\n\t\t\tthis.logging && Strophe.debug('SM stored resume state, handler count: ' + this._resumeState.handlers.length);\n\t\t}\n\n\t\t// Remove any queued stanzas from the buffer that have failed to send while the socket was closed,\n\t\t// as they would interfere with the resume flow. They will be resent anyway.\n\t\tthis._c._data = [];\n\n\t\tthis._originalDoDisconnect!.apply(this._c, arguments);\n\t},\n\n\t_interceptConnectArgs: function(): void {\n\t\tthis._connectArgs = arguments;\n\n\t\tthis._originalConnect!.apply(this._c, arguments);\n\t},\n\n\t_onStreamFeaturesAfterSASL: function(elem: Element): any {\n\t\tthis._isSupported = elem.getElementsByTagNameNS(this._NS, \"sm\").length > 0;\n\n\t\treturn this._originalOnStreamFeaturesAfterSASL!.apply(this._c, arguments);\n\t},\n\n\tstatusChanged: function (status: number): void {\n\t\tthis._connectionStatus = status;\n\t\tif (!this.getResumeToken()\n\t\t\t&& (status === Strophe.Status.CONNECTED || status === Strophe.Status.DISCONNECTED)) {\n\t\t\tthis.logging && Strophe.debug('SM reset state');\n\n\t\t\tthis._serverProcesssedStanzasCounter = 0;\n\t\t\tthis._clientProcessedStanzasCounter = 0;\n\n\t\t\tthis._clientSentStanzasCounter = 0;\n\n\t\t\tthis._isStreamManagementEnabled = false;\n\t\t\tthis._requestResponseIntervalCount = 0;\n\n\t\t\t// FIXME not described in JSDocs\n\t\t\tthis._resuming = false;\n\n\t\t\tif (status === Strophe.Status.DISCONNECTED) {\n\t\t\t\tthis._isSupported = false;\n\t\t\t}\n\n\t\t\tthis._unacknowledgedStanzas = [];\n\n\t\t\tif (this._requestHandler) {\n\t\t\t\tthis._c.deleteHandler(this._requestHandler);\n\t\t\t}\n\n\t\t\tif (this._incomingHandler) {\n\t\t\t\tthis._c.deleteHandler(this._incomingHandler);\n\t\t\t}\n\n\t\t\tthis._requestHandler = this._c.addHandler(this._handleServerRequestHandler.bind(this), this._NS, 'r');\n\t\t\tthis._ackHandler = this._c.addHandler(this._handleServerAck.bind(this), this._NS, 'a');\n\t\t\tthis._incomingHandler = this._c.addHandler(this._incomingStanzaHandler.bind(this));\n\n\t\t\t// FIXME handler instances stored, but never used\n\t\t\tthis._enabledHandler = this._c._addSysHandler(this._handleEnabled.bind(this), this._NS, 'enabled');\n\t\t\tthis._resumeFailedHandler = this._c._addSysHandler(this._handleResumeFailed.bind(this), this._NS, 'failed');\n\t\t\tthis._resumedHandler =  this._c._addSysHandler(this._handleResumed.bind(this), this._NS,'resumed');\n\n\t\t} else if (status === Strophe.Status.BINDREQUIRED)  {\n\t\t\tthis._c.jid = this._storedJid;\n\n\t\t\t// Restore Strophe handlers\n\t\t\tfor (const h of (this._resumeState.handlers || [])\n\t\t\t\t\t.concat(this._resumeState.addHandlers || [])) {\n\t\t\t\tthis._c._addSysHandler(h.handler, h.ns, h.name, h.type, h.id);\n\t\t\t}\n\t\t\tfor (const h of (this._resumeState.timedHandlers || [])\n\t\t\t\t\t.concat(this._resumeState.addTimeds)) {\n\t\t\t\tthis._c.addTimedHandler(h.period, h.handler);\n\t\t\t}\n\t\t\tfor (const h of (this._resumeState.removeTimeds || [])\n\t\t\t\t\t.concat(this._resumeState.removeHandlers || [])) {\n\t\t\t\tthis._c.deleteTimedHandler(h);\n\t\t\t}\n\n\t\t\t// FIXME check conditions if there's session ID and if enabled\n\t\t\tthis._c.send($build('resume', {\n\t\t\t\txmlns: this._NS,\n\t\t\t\th: this._clientProcessedStanzasCounter,\n\t\t\t\tprevid: this._resumeToken\n\t\t\t}));\n\t\t\tthis._c.flush();\n\t\t} else if (status === Strophe.Status.ERROR) {\n\t\t\tthis.logging && Strophe.debug('SM cleared resume token on error');\n\t\t\tthis._resumeToken = undefined;\n\t\t}\n\t},\n\n\t/**\n\t* This method overrides the send method implemented by Strophe.Connection\n\t* to count outgoing stanzas\n\t*\n\t* @method Send\n\t* @public\n\t*/\n\txmlOutput: function(elem: Element): any {\n\t\tif (Strophe.isTagEqual(elem, 'iq') ||\n\t\t\tStrophe.isTagEqual(elem, 'presence') ||\n\t\t\tStrophe.isTagEqual(elem, 'message')) {\n\t\t\tthis._increaseSentStanzasCounter(elem);\n\t\t}\n\n\t\treturn this._originalXMLOutput!.call(this._c, elem);\n\t},\n\n\t_handleEnabled: function(elem: Element): boolean {\n\t\tthis._isStreamManagementEnabled = true;\n\t\t// FIXME fail if requested, but not enabled\n\t\tthis._resumeToken = elem.getAttribute('resume') === 'true' && elem.getAttribute('id') || undefined;\n\n\t\tthis._c.resume();\n\n\t\treturn true;\n\t},\n\n\t_handleResumeFailed: function(elem: Element): boolean {\n\t\tconst error = elem && (\n\t\t\t(elem.firstElementChild && (elem.firstElementChild as Element).tagName)\n\t\t\t|| (elem.firstChild && (elem.firstChild as Element).tagName));\n\n\t\tthis._c._changeConnectStatus(Strophe.Status.ERROR, error, elem);\n\t\tthis._c._doDisconnect();\n\n\t\treturn true;\n\t},\n\n\t_handleResumed: function(elem: Element): boolean {\n\t\t// FIXME check if in the correct state\n\t\tvar handledCount = parseInt(elem.getAttribute('h')!);\n\t\tthis._handleAcknowledgedStanzas(handledCount, this._serverProcesssedStanzasCounter!);\n\n\t\tthis._resuming = false;\n\t\tthis._c.do_bind = false; // No need to bind our resource anymore\n\t\tthis._c.authenticated = true;\n\t\tthis._c.restored = true;\n\n\t\tif (this._unacknowledgedStanzas.length > 0) {\n\t\t\tthis.logging && Strophe.debug('SM Sending unacknowledged stanzas', this._unacknowledgedStanzas);\n\t\t\tfor(const stanza of this._unacknowledgedStanzas) {\n\t\t\t\tthis._c.send(stanza);\n\t\t\t}\n\t\t} else {\n\t\t\tthis.logging && Strophe.debug('SM No unacknowledged stanzas', this._unacknowledgedStanzas);\n\t\t}\n\n\t\tthis._c._changeConnectStatus(Strophe.Status.CONNECTED, null);\n\n\t\treturn true;\n\t},\n\n\t_incomingStanzaHandler: function(elem: Element): boolean {\n\t\tif (Strophe.isTagEqual(elem, 'iq') || Strophe.isTagEqual(elem, 'presence') || Strophe.isTagEqual(elem, 'message'))  {\n\t\t\tthis._increaseReceivedStanzasCounter();\n\n\t\t\tif (this.autoSendCountOnEveryIncomingStanza) {\n\t\t\t\tthis._answerProcessedStanzas();\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t},\n\n\t_handleAcknowledgedStanzas: function(reportedHandledCount: number, lastKnownHandledCount: number): void {\n\t\tvar delta = reportedHandledCount - lastKnownHandledCount;\n\n\t\tif (delta < 0) {\n\t\t\tthis._throwError('New reported stanza count lower than previous. New: ' + reportedHandledCount + ' - Previous: ' + lastKnownHandledCount);\n\t\t}\n\n\t\tif (delta > this._unacknowledgedStanzas.length) {\n\t\t\tthis._throwError('Higher reported acknowledge count than unacknowledged stanzas. Reported Acknowledge Count: ' + delta + ' - Unacknowledge Stanza Count: ' + this._unacknowledgedStanzas.length + ' - New: ' + reportedHandledCount + ' - Previous: ' + lastKnownHandledCount);\n\t\t}\n\n\t\tfor(var i = 0; i < delta; i++) {\n\t\t\tvar stanza = this._unacknowledgedStanzas.shift()!;\n\t\t\tfor (var j = 0; j < this._acknowledgedStanzaListeners.length; j++) {\n\t\t\t\tthis._acknowledgedStanzaListeners[j](stanza);\n\t\t\t}\n\t\t}\n\n\t\tif (this.logging && this._unacknowledgedStanzas.length > 0) {\n\t\t\tStrophe.warn('SM Unacknowledged stanzas', this._unacknowledgedStanzas);\n\t\t}\n\n\t\tthis._serverProcesssedStanzasCounter = reportedHandledCount;\n\n\t\tif (this.requestResponseInterval > 0) {\n\t\t\tthis._requestResponseIntervalCount = 0;\n\t\t}\n\t},\n\n\t_handleServerRequestHandler: function(): boolean {\n\t\tthis._answerProcessedStanzas();\n\n\t\treturn true;\n\t},\n\n\t_handleServerAck: function(elem: Element): boolean {\n\t\tvar handledCount = parseInt(elem.getAttribute('h')!);\n\t\tthis._handleAcknowledgedStanzas(handledCount, this._serverProcesssedStanzasCounter!);\n\n\t\treturn true;\n\t},\n\n\t_answerProcessedStanzas: function(): void {\n\t\tif (this._isStreamManagementEnabled) {\n\t\t\tthis._c.send($build('a', { xmlns: this._NS, h: this._clientProcessedStanzasCounter }));\n\t\t}\n\t},\n\n\t_increaseSentStanzasCounter: function(elem: Element): void {\n\t\tif (this._isStreamManagementEnabled) {\n\t\t\tif (this._unacknowledgedStanzas.indexOf(elem) !== -1) {\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis._unacknowledgedStanzas.push(elem);\n\t\t\tthis._clientSentStanzasCounter!++;\n\n\t\t\tif (this.requestResponseInterval > 0) {\n\t\t\t\tthis._requestResponseIntervalCount++;\n\n\t\t\t\tif (this._requestResponseIntervalCount === this.requestResponseInterval) {\n\t\t\t\t\t// FIXME Can not call send from onIdle.\n\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\tif (this._connectionStatus === Strophe.Status.CONNECTED) {\n\t\t\t\t\t\t\tthis.requestAcknowledgement();\n\t\t\t\t\t\t}\n\t\t\t\t\t}, 1);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\n\t_increaseReceivedStanzasCounter: function(): void {\n\t\tif (this._isStreamManagementEnabled) {\n\t\t\tthis._clientProcessedStanzasCounter!++;\n\t\t}\n\t},\n\n\t_throwError: function(msg: string): never {\n\t\tStrophe.error(msg);\n\t\tthrow new Error(msg);\n\t}\n\n};\n\nStrophe.addConnectionPlugin('streamManagement', streamManagement);\n","import Listenable from '../util/Listenable';\n\nimport XmppConnection from './XmppConnection';\n\n/**\n * Creates ConnectionPlugin class that extends the passed class.\n * @param {Class} base the definition of the class that will be extended by\n * ConnectionPlugin\n */\nfunction getConnectionPluginDefinition<T extends new (...args: any[]) => {}>(base: T = class {} as T) {\n    /**\n     * Base class for strophe connection plugins.\n     */\n    return class extends base {\n        connection: Nullable<XmppConnection>;\n        /**\n         *\n         */\n        constructor(...args: any[]) {\n            super(...args);\n            this.connection = null;\n        }\n\n        /**\n         *\n         * @param connection\n         */\n        init(connection: XmppConnection): void {\n            this.connection = connection;\n        }\n    };\n}\n\n/**\n * ConnectionPlugin class.\n */\nexport default getConnectionPluginDefinition();\n\n/**\n * ConnectionPlugin class that extends Listenable.\n */\nexport const ConnectionPluginListenable = getConnectionPluginDefinition(Listenable);\n","import { getLogger } from '@jitsi/logger';\nimport { $iq, Strophe } from 'strophe.js';\n\nimport ConnectionPlugin from './ConnectionPlugin';\n\nconst logger = getLogger('xmpp:strophe.ping');\n\n/**\n * Default ping every 10 sec\n */\nconst PING_DEFAULT_INTERVAL = 10000;\n\n/**\n * Default ping timeout error after 5 sec of waiting.\n */\nconst PING_DEFAULT_TIMEOUT = 5000;\n\n/**\n * Default value for how many ping failures will be tolerated before the WebSocket connection is killed.\n * The worst case scenario in case of ping timing out without a response is (25 seconds at the time of this writing):\n * PING_THRESHOLD * PING_INTERVAL + PING_TIMEOUT\n */\nconst PING_DEFAULT_THRESHOLD = 2;\n\nexport interface IPingOptions {\n    interval?: number;\n    threshold?: number;\n    timeout?: number;\n}\n\nexport interface IPingConnectionPluginOptions {\n    getTimeSinceLastServerResponse: () => number;\n    onPingThresholdExceeded: () => void;\n    pingOptions?: IPingOptions;\n}\n\n/**\n * XEP-0199 ping plugin.\n *\n * Registers \"urn:xmpp:ping\" namespace under Strophe.NS.PING.\n */\nexport default class PingConnectionPlugin extends ConnectionPlugin {\n    failedPings: number;\n    _onPingThresholdExceeded: () => void;\n    _getTimeSinceLastServerResponse: () => number;\n    pingInterval: number;\n    pingTimeout: number;\n    pingThreshold: number;\n    pingTimestampsToKeep: number;\n    pingExecIntervals: number[];\n    intervalId: Nullable<number>;\n    _lastServerCheck: number;\n\n    /**\n     * Constructs new object\n     * @param {Object} options\n     * @param {Function} options.onPingThresholdExceeded - Callback called when ping fails too many times (controlled\n     * by the {@link PING_THRESHOLD} constant).\n     * @param {Function} options.getTimeSinceLastServerResponse - A function to obtain the last seen\n     * response from the server.\n     * @param {Object} options.pingOptions - The ping options if any.\n     * @constructor\n     */\n    constructor({ getTimeSinceLastServerResponse, onPingThresholdExceeded, pingOptions = {} }: IPingConnectionPluginOptions) {\n        super();\n        this.failedPings = 0;\n        this._onPingThresholdExceeded = onPingThresholdExceeded;\n        this._getTimeSinceLastServerResponse = getTimeSinceLastServerResponse;\n\n        this.pingInterval = typeof pingOptions.interval === 'number' ? pingOptions.interval : PING_DEFAULT_INTERVAL;\n        this.pingTimeout = typeof pingOptions.timeout === 'number' ? pingOptions.timeout : PING_DEFAULT_TIMEOUT;\n        this.pingThreshold = typeof pingOptions.threshold === 'number'\n            ? pingOptions.threshold : PING_DEFAULT_THRESHOLD;\n\n        // The number of timestamps of send pings to keep.\n        // The current value is 2 minutes.\n        this.pingTimestampsToKeep = Math.round(120000 / this.pingInterval);\n        this.pingExecIntervals = new Array(this.pingTimestampsToKeep);\n    }\n\n    /**\n     * Initializes the plugin. Method called by Strophe.\n     * @param connection Strophe connection instance.\n     */\n    override init(connection: Strophe.Connection): void {\n        super.init(connection);\n        Strophe.addNamespace('PING', 'urn:xmpp:ping');\n    }\n\n    /* eslint-disable max-params */\n\n    /**\n     * Sends \"ping\" to given <tt>jid</tt>\n     * @param jid the JID to which ping request will be sent.\n     * @param success callback called on success.\n     * @param error callback called on error.\n     * @param timeout ms how long are we going to wait for the response. On\n     * timeout <tt>error<//t> callback is called with undefined error argument.\n     */\n    ping(jid: string, success: (result: any) => void, error: (err: any) => void, timeout: number): void {\n        this._addPingExecutionTimestamp();\n\n        const iq = $iq({\n            to: jid,\n            type: 'get'\n        });\n\n        iq.c('ping', { xmlns: Strophe.NS.PING });\n        this.connection.sendIQ2(iq, { timeout })\n            .then(success, error);\n    }\n\n    /* eslint-enable max-params */\n\n    /**\n     * Starts to send ping in given interval to specified remote JID.\n     * This plugin supports only one such task and <tt>stopInterval</tt>\n     * must be called before starting a new one.\n     * @param remoteJid remote JID to which ping requests will be sent to.\n     */\n    startInterval(remoteJid: string): void {\n        clearInterval(this.intervalId);\n        this.intervalId = window.setInterval(() => {\n\n            // when there were some server responses in the interval since the last time we checked (_lastServerCheck)\n            // let's skip the ping\n\n            const now = Date.now();\n\n            if (this._getTimeSinceLastServerResponse() < now - this._lastServerCheck) {\n                // do this just to keep in sync the intervals so we can detect suspended device\n                this._addPingExecutionTimestamp();\n\n                this._lastServerCheck = now;\n                this.failedPings = 0;\n\n                return;\n            }\n\n            this.ping(remoteJid, () => {\n                // server response is measured on raw input and ping response time is measured after all the xmpp\n                // processing is done in js, so there can be some misalignment when we do the check above.\n                // That's why we store the last time we got the response\n                this._lastServerCheck = this._getTimeSinceLastServerResponse() + Date.now();\n\n                this.failedPings = 0;\n            }, error => {\n                this.failedPings += 1;\n                const errmsg = `Ping ${error ? 'error' : 'timeout'}`;\n\n                if (this.failedPings >= this.pingThreshold) {\n                    logger.error(errmsg, error);\n                    this._onPingThresholdExceeded && this._onPingThresholdExceeded();\n                } else {\n                    logger.warn(errmsg, error);\n                }\n            }, this.pingTimeout);\n        }, this.pingInterval);\n        logger.info(`XMPP pings will be sent every ${this.pingInterval} ms`);\n    }\n\n    /**\n     * Stops current \"ping\"  interval task.\n     */\n    stopInterval(): void {\n        if (this.intervalId) {\n            window.clearInterval(this.intervalId);\n            this.intervalId = null;\n            this.failedPings = 0;\n            logger.info('Ping interval cleared');\n        }\n    }\n\n    /**\n     * Adds the current time to the array of send ping timestamps.\n     * @private\n     */\n    _addPingExecutionTimestamp(): void {\n        this.pingExecIntervals.push(new Date().getTime());\n\n        // keep array length to PING_TIMESTAMPS_TO_KEEP\n        if (this.pingExecIntervals.length > this.pingTimestampsToKeep) {\n            this.pingExecIntervals.shift();\n        }\n    }\n\n    /**\n     * Returns the maximum time between the recent sent pings, if there is a\n     * big value it means the computer was inactive for some time(suspended).\n     * Checks the maximum gap between sending pings, considering and the\n     * current time. Trying to detect computer inactivity (sleep).\n     *\n     * @returns {int} the time ping was suspended, if it was not 0 is returned.\n     */\n    getPingSuspendTime(): number {\n        const pingIntervals = this.pingExecIntervals.slice();\n\n        // we need current time, as if ping was sent now\n        // if computer sleeps we will get correct interval after next\n        // scheduled ping, bet we sometimes need that interval before waiting\n        // for the next ping, on closing the connection on error.\n        pingIntervals.push(new Date().getTime());\n\n        let maxInterval = 0;\n        let previousTS = pingIntervals[0];\n\n        pingIntervals.forEach(e => {\n            const currentInterval = e - previousTS;\n\n            if (currentInterval > maxInterval) {\n                maxInterval = currentInterval;\n            }\n\n            previousTS = e;\n        });\n\n        // remove the interval between the ping sent\n        // this way in normal execution there is no suspend and the return\n        // will be 0 or close to 0.\n        maxInterval -= this.pingInterval;\n\n        // make sure we do not return less than 0\n        return Math.max(maxInterval, 0);\n    }\n}\n","import { getLogger } from '@jitsi/logger';\nimport { $pres, Strophe } from 'strophe.js';\n\nimport { MAX_CONNECTION_RETRIES } from '../../service/connectivity/Constants';\nimport Listenable from '../util/Listenable';\n\nimport ResumeTask from './ResumeTask';\nimport LastSuccessTracker from './StropheLastSuccess';\nimport './strophe.stream-management';\nimport MucConnectionPlugin from './strophe.emuc';\nimport JingleConnectionPlugin from './strophe.jingle';\nimport PingConnectionPlugin, { IPingOptions } from './strophe.ping';\nimport RayoConnectionPlugin from './strophe.rayo';\n\nconst logger = getLogger('xmpp:XmppConnection');\n\n/**\n * Extended ping options interface that includes domain property\n */\ninterface IXmppPingOptions extends IPingOptions {\n    domain?: string;\n}\n\n/**\n * Interface for connection plugins\n */\ninterface IConnectionPlugin {\n    init: (connection: XmppConnection) => void;\n}\n\n/**\n * IQ result callback type - result is typically an XML Element\n */\nexport type IQResultCallback = (result: Element) => void;\n\n/**\n * IQ error callback type - error can be a string, Element, Error object, or undefined (timeout)\n */\nexport type ErrorCallback = (error: string | Element | Error | undefined) => void;\n\n/**\n * Connection status callback type\n */\ntype IConnectionStatusCallback = (status: Strophe.Status, condition?: string, element?: Element) => void;\n\n/**\n * @typedef DeferredSendIQ Object\n * @property {Element} iq - The IQ to send.\n * @property {function} resolve - The resolve method of the deferred Promise.\n * @property {function} reject - The reject method of the deferred Promise.\n * @property {number} timeout - The ID of the timeout task that needs to be cleared, before sending the IQ.\n * @property {number} start - The timestamp when the deferred IQ was created.\n */\ninterface IDeferredSendIQ {\n    iq: Element | undefined;\n    reject: (error: string | Element | Error | undefined) => void;\n    resolve: (result: Element) => void;\n    start: number;\n    timeout: ReturnType<typeof setTimeout>;\n}\n\n/**\n * Constructor options interface for XmppConnection\n */\ninterface IXmppConnectionOptions {\n    enableWebsocketResume?: boolean;\n    serviceUrl: string;\n    shard?: string;\n    websocketKeepAlive?: number;\n    websocketKeepAliveUrl?: string;\n    xmppPing?: IXmppPingOptions;\n}\n\n/**\n * Internal options interface\n */\ninterface IInternalOptions {\n    enableWebsocketResume: boolean;\n    pingOptions?: IXmppPingOptions;\n    shard?: string;\n    websocketKeepAlive: number;\n    websocketKeepAliveUrl?: string;\n}\n\n/**\n * The lib-jitsi-meet layer for {@link Strophe.Connection}.\n * @internal\n */\nexport default class XmppConnection extends Listenable {\n\n    private _options: IInternalOptions;\n    private _usesWebsocket: boolean;\n    private _rawInputTracker: LastSuccessTracker;\n    private _resumeTask: ResumeTask;\n    private _deferredIQs: IDeferredSendIQ[];\n    private _oneSuccessfulConnect: boolean;\n    private _status: Strophe.Status;\n    private _wsKeepAlive: Optional<ReturnType<typeof setTimeout>>;\n\n    /**\n     * @internal\n     */\n    _stropheConn: Strophe.Connection;\n    public ping: PingConnectionPlugin;\n    public jingle?: JingleConnectionPlugin;\n    public rayo?: RayoConnectionPlugin;\n    public emuc?: MucConnectionPlugin;\n    /**\n     * @internal\n     */\n    _breakoutMovingToMain?: string;\n\n    /**\n     * The list of {@link XmppConnection} events.\n     *\n     * @returns {Object}\n     */\n    static get Events() {\n        return {\n            CONN_SHARD_CHANGED: 'CONN_SHARD_CHANGED',\n            CONN_STATUS_CHANGED: 'CONN_STATUS_CHANGED'\n        };\n    }\n\n    /**\n     * The list of Xmpp connection statuses.\n     *\n     * @returns {Strophe.Status}\n     */\n    static get Status() {\n        return Strophe.Status;\n    }\n\n    /**\n     * Initializes new connection instance.\n     *\n     * @param {Object} options\n     * @param {String} options.serviceUrl - The BOSH or WebSocket service URL.\n     * @param {String} options.shard - The BOSH or WebSocket is connecting to this shard.\n     * Useful for detecting when shard changes.\n     * @param {String} [options.enableWebsocketResume=true] - True/false to control the stream resumption functionality.\n     * It will enable automatically by default if supported by the XMPP server.\n     * @param {Number} [options.websocketKeepAlive=60000] - The websocket keep alive interval.\n     * It's the interval + a up to a minute of jitter. Pass -1 to disable.\n     * The keep alive is HTTP GET request to {@link options.serviceUrl} or to {@link options.websocketKeepAliveUrl}.\n     * @param {Number} [options.websocketKeepAliveUrl] - The websocket keep alive url to use if any,\n     * if missing the serviceUrl url will be used.\n     * @param {Object} [options.xmppPing] - The xmpp ping settings.\n     */\n    constructor({ enableWebsocketResume, websocketKeepAlive, websocketKeepAliveUrl, serviceUrl, shard, xmppPing }: IXmppConnectionOptions) {\n        super();\n        this._options = {\n            enableWebsocketResume: typeof enableWebsocketResume === 'undefined' ? true : enableWebsocketResume,\n            pingOptions: xmppPing,\n            shard,\n            websocketKeepAlive: typeof websocketKeepAlive === 'undefined' ? 60 * 1000 : Number(websocketKeepAlive),\n            websocketKeepAliveUrl\n        };\n\n        this._stropheConn = new Strophe.Connection(serviceUrl);\n\n        // The mechanisms priorities as defined by Strophe\n        // *      Mechanism       Priority\n        // *      ------------------------\n        // *      SCRAM-SHA-1     60\n        // *      PLAIN           50\n        // *      ANONYMOUS       20\n        this._stropheConn.registerSASLMechanisms([\n            Strophe.SASLAnonymous,\n            Strophe.SASLPlain,\n            Strophe.SASLSHA1\n        ]);\n        this._usesWebsocket = serviceUrl.startsWith('ws:') || serviceUrl.startsWith('wss:');\n\n        // The default maxRetries is 5, which is too long.\n        this._stropheConn.maxRetries = 3;\n\n        this._rawInputTracker = new LastSuccessTracker();\n        this._rawInputTracker.startTracking(this, this._stropheConn);\n\n        this._resumeTask = new ResumeTask(this._stropheConn);\n\n        /**\n         * @typedef DeferredSendIQ Object\n         * @property {Element} iq - The IQ to send.\n         * @property {function} resolve - The resolve method of the deferred Promise.\n         * @property {function} reject - The reject method of the deferred Promise.\n         * @property {number} timeout - The ID of the timeout task that needs to be cleared, before sending the IQ.\n         */\n        /**\n         * Deferred IQs to be sent upon reconnect.\n         * @type {Array<DeferredSendIQ>}\n         * @private\n         */\n        this._deferredIQs = [];\n\n        // Ping plugin is mandatory for the Websocket mode to work correctly. It's used to detect when the connection\n        // is broken (WebSocket/TCP connection not closed gracefully).\n        this.addConnectionPlugin(\n            'ping',\n            new PingConnectionPlugin({\n                getTimeSinceLastServerResponse: () => this.getTimeSinceLastSuccess(),\n                onPingThresholdExceeded: () => this._onPingErrorThresholdExceeded(),\n                pingOptions: xmppPing\n            }));\n\n        // tracks whether this is the initial connection or a reconnect\n        this._oneSuccessfulConnect = false;\n    }\n\n    /**\n     * A getter for the connected state.\n     *\n     * @returns {boolean}\n     */\n    get connected(): boolean {\n        const websocket = this._stropheConn?._proto?.socket;\n\n        return (this._status === Strophe.Status.CONNECTED || this._status === Strophe.Status.ATTACHED)\n            && (!this.isUsingWebSocket || (websocket && websocket.readyState === WebSocket.OPEN));\n    }\n\n    /**\n     * Retrieves the feature discovery plugin instance.\n     *\n     * @returns {Strophe.Connection.disco}\n     */\n    get disco() {\n        return this._stropheConn.disco;\n    }\n\n    /**\n     * A getter for the disconnecting state.\n     *\n     * @returns {boolean}\n     */\n    get disconnecting(): boolean {\n        return this._stropheConn.disconnecting === true;\n    }\n\n    /**\n     * A getter for the domain.\n     *\n     * @returns {Nullable<string>}\n     */\n    get domain(): Nullable<string> {\n        return this._stropheConn.domain;\n    }\n\n    /**\n     * Tells if Websocket is used as the transport for the current XMPP connection. Returns true for Websocket or false\n     * for BOSH.\n     * @returns {boolean}\n     */\n    get isUsingWebSocket(): boolean {\n        return this._usesWebsocket;\n    }\n\n    /**\n     * A getter for the JID.\n     *\n     * @returns {string|null}\n     */\n    get jid(): string | null {\n        return this._stropheConn.jid;\n    }\n\n    /**\n     * Returns headers for the last BOSH response received.\n     *\n     * @returns {string}\n     */\n    get lastResponseHeaders(): string {\n        return this._stropheConn._proto?.lastResponseHeaders;\n    }\n\n    /**\n     * A getter for the logger plugin instance.\n     *\n     * @returns {*}\n     */\n    get logger() {\n        return this._stropheConn.logger;\n    }\n\n    /**\n     * A getter for the connection options.\n     *\n     * @returns {*}\n     */\n    get options() {\n        return this._stropheConn.options;\n    }\n\n    /**\n     * A getter for the domain to be used for ping.\n     */\n    get pingDomain(): string | null {\n        return this._options.pingOptions?.domain || this.domain;\n    }\n\n    /**\n     * A getter for the service URL.\n     *\n     * @returns {string}\n     */\n    get service(): string {\n        return this._stropheConn.service;\n    }\n\n    /**\n     * Sets new value for shard.\n     * @param value the new shard value.\n     */\n    set shard(value: string) {\n        this._options.shard = value;\n\n        // shard setting changed so let's schedule a new keep-alive check if connected\n        if (this._oneSuccessfulConnect) {\n            this._maybeStartWSKeepAlive();\n        }\n    }\n\n    /**\n     * Returns the current connection status.\n     *\n     * @returns {Strophe.Status}\n     */\n    get status(): Strophe.Status {\n        return this._status;\n    }\n\n    /**\n     * Adds a connection plugin to this instance.\n     *\n     * @param {string} name - The name of the plugin or rather a key under which it will be stored on this connection\n     * instance.\n     * @param {IConnectionPlugin} plugin - The plugin to add.\n     */\n    addConnectionPlugin(name: string, plugin: IConnectionPlugin): void {\n        (this as unknown as Record<string, IConnectionPlugin>)[name] = plugin;\n        plugin.init(this);\n    }\n\n    /**\n     * See {@link Strophe.Connection.addHandler}\n     *\n     * @returns {Object} - handler for the connection.\n     */\n    addHandler(...args: Parameters<Strophe.Connection['addHandler']>): ReturnType<Strophe.Connection['addHandler']> {\n        return this._stropheConn.addHandler(...args);\n    }\n\n    /**\n     * See {@link Strophe.Connection.deleteHandler}\n     *\n     * @returns {void}\n     */\n    deleteHandler(...args: Parameters<Strophe.Connection['deleteHandler']>): ReturnType<Strophe.Connection['deleteHandler']> {\n        this._stropheConn.deleteHandler(...args);\n    }\n\n    /* eslint-disable max-params */\n    /**\n     * Wraps {@link Strophe.Connection.attach} method in order to intercept the connection status updates.\n     * See {@link Strophe.Connection.attach} for the params description.\n     *\n     * @returns {void}\n     */\n    attach(jid: string, sid: string, rid: string, callback: IConnectionStatusCallback, ...args: Parameters<Strophe.Connection['attach']>): void {\n        this._stropheConn.attach(jid, sid, rid, this._stropheConnectionCb.bind(this, callback), ...args);\n    }\n\n    /**\n     * Wraps Strophe.Connection.connect method in order to intercept the connection status updates.\n     * See {@link Strophe.Connection.connect} for the params description.\n     *\n     * @returns {void}\n     */\n    connect(jid: string, pass: string, callback: IConnectionStatusCallback, ...args: Parameters<Strophe.Connection['connect']>): void {\n        this._stropheConn.connect(jid, pass, this._stropheConnectionCb.bind(this, callback), ...args);\n    }\n\n    /* eslint-enable max-params */\n\n    /**\n     * Handles {@link Strophe.Status} updates for the current connection.\n     *\n     * @param {function} targetCallback - The callback passed by the {@link XmppConnection} consumer to one of\n     * the connect methods.\n     * @param {Strophe.Status} status - The new connection status.\n     * @param {*} args - The rest of the arguments passed by Strophe.\n     * @private\n    */\n    _stropheConnectionCb(targetCallback: IConnectionStatusCallback, status: Strophe.Status, condition?: string, element?: Element): void {\n        this._status = status;\n\n        let blockCallback = false;\n\n        if (status === Strophe.Status.CONNECTED || status === Strophe.Status.ATTACHED) {\n            this._maybeEnableStreamResume();\n\n            // after connecting - immediately check whether shard changed,\n            // we need this only when using websockets as bosh checks headers from every response\n            if (this._usesWebsocket) {\n                if (this._oneSuccessfulConnect) {\n                    // on reconnect we do it immediately\n                    this._maybeStartWSKeepAlive(0);\n                } else {\n                    // delay it a bit to not interfere with the connection process\n                    // and to allow backend to correct any possible split brain issues\n                    // Store timeout so it can be cleared if needed\n                    this._maybeStartWSKeepAlive(5000);\n                }\n            }\n            this._oneSuccessfulConnect = true;\n\n            this._processDeferredIQs();\n            this._resumeTask.cancel();\n            this.ping.startInterval(this._options.pingOptions?.domain || this.domain);\n        } else if (status === Strophe.Status.DISCONNECTED) {\n            this.ping.stopInterval();\n\n            // FIXME add RECONNECTING state instead of blocking the DISCONNECTED update\n            blockCallback = this._tryResumingConnection();\n            if (!blockCallback) {\n                clearTimeout(this._wsKeepAlive);\n            }\n        }\n\n        if (!blockCallback) {\n            targetCallback(status, condition, element);\n            this.eventEmitter.emit(XmppConnection.Events.CONN_STATUS_CHANGED, status);\n        }\n    }\n\n    /**\n     * Clears the list of IQs and rejects deferred Promises with an error.\n     *\n     * @private\n     */\n    _clearDeferredIQs(): void {\n        for (const deferred of this._deferredIQs) {\n            deferred.reject(new Error('disconnect'));\n        }\n        this._deferredIQs = [];\n    }\n\n    /**\n     * The method is meant to be used for testing. It's a shortcut for closing the WebSocket.\n     *\n     * @returns {void}\n     */\n    closeWebsocket(): void {\n        if (this._stropheConn?._proto) {\n            this._stropheConn._proto._closeSocket();\n            this._stropheConn._proto._onClose(null);\n        }\n    }\n\n    /**\n     * See {@link Strophe.Connection.disconnect}.\n     *\n     * @returns {void}\n     */\n    disconnect(...args: Parameters<Strophe.Connection['disconnect']>): void {\n        this._resumeTask.cancel();\n        clearTimeout(this._wsKeepAlive);\n        this._clearDeferredIQs();\n        this._stropheConn.disconnect(...args);\n    }\n\n    /**\n     * See {@link Strophe.Connection.flush}.\n     *\n     * @returns {void}\n     */\n    flush(...args: Parameters<Strophe.Connection['flush']>): void {\n        this._stropheConn.flush(...args);\n    }\n\n    /**\n     * See {@link LastRequestTracker.getTimeSinceLastSuccess}.\n     *\n     * @returns {number|null}\n     */\n    getTimeSinceLastSuccess(): number | null {\n        return this._rawInputTracker.getTimeSinceLastSuccess();\n    }\n\n    /**\n     * See {@link LastRequestTracker.getLastFailedMessage}.\n     *\n     * @returns {string|null}\n     */\n    getLastFailedMessage(): string | null {\n        return this._rawInputTracker.getLastFailedMessage();\n    }\n\n    /**\n     * Requests a resume token from the server if enabled and all requirements are met.\n     *\n     * @private\n     */\n    _maybeEnableStreamResume(): void {\n        if (!this._options.enableWebsocketResume) {\n\n            return;\n        }\n\n        const { streamManagement } = this._stropheConn;\n\n        if (!this.isUsingWebSocket) {\n            logger.warn('Stream resume enabled, but WebSockets are not enabled');\n        } else if (!streamManagement) {\n            logger.warn('Stream resume enabled, but Strophe streamManagement plugin is not installed');\n        } else if (!streamManagement.isSupported()) {\n            logger.warn('Stream resume enabled, but XEP-0198 is not supported by the server');\n        } else if (!streamManagement.getResumeToken()) {\n            logger.info('Enabling XEP-0198 stream management');\n            streamManagement.enable(/* resume */ true);\n        }\n    }\n\n    /**\n     * Starts the Websocket keep alive if enabled.\n     *\n     * @param {number|undefined} forcedTimeout - If provided, this timeout will be used instead of\n     * the configured one with added jitter.\n     *\n     * @private\n     * @returns {void}\n     */\n    _maybeStartWSKeepAlive(forcedTimeout?: number): void {\n        const { websocketKeepAlive } = this._options;\n\n        // if websocketKeepAlive is not set keepAlive is disabled\n        if (this._usesWebsocket && websocketKeepAlive > 0) {\n            this._wsKeepAlive || logger.info(`WebSocket keep alive interval: ${websocketKeepAlive}ms`);\n            clearTimeout(this._wsKeepAlive);\n\n            const interval = forcedTimeout\n                ?? (/* base */ websocketKeepAlive + /* jitter */ (Math.random() * 60 * 1000));\n\n            logger.debug(`Scheduling next WebSocket keep-alive in ${interval}ms`);\n\n            this._wsKeepAlive = setTimeout(\n                () => this._keepAliveAndCheckShard()\n                    .then(() => this._maybeStartWSKeepAlive()),\n                interval);\n        }\n    }\n\n    /**\n     * Do a http GET to the shard and if shard change will throw an event.\n     *\n     * @private\n     * @returns {Promise}\n     */\n    _keepAliveAndCheckShard(): Promise<void> {\n        const { shard, websocketKeepAliveUrl } = this._options;\n        const url = websocketKeepAliveUrl ? websocketKeepAliveUrl\n            : this.service.replace('wss://', 'https://').replace('ws://', 'http://');\n\n        return fetch(url)\n            .then(response => {\n\n                // skips header checking if there is no info in options\n                if (!shard) {\n                    return;\n                }\n\n                const responseShard = response.headers.get('x-jitsi-shard');\n\n                !responseShard && logger.warn('No x-jitsi-shard header present in keep-alive response');\n\n                // Ignore if no shard header is present.\n                if (responseShard && responseShard !== shard) {\n                    logger.error(\n                        `Detected that shard changed from ${shard} to ${responseShard}`);\n                    this.eventEmitter.emit(XmppConnection.Events.CONN_SHARD_CHANGED);\n                }\n            })\n            .catch(error => {\n                logger.error(`Websocket Keep alive failed for url: ${url}`, { error });\n            });\n    }\n\n    /**\n     * Goes over the list of {@link DeferredSendIQ} tasks and sends them.\n     *\n     * @private\n     * @returns {void}\n     */\n    _processDeferredIQs(): void {\n        for (const deferred of this._deferredIQs) {\n            if (deferred.iq) {\n                clearTimeout(deferred.timeout);\n\n                const timeLeft = Date.now() - deferred.start;\n\n                this.sendIQ(\n                    deferred.iq,\n                    result => deferred.resolve(result),\n                    error => deferred.reject(error),\n                    timeLeft);\n            }\n        }\n\n        this._deferredIQs = [];\n    }\n\n    /**\n     * Send a stanza. This function is called to push data onto the send queue to go out over the wire.\n     *\n     * @param {Element|Strophe.Builder} stanza - The stanza to send.\n     * @returns {void}\n     */\n    send(stanza: Element | Strophe.Builder): void {\n        if (!this.connected) {\n            logger.error(`Trying to send stanza while not connected. Status:${this._status} Proto:${\n                this.isUsingWebSocket ? this._stropheConn?._proto?.socket?.readyState : 'bosh'\n            }`);\n            throw new Error('Not connected');\n        }\n        this._stropheConn.send(stanza);\n    }\n\n    /**\n     * Helper function to send IQ stanzas.\n     *\n     * @param {Element} elem - The stanza to send.\n     * @param {Function} callback - The callback function for a successful request.\n     * @param {Function} errback - The callback function for a failed or timed out request.  On timeout, the stanza will\n     * be null.\n     * @param {number} timeout - The time specified in milliseconds for a timeout to occur.\n     * @returns {number} - The id used to send the IQ.\n     */\n    sendIQ(elem: Element, callback: Optional<IQResultCallback> = undefined, errback: Optional<ErrorCallback> = undefined, timeout: Optional<number> = undefined): number | undefined {\n        if (!this.connected) {\n            errback('Not connected');\n\n            return;\n        }\n\n        return this._stropheConn.sendIQ(elem, callback, errback, timeout);\n    }\n\n    /**\n     * Sends an IQ immediately if connected or puts it on the send queue otherwise(in contrary to other send methods\n     * which would fail immediately if disconnected).\n     *\n     * @param {Element} iq - The IQ to send.\n     * @param {Object} options - Options object\n     * @param {options.timeout} timeout - How long to wait for the response.\n     * The time when the connection is reconnecting is included, which means that\n     * the IQ may never be sent and still fail with a timeout.\n     */\n    sendIQ2(iq: Element, { timeout }: { timeout: number; }): Promise<Element> {\n        return new Promise((resolve, reject) => {\n            if (this.connected) {\n                this.sendIQ(\n                    iq,\n                    result => resolve(result),\n                    error => reject(error),\n                    timeout);\n            } else {\n                const deferred: IDeferredSendIQ = {\n                    iq,\n                    reject,\n                    resolve,\n                    start: Date.now(),\n                    timeout: setTimeout(() => {\n                        // clears the IQ on timeout and invalidates the deferred task\n                        deferred.iq = undefined;\n\n                        // Strophe calls with undefined on timeout\n                        reject(undefined);\n                    }, timeout)\n                };\n\n                this._deferredIQs.push(deferred);\n            }\n        });\n    }\n\n    /**\n     * Called by the ping plugin when ping fails too many times.\n     *\n     * @returns {void}\n     */\n    _onPingErrorThresholdExceeded(): void {\n        if (this.isUsingWebSocket) {\n            logger.warn('Ping error threshold exceeded - killing the WebSocket');\n            this.closeWebsocket();\n        }\n    }\n\n    /**\n     *  Helper function to send presence stanzas. The main benefit is for sending presence stanzas for which you expect\n     *  a responding presence stanza with the same id (for example when leaving a chat room).\n     *\n     * @param {Element} elem - The stanza to send.\n     * @param {Function} callback - The callback function for a successful request.\n     * @param {Function} errback - The callback function for a failed or timed out request. On timeout, the stanza will\n     * be null.\n     * @param {number} timeout - The time specified in milliseconds for a timeout to occur.\n     * @returns {number} - The id used to send the presence.\n     */\n    sendPresence(elem: Element, callback: IQResultCallback, errback: ErrorCallback, timeout: number): void {\n        if (!this.connected) {\n            errback('Not connected');\n\n            return;\n        }\n        this._stropheConn.sendPresence(elem, callback, errback, timeout);\n    }\n\n    /**\n     * The method gracefully closes the BOSH connection by using 'navigator.sendBeacon'.\n     *\n     * @returns {boolean} - true if the beacon was sent.\n     */\n    sendUnavailableBeacon(): boolean {\n        if (!navigator.sendBeacon || this._stropheConn.disconnecting || !this._stropheConn.connected) {\n            return false;\n        }\n\n        this._stropheConn._changeConnectStatus(Strophe.Status.DISCONNECTING);\n        this._stropheConn.disconnecting = true;\n\n        const body = this._stropheConn._proto._buildBody()\n            .attrs({\n                type: 'terminate'\n            });\n        const pres = $pres({\n            type: 'unavailable',\n            xmlns: Strophe.NS.CLIENT\n        });\n\n        body.cnode(pres.tree());\n\n        const res = navigator.sendBeacon(\n            this.service.indexOf('https://') === -1 ? `https:${this.service}` : this.service,\n            Strophe.serialize(body.tree()));\n\n        logger.info(`Successfully send unavailable beacon ${res}`);\n\n        this._stropheConn._proto._abortAllRequests();\n        this._stropheConn._doDisconnect();\n\n        return true;\n    }\n\n    /**\n     * Tries to use stream management plugin to resume dropped XMPP connection. The streamManagement plugin clears\n     * the resume token if any connection error occurs which would put it in unrecoverable state, so as long as\n     * the token is present it means the connection can be resumed.\n     *\n     * @private\n     * @returns {boolean}\n     */\n    _tryResumingConnection(): boolean {\n        const { streamManagement } = this._stropheConn;\n        const resumeToken = streamManagement?.getResumeToken();\n\n        if (resumeToken) {\n            this._resumeTask.schedule();\n\n            const r = this._resumeTask.retryCount <= MAX_CONNECTION_RETRIES;\n\n            if (!r) {\n                logger.warn(`Maximum resume tries reached (${MAX_CONNECTION_RETRIES}), giving up.`);\n            }\n\n            return r;\n        }\n\n        return false;\n    }\n}\n","/**\n * Centralized Strophe error handler for logging and analytics.\n * Extracts error code, reason, message, and context from XMPP error stanzas.\n */\n\nimport { getLogger } from '@jitsi/logger';\n\nimport RTCStats from '../RTCStats/RTCStats';\nimport { RTCStatsEvents } from '../RTCStats/RTCStatsEvents';\n\nconst logger = getLogger('xmpp:StropheErrorHandler');\n\nexport interface IStropheErrorContext {\n    [key: string]: any;\n    operation?: string;\n    roomJid?: string;\n    userJid?: string;\n}\n\nexport function handleStropheError(errResponse: any, context: IStropheErrorContext = {}) {\n    const errorObj: any = {};\n    let errorEl: Element | null = null;\n\n    if (errResponse) {\n        if (errResponse.nodeType === 1 && errResponse.tagName.toUpperCase() === 'ERROR') {\n            errorEl = errResponse;\n        } else if (errResponse.nodeType === 1) {\n            const errorElements = errResponse.getElementsByTagName('error');\n\n            if (errorElements?.length > 0) {\n                errorEl = Array.from(errorElements as HTMLCollectionOf<Element>)[0] || null;\n            }\n        }\n    }\n\n    if (errorEl) {\n        errorObj.code = errorEl.getAttribute('code') || undefined;\n\n        // Get first child element as reason\n        const reasonEl = Array.from(errorEl.children)[0];\n\n        if (reasonEl) {\n            errorObj.reason = reasonEl.tagName;\n        }\n\n        // Get <text> child element\n        const msgEl = Array.from(errorEl.getElementsByTagName('text'))[0];\n\n        if (msgEl?.textContent) {\n            errorObj.msg = msgEl.textContent;\n        }\n\n        // Raw XML string for debugging\n        errorObj.raw = errorEl.outerHTML;\n\n    // if the connection is not established we directly return a string as error from sendIQ method\n    } else if (typeof errResponse === 'string') {\n        errorObj.reason = errResponse;\n    } else if (!errResponse) { // null or undefined\n        errorObj.reason = 'timeout';\n    } else { // Invalid type of error.\n        errorObj.reason = 'unknown';\n    }\n\n    // Merge in contextual info\n    Object.assign(errorObj, context);\n\n    logger.error('Strophe error:', JSON.stringify(errorObj));\n    RTCStats.sendStatsEntry(RTCStatsEvents.STROPHE_ERROR_EVENT, null, errorObj);\n}\n","/* eslint-disable newline-per-chained-call */\nimport { getLogger } from '@jitsi/logger';\nimport { $iq } from 'strophe.js';\n\nimport { CONFERENCE_REQUEST_FAILED, NOT_LIVE_ERROR } from '../../JitsiConnectionErrors';\nimport { CONNECTION_FAILED, CONNECTION_REDIRECTED } from '../../JitsiConnectionEvents';\nimport { AuthenticationEvents } from '../../service/authentication/AuthenticationEvents';\nimport { XMPPEvents } from '../../service/xmpp/XMPPEvents';\nimport Settings from '../settings/Settings';\nimport Listenable from '../util/Listenable';\nimport { exists, findFirst, getAttribute, getText } from '../util/XMLUtils';\n\nimport { handleStropheError } from './StropheErrorHandler';\n\n\nconst logger = getLogger('xmpp:Moderator');\n\n/**\n * Exponential backoff timer.\n * @param step the step to use.\n */\nfunction createExpBackoffTimer(step) {\n    let count = 1;\n    const maxTimeout = 120000;\n\n    return function(reset) {\n        // Reset call\n        if (reset) {\n            count = 1;\n\n            return;\n        }\n\n        // Calculate next timeout\n        const timeout = Math.pow(2, count - 1);\n\n        count += 1;\n\n        return Math.min(timeout * step, maxTimeout);\n    };\n}\n\n/**\n * The moderator/focus responsible for direct communication with jicofo\n */\nexport default class Moderator extends Listenable {\n    /**\n     * Constructs moderator.\n     * @param xmpp The xmpp.\n     */\n    constructor(xmpp) {\n        super();\n\n        this.getNextTimeout = createExpBackoffTimer(1000);\n        this.getNextErrorTimeout = createExpBackoffTimer(1000);\n        this.options = xmpp.options;\n\n        // Whether SIP gateway (jigasi) support is enabled. TODO: use presence so it can be changed based on jigasi\n        // availability.\n        this.sipGatewayEnabled = false;\n\n        // Response to conference request may contain whether visitors are supported\n        // in certain cases we need to know this to be able to get decisions on some errors (max-occupants reached)\n        this.visitorsSupported = false;\n\n        this.xmpp = xmpp;\n        this.connection = xmpp.connection;\n\n        // The JID to which conference-iq requests are sent over XMPP.\n        this.targetJid = this.options.hosts?.focus;\n\n        // If not specified default to 'focus.domain'\n        if (!this.targetJid) {\n            this.targetJid = `focus.${this.options.hosts?.domain}`;\n        }\n\n        this.targetUrl = this.options.conferenceRequestUrl;\n\n        // Whether to send conference requests over HTTP or XMPP\n        this.mode = this.targetUrl ? 'http' : 'xmpp';\n        logger.info(`Using ${this.mode} for conference requests.`);\n\n        // The set of JIDs known to belong to jicofo. Populated from configuration\n        // and responses from conference requests.\n        this.focusUserJids = new Set();\n\n        if (this.options.focusUserJid) {\n            this.focusUserJids.add(this.options.focusUserJid);\n        }\n\n        // FIXME: Message listener that talks to POPUP window\n        /**\n         *\n         * @param event\n         */\n        function listener(event) {\n            if (event.data && event.data.sessionId) {\n                if (event.origin !== window.location.origin) {\n                    logger.warn(`Ignoring sessionId from different origin: ${event.origin}`);\n\n                    return;\n                }\n                Settings.sessionId = event.data.sessionId;\n\n                // After popup is closed we will authenticate\n            }\n        }\n\n        // Register\n        window.addEventListener('message', listener, false);\n    }\n\n    /**\n     * Check whether the supplied jid is a known jid for focus.\n     * @param jid\n     * @returns {boolean}\n     */\n    isFocusJid(jid) {\n        if (!jid) {\n            return false;\n        }\n\n        for (const focusJid of this.focusUserJids) {\n            // jid may be a full JID, and focusUserJids may be bare JIDs\n            if (jid.indexOf(`${focusJid}/`) === 0) {\n                return true;\n            }\n        }\n\n        return false;\n    }\n\n    /**\n     * Is sip gw enabled.\n     * @returns {boolean}\n     */\n    isSipGatewayEnabled() {\n        return this.sipGatewayEnabled;\n    }\n\n    /**\n     * Create a conference request based on the configured options and saved Settings.\n     *\n     * A conference request has the following format:\n     * {\n     *   room: \"room@example.com\",\n     *   sessionId: \"foo\", // optional\n     *   machineUdi: \"bar\", // optional\n     *   identity: \"baz\", // optional\n     *   properties: { } // map string to string\n     * }\n     *\n     * It can be encoded in either JSON or and IQ.\n     *\n     * @param roomJid - The room jid for which to send conference request.\n     *\n     * @returns the created conference request.\n     */\n    _createConferenceRequest(roomJid) {\n        // Session Id used for authentication\n        const { sessionId } = Settings;\n        const config = this.options;\n        const properties = {};\n\n        if (config.startAudioMuted !== undefined) {\n            properties.startAudioMuted = config.startAudioMuted;\n        }\n        if (config.startVideoMuted !== undefined) {\n            properties.startVideoMuted = config.startVideoMuted;\n        }\n\n        // this flag determines whether the bridge will include this call in its\n        // rtcstats reporting or not. If the site admin hasn't set the flag in\n        // config.js, then the client defaults to false (see\n        // react/features/rtcstats/functions.js in jitsi-meet). The server-side\n        // components default to true to match the pre-existing behavior, so we only\n        // signal if false.\n        const rtcstatsEnabled = config?.analytics?.rtcstatsEnabled ?? false;\n\n        if (!rtcstatsEnabled) {\n            properties.rtcstatsEnabled = false;\n        }\n\n        const conferenceRequest = {\n            machineUid: Settings.machineId,\n            properties,\n            room: roomJid\n        };\n\n        if (sessionId) {\n            conferenceRequest.sessionId = sessionId;\n        }\n\n        if (!config.iAmRecorder && !config.iAmSipGateway) {\n            conferenceRequest.properties['visitors-version'] = 1;\n\n            if (this.options.preferVisitor) {\n                conferenceRequest.properties.visitor = true;\n            }\n        }\n\n        return conferenceRequest;\n    }\n\n    /**\n     * Create a conference request and encode it as an IQ.\n     *\n     * @param roomJid - The room jid for which to send conference request.\n     */\n    _createConferenceIq(roomJid) {\n        const conferenceRequest = this._createConferenceRequest(roomJid);\n\n        // Generate create conference IQ\n        const elem = $iq({\n            to: this.targetJid,\n            type: 'set'\n        });\n\n        elem.c('conference', {\n            'machine-uid': conferenceRequest.machineUid,\n            room: roomJid,\n            token: this.xmpp.token,\n            xmlns: 'http://jitsi.org/protocol/focus'\n        });\n\n        if (conferenceRequest.sessionId) {\n            elem.attrs({ 'session-id': conferenceRequest.sessionId });\n        }\n\n        for (const k in conferenceRequest.properties) {\n            if (conferenceRequest.properties.hasOwnProperty(k)) {\n                elem.c(\n                    'property', {\n                        name: k,\n                        value: conferenceRequest.properties[k]\n                    })\n                    .up();\n            }\n        }\n\n        return elem;\n    }\n\n    /**\n     * Parses a conference IQ.\n     * @param resultIq the result IQ that is received.\n     * @returns {{properties: {}}} Returns an object with the parsed properties.\n     * @private\n     */\n    _parseConferenceIq(resultIq) {\n        const conferenceRequest = { properties: {} };\n\n        const conferenceEl = findFirst(resultIq, 'conference');\n\n        conferenceRequest.focusJid = getAttribute(conferenceEl, 'focusjid');\n        conferenceRequest.sessionId = getAttribute(conferenceEl, 'session-id');\n        conferenceRequest.identity = getAttribute(conferenceEl, 'identity');\n        conferenceRequest.ready = getAttribute(conferenceEl, 'ready') === 'true';\n        conferenceRequest.vnode = getAttribute(conferenceEl, 'vnode');\n\n        if (exists(resultIq, ':scope>conference>property[name=\"authentication\"][value=\"true\"]')) {\n            conferenceRequest.properties.authentication = 'true';\n        }\n\n        if (exists(resultIq, ':scope>conference>property[name=\"externalAuth\"][value=\"true\"]')) {\n            conferenceRequest.properties.externalAuth = 'true';\n        }\n\n        // Check if jicofo has jigasi support enabled.\n        if (exists(resultIq, ':scope>conference>property[name=\"sipGatewayEnabled\"][value=\"true\"]')) {\n            conferenceRequest.properties.sipGatewayEnabled = 'true';\n        }\n\n        // check for explicit false, all other cases is considered live\n        if (exists(resultIq, ':scope>conference>property[name=\"live\"][value=\"false\"]')) {\n            conferenceRequest.properties.live = 'false';\n        }\n\n        return conferenceRequest;\n    }\n\n    // FIXME We need to show the fact that we're waiting for the focus to the user\n    // (or that the focus is not available)\n    /**\n     * Allocates the conference focus.\n     * @param roomJid - The room jid for which to send conference request.\n     * @returns {Promise} - Resolved when Jicofo allows to join the room. It's never\n     * rejected, and it'll keep on pinging Jicofo forever.\n     */\n    sendConferenceRequest(roomJid) {\n        // there is no point of sending conference iq when in visitor mode (disableFocus)\n        // when we have sent early the conference request via http\n        // we want to skip sending it here, or visitors can loop\n        if (this.conferenceRequestSent) {\n            return Promise.resolve();\n        }\n\n        // to mark whether we have already sent a conference request\n        this.conferenceRequestSent = false;\n\n        return new Promise((resolve, reject) => {\n            if (this.mode === 'xmpp') {\n                logger.info(`Sending conference request over XMPP to ${this.targetJid}`);\n\n                this.connection.sendIQ(\n                    this._createConferenceIq(roomJid),\n                    result => this._handleIqSuccess(roomJid, result, resolve, reject),\n                    error => this._handleIqError(roomJid, error, resolve, reject));\n\n                // XXX We're pressed for time here because we're beginning a complex\n                // and/or lengthy conference-establishment process which supposedly\n                // involves multiple RTTs. We don't have the time to wait for Strophe to\n                // decide to send our IQ.\n                this.connection.flush();\n            } else {\n                logger.info(`Sending conference request over HTTP to ${this.targetUrl}`);\n                fetch(this.targetUrl, {\n                    body: JSON.stringify(this._createConferenceRequest(roomJid)),\n                    headers: {\n                        'Content-Type': 'application/json',\n                        ...this.xmpp.token ? { 'Authorization': `Bearer ${this.xmpp.token}` } : {}\n                    },\n                    method: 'POST'\n                })\n                    .then(response => {\n                        if (!response.ok) {\n                            response.text()\n                                .then(text => {\n                                    logger.warn(`Received HTTP ${response.status} ${\n                                        response.statusText}. Body: ${text}`);\n                                    const sessionError = response.status === 400\n                                        && text.indexOf('400 invalid-session') > 0;\n                                    const notAuthorized = response.status === 403;\n\n                                    this._handleError(roomJid, sessionError, notAuthorized, resolve, reject);\n                                })\n                                .catch(error => {\n                                    logger.warn(`Error: ${error}`);\n                                    this._handleError(roomJid, undefined, undefined, resolve, () => reject(error));\n                                });\n\n                            // _handleError has either scheduled a retry or fired an event indicating failure.\n                            return;\n                        }\n                        response.json()\n                            .then(resultJson => {\n                                this._handleSuccess(roomJid, resultJson, resolve, reject);\n                            });\n                    })\n                    .catch(error => {\n                        logger.warn(`Error: ${error}`);\n                        this._handleError(roomJid, undefined, undefined, resolve, () => reject(error));\n                    });\n            }\n        }).then(() => {\n            this.conferenceRequestSent = true;\n        })\n        .finally(() => {\n            this.xmpp.connection._breakoutMovingToMain = undefined;\n        });\n    }\n\n    /**\n     * Handles success response for conference IQ.\n     * @param roomJid\n     * @param conferenceRequest\n     * @param callback\n     * @param errorCallback\n     * @private\n     */\n    _handleSuccess(roomJid, conferenceRequest, callback, errorCallback) {\n        // Reset the error timeout (because we haven't failed here).\n        this.getNextErrorTimeout(true);\n\n        if (conferenceRequest.focusJid) {\n            logger.info(`Adding focus JID: ${conferenceRequest.focusJid}`);\n            this.focusUserJids.add(conferenceRequest.focusJid);\n        } else {\n            logger.warn('Conference request response contained no focusJid.');\n        }\n\n        const authenticationEnabled = conferenceRequest.properties.authentication === 'true';\n\n        logger.info(`Authentication enabled: ${authenticationEnabled}`);\n\n        if (conferenceRequest.sessionId) {\n            logger.info(`Received sessionId: ${conferenceRequest.sessionId}`);\n            Settings.sessionId = conferenceRequest.sessionId;\n        }\n\n        this.eventEmitter.emit(\n            AuthenticationEvents.IDENTITY_UPDATED, authenticationEnabled, conferenceRequest.identity);\n\n        this.sipGatewayEnabled = conferenceRequest.properties.sipGatewayEnabled;\n        logger.info(`Sip gateway enabled: ${this.sipGatewayEnabled}`);\n\n        if (conferenceRequest.properties.live === 'false') {\n            this.getNextTimeout(true);\n\n            logger.info('Conference is not live.');\n\n            this.xmpp.eventEmitter.emit(CONNECTION_FAILED, NOT_LIVE_ERROR);\n\n            errorCallback();\n\n            return;\n        }\n\n        this.visitorsSupported = conferenceRequest.properties['visitors-supported'];\n\n        if (conferenceRequest.ready) {\n            // Reset the non-error timeout (because we've succeeded here).\n            this.getNextTimeout(true);\n\n            // we want to ignore redirects when this is jibri (record/live-stream or a sip jibri)\n            // we ignore redirects when moving from a breakout room to the main room\n            if (conferenceRequest.vnode && !this.options.iAmRecorder && !this.options.iAmSipGateway) {\n                if (this.connection._breakoutMovingToMain === roomJid) {\n                    logger.info('Skipping redirect as we are moving from breakout to main.');\n\n                    callback();\n\n                    return;\n                }\n\n                logger.warn(`Redirected to: ${conferenceRequest.vnode} with focusJid ${conferenceRequest.focusJid}`);\n\n                this.xmpp.eventEmitter.emit(CONNECTION_REDIRECTED, conferenceRequest.vnode, conferenceRequest.focusJid);\n\n                errorCallback();\n\n                return;\n            }\n\n            logger.info('Conference-request successful, ready to join the MUC.');\n            callback();\n        } else {\n            const waitMs = this.getNextTimeout();\n\n            // This was a successful response, but the \"ready\" flag is not set. Retry after a timeout.\n            logger.info(`Not ready yet, will retry in ${waitMs} ms.`);\n            window.setTimeout(\n                () => this.sendConferenceRequest(roomJid)\n                    .then(callback).catch(errorCallback),\n                waitMs);\n        }\n    }\n\n    /**\n     * Handles error response for conference IQ.\n     * @param roomJid\n     * @param sessionError\n     * @param notAuthorized\n     * @param callback\n     * @param errorCallback\n     * @private\n     */\n    _handleError(roomJid, sessionError, notAuthorized, callback, errorCallback) { // eslint-disable-line max-params\n        // If the session is invalid, remove and try again without session ID to get\n        // a new one\n        if (sessionError) {\n            logger.info('Session expired! - removing');\n            Settings.sessionId = undefined;\n        }\n\n        // Not authorized to create new room\n        if (notAuthorized) {\n            logger.warn('Unauthorized to start the conference');\n            this.eventEmitter.emit(XMPPEvents.AUTHENTICATION_REQUIRED);\n\n            errorCallback();\n\n            return;\n        }\n\n        const waitMs = this.getNextErrorTimeout();\n\n        if (sessionError && waitMs < 60000) {\n            // If the session is invalid, retry a limited number of times and then fire an error.\n            logger.info(`Invalid session, will retry after ${waitMs} ms.`);\n            this.getNextTimeout(true);\n            window.setTimeout(() => this.sendConferenceRequest(roomJid)\n                .then(callback)\n                .catch(errorCallback), waitMs);\n        } else {\n            logger.error('Failed to get a successful response, giving up.');\n\n            // This is a \"fatal\" error and the user of the lib should handle it accordingly.\n            this.xmpp.eventEmitter.emit(CONNECTION_FAILED, CONFERENCE_REQUEST_FAILED);\n\n            errorCallback();\n        }\n    }\n\n    /**\n     * Invoked by {@link #sendConferenceRequest} upon its request receiving an xmpp error result.\n     *\n     * @param roomJid - The room jid used to send conference request.\n     * @param error - the error result of the request that {@link sendConferenceRequest} sent\n     * @param {Function} callback - the function to be called back upon the\n     * successful allocation of the conference focus\n     * @param errorCallback\n     */\n    _handleIqError(roomJid, error, callback, errorCallback) {\n        // Call handleStropheError for centralized error logging and analytics\n        handleStropheError(error, {\n            mode: this.mode,\n            operation: 'conference request (IQ)',\n            roomJid,\n            targetJid: this.targetJid,\n            userJid: this.connection.jid\n        });\n\n        // The reservation system only works over XMPP. Handle the error separately.\n        // Check for error returned by the reservation system\n        // Convert Strophe object to DOM element for XMLUtils functions\n        const reservationErr = findFirst(error, ':scope>error>reservation-error');\n\n        if (reservationErr) {\n            // Trigger error event\n            const errorCode = getAttribute(reservationErr, 'error-code');\n            const errorTextNode = findFirst(error, ':scope>error>text');\n            let errorMsg;\n\n            if (errorTextNode) {\n                errorMsg = getText(errorTextNode);\n            }\n            this.eventEmitter.emit(\n                XMPPEvents.RESERVATION_ERROR,\n                errorCode,\n                errorMsg);\n\n            errorCallback();\n\n            return;\n        }\n\n        const invalidSession = Boolean(\n            exists(error, ':scope>error>session-invalid') || exists(error, ':scope>error>not-acceptable'));\n\n        // Not authorized to create new room\n        const notAuthorized = exists(error, ':scope>error>not-authorized');\n\n        this._handleError(roomJid, invalidSession, notAuthorized, callback, errorCallback);\n    }\n\n    /**\n     * Invoked by {@link #sendConferenecRequest} upon its request receiving a\n     * success (i.e. non-error) result.\n     *\n     * @param roomJid - The room jid used to send conference request.\n     * @param result - the success (i.e. non-error) result of the request that {@link #sendConferenecRequest} sent\n     * @param {Function} callback - the function to be called back upon the\n     * successful allocation of the conference focus\n     * @param errorCallback\n     */\n    _handleIqSuccess(roomJid, result, callback, errorCallback) {\n        // Setup config options\n        const conferenceRequest = this._parseConferenceIq(result);\n\n        this._handleSuccess(roomJid, conferenceRequest, callback, errorCallback);\n    }\n\n    /**\n     * Authenticate by sending a conference IQ.\n     * @param roomJid The room jid.\n     * @returns {Promise<unknown>}\n     */\n    authenticate(roomJid) {\n        return new Promise((resolve, reject) => {\n            this.connection.sendIQ(\n                this._createConferenceIq(roomJid),\n                result => {\n                    const sessionId = getAttribute(findFirst(result, 'conference'), 'session-id');\n\n                    if (sessionId) {\n                        logger.info(`Received sessionId:  ${sessionId}`);\n                        Settings.sessionId = sessionId;\n                    } else {\n                        logger.warn('Response did not contain a session-id');\n                    }\n\n                    resolve();\n                },\n                errorIq => {\n                    handleStropheError(errorIq, {\n                        operation: 'authenticate conference',\n                        roomJid,\n                        targetJid: this.targetJid,\n                        userJid: this.connection.jid\n                    });\n\n                    const errorEl = findFirst(errorIq, ':scope>iq>error');\n                    const firstErrorChild = errorEl?.children?.length > 0 ? errorEl.children[0] : undefined;\n\n                    reject({\n                        error: firstErrorChild?.tagName,\n                        message: getText(findFirst(errorIq, ':scope>iq>error>text'))\n                    });\n                }\n            );\n        });\n    }\n\n    /**\n     * Logout by sending conference IQ.\n     * @param callback\n     */\n    logout(callback) {\n        const iq = $iq({\n            to: this.targetJid,\n            type: 'set'\n        });\n        const { sessionId } = Settings;\n\n        if (!sessionId) {\n            callback();\n\n            return;\n        }\n        iq.c('logout', {\n            'session-id': sessionId,\n            xmlns: 'http://jitsi.org/protocol/focus'\n        });\n        this.connection.sendIQ(\n            iq,\n            result => {\n                logger.info('Log out OK', result);\n                Settings.sessionId = undefined;\n                callback();\n            },\n            error => {\n                handleStropheError(error, {\n                    operation: 'logout',\n                    sessionId,\n                    targetJid: this.targetJid,\n                    userJid: this.connection.jid\n                });\n            }\n        );\n    }\n}\n","/* eslint-disable */\n\nimport { $iq, Strophe } from 'strophe.js';\nimport { handleStropheError } from './StropheErrorHandler';\n\nStrophe.addConnectionPlugin('disco',\n{\n    _connection: null,\n    _identities : [],\n    _features : [],\n    _items : [],\n    /** Function: init\n     * Plugin init\n     *\n     * Parameters:\n     *   (Strophe.Connection) conn - Strophe connection\n     */\n    init: function(conn)\n    {\n    this._connection = conn;\n        this._identities = [];\n        this._features   = [];\n        this._items      = [];\n        // disco info\n        conn.addHandler(this._onDiscoInfo.bind(this), Strophe.NS.DISCO_INFO, 'iq', 'get', null, null);\n        // disco items\n        conn.addHandler(this._onDiscoItems.bind(this), Strophe.NS.DISCO_ITEMS, 'iq', 'get', null, null);\n    },\n    /** Function: addIdentity\n     * See http://xmpp.org/registrar/disco-categories.html\n     * Parameters:\n     *   (String) category - category of identity (like client, automation, etc ...)\n     *   (String) type - type of identity (like pc, web, bot , etc ...)\n     *   (String) name - name of identity in natural language\n     *   (String) lang - lang of name parameter\n     *\n     * Returns:\n     *   Boolean\n     */\n    addIdentity: function(category, type, name, lang)\n    {\n        if (typeof name === 'undefined') {\n           name = '';\n        }\n        if (typeof lang === 'undefined') {\n           lang = '';\n        }\n        for (var i=0; i<this._identities.length; i++)\n        {\n            if (this._identities[i].category == category &&\n                this._identities[i].type == type &&\n                this._identities[i].name == name &&\n                this._identities[i].lang == lang)\n            {\n                return false;\n            }\n        }\n        this._identities.push({category: category, type: type, name: name, lang: lang});\n        return true;\n    },\n    /** Function: addFeature\n     *\n     * Parameters:\n     *   (String) var_name - feature name (like jabber:iq:version)\n     *\n     * Returns:\n     *   boolean\n     */\n    addFeature: function(var_name)\n    {\n        for (var i=0; i<this._features.length; i++)\n        {\n             if (this._features[i] == var_name)\n                 return false;\n        }\n        this._features.push(var_name);\n        return true;\n    },\n    /** Function: removeFeature\n     *\n     * Parameters:\n     *   (String) var_name - feature name (like jabber:iq:version)\n     *\n     * Returns:\n     *   boolean\n     */\n    removeFeature: function(var_name)\n    {\n        for (var i=0; i<this._features.length; i++)\n        {\n             if (this._features[i] === var_name){\n                 this._features.splice(i,1);\n                 return true;\n             }\n        }\n        return false;\n    },\n    /** Function: addItem\n     *\n     * Parameters:\n     *   (String) jid\n     *   (String) name\n     *   (String) node\n     *   (Function) call_back\n     *\n     * Returns:\n     *   boolean\n     */\n    addItem: function(jid, name, node, call_back)\n    {\n        if (node && !call_back)\n            return false;\n        this._items.push({jid: jid, name: name, node: node, call_back: call_back});\n        return true;\n    },\n    /** Function: info\n     * Info query\n     *\n     * Parameters:\n     *   (Function) call_back\n     *   (String) jid\n     *   (String) node\n     */\n    info: function(jid, node, success, error, timeout)\n    {\n        var attrs = {xmlns: Strophe.NS.DISCO_INFO};\n        if (node)\n            attrs.node = node;\n\n        var info = $iq({from:this._connection.jid,\n                         to:jid, type:'get'}).c('query', attrs);\n        this._connection.sendIQ(info, success, error ? err => {\n            handleStropheError(err, {\n                jid,\n                node,\n                operation: 'disco info query',\n                userJid: this._connection.jid\n            });\n            error(err);\n        } : undefined, timeout);\n    },\n    /** Function: items\n     * Items query\n     *\n     * Parameters:\n     *   (Function) call_back\n     *   (String) jid\n     *   (String) node\n     */\n    items: function(jid, node, success, error, timeout)\n    {\n        var attrs = {xmlns: Strophe.NS.DISCO_ITEMS};\n        if (node)\n            attrs.node = node;\n\n        var items = $iq({from:this._connection.jid,\n                         to:jid, type:'get'}).c('query', attrs);\n        this._connection.sendIQ(items, success, error ? err => {\n            handleStropheError(err, {\n                jid,\n                node,\n                operation: 'disco items query',\n                userJid: this._connection.jid\n            });\n            error(err);\n        } : undefined, timeout);\n    },\n\n    /** PrivateFunction: _buildIQResult\n     */\n    _buildIQResult: function(stanza, query_attrs)\n    {\n        var id   =  stanza.getAttribute('id');\n        var from = stanza.getAttribute('from');\n        var iqresult = $iq({type: 'result', id: id});\n\n        if (from !== null) {\n            iqresult.attrs({to: from});\n        }\n\n        return iqresult.c('query', query_attrs);\n    },\n\n    /** PrivateFunction: _onDiscoInfo\n     * Called when receive info request\n     */\n    _onDiscoInfo: function(stanza)\n    {\n        var node = stanza.getElementsByTagName('query')[0].getAttribute('node');\n        var attrs = {xmlns: Strophe.NS.DISCO_INFO};\n        var i;\n        if (node)\n        {\n            attrs.node = node;\n        }\n        var iqresult = this._buildIQResult(stanza, attrs);\n        for (i=0; i<this._identities.length; i++)\n        {\n            attrs = {category: this._identities[i].category,\n                         type    : this._identities[i].type};\n            if (this._identities[i].name)\n                attrs.name = this._identities[i].name;\n            if (this._identities[i].lang)\n                attrs['xml:lang'] = this._identities[i].lang;\n            iqresult.c('identity', attrs).up();\n        }\n        for (i=0; i<this._features.length; i++)\n        {\n            iqresult.c('feature', {'var':this._features[i]}).up();\n        }\n        this._connection.send(iqresult.tree());\n        return true;\n    },\n    /** PrivateFunction: _onDiscoItems\n     * Called when receive items request\n     */\n    _onDiscoItems: function(stanza)\n    {\n        var query_attrs = {xmlns: Strophe.NS.DISCO_ITEMS};\n        var node = stanza.getElementsByTagName('query')[0].getAttribute('node');\n        var items, i;\n        if (node)\n        {\n            query_attrs.node = node;\n            items = [];\n            for (i = 0; i < this._items.length; i++)\n            {\n                if (this._items[i].node == node)\n                {\n                    items = this._items[i].call_back(stanza);\n                    break;\n                }\n            }\n        }\n        else\n        {\n            items = this._items;\n        }\n        var iqresult = this._buildIQResult(stanza, query_attrs);\n        for (i = 0; i < items.length; i++)\n        {\n            var attrs = {jid:  items[i].jid};\n            if (items[i].name)\n                attrs.name = items[i].name;\n            if (items[i].node)\n                attrs.node = items[i].node;\n            iqresult.c('item', attrs).up();\n        }\n        this._connection.send(iqresult.tree());\n        return true;\n    }\n});\n","export enum JitsiTranscriptionStatus {\n\n    /**\n     * The transcription is off.\n     */\n    OFF = 'OFF',\n\n    /**\n     * The transcription is on.\n     */\n    ON = 'ON'\n}\n\n// exported for backward compatibility\nexport const ON = JitsiTranscriptionStatus.ON;\nexport const OFF = JitsiTranscriptionStatus.OFF;\n","import { getLogger } from '@jitsi/logger';\nimport { $msg } from 'strophe.js';\n\nimport { MediaType } from '../../service/RTC/MediaType';\nimport { XMPPEvents } from '../../service/xmpp/XMPPEvents';\n\nimport ChatRoom from './ChatRoom';\nimport XMPP from './xmpp';\n\nconst logger = getLogger('xmpp:AVModeration');\n\nexport interface IModerationEnabledByType {\n    audio: boolean;\n    desktop: boolean;\n    video: boolean;\n}\n\nexport interface IMessageObject {\n    actor: string;\n    approved: boolean;\n    enabled: boolean;\n    mediaType: MediaType;\n    removed: boolean;\n    whitelists: { audio: string[]; video: string[]; };\n}\n\n/**\n * The AVModeration logic.\n */\nexport default class AVModeration {\n    private _xmpp: XMPP;\n    private _mainRoom: ChatRoom;\n    private _moderationEnabledByType: IModerationEnabledByType;\n    private _whitelistAudio: string[];\n    private _whitelistDesktop: string[];\n    private _whitelistVideo: string[];\n\n    /**\n     * Constructs AV moderation room.\n     *\n     * @param {ChatRoom} room the main room.\n     */\n    constructor(room: ChatRoom) {\n        this._xmpp = room.xmpp;\n\n        this._mainRoom = room;\n\n        this._moderationEnabledByType = {\n            [MediaType.AUDIO]: false,\n            [MediaType.DESKTOP]: false,\n            [MediaType.VIDEO]: false\n        };\n\n        this._whitelistAudio = [];\n        this._whitelistDesktop = [];\n        this._whitelistVideo = [];\n\n        this._onMessage = this._onMessage.bind(this);\n        this._xmpp.addListener(XMPPEvents.AV_MODERATION_RECEIVED, this._onMessage);\n    }\n\n    /**\n     * Stops listening for events.\n     */\n    dispose() {\n        this._xmpp.removeListener(XMPPEvents.AV_MODERATION_RECEIVED, this._onMessage);\n    }\n\n    /**\n     * Whether AV moderation is supported on backend.\n     *\n     * @returns {boolean} whether AV moderation is supported on backend.\n     */\n    isSupported() {\n        return Boolean(this._xmpp.avModerationComponentAddress);\n    }\n\n    /**\n     * Enables or disables AV Moderation by sending a msg with command to the component.\n     */\n    enable(state: boolean, mediaType: MediaType) {\n        if (!this.isSupported() || !this._mainRoom.isModerator()) {\n            logger.error(`Cannot enable:${state} AV moderation supported:${this.isSupported()},\n                moderator:${this._mainRoom.isModerator()}`);\n\n            return;\n        }\n\n        if (state === this._moderationEnabledByType[mediaType]) {\n            logger.warn(`Moderation already in state:${state} for mediaType:${mediaType}`);\n\n            return;\n        }\n\n        // send the enable/disable message\n        const msg = $msg({ to: this._xmpp.avModerationComponentAddress });\n\n        msg.c('av_moderation', {\n            enable: state,\n            mediaType\n        }).up();\n\n        this._xmpp.connection.send(msg);\n    }\n\n    /**\n     * Approves that a participant can unmute by sending a msg with its jid to the component.\n     */\n    approve(mediaType: MediaType, jid: string) {\n        if (!this.isSupported() || !this._mainRoom.isModerator()) {\n            logger.error(`Cannot approve in AV moderation supported:${this.isSupported()},\n                moderator:${this._mainRoom.isModerator()}`);\n\n            return;\n        }\n\n        // send a message to whitelist the jid and approve it to unmute\n        const msg = $msg({ to: this._xmpp.avModerationComponentAddress });\n\n        msg.c('av_moderation', {\n            jidToWhitelist: jid,\n            mediaType\n        }).up();\n\n        this._xmpp.connection.send(msg);\n    }\n\n    /**\n     * Rejects that a participant can unmute by sending a msg with its jid to the component.\n     */\n    reject(mediaType: MediaType, jid: string) {\n        if (!this.isSupported() || !this._mainRoom.isModerator()) {\n            logger.error(`Cannot reject in AV moderation supported:${this.isSupported()},\n                moderator:${this._mainRoom.isModerator()}`);\n\n            return;\n        }\n\n        // send a message to remove from whitelist the jid and reject it to unmute\n        const msg = $msg({ to: this._xmpp.avModerationComponentAddress });\n\n        msg.c('av_moderation', {\n            jidToBlacklist: jid,\n            mediaType\n        }).up();\n\n        this._xmpp.connection.send(msg);\n    }\n\n    /**\n     * Receives av_moderation parsed messages as json.\n     * @param obj the parsed json content of the message to process.\n     * @private\n     */\n    _onMessage(obj: IMessageObject) {\n        const { removed, mediaType: media, enabled, approved, actor, whitelists: newWhitelists } = obj;\n\n        if (newWhitelists) {\n            let oldList;\n\n            switch (media) {\n            case MediaType.AUDIO:\n                oldList = this._whitelistAudio;\n                break;\n            case MediaType.DESKTOP:\n                oldList = this._whitelistDesktop;\n                break;\n            case MediaType.VIDEO:\n                oldList = this._whitelistVideo;\n                break;\n            default:\n                logger.error(`Unknown media type: ${media}`);\n\n                return;\n            }\n            const newList = Array.isArray(newWhitelists[media]) ? newWhitelists[media] : [];\n\n            if (removed) {\n                oldList.filter(x => !newList.includes(x))\n                    .forEach(jid => this._xmpp.eventEmitter\n                        .emit(XMPPEvents.AV_MODERATION_PARTICIPANT_REJECTED, media, jid));\n            } else {\n                newList.filter(x => !oldList.includes(x))\n                    .forEach(jid => this._xmpp.eventEmitter\n                        .emit(XMPPEvents.AV_MODERATION_PARTICIPANT_APPROVED, media, jid));\n            }\n\n            switch (media) {\n            case MediaType.AUDIO:\n                this._whitelistAudio = newList;\n                break;\n            case MediaType.DESKTOP:\n                this._whitelistDesktop = newList;\n                break;\n            case MediaType.VIDEO:\n                this._whitelistVideo = newList;\n                break;\n            }\n        } else if (enabled !== undefined && this._moderationEnabledByType[media] !== enabled) {\n            this._moderationEnabledByType[media] = enabled;\n\n            this._xmpp.eventEmitter.emit(XMPPEvents.AV_MODERATION_CHANGED, enabled, media, actor);\n        } else if (removed) {\n            this._xmpp.eventEmitter.emit(XMPPEvents.AV_MODERATION_REJECTED, media);\n        } else if (approved) {\n            this._xmpp.eventEmitter.emit(XMPPEvents.AV_MODERATION_APPROVED, media);\n        }\n    }\n}\n","import { getLogger } from '@jitsi/logger';\nimport { $msg, Strophe } from 'strophe.js';\n\nimport { XMPPEvents } from '../../service/xmpp/XMPPEvents';\n\nconst FEATURE_KEY = 'features/breakout-rooms';\nconst BREAKOUT_ROOM_ACTIONS = {\n    ADD: `${FEATURE_KEY}/add`,\n    MOVE_TO_ROOM: `${FEATURE_KEY}/move-to-room`,\n    REMOVE: `${FEATURE_KEY}/remove`,\n    RENAME: `${FEATURE_KEY}/rename`\n};\nconst BREAKOUT_ROOM_EVENTS = {\n    MOVE_TO_ROOM: `${FEATURE_KEY}/move-to-room`,\n    UPDATE: `${FEATURE_KEY}/update`\n};\n\nconst logger = getLogger('xmpp:BreakoutRooms');\n\n/**\n * Helper class for handling breakout rooms.\n */\nexport default class BreakoutRooms {\n\n    /**\n     * Constructs breakout room.\n     *\n     * @param {ChatRoom} room the room we are in.\n     */\n    constructor(room) {\n        this.room = room;\n\n        this._handleMessages = this._handleMessages.bind(this);\n        this.room.xmpp.addListener(XMPPEvents.BREAKOUT_ROOMS_EVENT, this._handleMessages);\n\n        this._rooms = {};\n    }\n\n    /**\n     * Stops listening for events.\n     */\n    dispose() {\n        this.room.xmpp.removeListener(XMPPEvents.BREAKOUT_ROOMS_EVENT, this._handleMessages);\n    }\n\n    /**\n     * Creates a breakout room with the given subject.\n     *\n     * @param {string} subject - A subject for the breakout room.\n     */\n    createBreakoutRoom(subject) {\n        if (!this.isSupported() || !this.room.isModerator()) {\n            logger.error(`Cannot create breakout room - supported:${this.isSupported()},\n                moderator:${this.room.isModerator()}`);\n\n            return;\n        }\n\n        logger.debug('Create breakout room');\n\n        const message = {\n            subject,\n            type: BREAKOUT_ROOM_ACTIONS.ADD\n        };\n\n        this._sendMessage(message);\n    }\n\n    /**\n     * Removes a breakout room.\n     *\n     * @param {string} breakoutRoomJid - JID of the room to be removed.\n     */\n    removeBreakoutRoom(breakoutRoomJid) {\n        if (!this.isSupported() || !this.room.isModerator()) {\n            logger.error(`Cannot remove breakout room - supported:${this.isSupported()},\n                moderator:${this.room.isModerator()}`);\n\n            return;\n        }\n\n        logger.debug(`Remove breakout room: ${breakoutRoomJid}`);\n\n        const message = {\n            breakoutRoomJid,\n            type: BREAKOUT_ROOM_ACTIONS.REMOVE\n        };\n\n        this._sendMessage(message);\n    }\n\n    /**\n     * Changes the subject of a breakout room.\n     *\n     * @param {string} breakoutRoomJid - JID of the room to be removed.\n     * @param {string} subject - A new subject for the breakout room.\n     */\n    renameBreakoutRoom(breakoutRoomJid, subject) {\n        if (!this.isSupported() || !this.room.isModerator()) {\n            logger.error(`Cannot rename breakout room - supported:${this.isSupported()},\n                moderator:${this.room.isModerator()}`);\n\n            return;\n        }\n\n        logger.debug(`Rename breakout room: ${breakoutRoomJid}`);\n\n        const message = {\n            breakoutRoomJid,\n            subject,\n            type: BREAKOUT_ROOM_ACTIONS.RENAME\n\n        };\n\n        this._sendMessage(message);\n    }\n\n    /**\n     * Sends the given participant to the given room.\n     *\n     * @param {string} participantJid - JID of the participant to be sent to a room.\n     * @param {string} roomJid - JID of the target room.\n     */\n    sendParticipantToRoom(participantJid, roomJid) {\n        if (!this.isSupported() || !this.room.isModerator()) {\n            logger.error(`Cannot send participant to room - supported:${this.isSupported()},\n                moderator:${this.room.isModerator()}`);\n\n            return;\n        }\n\n        logger.debug(`Send participant: ${participantJid} to room: ${roomJid}`);\n\n        const message = {\n            participantJid,\n            roomJid,\n            type: BREAKOUT_ROOM_ACTIONS.MOVE_TO_ROOM\n        };\n\n        this._sendMessage(message);\n    }\n\n    /**\n     * Retrieves whether a breakout room feature is supported.\n     *\n     * @param {string} feature - Feature to check.\n     * @returns Wether the feature is supported.\n     */\n    isFeatureSupported(feature) {\n        return Boolean((this.room.xmpp.breakoutRoomsFeatures || {})[feature]);\n    }\n\n    /**\n     * Whether Breakout Rooms support is enabled in the backend or not.\n     */\n    isSupported() {\n        return Boolean(this.getComponentAddress());\n    }\n\n    /**\n     * Gets the address of the Breakout Rooms XMPP component.\n     *\n     * @returns The address of the component.\n     */\n    getComponentAddress() {\n        return this.room.xmpp.breakoutRoomsComponentAddress;\n    }\n\n    /**\n     * Stores if the current room is a breakout room.\n     *\n     * @param {boolean} isBreakoutRoom - Whether this room is a breakout room.\n     */\n    _setIsBreakoutRoom(isBreakoutRoom) {\n        this._isBreakoutRoom = isBreakoutRoom;\n    }\n\n    /**\n     * Checks whether this room is a breakout room.\n     *\n     * @returns True if the room is a breakout room, false otherwise.\n     */\n    isBreakoutRoom() {\n        if (typeof this._isBreakoutRoom !== 'undefined') {\n            return this._isBreakoutRoom;\n        }\n\n        // Use heuristic, helpful for checking in the MUC_JOINED event.\n        return Strophe.getDomainFromJid(this.room.myroomjid) === this.getComponentAddress();\n    }\n\n    /**\n     * Sets the main room JID associated with this breakout room. Only applies when\n     * in a breakout room.\n     *\n     * @param {string} jid - The main room JID.\n     */\n    _setMainRoomJid(jid) {\n        this._mainRoomJid = jid;\n    }\n\n    /**\n     * Gets the main room's JID associated with this breakout room.\n     *\n     * @returns The main room JID.\n     */\n    getMainRoomJid() {\n        return this._mainRoomJid;\n    }\n\n    /**\n     * Handles a message for managing breakout rooms.\n     *\n     * @param {object} payload - Arbitrary data.\n     */\n    _handleMessages(payload) {\n        switch (payload.event) {\n        case BREAKOUT_ROOM_EVENTS.MOVE_TO_ROOM:\n            this.room.eventEmitter.emit(XMPPEvents.BREAKOUT_ROOMS_MOVE_TO_ROOM, payload.roomJid);\n            break;\n        case BREAKOUT_ROOM_EVENTS.UPDATE: {\n            const filteredPayload = this._filterUpdatePayload(payload);\n\n            this._rooms = filteredPayload.rooms;\n            this.room.eventEmitter.emit(XMPPEvents.BREAKOUT_ROOMS_UPDATED, filteredPayload);\n            break;\n        }\n        }\n    }\n\n    /**\n     * Filters the hidden participants from the payload.\n     *\n     * @param {Object} payload - The payload of the update message.\n     * @return {Object} - The filtered payload.\n     */\n    _filterUpdatePayload(payload) {\n        const hiddenDomain = this.room.options.hiddenDomain;\n        const { rooms } = payload;\n        const filteredRooms = {};\n\n        Object.entries(rooms).forEach(([ key, room ]) => {\n            const { participants = {} } = room;\n            const filteredParticipants = {};\n\n            Object.entries(participants).forEach(([ k, participant ]) => {\n                if (Strophe.getDomainFromJid(participant.jid) !== hiddenDomain) {\n                    filteredParticipants[k] = participant;\n                }\n            });\n\n            filteredRooms[key] = {\n                ...room,\n                participants: filteredParticipants\n            };\n        });\n\n        return {\n            ...payload,\n            rooms: filteredRooms\n        };\n    }\n\n    /**\n     * Helper to send a breakout rooms message to the component.\n     *\n     * @param {Object} message - Command that needs to be sent.\n     */\n    _sendMessage(message) {\n        const msg = $msg({ to: this.getComponentAddress() });\n\n        msg.c('breakout_rooms', message).up();\n\n        this.room.xmpp.connection.send(msg);\n    }\n}\n","import { getLogger } from '@jitsi/logger';\nimport { $msg, Strophe } from 'strophe.js';\n\nimport { AUTH_ERROR_TYPES } from '../../JitsiConferenceErrors';\nimport { XMPPEvents } from '../../service/xmpp/XMPPEvents';\n\nimport { handleStropheError } from './StropheErrorHandler';\n\nconst logger = getLogger('xmpp:Lobby');\n\n/**\n * The command type for updating a lobby participant's e-mail address.\n *\n * @type {string}\n */\nconst EMAIL_COMMAND = 'email';\n\n/**\n * The Lobby room implementation. Setting a room to members only, joining the lobby room\n * approving or denying access to participants from the lobby room.\n */\nexport default class Lobby {\n\n    /**\n     * Constructs lobby room.\n     *\n     * @param {ChatRoom} room the main room.\n     */\n    constructor(room) {\n        this.xmpp = room.xmpp;\n        this.mainRoom = room;\n\n        const maybeJoinLobbyRoom = this._maybeJoinLobbyRoom.bind(this);\n\n        this.mainRoom.addEventListener(\n            XMPPEvents.LOCAL_ROLE_CHANGED,\n            maybeJoinLobbyRoom);\n\n        this.mainRoom.addEventListener(\n            XMPPEvents.MUC_MEMBERS_ONLY_CHANGED,\n            maybeJoinLobbyRoom);\n\n        this.mainRoom.addEventListener(\n            XMPPEvents.ROOM_CONNECT_MEMBERS_ONLY_ERROR,\n            jid => {\n                this.lobbyRoomJid = jid;\n            });\n    }\n\n    /**\n     * Whether lobby is supported on backend.\n     *\n     * @returns {boolean} whether lobby is supported on backend.\n     */\n    isSupported() {\n        return this.xmpp.lobbySupported;\n    }\n\n    /**\n     * Enables lobby by setting the main room to be members only and joins the lobby chat room.\n     *\n     * @returns {Promise}\n     */\n    enable() {\n        if (!this.isSupported()) {\n            return Promise.reject(new Error('Lobby not supported!'));\n        }\n\n        // let's wait for the room data form to be populated after XMPPEvents.MUC_JOINED\n        if (!this.mainRoom.initialDiscoRoomInfoReceived) {\n            return new Promise((resolve, reject) => {\n                let unsubscribers = [];\n                const unsubscribe = () => {\n                    unsubscribers.forEach(remove => remove());\n                    unsubscribers = [];\n                };\n\n                unsubscribers.push(\n                    this.mainRoom.addCancellableListener(XMPPEvents.ROOM_DISCO_INFO_UPDATED, () => {\n                        unsubscribe();\n\n                        if (this.mainRoom.membersOnlyEnabled) {\n                            resolve();\n\n                            return;\n                        }\n\n                        this.mainRoom.setMembersOnly(true, resolve, reject);\n                    }));\n\n                // on timeout or failure\n                unsubscribers.push(this.mainRoom.addCancellableListener(XMPPEvents.ROOM_DISCO_INFO_FAILED, e => {\n                    unsubscribe();\n                    reject(e);\n                }));\n            });\n        }\n\n        if (this.mainRoom.membersOnlyEnabled) {\n            return Promise.resolve();\n        }\n\n        return new Promise((resolve, reject) => {\n            this.mainRoom.setMembersOnly(true, resolve, reject);\n        });\n    }\n\n    /**\n     * Disable lobby by setting the main room to be non members only and levaes the lobby chat room if joined.\n     *\n     * @returns {void}\n     */\n    disable() {\n        if (!this.isSupported() || !this.mainRoom.isModerator()\n                || !this.lobbyRoom || !this.mainRoom.membersOnlyEnabled) {\n            return;\n        }\n\n        this.mainRoom.setMembersOnly(false);\n    }\n\n    /**\n     * Broadcast a message to all participants in the lobby room\n     * @param {Object} message The message to send\n     *\n     * @returns {void}\n     */\n    sendMessage(message) {\n        if (this.lobbyRoom) {\n            this.lobbyRoom.sendMessage(JSON.stringify(message), 'json-message');\n        }\n    }\n\n    /**\n     * Sends a private message to a participant in a lobby room.\n     * @param {string} id The message to send\n     * @param {Object} message The message to send\n     *\n     * @returns {void}\n     */\n    sendPrivateMessage(id, message) {\n        if (this.lobbyRoom) {\n            this.lobbyRoom.sendPrivateMessage(id, JSON.stringify(message), 'json-message');\n        }\n    }\n\n    /**\n     * Gets the local id for a participant in a lobby room.\n     * This is used for lobby room private chat messages.\n     *\n     * @returns {string}\n     */\n    getLocalId() {\n        if (this.lobbyRoom) {\n            return Strophe.getResourceFromJid(this.lobbyRoom.myroomjid);\n        }\n    }\n\n    /**\n     * Adds a message listener to the lobby room.\n     * @param {Function} listener The listener function,\n     * called when a new message is received in the lobby room.\n     *\n     * @returns {Function} Handler returned to be able to remove it later.\n     */\n    addMessageListener(listener) {\n        if (this.lobbyRoom) {\n            const handler = (participantId, message) => {\n                listener(message, Strophe.getResourceFromJid(participantId));\n            };\n\n            this.lobbyRoom.on(XMPPEvents.JSON_MESSAGE_RECEIVED, handler);\n\n            return handler;\n        }\n    }\n\n    /**\n     * Remove a message handler from the lobby room.\n     * @param {Function} handler The handler function to remove.\n     *\n     * @returns {void}\n     */\n    removeMessageHandler(handler) {\n        if (this.lobbyRoom) {\n            this.lobbyRoom.off(XMPPEvents.JSON_MESSAGE_RECEIVED, handler);\n        }\n    }\n\n    /**\n     * Leaves the lobby room.\n     *\n     * @returns {Promise}\n     */\n    leave() {\n        if (this.lobbyRoom) {\n            return this.lobbyRoom.leave()\n                .then(() => {\n                    this.lobbyRoom = undefined;\n                    logger.info('Lobby room left!');\n                })\n                .catch(() => {}); // eslint-disable-line no-empty-function\n        }\n\n        return Promise.reject(\n                new Error('The lobby has already been left'));\n    }\n\n    /**\n     * We had received a jid for the lobby room.\n     *\n     * @param jid the lobby room jid to join.\n     */\n    setLobbyRoomJid(jid) {\n        this.lobbyRoomJid = jid;\n    }\n\n    /**\n     * Checks the state of mainRoom, lobbyRoom and current user role to decide whether to join lobby room.\n     * @private\n     */\n    _maybeJoinLobbyRoom() {\n        if (!this.isSupported()) {\n            return;\n        }\n\n        const isModerator = this.mainRoom.joined && this.mainRoom.isModerator();\n\n        if (isModerator && this.mainRoom.membersOnlyEnabled && !this.lobbyRoom) {\n            // join the lobby\n            this.join()\n                .then(() => logger.info('Joined lobby room'))\n                .catch(e => logger.error('Failed joining lobby', e));\n        }\n    }\n\n    /**\n     * Joins a lobby room setting display name and eventually avatar(using the email provided).\n     *\n     * @param {string} username is required.\n     * @param {string} email is optional.\n     * @returns {Promise} resolves once we join the room.\n     */\n    join(displayName, email) {\n        const isModerator = this.mainRoom.joined && this.mainRoom.isModerator();\n\n        if (!this.lobbyRoomJid) {\n            return Promise.reject(new Error('Missing lobbyRoomJid, cannot join lobby room.'));\n        }\n\n        const roomName = Strophe.getNodeFromJid(this.lobbyRoomJid);\n        const customDomain = Strophe.getDomainFromJid(this.lobbyRoomJid);\n\n        this.lobbyRoom = this.xmpp.createRoom(\n            roomName, {\n                customDomain,\n                disableDiscoInfo: true,\n                disableFocus: true,\n                disableRoomCreationRetry: true,\n                enableLobby: false\n            }\n        );\n\n        if (displayName) {\n            // remove previously set nickname\n            this.lobbyRoom.addOrReplaceInPresence('nick', {\n                attributes: { xmlns: 'http://jabber.org/protocol/nick' },\n                value: displayName\n            });\n        }\n\n        if (isModerator) {\n            this.lobbyRoom.addPresenceListener(EMAIL_COMMAND, (node, from) => {\n                this.mainRoom.eventEmitter.emit(XMPPEvents.MUC_LOBBY_MEMBER_UPDATED, from, { email: node.value });\n            });\n            this.lobbyRoom.addEventListener(\n                XMPPEvents.MUC_MEMBER_JOINED,\n                // eslint-disable-next-line max-params\n                (from, nick, role, isHiddenDomain, statsID, status, identity, botType, jid) => {\n                    // we need to ignore joins on lobby for participants that are already in the main room\n                    if (Object.values(this.mainRoom.members).find(m => m.jid === jid)) {\n                        return;\n                    }\n\n                    // Check if the user is a member if any breakout room.\n                    for (const room of Object.values(this.mainRoom.getBreakoutRooms()._rooms)) {\n                        if (Object.values(room.participants).find(p => p.jid === jid)) {\n                            return;\n                        }\n                    }\n\n                    // we emit the new event on the main room so we can propagate\n                    // events to the conference\n                    this.mainRoom.eventEmitter.emit(\n                        XMPPEvents.MUC_LOBBY_MEMBER_JOINED,\n                        Strophe.getResourceFromJid(from),\n                        nick,\n                        identity ? identity.avatar : undefined\n                    );\n                });\n            this.lobbyRoom.addEventListener(\n                XMPPEvents.MUC_MEMBER_LEFT, from => {\n                    // we emit the new event on the main room so we can propagate\n                    // events to the conference\n                    this.mainRoom.eventEmitter.emit(\n                        XMPPEvents.MUC_LOBBY_MEMBER_LEFT,\n                        Strophe.getResourceFromJid(from)\n                    );\n                });\n            this.lobbyRoom.addEventListener(\n                XMPPEvents.MUC_DESTROYED,\n                () => {\n                    // let's make sure we emit that all lobby users had left\n                    Object.keys(this.lobbyRoom.members)\n                        .forEach(j => this.mainRoom.eventEmitter.emit(\n                            XMPPEvents.MUC_LOBBY_MEMBER_LEFT, Strophe.getResourceFromJid(j)));\n\n                    this.lobbyRoom.clean();\n\n                    this.lobbyRoom = undefined;\n                    logger.info('Lobby room left(destroyed)!');\n                });\n        } else {\n            // this should only be handled by those waiting in lobby\n            this.lobbyRoom.addEventListener(XMPPEvents.KICKED, isSelfPresence => {\n                if (isSelfPresence) {\n                    this.mainRoom.eventEmitter.emit(XMPPEvents.MUC_DENIED_ACCESS);\n\n                    this.lobbyRoom.clean();\n\n\n                }\n            });\n\n            // As there is still reference of the main room\n            // the invite will be detected and addressed to its eventEmitter, even though we are not in it\n            // the invite message should be received directly to the xmpp conn in general\n            this.mainRoom.addEventListener(\n                XMPPEvents.INVITE_MESSAGE_RECEIVED,\n                (roomJid, from, txt, invitePassword) => {\n                    logger.debug(`Received approval to join ${roomJid} ${from} ${txt}`);\n                    if (roomJid === this.mainRoom.roomjid) {\n                        // we are now allowed, so let's join\n                        this.mainRoom.join(invitePassword);\n                    }\n                });\n            this.lobbyRoom.addEventListener(\n                XMPPEvents.MUC_DESTROYED,\n                (reason, jid) => {\n                    this.lobbyRoom?.clean();\n\n                    this.lobbyRoom = undefined;\n                    logger.info('Lobby room left(destroyed)!');\n\n                    // we are receiving the jid of the main room\n                    // means we are invited to join, maybe lobby was disabled\n                    if (jid) {\n                        this.mainRoom.join();\n\n                        return;\n                    }\n\n                    this.mainRoom.eventEmitter.emit(XMPPEvents.MUC_DESTROYED, reason);\n                });\n\n            // If participant retries joining shared password while waiting in the lobby\n            // and succeeds make sure we leave lobby\n            this.mainRoom.addEventListener(\n                XMPPEvents.MUC_JOINED,\n                () => {\n                    this.leave().catch(() => {\n                        // this may happen if the room has been destroyed.\n                    });\n                });\n        }\n\n        return new Promise((resolve, reject) => {\n            this.lobbyRoom.addEventListener(XMPPEvents.MUC_JOINED, () => {\n                resolve();\n\n                // send our email, as we do not handle this on initial presence we need a second one\n                if (email && !isModerator) {\n                    this.lobbyRoom.addOrReplaceInPresence(EMAIL_COMMAND, { value: email })\n                        && this.lobbyRoom.sendPresence();\n                }\n            });\n            this.lobbyRoom.addEventListener(XMPPEvents.ROOM_JOIN_ERROR, reject);\n            this.lobbyRoom.addEventListener(XMPPEvents.ROOM_CONNECT_ERROR, reject);\n            this.lobbyRoom.addEventListener(XMPPEvents.ROOM_CONNECT_NOT_ALLOWED_ERROR, (type, txt) => {\n                if (type === AUTH_ERROR_TYPES.ROOM_CREATION_RESTRICTION) {\n                    logger.info('Lobby room creation not allowed, we will retry on main room.');\n                    this.lobbyRoom?.clean();\n\n                    this.lobbyRoom = undefined;\n\n                    this.mainRoom.join();\n                } else {\n                    reject(type, txt);\n                }\n            });\n\n            this.lobbyRoom.join();\n        });\n    }\n\n    /**\n     * Should be possible only for moderators.\n     * @param id\n     */\n    denyAccess(id) {\n        if (!this.isSupported() || !this.mainRoom.isModerator()) {\n            return;\n        }\n\n        const jid = Object.keys(this.lobbyRoom.members)\n            .find(j => Strophe.getResourceFromJid(j) === id);\n\n        if (jid) {\n            this.lobbyRoom.kick(jid);\n        } else {\n            logger.error(`Not found member for ${id} in lobby room.`);\n        }\n    }\n\n    /**\n     * Should be possible only for moderators.\n     * @param param or an array of ids.\n     */\n    approveAccess(param) {\n        if (!this.isSupported() || !this.mainRoom.isModerator()) {\n            return;\n        }\n\n        // Get the main room JID. If we are in a breakout room we'll use the main\n        // room's lobby.\n        let mainRoomJid = this.mainRoom.roomjid;\n\n        if (this.mainRoom.getBreakoutRooms().isBreakoutRoom()) {\n            mainRoomJid = this.mainRoom.getBreakoutRooms().getMainRoomJid();\n        }\n\n        const membersToApprove = [];\n        let ids = param;\n\n        if (!Array.isArray(param)) {\n            ids = [ param ];\n        }\n\n        ids.forEach(id => {\n            const memberRoomJid = Object.keys(this.lobbyRoom.members)\n                .find(j => Strophe.getResourceFromJid(j) === id);\n\n            if (memberRoomJid) {\n                membersToApprove.push(this.lobbyRoom.members[memberRoomJid].jid);\n            } else {\n                logger.error(`Not found member for ${memberRoomJid} in lobby room.`);\n            }\n        });\n\n        if (membersToApprove.length > 0) {\n            const msgToSend\n                = $msg({ to: mainRoomJid })\n                    .c('x', { xmlns: 'http://jabber.org/protocol/muc#user' });\n\n            membersToApprove.forEach(jid => {\n                msgToSend.c('invite', { to: jid }).up();\n            });\n\n            this.xmpp.connection.sendIQ(msgToSend,\n                () => { }, // eslint-disable-line no-empty-function\n                e => {\n                    handleStropheError(e, {\n                        membersToApprove,\n                        operation: 'lobby approve members',\n                        roomJid: this.lobbyRoom,\n                        userJid: this.xmpp.connection.jid\n                    });\n                });\n        }\n    }\n}\n","import { XMPPEvents } from '../../service/xmpp/XMPPEvents';\n\nimport ChatRoom from './ChatRoom';\nimport XMPP from './xmpp';\n\nexport const COMMAND_ANSWER_POLL = 'answer-poll';\nexport const COMMAND_NEW_POLL = 'new-poll';\nexport const COMMAND_OLD_POLLS = 'old-polls';\n\nexport default class Polls {\n    private _mainRoom: ChatRoom;\n    private _xmpp: XMPP;\n\n    /**\n     * Constructs polls for a room.\n     *\n     * @param {ChatRoom} room the main room.\n     */\n    constructor(room: ChatRoom) {\n        this._mainRoom = room;\n        this._xmpp = room.xmpp;\n\n        this._handleMessages = this._handleMessages.bind(this);\n        this._mainRoom.xmpp.addListener(XMPPEvents.POLLS_EVENT, this._handleMessages);\n    }\n\n    /**\n     * Whether polls is supported on backend.\n     *\n     * @returns {boolean} whether polls is supported on backend.\n     */\n    isSupported() {\n        return Boolean(this._xmpp.pollsComponentAddress);\n    }\n\n    /**\n     * Stops listening for events.\n     */\n    dispose() {\n        this._mainRoom.xmpp.removeListener(XMPPEvents.POLLS_EVENT, this._handleMessages);\n    }\n\n    /**\n     * Creates and sends a new poll.\n     *\n     * @param pollId\n     * @param question\n     * @param answers\n     */\n    createPoll(pollId: string, question: string, answers: Array<{ name: string; }>) {\n        this._mainRoom.sendPrivateMessage(\n            this._xmpp.pollsComponentAddress,\n            JSON.stringify({\n                answers: answers,\n                command: COMMAND_NEW_POLL,\n                pollId,\n                question,\n                type: 'polls'\n            }),\n            'json-message',\n            true);\n    }\n\n    /**\n     * Sends answers for a poll.\n     *\n     * @param pollId\n     * @param answers\n     */\n    answerPoll(pollId: string, answers: Array<boolean>) {\n        this._mainRoom.sendPrivateMessage(\n            this._xmpp.pollsComponentAddress,\n            JSON.stringify({\n                answers,\n                command: COMMAND_ANSWER_POLL,\n                pollId,\n                type: 'polls'\n            }),\n            'json-message',\n            true);\n    }\n\n    /**\n     * Handles a message for polls.\n     *\n     * @param {object} payload - Arbitrary data.\n     */\n    _handleMessages(payload) {\n        switch (payload.command) {\n        case COMMAND_NEW_POLL:\n            this._mainRoom.eventEmitter.emit(XMPPEvents.POLLS_RECEIVE_EVENT, payload);\n\n            break;\n        case COMMAND_OLD_POLLS: {\n            payload?.polls?.forEach((poll: any) => {\n                this._mainRoom.eventEmitter.emit(XMPPEvents.POLLS_RECEIVE_EVENT, {\n                    history: true,\n                    ...poll\n                });\n            });\n            break;\n        }\n        case COMMAND_ANSWER_POLL: {\n            this._mainRoom.eventEmitter.emit(XMPPEvents.POLLS_ANSWER_EVENT, payload);\n            break;\n        }\n        }\n    }\n}\n","import { getLogger } from '@jitsi/logger';\nimport { isEqual } from 'lodash-es';\nimport { $msg } from 'strophe.js';\n\nimport { XMPPEvents } from '../../service/xmpp/XMPPEvents';\n\nimport { JITSI_MEET_MUC_TYPE } from './xmpp';\n\nconst logger = getLogger('xmpp:RoomMetadata');\n\n/**\n * Helper class for handling room metadata.\n */\nexport default class RoomMetadata {\n    room: any;\n    _metadata: any;\n\n    /**\n     * Constructs lobby room.\n     *\n     * @param {ChatRoom} room the room we are in.\n     */\n    constructor(room) {\n        this.room = room;\n\n        this._handleMessages = this._handleMessages.bind(this);\n        this.room.xmpp.addListener(XMPPEvents.ROOM_METADATA_EVENT, this._handleMessages);\n\n        this._metadata = {};\n    }\n\n    /**\n     * Stops listening for events.\n     */\n    dispose() {\n        this.room.xmpp.removeListener(XMPPEvents.ROOM_METADATA_EVENT, this._handleMessages);\n    }\n\n    /**\n     * Sets metadata for the given key.\n     *\n     * @param {string} key - key under which the metadata will be stored.\n     * @param {object} data - data to be stored.\n     */\n    setMetadata(key, data) {\n        if (!this.isSupported()) {\n            logger.error(`Cannot set room metadata - supported:${this.isSupported()}`);\n\n            return;\n        }\n\n        const message = {\n            data,\n            key\n        };\n\n        this._sendMessage(message);\n    }\n\n    /**\n     * Gets the stored metadata (all of it).\n     *\n     * @returns The stored metadata.\n     */\n    getMetadata() {\n        return this._metadata;\n    }\n\n    /**\n     * Whether Breakout Rooms support is enabled in the backend or not.\n     */\n    isSupported() {\n        return Boolean(this.getComponentAddress());\n    }\n\n    /**\n     * Gets the address of the Breakout Rooms XMPP component.\n     *\n     * @returns The address of the component.\n     */\n    getComponentAddress() {\n        return this.room.xmpp.roomMetadataComponentAddress;\n    }\n\n    /**\n     * Handles a message with metadata updates.\n     *\n     * @param {object} payload - Arbitrary data.\n     */\n    _handleMessages(payload) {\n        const { metadata } = payload;\n\n        if (!metadata || isEqual(this._metadata, metadata)) {\n            return;\n        }\n\n        this._metadata = metadata;\n        logger.debug('Received metadata update', JSON.stringify(metadata));\n        this.room.eventEmitter.emit(XMPPEvents.ROOM_METADATA_UPDATED, metadata);\n    }\n\n    /**\n     * Helper to send a breakout rooms message to the component.\n     *\n     * @param {Object} message - Command that needs to be sent.\n     */\n    _sendMessage(message) {\n        message[JITSI_MEET_MUC_TYPE] = 'room_metadata';\n\n        const msg = $msg({ to: this.getComponentAddress() });\n\n        msg.c('room_metadata', {\n            room: this.room.roomjid,\n            xmlns: 'http://jitsi.org/jitmeet'\n        }, JSON.stringify(message)).up();\n\n        this.room.xmpp.connection.send(msg);\n    }\n}\n","import { getLogger } from '@jitsi/logger';\nimport emojiRegex from 'emoji-regex';\nimport { isEqual } from 'lodash-es';\nimport { $iq, $msg, $pres, Strophe } from 'strophe.js';\nimport { v4 as uuidv4 } from 'uuid';\n\nimport { AUTH_ERROR_TYPES } from '../../JitsiConferenceErrors';\nimport * as JitsiTranscriptionStatus from '../../JitsiTranscriptionStatus';\nimport { MediaType } from '../../service/RTC/MediaType';\nimport { VideoType } from '../../service/RTC/VideoType';\nimport { AuthenticationEvents } from '../../service/authentication/AuthenticationEvents';\nimport { XMPPEvents } from '../../service/xmpp/XMPPEvents';\nimport Settings from '../settings/Settings';\nimport EventEmitterForwarder from '../util/EventEmitterForwarder';\nimport Listenable from '../util/Listenable';\nimport { getJitterDelay } from '../util/Retry';\nimport { exists, findAll, findFirst, getAttribute, getText } from '../util/XMLUtils';\n\nimport AVModeration from './AVModeration';\nimport BreakoutRooms from './BreakoutRooms';\nimport FileSharing from './FileSharing';\nimport Lobby from './Lobby';\nimport Polls from './Polls';\nimport RoomMetadata from './RoomMetadata';\nimport { handleStropheError } from './StropheErrorHandler';\nimport XmppConnection, { ErrorCallback } from './XmppConnection';\nimport XMPP, { FEATURE_TRANSCRIBER } from './xmpp';\n\n// Callback types\ntype SuccessCallback = () => void;\ntype ParticipantPropertyListener = (participantId: string, key: string, value: string) => void;\nexport type PresenceHandler = (node: IPresenceNode, participantId: string, from: string) => void;\n\n// Node type for presence JSON structure\ninterface IPresenceNode {\n    attributes?: Record<string, string>;\n    children?: IPresenceNode[];\n    tagName: string;\n    value?: string ;\n}\n\n// Member type for room members\ninterface IRoomMember {\n    affiliation?: string;\n    botType?: string;\n    displayName?: string;\n    features?: Set<string>;\n    id?: string;\n    identity?: IIdentity;\n    isFocus?: boolean;\n    isHiddenDomain?: boolean;\n    isReplaceParticipant?: number;\n    isSilent?: boolean;\n    jid?: string;\n    nick?: string;\n    region?: string;\n    role?: string;\n    statsID?: string;\n    status?: string;\n    version?: string;\n}\n\n// Options interface for ChatRoom constructor\nexport interface IChatRoomOptions {\n    deploymentInfo?: any;\n    disableDiscoInfo?: boolean;\n    disableFocus?: boolean;\n    disableRoomCreationRetry?: boolean;\n    enableLobby?: boolean;\n    hiddenDomain?: string;\n    hiddenFromRecorderFeatureEnabled?: boolean;\n    statsId?: string;\n}\n\n// Presence map structure\ninterface IPresenceMap {\n    length?: number;\n    nodes: IPresenceNode[];\n    to?: string;\n    xns?: string;\n}\n\n// Identity information interface\ninterface IIdentity {\n    group?: string;\n    user?: {\n        avatar?: string;\n        'hidden-from-recorder'?: string;\n        id?: string;\n        name?: string;\n    };\n}\n\n// Peer media info type\ninterface IPeerMediaInfo {\n    codecType?: string;\n    muted: boolean;\n    videoType?: VideoType | string;\n}\n\nconst logger = getLogger('xmpp:ChatRoom');\n\n/**\n * Regex that matches all emojis.\n */\nconst EMOJI_REGEX = emojiRegex();\n\n/**\n * How long we're going to wait for IQ response, before timeout error is triggered.\n * @type {number}\n */\nconst IQ_TIMEOUT = 10000;\n\nexport const parser = {\n    json2packet(nodes: IPresenceNode[], packet: any): void {\n        for (let i = 0; i < nodes.length; i++) {\n            const node = nodes[i];\n\n            if (node) {\n                packet.c(node.tagName, node.attributes);\n                if (node.value) {\n                    packet.t(node.value);\n                }\n                if (node.children) {\n                    this.json2packet(node.children, packet);\n                }\n                packet.up();\n            }\n        }\n\n        // packet.up();\n    },\n    packet2JSON(xmlElement: Element, nodes: IPresenceNode[]): void {\n        for (const child of Array.from(xmlElement.children)) {\n            const node: IPresenceNode = {\n                attributes: {},\n                children: [],\n                tagName: child.tagName\n            };\n\n            for (const attr of Array.from(child.attributes)) {\n                node.attributes[attr.name] = attr.value;\n            }\n            const text = Strophe.getText(child);\n\n            if (text) {\n                // Using Strophe.getText will do work for traversing all direct\n                // child text nodes but returns an escaped value, which is not\n                // desirable at this point.\n                node.value = Strophe.xmlunescape(text);\n            }\n            nodes.push(node);\n            this.packet2JSON(child, node.children);\n        }\n    }\n};\n\n/**\n * Returns array of JS objects from the presence JSON associated with the passed\n / nodeName\n * @param pres the presence JSON\n * @param nodeName the name of the node (videomuted, audiomuted, etc)\n */\nexport function filterNodeFromPresenceJSON(pres: IPresenceNode[], nodeName: string): IPresenceNode[] {\n    const res: IPresenceNode[] = [];\n\n    for (let i = 0; i < pres.length; i++) {\n        if (pres[i].tagName === nodeName) {\n            res.push(pres[i]);\n        }\n    }\n\n    return res;\n}\n\n// XXX As ChatRoom constructs XMPP stanzas and Strophe is build around the idea\n// of chaining function calls, allow long function call chains.\n/* eslint-disable newline-per-chained-call */\n\n/**\n * Array of affiliations that are allowed in members only room.\n * @type {string[]}\n */\nconst MEMBERS_AFFILIATIONS = [ 'owner', 'admin', 'member' ];\n\n/**\n * Process nodes to extract data needed for MUC_JOINED and MUC_MEMBER_JOINED events.\n *\n */\nfunction extractIdentityInformation(node: IPresenceNode, hiddenFromRecorderFeatureEnabled: boolean): IIdentity {\n    const identity: IIdentity = {};\n    const userInfo = node.children.find(c => c.tagName === 'user');\n\n    if (userInfo) {\n        identity.user = {};\n        const tags = [ 'id', 'name', 'avatar' ];\n\n        if (hiddenFromRecorderFeatureEnabled) {\n            tags.push('hidden-from-recorder');\n        }\n\n        for (const tag of tags) {\n            const child\n                = userInfo.children.find(c => c.tagName === tag);\n\n            if (child) {\n                identity.user[tag] = child.value;\n            }\n        }\n    }\n    const groupInfo = node.children.find(c => c.tagName === 'group');\n\n    if (groupInfo) {\n        identity.group = groupInfo.value;\n    }\n\n    return identity;\n}\n\n/**\n *\n */\nexport default class ChatRoom extends Listenable {\n\n    private password?: string;\n    private replaceParticipant: boolean;\n    private members: Record<string, IRoomMember>;\n    private presHandlers: Record<string, PresenceHandler[]>;\n    private _removeConnListeners: (() => void)[];\n    private inProgressEmitted: boolean;\n    private noBridgeAvailable: boolean;\n    private options: IChatRoomOptions;\n    private eventsForwarder: EventEmitterForwarder;\n    private lobby?: Lobby;\n    private avModeration: AVModeration;\n    private breakoutRooms: BreakoutRooms;\n    private fileSharing: FileSharing;\n    private polls: Polls;\n    private roomMetadata: RoomMetadata;\n    private lastPresences: Record<string, IPresenceNode[]>;\n    private phoneNumber: Nullable<string>;\n    private phonePin: Nullable<string>;\n    private participantPropertyListener?: ParticipantPropertyListener;\n    private locked: boolean;\n    private initialDiscoRoomInfoReceived: boolean;\n    private presenceUpdateTime: number;\n    private presenceSyncTime?: number;\n    private meetingId?: string;\n    private focusFeatures?: Set<string>;\n    private subject?: string;\n    private _roomCreationRetries?: number;\n    private cachedShortTermCredentials?: Record<string, string>;\n    public xmpp: XMPP;\n    public connection: XmppConnection;\n    public roomjid: string;\n    public myroomjid: string;\n    public joined: boolean;\n    public presMap: IPresenceMap;\n    public role: Nullable<string>;\n    public focusMucJid: Nullable<string>;\n    public connectionTimes: Record<string, number>;\n    public transcriptionStatus: string;\n    public membersOnlyEnabled?: boolean;\n    public visitorsSupported?: boolean;\n\n    /* eslint-disable max-params */\n\n    /**\n     *\n     * @param {XmppConnection} connection - The XMPP connection instance.\n     * @param jid\n     * @param password\n     * @param XMPP\n     * @param options\n     * @param {boolean} options.disableFocus - when set to {@code false} will\n     * not invite Jicofo into the room.\n     * @param {boolean} options.disableDiscoInfo - when set to {@code false} will skip disco info.\n     * This is intended to be used only for lobby rooms.\n     * @param {boolean} options.enableLobby - when set to {@code false} will skip creating lobby room.\n     * @param {boolean} options.hiddenFromRecorderFeatureEnabled - when set to {@code true} we will check identity tag\n     * for node presence.\n     */\n    constructor(connection: XmppConnection, jid: string, password: Optional<string>, xmpp: XMPP, options?: IChatRoomOptions) {\n        super();\n        this.xmpp = xmpp;\n        this.connection = connection;\n        this.roomjid = Strophe.getBareJidFromJid(jid);\n        this.myroomjid = jid;\n        this.password = password;\n        this.replaceParticipant = false;\n        logger.info(`Joining MUC as ${this.myroomjid}`);\n        this.members = {};\n        this.presMap = { nodes: [] };\n        this.presHandlers = {};\n        this._removeConnListeners = [];\n        this.joined = false;\n        this.inProgressEmitted = false;\n        this.role = null;\n        this.focusMucJid = null;\n        this.noBridgeAvailable = false;\n        this.options = options || {};\n\n        this.eventsForwarder = new EventEmitterForwarder(this.xmpp.moderator, this.eventEmitter);\n        this.eventsForwarder.forward(AuthenticationEvents.IDENTITY_UPDATED, AuthenticationEvents.IDENTITY_UPDATED);\n        this.eventsForwarder.forward(XMPPEvents.AUTHENTICATION_REQUIRED, XMPPEvents.AUTHENTICATION_REQUIRED);\n        this.eventsForwarder.forward(XMPPEvents.FOCUS_DISCONNECTED, XMPPEvents.FOCUS_DISCONNECTED);\n        this.eventsForwarder.forward(XMPPEvents.RESERVATION_ERROR, XMPPEvents.RESERVATION_ERROR);\n\n        if (typeof this.options.enableLobby === 'undefined' || this.options.enableLobby) {\n            this.lobby = new Lobby(this);\n        }\n        this.avModeration = new AVModeration(this);\n        this.breakoutRooms = new BreakoutRooms(this);\n        this.fileSharing = new FileSharing(this);\n        this.polls = new Polls(this);\n        this.roomMetadata = new RoomMetadata(this);\n        this.initPresenceMap(options);\n        this.lastPresences = {};\n        this.phoneNumber = null;\n        this.phonePin = null;\n        this.connectionTimes = {};\n        this.participantPropertyListener = null;\n\n        this.locked = false;\n        this.transcriptionStatus = JitsiTranscriptionStatus.OFF;\n        this.initialDiscoRoomInfoReceived = false;\n    }\n\n    /* eslint-enable max-params */\n\n    /**\n     *\n     */\n    private initPresenceMap(options: IChatRoomOptions = {}): void {\n        this.presMap.to = this.myroomjid;\n        this.presMap.xns = 'http://jabber.org/protocol/muc';\n        this.presMap.nodes = [];\n\n        if (options.statsId) {\n            this.presMap.nodes.push({\n                'tagName': 'stats-id',\n                'value': options.statsId\n            });\n        }\n\n        this.presenceUpdateTime = Date.now();\n    }\n\n\n    /**\n     * Extracts the features from the presence.\n     * @param node the node to process.\n     * @return features the Set of features where extracted data is added.\n     * @private\n     */\n    private _extractFeatures(node: IPresenceNode): Set<string> {\n        const features = new Set<string>();\n\n        for (let j = 0; j < node.children.length; j++) {\n            const { attributes } = node.children[j];\n\n            if (attributes?.var) {\n                features.add(attributes.var);\n            }\n        }\n\n        return features;\n    }\n\n    /**\n     * Initialize some properties when the focus participant is verified.\n     * @param from jid of the focus\n     * @param features the features reported in jicofo presence\n     */\n    private _initFocus(from: string, features?: Set<string>): void {\n        this.focusMucJid = from;\n        this.focusFeatures = features;\n    }\n\n    /**\n     * Handles Xmpp Connection status updates.\n     *\n     * @param {Strophe.Status} status - The Strophe connection status.\n     */\n    private _onConnStatusChanged(status: Strophe.Status): void {\n        // Send cached presence when the XMPP connection is re-established, only if needed\n        if (status === XmppConnection.Status.CONNECTED && this.presenceUpdateTime > this.presenceSyncTime) {\n            this.sendPresence();\n        }\n    }\n\n    /**\n     *\n     * @param node\n     * @param from\n     */\n    private _processNode(node: IPresenceNode, from: string): void {\n        // make sure we catch all errors coming from any handler\n        // otherwise we can remove the presence handler from strophe\n        try {\n            const tagHandlers = this.presHandlers[node.tagName] ?? [];\n\n            tagHandlers.forEach(handler => {\n                handler(node, Strophe.getResourceFromJid(from), from);\n            });\n        } catch (e) {\n            logger.error(`Error processing:${node.tagName} node.`, e);\n        }\n    }\n\n    /**\n     * Clean any listeners or resources, executed on leaving.\n     */\n    private clean(): void {\n        this._removeConnListeners.forEach(remove => remove());\n        this._removeConnListeners = [];\n\n        this.eventsForwarder.removeListeners(\n            AuthenticationEvents.IDENTITY_UPDATED,\n            XMPPEvents.AUTHENTICATION_REQUIRED,\n            XMPPEvents.FOCUS_DISCONNECTED,\n            XMPPEvents.RESERVATION_ERROR);\n\n        this.joined = false;\n        this.inProgressEmitted = false;\n    }\n\n    /**\n     * Parses XEP-0461 reply message information from a message stanza.\n     * @param {Element} msg - The message stanza.\n     * @returns {string|null} The ID of the message being replied to, or null if not a reply.\n     * @private\n     */\n    private _parseReplyMessage(msg: Element): string | null {\n        return getAttribute(findFirst(msg, ':scope>reply'), 'to');\n    }\n\n    /**\n     * Joins the chat room.\n     * @param {string} password - Password to unlock room on joining.\n     * @returns {Promise} - resolved when join completes. At the time of this\n     * writing it's never rejected.\n     */\n    public join(password?: string, replaceParticipant?: boolean): Promise<void> {\n        this.password = password;\n        this.replaceParticipant = replaceParticipant;\n\n        return new Promise(resolve => {\n            this.options.disableFocus\n                && logger.info(`Conference focus disabled for ${this.roomjid}`);\n\n            const preJoin\n                = this.options.disableFocus\n                    ? Promise.resolve()\n                        .finally(() => {\n                            this.xmpp.connection._breakoutMovingToMain = undefined;\n                        })\n                    : this.xmpp.moderator.sendConferenceRequest(this.roomjid);\n\n            preJoin.then(() => {\n                this.sendPresence(true);\n                this._removeConnListeners.push(\n                    this.connection.addCancellableListener(\n                        XmppConnection.Events.CONN_STATUS_CHANGED,\n                        this._onConnStatusChanged.bind(this))\n                );\n                resolve();\n            })\n            .catch(e => logger.trace('PreJoin rejected', e));\n        });\n    }\n\n    /**\n     *\n     * @param fromJoin - Whether this is initial presence to join the room.\n     */\n    public sendPresence(fromJoin: boolean = false): void {\n        const to = this.presMap.to;\n\n        if (!this.connection || !this.connection.connected || !to || (!this.joined && !fromJoin)) {\n            // Too early to send presence - not initialized\n            return;\n        }\n\n        const pres = $pres({ to });\n\n        // xep-0045 defines: \"including in the initial presence stanza an empty\n        // <x/> element qualified by the 'http://jabber.org/protocol/muc'\n        // namespace\" and subsequent presences should not include that or it can\n        // be considered as joining, and server can send us the message history\n        // for the room on every presence\n        if (fromJoin) {\n            if (this.replaceParticipant) {\n                pres.c('flip_device').up();\n            }\n\n            pres.c('x', { xmlns: this.presMap.xns });\n\n            if (this.password) {\n                pres.c('password').t(this.password).up();\n            }\n\n            // send the machineId with the initial presence\n            if (this.xmpp.moderator.targetUrl) {\n                pres.c('billingid').t(Settings.machineId).up();\n            }\n\n            pres.up();\n        }\n\n        parser.json2packet(this.presMap.nodes, pres);\n\n        // we store time we last synced presence state\n        this.presenceSyncTime = Date.now();\n\n        this.connection.send(pres);\n        if (fromJoin) {\n            // XXX We're pressed for time here because we're beginning a complex\n            // and/or lengthy conference-establishment process which supposedly\n            // involves multiple RTTs. We don't have the time to wait for\n            // Strophe to decide to send our IQ.\n            this.connection.flush();\n        }\n    }\n\n    /**\n     * Sends the presence unavailable, signaling the server\n     * we want to leave the room.\n     */\n    public doLeave(reason?: string): void {\n        logger.info('do leave', this.myroomjid);\n        const pres = $pres({\n            to: this.myroomjid,\n            type: 'unavailable'\n        });\n\n        if (reason) {\n            pres.c('status').t(reason).up();\n        }\n\n        this.presMap.length = 0;\n\n        // XXX Strophe is asynchronously sending by default. Unfortunately, that\n        // means that there may not be enough time to send the unavailable\n        // presence. Switching Strophe to synchronous sending is not much of an\n        // option because it may lead to a noticeable delay in navigating away\n        // from the current location. As a compromise, we will try to increase\n        // the chances of sending the unavailable presence within the short time\n        // span that we have upon unloading by invoking flush() on the\n        // connection. We flush() once before sending/queuing the unavailable\n        // presence in order to attemtp to have the unavailable presence at the\n        // top of the send queue. We flush() once more after sending/queuing the\n        // unavailable presence in order to attempt to have it sent as soon as\n        // possible.\n        // FIXME do not use Strophe.Connection in the ChatRoom directly\n        !this.connection.isUsingWebSocket && this.connection.flush();\n        this.connection.send(pres);\n        this.connection.flush();\n    }\n\n    /**\n     *\n     */\n    public discoRoomInfo(): void {\n        // https://xmpp.org/extensions/xep-0045.html#disco-roominfo\n\n        const getInfo\n            = $iq({\n                to: this.roomjid,\n                type: 'get'\n            })\n                .c('query', { xmlns: Strophe.NS.DISCO_INFO });\n\n        this.connection.sendIQ(getInfo, result => {\n            const locked = findAll(result, ':scope>query>feature[var=\"muc_passwordprotected\"]').length === 1;\n\n            if (locked !== this.locked) {\n                this.eventEmitter.emit(XMPPEvents.MUC_LOCK_CHANGED, locked);\n                this.locked = locked;\n            }\n\n            const meetingIdValEl = findFirst(result, ':scope>query>x[type=\"result\"]>field[var=\"muc#roominfo_meetingId\"]>value');\n\n            if (meetingIdValEl) {\n                this.setMeetingId(getText(meetingIdValEl));\n            } else {\n                logger.warn('No meeting ID from backend');\n            }\n\n            const meetingCreatedTSValEl = findFirst(result,\n                ':scope>query>x[type=\"result\"]>field[var=\"muc#roominfo_created_timestamp\"]>value');\n\n            if (meetingCreatedTSValEl) {\n                this.eventEmitter.emit(XMPPEvents.CONFERENCE_TIMESTAMP_RECEIVED, getText(meetingCreatedTSValEl));\n            } else {\n                logger.warn('No conference duration from backend');\n            }\n\n            const membersOnly = findAll(result, ':scope>query>feature[var=\"muc_membersonly\"]').length === 1;\n\n            const lobbyRoomField = findFirst(result,\n                ':scope>query>x[type=\"result\"]>field[var=\"muc#roominfo_lobbyroom\"]>value');\n\n            if (this.lobby) {\n                this.lobby.setLobbyRoomJid(\n                    lobbyRoomField ? getText(lobbyRoomField) : undefined);\n            }\n\n            const isBreakoutField = findFirst(result,\n                ':scope>query>x[type=\"result\"]>field[var=\"muc#roominfo_isbreakout\"]>value');\n            const isBreakoutRoom = Boolean(getText(isBreakoutField));\n\n            this.breakoutRooms._setIsBreakoutRoom(isBreakoutRoom);\n\n            const breakoutMainRoomField = findFirst(result,\n                ':scope>query>x[type=\"result\"]>field[var=\"muc#roominfo_breakout_main_room\"]>value');\n\n            if (breakoutMainRoomField) {\n                this.breakoutRooms._setMainRoomJid(getText(breakoutMainRoomField));\n            }\n\n            if (membersOnly !== this.membersOnlyEnabled) {\n                this.membersOnlyEnabled = membersOnly;\n                this.eventEmitter.emit(XMPPEvents.MUC_MEMBERS_ONLY_CHANGED, membersOnly);\n            }\n\n            const visitorsEnabledEl = findFirst(result,\n                ':scope>query>x[type=\"result\"]>field[var=\"muc#roominfo_visitorsEnabled\"]>value');\n            const visitorsSupported = getText(visitorsEnabledEl) === '1';\n\n            if (visitorsSupported !== this.visitorsSupported) {\n                this.visitorsSupported = visitorsSupported;\n                this.eventEmitter.emit(XMPPEvents.MUC_VISITORS_SUPPORTED_CHANGED, visitorsSupported);\n            }\n\n            this.initialDiscoRoomInfoReceived = true;\n            this.eventEmitter.emit(XMPPEvents.ROOM_DISCO_INFO_UPDATED);\n        }, error => {\n            handleStropheError(error, {\n                operation: 'get room disco info',\n                roomJid: this.roomjid,\n                userJid: this.connection.jid\n            });\n            this.eventEmitter.emit(XMPPEvents.ROOM_DISCO_INFO_FAILED, error);\n        },\n        IQ_TIMEOUT);\n    }\n\n    /**\n     * Sets the meeting unique Id (received from the backend).\n     *\n     * @param {string} meetingId - The new meetings id.\n     * @returns {void}\n     */\n    public setMeetingId(meetingId: string): void {\n        if (this.meetingId !== meetingId) {\n            if (this.meetingId) {\n                logger.warn(`Meeting Id changed from:${this.meetingId} to:${meetingId}`);\n            }\n            this.meetingId = meetingId;\n            this.eventEmitter.emit(XMPPEvents.MEETING_ID_SET, meetingId);\n        }\n    }\n\n    /**\n     *\n     */\n    public createNonAnonymousRoom(): void {\n        // http://xmpp.org/extensions/xep-0045.html#createroom-reserved\n\n        if (this.options.disableDiscoInfo) {\n            return;\n        }\n\n        const getForm = $iq({ to: this.roomjid,\n            type: 'get' })\n            .c('query', { xmlns: 'http://jabber.org/protocol/muc#owner' })\n            .c('x', { type: 'submit',\n                xmlns: 'jabber:x:data' });\n\n        this.connection.sendIQ(getForm, form => {\n            // Use *|xmlns to match xmlns attributes across any namespace (CSS Selectors Level 3)\n            if (!exists(form, ':scope>query>x[*|xmlns=\"jabber:x:data\"]>field[var=\"muc#roomconfig_whois\"]')) {\n                logger.error('non-anonymous rooms not supported');\n\n                return;\n            }\n\n            const formSubmit = $iq({ to: this.roomjid,\n                type: 'set' })\n                .c('query', { xmlns: 'http://jabber.org/protocol/muc#owner' });\n\n            formSubmit.c('x', { type: 'submit',\n                xmlns: 'jabber:x:data' });\n\n            formSubmit.c('field', { 'var': 'FORM_TYPE' })\n                .c('value')\n                .t('http://jabber.org/protocol/muc#roomconfig').up().up();\n\n            formSubmit.c('field', { 'var': 'muc#roomconfig_whois' })\n                .c('value').t('anyone').up().up();\n\n            this.connection.sendIQ(formSubmit, undefined, error => {\n                handleStropheError(error, {\n                    operation: 'submit room configuration form',\n                    roomJid: this.roomjid,\n                    userJid: this.connection.jid\n                });\n            });\n\n        }, error => {\n            handleStropheError(error, {\n                operation: 'get room configuration form',\n                roomJid: this.roomjid,\n                userJid: this.connection.jid\n            });\n        });\n    }\n\n    /**\n     *\n     * @param pres\n     * @internal\n     */\n    onPresence(pres: Element): void {\n        const from = pres.getAttribute('from');\n        const member: IRoomMember = {};\n        const statusEl = pres.getElementsByTagName('status')[0];\n\n        if (statusEl) {\n            member.status = statusEl.textContent || '';\n        }\n        let hasStatusUpdate = false;\n        let hasVersionUpdate = false;\n        const xElement\n            = pres.getElementsByTagNameNS(\n                'http://jabber.org/protocol/muc#user', 'x')[0];\n        const mucUserItem\n            = xElement?.getElementsByTagName('item')[0];\n\n        member.isReplaceParticipant\n            = pres.getElementsByTagName('flip_device').length;\n\n        member.affiliation\n            = mucUserItem?.getAttribute('affiliation');\n        member.role = mucUserItem?.getAttribute('role');\n\n        // Focus recognition\n        const jid = mucUserItem?.getAttribute('jid');\n\n        member.jid = jid;\n        member.isFocus = this.xmpp.moderator.isFocusJid(jid);\n        member.isHiddenDomain\n            = jid?.indexOf('@') > 0\n                && this.options.hiddenDomain\n                    === jid.substring(jid.indexOf('@') + 1, jid.indexOf('/'));\n\n        this.eventEmitter.emit(XMPPEvents.PRESENCE_RECEIVED, {\n            fromHiddenDomain: member.isHiddenDomain,\n            presence: pres\n        });\n\n        const xEl = pres.querySelector('x');\n\n        if (xEl) {\n            xEl.remove();\n        }\n\n        const nodes: IPresenceNode[] = [];\n\n        parser.packet2JSON(pres, nodes);\n        this.lastPresences[from] = nodes;\n\n        for (let i = 0; i < nodes.length; i++) {\n            const node = nodes[i];\n\n            switch (node.tagName) {\n            case 'bot': {\n                const { attributes } = node;\n\n                if (!attributes) {\n                    break;\n                }\n                const { type } = attributes;\n\n                member.botType = type;\n                break;\n            }\n            case 'nick':\n                member.nick = node.value;\n                break;\n            case 'silent':\n                member.isSilent = Boolean(node.value);\n                break;\n            case 'userId':\n                member.id = node.value;\n                break;\n            case 'stats-id':\n                member.statsID = node.value;\n                break;\n            case 'identity':\n                member.identity = extractIdentityInformation(node, this.options.hiddenFromRecorderFeatureEnabled);\n                break;\n            case 'features': {\n                member.features = this._extractFeatures(node);\n                break;\n            }\n            case 'jitsi_participant_region': {\n                member.region = node.value;\n                break;\n            }\n            case 'stat': {\n                const { attributes } = node;\n\n                if (!attributes) {\n                    break;\n                }\n                const { name } = attributes;\n\n                if (name === 'version') {\n                    member.version = attributes.value;\n                }\n                break;\n            }\n            }\n        }\n\n        if (!this.joined && !this.inProgressEmitted) {\n            const now = this.connectionTimes['muc.join.started'] = window.performance.now();\n\n            logger.info('(TIME) MUC join started:\\t', now);\n\n            this.eventEmitter.emit(XMPPEvents.MUC_JOIN_IN_PROGRESS);\n            this.inProgressEmitted = true;\n        }\n\n        if (from === this.myroomjid) {\n            const newRole = member.role || 'none';\n\n            if (!this.joined) {\n                this.joined = true;\n                const now = this.connectionTimes['muc.joined']\n                    = window.performance.now();\n\n                logger.info('(TIME) MUC joined:\\t', now);\n\n                // set correct initial state of locked\n                if (this.password) {\n                    this.locked = true;\n                }\n\n                if (member.region && this.options?.deploymentInfo) {\n                    this.options.deploymentInfo.userRegion = member.region;\n                }\n\n                // Re-send presence in case any presence updates were added,\n                // but blocked from sending, during the join process.\n                // send the presence only if there was a modification after we had synced it\n                if (this.presenceUpdateTime > this.presenceSyncTime) {\n                    this.sendPresence();\n                }\n\n                // we need to reset it because of breakout rooms which will reuse connection but will invite jicofo\n                this.xmpp.moderator.conferenceRequestSent = false;\n\n                this.eventEmitter.emit(XMPPEvents.MUC_JOINED);\n\n                // Now let's check the disco-info to retrieve the\n                // meeting Id if any\n                !this.options.disableDiscoInfo && this.discoRoomInfo();\n            }\n\n            if (this.role !== newRole) {\n                this.role = newRole;\n                this.eventEmitter.emit(\n                    XMPPEvents.LOCAL_ROLE_CHANGED,\n                    this.role);\n            }\n\n            if (exists(xElement, ':scope>status[code=\"110\"]')) {\n                // let's check for some backend forced permissions\n                // Use *|xmlns to match xmlns attributes across any namespace (CSS Selectors Level 3)\n                const permissionEl = findFirst(pres, ':scope>permissions[*|xmlns=\"http://jitsi.org/jitmeet\"]');\n\n                if (permissionEl) {\n                    const permissionsMap = {};\n\n                    findAll(permissionEl, 'p').forEach(p => {\n                        permissionsMap[getAttribute(p, 'name')] = getAttribute(p, 'val');\n                    });\n\n                    this.eventEmitter.emit(XMPPEvents.PERMISSIONS_RECEIVED, permissionsMap);\n                }\n            }\n        } else if (jid === undefined) {\n            logger.info('Ignoring member with undefined JID');\n        } else if (this.members[from] === undefined) {\n            // new participant\n            this.members[from] = member;\n            logger.info('entered', from);\n            hasStatusUpdate = member.status !== undefined;\n            hasVersionUpdate = member.version !== undefined;\n            if (member.isFocus) {\n                this._initFocus(from, member.features);\n            } else {\n                // identity is being added to member joined, so external\n                // services can be notified for that (currently identity is\n                // not used inside library)\n                this.eventEmitter.emit(\n                    XMPPEvents.MUC_MEMBER_JOINED,\n                    from,\n                    member.nick,\n                    member.role,\n                    member.isHiddenDomain,\n                    member.statsID,\n                    member.status,\n                    member.identity,\n                    member.botType,\n                    member.jid,\n                    member.features,\n                    member.isReplaceParticipant,\n                    member.isSilent);\n\n                // we are reporting the status with the join\n                // so we do not want a second event about status update\n                hasStatusUpdate = false;\n            }\n        } else {\n            // Presence update for existing participant\n            // Watch role change:\n            const memberOfThis = this.members[from];\n\n            if (memberOfThis.role !== member.role) {\n                memberOfThis.role = member.role;\n                this.eventEmitter.emit(\n                    XMPPEvents.MUC_ROLE_CHANGED, from, member.role);\n            }\n\n            // affiliation changed\n            if (memberOfThis.affiliation !== member.affiliation) {\n                memberOfThis.affiliation = member.affiliation;\n            }\n\n            // fire event that botType had changed\n            if (memberOfThis.botType !== member.botType) {\n                memberOfThis.botType = member.botType;\n                this.eventEmitter.emit(\n                    XMPPEvents.MUC_MEMBER_BOT_TYPE_CHANGED,\n                    from,\n                    member.botType);\n            }\n\n            if (member.isFocus) {\n                // From time to time first few presences of the focus are not\n                // containing it's jid. That way we can mark later the focus\n                // member instead of not marking it at all and not starting the\n                // conference.\n                // FIXME: Maybe there is a better way to handle this issue. It\n                // seems there is some period of time in prosody that the\n                // configuration form is received but not applied. And if any\n                // participant joins during that period of time the first\n                // presence from the focus won't contain\n                // <item jid=\"focus...\" />.\n                // By default we are disabling the waiting for form submission in order to use the room\n                // and we had enabled by default that jids are public in the room ,\n                // so this case should not happen, if public jid is turned off we will receive the jid\n                // when we become moderator in the room\n                memberOfThis.isFocus = true;\n                this._initFocus(from, member.features);\n            }\n\n            // store the new display name\n            if (member.displayName) {\n                memberOfThis.displayName = member.displayName;\n            }\n\n            // join without audio\n            if (member.isSilent) {\n                memberOfThis.isSilent = member.isSilent;\n            }\n\n            // update stored status message to be able to detect changes\n            if (memberOfThis.status !== member.status) {\n                hasStatusUpdate = true;\n                memberOfThis.status = member.status;\n            }\n\n            if (memberOfThis.version !== member.version) {\n                hasVersionUpdate = true;\n                memberOfThis.version = member.version;\n            }\n\n            if (!isEqual(memberOfThis.features, member.features)) {\n                memberOfThis.features = member.features;\n                this.eventEmitter.emit(XMPPEvents.PARTICIPANT_FEATURES_CHANGED, from, member.features);\n            }\n        }\n\n        const participantProperties = new Map();\n\n        // after we had fired member or room joined events, lets fire events\n        // for the rest info we got in presence\n        for (let i = 0; i < nodes.length; i++) {\n            const node = nodes[i];\n\n            switch (node.tagName) {\n            case 'nick':\n                if (!member.isFocus) {\n                    const displayName\n                    // @ts-ignore will fix after xmpp PR merge\n                        = this.xmpp.options.displayJids\n                            ? Strophe.getResourceFromJid(from)\n                            : member.nick;\n\n                    this.eventEmitter.emit(\n                        XMPPEvents.DISPLAY_NAME_CHANGED,\n                        from,\n                        displayName);\n                }\n                break;\n            case 'silent':\n                this.eventEmitter.emit(\n                    XMPPEvents.SILENT_STATUS_CHANGED,\n                    from,\n                    member.isSilent);\n                break;\n            case 'bridgeNotAvailable':\n                if (member.isFocus && !this.noBridgeAvailable) {\n                    this.noBridgeAvailable = true;\n                    this.eventEmitter.emit(XMPPEvents.BRIDGE_DOWN);\n                }\n                break;\n            case 'conference-properties':\n                if (member.isFocus) {\n                    const properties = {};\n\n                    for (let j = 0; j < node.children.length; j++) {\n                        const { attributes } = node.children[j];\n\n                        if (attributes?.key) {\n                            properties[attributes.key] = attributes.value;\n                        }\n                    }\n\n                    this.eventEmitter.emit(XMPPEvents.CONFERENCE_PROPERTIES_CHANGED, properties);\n                }\n                break;\n            case 'transcription-status': {\n                const { attributes } = node;\n\n                if (!attributes) {\n                    break;\n                }\n\n                const { status } = attributes;\n\n                if (status && status !== this.transcriptionStatus\n                    && member.isHiddenDomain && member.features.has(FEATURE_TRANSCRIBER)) {\n                    this.transcriptionStatus = status;\n                    this.eventEmitter.emit(\n                        XMPPEvents.TRANSCRIPTION_STATUS_CHANGED,\n                        status,\n                        Strophe.getResourceFromJid(from)\n                    );\n                }\n\n                break;\n            }\n            case 'call-control': {\n                const att = node.attributes;\n\n                if (!att) {\n                    break;\n                }\n                this.phoneNumber = att.phone || null;\n                this.phonePin = att.pin || null;\n                this.eventEmitter.emit(XMPPEvents.PHONE_NUMBER_CHANGED);\n                break;\n            }\n            default: {\n                if (node.tagName.startsWith('jitsi_participant_')) {\n                    participantProperties\n                        .set(node.tagName.substring('jitsi_participant_'.length), node.value);\n                } else {\n                    this._processNode(node, from);\n                }\n            }\n            }\n        }\n\n        // All participant properties are in `participantProperties`, call the event handlers now.\n        const participantId = Strophe.getResourceFromJid(from);\n\n        for (const [ key, value ] of participantProperties) {\n            this.participantPropertyListener(participantId, key, value);\n        }\n\n        // Trigger status message update if necessary\n        if (hasStatusUpdate) {\n            this.eventEmitter.emit(\n                XMPPEvents.PRESENCE_STATUS,\n                from,\n                member.status);\n        }\n\n        if (hasVersionUpdate) {\n            logger.info(`Received version for ${jid}: ${member.version}`);\n        }\n    }\n\n    /**\n     * Sets the special listener to be used for \"command\"s whose name starts\n     * with \"jitsi_participant_\".\n     */\n    public setParticipantPropertyListener(listener: ParticipantPropertyListener): void {\n        this.participantPropertyListener = listener;\n    }\n\n    /**\n     * Send text message to the other participants in the conference\n     * @param message\n     * @param elementName\n     * @param replyToId\n     */\n    public sendMessage(message: string, elementName: string, replyToId?: string): void {\n        const msg = $msg({\n            to: this.roomjid,\n            type: 'groupchat'\n        });\n\n        // We are adding the message in a packet extension. If this element\n        // is different from 'body', we add a custom namespace.\n        // e.g. for 'json-message' extension of message stanza.\n        if (elementName === 'body') {\n            msg.c(elementName, {}, message);\n        } else {\n            msg.c(elementName, { xmlns: 'http://jitsi.org/jitmeet' }, message);\n        }\n\n        if (replyToId) {\n            msg.up().c('reply', { to: replyToId });\n        }\n\n        this.connection.send(msg);\n        this.eventEmitter.emit(XMPPEvents.SENDING_CHAT_MESSAGE, message);\n    }\n\n    /**\n     * Sends a reaction message to the other participants in the conference.\n     * @param {string} reaction - The reaction being sent.\n     * @param {string} messageId - The id of the message being sent.\n     * @param {string} receiverId - The receiver of the message if it is private.\n     */\n    public sendReaction(reaction: string, messageId: string, receiverId?: string): void {\n        const m = reaction.match(EMOJI_REGEX);\n\n        if (!m?.[0]) {\n            throw new Error(`Invalid reaction: ${reaction}`);\n        }\n\n        // Adds the 'to' attribute depending on if the message is private or not.\n        const msg = receiverId ? $msg({ to: `${this.roomjid}/${receiverId}`,\n            type: 'chat' }) : $msg({ to: this.roomjid,\n            type: 'groupchat' });\n\n        msg.c('reactions', { id: messageId,\n            xmlns: 'urn:xmpp:reactions:0' })\n            .c('reaction', {}, m[0])\n            .up().c('store', { xmlns: 'urn:xmpp:hints' });\n\n        this.connection.send(msg);\n    }\n\n    /* eslint-disable max-params */\n    /**\n     * Send private text message to another participant of the conference\n     * @param id id/muc resource of the receiver\n     * @param message\n     * @param elementName\n     * @param useDirectJid\n     * @param replyToId\n     */\n    public sendPrivateMessage(id: string, message: string, elementName: string, useDirectJid: boolean = false, replyToId?: string): void {\n        const targetJid = useDirectJid ? id : `${this.roomjid}/${id}`;\n        const msg = $msg({ to: targetJid,\n            type: 'chat' });\n\n        // We are adding the message in packet. If this element is different\n        // from 'body', we add our custom namespace for the same.\n        // e.g. for 'json-message' message extension.\n        if (elementName === 'body') {\n            msg.c(elementName, message).up();\n        } else {\n            msg.c(elementName, { xmlns: 'http://jitsi.org/jitmeet' }, message)\n                .up();\n        }\n\n        if (replyToId) {\n            msg.c('reply', { to: replyToId });\n        }\n\n        this.connection.send(msg);\n        this.eventEmitter.emit(\n            XMPPEvents.SENDING_PRIVATE_CHAT_MESSAGE, message);\n    }\n    /* eslint-enable max-params */\n\n    /**\n     *\n     * @param subject\n     */\n    public setSubject(subject: string): void {\n        const valueToProcess = subject ? subject.trim() : subject;\n\n        if (valueToProcess === this.subject) {\n            // subject already set to the new value\n            return;\n        }\n\n        const msg = $msg({ to: this.roomjid,\n            type: 'groupchat' });\n\n        msg.c('subject', valueToProcess);\n        this.connection.send(msg);\n    }\n\n    /**\n     *\n     * @param pres\n     * @param from\n     * @internal\n     */\n    onPresenceUnavailable(pres: Element, from: string): boolean {\n        // ignore presence\n        // Use *|xmlns to match xmlns attributes across any namespace (CSS Selectors Level 3)\n        if (exists(pres, ':scope>ignore[*|xmlns=\"http://jitsi.org/jitmeet/\"]')) {\n            return true;\n        }\n\n        // room destroyed ?\n        // Use *|xmlns to match xmlns attributes across any namespace (CSS Selectors Level 3)\n        const destroySelect = findFirst(pres, ':scope>x[*|xmlns=\"http://jabber.org/protocol/muc#user\"]>destroy');\n\n        if (destroySelect) {\n            let reason;\n            const reasonSelect = findFirst(pres, ':scope>x[*|xmlns=\"http://jabber.org/protocol/muc#user\"]>destroy>reason');\n\n            if (reasonSelect) {\n                reason = getText(reasonSelect);\n            }\n\n            this.eventEmitter.emit(XMPPEvents.MUC_DESTROYED, reason, getAttribute(destroySelect, 'jid'));\n            this.connection.emuc.doLeave(this.roomjid);\n\n            return true;\n        }\n\n        // Status code 110 indicates that this notification is \"self-presence\".\n        const isSelfPresence = exists(pres, ':scope>x[*|xmlns=\"http://jabber.org/protocol/muc#user\"]>status[code=\"110\"]');\n        const isKick = exists(pres, ':scope>x[*|xmlns=\"http://jabber.org/protocol/muc#user\"]>status[code=\"307\"]');\n        const membersKeys = Object.keys(this.members);\n        const isReplaceParticipant = exists(pres, 'flip_device');\n\n        if (isKick) {\n            const actorSelect = findFirst(pres, ':scope>x[*|xmlns=\"http://jabber.org/protocol/muc#user\"]>item>actor');\n            let actorNick;\n\n            if (actorSelect) {\n                actorNick = getAttribute(actorSelect, 'nick');\n            }\n\n            let reason;\n            const reasonSelect = findFirst(pres, ':scope>x[*|xmlns=\"http://jabber.org/protocol/muc#user\"]>item>reason');\n\n            if (reasonSelect) {\n                reason = getText(reasonSelect);\n            }\n\n            logger.info(`Kicked by ${from}`);\n\n            // we first fire the kicked so we can show the participant\n            // who kicked, before notifying that participant left\n            // we fire kicked for us and for any participant kicked\n            this.eventEmitter.emit(\n                XMPPEvents.KICKED,\n                isSelfPresence,\n                actorNick,\n                Strophe.getResourceFromJid(from),\n                reason,\n                isReplaceParticipant);\n        }\n\n        if (isSelfPresence) {\n            // If the status code is 110 this means we're leaving and we would\n            // like to remove everyone else from our view, so we trigger the\n            // event.\n            membersKeys.forEach(jid => {\n                const member = this.members[jid];\n\n                delete this.members[jid];\n                delete this.lastPresences[jid];\n                if (!member.isFocus) {\n                    this.eventEmitter.emit(XMPPEvents.MUC_MEMBER_LEFT, jid);\n                }\n            });\n            this.connection.emuc.doLeave(this.roomjid);\n\n            // we fire muc_left only if this is not a kick,\n            // kick has both statuses 110 and 307.\n            if (!isKick) {\n                this.eventEmitter.emit(XMPPEvents.MUC_LEFT);\n            }\n        } else {\n            const reasonSelect = findFirst(pres, ':scope>status');\n            const member = this.members[from];\n            let reason;\n\n            if (reasonSelect) {\n                reason = getText(reasonSelect);\n            }\n\n            delete this.members[from];\n            delete this.lastPresences[from];\n\n            // In this case we *do* fire MUC_MEMBER_LEFT for the focus?\n            this.eventEmitter.emit(XMPPEvents.MUC_MEMBER_LEFT, from, reason);\n\n            if (member && member.isHiddenDomain && member.features.has(FEATURE_TRANSCRIBER)\n                && this.transcriptionStatus !== JitsiTranscriptionStatus.OFF) {\n                this.transcriptionStatus = JitsiTranscriptionStatus.OFF;\n                this.eventEmitter.emit(\n                    XMPPEvents.TRANSCRIPTION_STATUS_CHANGED,\n                    this.transcriptionStatus,\n                    Strophe.getResourceFromJid(from),\n                    true /* exited abruptly */\n                );\n            }\n\n            if (member?.isFocus) {\n                logger.info('Focus has left the room - leaving conference');\n                this.eventEmitter.emit(XMPPEvents.FOCUS_LEFT);\n            }\n        }\n    }\n\n    /**\n     *\n     * @param msg\n     * @param from\n     * @internal\n     */\n    onMessage(msg: Element, from: string): boolean {\n        const type = msg.getAttribute('type');\n\n        if (type === 'error') {\n            const settingsErrorEl = findAll(msg, ':scope>settings-error>text');\n            const settingsErrorMsg = settingsErrorEl.length ? getText(settingsErrorEl[0]) : '';\n\n            if (settingsErrorMsg.length) {\n                this.eventEmitter.emit(XMPPEvents.SETTINGS_ERROR_RECEIVED, settingsErrorMsg);\n\n                return true;\n            }\n            const errorEl = findAll(msg, ':scope>error>text');\n            const errorMsg = errorEl.length ? getText(errorEl[0]) : '';\n\n            this.eventEmitter.emit(XMPPEvents.CHAT_ERROR_RECEIVED, errorMsg);\n\n            return true;\n        }\n\n        const reactions = findAll(msg, ':scope>[*|xmlns=\"urn:xmpp:reactions:0\"]>reaction');\n\n        if (reactions.length > 0) {\n            const messageId = getAttribute(findFirst(msg, ':scope>[*|xmlns=\"urn:xmpp:reactions:0\"]'), 'id');\n            const reactionList = [];\n\n            reactions.forEach(reactionElem => {\n                const reaction = getText(reactionElem);\n                const m = reaction.match(EMOJI_REGEX);\n\n                // Only allow one reaction per <reaction> element.\n                if (m?.[0]) {\n                    reactionList.push(m[0]);\n                }\n            });\n\n            if (reactionList.length > 0) {\n                this.eventEmitter.emit(XMPPEvents.REACTION_RECEIVED, from, reactionList, messageId);\n            }\n\n            return true;\n        }\n\n\n        const bodyEl = findFirst(msg, ':scope>body');\n        const txt = bodyEl ? getText(bodyEl) : '';\n        const subject = findFirst(msg, ':scope>subject');\n\n        if (subject) {\n            const subjectText = getText(subject);\n\n            if (subjectText || subjectText === '') {\n                this.subject = subjectText.trim();\n                this.eventEmitter.emit(XMPPEvents.SUBJECT_CHANGED, subjectText);\n                logger.info(`Subject is changed to ${subjectText}`);\n            }\n        }\n\n        // xep-0203 delay\n        const delayEl = findFirst(msg, ':scope>delay');\n        let stamp = getAttribute(delayEl, 'stamp');\n\n        if (!stamp) {\n            // or xep-0091 delay, UTC timestamp\n            // Use *|xmlns to match xmlns attributes across any namespace (CSS Selectors Level 3)\n            stamp = getAttribute(findFirst(msg, ':scope>[*|xmlns=\"jabber:x:delay\"]'), 'stamp');\n\n            if (stamp) {\n                // the format is CCYYMMDDThh:mm:ss\n                const dateParts\n                    = stamp.match(/(\\d{4})(\\d{2})(\\d{2}T\\d{2}:\\d{2}:\\d{2})/);\n\n                stamp = `${dateParts[1]}-${dateParts[2]}-${dateParts[3]}Z`;\n            }\n        }\n\n        if (from === this.roomjid) {\n            let invite;\n\n            // Use *|xmlns to match xmlns attributes across any namespace (CSS Selectors Level 3)\n            if (exists(msg, ':scope>x[*|xmlns=\"http://jabber.org/protocol/muc#user\"]>status[code=\"104\"]')) {\n                this.discoRoomInfo();\n            } else if (invite = findFirst(msg, ':scope>x[*|xmlns=\"http://jabber.org/protocol/muc#user\"]>invite')) {\n                const passwordSelect = findFirst(msg, ':scope>x[*|xmlns=\"http://jabber.org/protocol/muc#user\"]>password');\n                let password;\n\n                if (passwordSelect) {\n                    password = getText(passwordSelect);\n                }\n\n                this.eventEmitter.emit(XMPPEvents.INVITE_MESSAGE_RECEIVED,\n                    from, getAttribute(invite, 'from'), txt, password);\n            }\n        }\n\n        // Use *|xmlns to match xmlns attributes across any namespace (CSS Selectors Level 3)\n        const jsonMessage = getText(findFirst(msg, ':scope>json-message[*|xmlns=\"http://jitsi.org/jitmeet\"]'));\n\n        if (jsonMessage) {\n            const parsedJson = this.xmpp.tryParseJSONAndVerify(jsonMessage);\n\n            // We emit this event if the message is a valid json, and is not\n            // delivered after a delay, i.e. stamp is null.\n            // e.g. - subtitles should not be displayed if delayed.\n            if (parsedJson && stamp === null) {\n                this.eventEmitter.emit(XMPPEvents.JSON_MESSAGE_RECEIVED,\n                    from, parsedJson);\n\n                return;\n            }\n        }\n\n        if (txt) {\n            const messageId = getAttribute(msg, 'id') || uuidv4();\n            const replyToId = this._parseReplyMessage(msg);\n            const displayNameEl = findFirst(msg, ':scope>display-name[*|xmlns=\"http://jitsi.org/protocol/display-name\"]');\n            const isVisitorMessage = getAttribute(displayNameEl, 'source') === 'visitor';\n\n            if (type === 'chat') {\n                let displayName;\n                let originalFrom;\n\n                if (isVisitorMessage) {\n                    displayName = getText(displayNameEl);\n\n                    // Check for original visitor JID in addresses element (XEP-0033)\n                    const addressesEl = findFirst(msg, ':scope>addresses[*|xmlns=\"http://jabber.org/protocol/address\"]');\n\n                    if (addressesEl) {\n                        const ofromEl = findFirst(addressesEl, 'address[type=\"ofrom\"]');\n\n                        if (ofromEl) {\n                            originalFrom = getAttribute(ofromEl, 'jid');\n                        }\n                    }\n                }\n\n                this.eventEmitter.emit(XMPPEvents.PRIVATE_MESSAGE_RECEIVED,\n                        from, txt, this.myroomjid, stamp, messageId, displayName, isVisitorMessage, originalFrom, replyToId);\n            } else if (type === 'groupchat') {\n                const displayName = displayNameEl ? getText(displayNameEl) : undefined;\n                let sourceAttrValue = getAttribute(displayNameEl, 'source');\n\n                if (sourceAttrValue === null) {\n                    // When displayNameEl[0] doesn't exist or there is no source attribute getAttribute returns null.\n                    // Lets unify the reported values and use undefined instead.\n                    sourceAttrValue = undefined;\n                }\n                const source = isVisitorMessage ? undefined : sourceAttrValue;\n\n                // we will fire explicitly that this is a visitor(isVisitor:true) to the conference\n                // a message with explicit name set\n                this.eventEmitter.emit(XMPPEvents.MESSAGE_RECEIVED,\n                    from, txt, this.myroomjid, stamp, displayName, isVisitorMessage, messageId, source, replyToId);\n            }\n        }\n    }\n\n    /**\n     *\n     * @param pres\n     * @param from\n     * @internal\n     */\n    onPresenceError(pres: Element, from: string): void {\n        let errorDescriptionNode;\n\n        if (from === this.myroomjid) {\n            // we have tried to join, and we received an error, let's send again conference-iq on next attempt\n            // as it may turn out that jicofo left the room if we were the first to try,\n            // and the user delayed the attempt for entering the password or such\n            this.xmpp.moderator.conferenceRequestSent = false;\n        }\n\n        // Use *|xmlns to match xmlns attributes across any namespace (CSS Selectors Level 3)\n        if (exists(pres, ':scope>error[type=\"auth\"]>not-authorized[*|xmlns=\"urn:ietf:params:xml:ns:xmpp-stanzas\"]')) {\n            logger.debug('on password required', from);\n            this.eventEmitter.emit(XMPPEvents.PASSWORD_REQUIRED);\n        } else if (exists(pres,\n            ':scope>error[type=\"cancel\"]>not-allowed[*|xmlns=\"urn:ietf:params:xml:ns:xmpp-stanzas\"]')) {\n            const toDomain = Strophe.getDomainFromJid(pres.getAttribute('to'));\n\n            // @ts-ignore will fix after xmpp PR merge\n            if (toDomain === this.xmpp.options.hosts.anonymousdomain) {\n                // enter the room by replying with 'not-authorized'. This would\n                // result in reconnection from authorized domain.\n                // We're either missing Jicofo/Prosody config for anonymous\n                // domains or something is wrong.\n                this.eventEmitter.emit(XMPPEvents.ROOM_JOIN_ERROR);\n\n            } else {\n                logger.warn('onPresError ', pres);\n\n                const txtNode = findFirst(pres,\n                    ':scope>error[type=\"cancel\"]>text[*|xmlns=\"urn:ietf:params:xml:ns:xmpp-stanzas\"]');\n                const txt = getText(txtNode);\n                let type = AUTH_ERROR_TYPES.GENERAL;\n\n                // a race where we have sent a conference request to jicofo and jicofo was about to leave or just left\n                // because of no participants in the room, and we tried to create the room, without having\n                // permissions for that (only jicofo creates rooms)\n                if (txt === 'Room creation is restricted') {\n                    type = AUTH_ERROR_TYPES.ROOM_CREATION_RESTRICTION;\n\n                    if (!this.options.disableRoomCreationRetry) {\n                        if (!this._roomCreationRetries) {\n                            this._roomCreationRetries = 0;\n                        }\n                        this._roomCreationRetries++;\n\n                        if (this._roomCreationRetries <= 3) {\n                            const retryDelay = getJitterDelay(\n                                /* retry */ this._roomCreationRetries,\n                                /* minDelay */ 500,\n                                1.5);\n\n                            // let's retry inviting jicofo and joining the room, retries will take between 1 and 3 seconds\n                            setTimeout(() => this.join(this.password, this.replaceParticipant), retryDelay);\n\n                            return;\n                        }\n                    }\n                } else if (exists(pres,\n                    ':scope>error[type=\"cancel\"]>authentication-required[*|xmlns=\"http://jitsi.org/jitmeet\"]')) {\n                    type = AUTH_ERROR_TYPES.ROOM_UNAUTHENTICATED_ACCESS_DISABLED;\n                } else if (exists(pres,\n                    ':scope>error[type=\"cancel\"]>no-main-participants[*|xmlns=\"jitsi:visitors\"]')) {\n                    type = AUTH_ERROR_TYPES.NO_MAIN_PARTICIPANTS;\n                } else if (exists(pres,\n                    ':scope>error[type=\"cancel\"]>promotion-not-allowed[*|xmlns=\"jitsi:visitors\"]')) {\n                    type = AUTH_ERROR_TYPES.PROMOTION_NOT_ALLOWED;\n                } else if (exists(pres,\n                    ':scope>error[type=\"cancel\"]>no-visitors-lobby[*|xmlns=\"jitsi:visitors\"]')) {\n                    type = AUTH_ERROR_TYPES.NO_VISITORS_LOBBY;\n                }\n\n                this.eventEmitter.emit(XMPPEvents.ROOM_CONNECT_NOT_ALLOWED_ERROR, type, txt);\n            }\n        } else if (exists(pres, ':scope>error>service-unavailable')) {\n            logger.warn('Maximum users limit for the room has been reached',\n                pres);\n            this.eventEmitter.emit(XMPPEvents.ROOM_MAX_USERS_ERROR, {\n                visitorsSupported: this.xmpp.moderator.visitorsSupported\n            });\n        } else if (exists(pres,\n            ':scope>error[type=\"auth\"]>registration-required[*|xmlns=\"urn:ietf:params:xml:ns:xmpp-stanzas\"]')) {\n\n            // let's extract the lobby jid from the custom field\n            const lobbyRoomNode = findFirst(pres, ':scope>error[type=\"auth\"]>lobbyroom');\n            let lobbyRoomJid;\n\n            if (lobbyRoomNode) {\n                lobbyRoomJid = getText(lobbyRoomNode);\n            }\n\n            const waitingForHost = exists(pres, ':scope>error[type=\"auth\"]>waiting-for-host');\n\n            this.eventEmitter.emit(XMPPEvents.ROOM_CONNECT_MEMBERS_ONLY_ERROR, lobbyRoomJid, waitingForHost);\n        } else if (errorDescriptionNode = findFirst(pres,\n            ':scope>error[type=\"modify\"]>displayname-required[*|xmlns=\"http://jitsi.org/jitmeet\"]')) {\n            logger.warn('display name required ', pres);\n            this.eventEmitter.emit(XMPPEvents.DISPLAY_NAME_REQUIRED, getAttribute(errorDescriptionNode, 'lobby'));\n        } else {\n            logger.warn('onPresError ', pres);\n            this.eventEmitter.emit(XMPPEvents.ROOM_CONNECT_ERROR);\n        }\n    }\n\n    /**\n     *\n     * @param jid\n     * @param affiliation\n     */\n    public setAffiliation(jid: string, affiliation: string): void {\n        const grantIQ = $iq({\n            to: this.roomjid,\n            type: 'set'\n        })\n        .c('query', { xmlns: 'http://jabber.org/protocol/muc#admin' })\n        .c('item', {\n            affiliation,\n            jid: Strophe.getBareJidFromJid(jid)\n        })\n        .c('reason').t(`Your affiliation has been changed to '${affiliation}'.`)\n        .up().up().up();\n\n        this.connection.sendIQ(\n            grantIQ,\n            result => logger.info('Set affiliation of participant with jid: ', jid, 'to', affiliation, result),\n            error => {\n                handleStropheError(error, {\n                    affiliation,\n                    operation: 'set affiliation of participant',\n                    participantJid: jid,\n                    roomJid: this.roomjid,\n                    userJid: this.connection.jid\n                });\n            });\n    }\n\n    /**\n     *\n     * @param jid\n     * @param reason\n     */\n    public kick(jid: string, reason: string = 'You have been kicked.'): void {\n        const kickIQ = $iq({ to: this.roomjid,\n            type: 'set' })\n            .c('query', { xmlns: 'http://jabber.org/protocol/muc#admin' })\n            .c('item', { nick: Strophe.getResourceFromJid(jid),\n                role: 'none' })\n            .c('reason').t(reason).up().up().up();\n\n        this.connection.sendIQ(\n            kickIQ,\n            result => logger.info('Kick participant with jid: ', jid, result),\n            error => {\n                handleStropheError(error, {\n                    operation: 'kick participant',\n                    participantJid: jid,\n                    reason,\n                    roomJid: this.roomjid,\n                    userJid: this.connection.jid\n                });\n            }, undefined);\n    }\n\n    /* eslint-disable max-params */\n\n    /**\n     *\n     * @param key\n     * @param onSuccess\n     * @param onError\n     * @param onNotSupported\n     */\n    public lockRoom(key: Nullable<string>, onSuccess: SuccessCallback, onError: ErrorCallback, onNotSupported: () => void): void {\n        // http://xmpp.org/extensions/xep-0045.html#roomconfig\n        this.connection.sendIQ(\n            $iq({\n                to: this.roomjid,\n                type: 'get'\n            })\n                .c('query', { xmlns: 'http://jabber.org/protocol/muc#owner' }),\n            res => {\n                // Use *|xmlns to match xmlns attributes across any namespace (CSS Selectors Level 3)\n                if (exists(res,\n                    ':scope>query>x[*|xmlns=\"jabber:x:data\"]>field[var=\"muc#roomconfig_roomsecret\"]')) {\n                    const formsubmit\n                        = $iq({\n                            to: this.roomjid,\n                            type: 'set'\n                        })\n                            .c('query', {\n                                xmlns: 'http://jabber.org/protocol/muc#owner'\n                            });\n\n                    formsubmit.c('x', {\n                        type: 'submit',\n                        xmlns: 'jabber:x:data'\n                    });\n                    formsubmit\n                        .c('field', { 'var': 'FORM_TYPE' })\n                        .c('value')\n                        .t('http://jabber.org/protocol/muc#roomconfig')\n                        .up()\n                        .up();\n                    formsubmit\n                        .c('field', { 'var': 'muc#roomconfig_roomsecret' })\n                        .c('value')\n                        .t(key)\n                        .up()\n                        .up();\n                    formsubmit\n                        .c('field',\n                             { 'var': 'muc#roomconfig_passwordprotectedroom' })\n                        .c('value')\n                        .t(key === null || key.length === 0 ? '0' : '1')\n                        .up()\n                        .up();\n\n                    // if members only enabled\n                    if (this.membersOnlyEnabled) {\n                        formsubmit\n                            .c('field', { 'var': 'muc#roomconfig_membersonly' })\n                            .c('value')\n                            .t('true')\n                            .up()\n                            .up();\n                    }\n\n                    // Fixes a bug in prosody 0.9.+\n                    // https://prosody.im/issues/issue/373\n                    formsubmit\n                        .c('field', { 'var': 'muc#roomconfig_whois' })\n                        .c('value')\n                        .t('anyone')\n                        .up()\n                        .up();\n\n                    this.connection.sendIQ(\n                        formsubmit,\n                        () => {\n\n                            // we set the password in chat room so we can use it\n                            // later when dialing out\n                            this.password = key;\n                            onSuccess();\n                        },\n                        error => {\n                            handleStropheError(error, {\n                                operation: 'lock room (submit form)',\n                                roomJid: this.roomjid,\n                                userJid: this.connection.jid\n                            });\n                            onError(error);\n                        });\n                } else {\n                    onNotSupported();\n                }\n            },\n            error => {\n                handleStropheError(error, {\n                    operation: 'lock room (get configuration)',\n                    roomJid: this.roomjid,\n                    userJid: this.connection.jid\n                });\n                onError(error);\n            });\n    }\n\n    /* eslint-enable max-params */\n\n    /**\n     * Turns off or on the members only config for the main room.\n     *\n     * @param {boolean} enabled - Whether to turn it on or off.\n     * @param onSuccess - optional callback.\n     * @param onError - optional callback.\n     */\n    public setMembersOnly(enabled: boolean, onSuccess: SuccessCallback, onError: ErrorCallback): void {\n        if (enabled && Object.values(this.members).filter(m => !m.isFocus).length) {\n            // first grant membership to all that are in the room\n            const affiliationsIq = $iq({\n                to: this.roomjid,\n                type: 'set' })\n                .c('query', {\n                    xmlns: 'http://jabber.org/protocol/muc#admin' });\n            let sendIq = false;\n\n            Object.values(this.members).forEach(m => {\n                if (m.jid && !MEMBERS_AFFILIATIONS.includes(m.affiliation)) {\n                    affiliationsIq.c('item', {\n                        'affiliation': 'member',\n                        'jid': Strophe.getBareJidFromJid(m.jid)\n                    }).up();\n                    sendIq = true;\n                }\n            });\n\n            sendIq && this.xmpp.connection.sendIQ(affiliationsIq.up(), undefined, error => {\n                handleStropheError(error, {\n                    operation: 'set members affiliation',\n                    roomJid: this.roomjid,\n                    userJid: this.xmpp.connection.jid\n                });\n            });\n        }\n        // eslint-disable-next-line @typescript-eslint/no-empty-function\n        const errorCallback = onError ? onError : () => {};\n\n        this.xmpp.connection.sendIQ(\n            $iq({\n                to: this.roomjid,\n                type: 'get'\n            }).c('query', { xmlns: 'http://jabber.org/protocol/muc#owner' }),\n            res => {\n                // Use *|xmlns to match xmlns attributes across any namespace (CSS Selectors Level 3)\n                if (exists(res, ':scope>query>x[*|xmlns=\"jabber:x:data\"]>field[var=\"muc#roomconfig_membersonly\"]')) {\n                    const formToSubmit\n                        = $iq({\n                            to: this.roomjid,\n                            type: 'set'\n                        }).c('query', { xmlns: 'http://jabber.org/protocol/muc#owner' });\n\n                    formToSubmit.c('x', {\n                        type: 'submit',\n                        xmlns: 'jabber:x:data'\n                    });\n                    formToSubmit\n                        .c('field', { 'var': 'FORM_TYPE' })\n                        .c('value')\n                        .t('http://jabber.org/protocol/muc#roomconfig')\n                        .up()\n                        .up();\n                    formToSubmit\n                        .c('field', { 'var': 'muc#roomconfig_membersonly' })\n                        .c('value')\n                        .t(enabled ? 'true' : 'false')\n                        .up()\n                        .up();\n\n                    // if room is locked from other participant or we are locking it\n                    if (this.locked) {\n                        formToSubmit\n                            .c('field',\n                                { 'var': 'muc#roomconfig_passwordprotectedroom' })\n                            .c('value')\n                            .t('1')\n                            .up()\n                            .up();\n                    }\n\n                    this.xmpp.connection.sendIQ(formToSubmit, onSuccess, error => {\n                        handleStropheError(error, {\n                            enabled,\n                            operation: 'set members only (submit form)',\n                            roomJid: this.roomjid,\n                            userJid: this.xmpp.connection.jid\n                        });\n                        errorCallback(error);\n                    });\n                } else {\n                    errorCallback(new Error('Setting members only room not supported!'));\n                }\n            },\n            error => {\n                handleStropheError(error, {\n                    enabled,\n                    operation: 'set members only (get configuration)',\n                    roomJid: this.roomjid,\n                    userJid: this.xmpp.connection.jid\n                });\n                errorCallback(error);\n            });\n    }\n\n\n    /**\n     * Adds the key to the presence map, overriding any previous value.\n     * @param key The key to add or replace.\n     * @param values The new values.\n     * @returns {boolean|null} <tt>true</tt> if the operation succeeded or <tt>false</tt> when no add or replace was\n     * performed as the value was already there.\n     * @internal\n     */\n    addOrReplaceInPresence(key: string, values: any): Nullable<boolean> {\n        values.tagName = key;\n\n        const matchingNodes = this.presMap.nodes.filter(node => key === node.tagName);\n\n        // if we have found just one, let's check is it the same\n        if (matchingNodes.length === 1 && isEqual(matchingNodes[0], values)) {\n            return false;\n        }\n\n        this.removeFromPresence(key);\n        this.presMap.nodes.push(values);\n        this.presenceUpdateTime = Date.now();\n\n        return true;\n    }\n\n    /**\n     * Retrieves a value from the presence map.\n     *\n     * @param {string} key - The key to find the value for.\n     * @returns {Object?}\n     * @internal\n     */\n    getFromPresence(key: string): Optional<IPresenceNode> {\n        return this.presMap.nodes.find(node => key === node.tagName);\n    }\n\n    /**\n     * Removes a key from the presence map.\n     * @param key\n     * @internal\n     */\n    removeFromPresence(key: string): void {\n        const nodes = this.presMap.nodes.filter(node => key !== node.tagName);\n\n        this.presMap.nodes = nodes;\n        this.presenceUpdateTime = Date.now();\n    }\n\n    /**\n     *\n     * @param name\n     * @param handler\n     * @internal\n     */\n    addPresenceListener(name: string, handler: PresenceHandler): void {\n        if (typeof handler !== 'function') {\n            throw new Error('\"handler\" is not a function');\n        }\n        let tagHandlers = this.presHandlers[name];\n\n        if (!tagHandlers) {\n            this.presHandlers[name] = tagHandlers = [];\n        }\n        if (tagHandlers.indexOf(handler) === -1) {\n            tagHandlers.push(handler);\n        } else {\n            logger.warn(\n                `Trying to add the same handler more than once for: ${name}`);\n        }\n    }\n\n    /**\n     *\n     * @param name\n     * @param handler\n     * @internal\n     */\n    removePresenceListener(name: string, handler: PresenceHandler): void {\n        const tagHandlers = this.presHandlers[name];\n        const handlerIdx = tagHandlers ? tagHandlers.indexOf(handler) : -1;\n\n        // eslint-disable-next-line no-negated-condition\n        if (handlerIdx !== -1) {\n            tagHandlers.splice(handlerIdx, 1);\n        } else {\n            logger.warn(`Handler for: ${name} was not registered`);\n        }\n    }\n\n    /**\n     * Checks if the user identified by given <tt>mucJid</tt> is the conference\n     * focus.\n     * @param mucJid the full MUC address of the user to be checked.\n     * @returns {boolean|null} <tt>true</tt> if MUC user is the conference focus\n     * or <tt>false</tt> if is not. When given <tt>mucJid</tt> does not exist in\n     * the MUC then <tt>null</tt> is returned.\n     */\n    public isFocus(mucJid: string): Nullable<boolean> {\n        const member = this.members[mucJid];\n\n        if (member) {\n            return member.isFocus;\n        }\n\n        return null;\n    }\n\n    /**\n     *\n     */\n    public isModerator(): boolean {\n        return this.role === 'moderator';\n    }\n\n    /**\n     * Obtains the info about given media advertised (in legacy format) in the MUC presence of the participant\n     * identified by the given endpoint JID. This is for mantining interop with endpoints that do not support\n     * source-name signaling (Jigasi and very old mobile clients).\n     *\n     * @param {string} endpointId the endpoint ID mapped to the participant which corresponds to MUC nickname.\n     * @param {MediaType} mediaType the type of the media for which presence info will be obtained.\n     * @return {PeerMediaInfo} presenceInfo an object with media presence info or <tt>null</tt> either if there\n     * is no presence available or if the media type given is invalid.\n     */\n    public getMediaPresenceInfo(endpointId: string, mediaType: MediaType): Nullable<IPeerMediaInfo> {\n        // Will figure out current muted status by looking up owner's presence\n        const pres = this.lastPresences[`${this.roomjid}/${endpointId}`];\n\n        if (!pres) {\n            // No presence available\n            return null;\n        }\n        const data: IPeerMediaInfo = {\n            muted: true, // muted by default\n            videoType: mediaType === MediaType.VIDEO ? VideoType.CAMERA : undefined // 'camera' by default\n        };\n        let mutedNode: Nullable<IPresenceNode[]> = null;\n\n        if (mediaType === MediaType.AUDIO) {\n            mutedNode = filterNodeFromPresenceJSON(pres, 'audiomuted');\n        } else if (mediaType === MediaType.VIDEO) {\n            mutedNode = filterNodeFromPresenceJSON(pres, 'videomuted');\n            const codecTypeNode = filterNodeFromPresenceJSON(pres, 'jitsi_participant_codecType');\n            const videoTypeNode = filterNodeFromPresenceJSON(pres, 'videoType');\n\n            if (videoTypeNode.length > 0) {\n                data.videoType = videoTypeNode[0].value;\n            }\n            if (codecTypeNode.length > 0) {\n                data.codecType = codecTypeNode[0].value;\n            }\n        } else {\n            logger.error(`Unsupported media type: ${mediaType}`);\n\n            return null;\n        }\n\n        if (mutedNode.length > 0) {\n            data.muted = mutedNode[0].value === 'true';\n        }\n\n        return data;\n    }\n\n    /**\n     *\n     * @param peerJid\n     */\n    public getMemberRole(peerJid: string): Nullable<string> {\n        if (this.members[peerJid]) {\n            return this.members[peerJid].role;\n        }\n\n        return null;\n    }\n\n    /**\n     * Returns the last presence advertised by a MUC member.\n     * @param {string} mucNick\n     * @returns {*}\n     * @internal\n     */\n    getLastPresence(mucNick: string): Optional<IPresenceNode[]> {\n        return this.lastPresences[`${this.roomjid}/${mucNick}`];\n    }\n\n    /**\n     * Dials a number.\n     * @param number the number\n     */\n    public dial(number: string): Promise<void> {\n        return this.connection.rayo.dial(number, 'fromnumber',\n            Strophe.getBareJidFromJid(this.myroomjid), this.password,\n            this.focusMucJid);\n    }\n\n    /**\n     * Hangup an existing call\n     */\n    public hangup() {\n        return this.connection.rayo.hangup();\n    }\n\n    /**\n     *\n     * @returns {Lobby}\n     */\n    public getLobby(): Optional<Lobby> {\n        return this.lobby;\n    }\n\n    /**\n     * @returns {AVModeration}\n     */\n    public getAVModeration(): AVModeration {\n        return this.avModeration;\n    }\n\n    /**\n     * @returns {BreakoutRooms}\n     */\n    public getBreakoutRooms(): BreakoutRooms {\n        return this.breakoutRooms;\n    }\n\n    /**\n     * @returns {FileSharing}\n     */\n    public getFileSharing(): FileSharing {\n        return this.fileSharing;\n    }\n\n    /**\n     * @returns {RoomMetadata}\n     */\n    public getMetadataHandler(): RoomMetadata {\n        return this.roomMetadata;\n    }\n\n    /**\n     * @returns {Polls}\n     */\n    public getPolls(): Polls {\n        return this.polls;\n    }\n\n    /**\n     * Returns the phone number for joining the conference.\n     */\n    public getPhoneNumber(): Nullable<string> {\n        return this.phoneNumber;\n    }\n\n    /**\n     * Returns the pin for joining the conference with phone.\n     */\n    public getPhonePin(): Nullable<string> {\n        return this.phonePin;\n    }\n\n    /**\n     * Returns the meeting unique ID if any came from backend.\n     *\n     * @returns {string} - The meeting ID.\n     */\n    public getMeetingId(): Optional<string> {\n        return this.meetingId;\n    }\n\n    /**\n     * Mutes remote participant.\n     * @param jid of the participant\n     * @param mute\n     * @param mediaType\n     */\n    public muteParticipant(jid: string, mute: boolean, mediaType: string): void {\n        logger.info('set mute', mute, jid);\n        const iqToFocus = $iq(\n            { to: this.focusMucJid,\n                type: 'set' })\n            .c('mute', {\n                jid,\n                xmlns: `http://jitsi.org/jitmeet/${mediaType}`\n            })\n            .t(mute.toString())\n            .up();\n\n        this.connection.sendIQ(\n            iqToFocus,\n            result => logger.info('set mute', result),\n            error => {\n                handleStropheError(error, {\n                    mediaType,\n                    mute,\n                    operation: 'set mute participant',\n                    participantJid: jid,\n                    roomJid: this.roomjid,\n                    userJid: this.connection.jid\n                });\n            });\n    }\n\n    /**\n     * Handle remote mute reqyest from focus.\n     *\n     * @param iq\n     * @internal\n     */\n    onMute(iq: Element): void {\n        const from = iq.getAttribute('from');\n\n        if (from !== this.focusMucJid) {\n            logger.warn('Ignored mute from non focus peer');\n\n            return;\n        }\n        const mute = findFirst(iq, 'mute');\n\n        if (getText(mute) === 'true') {\n            this.eventEmitter.emit(XMPPEvents.AUDIO_MUTED_BY_FOCUS, getAttribute(mute, 'actor'));\n        } else {\n            // XXX Why do we support anything but muting? Why do we encode the\n            // value in the text of the element? Why do we use a separate XML\n            // namespace?\n            logger.warn('Ignoring a mute request which does not explicitly '\n                + 'specify a positive mute command.');\n        }\n    }\n\n    /**\n     * Handle remote video mute request from focus.\n     *\n     * @param iq\n     * @internal\n     */\n    onMuteVideo(iq: Element): void {\n        const from = iq.getAttribute('from');\n\n        if (from !== this.focusMucJid) {\n            logger.warn('Ignored mute from non focus peer');\n\n            return;\n        }\n        const mute = findFirst(iq, 'mute');\n\n        if (getText(mute) === 'true') {\n            this.eventEmitter.emit(XMPPEvents.VIDEO_MUTED_BY_FOCUS, getAttribute(mute, 'actor'));\n        } else {\n            // XXX Why do we support anything but muting? Why do we encode the\n            // value in the text of the element? Why do we use a separate XML\n            // namespace?\n            logger.warn('Ignoring a mute request which does not explicitly '\n                + 'specify a positive mute command.');\n        }\n    }\n\n    /**\n     * Handle remote desktop sharing mute request from focus.\n     *\n     * @param iq\n     * @internal\n     */\n    onMuteDesktop(iq: Element): void {\n        const from = iq.getAttribute('from');\n\n        if (from !== this.focusMucJid) {\n            logger.warn('Ignored mute from non focus peer');\n\n            return;\n        }\n        const mute = findFirst(iq, 'mute');\n\n        if (getText(mute) === 'true') {\n            this.eventEmitter.emit(XMPPEvents.DESKTOP_MUTED_BY_FOCUS, getAttribute(mute, 'actor'));\n        } else {\n            // XXX Why do we support anything but muting? Why do we encode the\n            // value in the text of the element? Why do we use a separate XML\n            // namespace?\n            logger.warn('Ignoring a mute request which does not explicitly '\n                + 'specify a positive mute command.');\n        }\n    }\n\n    /**\n     * Leaves the room. Closes the jingle session.\n     * @returns {Promise} which is resolved if XMPPEvents.MUC_LEFT is received\n     * less than 5s after sending presence unavailable. Otherwise the promise is\n     * rejected.\n     */\n    public leave(reason?: string): Promise<any> {\n        this.avModeration.dispose();\n        this.breakoutRooms.dispose();\n        this.fileSharing.dispose();\n        this.polls.dispose();\n        this.roomMetadata.dispose();\n\n        const promises = [];\n\n        this.lobby?.lobbyRoom && promises.push(this.lobby.leave());\n\n        promises.push(new Promise((resolve, reject) => {\n            let timeout: number | Timeout = -1;\n\n            const onMucLeft = (doReject = false) => {\n                this.eventEmitter.removeListener(XMPPEvents.MUC_LEFT, onMucLeft);\n                clearTimeout(timeout as number);\n\n                // This will reset the joined flag to false. If we reset it earlier any self presence will be\n                // interpreted as muc join. That's why we reset the flag once we have received presence unavalable\n                // (MUC_LEFT).\n                this.clean();\n\n                if (doReject) {\n                    // The timeout expired. Make sure we clean the EMUC state.\n                    this.connection.emuc.doLeave(this.roomjid);\n                    reject(new Error('The timeout for the confirmation about leaving the room expired.'));\n                } else {\n                    resolve(undefined);\n                }\n            };\n\n            if (this.joined) {\n                timeout = setTimeout(() => onMucLeft(true), 5000);\n                this.eventEmitter.on(XMPPEvents.MUC_LEFT, onMucLeft);\n                this.doLeave(reason);\n            } else {\n                // we are clearing up, and we haven't joined the room\n                // there is no point of sending presence unavailable and check for timeout\n                // let's just clean\n                this.connection.emuc.doLeave(this.roomjid);\n                this.clean();\n                resolve(undefined);\n            }\n        }));\n\n        return Promise.allSettled(promises);\n    }\n\n    /**\n     * Ends the conference for all participants.\n     */\n    public end(): void {\n        if (this.breakoutRooms.isBreakoutRoom()) {\n            logger.warn('Cannot end conference: this is a breakout room.');\n\n            return;\n        }\n\n        // Send the end conference message.\n        const msg = $msg({ to: this.xmpp.endConferenceComponentAddress });\n\n        msg.c('end_conference').up();\n\n        this.xmpp.connection.send(msg);\n    }\n\n    /**\n     * Requests short-lived credentials for a service.\n     * The function does not use anything from the room, but the backend requires the sender\n     * to be in the room as the credentials contain the meeting ID and are valid only for the room.\n     * @param service\n     */\n    public getShortTermCredentials(service: string): Promise<string> {\n        // Gets credentials via xep-0215 and cache it\n        return new Promise((resolve, reject) => {\n            const cachedCredentials = this.cachedShortTermCredentials || {};\n\n            if (cachedCredentials[service]) {\n                resolve(cachedCredentials[service]);\n\n                return;\n            }\n\n            this.connection.sendIQ(\n                $iq({\n                    // @ts-ignore will fix after xmpp PR merge\n                    to: this.xmpp.options.hosts.domain,\n                    type: 'get'\n                })\n                    .c('credentials', { xmlns: 'urn:xmpp:extdisco:2' })\n                    .c('service', {\n                        host: service,\n                        type: 'short-lived-token'\n                    }),\n                res => {\n                    // Use *|xmlns to match xmlns attributes across any namespace (CSS Selectors Level 3)\n                    const resultServiceEl = findFirst(res, ':scope>credentials[*|xmlns=\"urn:xmpp:extdisco:2\"]>service');\n                    const currentDate = new Date();\n                    const expirationDate = new Date(getAttribute(resultServiceEl, 'expires'));\n\n                    cachedCredentials[service] = getAttribute(resultServiceEl, 'password');\n                    this.cachedShortTermCredentials = cachedCredentials;\n\n                    setTimeout(() => {\n                        this.cachedShortTermCredentials[service] = undefined;\n                    }, expirationDate.getTime() - currentDate.getTime() - 10_000);\n\n                    resolve(this.cachedShortTermCredentials[service]);\n                },\n                error => {\n                    handleStropheError(error, {\n                        operation: 'get short term credentials',\n                        roomJid: this.roomjid,\n                        service,\n                        userJid: this.connection.jid\n                    });\n                    reject(error);\n                });\n        });\n    }\n}\n\nexport { ChatRoom };\n\n/* eslint-enable newline-per-chained-call */\n","export default () => {\n\t// https://mths.be/emoji\n\treturn /[#*0-9]\\uFE0F?\\u20E3|[\\xA9\\xAE\\u203C\\u2049\\u2122\\u2139\\u2194-\\u2199\\u21A9\\u21AA\\u231A\\u231B\\u2328\\u23CF\\u23ED-\\u23EF\\u23F1\\u23F2\\u23F8-\\u23FA\\u24C2\\u25AA\\u25AB\\u25B6\\u25C0\\u25FB\\u25FC\\u25FE\\u2600-\\u2604\\u260E\\u2611\\u2614\\u2615\\u2618\\u2620\\u2622\\u2623\\u2626\\u262A\\u262E\\u262F\\u2638-\\u263A\\u2640\\u2642\\u2648-\\u2653\\u265F\\u2660\\u2663\\u2665\\u2666\\u2668\\u267B\\u267E\\u267F\\u2692\\u2694-\\u2697\\u2699\\u269B\\u269C\\u26A0\\u26A7\\u26AA\\u26B0\\u26B1\\u26BD\\u26BE\\u26C4\\u26C8\\u26CF\\u26D1\\u26E9\\u26F0-\\u26F5\\u26F7\\u26F8\\u26FA\\u2702\\u2708\\u2709\\u270F\\u2712\\u2714\\u2716\\u271D\\u2721\\u2733\\u2734\\u2744\\u2747\\u2757\\u2763\\u27A1\\u2934\\u2935\\u2B05-\\u2B07\\u2B1B\\u2B1C\\u2B55\\u3030\\u303D\\u3297\\u3299]\\uFE0F?|[\\u261D\\u270C\\u270D](?:\\uD83C[\\uDFFB-\\uDFFF]|\\uFE0F)?|[\\u270A\\u270B](?:\\uD83C[\\uDFFB-\\uDFFF])?|[\\u23E9-\\u23EC\\u23F0\\u23F3\\u25FD\\u2693\\u26A1\\u26AB\\u26C5\\u26CE\\u26D4\\u26EA\\u26FD\\u2705\\u2728\\u274C\\u274E\\u2753-\\u2755\\u2795-\\u2797\\u27B0\\u27BF\\u2B50]|\\u26D3\\uFE0F?(?:\\u200D\\uD83D\\uDCA5)?|\\u26F9(?:\\uD83C[\\uDFFB-\\uDFFF]|\\uFE0F)?(?:\\u200D[\\u2640\\u2642]\\uFE0F?)?|\\u2764\\uFE0F?(?:\\u200D(?:\\uD83D\\uDD25|\\uD83E\\uDE79))?|\\uD83C(?:[\\uDC04\\uDD70\\uDD71\\uDD7E\\uDD7F\\uDE02\\uDE37\\uDF21\\uDF24-\\uDF2C\\uDF36\\uDF7D\\uDF96\\uDF97\\uDF99-\\uDF9B\\uDF9E\\uDF9F\\uDFCD\\uDFCE\\uDFD4-\\uDFDF\\uDFF5\\uDFF7]\\uFE0F?|[\\uDF85\\uDFC2\\uDFC7](?:\\uD83C[\\uDFFB-\\uDFFF])?|[\\uDFC4\\uDFCA](?:\\uD83C[\\uDFFB-\\uDFFF])?(?:\\u200D[\\u2640\\u2642]\\uFE0F?)?|[\\uDFCB\\uDFCC](?:\\uD83C[\\uDFFB-\\uDFFF]|\\uFE0F)?(?:\\u200D[\\u2640\\u2642]\\uFE0F?)?|[\\uDCCF\\uDD8E\\uDD91-\\uDD9A\\uDE01\\uDE1A\\uDE2F\\uDE32-\\uDE36\\uDE38-\\uDE3A\\uDE50\\uDE51\\uDF00-\\uDF20\\uDF2D-\\uDF35\\uDF37-\\uDF43\\uDF45-\\uDF4A\\uDF4C-\\uDF7C\\uDF7E-\\uDF84\\uDF86-\\uDF93\\uDFA0-\\uDFC1\\uDFC5\\uDFC6\\uDFC8\\uDFC9\\uDFCF-\\uDFD3\\uDFE0-\\uDFF0\\uDFF8-\\uDFFF]|\\uDDE6\\uD83C[\\uDDE8-\\uDDEC\\uDDEE\\uDDF1\\uDDF2\\uDDF4\\uDDF6-\\uDDFA\\uDDFC\\uDDFD\\uDDFF]|\\uDDE7\\uD83C[\\uDDE6\\uDDE7\\uDDE9-\\uDDEF\\uDDF1-\\uDDF4\\uDDF6-\\uDDF9\\uDDFB\\uDDFC\\uDDFE\\uDDFF]|\\uDDE8\\uD83C[\\uDDE6\\uDDE8\\uDDE9\\uDDEB-\\uDDEE\\uDDF0-\\uDDF7\\uDDFA-\\uDDFF]|\\uDDE9\\uD83C[\\uDDEA\\uDDEC\\uDDEF\\uDDF0\\uDDF2\\uDDF4\\uDDFF]|\\uDDEA\\uD83C[\\uDDE6\\uDDE8\\uDDEA\\uDDEC\\uDDED\\uDDF7-\\uDDFA]|\\uDDEB\\uD83C[\\uDDEE-\\uDDF0\\uDDF2\\uDDF4\\uDDF7]|\\uDDEC\\uD83C[\\uDDE6\\uDDE7\\uDDE9-\\uDDEE\\uDDF1-\\uDDF3\\uDDF5-\\uDDFA\\uDDFC\\uDDFE]|\\uDDED\\uD83C[\\uDDF0\\uDDF2\\uDDF3\\uDDF7\\uDDF9\\uDDFA]|\\uDDEE\\uD83C[\\uDDE8-\\uDDEA\\uDDF1-\\uDDF4\\uDDF6-\\uDDF9]|\\uDDEF\\uD83C[\\uDDEA\\uDDF2\\uDDF4\\uDDF5]|\\uDDF0\\uD83C[\\uDDEA\\uDDEC-\\uDDEE\\uDDF2\\uDDF3\\uDDF5\\uDDF7\\uDDFC\\uDDFE\\uDDFF]|\\uDDF1\\uD83C[\\uDDE6-\\uDDE8\\uDDEE\\uDDF0\\uDDF7-\\uDDFB\\uDDFE]|\\uDDF2\\uD83C[\\uDDE6\\uDDE8-\\uDDED\\uDDF0-\\uDDFF]|\\uDDF3\\uD83C[\\uDDE6\\uDDE8\\uDDEA-\\uDDEC\\uDDEE\\uDDF1\\uDDF4\\uDDF5\\uDDF7\\uDDFA\\uDDFF]|\\uDDF4\\uD83C\\uDDF2|\\uDDF5\\uD83C[\\uDDE6\\uDDEA-\\uDDED\\uDDF0-\\uDDF3\\uDDF7-\\uDDF9\\uDDFC\\uDDFE]|\\uDDF6\\uD83C\\uDDE6|\\uDDF7\\uD83C[\\uDDEA\\uDDF4\\uDDF8\\uDDFA\\uDDFC]|\\uDDF8\\uD83C[\\uDDE6-\\uDDEA\\uDDEC-\\uDDF4\\uDDF7-\\uDDF9\\uDDFB\\uDDFD-\\uDDFF]|\\uDDF9\\uD83C[\\uDDE6\\uDDE8\\uDDE9\\uDDEB-\\uDDED\\uDDEF-\\uDDF4\\uDDF7\\uDDF9\\uDDFB\\uDDFC\\uDDFF]|\\uDDFA\\uD83C[\\uDDE6\\uDDEC\\uDDF2\\uDDF3\\uDDF8\\uDDFE\\uDDFF]|\\uDDFB\\uD83C[\\uDDE6\\uDDE8\\uDDEA\\uDDEC\\uDDEE\\uDDF3\\uDDFA]|\\uDDFC\\uD83C[\\uDDEB\\uDDF8]|\\uDDFD\\uD83C\\uDDF0|\\uDDFE\\uD83C[\\uDDEA\\uDDF9]|\\uDDFF\\uD83C[\\uDDE6\\uDDF2\\uDDFC]|\\uDF44(?:\\u200D\\uD83D\\uDFEB)?|\\uDF4B(?:\\u200D\\uD83D\\uDFE9)?|\\uDFC3(?:\\uD83C[\\uDFFB-\\uDFFF])?(?:\\u200D(?:[\\u2640\\u2642]\\uFE0F?(?:\\u200D\\u27A1\\uFE0F?)?|\\u27A1\\uFE0F?))?|\\uDFF3\\uFE0F?(?:\\u200D(?:\\u26A7\\uFE0F?|\\uD83C\\uDF08))?|\\uDFF4(?:\\u200D\\u2620\\uFE0F?|\\uDB40\\uDC67\\uDB40\\uDC62\\uDB40(?:\\uDC65\\uDB40\\uDC6E\\uDB40\\uDC67|\\uDC73\\uDB40\\uDC63\\uDB40\\uDC74|\\uDC77\\uDB40\\uDC6C\\uDB40\\uDC73)\\uDB40\\uDC7F)?)|\\uD83D(?:[\\uDC3F\\uDCFD\\uDD49\\uDD4A\\uDD6F\\uDD70\\uDD73\\uDD76-\\uDD79\\uDD87\\uDD8A-\\uDD8D\\uDDA5\\uDDA8\\uDDB1\\uDDB2\\uDDBC\\uDDC2-\\uDDC4\\uDDD1-\\uDDD3\\uDDDC-\\uDDDE\\uDDE1\\uDDE3\\uDDE8\\uDDEF\\uDDF3\\uDDFA\\uDECB\\uDECD-\\uDECF\\uDEE0-\\uDEE5\\uDEE9\\uDEF0\\uDEF3]\\uFE0F?|[\\uDC42\\uDC43\\uDC46-\\uDC50\\uDC66\\uDC67\\uDC6B-\\uDC6D\\uDC72\\uDC74-\\uDC76\\uDC78\\uDC7C\\uDC83\\uDC85\\uDC8F\\uDC91\\uDCAA\\uDD7A\\uDD95\\uDD96\\uDE4C\\uDE4F\\uDEC0\\uDECC](?:\\uD83C[\\uDFFB-\\uDFFF])?|[\\uDC6E\\uDC70\\uDC71\\uDC73\\uDC77\\uDC81\\uDC82\\uDC86\\uDC87\\uDE45-\\uDE47\\uDE4B\\uDE4D\\uDE4E\\uDEA3\\uDEB4\\uDEB5](?:\\uD83C[\\uDFFB-\\uDFFF])?(?:\\u200D[\\u2640\\u2642]\\uFE0F?)?|[\\uDD74\\uDD90](?:\\uD83C[\\uDFFB-\\uDFFF]|\\uFE0F)?|[\\uDC00-\\uDC07\\uDC09-\\uDC14\\uDC16-\\uDC25\\uDC27-\\uDC3A\\uDC3C-\\uDC3E\\uDC40\\uDC44\\uDC45\\uDC51-\\uDC65\\uDC6A\\uDC79-\\uDC7B\\uDC7D-\\uDC80\\uDC84\\uDC88-\\uDC8E\\uDC90\\uDC92-\\uDCA9\\uDCAB-\\uDCFC\\uDCFF-\\uDD3D\\uDD4B-\\uDD4E\\uDD50-\\uDD67\\uDDA4\\uDDFB-\\uDE2D\\uDE2F-\\uDE34\\uDE37-\\uDE41\\uDE43\\uDE44\\uDE48-\\uDE4A\\uDE80-\\uDEA2\\uDEA4-\\uDEB3\\uDEB7-\\uDEBF\\uDEC1-\\uDEC5\\uDED0-\\uDED2\\uDED5-\\uDED7\\uDEDC-\\uDEDF\\uDEEB\\uDEEC\\uDEF4-\\uDEFC\\uDFE0-\\uDFEB\\uDFF0]|\\uDC08(?:\\u200D\\u2B1B)?|\\uDC15(?:\\u200D\\uD83E\\uDDBA)?|\\uDC26(?:\\u200D(?:\\u2B1B|\\uD83D\\uDD25))?|\\uDC3B(?:\\u200D\\u2744\\uFE0F?)?|\\uDC41\\uFE0F?(?:\\u200D\\uD83D\\uDDE8\\uFE0F?)?|\\uDC68(?:\\u200D(?:[\\u2695\\u2696\\u2708]\\uFE0F?|\\u2764\\uFE0F?\\u200D\\uD83D(?:\\uDC8B\\u200D\\uD83D)?\\uDC68|\\uD83C[\\uDF3E\\uDF73\\uDF7C\\uDF93\\uDFA4\\uDFA8\\uDFEB\\uDFED]|\\uD83D(?:[\\uDC68\\uDC69]\\u200D\\uD83D(?:\\uDC66(?:\\u200D\\uD83D\\uDC66)?|\\uDC67(?:\\u200D\\uD83D[\\uDC66\\uDC67])?)|[\\uDCBB\\uDCBC\\uDD27\\uDD2C\\uDE80\\uDE92]|\\uDC66(?:\\u200D\\uD83D\\uDC66)?|\\uDC67(?:\\u200D\\uD83D[\\uDC66\\uDC67])?)|\\uD83E(?:[\\uDDAF\\uDDBC\\uDDBD](?:\\u200D\\u27A1\\uFE0F?)?|[\\uDDB0-\\uDDB3]))|\\uD83C(?:\\uDFFB(?:\\u200D(?:[\\u2695\\u2696\\u2708]\\uFE0F?|\\u2764\\uFE0F?\\u200D\\uD83D(?:\\uDC8B\\u200D\\uD83D)?\\uDC68\\uD83C[\\uDFFB-\\uDFFF]|\\uD83C[\\uDF3E\\uDF73\\uDF7C\\uDF93\\uDFA4\\uDFA8\\uDFEB\\uDFED]|\\uD83D[\\uDCBB\\uDCBC\\uDD27\\uDD2C\\uDE80\\uDE92]|\\uD83E(?:[\\uDDAF\\uDDBC\\uDDBD](?:\\u200D\\u27A1\\uFE0F?)?|[\\uDDB0-\\uDDB3]|\\uDD1D\\u200D\\uD83D\\uDC68\\uD83C[\\uDFFC-\\uDFFF])))?|\\uDFFC(?:\\u200D(?:[\\u2695\\u2696\\u2708]\\uFE0F?|\\u2764\\uFE0F?\\u200D\\uD83D(?:\\uDC8B\\u200D\\uD83D)?\\uDC68\\uD83C[\\uDFFB-\\uDFFF]|\\uD83C[\\uDF3E\\uDF73\\uDF7C\\uDF93\\uDFA4\\uDFA8\\uDFEB\\uDFED]|\\uD83D[\\uDCBB\\uDCBC\\uDD27\\uDD2C\\uDE80\\uDE92]|\\uD83E(?:[\\uDDAF\\uDDBC\\uDDBD](?:\\u200D\\u27A1\\uFE0F?)?|[\\uDDB0-\\uDDB3]|\\uDD1D\\u200D\\uD83D\\uDC68\\uD83C[\\uDFFB\\uDFFD-\\uDFFF])))?|\\uDFFD(?:\\u200D(?:[\\u2695\\u2696\\u2708]\\uFE0F?|\\u2764\\uFE0F?\\u200D\\uD83D(?:\\uDC8B\\u200D\\uD83D)?\\uDC68\\uD83C[\\uDFFB-\\uDFFF]|\\uD83C[\\uDF3E\\uDF73\\uDF7C\\uDF93\\uDFA4\\uDFA8\\uDFEB\\uDFED]|\\uD83D[\\uDCBB\\uDCBC\\uDD27\\uDD2C\\uDE80\\uDE92]|\\uD83E(?:[\\uDDAF\\uDDBC\\uDDBD](?:\\u200D\\u27A1\\uFE0F?)?|[\\uDDB0-\\uDDB3]|\\uDD1D\\u200D\\uD83D\\uDC68\\uD83C[\\uDFFB\\uDFFC\\uDFFE\\uDFFF])))?|\\uDFFE(?:\\u200D(?:[\\u2695\\u2696\\u2708]\\uFE0F?|\\u2764\\uFE0F?\\u200D\\uD83D(?:\\uDC8B\\u200D\\uD83D)?\\uDC68\\uD83C[\\uDFFB-\\uDFFF]|\\uD83C[\\uDF3E\\uDF73\\uDF7C\\uDF93\\uDFA4\\uDFA8\\uDFEB\\uDFED]|\\uD83D[\\uDCBB\\uDCBC\\uDD27\\uDD2C\\uDE80\\uDE92]|\\uD83E(?:[\\uDDAF\\uDDBC\\uDDBD](?:\\u200D\\u27A1\\uFE0F?)?|[\\uDDB0-\\uDDB3]|\\uDD1D\\u200D\\uD83D\\uDC68\\uD83C[\\uDFFB-\\uDFFD\\uDFFF])))?|\\uDFFF(?:\\u200D(?:[\\u2695\\u2696\\u2708]\\uFE0F?|\\u2764\\uFE0F?\\u200D\\uD83D(?:\\uDC8B\\u200D\\uD83D)?\\uDC68\\uD83C[\\uDFFB-\\uDFFF]|\\uD83C[\\uDF3E\\uDF73\\uDF7C\\uDF93\\uDFA4\\uDFA8\\uDFEB\\uDFED]|\\uD83D[\\uDCBB\\uDCBC\\uDD27\\uDD2C\\uDE80\\uDE92]|\\uD83E(?:[\\uDDAF\\uDDBC\\uDDBD](?:\\u200D\\u27A1\\uFE0F?)?|[\\uDDB0-\\uDDB3]|\\uDD1D\\u200D\\uD83D\\uDC68\\uD83C[\\uDFFB-\\uDFFE])))?))?|\\uDC69(?:\\u200D(?:[\\u2695\\u2696\\u2708]\\uFE0F?|\\u2764\\uFE0F?\\u200D\\uD83D(?:\\uDC8B\\u200D\\uD83D)?[\\uDC68\\uDC69]|\\uD83C[\\uDF3E\\uDF73\\uDF7C\\uDF93\\uDFA4\\uDFA8\\uDFEB\\uDFED]|\\uD83D(?:[\\uDCBB\\uDCBC\\uDD27\\uDD2C\\uDE80\\uDE92]|\\uDC66(?:\\u200D\\uD83D\\uDC66)?|\\uDC67(?:\\u200D\\uD83D[\\uDC66\\uDC67])?|\\uDC69\\u200D\\uD83D(?:\\uDC66(?:\\u200D\\uD83D\\uDC66)?|\\uDC67(?:\\u200D\\uD83D[\\uDC66\\uDC67])?))|\\uD83E(?:[\\uDDAF\\uDDBC\\uDDBD](?:\\u200D\\u27A1\\uFE0F?)?|[\\uDDB0-\\uDDB3]))|\\uD83C(?:\\uDFFB(?:\\u200D(?:[\\u2695\\u2696\\u2708]\\uFE0F?|\\u2764\\uFE0F?\\u200D\\uD83D(?:[\\uDC68\\uDC69]|\\uDC8B\\u200D\\uD83D[\\uDC68\\uDC69])\\uD83C[\\uDFFB-\\uDFFF]|\\uD83C[\\uDF3E\\uDF73\\uDF7C\\uDF93\\uDFA4\\uDFA8\\uDFEB\\uDFED]|\\uD83D[\\uDCBB\\uDCBC\\uDD27\\uDD2C\\uDE80\\uDE92]|\\uD83E(?:[\\uDDAF\\uDDBC\\uDDBD](?:\\u200D\\u27A1\\uFE0F?)?|[\\uDDB0-\\uDDB3]|\\uDD1D\\u200D\\uD83D[\\uDC68\\uDC69]\\uD83C[\\uDFFC-\\uDFFF])))?|\\uDFFC(?:\\u200D(?:[\\u2695\\u2696\\u2708]\\uFE0F?|\\u2764\\uFE0F?\\u200D\\uD83D(?:[\\uDC68\\uDC69]|\\uDC8B\\u200D\\uD83D[\\uDC68\\uDC69])\\uD83C[\\uDFFB-\\uDFFF]|\\uD83C[\\uDF3E\\uDF73\\uDF7C\\uDF93\\uDFA4\\uDFA8\\uDFEB\\uDFED]|\\uD83D[\\uDCBB\\uDCBC\\uDD27\\uDD2C\\uDE80\\uDE92]|\\uD83E(?:[\\uDDAF\\uDDBC\\uDDBD](?:\\u200D\\u27A1\\uFE0F?)?|[\\uDDB0-\\uDDB3]|\\uDD1D\\u200D\\uD83D[\\uDC68\\uDC69]\\uD83C[\\uDFFB\\uDFFD-\\uDFFF])))?|\\uDFFD(?:\\u200D(?:[\\u2695\\u2696\\u2708]\\uFE0F?|\\u2764\\uFE0F?\\u200D\\uD83D(?:[\\uDC68\\uDC69]|\\uDC8B\\u200D\\uD83D[\\uDC68\\uDC69])\\uD83C[\\uDFFB-\\uDFFF]|\\uD83C[\\uDF3E\\uDF73\\uDF7C\\uDF93\\uDFA4\\uDFA8\\uDFEB\\uDFED]|\\uD83D[\\uDCBB\\uDCBC\\uDD27\\uDD2C\\uDE80\\uDE92]|\\uD83E(?:[\\uDDAF\\uDDBC\\uDDBD](?:\\u200D\\u27A1\\uFE0F?)?|[\\uDDB0-\\uDDB3]|\\uDD1D\\u200D\\uD83D[\\uDC68\\uDC69]\\uD83C[\\uDFFB\\uDFFC\\uDFFE\\uDFFF])))?|\\uDFFE(?:\\u200D(?:[\\u2695\\u2696\\u2708]\\uFE0F?|\\u2764\\uFE0F?\\u200D\\uD83D(?:[\\uDC68\\uDC69]|\\uDC8B\\u200D\\uD83D[\\uDC68\\uDC69])\\uD83C[\\uDFFB-\\uDFFF]|\\uD83C[\\uDF3E\\uDF73\\uDF7C\\uDF93\\uDFA4\\uDFA8\\uDFEB\\uDFED]|\\uD83D[\\uDCBB\\uDCBC\\uDD27\\uDD2C\\uDE80\\uDE92]|\\uD83E(?:[\\uDDAF\\uDDBC\\uDDBD](?:\\u200D\\u27A1\\uFE0F?)?|[\\uDDB0-\\uDDB3]|\\uDD1D\\u200D\\uD83D[\\uDC68\\uDC69]\\uD83C[\\uDFFB-\\uDFFD\\uDFFF])))?|\\uDFFF(?:\\u200D(?:[\\u2695\\u2696\\u2708]\\uFE0F?|\\u2764\\uFE0F?\\u200D\\uD83D(?:[\\uDC68\\uDC69]|\\uDC8B\\u200D\\uD83D[\\uDC68\\uDC69])\\uD83C[\\uDFFB-\\uDFFF]|\\uD83C[\\uDF3E\\uDF73\\uDF7C\\uDF93\\uDFA4\\uDFA8\\uDFEB\\uDFED]|\\uD83D[\\uDCBB\\uDCBC\\uDD27\\uDD2C\\uDE80\\uDE92]|\\uD83E(?:[\\uDDAF\\uDDBC\\uDDBD](?:\\u200D\\u27A1\\uFE0F?)?|[\\uDDB0-\\uDDB3]|\\uDD1D\\u200D\\uD83D[\\uDC68\\uDC69]\\uD83C[\\uDFFB-\\uDFFE])))?))?|\\uDC6F(?:\\u200D[\\u2640\\u2642]\\uFE0F?)?|\\uDD75(?:\\uD83C[\\uDFFB-\\uDFFF]|\\uFE0F)?(?:\\u200D[\\u2640\\u2642]\\uFE0F?)?|\\uDE2E(?:\\u200D\\uD83D\\uDCA8)?|\\uDE35(?:\\u200D\\uD83D\\uDCAB)?|\\uDE36(?:\\u200D\\uD83C\\uDF2B\\uFE0F?)?|\\uDE42(?:\\u200D[\\u2194\\u2195]\\uFE0F?)?|\\uDEB6(?:\\uD83C[\\uDFFB-\\uDFFF])?(?:\\u200D(?:[\\u2640\\u2642]\\uFE0F?(?:\\u200D\\u27A1\\uFE0F?)?|\\u27A1\\uFE0F?))?)|\\uD83E(?:[\\uDD0C\\uDD0F\\uDD18-\\uDD1F\\uDD30-\\uDD34\\uDD36\\uDD77\\uDDB5\\uDDB6\\uDDBB\\uDDD2\\uDDD3\\uDDD5\\uDEC3-\\uDEC5\\uDEF0\\uDEF2-\\uDEF8](?:\\uD83C[\\uDFFB-\\uDFFF])?|[\\uDD26\\uDD35\\uDD37-\\uDD39\\uDD3D\\uDD3E\\uDDB8\\uDDB9\\uDDCD\\uDDCF\\uDDD4\\uDDD6-\\uDDDD](?:\\uD83C[\\uDFFB-\\uDFFF])?(?:\\u200D[\\u2640\\u2642]\\uFE0F?)?|[\\uDDDE\\uDDDF](?:\\u200D[\\u2640\\u2642]\\uFE0F?)?|[\\uDD0D\\uDD0E\\uDD10-\\uDD17\\uDD20-\\uDD25\\uDD27-\\uDD2F\\uDD3A\\uDD3F-\\uDD45\\uDD47-\\uDD76\\uDD78-\\uDDB4\\uDDB7\\uDDBA\\uDDBC-\\uDDCC\\uDDD0\\uDDE0-\\uDDFF\\uDE70-\\uDE7C\\uDE80-\\uDE89\\uDE8F-\\uDEC2\\uDEC6\\uDECE-\\uDEDC\\uDEDF-\\uDEE9]|\\uDD3C(?:\\u200D[\\u2640\\u2642]\\uFE0F?|\\uD83C[\\uDFFB-\\uDFFF])?|\\uDDCE(?:\\uD83C[\\uDFFB-\\uDFFF])?(?:\\u200D(?:[\\u2640\\u2642]\\uFE0F?(?:\\u200D\\u27A1\\uFE0F?)?|\\u27A1\\uFE0F?))?|\\uDDD1(?:\\u200D(?:[\\u2695\\u2696\\u2708]\\uFE0F?|\\uD83C[\\uDF3E\\uDF73\\uDF7C\\uDF84\\uDF93\\uDFA4\\uDFA8\\uDFEB\\uDFED]|\\uD83D[\\uDCBB\\uDCBC\\uDD27\\uDD2C\\uDE80\\uDE92]|\\uD83E(?:[\\uDDAF\\uDDBC\\uDDBD](?:\\u200D\\u27A1\\uFE0F?)?|[\\uDDB0-\\uDDB3]|\\uDD1D\\u200D\\uD83E\\uDDD1|\\uDDD1\\u200D\\uD83E\\uDDD2(?:\\u200D\\uD83E\\uDDD2)?|\\uDDD2(?:\\u200D\\uD83E\\uDDD2)?))|\\uD83C(?:\\uDFFB(?:\\u200D(?:[\\u2695\\u2696\\u2708]\\uFE0F?|\\u2764\\uFE0F?\\u200D(?:\\uD83D\\uDC8B\\u200D)?\\uD83E\\uDDD1\\uD83C[\\uDFFC-\\uDFFF]|\\uD83C[\\uDF3E\\uDF73\\uDF7C\\uDF84\\uDF93\\uDFA4\\uDFA8\\uDFEB\\uDFED]|\\uD83D[\\uDCBB\\uDCBC\\uDD27\\uDD2C\\uDE80\\uDE92]|\\uD83E(?:[\\uDDAF\\uDDBC\\uDDBD](?:\\u200D\\u27A1\\uFE0F?)?|[\\uDDB0-\\uDDB3]|\\uDD1D\\u200D\\uD83E\\uDDD1\\uD83C[\\uDFFB-\\uDFFF])))?|\\uDFFC(?:\\u200D(?:[\\u2695\\u2696\\u2708]\\uFE0F?|\\u2764\\uFE0F?\\u200D(?:\\uD83D\\uDC8B\\u200D)?\\uD83E\\uDDD1\\uD83C[\\uDFFB\\uDFFD-\\uDFFF]|\\uD83C[\\uDF3E\\uDF73\\uDF7C\\uDF84\\uDF93\\uDFA4\\uDFA8\\uDFEB\\uDFED]|\\uD83D[\\uDCBB\\uDCBC\\uDD27\\uDD2C\\uDE80\\uDE92]|\\uD83E(?:[\\uDDAF\\uDDBC\\uDDBD](?:\\u200D\\u27A1\\uFE0F?)?|[\\uDDB0-\\uDDB3]|\\uDD1D\\u200D\\uD83E\\uDDD1\\uD83C[\\uDFFB-\\uDFFF])))?|\\uDFFD(?:\\u200D(?:[\\u2695\\u2696\\u2708]\\uFE0F?|\\u2764\\uFE0F?\\u200D(?:\\uD83D\\uDC8B\\u200D)?\\uD83E\\uDDD1\\uD83C[\\uDFFB\\uDFFC\\uDFFE\\uDFFF]|\\uD83C[\\uDF3E\\uDF73\\uDF7C\\uDF84\\uDF93\\uDFA4\\uDFA8\\uDFEB\\uDFED]|\\uD83D[\\uDCBB\\uDCBC\\uDD27\\uDD2C\\uDE80\\uDE92]|\\uD83E(?:[\\uDDAF\\uDDBC\\uDDBD](?:\\u200D\\u27A1\\uFE0F?)?|[\\uDDB0-\\uDDB3]|\\uDD1D\\u200D\\uD83E\\uDDD1\\uD83C[\\uDFFB-\\uDFFF])))?|\\uDFFE(?:\\u200D(?:[\\u2695\\u2696\\u2708]\\uFE0F?|\\u2764\\uFE0F?\\u200D(?:\\uD83D\\uDC8B\\u200D)?\\uD83E\\uDDD1\\uD83C[\\uDFFB-\\uDFFD\\uDFFF]|\\uD83C[\\uDF3E\\uDF73\\uDF7C\\uDF84\\uDF93\\uDFA4\\uDFA8\\uDFEB\\uDFED]|\\uD83D[\\uDCBB\\uDCBC\\uDD27\\uDD2C\\uDE80\\uDE92]|\\uD83E(?:[\\uDDAF\\uDDBC\\uDDBD](?:\\u200D\\u27A1\\uFE0F?)?|[\\uDDB0-\\uDDB3]|\\uDD1D\\u200D\\uD83E\\uDDD1\\uD83C[\\uDFFB-\\uDFFF])))?|\\uDFFF(?:\\u200D(?:[\\u2695\\u2696\\u2708]\\uFE0F?|\\u2764\\uFE0F?\\u200D(?:\\uD83D\\uDC8B\\u200D)?\\uD83E\\uDDD1\\uD83C[\\uDFFB-\\uDFFE]|\\uD83C[\\uDF3E\\uDF73\\uDF7C\\uDF84\\uDF93\\uDFA4\\uDFA8\\uDFEB\\uDFED]|\\uD83D[\\uDCBB\\uDCBC\\uDD27\\uDD2C\\uDE80\\uDE92]|\\uD83E(?:[\\uDDAF\\uDDBC\\uDDBD](?:\\u200D\\u27A1\\uFE0F?)?|[\\uDDB0-\\uDDB3]|\\uDD1D\\u200D\\uD83E\\uDDD1\\uD83C[\\uDFFB-\\uDFFF])))?))?|\\uDEF1(?:\\uD83C(?:\\uDFFB(?:\\u200D\\uD83E\\uDEF2\\uD83C[\\uDFFC-\\uDFFF])?|\\uDFFC(?:\\u200D\\uD83E\\uDEF2\\uD83C[\\uDFFB\\uDFFD-\\uDFFF])?|\\uDFFD(?:\\u200D\\uD83E\\uDEF2\\uD83C[\\uDFFB\\uDFFC\\uDFFE\\uDFFF])?|\\uDFFE(?:\\u200D\\uD83E\\uDEF2\\uD83C[\\uDFFB-\\uDFFD\\uDFFF])?|\\uDFFF(?:\\u200D\\uD83E\\uDEF2\\uD83C[\\uDFFB-\\uDFFE])?))?)/g;\n};\n","import { getLogger } from '@jitsi/logger';\nimport { Strophe } from 'strophe.js';\n\nimport { CONNECTION_REDIRECTED } from '../../JitsiConnectionEvents';\nimport { XMPPEvents } from '../../service/xmpp/XMPPEvents';\nimport { exists, findFirst, getAttribute } from '../util/XMLUtils';\n\nimport ChatRoom, { IChatRoomOptions } from './ChatRoom';\nimport { ConnectionPluginListenable } from './ConnectionPlugin';\nimport XmppConnection from './XmppConnection';\nimport XMPP from './xmpp';\n\nconst logger = getLogger('xmpp:strophe.emuc');\n\n/**\n * MUC connection plugin.\n */\nexport default class MucConnectionPlugin extends ConnectionPluginListenable {\n    /**\n     * XMPP connection instance\n     */\n    private xmpp: XMPP;\n\n    /**\n     * Map of room JIDs to ChatRoom instances\n     */\n    private rooms: { [roomJid: string]: ChatRoom; };\n\n    /**\n     *\n     * @param xmpp\n     */\n    constructor(xmpp: XMPP) {\n        super();\n        this.xmpp = xmpp;\n        this.rooms = {};\n    }\n\n    /**\n     *\n     * @param connection\n     */\n    override init(connection: XmppConnection): void {\n        super.init(connection);\n\n        // add handlers (just once)\n        this.connection.addHandler(this.onPresence.bind(this), null,\n            'presence', null, null, null, null);\n        this.connection.addHandler(this.onPresenceUnavailable.bind(this),\n            null, 'presence', 'unavailable', null);\n        this.connection.addHandler(this.onPresenceError.bind(this), null,\n            'presence', 'error', null);\n        this.connection.addHandler(this.onMessage.bind(this), null,\n            'message', null, null);\n        this.connection.addHandler(this.onMute.bind(this),\n            'http://jitsi.org/jitmeet/audio', 'iq', 'set', null, null);\n        this.connection.addHandler(this.onMuteVideo.bind(this),\n            'http://jitsi.org/jitmeet/video', 'iq', 'set', null, null);\n        this.connection.addHandler(this.onMuteDesktop.bind(this),\n            'http://jitsi.org/jitmeet/desktop', 'iq', 'set', null, null);\n        this.connection.addHandler(this.onVisitors.bind(this),\n            'jitsi:visitors', 'iq', 'set', null, null);\n    }\n\n    /**\n     *\n     * @param jid\n     * @param password\n     * @param options\n     */\n    createRoom(jid: string, password: string, options: IChatRoomOptions): ChatRoom {\n        const roomJid = Strophe.getBareJidFromJid(jid);\n\n        if (this.isRoomCreated(roomJid)) {\n            const errmsg = 'You are already in the room!';\n\n            logger.error(errmsg);\n            throw new Error(errmsg);\n        }\n        this.rooms[roomJid] = new ChatRoom(this.connection, jid,\n            password, this.xmpp, options);\n        this.eventEmitter.emit(\n            XMPPEvents.EMUC_ROOM_ADDED, this.rooms[roomJid]);\n\n        return this.rooms[roomJid];\n    }\n\n    /**\n     *  Check if a room with the passed JID is already created.\n     *\n     * @param {string} roomJid - The JID of the room.\n     * @returns {boolean}\n     */\n    isRoomCreated(roomJid: string): boolean {\n        return roomJid in this.rooms;\n    }\n\n    /**\n     *\n     * @param jid\n     */\n    doLeave(jid: string): void {\n        this.eventEmitter.emit(\n            XMPPEvents.EMUC_ROOM_REMOVED, this.rooms[jid]);\n        delete this.rooms[jid];\n    }\n\n    /**\n     *\n     * @param pres\n     */\n    onPresence(pres: Element): boolean {\n        const from = pres.getAttribute('from');\n\n        // What is this for? A workaround for something?\n        if (pres.getAttribute('type')) {\n            return true;\n        }\n\n        const room = this.rooms[Strophe.getBareJidFromJid(from)];\n\n        if (!room) {\n            return true;\n        }\n\n        // Parse status.\n        // Use *|xmlns to match xmlns attributes across any namespace (CSS Selectors Level 3)\n        if (exists(pres, ':scope>x[*|xmlns=\"http://jabber.org/protocol/muc#user\"]>status[code=\"201\"]')) {\n            room.createNonAnonymousRoom();\n        }\n\n        room.onPresence(pres);\n\n        return true;\n    }\n\n    /**\n     *\n     * @param pres\n     */\n    onPresenceUnavailable(pres: Element): boolean {\n        const from = pres.getAttribute('from');\n        const room = this.rooms[Strophe.getBareJidFromJid(from)];\n\n        if (!room) {\n            return true;\n        }\n\n        room.onPresenceUnavailable(pres, from);\n\n        return true;\n    }\n\n    /**\n     *\n     * @param pres\n     */\n    onPresenceError(pres: Element): boolean {\n        const from = pres.getAttribute('from');\n        const room = this.rooms[Strophe.getBareJidFromJid(from)];\n\n        if (!room) {\n            return true;\n        }\n\n        room.onPresenceError(pres, from);\n\n        return true;\n    }\n\n    /**\n     *\n     * @param msg\n     */\n    onMessage(msg: Element): boolean {\n        // FIXME: this is a hack. but jingle on muc makes nickchanges hard\n        const from = msg.getAttribute('from');\n        const room = this.rooms[Strophe.getBareJidFromJid(from)];\n\n        if (!room) {\n            return true;\n        }\n\n        room.onMessage(msg, from);\n\n        return true;\n    }\n\n    /**\n     * Handle remote mute request from focus.\n     *\n     * @param iq\n     */\n    onMute(iq: Element): boolean {\n        const from = iq.getAttribute('from');\n        const room = this.rooms[Strophe.getBareJidFromJid(from)];\n\n        // Returning false would result in the listener being deregistered by Strophe\n        if (!room) {\n            return true;\n        }\n\n        room.onMute(iq);\n\n        return true;\n    }\n\n    /**\n     * Handle remote video mute request from focus.\n     *\n     * @param iq\n     */\n    onMuteVideo(iq: Element): boolean {\n        const from = iq.getAttribute('from');\n        const room = this.rooms[Strophe.getBareJidFromJid(from)];\n\n        // Returning false would result in the listener being deregistered by Strophe\n        if (!room) {\n            return true;\n        }\n\n        room.onMuteVideo(iq);\n\n        return true;\n    }\n\n    /**\n     * Handle remote desktop sharing mute request from focus.\n     *\n     * @param iq\n     */\n    onMuteDesktop(iq) {\n        const from = iq.getAttribute('from');\n        const room = this.rooms[Strophe.getBareJidFromJid(from)];\n\n        // Returning false would result in the listener being deregistered by Strophe\n        if (!room) {\n            return true;\n        }\n\n        room.onMuteDesktop(iq);\n\n        return true;\n    }\n\n    /**\n     * A visitor IQ is received, pass it to the room.\n     * @param iq The received iq.\n     * @returns {boolean}\n     */\n    onVisitors(iq: Element): boolean {\n        const from = iq.getAttribute('from');\n        const room = this.rooms[Strophe.getBareJidFromJid(from)];\n\n        if (!room) {\n            return true;\n        }\n\n        // Use *|xmlns to match xmlns attributes across any namespace (CSS Selectors Level 3)\n        const visitors = findFirst(iq, ':scope>visitors[*|xmlns=\"jitsi:visitors\"]');\n        const response = findFirst(visitors, ':scope>promotion-response');\n\n        if (visitors && response) {\n            if (String(getAttribute(response, 'allow')).toLowerCase() === 'true') {\n                logger.info('Promotion request accepted. Redirected to main room.');\n                this.xmpp.eventEmitter.emit(\n                    CONNECTION_REDIRECTED, undefined, getAttribute(visitors, 'focusjid'), getAttribute(response, 'username'));\n            } else {\n                logger.info('Promotion request rejected.');\n                this.xmpp.eventEmitter.emit(XMPPEvents.VISITORS_REJECTION);\n            }\n        }\n\n        return true;\n    }\n}\n","import { safeJsonParse } from '@jitsi/js-utils/json';\nimport { getLogger } from '@jitsi/logger';\nimport { $build } from 'strophe.js';\n\nimport { MediaType } from '../../service/RTC/MediaType';\nimport { SSRC_GROUP_SEMANTICS } from '../../service/RTC/StandardVideoQualitySettings';\nimport { VideoType } from '../../service/RTC/VideoType';\nimport { XEP } from '../../service/xmpp/XMPPExtensioProtocols';\nimport { findFirst } from '../util/XMLUtils';\n\nconst logger = getLogger('xmpp:JingleHelperFunctions');\n\nexport interface ISourceCompactJson {\n    m?: string;\n    n: string;\n    s: string;\n    v?: any;\n}\n\nexport interface ICompactSsrcGroup extends Array<string> { }\n\nexport interface IJsonMessage {\n    sources: {\n        [owner: string]: [ISourceCompactJson[], ICompactSsrcGroup[], ISourceCompactJson[], ICompactSsrcGroup[]];\n    };\n}\n\n/**\n * Creates a \"source\" XML element for the source described in compact JSON format in [sourceCompactJson].\n * @param {*} owner the endpoint ID of the owner of the source.\n * @param {*} sourceCompactJson the compact JSON representation of the source.\n * @param {boolean} isVideo whether the source is a video source\n * @returns the created \"source\" XML element.\n */\nfunction _createSourceExtension(owner: string, sourceCompactJson: ISourceCompactJson, isVideo: boolean = false): Node {\n    let videoType = sourceCompactJson.v ? VideoType.DESKTOP : undefined;\n\n    // If the video type is not specified, it is assumed to be a camera for video sources.\n    // Jicofo adds the video type only for desktop sharing sources.\n    if (!videoType && isVideo) {\n        videoType = VideoType.CAMERA;\n    }\n\n    const node = $build('source', {\n        name: sourceCompactJson.n,\n        ssrc: sourceCompactJson.s,\n        videoType,\n        xmlns: XEP.SOURCE_ATTRIBUTES\n    });\n\n    if (sourceCompactJson.m) {\n        node.c('parameter', {\n            name: 'msid',\n            value: sourceCompactJson.m\n        }).up();\n    }\n    node.c('ssrc-info', {\n        owner,\n        xmlns: 'http://jitsi.org/jitmeet'\n    }).up();\n\n    return node.node;\n}\n\n/**\n * Creates an \"ssrc-group\" XML element for the SSRC group described in compact JSON format in [ssrcGroupCompactJson].\n * @param {*} ssrcGroupCompactJson the compact JSON representation of the SSRC group.\n * @returns the created \"ssrc-group\" element.\n */\nfunction _createSsrcGroupExtension(ssrcGroupCompactJson: ICompactSsrcGroup): Node {\n    const node = $build('ssrc-group', {\n        semantics: _getSemantics(ssrcGroupCompactJson[0]),\n        xmlns: XEP.SOURCE_ATTRIBUTES\n    });\n\n    for (let i = 1; i < ssrcGroupCompactJson.length; i++) {\n        node.c('source', {\n            ssrc: ssrcGroupCompactJson[i],\n            xmlns: XEP.SOURCE_ATTRIBUTES\n        }).up();\n    }\n\n    return node.node;\n}\n\n/**\n * Finds in a Jingle IQ the RTP description element with the given media type. If one does not exists, create it (as\n *  well as the required  \"content\" parent element) and adds it to the IQ.\n * @param {*} iq\n * @param {*} mediaType The media type, \"audio\" or \"video\".\n * @returns the RTP description element with the given media type.\n */\nfunction _getOrCreateRtpDescription(iq: Element, mediaType: string): Element {\n    const jingle = findFirst(iq, 'jingle');\n    let content = findFirst(jingle, `:scope>content[name=\"${mediaType}\"]`);\n\n    if (!content) {\n        // I'm not sure if \"creator\" and \"senders\" are required.\n        content = $build('content', {\n            name: mediaType\n        }).node;\n        jingle?.appendChild(content);\n    }\n\n    let description = findFirst(content, 'description');\n\n    if (!description) {\n        description = $build('description', {\n            media: mediaType,\n            xmlns: XEP.RTP_MEDIA\n        }).node;\n        content.appendChild(description);\n    }\n\n    return description;\n}\n\n/**\n * Converts the short string representing SSRC group semantics in compact JSON format to the standard representation\n * (i.e. convert \"f\" to \"FID\" and \"s\" to \"SIM\").\n * @param {*} str the compact JSON format representation of an SSRC group's semantics.\n * @returns the SSRC group semantics corresponding to [str].\n */\nfunction _getSemantics(str: string): Nullable<string> {\n    if (str === 'f') {\n        return SSRC_GROUP_SEMANTICS.FID;\n    } else if (str === 's') {\n        return SSRC_GROUP_SEMANTICS.SIM;\n    }\n\n    return null;\n}\n\n/**\n * Reads a JSON-encoded message (from a \"json-message\" element) and extracts source descriptions. Adds the extracted\n * source descriptions to the given Jingle IQ in the standard Jingle format.\n *\n * Encoding sources in this compact JSON format instead of standard Jingle was introduced in order to reduce the\n * network traffic and load on the XMPP server. The format is described in Jicofo [TODO: insert link].\n *\n * @param {*} iq the IQ to which source descriptions will be added.\n * @param {*} jsonMessageXml The XML node for the \"json-message\" element.\n * @returns {Map<string, Array<string>} The audio and video ssrcs extracted from the JSON-encoded message with remote\n * endpoint id as the key.\n */\nexport function expandSourcesFromJson(iq: Element, jsonMessageXml: Element): Nullable<Map<string, string[]>> {\n    let json: any;\n\n    try {\n        json = safeJsonParse(jsonMessageXml.textContent || '');\n    } catch (error) {\n        logger.error(`json-message XML contained invalid JSON, ignoring: ${jsonMessageXml.textContent}`);\n\n        return null;\n    }\n\n    if (!json?.sources) {\n        // It might be a message of a different type, no need to log.\n        return null;\n    }\n\n    // This is where we'll add \"source\" and \"ssrc-group\" elements. Create them elements if they don't exist.\n    const audioRtpDescription = _getOrCreateRtpDescription(iq, MediaType.AUDIO);\n    const videoRtpDescription = _getOrCreateRtpDescription(iq, MediaType.VIDEO);\n    const ssrcMap = new Map<string, string[]>();\n\n    for (const owner in json.sources) {\n        if (json.sources.hasOwnProperty(owner)) {\n            const ssrcs: string[] = [];\n            const ownerSources = json.sources[owner] as [ISourceCompactJson[], ICompactSsrcGroup[], ISourceCompactJson[], ICompactSsrcGroup[]];\n\n            // The video sources, video ssrc-groups, audio sources and audio ssrc-groups are encoded in that order in\n            // the elements of the array.\n            const videoSources = ownerSources?.length ? ownerSources[0] : [];\n            const videoSsrcGroups = ownerSources?.length > 1 ? ownerSources[1] : [];\n            const audioSources = ownerSources?.length > 2 ? ownerSources[2] : [];\n            const audioSsrcGroups = ownerSources?.length > 3 ? ownerSources[3] : [];\n\n            if (videoSources?.length) {\n                for (let i = 0; i < videoSources.length; i++) {\n                    videoRtpDescription.appendChild(_createSourceExtension(owner, videoSources[i], true));\n                    ssrcs.push(videoSources[i]?.s);\n                }\n            }\n\n            if (videoSsrcGroups?.length) {\n                for (let i = 0; i < videoSsrcGroups.length; i++) {\n                    videoRtpDescription.appendChild(_createSsrcGroupExtension(videoSsrcGroups[i]));\n                }\n            }\n            if (audioSources?.length) {\n                for (let i = 0; i < audioSources.length; i++) {\n                    audioRtpDescription.appendChild(_createSourceExtension(owner, audioSources[i]));\n                    ssrcs.push(audioSources[i]?.s);\n                }\n            }\n\n            if (audioSsrcGroups?.length) {\n                for (let i = 0; i < audioSsrcGroups.length; i++) {\n                    audioRtpDescription.appendChild(_createSsrcGroupExtension(audioSsrcGroups[i]));\n                }\n            }\n            ssrcMap.set(owner, ssrcs);\n        }\n    }\n\n    return ssrcMap;\n}\n","import { isEqual } from 'lodash-es';\nimport Strophe from 'strophe';\n\nimport { XEP } from '../../service/xmpp/XMPPExtensioProtocols';\n\nimport SDP from './SDP';\nimport SDPUtil from './SDPUtil';\nimport { IDiffSourceInfo } from './constants';\n\n\n/**\n * A class that provides methods for comparing the source information present in two different SDPs so that the delta\n * can be signaled to Jicofo via 'source-remove' or 'source-add'.\n */\nexport class SDPDiffer {\n    private isP2P: boolean;\n    private mySdp: SDP;\n    private othersSdp: SDP;\n\n    /**\n     * Constructor.\n     *\n     * @param {SDP} mySdp - the new SDP.\n     * @param {SDP} othersSdp - the old SDP.\n     * @param {boolean} isP2P - Whether the SDPs belong to a p2p peerconnection.\n     */\n    constructor(mySdp: SDP, othersSdp: SDP, isP2P: boolean) {\n        this.isP2P = isP2P;\n        this.mySdp = mySdp;\n        this.othersSdp = othersSdp;\n    }\n\n    /**\n     * Returns a map of the sources that are present in 'othersSdp' but not in 'mySdp'.\n     *\n     * @returns {*}\n     */\n    getNewMedia(): IDiffSourceInfo {\n        const mySources = this.mySdp.getMediaSsrcMap();\n        const othersSources = this.othersSdp.getMediaSsrcMap();\n        const diff: IDiffSourceInfo = {};\n\n        for (const [ index, othersSource ] of othersSources.entries()) {\n            const mySource = mySources.get(index);\n\n            if (!mySource) {\n                diff[index] = othersSource;\n                continue; // eslint-disable-line no-continue\n            }\n\n            const othersSsrcs = Object.keys(othersSource.ssrcs);\n\n            if (othersSsrcs.length && !isEqual(Object.keys(mySource.ssrcs).sort(), [ ...othersSsrcs ].sort())) {\n                diff[index] = othersSource;\n            }\n        }\n\n        return diff;\n    }\n\n    /**\n     * Adds the diff source info to the provided IQ stanza.\n     *\n     * @param {Strophe.Builder} modify - Stanza IQ.\n     * @returns {boolean}\n     */\n    toJingle(modify: Strophe.Builder): boolean {\n        let modified = false;\n        const diffSourceInfo = this.getNewMedia();\n\n        for (const media of Object.values(diffSourceInfo)) {\n            modified = true;\n            modify.c('content', { name: this.isP2P ? media.mid : media.mediaType });\n\n            modify.c('description', {\n                media: media.mediaType,\n                xmlns: XEP.RTP_MEDIA\n            });\n\n            Object.keys(media.ssrcs).forEach(ssrcNum => {\n                const mediaSsrc = media.ssrcs[ssrcNum];\n                const ssrcLines = mediaSsrc.lines;\n                const sourceName = SDPUtil.parseSourceNameLine(ssrcLines);\n                const videoType = SDPUtil.parseVideoTypeLine(ssrcLines);\n\n                modify.c('source', { xmlns: XEP.SOURCE_ATTRIBUTES });\n                modify.attrs({\n                    name: sourceName,\n                    ssrc: mediaSsrc.ssrc,\n                    videoType\n                });\n\n                // Only MSID attribute is sent\n                const msid = SDPUtil.parseMSIDAttribute(ssrcLines);\n\n                if (msid) {\n                    modify.c('parameter', { name: 'msid', value: msid }).up();\n                }\n\n                modify.up(); // end of source\n            });\n\n            // generate source groups from lines\n            media.ssrcGroups.forEach(ssrcGroup => {\n                if (ssrcGroup.ssrcs.length) {\n\n                    modify.c('ssrc-group', {\n                        semantics: ssrcGroup.semantics,\n                        xmlns: XEP.SOURCE_ATTRIBUTES\n                    });\n\n                    ssrcGroup.ssrcs.forEach(ssrc => {\n                        modify.c('source', { ssrc }).up(); // end of source\n                    });\n                    modify.up(); // end of ssrc-group\n                }\n            });\n\n            modify.up(); // end of description\n            modify.up(); // end of content\n        }\n\n        return modified;\n    }\n}\n","export default function onlyOnce(fn) {\n    return function (...args) {\n        if (fn === null) throw new Error(\"Callback was already called.\");\n        var callFn = fn;\n        fn = null;\n        callFn.apply(this, args);\n    };\n}\n","/* istanbul ignore file */\n\nexport var hasQueueMicrotask = typeof queueMicrotask === 'function' && queueMicrotask;\nexport var hasSetImmediate = typeof setImmediate === 'function' && setImmediate;\nexport var hasNextTick = typeof process === 'object' && typeof process.nextTick === 'function';\n\nexport function fallback(fn) {\n    setTimeout(fn, 0);\n}\n\nexport function wrap(defer) {\n    return (fn, ...args) => defer(() => fn(...args));\n}\n\nvar _defer;\n\nif (hasQueueMicrotask) {\n    _defer = queueMicrotask;\n} else if (hasSetImmediate) {\n    _defer = setImmediate;\n} else if (hasNextTick) {\n    _defer = process.nextTick;\n} else {\n    _defer = fallback;\n}\n\nexport default wrap(_defer);\n","// Simple doubly linked list (https://en.wikipedia.org/wiki/Doubly_linked_list) implementation\n// used for queues. This implementation assumes that the node provided by the user can be modified\n// to adjust the next and last properties. We implement only the minimal functionality\n// for queue support.\nexport default class DLL {\n    constructor() {\n        this.head = this.tail = null;\n        this.length = 0;\n    }\n\n    removeLink(node) {\n        if (node.prev) node.prev.next = node.next;\n        else this.head = node.next\n        if (node.next) node.next.prev = node.prev;\n        else this.tail = node.prev;\n\n        node.prev = node.next = null;\n        this.length -= 1;\n        return node;\n    }\n\n    empty () {\n        while(this.head) this.shift();\n        return this;\n    }\n\n    insertAfter(node, newNode) {\n        newNode.prev = node;\n        newNode.next = node.next;\n        if (node.next) node.next.prev = newNode;\n        else this.tail = newNode;\n        node.next = newNode;\n        this.length += 1;\n    }\n\n    insertBefore(node, newNode) {\n        newNode.prev = node.prev;\n        newNode.next = node;\n        if (node.prev) node.prev.next = newNode;\n        else this.head = newNode;\n        node.prev = newNode;\n        this.length += 1;\n    }\n\n    unshift(node) {\n        if (this.head) this.insertBefore(this.head, node);\n        else setInitial(this, node);\n    }\n\n    push(node) {\n        if (this.tail) this.insertAfter(this.tail, node);\n        else setInitial(this, node);\n    }\n\n    shift() {\n        return this.head && this.removeLink(this.head);\n    }\n\n    pop() {\n        return this.tail && this.removeLink(this.tail);\n    }\n\n    toArray() {\n        return [...this]\n    }\n\n    *[Symbol.iterator] () {\n        var cur = this.head\n        while (cur) {\n            yield cur.data\n            cur = cur.next\n        }\n    }\n\n    remove (testFn) {\n        var curr = this.head;\n        while(curr) {\n            var {next} = curr;\n            if (testFn(curr)) {\n                this.removeLink(curr);\n            }\n            curr = next;\n        }\n        return this;\n    }\n}\n\nfunction setInitial(dll, node) {\n    dll.length = 1;\n    dll.head = dll.tail = node;\n}\n\n","import initialParams from './internal/initialParams.js'\nimport setImmediate from './internal/setImmediate.js'\nimport { isAsync } from './internal/wrapAsync.js'\n\n/**\n * Take a sync function and make it async, passing its return value to a\n * callback. This is useful for plugging sync functions into a waterfall,\n * series, or other async functions. Any arguments passed to the generated\n * function will be passed to the wrapped function (except for the final\n * callback argument). Errors thrown will be passed to the callback.\n *\n * If the function passed to `asyncify` returns a Promise, that promises's\n * resolved/rejected state will be used to call the callback, rather than simply\n * the synchronous return value.\n *\n * This also means you can asyncify ES2017 `async` functions.\n *\n * @name asyncify\n * @static\n * @memberOf module:Utils\n * @method\n * @alias wrapSync\n * @category Util\n * @param {Function} func - The synchronous function, or Promise-returning\n * function to convert to an {@link AsyncFunction}.\n * @returns {AsyncFunction} An asynchronous wrapper of the `func`. To be\n * invoked with `(args..., callback)`.\n * @example\n *\n * // passing a regular synchronous function\n * async.waterfall([\n *     async.apply(fs.readFile, filename, \"utf8\"),\n *     async.asyncify(JSON.parse),\n *     function (data, next) {\n *         // data is the result of parsing the text.\n *         // If there was a parsing error, it would have been caught.\n *     }\n * ], callback);\n *\n * // passing a function returning a promise\n * async.waterfall([\n *     async.apply(fs.readFile, filename, \"utf8\"),\n *     async.asyncify(function (contents) {\n *         return db.model.create(contents);\n *     }),\n *     function (model, next) {\n *         // `model` is the instantiated model object.\n *         // If there was an error, this function would be skipped.\n *     }\n * ], callback);\n *\n * // es2017 example, though `asyncify` is not needed if your JS environment\n * // supports async functions out of the box\n * var q = async.queue(async.asyncify(async function(file) {\n *     var intermediateStep = await processFile(file);\n *     return await somePromise(intermediateStep)\n * }));\n *\n * q.push(files);\n */\nexport default function asyncify(func) {\n    if (isAsync(func)) {\n        return function (...args/*, callback*/) {\n            const callback = args.pop()\n            const promise = func.apply(this, args)\n            return handlePromise(promise, callback)\n        }\n    }\n\n    return initialParams(function (args, callback) {\n        var result;\n        try {\n            result = func.apply(this, args);\n        } catch (e) {\n            return callback(e);\n        }\n        // if result is Promise object\n        if (result && typeof result.then === 'function') {\n            return handlePromise(result, callback)\n        } else {\n            callback(null, result);\n        }\n    });\n}\n\nfunction handlePromise(promise, callback) {\n    return promise.then(value => {\n        invokeCallback(callback, null, value);\n    }, err => {\n        invokeCallback(callback, err && err.message ? err : new Error(err));\n    });\n}\n\nfunction invokeCallback(callback, error, value) {\n    try {\n        callback(error, value);\n    } catch (err) {\n        setImmediate(e => { throw e }, err);\n    }\n}\n","import asyncify from '../asyncify.js'\n\nfunction isAsync(fn) {\n    return fn[Symbol.toStringTag] === 'AsyncFunction';\n}\n\nfunction isAsyncGenerator(fn) {\n    return fn[Symbol.toStringTag] === 'AsyncGenerator';\n}\n\nfunction isAsyncIterable(obj) {\n    return typeof obj[Symbol.asyncIterator] === 'function';\n}\n\nfunction wrapAsync(asyncFn) {\n    if (typeof asyncFn !== 'function') throw new Error('expected a function')\n    return isAsync(asyncFn) ? asyncify(asyncFn) : asyncFn;\n}\n\nexport default wrapAsync;\n\nexport { isAsync, isAsyncGenerator, isAsyncIterable };\n","export default function (fn) {\n    return function (...args/*, callback*/) {\n        var callback = args.pop();\n        return fn.call(this, args, callback);\n    };\n}\n","import onlyOnce from './onlyOnce.js'\nimport setImmediate from './setImmediate.js'\nimport DLL from './DoublyLinkedList.js'\nimport wrapAsync from './wrapAsync.js'\n\nexport default function queue(worker, concurrency, payload) {\n    if (concurrency == null) {\n        concurrency = 1;\n    }\n    else if(concurrency === 0) {\n        throw new RangeError('Concurrency must not be zero');\n    }\n\n    var _worker = wrapAsync(worker);\n    var numRunning = 0;\n    var workersList = [];\n    const events = {\n        error: [],\n        drain: [],\n        saturated: [],\n        unsaturated: [],\n        empty: []\n    }\n\n    function on (event, handler) {\n        events[event].push(handler)\n    }\n\n    function once (event, handler) {\n        const handleAndRemove = (...args) => {\n            off(event, handleAndRemove)\n            handler(...args)\n        }\n        events[event].push(handleAndRemove)\n    }\n\n    function off (event, handler) {\n        if (!event) return Object.keys(events).forEach(ev => events[ev] = [])\n        if (!handler) return events[event] = []\n        events[event] = events[event].filter(ev => ev !== handler)\n    }\n\n    function trigger (event, ...args) {\n        events[event].forEach(handler => handler(...args))\n    }\n\n    var processingScheduled = false;\n    function _insert(data, insertAtFront, rejectOnError, callback) {\n        if (callback != null && typeof callback !== 'function') {\n            throw new Error('task callback must be a function');\n        }\n        q.started = true;\n\n        var res, rej;\n        function promiseCallback (err, ...args) {\n            // we don't care about the error, let the global error handler\n            // deal with it\n            if (err) return rejectOnError ? rej(err) : res()\n            if (args.length <= 1) return res(args[0])\n            res(args)\n        }\n\n        var item = q._createTaskItem(\n            data,\n            rejectOnError ? promiseCallback :\n                (callback || promiseCallback)\n        );\n\n        if (insertAtFront) {\n            q._tasks.unshift(item);\n        } else {\n            q._tasks.push(item);\n        }\n\n        if (!processingScheduled) {\n            processingScheduled = true;\n            setImmediate(() => {\n                processingScheduled = false;\n                q.process();\n            });\n        }\n\n        if (rejectOnError || !callback) {\n            return new Promise((resolve, reject) => {\n                res = resolve\n                rej = reject\n            })\n        }\n    }\n\n    function _createCB(tasks) {\n        return function (err, ...args) {\n            numRunning -= 1;\n\n            for (var i = 0, l = tasks.length; i < l; i++) {\n                var task = tasks[i];\n\n                var index = workersList.indexOf(task);\n                if (index === 0) {\n                    workersList.shift();\n                } else if (index > 0) {\n                    workersList.splice(index, 1);\n                }\n\n                task.callback(err, ...args);\n\n                if (err != null) {\n                    trigger('error', err, task.data);\n                }\n            }\n\n            if (numRunning <= (q.concurrency - q.buffer) ) {\n                trigger('unsaturated')\n            }\n\n            if (q.idle()) {\n                trigger('drain')\n            }\n            q.process();\n        };\n    }\n\n    function _maybeDrain(data) {\n        if (data.length === 0 && q.idle()) {\n            // call drain immediately if there are no tasks\n            setImmediate(() => trigger('drain'));\n            return true\n        }\n        return false\n    }\n\n    const eventMethod = (name) => (handler) => {\n        if (!handler) {\n            return new Promise((resolve, reject) => {\n                once(name, (err, data) => {\n                    if (err) return reject(err)\n                    resolve(data)\n                })\n            })\n        }\n        off(name)\n        on(name, handler)\n\n    }\n\n    var isProcessing = false;\n    var q = {\n        _tasks: new DLL(),\n        _createTaskItem (data, callback) {\n            return {\n                data,\n                callback\n            };\n        },\n        *[Symbol.iterator] () {\n            yield* q._tasks[Symbol.iterator]()\n        },\n        concurrency,\n        payload,\n        buffer: concurrency / 4,\n        started: false,\n        paused: false,\n        push (data, callback) {\n            if (Array.isArray(data)) {\n                if (_maybeDrain(data)) return\n                return data.map(datum => _insert(datum, false, false, callback))\n            }\n            return _insert(data, false, false, callback);\n        },\n        pushAsync (data, callback) {\n            if (Array.isArray(data)) {\n                if (_maybeDrain(data)) return\n                return data.map(datum => _insert(datum, false, true, callback))\n            }\n            return _insert(data, false, true, callback);\n        },\n        kill () {\n            off()\n            q._tasks.empty();\n        },\n        unshift (data, callback) {\n            if (Array.isArray(data)) {\n                if (_maybeDrain(data)) return\n                return data.map(datum => _insert(datum, true, false, callback))\n            }\n            return _insert(data, true, false, callback);\n        },\n        unshiftAsync (data, callback) {\n            if (Array.isArray(data)) {\n                if (_maybeDrain(data)) return\n                return data.map(datum => _insert(datum, true, true, callback))\n            }\n            return _insert(data, true, true, callback);\n        },\n        remove (testFn) {\n            q._tasks.remove(testFn);\n        },\n        process () {\n            // Avoid trying to start too many processing operations. This can occur\n            // when callbacks resolve synchronously (#1267).\n            if (isProcessing) {\n                return;\n            }\n            isProcessing = true;\n            while(!q.paused && numRunning < q.concurrency && q._tasks.length){\n                var tasks = [], data = [];\n                var l = q._tasks.length;\n                if (q.payload) l = Math.min(l, q.payload);\n                for (var i = 0; i < l; i++) {\n                    var node = q._tasks.shift();\n                    tasks.push(node);\n                    workersList.push(node);\n                    data.push(node.data);\n                }\n\n                numRunning += 1;\n\n                if (q._tasks.length === 0) {\n                    trigger('empty');\n                }\n\n                if (numRunning === q.concurrency) {\n                    trigger('saturated');\n                }\n\n                var cb = onlyOnce(_createCB(tasks));\n                _worker(data, cb);\n            }\n            isProcessing = false;\n        },\n        length () {\n            return q._tasks.length;\n        },\n        running () {\n            return numRunning;\n        },\n        workersList () {\n            return workersList;\n        },\n        idle() {\n            return q._tasks.length + numRunning === 0;\n        },\n        pause () {\n            q.paused = true;\n        },\n        resume () {\n            if (q.paused === false) { return; }\n            q.paused = false;\n            setImmediate(q.process);\n        }\n    };\n    // define these as fixed properties, so people get useful errors when updating\n    Object.defineProperties(q, {\n        saturated: {\n            writable: false,\n            value: eventMethod('saturated')\n        },\n        unsaturated: {\n            writable: false,\n            value: eventMethod('unsaturated')\n        },\n        empty: {\n            writable: false,\n            value: eventMethod('empty')\n        },\n        drain: {\n            writable: false,\n            value: eventMethod('drain')\n        },\n        error: {\n            writable: false,\n            value: eventMethod('error')\n        },\n    })\n    return q;\n}\n","import { getLogger } from '@jitsi/logger';\nimport { AsyncQueue as AsyncQueueType, queue } from 'async-es';\n\nconst logger = getLogger('utils:AsyncQueue');\n\n/**\n * Error to be passed to a callback of a queued task when the queue is cleared.\n */\nexport class ClearedQueueError extends Error {\n    /**\n     * Creates new instance.\n     */\n    constructor(message: string) {\n        super(message);\n        this.name = 'ClearedQueueError';\n    }\n}\n\nexport type Task = (callback: (err?: Error) => void) => void;\nexport type TaskCallback = (err?: Error) => void;\n\n/**\n * A queue for async task execution.\n */\nexport default class AsyncQueue {\n    private _queue: AsyncQueueType<Task>;\n    private _stopped: boolean;\n    private _taskCallbacks: Map<Task, Optional<TaskCallback>>;\n\n    /**\n     * Creates new instance.\n     */\n    constructor() {\n        this._queue = queue(this._processQueueTasks.bind(this), 1);\n        this._stopped = false;\n        this._taskCallbacks = new Map();\n    }\n\n    /**\n     * Internal task processing implementation which makes things work.\n     */\n    private _processQueueTasks(task: Task, finishedCallback: TaskCallback): void {\n        try {\n            task(finishedCallback);\n        } catch (error) {\n            logger.error(`Task failed: ${error?.stack}`);\n            finishedCallback(error);\n        } finally {\n            this._taskCallbacks.delete(task);\n        }\n    }\n\n    /**\n     * Removes any pending tasks from the queue.\n     */\n    clear(): void {\n        for (const finishedCallback of this._taskCallbacks.values()) {\n            try {\n                finishedCallback?.(new ClearedQueueError('The queue has been cleared'));\n            } catch (error) {\n                logger.error('Error in callback while clearing the queue:', error);\n            }\n        }\n        this._queue.kill();\n    }\n\n    /**\n     * Pauses the execution of the tasks on the queue.\n     */\n    pause(): void {\n        this._queue.pause();\n    }\n\n    /**\n     * The 'task' function will be given a callback it MUST call with either:\n     *  1) No arguments if it was successful or\n     *  2) An error argument if there was an error\n     * If the task wants to process the success or failure of the task, it\n     * should pass the {@code callback} to the push function, e.g.:\n     * queue.push(task, (err) => {\n     *     if (err) {\n     *         // error handling\n     *     } else {\n     *         // success handling\n     *     }\n     * });\n     *\n     * @param {Task} task - The task to be executed. See the description above.\n     * @param {TaskCallback} [callback] - Optional callback to be called after the task has been executed.\n     */\n    push(task: Task, callback?: TaskCallback): void {\n        if (this._stopped) {\n            callback && callback(new Error('The queue has been stopped'));\n\n            return;\n        }\n        this._taskCallbacks.set(task, callback);\n        this._queue.push(task, callback);\n    }\n\n    /**\n     * Resumes the execution of the tasks on the queue.\n     */\n    resume(): void {\n        this._queue.resume();\n    }\n\n    /**\n     * Shutdowns the queue. All already queued tasks will execute, but no future tasks can be added. If a task is added\n     * after the queue has been shutdown then the callback will be called with an error.\n     */\n    shutdown(): void {\n        this._stopped = true;\n    }\n}\n","import queue from './internal/queue.js'\nimport wrapAsync from './internal/wrapAsync.js'\n\n/**\n * A queue of tasks for the worker function to complete.\n * @typedef {Iterable} QueueObject\n * @memberOf module:ControlFlow\n * @property {Function} length - a function returning the number of items\n * waiting to be processed. Invoke with `queue.length()`.\n * @property {boolean} started - a boolean indicating whether or not any\n * items have been pushed and processed by the queue.\n * @property {Function} running - a function returning the number of items\n * currently being processed. Invoke with `queue.running()`.\n * @property {Function} workersList - a function returning the array of items\n * currently being processed. Invoke with `queue.workersList()`.\n * @property {Function} idle - a function returning false if there are items\n * waiting or being processed, or true if not. Invoke with `queue.idle()`.\n * @property {number} concurrency - an integer for determining how many `worker`\n * functions should be run in parallel. This property can be changed after a\n * `queue` is created to alter the concurrency on-the-fly.\n * @property {number} payload - an integer that specifies how many items are\n * passed to the worker function at a time. only applies if this is a\n * [cargo]{@link module:ControlFlow.cargo} object\n * @property {AsyncFunction} push - add a new task to the `queue`. Calls `callback`\n * once the `worker` has finished processing the task. Instead of a single task,\n * a `tasks` array can be submitted. The respective callback is used for every\n * task in the list. Invoke with `queue.push(task, [callback])`,\n * @property {AsyncFunction} unshift - add a new task to the front of the `queue`.\n * Invoke with `queue.unshift(task, [callback])`.\n * @property {AsyncFunction} pushAsync - the same as `q.push`, except this returns\n * a promise that rejects if an error occurs.\n * @property {AsyncFunction} unshiftAsync - the same as `q.unshift`, except this returns\n * a promise that rejects if an error occurs.\n * @property {Function} remove - remove items from the queue that match a test\n * function.  The test function will be passed an object with a `data` property,\n * and a `priority` property, if this is a\n * [priorityQueue]{@link module:ControlFlow.priorityQueue} object.\n * Invoked with `queue.remove(testFn)`, where `testFn` is of the form\n * `function ({data, priority}) {}` and returns a Boolean.\n * @property {Function} saturated - a function that sets a callback that is\n * called when the number of running workers hits the `concurrency` limit, and\n * further tasks will be queued.  If the callback is omitted, `q.saturated()`\n * returns a promise for the next occurrence.\n * @property {Function} unsaturated - a function that sets a callback that is\n * called when the number of running workers is less than the `concurrency` &\n * `buffer` limits, and further tasks will not be queued. If the callback is\n * omitted, `q.unsaturated()` returns a promise for the next occurrence.\n * @property {number} buffer - A minimum threshold buffer in order to say that\n * the `queue` is `unsaturated`.\n * @property {Function} empty - a function that sets a callback that is called\n * when the last item from the `queue` is given to a `worker`. If the callback\n * is omitted, `q.empty()` returns a promise for the next occurrence.\n * @property {Function} drain - a function that sets a callback that is called\n * when the last item from the `queue` has returned from the `worker`. If the\n * callback is omitted, `q.drain()` returns a promise for the next occurrence.\n * @property {Function} error - a function that sets a callback that is called\n * when a task errors. Has the signature `function(error, task)`. If the\n * callback is omitted, `error()` returns a promise that rejects on the next\n * error.\n * @property {boolean} paused - a boolean for determining whether the queue is\n * in a paused state.\n * @property {Function} pause - a function that pauses the processing of tasks\n * until `resume()` is called. Invoke with `queue.pause()`.\n * @property {Function} resume - a function that resumes the processing of\n * queued tasks when the queue is paused. Invoke with `queue.resume()`.\n * @property {Function} kill - a function that removes the `drain` callback and\n * empties remaining tasks from the queue forcing it to go idle. No more tasks\n * should be pushed to the queue after calling this function. Invoke with `queue.kill()`.\n *\n * @example\n * const q = async.queue(worker, 2)\n * q.push(item1)\n * q.push(item2)\n * q.push(item3)\n * // queues are iterable, spread into an array to inspect\n * const items = [...q] // [item1, item2, item3]\n * // or use for of\n * for (let item of q) {\n *     console.log(item)\n * }\n *\n * q.drain(() => {\n *     console.log('all done')\n * })\n * // or\n * await q.drain()\n */\n\n/**\n * Creates a `queue` object with the specified `concurrency`. Tasks added to the\n * `queue` are processed in parallel (up to the `concurrency` limit). If all\n * `worker`s are in progress, the task is queued until one becomes available.\n * Once a `worker` completes a `task`, that `task`'s callback is called.\n *\n * @name queue\n * @static\n * @memberOf module:ControlFlow\n * @method\n * @category Control Flow\n * @param {AsyncFunction} worker - An async function for processing a queued task.\n * If you want to handle errors from an individual task, pass a callback to\n * `q.push()`. Invoked with (task, callback).\n * @param {number} [concurrency=1] - An `integer` for determining how many\n * `worker` functions should be run in parallel.  If omitted, the concurrency\n * defaults to `1`.  If the concurrency is `0`, an error is thrown.\n * @returns {module:ControlFlow.QueueObject} A queue object to manage the tasks. Callbacks can be\n * attached as certain properties to listen for specific events during the\n * lifecycle of the queue.\n * @example\n *\n * // create a queue object with concurrency 2\n * var q = async.queue(function(task, callback) {\n *     console.log('hello ' + task.name);\n *     callback();\n * }, 2);\n *\n * // assign a callback\n * q.drain(function() {\n *     console.log('all items have been processed');\n * });\n * // or await the end\n * await q.drain()\n *\n * // assign an error callback\n * q.error(function(err, task) {\n *     console.error('task experienced an error');\n * });\n *\n * // add some items to the queue\n * q.push({name: 'foo'}, function(err) {\n *     console.log('finished processing foo');\n * });\n * // callback is optional\n * q.push({name: 'bar'});\n *\n * // add some items to the queue (batch-wise)\n * q.push([{name: 'baz'},{name: 'bay'},{name: 'bax'}], function(err) {\n *     console.log('finished processing item');\n * });\n *\n * // add some items to the front of the queue\n * q.unshift({name: 'bar'}, function (err) {\n *     console.log('finished processing bar');\n * });\n */\nexport default function (worker, concurrency) {\n    var _worker = wrapAsync(worker);\n    return queue((items, cb) => {\n        _worker(items[0], cb);\n    }, concurrency, 1);\n}\n","export enum JingleSessionState {\n\n    /**\n     * The active Jingle session state as defined in XEP-0166\n     * (after 'session-invite'/'session-accept').\n     */\n    ACTIVE = 'active',\n\n    /**\n     * The ended Jingle session state as defined in XEP-0166\n     * (after 'session-terminate').\n     */\n    ENDED = 'ended',\n\n    /**\n     * The pending Jingle session state which means the session as defined in\n     * XEP-0166(before 'session-invite/session-accept' took place).\n     */\n    PENDING = 'pending'\n}\n\n// exported for backward compatibility\nexport const PENDING = JingleSessionState.PENDING;\nexport const ACTIVE = JingleSessionState.ACTIVE;\nexport const ENDED = JingleSessionState.ENDED;\n","/* eslint-disable @typescript-eslint/no-unused-vars */\n/* eslint-disable @typescript-eslint/no-empty-function */\n\nimport { getLogger } from '@jitsi/logger';\n\nimport RTC from '../RTC/RTC';\nimport Listenable from '../util/Listenable';\n\nimport ChatRoom from './ChatRoom';\nimport { JingleSessionState } from './JingleSessionState';\nimport SignalingLayerImpl from './SignalingLayerImpl';\nimport XmppConnection from './XmppConnection';\n\nconst logger = getLogger('xmpp:JingleSession');\n\n/**\n * JingleSession provides an API to manage a single Jingle session. We will\n * have different implementations depending on the underlying interface used\n * (i.e. WebRTC and ORTC) and here we hold the code common to all of them.\n */\nexport default class JingleSession extends Listenable {\n    /**\n     * The signaling layer.\n     * @internal\n     */\n    _signalingLayer: Nullable<SignalingLayerImpl>;\n\n    /**\n     * The Jingle session identifier.\n     */\n    public sid: string;\n\n    /**\n     * Our JID.\n     */\n    public localJid: string;\n\n    /**\n     * The JID of the remote peer.\n     */\n    public remoteJid: string;\n\n    /**\n     * The XMPP connection.\n     */\n    public connection: XmppConnection;\n\n    /**\n     * The media constraints object passed to the PeerConnection onCreateAnswer/Offer.\n     */\n    public mediaConstraints: object;\n\n    /**\n     * The {@code RTCConfiguration} object passed to the PeerConnection's constructor.\n     */\n    public pcConfig: object;\n\n    /**\n     * Indicates whether this instance is an initiator or an answerer of\n     * the Jingle session.\n     */\n    public isInitiator: boolean;\n\n    /**\n     * Whether to use dripping or not. Dripping is sending trickle\n     * candidates not one-by-one.\n     */\n    public usedrip: boolean;\n\n    /**\n     *  When dripping is used, stores ICE candidates which are to be sent.\n     */\n    public dripContainer: RTCIceCandidate[];\n\n    /**\n     * The chat room instance associated with the session.\n     * @internal\n     */\n    room: Nullable<ChatRoom>;\n\n    /**\n     * Jingle session state - uninitialized until {@link initialize} is\n     * called\n     */\n    public state: Nullable<JingleSessionState>;\n\n    /**\n     * The RTC service instance\n     * @internal\n     */\n    rtc: Nullable<RTC>;\n\n    /**\n     * Creates new <tt>JingleSession</tt>.\n     * @param {string} sid the Jingle session identifier\n     * @param {string} localJid our JID\n     * @param {string} remoteJid the JID of the remote peer\n     * @param {XmppConnection} connection the XMPP connection\n     * @param {Object} mediaConstraints the media constraints object passed to the PeerConnection onCreateAnswer/Offer.\n     * @param {Object} pcConfig The {@code RTCConfiguration} object passed to the PeerConnection's constructor.\n     * @param {boolean} isInitiator indicates if it will be the side which initiates the session.\n     */\n    constructor(\n            sid: string,\n            localJid: string,\n            remoteJid: string,\n            connection: XmppConnection,\n            mediaConstraints: object,\n            pcConfig: object,\n            isInitiator: boolean\n    ) {\n        super();\n        this.sid = sid;\n        this.localJid = localJid;\n        this.remoteJid = remoteJid;\n        this.connection = connection;\n        this.mediaConstraints = mediaConstraints;\n        this.pcConfig = pcConfig;\n\n        /**\n         * Indicates whether this instance is an initiator or an answerer of\n         * the Jingle session.\n         * @type {boolean}\n         */\n        this.isInitiator = isInitiator;\n\n        /**\n         * Whether to use dripping or not. Dripping is sending trickle\n         * candidates not one-by-one.\n         */\n        this.usedrip = true;\n\n        /**\n         *  When dripping is used, stores ICE candidates which are to be sent.\n         */\n        this.dripContainer = [];\n\n        /**\n         * The chat room instance associated with the session.\n         * @type {ChatRoom}\n         */\n        this.room = null;\n\n        /**\n         * The signaling layer.\n         * @type {Nullable<SignalingLayerImpl>}\n         * @internal\n         */\n        this._signalingLayer = null;\n\n        /**\n         * Jingle session state - uninitialized until {@link initialize} is\n         * called @type {JingleSessionState}\n         */\n        this.state = null;\n\n        /**\n         * The RTC service instance\n         * @type {RTC}\n         */\n        this.rtc = null;\n    }\n\n    /**\n     * Returns XMPP address of this session's initiator.\n     * @return {string}\n     */\n    get initiatorJid(): string {\n        return this.isInitiator ? this.localJid : this.remoteJid;\n    }\n\n    /**\n     * Returns XMPP address of this session's responder.\n     * @return {string}\n     */\n    get responderJid(): string {\n        return this.isInitiator ? this.remoteJid : this.localJid;\n    }\n\n    /**\n     * The implementing class finishes initialization here. Called at the end of\n     * {@link initialize}.\n     * @param {Object} options - The options specific to the implementing class.\n     * @protected\n     */\n    protected doInitialize(options: object): void { }\n\n    /**\n     * Prepares this object to initiate a session.\n     * @param {ChatRoom} room the chat room for the conference associated with\n     * this session\n     * @param {RTC} rtc the RTC service instance\n     * @param {SignalingLayerImpl} signalingLayer - The signaling layer instance.\n     * @param {object} options - the options, see implementing class's\n     * {@link #doInitialize} description for more details.\n     */\n    public initialize(\n            room: ChatRoom,\n            rtc: RTC,\n            signalingLayer: SignalingLayerImpl,\n            options: object\n    ): void {\n        if (this.state !== null) {\n            const errmsg\n                = `attempt to initiate on session ${this.sid}\n                   in state ${this.state}`;\n\n            logger.error(errmsg);\n            throw new Error(errmsg);\n        }\n\n        // TODO decouple from room\n        this.room = room;\n        this.rtc = rtc;\n        this._signalingLayer = signalingLayer;\n        this.state = JingleSessionState.PENDING;\n        this.doInitialize(options);\n    }\n\n    /**\n     * Adds the ICE candidates found in the 'contents' array as remote\n     * candidates?\n     * Note: currently only used on transport-info\n     *\n     * @param contents\n     */\n    public addIceCandidates(contents: unknown): void {}\n\n    /**\n     * Returns current state of this <tt>JingleSession</tt> instance.\n     * @returns {Nullable<JingleSessionState>} the current state of this session instance.\n     */\n    public getState(): Nullable<JingleSessionState> {\n        return this.state;\n    }\n\n    /**\n     * Handles an 'add-source' event.\n     *\n     * @param contents an array of Jingle 'content' elements.\n     */\n    public addSources(contents: unknown): void {}\n\n    /**\n     * Handles a 'remove-source' event.\n     *\n     * @param contents an array of Jingle 'content' elements.\n     */\n    public removeSources(contents: unknown): void {}\n\n    /**\n     * Terminates this Jingle session by sending session-terminate\n     * @param success a callback called once the 'session-terminate' packet has\n     * been acknowledged with RESULT.\n     * @param failure a callback called when either timeout occurs or ERROR\n     * response is received.\n     * @param {Object} options\n     * @param {string} [options.reason] XMPP Jingle error condition\n     * @param {string} [options.reasonDescription] some meaningful error message\n     * @param {boolean} [options.requestRestart=false] set to true to ask Jicofo to start a new session one this once is\n     * terminated.\n     * @param {boolean} [options.sendSessionTerminate=true] set to false to skip\n     * sending session-terminate. It may not make sense to send it if the XMPP\n     * connection has been closed already or if the remote peer has disconnected\n     */\n    public terminate(\n            success: Optional<(() => void)>,\n            failure: Optional<(() => void)>,\n            options: {\n                reason?: string;\n                reasonDescription?: string;\n                requestRestart?: boolean;\n                sendSessionTerminate?: boolean;\n            }\n    ): void {}\n\n    /**\n     * Handles an offer from the remote peer (prepares to accept a session).\n     * @param jingle the 'jingle' XML element.\n     * @param success callback called when we the incoming session has been\n     * accepted\n     * @param failure callback called when we fail for any reason, will supply\n     * error object with details(which is meant more to be printed to the logger\n     * than analysed in the code, as the error is unrecoverable anyway)\n     */\n    public acceptOffer(\n            jingle: unknown,\n            success: Optional<(() => void)>,\n            failure: Optional<((error: unknown) => void)>\n    ): void {}\n}\n\n","export enum MediaSessionEvents {\n\n    /**\n     * Event triggered when the remote party signals video max frame heights for its local sources.\n     */\n    REMOTE_SOURCE_CONSTRAINTS_CHANGED = 'media_session.REMOTE_SOURCE_CONSTRAINTS_CHANGED',\n\n    /**\n     * Event triggered when the video codec of the local video track has changed.\n     */\n    VIDEO_CODEC_CHANGED = 'media_session.VIDEO_CODEC_CHANGED'\n}\n","import { getLogger } from '@jitsi/logger';\nimport { isEqual } from 'lodash-es';\nimport { $build, $iq, Strophe } from 'strophe.js';\n\nimport { JitsiConferenceEvents } from '../../JitsiConferenceEvents';\nimport { JitsiTrackEvents } from '../../JitsiTrackEvents';\nimport { CodecMimeType } from '../../service/RTC/CodecMimeType';\nimport { MediaDirection } from '../../service/RTC/MediaDirection';\nimport { MediaType } from '../../service/RTC/MediaType';\nimport { SSRC_GROUP_SEMANTICS } from '../../service/RTC/StandardVideoQualitySettings';\nimport { VideoType } from '../../service/RTC/VideoType';\nimport { AnalyticsEvents } from '../../service/statistics/AnalyticsEvents';\nimport { XMPPEvents } from '../../service/xmpp/XMPPEvents';\nimport { XEP } from '../../service/xmpp/XMPPExtensioProtocols';\nimport JitsiLocalTrack from '../RTC/JitsiLocalTrack';\nimport { SS_DEFAULT_FRAME_RATE } from '../RTC/ScreenObtainer';\nimport TraceablePeerConnection, { IAudioQuality, IVideoQuality } from '../RTC/TraceablePeerConnection';\nimport browser from '../browser';\nimport FeatureFlags from '../flags/FeatureFlags';\nimport SDP from '../sdp/SDP';\nimport { SDPDiffer } from '../sdp/SDPDiffer';\nimport SDPUtil from '../sdp/SDPUtil';\nimport Statistics from '../statistics/statistics';\nimport AsyncQueue, { ClearedQueueError } from '../util/AsyncQueue';\nimport { exists, findAll, findFirst, getAttribute } from '../util/XMLUtils';\n\nimport JingleSession from './JingleSession';\nimport { JingleSessionState } from './JingleSessionState';\nimport { MediaSessionEvents } from './MediaSessionEvents';\nimport { handleStropheError } from './StropheErrorHandler';\nimport XmppConnection from './XmppConnection';\n\nconst logger = getLogger('xmpp:JingleSessionPC');\n\n/**\n * Constant tells how long we're going to wait for IQ response, before timeout\n * error is  triggered.\n * @type {number}\n */\nconst IQ_TIMEOUT: number = 10000;\n\n/*\n * The default number of samples (per stat) to keep when webrtc stats gathering\n * is enabled in TraceablePeerConnection.\n */\nconst DEFAULT_MAX_STATS: number = 300;\n\n/**\n * The time duration for which the client keeps gathering ICE candidates to be sent out in a single IQ.\n * @type {number} timeout in ms.\n */\nconst ICE_CAND_GATHERING_TIMEOUT: number = 150;\n\n/**\n * Reads the endpoint ID given a string which represents either the endpoint's full JID, or the endpoint ID itself.\n * @param {String} jidOrEndpointId A string which is either the full JID of a participant, or the ID of an\n * endpoint/participant.\n * @returns The endpoint ID associated with 'jidOrEndpointId'.\n */\nfunction getEndpointId(jidOrEndpointId: string): string {\n    return Strophe.getResourceFromJid(jidOrEndpointId) || jidOrEndpointId;\n}\n\n/**\n * Add \"source\" element as a child of \"description\" element.\n * @param {Object} description The \"description\" element to add to.\n * @param {Object} s Contains properties of the source being added.\n * @param {Number} ssrc_ The SSRC.\n * @param {String} msid The \"msid\" attribute.\n */\nfunction _addSourceElement(description: any, s: any, ssrc_: number, msid: string): void {\n    description.c('source', {\n        name: s.source,\n        ssrc: ssrc_,\n        videoType: s.videoType?.toLowerCase(),\n        xmlns: XEP.SOURCE_ATTRIBUTES\n    })\n        .c('parameter', {\n            name: 'msid',\n            value: msid\n        })\n        .up()\n        .c('ssrc-info', {\n            owner: s.owner,\n            xmlns: 'http://jitsi.org/jitmeet'\n        })\n        .up()\n        .up();\n}\n\n/**\n * @typedef {Object} JingleSessionPCOptions\n * video test ?(ask George).\n * @property {boolean} disableRtx - Described in the config.js[1].\n * @property {boolean} disableSimulcast - Described in the config.js[1].\n * @property {boolean} enableInsertableStreams - Set to true when the insertable streams constraints is to be enabled\n * on the PeerConnection.\n * @property {boolean} failICE - it's an option used in the tests. Set to\n * <tt>true</tt> to block any real candidates and make the ICE fail.\n * @property {boolean} gatherStats - Described in the config.js[1].\n * @property {object} p2p - Peer to peer related options (FIXME those could be\n * fetched from config.p2p on the upper level).\n * @property {Object} testing - Testing and/or experimental options.\n * @property {boolean} webrtcIceUdpDisable - Described in the config.js[1].\n * @property {boolean} webrtcIceTcpDisable - Described in the config.js[1].\n *\n * [1]: https://github.com/jitsi/jitsi-meet/blob/master/config.js\n */\ninterface IJingleSessionPCOptions {\n    audioQuality?: IAudioQuality;\n    channelLastN?: number;\n    codecSettings?: CodecMimeType[];\n    desktopSharingFrameRate?: {\n        max?: number;\n    };\n    disableRtx?: boolean;\n    disableSimulcast?: boolean;\n    enableInsertableStreams?: boolean;\n    failICE?: boolean;\n    forceTurnRelay?: boolean;\n    gatherStats?: boolean;\n    p2p?: object;\n    startSilent?: boolean;\n    testing?: {\n        enableCodecSelectionAPI?: boolean;\n        failICE?: boolean;\n    };\n    videoQuality?: IVideoQuality;\n    webrtcIceTcpDisable?: boolean;\n    webrtcIceUdpDisable?: boolean;\n}\n\n/**\n * Interface for Jingle error objects returned by the error handler.\n */\ninterface IJingleError {\n    code?: string;\n    msg?: string;\n    reason?: string;\n    session?: string;\n}\n\n/**\n * Interface for remote source frame height constraints.\n */\ninterface ISourceFrameHeight {\n    maxHeight: string;\n    sourceName: string;\n}\n\n/**\n * Interface for Jingle session termination options.\n */\nexport interface ITerminateOptions {\n    reason?: string;\n    reasonDescription?: string;\n    requestRestart?: boolean;\n    sendSessionTerminate?: boolean;\n}\n\n/**\n *\n */\nexport default class JingleSessionPC extends JingleSession {\n    private _bridgeSessionId: Nullable<string>;\n    private _cachedOldLocalSdp: Optional<SDP>;\n    private _cachedNewLocalSdp: Optional<SDP>;\n    private _iceCheckingStartedTimestamp: Nullable<number>;\n    private _gatheringStartedTimestamp: Nullable<number>;\n    private _sourceReceiverConstraints: Nullable<Map<string, number>>;\n    private _localSendReceiveVideoActive: boolean;\n    private _remoteSendReceiveVideoActive: boolean;\n    private _gatheringReported: boolean;\n    private _xmppListeners: Array<() => void>;\n    private _removeSenderVideoConstraintsChangeListener: Nullable<() => void>;\n    private usesCodecSelectionAPI: boolean;\n    private wasConnected: boolean;\n    private isReconnect: boolean;\n    private wasstable: boolean;\n    private webrtcIceUdpDisable: boolean;\n    private webrtcIceTcpDisable: boolean;\n    private remoteSourceMaxFrameHeights: ISourceFrameHeight[];\n\n    /**\n     * @internal\n     */\n    isP2P: boolean;\n\n    lasticecandidate: boolean;\n    numRemoteVideoSources: number;\n    numRemoteAudioSources: number;\n    modificationQueue: AsyncQueue;\n    establishmentDuration: Nullable<number>;\n    options: IJingleSessionPCOptions;\n    peerconnection: TraceablePeerConnection;\n    failICE: boolean;\n\n    /**\n     * Parses 'senders' attribute of the video content.\n     * @param {Element} jingleContents\n     * @return {Nullable<string>} one of the values of content \"senders\" attribute\n     * defined by Jingle. If there is no \"senders\" attribute or if the value is\n     * invalid then <tt>null</tt> will be returned.\n     * @private\n     */\n    static parseVideoSenders(jingleContents: Element): Nullable<string> {\n        const videoContents = findFirst(jingleContents, ':scope>content[name=\"video\"]');\n        const senders = getAttribute(videoContents, 'senders');\n\n        if (senders === 'both'\n            || senders === 'initiator'\n            || senders === 'responder'\n            || senders === 'none') {\n            return senders;\n        }\n\n        return null;\n    }\n\n    /**\n     * Parses the source-name and max frame height value of the 'content-modify' IQ when source-name signaling\n     * is enabled.\n     *\n     * @param {Element} jingleContents - An element pointing to the '>jingle' element.\n     * @returns {Nullable<Object>}\n     */\n    static parseSourceMaxFrameHeight(jingleContents: Element): Nullable<ISourceFrameHeight[]> {\n        const receiverConstraints: ISourceFrameHeight[] = [];\n        const sourceFrameHeightSel = findAll(jingleContents, ':scope>content[name=\"video\"]>source-frame-height');\n        let maxHeight: string, sourceName: string;\n\n        if (sourceFrameHeightSel.length) {\n            sourceFrameHeightSel.forEach(source => {\n                sourceName = source.getAttribute('sourceName');\n                maxHeight = source.getAttribute('maxHeight');\n                receiverConstraints.push({\n                    maxHeight,\n                    sourceName\n                });\n            });\n\n            return receiverConstraints;\n        }\n\n        return null;\n    }\n\n    /* eslint-disable max-params */\n\n    /**\n     * Creates new <tt>JingleSessionPC</tt>\n     * @param {string} sid the Jingle Session ID - random string which identifies the session\n     * @param {string} localJid our JID\n     * @param {string} remoteJid remote peer JID\n     * @param {XmppConnection} connection - The XMPP connection instance.\n     * @param mediaConstraints the media constraints object passed to createOffer/Answer, as defined\n     * by the WebRTC standard\n     * @param pcConfig The {@code RTCConfiguration} to use for the WebRTC peer connection.\n     * @param {boolean} isP2P indicates whether this instance is meant to be used in a direct, peer to\n     * peer connection or <tt>false</tt> if it's a JVB connection.\n     * @param {boolean} isInitiator indicates if it will be the side which initiates the session.\n     * @constructor\n     *\n     * @implements {SignalingLayer}\n     */\n    constructor(\n            sid: string,\n            localJid: string,\n            remoteJid: string,\n            connection: XmppConnection,\n            mediaConstraints: MediaStreamConstraints,\n            pcConfig: RTCConfiguration,\n            isP2P: boolean,\n            isInitiator: boolean) {\n        super(\n            sid,\n            localJid,\n            remoteJid, connection, mediaConstraints, pcConfig, isInitiator);\n\n        /**\n         * The bridge session's identifier. One Jingle session can during\n         * it's lifetime participate in multiple bridge sessions managed by\n         * Jicofo. A new bridge session is started whenever Jicofo sends\n         * 'session-initiate'.\n         *\n         * @type {?string}\n         * @private\n         */\n        this._bridgeSessionId = null;\n\n        /**\n         * The oldest SDP passed to {@link notifyMySSRCUpdate} while the XMPP connection was offline that will be\n         * used to update Jicofo once the XMPP connection goes back online.\n         * @type {Optional<SDP>}\n         * @private\n         */\n        this._cachedOldLocalSdp = undefined;\n\n        /**\n         * The latest SDP passed to {@link notifyMySSRCUpdate} while the XMPP connection was offline that will be\n         * used to update Jicofo once the XMPP connection goes back online.\n         * @type {Optional<SDP>}\n         * @private\n         */\n        this._cachedNewLocalSdp = undefined;\n\n        /**\n         * Stores result of {@link window.performance.now()} at the time when\n         * ICE enters 'checking' state.\n         * @type {Nullable<number>}\n         * @private\n         */\n        this._iceCheckingStartedTimestamp = null;\n\n        /**\n         * Stores result of {@link window.performance.now()} at the time when\n         * first ICE candidate is spawned by the peerconnection to mark when\n         * ICE gathering started. That's, because ICE gathering state changed\n         * events are not supported by most of the browsers, so we try something\n         * that will work everywhere. It may not be as accurate, but given that\n         * 'host' candidate usually comes first, the delay should be minimal.\n         * @type {Nullable<number>} null if no value has been stored yet\n         * @private\n         */\n        this._gatheringStartedTimestamp = null;\n\n        /**\n         * Receiver constraints (max height) set by the application per remote source. Will be used for p2p connection.\n         *\n         * @type {Map<string, number>}\n         */\n        this._sourceReceiverConstraints = undefined;\n\n        /**\n         * Indicates whether or not this session is willing to send/receive\n         * video media. When set to <tt>false</tt> the underlying peer\n         * connection will disable local video transfer and the remote peer will\n         * be will be asked to stop sending video via 'content-modify' IQ\n         * (the senders attribute of video contents will be adjusted\n         * accordingly). Note that this notification is sent only in P2P\n         * session, because Jicofo does not support it yet. Obviously when\n         * the value is changed from <tt>false</tt> to <tt>true</tt> another\n         * notification will be sent to resume video transfer on the remote\n         * side.\n         * @type {boolean}\n         * @private\n         */\n        this._localSendReceiveVideoActive = true;\n\n        /**\n         * Indicates whether or not the remote peer has video transfer active.\n         * When set to <tt>true</tt> it means that remote peer is neither\n         * sending nor willing to receive video. In such case we'll ask\n         * our peerconnection to stop sending video by calling\n         * {@link TraceablePeerConnection.setVideoTransferActive} with\n         * <tt>false</tt>.\n         * @type {boolean}\n         * @private\n         */\n        this._remoteSendReceiveVideoActive = true;\n\n        /**\n         * Marks that ICE gathering duration has been reported already. That\n         * prevents reporting it again.\n         * @type {boolean}\n         * @private\n         */\n        this._gatheringReported = false;\n\n        this.lasticecandidate = false;\n\n        /**\n         * Indicates whether or not this <tt>JingleSessionPC</tt> is used in\n         * a peer to peer type of session.\n         * @type {boolean} <tt>true</tt> if it's a peer to peer\n         * session or <tt>false</tt> if it's a JVB session\n         */\n        this.isP2P = isP2P;\n\n        /**\n         * Number of remote video sources, in SSRC rewriting mode.\n         * Used to generate next unique msid attribute.\n         *\n         * @type {Number}\n         */\n        this.numRemoteVideoSources = 0;\n\n        /**\n         * Number of remote audio sources, in SSRC rewriting mode.\n         * Used to generate next unique msid attribute.\n         *\n         * @type {Number}\n         */\n        this.numRemoteAudioSources = 0;\n\n        /**\n         * Remote preference for the receive video max frame heights when source-name signaling is enabled.\n         *\n         * @type {Optional<Map<string, number>>}\n         * @private\n         */\n        this.remoteSourceMaxFrameHeights = undefined;\n\n        /**\n         * The queue used to serialize operations done on the peerconnection after the session is established.\n         * The queue is paused until the first offer/answer cycle is complete. Only track or codec related\n         * operations which necessitate a renegotiation cycle need to be pushed to the modification queue.\n         * These tasks will be executed after the session has been established.\n         *\n         * @type {AsyncQueue}\n         */\n        this.modificationQueue = new AsyncQueue();\n        this.modificationQueue.pause();\n\n        /**\n         * Flag used to guarantee that the connection established event is\n         * triggered just once.\n         * @type {boolean}\n         */\n        this.wasConnected = false;\n\n        /**\n         * Keeps track of how long (in ms) it took from ICE start to ICE\n         * connect.\n         *\n         * @type {number}\n         */\n        this.establishmentDuration = undefined;\n\n        this._xmppListeners = [];\n        this._xmppListeners.push(\n            connection.addCancellableListener(\n                XmppConnection.Events.CONN_STATUS_CHANGED,\n                this.onXmppStatusChanged.bind(this))\n        );\n\n        this._removeSenderVideoConstraintsChangeListener = undefined;\n    }\n\n    /**\n     * Handles either Jingle 'source-add' or 'source-remove' message for this Jingle session.\n     *\n     * @param {boolean} isAdd <tt>true</tt> for 'source-add' or <tt>false</tt> otherwise.\n     * @param {Array<Element>} elem an array of Jingle \"content\" elements.\n     * @returns {Promise} resolved when the operation is done or rejected with an error.\n     */\n    private _addOrRemoveRemoteStream(isAdd: boolean, elem: Element[]): void {\n        const logPrefix = isAdd ? 'addRemoteStream' : 'removeRemoteStream';\n        const workFunction = (finishedCallback: (error) => void) => {\n            if (!this.peerconnection.remoteDescription?.sdp) {\n                const errMsg = `${logPrefix} - received before remoteDescription is set, ignoring!!`;\n\n                logger.error(errMsg);\n                finishedCallback(errMsg);\n\n                return;\n            }\n\n            logger.debug(`${this} Processing ${logPrefix}`);\n\n            const currentRemoteSdp = new SDP(this.peerconnection.remoteDescription.sdp, this.isP2P);\n            const sourceDescription = this._processSourceMapFromJingle(elem, isAdd);\n\n            if (!sourceDescription.size) {\n                logger.debug(`${this} ${logPrefix} - no sources to ${isAdd ? 'add' : 'remove'}`);\n                finishedCallback(undefined);\n            }\n\n            logger.debug(`${isAdd ? 'adding' : 'removing'} sources=${Array.from(sourceDescription.keys())}`);\n\n            // Update the remote description.\n            const modifiedMids = currentRemoteSdp.updateRemoteSources(sourceDescription, isAdd);\n\n            for (const mid of modifiedMids) {\n                if (this.isP2P) {\n                    const { media } = SDPUtil.parseMLine(currentRemoteSdp.media[mid].split('\\r\\n')[0]);\n                    const desiredDirection = this.peerconnection.getDesiredMediaDirection(media as MediaType, isAdd);\n                    const currentDirections = isAdd ? [ MediaDirection.RECVONLY, MediaDirection.INACTIVE ]\n                        : [ MediaDirection.SENDRECV, MediaDirection.SENDONLY ];\n\n                    currentDirections.forEach(direction => {\n                        currentRemoteSdp.media[mid] = currentRemoteSdp.media[mid]\n                            .replace(`a=${direction}`, `a=${desiredDirection}`);\n                    });\n                    currentRemoteSdp.raw = currentRemoteSdp.session + currentRemoteSdp.media.join('');\n                }\n            }\n\n            this._renegotiate(currentRemoteSdp.raw).then(() => {\n                logger.debug(`${this} ${logPrefix} - OK`);\n                finishedCallback(undefined);\n            }, error => {\n                logger.error(`${this} ${logPrefix} failed:`, error);\n                finishedCallback(error);\n            });\n        };\n\n        logger.debug(`${this} Queued ${logPrefix} task`);\n\n        // Queue and execute\n        this.modificationQueue.push(workFunction);\n    }\n\n    /**\n     * See {@link addTrackToPc} and {@link removeTrackFromPc}.\n     *\n     * @param {boolean} isRemove <tt>true</tt> for \"remove\" operation or <tt>false</tt> for \"add\" operation.\n     * @param {JitsiLocalTrack} track the track that will be added/removed.\n     * @returns {Promise} resolved when the operation is done or rejected with an error.\n     */\n    private _addRemoveTrack(isRemove: boolean, track: JitsiLocalTrack): Promise<void> {\n        if (!track) {\n            return Promise.reject('invalid \"track\" argument value');\n        }\n        const operationName = isRemove ? 'removeTrack' : 'addTrack';\n        const workFunction = finishedCallback => {\n            const tpc = this.peerconnection;\n\n            if (!tpc) {\n                finishedCallback(`Error:  tried ${operationName} track with no active peer connection`);\n\n                return;\n            }\n            const operationPromise\n                = isRemove\n                    ? tpc.removeTrackFromPc(track)\n                    : tpc.addTrackToPc(track);\n\n            operationPromise\n                .then(shouldRenegotiate => {\n                    if (shouldRenegotiate) {\n                        this._renegotiate().then(finishedCallback);\n                    } else {\n                        finishedCallback();\n                    }\n                },\n                finishedCallback /* will be called with an error */);\n        };\n\n        logger.debug(`${this} Queued ${operationName} task`);\n\n        return new Promise((resolve, reject) => {\n            this.modificationQueue.push(\n                workFunction,\n                error => {\n                    if (error) {\n                        if (error instanceof ClearedQueueError) {\n                            // The session might have been terminated before the task was executed, making it obsolete.\n                            logger.debug(`${this} ${operationName} aborted: session terminated`);\n                            resolve();\n\n                            return;\n                        }\n                        logger.error(`${this} ${operationName} failed`);\n                        reject(error);\n                    } else {\n                        logger.debug(`${this} ${operationName} done`);\n                        resolve();\n                    }\n                });\n        });\n    }\n\n    /**\n     * Checks whether or not this session instance is still operational.\n     *\n     * @returns {boolean} {@code true} if operation or {@code false} otherwise.\n     */\n    private _assertNotEnded(): boolean {\n        return this.state !== JingleSessionState.ENDED;\n    }\n\n    /**\n     * Takes in a jingle offer iq, returns the new sdp offer that can be set as remote description in the\n     * peerconnection.\n     *\n     * @param {Element} offerIq the incoming offer.\n     * @returns {SDP object} the jingle offer translated to SDP.\n     */\n    private _processNewJingleOfferIq(offerIq: Element): SDP {\n        const remoteSdp = new SDP('', this.isP2P);\n\n        if (this.webrtcIceTcpDisable) {\n            remoteSdp.removeTcpCandidates = true;\n        }\n        if (this.webrtcIceUdpDisable) {\n            remoteSdp.removeUdpCandidates = true;\n        }\n        if (this.failICE) {\n            remoteSdp.failICE = true;\n        }\n\n        remoteSdp.fromJingle(offerIq);\n        this._processSourceMapFromJingle(findAll(offerIq, ':scope>content'));\n\n        return remoteSdp;\n    }\n\n    /**\n     * Parses the SSRC information from the source-add/source-remove element passed and updates the SSRC owners.\n     *\n     * @param {Object} sourceElement the source-add/source-remove element from jingle.\n     * @param {boolean} isAdd true if the sources are being added, false if they are to be removed.\n     * @returns {Map<string, Object>} - The map of source name to ssrcs, msid and groups.\n     */\n    private _processSourceMapFromJingle(sourceElement: object, isAdd: boolean = true): Map<string, object> {\n        /**\n         * Map of source name to ssrcs, mediaType, msid and groups.\n         * @type {Map<string,\n         *  {\n         *      mediaType: string,\n         *      msid: string,\n         *      ssrcList: Array<number>,\n         *      groups: ISsrcGroupInfo\n         *  }>}\n         */\n        const sourceDescription = new Map();\n        const sourceElementArray = Array.isArray(sourceElement) ? sourceElement : [ sourceElement ];\n\n        for (const content of sourceElementArray) {\n            const descriptionsWithSources\n                = findAll(content, ':scope>description').filter((el: Element) => exists(el, ':scope>source'));\n\n            for (const description of descriptionsWithSources) {\n                const mediaType = getAttribute(description, 'media');\n\n                if (mediaType === MediaType.AUDIO && this.options.startSilent) {\n\n                    // eslint-disable-next-line no-continue\n                    continue;\n                }\n\n                // Get direct source children, excluding those inside ssrc-group elements\n                const sources = findAll(description, ':scope>source');\n                const removeSsrcs = [];\n\n                for (const source of sources) {\n                    const ssrc = getAttribute(source, 'ssrc');\n                    const sourceName = getAttribute(source, 'name');\n                    const msid = getAttribute(findFirst(source, ':scope>parameter[name=\"msid\"]'), 'value');\n                    let videoType = getAttribute(source, 'videoType');\n\n                    // If the videoType is DESKTOP_HIGH_FPS for remote tracks, we should treat it as DESKTOP.\n                    if (videoType === VideoType.DESKTOP_HIGH_FPS) {\n                        videoType = VideoType.DESKTOP;\n                    }\n\n                    if (sourceDescription.has(sourceName)) {\n                        sourceDescription.get(sourceName).ssrcList?.push(ssrc);\n                    } else {\n                        sourceDescription.set(sourceName, {\n                            groups: [],\n                            mediaType,\n                            msid,\n                            ssrcList: [ ssrc ],\n                            videoType\n                        });\n                    }\n\n                    // Update the source owner and source name.\n                    // Use *|xmlns to match xmlns attributes across any namespace (CSS Selectors Level 3)\n                    const owner = getAttribute(\n                        findFirst(source, ':scope>ssrc-info[*|xmlns=\"http://jitsi.org/jitmeet\"]'), 'owner');\n\n                    if (owner && isAdd) {\n                        // JVB source-add.\n                        this._signalingLayer.setSSRCOwner(Number(ssrc), getEndpointId(owner), sourceName);\n                    } else if (isAdd) {\n                        // P2P source-add.\n                        this._signalingLayer.setSSRCOwner(Number(ssrc),\n                            Strophe.getResourceFromJid(this.remoteJid), sourceName);\n                    } else {\n                        removeSsrcs.push(Number(ssrc));\n                    }\n                }\n\n                // 'source-remove' from remote peer.\n                removeSsrcs.length && this._signalingLayer.removeSSRCOwners(removeSsrcs);\n\n                findAll(description, ':scope>ssrc-group').forEach(group => {\n                    const semantics = getAttribute(group, 'semantics');\n                    const groupSsrcs = [];\n\n                    findAll(group, ':scope>source').forEach(source => {\n                        groupSsrcs.push(getAttribute(source, 'ssrc'));\n                    });\n\n                    for (const [ sourceName, { ssrcList } ] of sourceDescription) {\n                        if (isEqual(ssrcList.slice().sort(), groupSsrcs.slice().sort())) {\n                            sourceDescription.get(sourceName).groups.push({\n                                semantics,\n                                ssrcs: groupSsrcs\n                            });\n                        }\n                    }\n                });\n            }\n        }\n\n        sourceDescription.size && this.peerconnection.updateRemoteSources(sourceDescription, isAdd);\n\n        return sourceDescription;\n    }\n\n    /**\n     * Does a new offer/answer flow using the existing remote description (if not provided) and signals any new sources\n     * to Jicofo or the remote peer.\n     *\n     * @param {string} [optionalRemoteSdp] optional, raw remote sdp to use.  If not provided, the remote sdp from the\n     * peerconnection will be used.\n     * @returns {Promise} promise which resolves when the o/a flow is complete with no arguments or rejects with an\n     * error {string}\n     */\n    private async _renegotiate(optionalRemoteSdp?: string): Promise<void> {\n        if (this.peerconnection.signalingState === 'closed') {\n            throw new Error('Attempted to renegotiate in state closed');\n        }\n\n        const remoteSdp = optionalRemoteSdp || this.peerconnection.remoteDescription.sdp;\n\n        if (!remoteSdp) {\n            throw new Error(`Cannot renegotiate without remote description, state=${this.state}`);\n        }\n\n        const remoteDescription = {\n            sdp: remoteSdp,\n            type: 'offer'\n        } as RTCSessionDescription;\n\n        const oldLocalSDP = this.peerconnection.localDescription.sdp;\n\n        logger.debug(`${this} Renegotiate: setting remote description`);\n\n        try {\n            await this.peerconnection.setRemoteDescription(remoteDescription);\n            logger.debug(`${this} Renegotiate: creating answer`);\n            const answer = await this.peerconnection.createAnswer(this.mediaConstraints as RTCOfferOptions);\n\n            logger.debug(`${this} Renegotiate: setting local description`);\n            await this.peerconnection.setLocalDescription(answer);\n            if (oldLocalSDP) {\n                // Send the source updates after every renegotiation cycle.\n                this.notifyMySSRCUpdate(new SDP(oldLocalSDP), new SDP(this.peerconnection.localDescription.sdp));\n            }\n        } catch (error) {\n            logger.error(`${this} Renegotiate failed:`, error);\n            throw error;\n        }\n    }\n\n    /**\n     * Sends 'content-modify' IQ in order to ask the remote peer to either stop or resume sending video media or to\n     * adjust sender's video constraints.\n     *\n     * @returns {void}\n     */\n    private _sendContentModify() {\n        const senders = this._localSendReceiveVideoActive ? 'both' : 'none';\n        const sessionModify\n            = $iq({\n                to: this.remoteJid,\n                type: 'set'\n            })\n                .c('jingle', {\n                    action: 'content-modify',\n                    initiator: this.initiatorJid,\n                    sid: this.sid,\n                    xmlns: 'urn:xmpp:jingle:1'\n                })\n                .c('content', {\n                    name: MediaType.VIDEO,\n                    senders\n                });\n\n        if (typeof this._sourceReceiverConstraints !== 'undefined') {\n            this._sourceReceiverConstraints.forEach((maxHeight, sourceName) => {\n                sessionModify\n                    .c('source-frame-height', { xmlns: 'http://jitsi.org/jitmeet/video' })\n                    .attrs({\n                        maxHeight,\n                        sourceName\n                    });\n\n                sessionModify.up();\n                logger.info(`${this} sending content-modify for source-name: ${sourceName}, maxHeight: ${maxHeight}`);\n            });\n        }\n\n        logger.debug(sessionModify.tree());\n\n        this.connection.sendIQ(\n            sessionModify,\n            null,\n            this.newJingleErrorHandler(),\n            IQ_TIMEOUT);\n    }\n\n    /**\n     * Sends given candidate in Jingle 'transport-info' message.\n     *\n     * @param {RTCIceCandidate} candidate the WebRTC ICE candidate instance\n     * @returns {void}\n     */\n    private _sendIceCandidate(candidate: RTCIceCandidate): void {\n        const localSDP = new SDP(this.peerconnection.localDescription.sdp);\n\n        if (candidate?.candidate.length && !this.lasticecandidate) {\n            const ice = SDPUtil.iceparams(localSDP.media[candidate.sdpMLineIndex], localSDP.session);\n            const jcand = SDPUtil.candidateToJingle(candidate.candidate);\n\n            if (!(ice && jcand)) {\n                logger.error('failed to get ice && jcand');\n\n                return;\n            }\n            ice.xmlns = XEP.ICE_UDP_TRANSPORT;\n\n            if (this.usedrip) {\n                if (this.dripContainer.length === 0) {\n                    setTimeout(() => {\n                        if (this.dripContainer.length === 0) {\n                            return;\n                        }\n                        this._sendIceCandidates(this.dripContainer);\n                        this.dripContainer = [];\n                    }, ICE_CAND_GATHERING_TIMEOUT);\n                }\n                this.dripContainer.push(candidate);\n            } else {\n                this._sendIceCandidates([ candidate ]);\n            }\n        } else {\n            logger.debug(`${this} _sendIceCandidate: last candidate`);\n\n            // FIXME: remember to re-think in ICE-restart\n            this.lasticecandidate = true;\n        }\n    }\n\n    /**\n     * Sends given candidates in Jingle 'transport-info' message.\n     *\n     * @param {Array<RTCIceCandidate>} candidates an array of the WebRTC ICE candidate instances.\n     * @returns {void}\n     */\n    private _sendIceCandidates(candidates: RTCIceCandidate[]): void {\n        if (!this._assertNotEnded()) {\n\n            return;\n        }\n\n        logger.debug(`${this} _sendIceCandidates count: ${candidates?.length}`);\n        const cand = $iq({ to: this.remoteJid,\n            type: 'set' })\n            .c('jingle', { action: 'transport-info',\n                initiator: this.initiatorJid,\n                sid: this.sid,\n                xmlns: 'urn:xmpp:jingle:1' });\n\n        const localSDP = new SDP(this.peerconnection.localDescription.sdp);\n\n        for (let mid = 0; mid < localSDP.media.length; mid++) {\n            const cands = candidates.filter(el => el.sdpMLineIndex === mid);\n            const mline\n                = SDPUtil.parseMLine(localSDP.media[mid].split('\\r\\n')[0]);\n\n            if (cands.length > 0) {\n                const ice\n                    = SDPUtil.iceparams(localSDP.media[mid], localSDP.session);\n\n                ice.xmlns = XEP.ICE_UDP_TRANSPORT;\n                cand.c('content', {\n                    creator: this.initiatorJid === this.localJid\n                        ? 'initiator' : 'responder',\n                    name: cands[0].sdpMid ? cands[0].sdpMid : mline.media\n                }).c('transport', ice);\n                for (let i = 0; i < cands.length; i++) {\n                    const candidate\n                        = SDPUtil.candidateToJingle(cands[i].candidate);\n\n                    // Mangle ICE candidate if 'failICE' test option is enabled\n\n                    if (this.failICE) {\n                        candidate.ip = '1.1.1.1';\n                    }\n                    cand.c('candidate', candidate).up();\n                }\n\n                // add fingerprint\n                const fingerprintLine\n                    = SDPUtil.findLine(\n                        localSDP.media[mid],\n                        'a=fingerprint:', localSDP.session);\n\n                if (fingerprintLine) {\n                    const tmp = SDPUtil.parseFingerprint(fingerprintLine);\n\n                    tmp.required = true;\n                    cand.c(\n                        'fingerprint',\n                        { xmlns: 'urn:xmpp:jingle:apps:dtls:0' })\n                        .t(tmp.fingerprint);\n                    delete tmp.fingerprint;\n                    cand.attrs(tmp);\n                    cand.up();\n                }\n                cand.up(); // transport\n                cand.up(); // content\n            }\n        }\n\n        // might merge last-candidate notification into this, but it is called\n        // a lot later. See webrtc issue #2340\n        // logger.debug('was this the last candidate', this.lasticecandidate);\n        this.connection.sendIQ(\n            cand, null, this.newJingleErrorHandler(), IQ_TIMEOUT);\n    }\n\n    /**\n     * Sends Jingle 'session-accept' message.\n     *\n     * @param {function()} success callback called when we receive 'RESULT' packet for the 'session-accept'.\n     * @param {function(error)} failure called when we receive an error response or when the request has timed out.\n     * @returns {void}\n     */\n    private _sendSessionAccept(success: () => void, failure: (error: IJingleError) => void) {\n        // NOTE: since we're just reading from it, we don't need to be within\n        //  the modification queue to access the local description\n        const localSDP = new SDP(this.peerconnection.localDescription.sdp, this.isP2P);\n        const accept = $iq({ to: this.remoteJid,\n            type: 'set' })\n            .c('jingle', {\n                action: 'session-accept',\n                initiator: this.initiatorJid,\n                responder: this.responderJid,\n                sid: this.sid,\n                xmlns: 'urn:xmpp:jingle:1'\n            });\n\n        if (this.webrtcIceTcpDisable) {\n            localSDP.removeTcpCandidates = true;\n        }\n        if (this.webrtcIceUdpDisable) {\n            localSDP.removeUdpCandidates = true;\n        }\n        if (this.failICE) {\n            localSDP.failICE = true;\n        }\n        if (typeof this.options.channelLastN === 'number' && this.options.channelLastN >= 0) {\n            // @ts-ignore will be fixed after merge of sdp\n            localSDP.initialLastN = this.options.channelLastN;\n        }\n        localSDP.toJingle(\n            accept,\n            this.initiatorJid === this.localJid ? 'initiator' : 'responder');\n\n        logger.info(`${this} Sending session-accept`);\n        logger.debug(accept.tree());\n        this.connection.sendIQ(accept,\n            success,\n            this.newJingleErrorHandler(error => {\n                failure(error);\n\n                // 'session-accept' is a critical timeout and we'll\n                // have to restart\n                this.room.eventEmitter.emit(\n                    XMPPEvents.SESSION_ACCEPT_TIMEOUT, this);\n            }),\n            IQ_TIMEOUT);\n\n        // XXX Videobridge needs WebRTC's answer (ICE ufrag and pwd, DTLS\n        // fingerprint and setup) ASAP in order to start the connection\n        // establishment.\n        //\n        // FIXME Flushing the connection at this point triggers an issue with\n        // BOSH request handling in Prosody on slow connections.\n        //\n        // The problem is that this request will be quite large and it may take\n        // time before it reaches Prosody. In the meantime Strophe may decide\n        // to send the next one. And it was observed that a small request with\n        // 'transport-info' usually follows this one. It does reach Prosody\n        // before the previous one was completely received. 'rid' on the server\n        // is increased and Prosody ignores the request with 'session-accept'.\n        // It will never reach Jicofo and everything in the request table is\n        // lost. Removing the flush does not guarantee it will never happen, but\n        // makes it much less likely('transport-info' is bundled with\n        // 'session-accept' and any immediate requests).\n        //\n        // this.connection.flush();\n    }\n\n    /**\n     * Sends 'session-initiate' to the remote peer.\n     *\n     * NOTE this method is synchronous and we're not waiting for the RESULT\n     * response which would delay the startup process.\n     *\n     * @param {string} offerSdp  - The local session description which will be used to generate an offer.\n     * @returns {void}\n     */\n    private _sendSessionInitiate(offerSdp: string): void {\n        let init = $iq({\n            to: this.remoteJid,\n            type: 'set'\n        }).c('jingle', {\n            action: 'session-initiate',\n            initiator: this.initiatorJid,\n            sid: this.sid,\n            xmlns: 'urn:xmpp:jingle:1'\n        });\n\n        new SDP(offerSdp, this.isP2P).toJingle(\n            init,\n            this.isInitiator ? 'initiator' : 'responder');\n        init = init.tree();\n        logger.debug(`${this} Session-initiate: `, init);\n        this.connection.sendIQ(init,\n            () => {\n                logger.info(`${this} Got RESULT for \"session-initiate\"`);\n            },\n            error => {\n                handleStropheError(error, {\n                    isP2P: this.isP2P,\n                    operation: 'session-initiate',\n                    remoteJid: this.remoteJid,\n                    roomJid: this.room?.roomjid,\n                    session: this.toString(),\n                    sid: this.sid,\n                    userJid: this.connection.jid\n                });\n            },\n            IQ_TIMEOUT);\n    }\n\n\n    /**\n     * Method returns function(errorResponse) which is a callback to be passed to Strophe connection.sendIQ method. An\n     * 'error' structure is created that is passed as 1st argument to given <tt>failureCb</tt>. The format of this\n     * structure is as follows:\n     * {\n     *  code: {XMPP error response code}\n     *  reason: {the name of XMPP error reason element or 'timeout' if the\n      *          request has timed out within <tt>IQ_TIMEOUT</tt> milliseconds}\n     *  source: {request.tree() that provides original request}\n     *  session: {this JingleSessionPC.toString()}\n     * }\n     * @param failureCb function(error) called when error response was returned or when a timeout has occurred.\n     * @returns {function(this:JingleSessionPC)}\n     */\n    private newJingleErrorHandler(failureCb?: (error: IJingleError) => void): ErrorCallback {\n        return errResponse => {\n            const error: IJingleError = {\n                code: undefined,\n                msg: undefined,\n                reason: undefined,\n                session: undefined\n            };\n\n            if (errResponse instanceof Element) {\n                // Get XMPP error code and condition(reason)\n                const errorElSel = findFirst(errResponse, 'error');\n\n                if (errorElSel) {\n                    error.code = getAttribute(errorElSel, 'code');\n                    const errorResponseChildren = errorElSel.children;\n\n                    if (errorResponseChildren.length) {\n                        error.reason = errorResponseChildren[0].tagName;\n                    }\n                }\n            }\n\n            if (!errResponse) {\n                error.reason = 'timeout';\n            }\n\n            // When remote peer decides to terminate the session, but it still has few messages on the queue for\n            // processing, it will first send us 'session-terminate' (we enter ENDED) and then follow with\n            // 'item-not-found' for the queued requests. These 'item-not-found' errors can be ignored.\n            const ignoreErrors = this.state === JingleSessionState.ENDED && error?.reason === 'item-not-found';\n\n            if (!ignoreErrors) {\n                failureCb?.(error);\n\n                // Call handleStropheError for centralized error logging and analytics.\n                handleStropheError(errResponse, {\n                    isP2P: this.isP2P,\n                    operation: 'Jingle IQ',\n                    remoteJid: this.remoteJid,\n                    roomJid: this.room?.roomjid,\n                    session: this.toString(),\n                    sid: this.sid,\n                    state: this.state,\n                    userJid: this.connection.jid\n                });\n            }\n        };\n    }\n\n    /**\n     * Figures out added/removed ssrcs and sends updated IQs to the remote peer or Jicofo.\n     *\n     * @param oldSDP SDP object for old description.\n     * @param newSDP SDP object for new description.\n     * @returns {void}\n     */\n    private notifyMySSRCUpdate(oldSDP: SDP, newSDP: SDP): void {\n        if (this.state !== JingleSessionState.ACTIVE) {\n            logger.warn(`${this} Skipping SSRC update in '${this.state} ' state.`);\n\n            return;\n        }\n\n        if (!this.connection.connected) {\n            // The goal is to compare the oldest SDP with the latest one upon reconnect\n            if (!this._cachedOldLocalSdp) {\n                this._cachedOldLocalSdp = oldSDP;\n            }\n            this._cachedNewLocalSdp = newSDP;\n            logger.warn(`${this} Not sending SSRC update while the signaling is disconnected`);\n\n            return;\n        }\n\n        this._cachedOldLocalSdp = undefined;\n        this._cachedNewLocalSdp = undefined;\n\n        const getSignaledSourceInfo = sdpDiffer => {\n            const newMedia = sdpDiffer.getNewMedia();\n            let ssrcs = [];\n            let mediaType = null;\n\n            // It is assumed that sources are signaled one at a time.\n            Object.keys(newMedia).forEach(mediaIndex => {\n                const signaledSsrcs = Object.keys(newMedia[mediaIndex].ssrcs);\n\n                mediaType = newMedia[mediaIndex].mediaType;\n                if (signaledSsrcs?.length) {\n                    ssrcs = ssrcs.concat(signaledSsrcs);\n                }\n            });\n\n            return {\n                mediaType,\n                ssrcs\n            };\n        };\n\n        // send source-remove IQ.\n        let sdpDiffer = new SDPDiffer(newSDP, oldSDP, this.isP2P);\n        const remove = $iq({ to: this.remoteJid,\n            type: 'set' })\n            .c('jingle', {\n                action: 'source-remove',\n                initiator: this.initiatorJid,\n                sid: this.sid,\n                xmlns: 'urn:xmpp:jingle:1'\n            }\n            );\n\n        sdpDiffer.toJingle(remove);\n\n        // context a common object for one run of ssrc update (source-add and source-remove) so we can match them if we\n        // need to\n        const ctx = {};\n        const removedSsrcInfo = getSignaledSourceInfo(sdpDiffer);\n\n        if (removedSsrcInfo.ssrcs.length) {\n            // Log only the SSRCs instead of the full IQ.\n            logger.info(`${this} Sending source-remove for ${removedSsrcInfo.mediaType}`\n                + ` ssrcs=${removedSsrcInfo.ssrcs}`);\n            this.connection.sendIQ(\n                remove,\n                () => {\n                    this.room.eventEmitter.emit(XMPPEvents.SOURCE_REMOVE, this, ctx);\n                },\n                this.newJingleErrorHandler(error => {\n                    this.room.eventEmitter.emit(XMPPEvents.SOURCE_REMOVE_ERROR, this, error, ctx);\n                }),\n                IQ_TIMEOUT);\n        }\n\n        // send source-add IQ.\n        sdpDiffer = new SDPDiffer(oldSDP, newSDP, this.isP2P);\n        const add = $iq({ to: this.remoteJid,\n            type: 'set' })\n            .c('jingle', {\n                action: 'source-add',\n                initiator: this.initiatorJid,\n                sid: this.sid,\n                xmlns: 'urn:xmpp:jingle:1'\n            }\n            );\n\n        sdpDiffer.toJingle(add);\n        const addedSsrcInfo = getSignaledSourceInfo(sdpDiffer);\n\n        if (addedSsrcInfo.ssrcs.length) {\n            // Log only the SSRCs instead of the full IQ.\n            logger.info(`${this} Sending source-add for ${addedSsrcInfo.mediaType} ssrcs=${addedSsrcInfo.ssrcs}`);\n            this.connection.sendIQ(\n                add,\n                () => {\n                    this.room.eventEmitter.emit(XMPPEvents.SOURCE_ADD, this, ctx);\n                },\n                this.newJingleErrorHandler(error => {\n                    this.room.eventEmitter.emit(XMPPEvents.SOURCE_ADD_ERROR, this, error, addedSsrcInfo.mediaType, ctx);\n                }),\n                IQ_TIMEOUT);\n        }\n    }\n\n\n    /**\n     * Handles XMPP connection state changes. Resends any session updates that were cached while the XMPP connection\n     * was down.\n     *\n     * @param {Strophe.Status} status - The new status.\n     * @returns {void}\n     */\n    private onXmppStatusChanged(status: Strophe.Status): void {\n        if (status === XmppConnection.Status.CONNECTED && this._cachedOldLocalSdp) {\n            logger.info(`${this} Sending SSRC update on reconnect`);\n            this.notifyMySSRCUpdate(\n                this._cachedOldLocalSdp,\n                this._cachedNewLocalSdp);\n        }\n    }\n\n\n    /**\n     * This is a setRemoteDescription/setLocalDescription cycle which starts at converting Strophe Jingle IQ into\n     * remote offer SDP. Once converted, setRemoteDescription, createAnswer and setLocalDescription calls follow.\n     *\n     * @param jingleOfferAnswerIq element pointing to the jingle element of the offer (or answer) IQ\n     * @param success callback called when sRD/sLD cycle finishes successfully.\n     * @param failure callback called with an error object as an argument if we fail at any point during setRD,\n     * createAnswer, setLD.\n     * @param {Array<JitsiLocalTrack>} [localTracks] the optional list of the local tracks that will be added, before\n     * the offer/answer cycle executes (for the local track addition to be an atomic operation together with the\n     * offer/answer).\n     * @returns {void}\n     */\n    private setOfferAnswerCycle(jingleOfferAnswerIq: Element, success: () => void, failure: (error: Error) => void, localTracks: JitsiLocalTrack[] = []): void {\n        logger.debug(`${this} Executing setOfferAnswerCycle task`);\n\n        const addTracks = [];\n        const audioTracks = localTracks.filter(track => track.getType() === MediaType.AUDIO);\n        const videoTracks = localTracks.filter(track => track.getType() === MediaType.VIDEO);\n        let tracks = localTracks;\n\n        // Add only 1 video track at a time. Adding 2 or more video tracks to the peerconnection at the same time\n        // makes the browser go into a renegotiation loop by firing 'negotiationneeded' event after every\n        // renegotiation.\n        if (videoTracks.length > 1) {\n            tracks = [ ...audioTracks, videoTracks[0] ];\n        }\n        for (const track of tracks) {\n            addTracks.push(this.peerconnection.addTrack(track, this.isInitiator));\n        }\n        const newRemoteSdp = this._processNewJingleOfferIq(jingleOfferAnswerIq);\n        const bridgeSession = findFirst(jingleOfferAnswerIq, ':scope>bridge-session[*|xmlns=\"http://jitsi.org/protocol/focus\"]');\n        const bridgeSessionId = getAttribute(bridgeSession, 'id');\n\n        if (bridgeSessionId !== this._bridgeSessionId) {\n            this._bridgeSessionId = bridgeSessionId;\n        }\n\n        Promise.all(addTracks)\n            .then(() => this._renegotiate(newRemoteSdp.raw))\n            .then(() => {\n                this.peerconnection.processLocalSdpForTransceiverInfo(tracks);\n                if (this.state === JingleSessionState.PENDING) {\n                    this.state = JingleSessionState.ACTIVE;\n\n                    // #1 Sync up video transfer active/inactive only after the initial O/A cycle. We want to\n                    // adjust the video media direction only in the local SDP and the Jingle contents direction\n                    // included in the initial offer/answer is mapped to the remote SDP. Jingle 'content-modify'\n                    // IQ is processed in a way that it will only modify local SDP when remote peer is no longer\n                    // interested in receiving video content. Changing media direction in the remote SDP will mess\n                    // up our SDP translation chain (simulcast, video mute, RTX etc.)\n                    // #2 Sends the max frame height if it was set, before the session-initiate/accept\n                    if (this.isP2P && (!this._localSendReceiveVideoActive || this._sourceReceiverConstraints)) {\n                        this._sendContentModify();\n                    }\n                }\n\n            })\n            .then(() => {\n                logger.debug(`${this} setOfferAnswerCycle task done`);\n                success();\n            })\n            .catch(error => {\n                logger.error(`${this} setOfferAnswerCycle task failed: ${error}`);\n                failure(error);\n            });\n    }\n\n    /**\n     * Accepts incoming Jingle 'session-initiate' and should send 'session-accept' in result.\n     *\n     * @param jingleOffer element pointing to the jingle element of the offer IQ\n     * @param success callback called when we accept incoming session successfully and receive RESULT packet to\n     * 'session-accept' sent.\n     * @param failure function(error) called if for any reason we fail to accept the incoming offer. 'error' argument\n     * can be used to log some details about the error.\n     * @param {Array<JitsiLocalTrack>} [localTracks] the optional list of the local tracks that will be added, before\n     * the offer/answer cycle executes. We allow the localTracks to optionally be passed in so that the addition of the\n     * local tracks and the processing of the initial offer can all be done atomically. We want to make sure that any\n     * other operations which originate in the XMPP Jingle messages related with this session to be executed with an\n     * assumption that the initial offer/answer cycle has been executed already.\n     */\n    public override acceptOffer(\n            jingleOffer: Element,\n            success: () => void,\n            failure: (error: any) => void,\n            localTracks: JitsiLocalTrack[] = []): void {\n        this.setOfferAnswerCycle(\n            jingleOffer,\n            () => {\n                // FIXME we may not care about RESULT packet for session-accept\n                // then we should either call 'success' here immediately or\n                // modify sendSessionAccept method to do that\n                this._sendSessionAccept(() => {\n                    // Start processing tasks on the modification queue.\n                    logger.debug(`${this} Resuming the modification queue after session is established!`);\n                    this.modificationQueue.resume();\n\n                    success();\n                    this.room.eventEmitter.emit(XMPPEvents.SESSION_ACCEPT, this);\n\n                    // The first video track is added to the peerconnection and signaled as part of the session-accept.\n                    // Add secondary video tracks (that were already added to conference) to the peerconnection here.\n                    // This will happen when someone shares a secondary source to a two people call, the other user\n                    // leaves and joins the call again, a new peerconnection is created for p2p/jvb connection. At this\n                    // point, there are 2 video tracks which need to be signaled to the remote peer.\n                    const videoTracks = localTracks.filter(track => track.getType() === MediaType.VIDEO);\n\n                    videoTracks.length && videoTracks.splice(0, 1);\n                    videoTracks.length && this.addTracks(videoTracks);\n                },\n                error => {\n                    failure(error);\n                    this.room.eventEmitter.emit(XMPPEvents.SESSION_ACCEPT_ERROR, this, error);\n                });\n            },\n            failure,\n            localTracks);\n    }\n\n    /**\n     * {@inheritDoc}\n     */\n    public override addIceCandidates(elem: Element): void {\n        if (this.peerconnection.signalingState === 'closed') {\n            logger.warn(`${this} Ignored add ICE candidate when in closed state`);\n\n            return;\n        }\n\n        const iceCandidates: RTCIceCandidate[] = [];\n\n        findAll(elem, ':scope>content>transport>candidate')\n            .forEach(candidate => {\n                let line = SDPUtil.candidateFromJingle(candidate);\n\n                line = line.replace('\\r\\n', '').replace('a=', '');\n\n                // FIXME this code does not care to handle\n                // non-bundle transport\n                const rtcCandidate = new RTCIceCandidate({\n                    candidate: line,\n                    sdpMLineIndex: 0,\n\n                    // FF comes up with more complex names like audio-23423,\n                    // Given that it works on both Chrome and FF without\n                    // providing it, let's leave it like this for the time\n                    // being...\n                    // sdpMid: 'audio',\n                    sdpMid: ''\n                });\n\n                iceCandidates.push(rtcCandidate);\n            });\n\n        if (!iceCandidates.length) {\n            logger.error(`${this} No ICE candidates to add ?`, elem[0]?.outerHTML);\n\n            return;\n        }\n\n        // We want to have this task queued, so that we know it is executed,\n        // after the initial sRD/sLD offer/answer cycle was done (based on\n        // the assumption that candidates are spawned after the offer/answer\n        // and XMPP preserves order).\n        const workFunction = finishedCallback => {\n            for (const iceCandidate of iceCandidates) {\n                this.peerconnection.addIceCandidate(iceCandidate)\n                    .then(\n                        () => logger.debug(`${this} addIceCandidate ok!`),\n                        err => logger.error(`${this} addIceCandidate failed!`, err));\n            }\n\n            finishedCallback();\n            logger.debug(`${this} ICE candidates task finished`);\n        };\n\n        logger.debug(`${this} Queued add (${iceCandidates.length}) ICE candidates task`);\n        this.modificationQueue.push(workFunction);\n    }\n\n    /**\n     * Handles a Jingle source-add message for this Jingle session.\n     *\n     * @param {Array<Element>} elem an array of Jingle \"content\" elements.\n     * @returns {Promise} resolved when the operation is done or rejected with an error.\n     */\n    public addRemoteStream(elem: Element[]): void {\n        this._addOrRemoveRemoteStream(true /* add */, elem);\n    }\n\n    /**\n     * Adds a new track to the peerconnection. This method needs to be called only when a secondary JitsiLocalTrack is\n     * being added to the peerconnection for the first time.\n     *\n     * @param {Array<JitsiLocalTrack>} localTracks - Tracks to be added to the peer connection.\n     * @returns {Promise<void>} that resolves when the track is successfully added to the peerconnection, rejected\n     * otherwise.\n     */\n    public addTracks(localTracks: Nullable<JitsiLocalTrack[]> = null): Promise<void> {\n        if (!localTracks?.length) {\n            Promise.reject(new Error('No tracks passed'));\n        }\n\n        const replaceTracks = [];\n        const workFunction = finishedCallback => {\n            const remoteSdp = new SDP(this.peerconnection.remoteDescription.sdp, this.isP2P);\n            const recvOnlyTransceiver = this.peerconnection.peerconnection.getTransceivers()\n                    .find(t => t.receiver.track.kind === MediaType.VIDEO\n                        && t.direction === MediaDirection.RECVONLY\n                        && t.currentDirection === MediaDirection.RECVONLY);\n\n            // Add transceivers by adding a new mline in the remote description for each track. Do not create a new\n            // m-line if a recv-only transceiver exists in the p2p case. The new track will be attached to the\n            // existing one in that case.\n            for (const track of localTracks) {\n                if (!this.isP2P || !recvOnlyTransceiver) {\n                    remoteSdp.addMlineForNewSource(track.getType());\n                }\n            }\n\n            this._renegotiate(remoteSdp.raw)\n                .then(() => {\n                    // Replace the tracks on the newly generated transceivers.\n                    for (const track of localTracks) {\n                        replaceTracks.push(this.peerconnection.replaceTrack(null, track));\n                    }\n\n                    return Promise.all(replaceTracks);\n                })\n\n                // Trigger a renegotiation here since renegotiations are suppressed at TPC.replaceTrack for screenshare\n                // tracks. This is done here so that presence for screenshare tracks is sent before signaling.\n                .then(() => this._renegotiate())\n                .then(() => finishedCallback(), error => finishedCallback(error));\n        };\n\n        return new Promise((resolve, reject) => {\n            logger.debug(`${this} Queued renegotiation after addTrack`);\n\n            this.modificationQueue.push(\n                workFunction,\n                error => {\n                    if (error) {\n                        if (error instanceof ClearedQueueError) {\n                            // The session might have been terminated before the task was executed, making it obsolete.\n                            logger.debug(`${this} renegotiation after addTrack aborted: session terminated`);\n                            resolve();\n\n                            return;\n                        }\n                        logger.error(`${this} renegotiation after addTrack error`, error);\n                        reject(error);\n                    } else {\n                        logger.debug(`${this} renegotiation after addTrack executed - OK`);\n                        resolve();\n                    }\n                });\n        });\n    }\n\n    /**\n     * Adds local track back to the peerconnection associated with this session.\n     *\n     * @param {JitsiLocalTrack} track - the local track to be added back to the peerconnection.\n     * @return {Promise} a promise that will resolve once the local track is added back to this session and\n     * renegotiation succeeds (if its warranted). Will be rejected with a <tt>string</tt> that provides some error\n     * details in case something goes wrong.\n     * @returns {Promise<void>}\n     */\n    public addTrackToPc(track: JitsiLocalTrack): Promise<void> {\n        return this._addRemoveTrack(false /* add */, track)\n            .then(async () => {\n                // Configure the video encodings after the track is unmuted. If the user joins the call muted and\n                // unmutes it the first time, all the parameters need to be configured.\n                if (track.isVideoTrack()) {\n                    await this.peerconnection.configureVideoSenderEncodings(track);\n                }\n            });\n    }\n\n    /**\n     * Closes the underlying peerconnection and shuts down the modification queue.\n     *\n     * @returns {void}\n     */\n    public close(): void {\n        this.state = JingleSessionState.ENDED;\n        this.establishmentDuration = undefined;\n\n        if (this.peerconnection) {\n            this.peerconnection.onicecandidate = null;\n            this.peerconnection.oniceconnectionstatechange = null;\n            this.peerconnection.onnegotiationneeded = null;\n            this.peerconnection.onsignalingstatechange = null;\n        }\n\n        logger.debug(`${this} Clearing modificationQueue`);\n\n        // Remove any pending tasks from the queue\n        this.modificationQueue.clear();\n\n        logger.debug(`${this} Queued PC close task`);\n        this.modificationQueue.push(finishCallback => {\n            // do not try to close if already closed.\n            this.peerconnection && this.peerconnection.close();\n            finishCallback();\n            logger.debug(`${this} PC close task done!`);\n        });\n\n        logger.debug(`${this} Shutdown modificationQueue!`);\n\n        // No more tasks can go in after the close task\n        this.modificationQueue.shutdown();\n    }\n\n    /**\n     * @inheritDoc\n     * @param {JingleSessionPCOptions} options  - a set of config options.\n     * @returns {void}\n     */\n    public override doInitialize(options: IJingleSessionPCOptions): void {\n        this.failICE = Boolean(options.testing?.failICE);\n        this.lasticecandidate = false;\n        this.options = options;\n\n        /**\n         * {@code true} if reconnect is in progress.\n         * @type {boolean}\n         */\n        this.isReconnect = false;\n\n        /**\n         * Set to {@code true} if the connection was ever stable\n         * @type {boolean}\n         */\n        this.wasstable = false;\n        this.webrtcIceUdpDisable = Boolean(options.webrtcIceUdpDisable);\n        this.webrtcIceTcpDisable = Boolean(options.webrtcIceTcpDisable);\n\n        const pcOptions = {\n            audioQuality: options.audioQuality,\n            capScreenshareBitrate: undefined,\n            codecSettings: options.codecSettings,\n            disableRtx: options.disableRtx,\n            disableSimulcast: this.isP2P ? true : options.disableSimulcast,\n            enableInsertableStreams: options.enableInsertableStreams,\n            forceTurnRelay: options.forceTurnRelay,\n            maxstats: undefined,\n            startSilent: undefined,\n            usesCodecSelectionAPI: undefined,\n            videoQuality: undefined\n        };\n\n        if (options.gatherStats) {\n            pcOptions.maxstats = DEFAULT_MAX_STATS;\n        }\n        pcOptions.usesCodecSelectionAPI = this.usesCodecSelectionAPI\n            = browser.supportsCodecSelectionAPI()\n            && (options.testing?.enableCodecSelectionAPI ?? true)\n            && !this.isP2P;\n\n        if (options.videoQuality) {\n            const settings = Object.entries(options.videoQuality)\n            .map(entry => {\n                entry[0] = entry[0].toLowerCase();\n\n                return entry;\n            });\n\n            pcOptions.videoQuality = Object.fromEntries(settings);\n        }\n\n        if (!this.isP2P) {\n            // Do not send lower spatial layers for low fps screenshare and enable them only for high fps screenshare.\n            pcOptions.capScreenshareBitrate = !(options.desktopSharingFrameRate?.max > SS_DEFAULT_FRAME_RATE);\n        }\n\n        if (options.startSilent) {\n            pcOptions.startSilent = true;\n        }\n\n        this.peerconnection\n            = this.rtc.createPeerConnection(\n                    this._signalingLayer,\n                    this.pcConfig,\n                    this.isP2P,\n                    pcOptions);\n\n        this.peerconnection.onicecandidate = ev => {\n            if (!ev) {\n                // There was an incomplete check for ev before which left\n                // the last line of the function unprotected from a potential\n                // throw of an exception. Consequently, it may be argued that\n                // the check is unnecessary. Anyway, I'm leaving it and making\n                // the check complete.\n                return;\n            }\n\n            // XXX this is broken, candidate is not parsed.\n            const candidate = ev.candidate;\n            const now = window.performance.now();\n\n            if (candidate) {\n                if (this._gatheringStartedTimestamp === null) {\n                    this._gatheringStartedTimestamp = now;\n                }\n\n                // Discard candidates of disabled protocols.\n                let protocol = candidate.protocol as string;\n\n                if (typeof protocol === 'string') {\n                    protocol = protocol.toLowerCase();\n                    if (protocol === 'tcp' || protocol === 'ssltcp') {\n                        if (this.webrtcIceTcpDisable) {\n                            return;\n                        }\n                    } else if (protocol === 'udp') {\n                        if (this.webrtcIceUdpDisable) {\n                            return;\n                        }\n                    }\n                }\n            } else if (!this._gatheringReported) {\n                // End of gathering\n                Statistics.sendAnalytics(\n                    AnalyticsEvents.ICE_DURATION,\n                    {\n                        initiator: this.isInitiator,\n                        p2p: this.isP2P,\n                        phase: 'gathering',\n                        value: now - this._gatheringStartedTimestamp\n                    });\n                this._gatheringReported = true;\n            }\n            if (this.isP2P) {\n                this._sendIceCandidate(candidate);\n            }\n        };\n\n        // Note there is a change in the spec about closed:\n        // This value moved into the RTCPeerConnectionState enum in\n        // the May 13, 2016 draft of the specification, as it reflects the state\n        // of the RTCPeerConnection, not the signaling connection. You now\n        // detect a closed connection by checking for connectionState to be\n        // \"closed\" instead.\n        // I suppose at some point this will be moved to onconnectionstatechange\n        this.peerconnection.onsignalingstatechange = () => {\n            if (this.peerconnection.signalingState === 'stable') {\n                this.wasstable = true;\n            } else if (this.peerconnection.signalingState === 'closed'\n                || this.peerconnection.connectionState === 'closed') {\n                this.room.eventEmitter.emit(XMPPEvents.SUSPEND_DETECTED, this);\n            }\n        };\n\n        /**\n         * The oniceconnectionstatechange event handler contains the code to\n         * execute when the iceconnectionstatechange event, of type Event,\n         * is received by this RTCPeerConnection. Such an event is sent when\n         * the value of RTCPeerConnection.iceConnectionState changes.\n         */\n        this.peerconnection.oniceconnectionstatechange = () => {\n            const now = window.performance.now();\n            let isStable = false;\n\n            if (!this.isP2P) {\n                this.room.connectionTimes[\n                    `ice.state.${this.peerconnection.iceConnectionState}`]\n                    = now;\n            }\n            logger.info(`(TIME) ICE ${this.peerconnection.iceConnectionState} ${this.isP2P ? 'P2P' : 'JVB'}:\\t`, now);\n\n            Statistics.sendAnalytics(\n                AnalyticsEvents.ICE_STATE_CHANGED,\n                {\n                    p2p: this.isP2P,\n                    reconnect: this.isReconnect,\n                    'signaling_state': this.peerconnection.signalingState,\n                    state: this.peerconnection.iceConnectionState,\n                    value: now\n                });\n\n            this.room.eventEmitter.emit(\n                XMPPEvents.ICE_CONNECTION_STATE_CHANGED,\n                this,\n                this.peerconnection.iceConnectionState);\n            switch (this.peerconnection.iceConnectionState) {\n            case 'checking':\n                this._iceCheckingStartedTimestamp = now;\n                break;\n            case 'connected':\n            case 'completed':\n                // Informs interested parties that the connection has been restored. This includes the case when\n                // media connection to the bridge has been restored after an ICE failure by using session-terminate.\n                if (this.peerconnection.signalingState === 'stable') {\n                    isStable = true;\n                    this.room.eventEmitter.emit(XMPPEvents.CONNECTION_RESTORED, this);\n                }\n\n                // Add a workaround for an issue on chrome in Unified plan when the local endpoint is the offerer.\n                // The 'signalingstatechange' event for 'stable' is handled after the 'iceconnectionstatechange' event\n                // for 'completed' is handled by the client. This prevents the client from firing a\n                // CONNECTION_ESTABLISHED event for the p2p session. As a result, the offerer continues to stay on the\n                // jvb connection while the remote peer switches to the p2p connection breaking the media flow between\n                // the endpoints.\n                // TODO - file a chromium bug and add the information here.\n                if (!this.wasConnected\n                    && (this.wasstable\n                        || isStable\n                        || (this.isInitiator && (browser.isChromiumBased() || browser.isReactNative())))) {\n\n                    Statistics.sendAnalytics(\n                        AnalyticsEvents.ICE_DURATION,\n                        {\n                            initiator: this.isInitiator,\n                            p2p: this.isP2P,\n                            phase: 'checking',\n                            value: now - this._iceCheckingStartedTimestamp\n                        });\n\n                    // Switch between ICE gathering and ICE checking whichever\n                    // started first (scenarios are different for initiator\n                    // vs responder)\n                    const iceStarted\n                        = Math.min(\n                            this._iceCheckingStartedTimestamp,\n                            this._gatheringStartedTimestamp);\n\n                    this.establishmentDuration = now - iceStarted;\n\n                    Statistics.sendAnalytics(\n                        AnalyticsEvents.ICE_DURATION,\n                        {\n                            initiator: this.isInitiator,\n                            p2p: this.isP2P,\n                            phase: 'establishment',\n                            value: this.establishmentDuration\n                        });\n\n                    this.wasConnected = true;\n                    this.room.eventEmitter.emit(\n                        XMPPEvents.CONNECTION_ESTABLISHED, this);\n                }\n                this.isReconnect = false;\n                break;\n            case 'disconnected':\n                this.isReconnect = true;\n\n                // Informs interested parties that the connection has been\n                // interrupted.\n                if (this.wasstable) {\n                    this.room.eventEmitter.emit(\n                        XMPPEvents.CONNECTION_INTERRUPTED, this);\n                }\n                break;\n            case 'failed':\n                this.room.eventEmitter.emit(\n                    XMPPEvents.CONNECTION_ICE_FAILED, this);\n                break;\n            }\n        };\n\n\n        /**\n         * The connection state event is fired whenever the aggregate of underlying\n         * transports change their state.\n         */\n        this.peerconnection.onconnectionstatechange = () => {\n            const icestate = this.peerconnection.iceConnectionState;\n\n            logger.info(`(TIME) ${this.isP2P ? 'P2P' : 'JVB'} PC state is now ${this.peerconnection.connectionState} `\n                + `(ICE state ${this.peerconnection.iceConnectionState}):\\t`, window.performance.now());\n\n            switch (this.peerconnection.connectionState) {\n            case 'failed':\n                // Since version 76 Chrome no longer switches ICE connection\n                // state to failed (see\n                // https://bugs.chromium.org/p/chromium/issues/detail?id=982793\n                // for details) we use this workaround to recover from lost connections\n                if (icestate === 'disconnected') {\n                    this.room.eventEmitter.emit(\n                        XMPPEvents.CONNECTION_ICE_FAILED, this);\n                }\n                break;\n            }\n        };\n\n        /**\n         * The negotiationneeded event is fired whenever we shake the media on the\n         * RTCPeerConnection object.\n         */\n        this.peerconnection.onnegotiationneeded = () => {\n            const state = this.peerconnection.signalingState;\n            const remoteDescription = this.peerconnection.remoteDescription;\n\n            if (!this.isP2P\n                && state === 'stable'\n                && remoteDescription\n                && typeof remoteDescription.sdp === 'string') {\n                logger.info(`${this} onnegotiationneeded fired on ${this.peerconnection}`);\n\n                const workFunction = async finishedCallback => {\n                    try {\n                        await this._renegotiate();\n                        await this.peerconnection.configureAudioSenderEncodings();\n                        finishedCallback();\n                    } catch (error) {\n                        finishedCallback(error);\n                    }\n                };\n\n                this.modificationQueue.push(\n                    workFunction,\n                    error => {\n                        if (error) {\n                            logger.error(`${this} onnegotiationneeded error`, error);\n                        } else {\n                            logger.debug(`${this} onnegotiationneeded executed - OK`);\n                        }\n                    });\n            }\n        };\n    }\n\n    /**\n     * Returns the ice connection state for the peer connection.\n     *\n     * @returns the ice connection state for the peer connection.\n     */\n    public getIceConnectionState(): RTCIceConnectionState {\n        return this.peerconnection.getConnectionState();\n    }\n\n    /**\n     * Returns the preference for max frame height for the remote video sources.\n     *\n     * @returns {Optional<$Map<string, number>>}\n     */\n    public getRemoteSourcesRecvMaxFrameHeight(): Optional<ISourceFrameHeight[]> {\n        if (this.isP2P) {\n            return this.remoteSourceMaxFrameHeights;\n        }\n\n        return undefined;\n    }\n\n    /**\n     * Creates an offer and sends Jingle 'session-initiate' to the remote peer.\n     *\n     * @param {Array<JitsiLocalTrack>} localTracks the local tracks that will be added, before the offer/answer cycle\n     * executes (for the local track addition to be an atomic operation together with the offer/answer).\n     * @returns {Promise<void>} that resolves when the offer is sent to the remote peer, rejected otherwise.\n     */\n    public async invite(localTracks: JitsiLocalTrack[] = []): Promise<void> {\n        if (!this.isInitiator) {\n            throw new Error('Trying to invite from the responder session');\n        }\n        logger.debug(`${this} Executing invite task`);\n\n        const addTracks = [];\n\n        for (const track of localTracks) {\n            addTracks.push(this.peerconnection.addTrack(track, this.isInitiator));\n        }\n\n        try {\n            await Promise.all(addTracks);\n            const offerSdp = await this.peerconnection.createOffer(this.mediaConstraints as RTCOfferOptions);\n\n            await this.peerconnection.setLocalDescription(offerSdp);\n            this.peerconnection.processLocalSdpForTransceiverInfo(localTracks);\n            this._sendSessionInitiate(this.peerconnection.localDescription.sdp);\n\n            logger.debug(`${this} invite executed - OK`);\n        } catch (error) {\n            logger.error(`${this} invite error`, error);\n            throw error;\n        }\n    }\n\n    /**\n     * Enables/disables local video based on 'senders' attribute of the video conent in 'content-modify' IQ sent by the\n     * remote peer. Also, checks if the sourceMaxFrameHeight (as requested by the p2p peer) or the senders attribute of\n     * the video content has changed and modifies the local video resolution accordingly.\n     *\n     * @param {Element} jingleContents - The content of the 'content-modify' IQ sent by the remote peer.\n     * @returns {void}\n     */\n    public modifyContents(jingleContents: Element): void {\n        const newVideoSenders = JingleSessionPC.parseVideoSenders(jingleContents);\n        const sourceMaxFrameHeights = JingleSessionPC.parseSourceMaxFrameHeight(jingleContents);\n\n        if (sourceMaxFrameHeights) {\n            this.remoteSourceMaxFrameHeights = sourceMaxFrameHeights;\n            this.eventEmitter.emit(MediaSessionEvents.REMOTE_SOURCE_CONSTRAINTS_CHANGED, this, sourceMaxFrameHeights);\n        }\n\n        if (newVideoSenders === null) {\n            logger.error(`${this} - failed to parse video \"senders\" attribute in \"content-modify\" action`);\n\n            return;\n        }\n\n        if (!this._assertNotEnded()) {\n            return;\n        }\n\n        const isRemoteVideoActive\n            = newVideoSenders === 'both'\n                || (newVideoSenders === 'initiator' && this.isInitiator)\n                || (newVideoSenders === 'responder' && !this.isInitiator);\n\n        if (isRemoteVideoActive !== this._remoteSendReceiveVideoActive) {\n            logger.debug(`${this} new remote video active: ${isRemoteVideoActive}`);\n            this._remoteSendReceiveVideoActive = isRemoteVideoActive;\n\n            this.peerconnection\n                .setVideoTransferActive(this._localSendReceiveVideoActive && this._remoteSendReceiveVideoActive);\n        }\n    }\n\n    /**\n     * Handles the termination of the session.\n     *\n     * @param {string} reasonCondition - The XMPP Jingle reason condition.\n     * @param {string} reasonText - The XMPP Jingle reason text.\n     * @returns {void}\n     */\n    public onTerminated(reasonCondition: string, reasonText: string) {\n        // Do something with reason and reasonCondition when we start to care\n        // this.reasonCondition = reasonCondition;\n        // this.reasonText = reasonText;\n        logger.info(`${this} Session terminated`, reasonCondition, reasonText);\n\n        this._xmppListeners.forEach(removeListener => removeListener());\n        this._xmppListeners = [];\n\n        if (this._removeSenderVideoConstraintsChangeListener) {\n            this._removeSenderVideoConstraintsChangeListener();\n        }\n\n        if (FeatureFlags.isSsrcRewritingSupported() && this.peerconnection) {\n            this.peerconnection.getRemoteTracks().forEach(track => {\n                this.room.eventEmitter.emit(JitsiConferenceEvents.TRACK_REMOVED, track);\n            });\n        }\n\n        this.close();\n    }\n\n    /**\n     * Processes the source map message received from the bridge and creates a new remote track for newly signaled\n     * SSRCs or updates the source-name and owner on the remote track for an existing SSRC.\n     *\n     * @param {Object} message - The source map message.\n     * @param {string} mediaType - The media type, 'audio' or 'video'.\n     * @returns {void}\n     */\n    public processSourceMap(message: any, mediaType: MediaType): void {\n        if (!FeatureFlags.isSsrcRewritingSupported()) {\n            return;\n        }\n\n        if (mediaType === MediaType.AUDIO && this.options.startSilent) {\n\n            return;\n        }\n\n        const newSsrcs = [];\n\n        for (const src of message.mappedSources) {\n            const { owner, source, ssrc } = src;\n            const isNewSsrc = this.peerconnection.addRemoteSsrc(ssrc);\n\n            if (isNewSsrc) {\n                newSsrcs.push(src);\n                logger.debug(`New SSRC signaled ${ssrc}: owner=${owner}, source-name=${source}`);\n\n                // Check if there is an old mapping for the given source and clear the owner on the associated track.\n                const oldSsrc = this.peerconnection.remoteSources.get(source);\n\n                if (oldSsrc) {\n                    this._signalingLayer.removeSSRCOwners([ oldSsrc ]);\n                    const track = this.peerconnection.getTrackBySSRC(oldSsrc);\n\n                    if (track) {\n                        this.room.eventEmitter.emit(JitsiTrackEvents.TRACK_OWNER_SET, track);\n                    }\n                }\n            } else {\n                const track = this.peerconnection.getTrackBySSRC(ssrc);\n\n                if (!track || (track.getParticipantId() === owner && track.getSourceName() === source)) {\n                    !track && logger.warn(`Remote track for SSRC=${ssrc} hasn't been created yet,`\n                        + 'not processing the source map');\n                    continue; // eslint-disable-line no-continue\n                }\n                logger.debug(`Existing SSRC re-mapped ${ssrc}: new owner=${owner}, source-name=${source}`);\n\n                this._signalingLayer.setSSRCOwner(ssrc, owner, source);\n                const oldSourceName = track.getSourceName();\n                const sourceInfo = this.peerconnection.getRemoteSourceInfoBySourceName(oldSourceName);\n\n                // Update the SSRC map on the peerconnection.\n                if (sourceInfo) {\n                    this.peerconnection.updateRemoteSources(new Map([ [ oldSourceName, sourceInfo ] ]), false);\n                    this.peerconnection.updateRemoteSources(new Map([ [ source, sourceInfo ] ]), true /* isAdd */);\n                }\n\n                // Update the muted state and the video type on the track since the presence for this track could have\n                // been received before the updated source map is received on the bridge channel.\n                const { muted, videoType } = this._signalingLayer.getPeerMediaInfo(owner, mediaType, source);\n\n                typeof muted !== 'undefined' && this.peerconnection._sourceMutedChanged(source, muted);\n                this.room.eventEmitter.emit(JitsiTrackEvents.TRACK_OWNER_SET, track, owner, source, videoType);\n            }\n        }\n\n        // Add the new SSRCs to the remote description by generating a source message.\n        if (newSsrcs.length) {\n            let node = $build('content', {\n                name: mediaType,\n                xmlns: 'urn:xmpp:jingle:1'\n            }).c('description', {\n                media: mediaType,\n                xmlns: XEP.RTP_MEDIA\n            });\n\n            for (const src of newSsrcs) {\n                const { rtx, ssrc, source } = src;\n                let msid;\n\n                if (mediaType === MediaType.VIDEO) {\n                    const idx = ++this.numRemoteVideoSources;\n\n                    msid = `remote-video-${idx} remote-video-${idx}`;\n\n                    if (rtx !== '-1') {\n                        _addSourceElement(node, src, rtx, msid);\n                        node.c('ssrc-group', {\n                            semantics: SSRC_GROUP_SEMANTICS.FID,\n                            xmlns: XEP.SOURCE_ATTRIBUTES\n                        })\n                            .c('source', {\n                                ssrc,\n                                xmlns: XEP.SOURCE_ATTRIBUTES\n                            })\n                            .up()\n                            .c('source', {\n                                ssrc: rtx,\n                                xmlns: XEP.SOURCE_ATTRIBUTES\n                            })\n                            .up()\n                            .up();\n                    }\n                } else {\n                    const idx = ++this.numRemoteAudioSources;\n\n                    msid = `remote-audio-${idx} remote-audio-${idx}`;\n                }\n                _addSourceElement(node, src, ssrc, msid);\n                this.peerconnection.remoteSources.set(source, ssrc);\n            }\n            node = node.up();\n            this._addOrRemoveRemoteStream(true /* add */, node.node);\n        }\n    }\n\n    /**\n     * Handles a Jingle source-remove message for this Jingle session.\n     *\n     * @param {Array<Element>} contents - An array of content elements from the source-remove message.\n     * @returns {void}\n     */\n    public removeRemoteStream(elem: Element[]): void {\n        this._addOrRemoveRemoteStream(false /* remove */, elem);\n    }\n\n    /**\n     * Handles the deletion of SSRCs associated with a remote user from the remote description when the user leaves.\n     *\n     * @param {string} id Endpoint id of the participant that has left the call.\n     * @returns {void}\n     */\n    public removeRemoteStreamsOnLeave(id: string): void {\n        const workFunction = finishCallback => {\n            const removeSsrcInfo = this.peerconnection.getRemoteSourceInfoByParticipant(id);\n\n            if (removeSsrcInfo.size) {\n                logger.debug(`${this} Removing SSRCs for user ${id}, sources=${Array.from(removeSsrcInfo.keys())}`);\n                const newRemoteSdp = new SDP(this.peerconnection.remoteDescription.sdp, this.isP2P);\n\n                newRemoteSdp.updateRemoteSources(removeSsrcInfo, false /* isAdd */);\n                this.peerconnection.updateRemoteSources(removeSsrcInfo, false /* isAdd */);\n\n                this._renegotiate(newRemoteSdp.raw)\n                    .then(() => finishCallback(), error => finishCallback(error));\n            } else {\n                finishCallback();\n            }\n        };\n\n        logger.debug(`${this} Queued removeRemoteStreamsOnLeave task for participant ${id}`);\n\n        this.modificationQueue.push(\n            workFunction,\n            error => {\n                if (error) {\n                    logger.error(`${this} removeRemoteStreamsOnLeave error:`, error);\n                } else {\n                    logger.info(`${this} removeRemoteStreamsOnLeave done!`);\n                }\n            });\n    }\n\n    /**\n     * Removes local track from the peerconnection as part of the mute operation.\n     *\n     * @param {JitsiLocalTrack} track the local track to be removed.\n     * @return {Promise} a promise which will be resolved once the local track is removed from this session or rejected\n     * with a <tt>string</tt> that the describes the error if anything goes wrong.\n     */\n    public removeTrackFromPc(track: JitsiLocalTrack): Promise<void> {\n        return this._addRemoveTrack(true /* remove */, track);\n    }\n\n    /**\n     * Replaces <tt>oldTrack</tt> with <tt>newTrack</tt> and performs a single offer/answer cycle (if needed) after\n     * both operations are done.\n     * <tt>oldTrack</tt> or <tt>newTrack</tt> can be null; replacing a valid <tt>oldTrack</tt> with a null\n     * <tt>newTrack</tt> effectively just removes <tt>oldTrack</tt>.\n     *\n     * @param {Nullable<JitsiLocalTrack>} oldTrack the current track in use to be replaced.\n     * @param {Nullable<JitsiLocalTrack>} newTrack the new track to use.\n     * @returns {Promise} which resolves once the replacement is complete with no arguments or rejects with an error.\n     */\n    public replaceTrack(oldTrack: Nullable<JitsiLocalTrack>, newTrack: Nullable<JitsiLocalTrack>): Promise<void> {\n        const workFunction = finishedCallback => {\n            logger.debug(`${this} replaceTrack worker started. oldTrack = ${oldTrack}, newTrack = ${newTrack}`);\n\n            this.peerconnection.replaceTrack(oldTrack, newTrack)\n                .then(shouldRenegotiate => {\n                    let promise = Promise.resolve();\n\n                    logger.debug(`${this} TPC.replaceTrack finished. shouldRenegotiate = ${\n                        shouldRenegotiate}, JingleSessionState = ${this.state}`);\n\n                    if (shouldRenegotiate && (oldTrack || newTrack) && this.state === JingleSessionState.ACTIVE) {\n                        promise = this._renegotiate();\n                    }\n\n                    return promise.then(() => {\n                        // Set the source name of the new track.\n                        if (oldTrack && newTrack && oldTrack.isVideoTrack()) {\n                            newTrack.setSourceName(oldTrack.getSourceName());\n                        }\n                    });\n                })\n                .then(() => finishedCallback(), error => finishedCallback(error));\n        };\n\n        return new Promise((resolve, reject) => {\n            logger.debug(`${this} Queued replaceTrack task. Old track = ${oldTrack}, new track = ${newTrack}`);\n\n            this.modificationQueue.push(\n                workFunction,\n                error => {\n                    if (error) {\n                        if (error instanceof ClearedQueueError) {\n                            // The session might have been terminated before the task was executed, making it obsolete.\n                            logger.debug('Replace track aborted: session terminated');\n                            resolve();\n\n                            return;\n                        }\n                        logger.error(`${this} Replace track error:`, error);\n                        reject(error);\n                    } else {\n                        logger.info(`${this}  Replace track done!`);\n                        resolve();\n                    }\n                });\n        });\n    }\n\n    /**\n     * Sets the answer received from the remote peer as the remote description.\n     *\n     * @param {Element} jingleAnswer - The jingle answer element.\n     * @returns {Promise<void>} that resolves when the answer is set as the remote description, rejected otherwise.\n     */\n    public async setAnswer(jingleAnswer: Element): Promise<void> {\n        if (!this.isInitiator) {\n            throw new Error('Trying to set an answer on the responder session');\n        }\n        logger.debug(`${this} Executing setAnswer task`);\n\n        const newRemoteSdp = this._processNewJingleOfferIq(jingleAnswer);\n        const oldLocalSdp = new SDP(this.peerconnection.localDescription.sdp);\n        const remoteDescription = {\n            sdp: newRemoteSdp.raw,\n            type: 'answer'\n        } as RTCSessionDescription;\n\n        try {\n            await this.peerconnection.setRemoteDescription(remoteDescription);\n            if (this.state === JingleSessionState.PENDING) {\n                this.state = JingleSessionState.ACTIVE;\n\n                // Start processing tasks on the modification queue.\n                logger.debug(`${this} Resuming the modification queue after session is established!`);\n                this.modificationQueue.resume();\n                const newLocalSdp = new SDP(this.peerconnection.localDescription.sdp);\n\n                this._sendContentModify();\n                this.notifyMySSRCUpdate(oldLocalSdp, newLocalSdp);\n            }\n            logger.debug(`${this} setAnswer task done`);\n        } catch (error) {\n            logger.error(`${this} setAnswer task failed: ${error}`);\n            throw error;\n        }\n    }\n\n    /**\n     * Resumes or suspends media transfer over the underlying peer connection.\n     *\n     * @param {boolean} active - <tt>true</tt> to enable media transfer or <tt>false</tt> to suspend media transmission.\n     * @returns {Promise<void>}\n     */\n    public setMediaTransferActive(active: boolean): Promise<void> {\n        const changed = this.peerconnection.audioTransferActive !== active\n            || this.peerconnection.videoTransferActive !== active;\n\n        if (!changed) {\n            return Promise.resolve();\n        }\n\n        return this.peerconnection.setMediaTransferActive(active)\n            .then(async () => {\n                this.peerconnection.audioTransferActive = active;\n                this.peerconnection.videoTransferActive = active;\n\n                // Reconfigure the audio and video tracks so that only the correct encodings are active.\n                const promises = [];\n\n                promises.push(this.peerconnection.configureVideoSenderEncodings());\n                promises.push(this.peerconnection.configureAudioSenderEncodings());\n                await Promise.allSettled(promises);\n            });\n    }\n\n    /**\n     * Resumes or suspends video media transfer over the p2p peer connection.\n     *\n     * @param {boolean} videoActive <tt>true</tt> to enable video media transfer or <tt>false</tt> to suspend video\n     * media transmission.\n     * @return {Promise} a <tt>Promise</tt> which will resolve once the operation is done. It will be rejected with\n     * an error description as a string in case anything goes wrong.\n     */\n    public setP2pVideoTransferActive(videoActive: boolean): Promise<void> {\n        if (!this.peerconnection) {\n            return Promise.reject('Can not modify video transfer active state,'\n                    + ' before \"initialize\" is called');\n        }\n\n        if (this._localSendReceiveVideoActive !== videoActive) {\n            this._localSendReceiveVideoActive = videoActive;\n            if (this.isP2P && this.state === JingleSessionState.ACTIVE) {\n                this._sendContentModify();\n            }\n\n            return this.peerconnection\n                .setVideoTransferActive(this._localSendReceiveVideoActive && this._remoteSendReceiveVideoActive);\n        }\n\n        return Promise.resolve();\n    }\n\n    /**\n     * Adjust the preference for max video frame height that the local party is willing to receive. Signals\n     * the remote p2p peer.\n     *\n     * @param {Map<string, number>} sourceReceiverConstraints - The receiver constraints per source.\n     * @returns {void}\n     */\n    public setReceiverVideoConstraint(sourceReceiverConstraints: Map<string, number>): void {\n        logger.info(`${this} setReceiverVideoConstraint - constraints: ${JSON.stringify(sourceReceiverConstraints)}`);\n        this._sourceReceiverConstraints = sourceReceiverConstraints;\n\n        if (this.isP2P) {\n            // Tell the remote peer about our receive constraint. If Jingle session is not yet active the state will\n            // be synced after offer/answer.\n            if (this.state === JingleSessionState.ACTIVE) {\n                this._sendContentModify();\n            }\n        }\n    }\n\n    /**\n     * Sets the resolution constraint on the local video tracks.\n     *\n     * @param {number} maxFrameHeight - The user preferred max frame height.\n     * @param {string} sourceName - The source name of the track.\n     * @returns {Promise} promise that will be resolved when the operation is\n     * successful and rejected otherwise.\n     */\n    public setSenderVideoConstraint(maxFrameHeight: number, sourceName: Nullable<string> = null): Promise<void> {\n        if (this._assertNotEnded()) {\n            logger.info(`${this} setSenderVideoConstraint: ${maxFrameHeight}, sourceName: ${sourceName}`);\n\n            const jitsiLocalTrack = sourceName\n                ? this.rtc.getLocalVideoTracks().find(track => track.getSourceName() === sourceName)\n                : this.rtc.getLocalVideoTrack();\n\n            return this.peerconnection.setSenderVideoConstraints(maxFrameHeight, jitsiLocalTrack);\n        }\n\n        return Promise.resolve();\n    }\n\n    /**\n     * Updates the codecs on the peerconnection and initiates a renegotiation (if needed) for the\n     * new codec config to take effect.\n     *\n     * @param {Array<CodecMimeType>} codecList - Preferred codecs for video.\n     * @param {CodecMimeType} screenshareCodec - The preferred screenshare codec.\n     * @returns {void}\n     */\n    public setVideoCodecs(codecList: CodecMimeType[], screenshareCodec: Optional<CodecMimeType>): void {\n        if (this._assertNotEnded()) {\n            const updated = this.peerconnection.setVideoCodecs(codecList, screenshareCodec);\n\n            if (updated) {\n                this.eventEmitter.emit(MediaSessionEvents.VIDEO_CODEC_CHANGED);\n            }\n\n            // Browser throws an error when H.264 is set on the encodings. Therefore, munge the SDP when H.264 needs to\n            // be selected.\n            // TODO: Remove this check when the above issue is fixed.\n            if (this.usesCodecSelectionAPI && codecList[0] !== CodecMimeType.H264) {\n                return;\n            }\n\n            // Skip renegotiation when the selected codec order matches with that of the remote SDP.\n            const currentCodecOrder = this.peerconnection.getConfiguredVideoCodecs();\n\n            if (codecList.every((val, index) => val === currentCodecOrder[index])) {\n                return;\n            }\n\n            this.eventEmitter.emit(MediaSessionEvents.VIDEO_CODEC_CHANGED);\n            Statistics.sendAnalytics(\n                AnalyticsEvents.VIDEO_CODEC_CHANGED,\n                {\n                    value: codecList[0],\n                    videoType: VideoType.CAMERA\n                });\n\n            logger.info(`${this} setVideoCodecs: codecList=${codecList}, screenshareCodec=${screenshareCodec}`);\n\n            // Initiate a renegotiate for the codec setting to take effect.\n            const workFunction = async finishedCallback => {\n                try {\n                    await this._renegotiate();\n                    await this.peerconnection.configureVideoSenderEncodings();\n                    logger.debug(`${this} setVideoCodecs task is done`);\n\n                    return finishedCallback();\n                } catch (error) {\n                    logger.error(`${this} setVideoCodecs task failed: ${error}`);\n\n                    return finishedCallback(error);\n                }\n            };\n\n            logger.debug(`${this} Queued setVideoCodecs task`);\n\n            // Queue and execute\n            this.modificationQueue.push(workFunction);\n        }\n    }\n\n    /**\n     * @inheritDoc\n     */\n    public override terminate(\n            success: () => void,\n            failure: (error: IJingleError) => void,\n            options: ITerminateOptions = {}) {\n        if (this.state === JingleSessionState.ENDED) {\n            return;\n        }\n\n        if (!options || Boolean(options.sendSessionTerminate)) {\n            const sessionTerminate\n                = $iq({\n                    to: this.remoteJid,\n                    type: 'set'\n                })\n                    .c('jingle', {\n                        action: 'session-terminate',\n                        initiator: this.initiatorJid,\n                        sid: this.sid,\n                        xmlns: 'urn:xmpp:jingle:1'\n                    })\n                    .c('reason')\n                    .c((options?.reason) || 'success')\n                    .up();\n\n            if (options?.reasonDescription) {\n                sessionTerminate\n                    .c('text')\n                    .t(options.reasonDescription)\n                    .up()\n                    .up();\n            } else {\n                sessionTerminate.up();\n            }\n\n            this._bridgeSessionId\n                && sessionTerminate.c(\n                    'bridge-session', {\n                        id: this._bridgeSessionId,\n                        restart: options && options.requestRestart === true,\n                        xmlns: 'http://jitsi.org/protocol/focus'\n                    }).up();\n\n            logger.info(`${this} Sending session-terminate`);\n            logger.debug(sessionTerminate.tree());\n\n            this.connection.sendIQ(\n                sessionTerminate,\n                success,\n                this.newJingleErrorHandler(failure),\n                IQ_TIMEOUT);\n        } else {\n            logger.info(`${this} Skipped sending session-terminate`);\n        }\n\n        // this should result in 'onTerminated' being called by strophe.jingle.js\n        this.connection.jingle.terminate(this.sid);\n    }\n\n    /**\n     * Converts to string with minor summary.\n     *\n     * @return {string}\n     */\n    public override toString(): string {\n        return `JingleSessionPC[session=${this.isP2P ? 'P2P' : 'JVB'},initiator=${this.isInitiator},sid=${this.sid}]`;\n    }\n}\n","import { getLogger } from '@jitsi/logger';\nimport { cloneDeep } from 'lodash-es';\nimport { $iq, Strophe } from 'strophe.js';\n\nimport { XMPPEvents } from '../../service/xmpp/XMPPEvents';\nimport RandomUtil from '../util/RandomUtil';\nimport { findAll, findFirst, getAttribute, getText } from '../util/XMLUtils';\n\nimport ConnectionPlugin from './ConnectionPlugin';\nimport { expandSourcesFromJson } from './JingleHelperFunctions';\nimport JingleSessionPC from './JingleSessionPC';\nimport { handleStropheError } from './StropheErrorHandler';\n\nconst logger = getLogger('xmpp:strophe.jingle');\n\n// XXX Strophe is build around the idea of chaining function calls so allow long\n// function call chains.\n/* eslint-disable newline-per-chained-call */\n\n/**\n * Parses the transport XML element and returns the list of ICE candidates formatted as text.\n *\n * @param {*} transport Transport XML element extracted from the IQ.\n * @returns {Array<string>}\n */\nfunction _parseIceCandidates(transport) {\n    const candidates = findAll(transport, ':scope>candidate');\n    const parseCandidates = [];\n\n    // Extract the candidate information from the IQ.\n    candidates.forEach(candidate => {\n        const attributes = candidate.attributes;\n        const candidateAttrs = [];\n\n        for (let i = 0; i < attributes.length; i++) {\n            const attr = attributes[i];\n\n            candidateAttrs.push(`${attr.name}: ${attr.value}`);\n        }\n        parseCandidates.push(candidateAttrs.join(' '));\n    });\n\n    return parseCandidates;\n}\n\n/**\n *\n */\nexport default class JingleConnectionPlugin extends ConnectionPlugin {\n    /**\n     * Creates new <tt>JingleConnectionPlugin</tt>\n     * @param {XMPP} xmpp\n     * @param {EventEmitter} eventEmitter\n     * @param {Object} iceConfig an object that holds the iceConfig to be passed\n     * to the p2p and the jvb <tt>PeerConnection</tt>.\n     */\n    constructor(xmpp, eventEmitter, iceConfig) {\n        super();\n        this.xmpp = xmpp;\n        this.eventEmitter = eventEmitter;\n        this.sessions = {};\n        this.jvbIceConfig = iceConfig.jvb;\n        this.p2pIceConfig = iceConfig.p2p;\n        this.mediaConstraints = {\n            offerToReceiveAudio: true,\n            offerToReceiveVideo: true\n        };\n    }\n\n    /**\n     *\n     * @param connection\n     */\n    init(connection) {\n        super.init(connection);\n        this.connection.addHandler(this.onJingle.bind(this),\n            'urn:xmpp:jingle:1', 'iq', 'set', null, null);\n    }\n\n    /**\n     *\n     * @param iq\n     */\n    onJingle(iq) {\n        const jingleElement = findFirst(iq, 'jingle');\n        const sid = getAttribute(jingleElement, 'sid');\n        const action = getAttribute(jingleElement, 'action');\n        const fromJid = getAttribute(iq, 'from');\n\n        // send ack first\n        const ack = $iq({ id: iq.getAttribute('id'),\n            to: fromJid,\n            type: 'result'\n        });\n\n        let sess = this.sessions[sid];\n\n        if (action !== 'session-initiate') {\n            if (!sess) {\n                ack.attrs({ type: 'error' });\n                ack.c('error', { type: 'cancel' })\n                    .c('item-not-found', {\n                        xmlns: 'urn:ietf:params:xml:ns:xmpp-stanzas'\n                    })\n                    .up()\n                    .c('unknown-session', {\n                        xmlns: 'urn:xmpp:jingle:errors:1'\n                    });\n                logger.warn(`invalid session id: ${sid}`);\n                logger.debug(iq);\n                this.connection.send(ack);\n\n                return true;\n            }\n\n            // local jid is not checked\n            if (fromJid !== sess.remoteJid) {\n                logger.warn(\n                    'jid mismatch for session id', sid, sess.remoteJid, iq);\n                ack.attrs({ type: 'error' });\n                ack.c('error', { type: 'cancel' })\n                    .c('item-not-found', {\n                        xmlns: 'urn:ietf:params:xml:ns:xmpp-stanzas'\n                    })\n                    .up()\n                    .c('unknown-session', {\n                        xmlns: 'urn:xmpp:jingle:errors:1'\n                    });\n                this.connection.send(ack);\n\n                return true;\n            }\n        } else if (sess !== undefined) {\n            // Existing session with same session id. This might be out-of-order\n            // if the sess.remoteJid is the same as from.\n            ack.attrs({ type: 'error' });\n            ack.c('error', { type: 'cancel' })\n                .c('service-unavailable', {\n                    xmlns: 'urn:ietf:params:xml:ns:xmpp-stanzas'\n                })\n                .up();\n            logger.warn('duplicate session id', sid, iq);\n            this.connection.send(ack);\n\n            return true;\n        }\n        const now = window.performance.now();\n\n        // FIXME that should work most of the time, but we'd have to\n        // think how secure it is to assume that user with \"focus\"\n        // nickname is Jicofo.\n        const isP2P = Strophe.getResourceFromJid(fromJid) !== 'focus';\n\n        // see http://xmpp.org/extensions/xep-0166.html#concepts-session\n\n        const jsonMessages = findAll(iq, 'jingle>json-message');\n\n        if (jsonMessages?.length) {\n            let audioVideoSsrcs;\n\n            logger.info(`Found a JSON-encoded element in ${action}, translating to standard Jingle.`);\n            for (let i = 0; i < jsonMessages.length; i++) {\n                // Currently there is always a single json-message in the IQ with the source information.\n                audioVideoSsrcs = expandSourcesFromJson(iq, jsonMessages[i]);\n            }\n\n            if (audioVideoSsrcs?.size) {\n                const logMessage = [];\n\n                for (const endpoint of audioVideoSsrcs.keys()) {\n                    logMessage.push(`${endpoint}:[${audioVideoSsrcs.get(endpoint)}]`);\n                }\n                logger.debug(`Received ${action} from ${fromJid} with sources=${logMessage.join(', ')}`);\n            }\n\n            // TODO: is there a way to remove the json-message elements once we've extracted the information?\n            // removeChild doesn't seem to work.\n        }\n\n        switch (action) {\n        case 'session-initiate': {\n            logger.info('(TIME) received session-initiate:\\t', now);\n\n            isP2P && logger.debug(`Received ${action} from ${fromJid}`);\n            const pcConfig = isP2P ? this.p2pIceConfig : this.jvbIceConfig;\n\n            sess\n                = new JingleSessionPC(\n                    sid,\n                    iq.getAttribute('to'),\n                    fromJid,\n                    this.connection,\n                    this.mediaConstraints,\n                    cloneDeep(pcConfig),\n                    isP2P,\n                    /* initiator */ false);\n\n            this.sessions[sess.sid] = sess;\n            this.eventEmitter.emit(XMPPEvents.CALL_INCOMING, sess, jingleElement, now);\n            break;\n        }\n        case 'session-accept': {\n            const ssrcs = [];\n\n            // Extract the SSRCs from the session-accept received from a p2p peer.\n            findAll(iq, 'jingle>content').forEach(content => {\n                const ssrc = getAttribute(findFirst(content, 'description'), 'ssrc');\n\n                ssrc && ssrcs.push(ssrc);\n            });\n\n            logger.debug(`Received ${action} from ${fromJid} with ssrcs=${ssrcs}`);\n            this.eventEmitter.emit(XMPPEvents.CALL_ACCEPTED, sess, jingleElement);\n            break;\n        }\n        case 'content-modify': {\n            logger.debug(`Received ${action} from ${fromJid}`);\n            sess.modifyContents(jingleElement);\n            break;\n        }\n        case 'transport-info': {\n            const candidates = _parseIceCandidates(findFirst(iq, 'jingle>content>transport'));\n\n            logger.debug(`Received ${action} from ${fromJid} for candidates=${candidates.join(', ')}`);\n            this.eventEmitter.emit(XMPPEvents.TRANSPORT_INFO, sess, jingleElement);\n            break;\n        }\n        case 'session-terminate': {\n            logger.info('terminating...', sess.sid);\n            let reasonCondition = null;\n            let reasonText = null;\n\n            const reasonElement = findFirst(iq, ':scope>jingle>reason');\n\n            if (reasonElement) {\n                const firstReasonChild = reasonElement.children?.length > 0 ? reasonElement.children[0] : undefined;\n\n                reasonCondition = firstReasonChild ? firstReasonChild.tagName : null;\n                reasonText = getText(findFirst(iq, ':scope>jingle>reason>text'));\n            }\n\n            logger.debug(`Received ${action} from ${fromJid} disconnect reason=${reasonText}`);\n            this.terminate(sess.sid, reasonCondition, reasonText);\n            this.eventEmitter.emit(XMPPEvents.CALL_ENDED, sess, reasonCondition, reasonText);\n            break;\n        }\n        case 'transport-replace':\n            logger.error(`Ignoring ${action} from ${fromJid} as it is not supported by the client.`);\n            break;\n        case 'source-add':\n            sess.addRemoteStream(findAll(iq, ':scope>jingle>content'));\n            break;\n        case 'source-remove':\n            sess.removeRemoteStream(findAll(iq, ':scope>jingle>content'));\n            break;\n        default:\n            logger.warn('jingle action not implemented', action);\n            ack.attrs({ type: 'error' });\n            ack.c('error', { type: 'cancel' })\n                .c('bad-request',\n                    { xmlns: 'urn:ietf:params:xml:ns:xmpp-stanzas' })\n                .up();\n            break;\n        }\n        this.connection.send(ack);\n\n        return true;\n    }\n\n    /**\n     * Creates new <tt>JingleSessionPC</tt> meant to be used in a direct P2P\n     * connection, configured as 'initiator'.\n     * @param {string} me our JID\n     * @param {string} peer remote participant's JID\n     * @return {JingleSessionPC}\n     */\n    newP2PJingleSession(me, peer) {\n        const sess\n            = new JingleSessionPC(\n                RandomUtil.randomHexString(12),\n                me,\n                peer,\n                this.connection,\n                this.mediaConstraints,\n                this.p2pIceConfig,\n                /* P2P */ true,\n                /* initiator */ true);\n\n        this.sessions[sess.sid] = sess;\n\n        return sess;\n    }\n\n    /**\n     *\n     * @param sid\n     * @param reasonCondition\n     * @param reasonText\n     */\n    terminate(sid, reasonCondition = undefined, reasonText = undefined) {\n        if (this.sessions.hasOwnProperty(sid)) {\n            if (this.sessions[sid].state !== 'ended') {\n                this.sessions[sid].onTerminated(reasonCondition, reasonText);\n            }\n            delete this.sessions[sid];\n        }\n    }\n\n    /**\n     *\n     */\n    getStunAndTurnCredentials() {\n        // get stun and turn configuration from server via xep-0215\n        // uses time-limited credentials as described in\n        // http://tools.ietf.org/html/draft-uberti-behave-turn-rest-00\n        //\n        // See https://modules.prosody.im/mod_turncredentials.html\n        // for a prosody module which implements this.\n        // Or the new implementation https://modules.prosody.im/mod_external_services which will be in prosody 0.12\n        //\n        // Currently, this doesn't work with updateIce and therefore credentials\n        // with a long validity have to be fetched before creating the\n        // peerconnection.\n        // TODO: implement refresh via updateIce as described in\n        //      https://code.google.com/p/webrtc/issues/detail?id=1650\n        this.connection.sendIQ(\n            $iq({ to: this.xmpp.options.hosts.domain,\n                type: 'get' })\n                .c('services', { xmlns: 'urn:xmpp:extdisco:2' }),\n            v2Res => this.onReceiveStunAndTurnCredentials(v2Res),\n            error => {\n                handleStropheError(error, {\n                    domain: this.xmpp.options.hosts.domain,\n                    operation: 'get STUN/TURN credentials (extdisco:2)',\n                    userJid: this.connection.jid,\n                    xmlns: 'urn:xmpp:extdisco:2'\n                });\n                logger.warn('getting turn credentials with extdisco:2 failed, trying extdisco:1');\n                this.connection.sendIQ(\n                    $iq({ to: this.xmpp.options.hosts.domain,\n                        type: 'get' })\n                        .c('services', { xmlns: 'urn:xmpp:extdisco:1' }),\n                    v1Res => this.onReceiveStunAndTurnCredentials(v1Res),\n                    err => {\n                        handleStropheError(err, {\n                            domain: this.xmpp.options.hosts.domain,\n                            operation: 'get STUN/TURN credentials (extdisco:1)',\n                            userJid: this.connection.jid,\n                            xmlns: 'urn:xmpp:extdisco:1'\n                        });\n                        logger.warn('getting turn credentials failed');\n                        logger.warn('is mod_turncredentials or similar installed and configured?');\n                    }\n                );\n            });\n    }\n\n    /**\n     * Parses response when querying for services using urn:xmpp:extdisco:1 or urn:xmpp:extdisco:2.\n     * Stores results in jvbIceConfig and p2pIceConfig.\n     * @param res The response iq.\n     * @return {boolean} Whether something was processed from the supplied message.\n     */\n    onReceiveStunAndTurnCredentials(res) {\n        let iceservers = [];\n\n        findAll(res, ':scope>services>service').forEach(el => {\n            const dict = {};\n            const type = getAttribute(el, 'type');\n\n            switch (type) {\n            case 'stun': {\n                dict.urls = `stun:${getAttribute(el, 'host')}`;\n                const port = getAttribute(el, 'port');\n\n                if (port) {\n                    dict.urls += `:${port}`;\n                }\n                iceservers.push(dict);\n                break;\n            }\n            case 'turn':\n            case 'turns': {\n                dict.urls = `${type}:`;\n                dict.username = getAttribute(el, 'username');\n                dict.urls += getAttribute(el, 'host');\n                const turnPort = getAttribute(el, 'port');\n\n                if (turnPort) {\n                    dict.urls += `:${turnPort}`;\n                }\n                const transport = getAttribute(el, 'transport');\n\n                if (transport && transport !== 'udp') {\n                    dict.urls += `?transport=${transport}`;\n                }\n\n                dict.credential = getAttribute(el, 'password') || dict.credential;\n                iceservers.push(dict);\n                break;\n            }\n            }\n        });\n\n        const options = this.xmpp.options;\n        const { iceServersOverride = [] } = options;\n\n        iceServersOverride.forEach(({ targetType, urls, username, credential }) => {\n            if (![ 'turn', 'turns', 'stun' ].includes(targetType)) {\n                return;\n            }\n\n            const pattern = `${targetType}:`;\n\n            if (typeof urls === 'undefined'\n                && typeof username === 'undefined'\n                && typeof credential === 'undefined') {\n                return;\n            }\n\n            if (urls === null) { // remove this type of ice server\n                iceservers = iceservers.filter(server => !server.urls.startsWith(pattern));\n            }\n\n\n            iceservers.forEach(server => {\n                if (!server.urls.startsWith(pattern)) {\n                    return;\n                }\n\n                server.urls = urls ?? server.urls;\n\n                if (username === null) {\n                    delete server.username;\n                } else {\n                    server.username = username ?? server.username;\n                }\n\n                if (credential === null) {\n                    delete server.credential;\n                } else {\n                    server.credential = credential ?? server.credential;\n                }\n            });\n        });\n\n        // Shuffle ICEServers for loadbalancing\n        for (let i = iceservers.length - 1; i > 0; i--) {\n            const j = Math.floor(Math.random() * (i + 1));\n            const temp = iceservers[i];\n\n            iceservers[i] = iceservers[j];\n            iceservers[j] = temp;\n        }\n\n        let filter;\n\n        if (options.useTurnUdp) {\n            filter = s => s.urls.startsWith('turn');\n        } else {\n            // By default we filter out STUN and TURN/UDP and leave only TURN/TCP.\n            filter = s => s.urls.startsWith('turn') && (s.urls.indexOf('transport=tcp') >= 0);\n        }\n\n        this.jvbIceConfig.iceServers = iceservers.filter(filter);\n        this.p2pIceConfig.iceServers = iceservers;\n\n        return iceservers.length > 0;\n    }\n\n    /**\n     * Returns the data saved in 'updateLog' in a format to be logged.\n     * @returns {Record<string, unknown>} An object containing the data to be logged.\n     */\n    getLog() {\n        const data = {};\n\n        Object.keys(this.sessions).forEach(sid => {\n            const session = this.sessions[sid];\n            const pc = session.peerconnection;\n\n            if (pc && pc.updateLog) {\n                // FIXME: should probably be a .dump call\n                data[`jingle_${sid}`] = {\n                    stats: pc.stats,\n                    updateLog: pc.updateLog,\n                    url: window.location.href\n                };\n            }\n        });\n\n        return data;\n    }\n}\n\n/* eslint-enable newline-per-chained-call */\n","import { Strophe } from 'strophe.js';\n\nimport ConnectionPlugin from './ConnectionPlugin';\n\n\n/**\n *  Logs raw stanzas and makes them available for download as JSON\n */\nclass StropheLogger extends ConnectionPlugin {\n    /**\n     *\n     */\n    private log: any;\n\n    /**\n     *\n     */\n    constructor() {\n        super();\n        this.log = [];\n    }\n\n    /**\n     *\n     * @param connection\n     */\n    override init(connection: Strophe.Connection): void {\n        super.init(connection);\n        connection.rawInput = this.logIncoming.bind(this);\n        connection.rawOutput = this.logOutgoing.bind(this);\n    }\n\n    /**\n     *\n     * @param stanza\n     */\n    logIncoming(stanza: Element | Strophe.Builder): void {\n        this.log.push([ new Date().getTime(), 'incoming', stanza ]);\n    }\n\n    /**\n     *\n     * @param stanza\n     */\n    logOutgoing(stanza: Element | Strophe.Builder): void {\n        this.log.push([ new Date().getTime(), 'outgoing', stanza ]);\n    }\n}\n\n/**\n *\n */\nexport default function() {\n    Strophe.addConnectionPlugin('logger', new StropheLogger());\n}\n","import { getLogger } from '@jitsi/logger';\nimport { $iq, type Connection } from 'strophe.js';\n\nimport { findFirst, getAttribute } from '../util/XMLUtils';\n\nimport ConnectionPlugin from './ConnectionPlugin';\nimport { handleStropheError } from './StropheErrorHandler';\n\nconst logger = getLogger('xmpp:strophe.rayo');\n\nconst RAYO_XMLNS = 'urn:xmpp:rayo:1';\n\n/**\n *\n */\nexport default class RayoConnectionPlugin extends ConnectionPlugin {\n    private callResource: Nullable<string> = null;\n\n    /**\n     *\n     * @param connection\n     */\n    override init(connection: Connection): void {\n        super.init(connection);\n\n        connection.addHandler(\n            this.onRayo.bind(this),\n            RAYO_XMLNS,\n            'iq',\n            'set',\n            null,\n            null\n        );\n    }\n\n    /**\n     *\n     * @param iq\n     */\n    onRayo(iq: any): any {\n        logger.info('Rayo IQ', iq);\n    }\n\n    /* eslint-disable max-params */\n\n    /**\n     *\n     * @param to\n     * @param from\n     * @param roomName\n     * @param roomPass\n     * @param focusMucJid\n     */\n    dial(\n            to: string,\n            from: string,\n            roomName: string,\n            roomPass: string,\n            focusMucJid: string\n    ): Promise<void> {\n        return new Promise((resolve, reject) => {\n            if (!focusMucJid) {\n                reject(new Error('Internal error!'));\n\n                return;\n            }\n            const req = $iq({\n                to: focusMucJid,\n                type: 'set',\n            });\n\n            req.c('dial', {\n                from,\n                to,\n                xmlns: RAYO_XMLNS,\n            });\n            req.c('header', {\n                name: 'JvbRoomName',\n                value: roomName,\n            }).up();\n\n            if (roomPass?.length) {\n                req.c('header', {\n                    name: 'JvbRoomPassword',\n                    value: roomPass,\n                }).up();\n            }\n\n            (this.connection as Connection).sendIQ(\n                req,\n                result => {\n                    logger.info('Dial result ', result);\n\n                    const resource = getAttribute(findFirst(result, 'ref'), 'uri');\n\n                    this.callResource = resource.substr('xmpp:'.length);\n                    logger.info(`Received call resource: ${this.callResource}`);\n                    resolve();\n                },\n                error => {\n                    handleStropheError(error, {\n                        from,\n                        operation: 'dial (Rayo)',\n                        roomName,\n                        to,\n                        userJid: (this.connection as Connection).jid\n                    });\n                    reject(error);\n                }\n            );\n        });\n    }\n\n    /* eslint-enable max-params */\n\n    /**\n     *\n     */\n    hangup(): Promise<void> {\n        return new Promise((resolve, reject) => {\n            if (!this.callResource) {\n                reject(new Error('No call in progress'));\n                logger.warn('No call in progress');\n\n                return;\n            }\n\n            const req = $iq({\n                to: this.callResource,\n                type: 'set',\n            });\n\n            req.c('hangup', {\n                xmlns: RAYO_XMLNS,\n            });\n\n            (this.connection as Connection).sendIQ(\n                req,\n                result => {\n                    logger.info('Hangup result ', result);\n                    this.callResource = null;\n                    resolve();\n                },\n                error => {\n                    handleStropheError(error, {\n                        callResource: this.callResource,\n                        operation: 'hangup (Rayo)',\n                        userJid: (this.connection as Connection).jid\n                    });\n                    this.callResource = null;\n                    reject(new Error('Hangup error '));\n                }\n            );\n        });\n    }\n}\n","/**\n * Strophe logger implementation. Logs from level WARN and above.\n */\nimport { getLogger } from '@jitsi/logger';\nimport { Strophe } from 'strophe.js';\n\nconst logger = getLogger('xmpp:strophe.util');\n\n/**\n * This is the last HTTP error status captured from Strophe debug logs.\n * The purpose of storing it is to distinguish between the network and\n * infrastructure reason for connection being dropped (see connectionHandler in\n * xmpp.js). The value will be cleared (-1) if the subsequent request succeeds\n * which means that the failure could be transient.\n *\n * FIXME in the latest Strophe (not released on npm) there is API to handle\n * particular HTTP errors, but there is no way to learn if the subsequent\n * request succeeded in order to tell if the error was one time incident or if\n * it was the reason for dropping the connection by Strophe (the connection is\n * dropped after 5 subsequent failures). Ideally Strophe should provide more\n * details about the reason on why the connection stopped.\n *\n * @type {number}\n */\nlet lastErrorStatus: number = -1;\n\n\n/**\n * A regular expression used to catch Strophe's log message indicating that the\n * last BOSH request was successful. When there is such message seen the\n * {@link lastErrorStatus} will be set back to '-1'.\n * @type {RegExp}\n */\nconst resetLastErrorStatusRegExpr: RegExp = /request id \\d+.\\d+ got 200/;\n\n/**\n * A regular expression used to capture the current value of the BOSH request\n * error status (HTTP error code or '0' or something else).\n * @type {RegExp}\n */\nconst lastErrorStatusRegExpr: RegExp\n    = /request errored, status: (\\d+), number of errors: \\d+/;\n\n/**\n *\n */\nexport default function(): void {\n\n    Strophe.log = function(level: number, msg: any): void {\n        // Our global handler reports uncaught errors to the stats which may\n        // interpret those as partial call failure.\n        // Strophe log entry about secondary request timeout does not mean that\n        // it's a final failure(the request will be restarted), so we lower it's\n        // level here to a warning.\n        logger.trace('Strophe', level, msg);\n        if (typeof msg === 'string'\n                && msg.indexOf('Request ') !== -1\n                && msg.indexOf('timed out (secondary), restarting') !== -1) {\n            // eslint-disable-next-line no-param-reassign\n            level = Strophe.LogLevel.WARN;\n        }\n\n        /* eslint-disable no-case-declarations */\n        switch (level) {\n        case Strophe.LogLevel.DEBUG:\n            // The log message which reports successful status is logged on\n            // Strophe's DEBUG level.\n            if (lastErrorStatus !== -1\n                    && resetLastErrorStatusRegExpr.test(msg)) {\n                logger.debug('Reset lastErrorStatus');\n                lastErrorStatus = -1;\n            }\n            break;\n        case Strophe.LogLevel.WARN:\n            logger.warn(`Strophe: ${msg}`);\n            const errStatusCapture = lastErrorStatusRegExpr.exec(msg);\n\n            if (errStatusCapture && errStatusCapture.length === 2) {\n                lastErrorStatus = parseInt(errStatusCapture[1], 10);\n                logger.debug(`lastErrorStatus set to: ${lastErrorStatus}`);\n            }\n            break;\n        case Strophe.LogLevel.ERROR:\n        case Strophe.LogLevel.FATAL:\n            logger.error(`Strophe: ${msg}`, msg);\n            break;\n        }\n\n        /* eslint-enable no-case-declarations */\n    };\n\n    /**\n     * Returns error status (HTTP error code) of the last BOSH request.\n     *\n     * @return {number} HTTP error code, '0' for unknown or \"god knows what\"\n     * (this is a hack).\n     */\n    Strophe.getLastErrorStatus = function(): number {\n        return lastErrorStatus;\n    };\n\n    Strophe.getStatusString = function(status: number): string {\n        switch (status) {\n        case Strophe.Status.BINDREQUIRED:\n            return 'BINDREQUIRED';\n        case Strophe.Status.ERROR:\n            return 'ERROR';\n        case Strophe.Status.CONNECTING:\n            return 'CONNECTING';\n        case Strophe.Status.CONNFAIL:\n            return 'CONNFAIL';\n        case Strophe.Status.AUTHENTICATING:\n            return 'AUTHENTICATING';\n        case Strophe.Status.AUTHFAIL:\n            return 'AUTHFAIL';\n        case Strophe.Status.CONNECTED:\n            return 'CONNECTED';\n        case Strophe.Status.DISCONNECTED:\n            return 'DISCONNECTED';\n        case Strophe.Status.DISCONNECTING:\n            return 'DISCONNECTING';\n        case Strophe.Status.ATTACHED:\n            return 'ATTACHED';\n        default:\n            return 'unknown';\n        }\n    };\n}\n","import { safeJsonParse } from '@jitsi/js-utils/json';\nimport { getLogger } from '@jitsi/logger';\nimport { cloneDeep, unescape } from 'lodash-es';\nimport { $msg, Strophe } from 'strophe.js';\n\nimport * as JitsiConnectionErrors from '../../JitsiConnectionErrors';\nimport * as JitsiConnectionEvents from '../../JitsiConnectionEvents';\nimport { XMPPEvents } from '../../service/xmpp/XMPPEvents';\nimport { XEP } from '../../service/xmpp/XMPPExtensioProtocols';\nimport RTCStats from '../RTCStats/RTCStats';\nimport { RTCStatsEvents } from '../RTCStats/RTCStatsEvents';\nimport browser from '../browser';\nimport { E2EEncryption } from '../e2ee/E2EEncryption';\nimport FeatureFlags from '../flags/FeatureFlags';\nimport Statistics from '../statistics/statistics';\nimport Listenable from '../util/Listenable';\nimport RandomUtil from '../util/RandomUtil';\nimport { exists, findFirst, getText } from '../util/XMLUtils';\n\nimport Caps, { parseDiscoInfo } from './Caps';\nimport ChatRoom from './ChatRoom';\nimport { IDENTITY_TYPE as FILE_SHARING_IDENTITY_TYPE } from './FileSharing';\nimport XmppConnection from './XmppConnection';\nimport Moderator from './moderator';\nimport './strophe.disco';\nimport MucConnectionPlugin from './strophe.emuc';\nimport JingleConnectionPlugin from './strophe.jingle';\nimport initStropheLogger from './strophe.logger';\nimport RayoConnectionPlugin from './strophe.rayo';\nimport initStropheUtil from './strophe.util';\n\nconst logger = getLogger('xmpp:Xmpp');\n\n/**\n * Connection options interface\n */\ninterface ICreateConnectionOptions {\n    enableWebsocketResume?: boolean;\n    serviceUrl?: string;\n    shard?: string;\n    token?: string;\n    websocketKeepAlive?: number;\n    websocketKeepAliveUrl?: string;\n    xmppPing?: Record<string, unknown>;\n}\n\n/**\n * Credentials interface for connection handler\n */\ninterface IConnectionCredentials {\n    jid?: string;\n    password?: string;\n    rid?: string;\n    sid?: string;\n}\n\n/**\n * Room creation options interface\n */\ninterface IRoomCreationOptions {\n    customDomain?: string;\n    statsId?: string;\n}\n\n/**\n * Connection details for failure reasons\n */\ninterface IConnectionFailedReasonDetails {\n    shard_changed?: boolean;\n    suspend_time?: number;\n    time_since_last_success?: number;\n}\n\n/**\n * Deployment info interface\n */\ninterface IDeploymentInfo {\n    backendRelease?: string;\n    region?: string;\n    shard?: string;\n}\n\n/**\n * Hosts configuration interface\n */\ninterface IHostsConfig {\n    anonymousdomain?: string;\n    domain?: string;\n    muc?: string;\n}\n\n/**\n * Testing configuration interface\n */\ninterface ITestingConfig {\n    enableGracefulReconnect?: boolean;\n}\n\n/**\n * P2P configuration interface\n */\ninterface IP2PConfig {\n    iceTransportPolicy?: string;\n    stunServers?: Array<{ urls: string; }>;\n}\n\n/**\n * XMPP options interface\n */\nexport interface IXMPPOptions {\n    bosh?: string;\n    deploymentInfo?: IDeploymentInfo;\n    disableBeforeUnloadHandlers?: boolean;\n    disableRtx?: boolean;\n    enableOpusRed?: boolean;\n    enableRemb?: boolean;\n    enableTcc?: boolean;\n    enableWebsocketResume?: boolean;\n    hosts?: IHostsConfig;\n    p2p?: IP2PConfig;\n    p2pStunServers?: Array<{ urls: string; }>;\n    serviceUrl?: string;\n    testing?: ITestingConfig;\n    websocketKeepAlive?: number;\n    websocketKeepAliveUrl?: string;\n    xmppPing?: Record<string, unknown>;\n}\n\nexport interface IFaceLandmarksPayload {\n    duration: number;\n    faceExpression: string;\n    timestamp: number;\n}\n\n/**\n * Identity interface for disco info\n */\nexport interface IIdentity {\n    name?: string;\n    type: string;\n}\n\n/**\n * Breakout rooms features interface\n */\ninterface IBreakoutRoomsFeatures {\n    rename?: boolean;\n}\n\n/**\n * JSON message interface\n */\ninterface IJsonMessage {\n    [key: string]: unknown;\n    users?: unknown;\n}\n\n/**\n* Regex to extract exact error message on jwt error.\n*/\nconst FAILURE_REGEX = /<failure.*><not-allowed\\/><text>(.*)<\\/text><\\/failure>/gi;\n\n/**\n * Creates XMPP connection.\n *\n * @param {Object} options\n * @param {string} [options.token] - JWT token used for authentication(JWT authentication module must be enabled in\n * Prosody).\n * @param {string} options.serviceUrl - The service URL for XMPP connection.\n * @param {string} options.shard - The shard where XMPP connection initially landed.\n * @param {string} options.enableWebsocketResume - True to enable stream resumption.\n * @param {number} [options.websocketKeepAlive] - See {@link XmppConnection} constructor.\n * @param {number} [options.websocketKeepAliveUrl] - See {@link XmppConnection} constructor.\n * @param {Object} [options.xmppPing] - See {@link XmppConnection} constructor.\n * @returns {XmppConnection}\n */\nfunction createConnection({\n    enableWebsocketResume,\n    serviceUrl = '/http-bind',\n    shard,\n    token,\n    websocketKeepAlive,\n    websocketKeepAliveUrl }: ICreateConnectionOptions): XmppConnection {\n\n    // Append token as URL param\n    if (token) {\n        // eslint-disable-next-line no-param-reassign\n        serviceUrl += `${serviceUrl.indexOf('?') === -1 ? '?' : '&'}token=${token}`;\n    }\n\n    return new XmppConnection({\n        enableWebsocketResume,\n        serviceUrl,\n        shard,\n        websocketKeepAlive,\n        websocketKeepAliveUrl\n    });\n}\n\n/**\n * Initializes Strophe plugins that need to work with Strophe.Connection directly rather than the lib-jitsi-meet's\n * {@link XmppConnection} wrapper.\n *\n * @returns {void}\n */\nfunction initStropheNativePlugins(): void {\n    initStropheUtil();\n    initStropheLogger();\n}\n\n// FIXME: remove once we have a default config template. -saghul\n/**\n * A list of ice servers to use by default for P2P.\n */\nexport const DEFAULT_STUN_SERVERS: Array<{ urls: string; }> = [\n    { urls: 'stun:meet-jit-si-turnrelay.jitsi.net:443' }\n];\n\n/**\n * The name of the field used to recognize a chat message as carrying a JSON\n * payload from another endpoint.\n * If the json-message of a chat message contains a valid JSON object, and\n * the JSON has this key, then it is a valid json-message to be sent.\n */\nexport const JITSI_MEET_MUC_TYPE: string = 'type';\n\n/**\n * The feature used by jigasi participants.\n * @type {string}\n */\nexport const FEATURE_JIGASI: string = 'http://jitsi.org/protocol/jigasi';\n\n/**\n * The feature used by jibri participants.\n * @type {string}\n */\nexport const FEATURE_JIBRI: string = 'http://jitsi.org/protocol/jibri';\n\n/**\n * The feature used by jigasi transcriber participants.\n * @type {string}\n */\nexport const FEATURE_TRANSCRIBER: string = 'http://jitsi.org/protocol/transcriber';\n\n/**\n * The feature used by the lib to mark support for e2ee. We use the feature by putting it in the presence\n * to avoid additional signaling (disco-info).\n * @type {string}\n */\nexport const FEATURE_E2EE: string = 'https://jitsi.org/meet/e2ee';\n\n/**\n * @internal\n */\nexport default class XMPP extends Listenable {\n    private _anonymousConnectionFailed: Optional<boolean>;\n    private _components: string[];\n    private _disconnectInProgress: Optional<Promise<void>> | boolean;\n    private _lastErrorMsg: Optional<string>;\n    private _preComponentsMsgs: Element[];\n    private _sysMessageHandler: unknown;\n    private _startConnecting: Optional<boolean>;\n    private _wasDisconnected: boolean;\n    public connection: Nullable<XmppConnection>;\n    public connectionTimes: Record<string, number>;\n    public options: IXMPPOptions;\n    public token: Optional<string>;\n    public authenticatedUser: boolean;\n    public moderator: Moderator;\n    public caps: Caps;\n    public sendDiscoInfo: Optional<boolean>;\n    public sendDeploymentInfo: Optional<boolean>;\n    public connectionFailed: Optional<boolean>;\n    public lobbySupported: Optional<boolean>;\n    public avModerationComponentAddress: Optional<string>;\n    public endConferenceComponentAddress: Optional<string>;\n    public speakerStatsComponentAddress: Optional<string>;\n    public breakoutRoomsComponentAddress: Optional<string>;\n    public breakoutRoomsFeatures: Optional<IBreakoutRoomsFeatures>;\n    public fileSharingComponentAddress: Optional<string>;\n    public roomMetadataComponentAddress: Optional<string>;\n    public pollsComponentAddress: Optional<string>;\n\n\n    /**\n     * FIXME describe all options\n     * @param {Object} options\n     * @param {String} options.serviceUrl - URL passed to the XMPP client which will be used to establish XMPP\n     * connection with the server.\n     * @param {boolean} options.enableWebsocketResume - Enables XEP-0198 stream management which will make the XMPP\n     * module try to resume the session in case the Websocket connection breaks.\n     * @param {number} [options.websocketKeepAlive] - The websocket keep alive interval. See {@link XmppConnection}\n     * constructor for more details.\n     * @param {number} [options.websocketKeepAliveUrl] - The websocket keep alive url. See {@link XmppConnection}\n     * constructor for more details.\n     * @param {Object} [options.xmppPing] - The xmpp ping settings.\n     * @param {Array<Object>} options.p2pStunServers see {@link JingleConnectionPlugin} for more details.\n     * @param token\n     */\n    constructor(options: IXMPPOptions, token?: string) {\n        super();\n\n        if (options.bosh && !options.serviceUrl) {\n            throw new Error('The \"bosh\" option is no longer supported, please use \"serviceUrl\" instead');\n        }\n\n        this.connection = null;\n        this._disconnectInProgress = false;\n        this.connectionTimes = {};\n        this.options = options;\n        this.token = token;\n        this.authenticatedUser = false;\n\n        if (!this.options.deploymentInfo) {\n            this.options.deploymentInfo = {};\n        }\n\n        // Cache of components used for certain features.\n        this._components = [];\n\n        // We want to track messages that are received before we process the disco-info components\n        // re-order of receiving we may drop some messages\n        this._preComponentsMsgs = [];\n\n        initStropheNativePlugins();\n\n        const xmppPing = options.xmppPing || {};\n\n        // let's ping the main domain (in case a guest one is used for the connection)\n        xmppPing.domain = options.hosts.domain;\n\n        this.connection = createConnection({\n            enableWebsocketResume: options.enableWebsocketResume,\n            serviceUrl: options.serviceUrl,\n            shard: options.deploymentInfo.shard,\n            token,\n            websocketKeepAlive: options.websocketKeepAlive,\n            websocketKeepAliveUrl: options.websocketKeepAliveUrl,\n            xmppPing\n        });\n\n        this.moderator = new Moderator(this);\n\n        // forwards the shard changed event\n        this.connection.on(XmppConnection.Events.CONN_SHARD_CHANGED, () => {\n            /* eslint-disable camelcase */\n            const details: IConnectionFailedReasonDetails = {\n                shard_changed: true,\n                suspend_time: this.connection.ping.getPingSuspendTime(),\n                time_since_last_success: this.connection.getTimeSinceLastSuccess()\n            };\n            /* eslint-enable camelcase */\n\n            if (this.options.testing?.enableGracefulReconnect) {\n                logger.debug('Shard changed, attempting graceful reconnect');\n                this.eventEmitter.emit(\n                    JitsiConnectionEvents.CONNECTION_FAILED,\n                    JitsiConnectionErrors.SHARD_CHANGED_ERROR\n                );\n            } else {\n                logger.error('Shard changed, kicking the user off the conference and forcing reload', JSON.stringify(details));\n                this.eventEmitter.emit(\n                    JitsiConnectionEvents.CONNECTION_FAILED,\n                    JitsiConnectionErrors.OTHER_ERROR,\n                    undefined,\n                    undefined,\n                    details);\n            }\n        });\n\n        this._initStrophePlugins();\n\n        this.caps = new Caps(this.connection, /* clientNode */ 'https://jitsi.org/jitsi-meet');\n\n        // Initialize features advertised in disco-info\n        this.initFeaturesList();\n\n        this.connection.addHandler(this._onPrivateMessage.bind(this), null, 'message', null, null);\n\n        // Setup a disconnect on unload as a way to facilitate API consumers. It\n        // sounds like they would want that. A problem for them though may be if\n        // they wanted to utilize the connected connection in an unload handler\n        // of their own. However, it should be fairly easy for them to do that\n        // by registering their unload handler before us.\n        const events = `${this.options.disableBeforeUnloadHandlers ? '' : 'beforeunload '}unload`;\n        const handleDisconnect = ev => {\n            // type-checking added as disconnect returns Promise<void> | boolean\n            const result = this.disconnect(ev);\n\n            if (result instanceof Promise) {\n                result.catch(() => {\n                    // Ignore errors in order to not break the unload.\n                });\n            }\n        };\n\n        for (const event of events.split(' ')) {\n            window.addEventListener(event, handleDisconnect);\n        }\n    }\n\n    /**\n     * Initializes the list of feature advertised through the disco-info\n     * mechanism.\n     */\n    private initFeaturesList(): void {\n        // http://xmpp.org/extensions/xep-0167.html#support\n        // http://xmpp.org/extensions/xep-0176.html#support\n        this.caps.addFeature(XEP.JINGLE);\n        this.caps.addFeature(XEP.RTP_MEDIA);\n        this.caps.addFeature(XEP.ICE_UDP_TRANSPORT);\n        this.caps.addFeature(XEP.DTLS_SRTP);\n        this.caps.addFeature(XEP.SCTP_DATA_CHANNEL);\n        this.caps.addFeature(XEP.RTP_AUDIO);\n        this.caps.addFeature(XEP.RTP_VIDEO);\n        this.caps.addFeature('http://jitsi.org/json-encoded-sources');\n\n        if (!(this.options.disableRtx || !browser.supportsRTX())) {\n            this.caps.addFeature('urn:ietf:rfc:4588');\n        }\n        if (this.options.enableOpusRed === true && browser.supportsAudioRed()) {\n            this.caps.addFeature('http://jitsi.org/opus-red');\n        }\n\n        if (typeof this.options.enableRemb === 'undefined' || this.options.enableRemb) {\n            this.caps.addFeature('http://jitsi.org/remb');\n        }\n\n        // Disable TCC on Firefox 114 and older versions because of a known issue where BWE is halved on every\n        // renegotiation.\n        if (!(browser.isFirefox() && browser.isVersionLessThan(115))\n            && (typeof this.options.enableTcc === 'undefined' || this.options.enableTcc)) {\n            this.caps.addFeature('http://jitsi.org/tcc');\n        }\n        if (this.connection.rayo) {\n            this.caps.addFeature('urn:xmpp:rayo:client:1');\n        }\n\n        if (E2EEncryption.isSupported(this.options)) {\n            this.caps.addFeature(FEATURE_E2EE, false, true);\n        }\n\n        // Advertise source-name signaling when the endpoint supports it.\n        logger.debug('Source-name signaling is enabled');\n        this.caps.addFeature('http://jitsi.org/source-name');\n\n        logger.debug('Receiving multiple video streams is enabled');\n        this.caps.addFeature('http://jitsi.org/receive-multiple-video-streams');\n\n        // Advertise support for ssrc-rewriting.\n        if (FeatureFlags.isSsrcRewritingSupported()) {\n            this.caps.addFeature('http://jitsi.org/ssrc-rewriting-1');\n        }\n\n        // Use \"-1\" as a version that we can bump later. This should match\n        // the version added in moderator.js, this one here is mostly defined\n        // for keeping stats, since it is not made available to jocofo at\n        // the time of the initial conference-request.\n        this.caps.addFeature('http://jitsi.org/visitors-1');\n\n        // Advertise support for startMuted policy through room metadata.\n        this.caps.addFeature('http://jitsi.org/start-muted-room-metadata');\n    }\n\n\n    /**\n     * A private message is received, message that is not addressed to the muc.\n     * We expect private message coming from plugins component if it is\n     * enabled and running.\n     *\n     * @param {string} msg - The message.\n     */\n    private _onPrivateMessage(msg: Element): boolean {\n        const from = msg.getAttribute('from');\n\n        if (!this._components.includes(from)) {\n            this._preComponentsMsgs.push(msg);\n\n            return true;\n        }\n\n        // Use *|xmlns to match xmlns attributes across any namespace (CSS Selectors Level 3)\n        const jsonMessage = getText(findFirst(msg, ':scope>json-message[*|xmlns=\"http://jitsi.org/jitmeet\"]'));\n        const parsedJson = this.tryParseJSONAndVerify(jsonMessage);\n\n        if (!parsedJson || typeof parsedJson !== 'object') {\n            return true;\n        }\n\n        if (parsedJson[JITSI_MEET_MUC_TYPE] === 'speakerstats' && parsedJson.users) {\n            this.eventEmitter.emit(XMPPEvents.SPEAKER_STATS_RECEIVED, parsedJson.users);\n        } else if (parsedJson[JITSI_MEET_MUC_TYPE] === 'av_moderation') {\n            this.eventEmitter.emit(XMPPEvents.AV_MODERATION_RECEIVED, parsedJson);\n        } else if (parsedJson[JITSI_MEET_MUC_TYPE] === 'breakout_rooms') {\n            this.eventEmitter.emit(XMPPEvents.BREAKOUT_ROOMS_EVENT, parsedJson);\n        } else if (parsedJson[JITSI_MEET_MUC_TYPE] === FILE_SHARING_IDENTITY_TYPE) {\n            this.eventEmitter.emit(XMPPEvents.FILE_SHARING_EVENT, parsedJson);\n        } else if (parsedJson[JITSI_MEET_MUC_TYPE] === 'room_metadata') {\n            this.eventEmitter.emit(XMPPEvents.ROOM_METADATA_EVENT, parsedJson);\n        } else if (parsedJson[JITSI_MEET_MUC_TYPE] === 'visitors') {\n            this.eventEmitter.emit(XMPPEvents.VISITORS_MESSAGE, parsedJson);\n        } else if (parsedJson[JITSI_MEET_MUC_TYPE] === 'polls') {\n            this.eventEmitter.emit(XMPPEvents.POLLS_EVENT, parsedJson);\n        }\n\n        return true;\n    }\n\n    /**\n     * Sends deployment info to stats if not sent already.\n     * We want to try sending it on failure to connect\n     * or when we get a sys message(from jiconop2)\n     * or after success or failure of disco-info\n     * @param force Whether to force sending without checking anything.\n     * @private\n     */\n    private _maybeSendDeploymentInfoStat(force: boolean = false): void {\n        const acceptedStatuses = [\n            Strophe.Status.ERROR,\n            Strophe.Status.CONNFAIL,\n            Strophe.Status.AUTHFAIL,\n            Strophe.Status.DISCONNECTED,\n            Strophe.Status.CONNTIMEOUT\n        ];\n\n        if (!force && !(acceptedStatuses.includes(this.connection.status) && this.sendDeploymentInfo)) {\n            return;\n        }\n\n        // Log deployment-specific information, if available. Defined outside\n        // the application by individual deployments\n        const aprops = this.options.deploymentInfo;\n\n        if (Object.keys(aprops ?? {}).length > 0) {\n            const logObject = { id: undefined };\n\n            for (const attr in aprops) {\n                if (aprops.hasOwnProperty(attr)) {\n                    logObject[attr] = aprops[attr];\n                }\n            }\n\n            // Let's push to analytics any updates that may have come from the backend\n            Statistics.analytics.addPermanentProperties({ ...logObject });\n\n            logObject.id = 'deployment_info';\n            const entry = JSON.stringify(logObject);\n\n            logger.info(entry);\n        }\n\n        this.sendDeploymentInfo = false;\n\n        const { region, shard } = aprops;\n\n        if (region || shard) {\n            // avoids sending empty values\n            this.eventEmitter.emit(JitsiConnectionEvents.PROPERTIES_UPDATED, cloneDeep({ region, shard }));\n        }\n    }\n\n\n    /**\n     * Process received identities.\n     * @param {Set<String>} identities The identities to process.\n     * @param {Set<String>} features The features to process, optional. If missing lobby component will be queried\n     * for more features.\n     * @private\n     */\n    private _processDiscoInfoIdentities(identities: Set<IIdentity>, features?: Set<string>): void {\n        // check for speakerstats\n        identities.forEach(identity => {\n            if (identity.type === 'av_moderation') {\n                this.avModerationComponentAddress = identity.name;\n                this._components.push(this.avModerationComponentAddress);\n            }\n\n            if (identity.type === 'end_conference') {\n                this.endConferenceComponentAddress = identity.name;\n                this._components.push(this.endConferenceComponentAddress);\n            }\n\n            if (identity.type === 'speakerstats') {\n                this.speakerStatsComponentAddress = identity.name;\n                this._components.push(this.speakerStatsComponentAddress);\n            }\n\n            if (identity.type === 'lobbyrooms') {\n                this.lobbySupported = true;\n                const processLobbyFeatures = f => {\n                    f.forEach(fr => {\n                        if (fr.endsWith('#displayname_required')) {\n                            this.eventEmitter.emit(JitsiConnectionEvents.DISPLAY_NAME_REQUIRED);\n                        }\n                    });\n                };\n\n                if (features) {\n                    processLobbyFeatures(features);\n                } else {\n                    identity.name && this.caps.getFeaturesAndIdentities(identity.name, identity.type)\n                        .then(({ features: f }) => processLobbyFeatures(f))\n                        .catch(e => logger.warn('Error getting features from lobby.', e?.message));\n                }\n            }\n\n            if (identity.type === 'shard') {\n                this.options.deploymentInfo.shard = this.connection.shard = identity.name;\n            }\n\n            if (identity.type === 'region') {\n                // @ts-ignore property 'region' does not exist on 'XmppConnection'\n                this.options.deploymentInfo.region = this.connection.region = identity.name;\n            }\n\n            if (identity.type === 'release') {\n                this.options.deploymentInfo.backendRelease = identity.name;\n            }\n\n            if (identity.type === 'breakout_rooms') {\n                this.breakoutRoomsComponentAddress = identity.name;\n                this._components.push(this.breakoutRoomsComponentAddress);\n\n                const processBreakoutRoomsFeatures = f => {\n                    this.breakoutRoomsFeatures = {};\n\n                    f.forEach(fr => {\n                        if (fr.endsWith('#rename')) {\n                            this.breakoutRoomsFeatures.rename = true;\n                        }\n                    });\n                };\n\n                if (features) {\n                    processBreakoutRoomsFeatures(features);\n                } else {\n                    identity.name && this.caps.getFeaturesAndIdentities(identity.name, identity.type)\n                        .then(({ features: f }) => processBreakoutRoomsFeatures(f))\n                        .catch(e => logger.warn('Error getting features for breakout rooms.', e?.message));\n                }\n            }\n\n            if (identity.type === FILE_SHARING_IDENTITY_TYPE) {\n                this.fileSharingComponentAddress = identity.name;\n                this._components.push(this.fileSharingComponentAddress);\n            }\n\n            if (identity.type === 'room_metadata') {\n                this.roomMetadataComponentAddress = identity.name;\n                this._components.push(this.roomMetadataComponentAddress);\n            }\n\n            if (identity.type === 'visitors') {\n                this._components.push(identity.name);\n            }\n\n            if (identity.type === 'polls') {\n                this.pollsComponentAddress = identity.name;\n                this._components.push(this.pollsComponentAddress);\n            }\n        });\n\n        this._maybeSendDeploymentInfoStat(true);\n\n        if (this._components.length > 0) {\n            this._preComponentsMsgs.forEach(this._onPrivateMessage.bind(this));\n        }\n        this._preComponentsMsgs = [];\n    }\n\n    /**\n    * Parses a raw failure xmpp xml message received on auth failed.\n    *\n    * @param {string} msg - The raw failure message from xmpp.\n    * @returns {string|null} - The parsed message from the raw xmpp message.\n    */\n    private _parseConnectionFailedMessage(msg?: string): Nullable<string> {\n        if (!msg) {\n            return null;\n        }\n\n        FAILURE_REGEX.lastIndex = 0;\n        const matches = FAILURE_REGEX.exec(msg);\n\n        return matches ? matches[1] : null;\n    }\n\n    /**\n     *\n     * @param jid\n     * @param password\n     */\n    private _connect(jid: string, password?: string): void {\n        // connection.connect() starts the connection process.\n        //\n        // As the connection process proceeds, the user supplied callback will\n        // be triggered multiple times with status updates. The callback should\n        // take two arguments - the status code and the error condition.\n        //\n        // The status code will be one of the values in the Strophe.Status\n        // constants. The error condition will be one of the conditions defined\n        // in RFC 3920 or the condition strophe-parsererror.\n        //\n        // The Parameters wait, hold and route are optional and only relevant\n        // for BOSH connections. Please see XEP 124 for a more detailed\n        // explanation of the optional parameters.\n        //\n        // Connection status constants for use by the connection handler\n        // callback.\n        //\n        //  Status.ERROR - An error has occurred (websockets specific)\n        //  Status.CONNECTING - The connection is currently being made\n        //  Status.CONNFAIL - The connection attempt failed\n        //  Status.AUTHENTICATING - The connection is authenticating\n        //  Status.AUTHFAIL - The authentication attempt failed\n        //  Status.CONNECTED - The connection has succeeded\n        //  Status.DISCONNECTED - The connection has been terminated\n        //  Status.DISCONNECTING - The connection is currently being terminated\n        //  Status.ATTACHED - The connection has been attached\n\n        this._resetState();\n\n        // we want to send this only on the initial connect\n        this.sendDiscoInfo = true;\n        this.sendDeploymentInfo = true;\n\n        if (this.connection._stropheConn?._addSysHandler) {\n            this._sysMessageHandler = this.connection._stropheConn._addSysHandler(\n                this._onSystemMessage.bind(this),\n                null,\n                'message'\n            );\n        } else {\n            logger.warn('Cannot attach strophe system handler, jiconop cannot operate');\n        }\n\n        this.connection.connect(\n            jid,\n            password,\n            this.connectionHandler.bind(this, {\n                jid,\n                password\n            }));\n    }\n\n    /**\n     * Receives system messages during the connect/login process and checks for services or\n     * @param msg The received message.\n     * @returns {void}\n     * @private\n     */\n    private _onSystemMessage(msg: Element): void {\n        // proceed only if the message has any of the expected information\n        if (!exists(msg, ':scope>services') && !exists(msg, ':scope>query')) {\n            return;\n        }\n\n        this.sendDiscoInfo = false;\n        const foundIceServers = this.connection.jingle.onReceiveStunAndTurnCredentials(msg) || false;\n\n        const { features, identities } = parseDiscoInfo(msg);\n\n        this._processDiscoInfoIdentities(identities, features);\n\n        if (foundIceServers || identities.size > 0 || features.size > 0) {\n            this.connection._stropheConn.deleteHandler(this._sysMessageHandler);\n            this._sysMessageHandler = null;\n        }\n    }\n\n    /**\n     * The method is supposed to gracefully close the XMPP connection and the main goal is to make sure that the current\n     * participant will be removed from the conference XMPP MUC, so that it doesn't leave a \"ghost\" participant behind.\n     *\n     * @param {Object} ev - Optionally, the event which triggered the necessity to disconnect from the XMPP server\n     * (e.g. beforeunload, unload).\n     * @private\n     * @returns {void}\n     */\n    private _cleanupXmppConnection(ev: Optional<Event>): void {\n        // XXX Strophe is asynchronously sending by default. Unfortunately, that means that there may not be enough time\n        // to send an unavailable presence or disconnect at all. Switching Strophe to synchronous sending is not much of\n        // an option because it may lead to a noticeable delay in navigating away from the current location. As\n        // a compromise, we will try to increase the chances of sending an unavailable presence and/or disconnecting\n        // within the short time span that we have upon unloading by invoking flush() on the connection. We flush() once\n        // before disconnect() in order to attempt to have its unavailable presence at the top of the send queue. We\n        // flush() once more after disconnect() in order to attempt to have its unavailable presence sent as soon as\n        // possible.\n        !this.connection.isUsingWebSocket && this.connection.flush();\n\n        if (!this.connection.isUsingWebSocket && ev !== null && typeof ev !== 'undefined') {\n            const evType = ev.type;\n\n            if (evType === 'beforeunload' || evType === 'unload') {\n                // XXX Whatever we said above, synchronous sending is the best (known) way to properly disconnect from\n                // the XMPP server. Consequently, it may be fine to have the source code and comment it in or out\n                // depending on whether we want to run with it for some time.\n                this.connection.options.sync = true;\n\n                // This is needed in some browsers where sync xhr sending is disabled by default on unload.\n                if (this.connection.sendUnavailableBeacon()) {\n\n                    return;\n                }\n            }\n        }\n\n        this.connection.disconnect();\n\n        this._startConnecting = false;\n\n        if (this.connection.options.sync !== true) {\n            this.connection.flush();\n        }\n    }\n\n    /**\n     *\n     */\n    private _initStrophePlugins(): void {\n        const iceConfig = {\n            jvb: { iceServers: [ ] },\n            p2p: { iceServers: [ ], iceTransportPolicy: undefined }\n        };\n\n        const p2pStunServers = (this.options.p2p?.stunServers) || DEFAULT_STUN_SERVERS;\n\n        if (Array.isArray(p2pStunServers)) {\n            logger.info('P2P STUN servers: ', p2pStunServers);\n            iceConfig.p2p.iceServers = p2pStunServers;\n        }\n\n        if (this.options.p2p?.iceTransportPolicy) {\n            logger.info('P2P ICE transport policy: ',\n                this.options.p2p.iceTransportPolicy);\n\n            iceConfig.p2p.iceTransportPolicy\n                = this.options.p2p.iceTransportPolicy;\n        }\n\n        this.connection.addConnectionPlugin('emuc', new MucConnectionPlugin(this));\n        this.connection.addConnectionPlugin('jingle', new JingleConnectionPlugin(this, this.eventEmitter, iceConfig));\n        this.connection.addConnectionPlugin('rayo', new RayoConnectionPlugin());\n    }\n\n    /**\n     * Returns details about connection failure. Shard change or is it after\n     * suspend.\n     * @returns { IConnectionFailedReasonDetails} contains details about a connection failure.\n     * @private\n     */\n    private _getConnectionFailedReasonDetails(): IConnectionFailedReasonDetails {\n        const details: IConnectionFailedReasonDetails = {};\n\n        // check for moving between shard if information is available\n        if (this.options.deploymentInfo?.shard\n            && this.connection.lastResponseHeaders) {\n\n            // split headers by line\n            const headersArr = this.connection.lastResponseHeaders\n                .trim().split(/[\\r\\n]+/);\n            const headers = {};\n\n            headersArr.forEach(line => {\n                const parts = line.split(': ');\n                const header = parts.shift();\n                const value = parts.join(': ');\n\n                headers[header] = value;\n            });\n\n            /* eslint-disable camelcase */\n            details.shard_changed\n                = this.options.deploymentInfo.shard\n                    !== headers['x-jitsi-shard'];\n            /* eslint-enable camelcase */\n        }\n\n        /* eslint-disable camelcase */\n        // check for possible suspend\n        details.suspend_time = this.connection.ping.getPingSuspendTime();\n        details.time_since_last_success = this.connection.getTimeSinceLastSuccess();\n        /* eslint-enable camelcase */\n\n        return details;\n    }\n\n    /**\n     * Resets any state/flag before starting a new connection.\n     * @private\n     */\n    private _resetState(): void {\n        this._anonymousConnectionFailed = false;\n        this.connectionFailed = false;\n        this._lastErrorMsg = undefined;\n        this._disconnectInProgress = undefined;\n        this._wasDisconnected = false;\n    }\n\n    /**\n     * Returns the current XMPP connection instance.\n     */\n    public getConnection(): XmppConnection {\n        return this.connection;\n    }\n\n    /**\n     * Receive connection status changes and handles them.\n     *\n     * @param {Object} credentials\n     * @param {string} credentials.jid - The user's XMPP ID passed to the\n     * connect method. For example, 'user@xmpp.com'.\n     * @param {string} credentials.password - The password passed to the connect\n     * method.\n     * @param {string} status - One of Strophe's connection status strings.\n     * @param {string} [msg] - The connection error message provided by Strophe.\n     */\n    public connectionHandler(credentials: IConnectionCredentials = {}, status: Strophe.Status, msg?: string): void {\n        const now = window.performance.now();\n        const statusStr = Strophe.getStatusString(status).toLowerCase();\n\n        this.connectionTimes[statusStr] = now;\n        logger.info(`(TIME) Strophe ${statusStr}${msg ? `[${msg}]` : ''}:\\t`, now);\n\n        this.eventEmitter.emit(XMPPEvents.CONNECTION_STATUS_CHANGED, credentials, status, msg);\n        this._maybeSendDeploymentInfoStat();\n        if (status === Strophe.Status.CONNECTED || status === Strophe.Status.ATTACHED) {\n            // once connected or attached we no longer need this handle, drop it if it exist\n            if (this._sysMessageHandler) {\n                this.connection._stropheConn.deleteHandler(this._sysMessageHandler);\n                this._sysMessageHandler = null;\n            }\n            this.sendDiscoInfo && this.connection.jingle.getStunAndTurnCredentials();\n\n            logger.info(`My Jabber ID: ${this.connection.jid}`);\n\n            this._wasDisconnected && RTCStats.sendStatsEntry(RTCStatsEvents.STROPHE_RECONNECTED_EVENT);\n\n            // XmppConnection emits CONNECTED again on reconnect - a good opportunity to clear any \"last error\" flags\n            this._resetState();\n\n            // make sure we will send the info after the features request succeeds or fails\n            this.sendDeploymentInfo = false;\n            this.sendDiscoInfo && this.caps.getFeaturesAndIdentities(this.options.hosts.domain, undefined)\n                .then(({ features, identities }) => {\n                    if (!features.has(Strophe.NS.PING)) {\n                        logger.error(`Ping NOT supported by ${\n                            this.options.hosts.domain} - please enable ping in your XMPP server config`);\n                    }\n\n                    this._processDiscoInfoIdentities(\n                        identities, undefined /* when querying we will query for features */);\n                })\n                .catch(error => {\n                    logger.error('Feature discovery error', error);\n\n                    this._maybeSendDeploymentInfoStat(true);\n                });\n\n            // make sure we don't query again\n            this.sendDiscoInfo = false;\n\n            if (credentials.password) {\n                this.authenticatedUser = true;\n            }\n            if (this.connection && this.connection.connected\n                && Strophe.getResourceFromJid(this.connection.jid)) {\n                // .connected is true while connecting?\n                // this.connection.send($pres());\n                this.eventEmitter.emit(\n                    JitsiConnectionEvents.CONNECTION_ESTABLISHED,\n                    Strophe.getResourceFromJid(this.connection.jid));\n            }\n        } else if (status === Strophe.Status.CONNFAIL) {\n            if (msg === 'x-strophe-bad-non-anon-jid') {\n                this._anonymousConnectionFailed = true;\n            } else {\n                this.connectionFailed = true;\n            }\n            this._lastErrorMsg = msg;\n            if (msg === 'giving-up') {\n                this.eventEmitter.emit(\n                    JitsiConnectionEvents.CONNECTION_FAILED,\n                    JitsiConnectionErrors.OTHER_ERROR, msg);\n            }\n        } else if (status === Strophe.Status.ERROR) {\n            this._lastErrorMsg = msg;\n        } else if (status === Strophe.Status.DISCONNECTED) {\n            RTCStats.sendStatsEntry(RTCStatsEvents.STROPHE_DISCONNECTED_EVENT);\n            this._wasDisconnected = true;\n            // Stop ping interval\n            this.connection.ping.stopInterval();\n            const wasIntentionalDisconnect = Boolean(this._disconnectInProgress);\n            const errMsg = msg || this._lastErrorMsg;\n\n            if (this._anonymousConnectionFailed) {\n                // prompt user for username and password\n                this.eventEmitter.emit(\n                    JitsiConnectionEvents.CONNECTION_FAILED,\n                    JitsiConnectionErrors.PASSWORD_REQUIRED);\n            } else if (this.connectionFailed) {\n                this.eventEmitter.emit(\n                    JitsiConnectionEvents.CONNECTION_FAILED,\n                    JitsiConnectionErrors.OTHER_ERROR,\n                    errMsg,\n                    undefined, /* credentials */\n                    this._getConnectionFailedReasonDetails());\n            } else if (wasIntentionalDisconnect) {\n                this.eventEmitter.emit(\n                    JitsiConnectionEvents.CONNECTION_DISCONNECTED, errMsg);\n            } else {\n                // XXX if Strophe drops the connection while not being asked to,\n                // it means that most likely some serious error has occurred.\n                // One currently known case is when a BOSH request fails for\n                // more than 4 times. The connection is dropped without\n                // supplying a reason(error message/event) through the API.\n                logger.error('XMPP connection dropped!');\n\n                // XXX if the last request error is within 5xx range it means it\n                // was a server failure\n                const lastErrorStatus = Strophe.getLastErrorStatus();\n\n                if (lastErrorStatus >= 500 && lastErrorStatus < 600) {\n                    this.eventEmitter.emit(\n                        JitsiConnectionEvents.CONNECTION_FAILED,\n                        JitsiConnectionErrors.SERVER_ERROR,\n                        errMsg || 'server-error',\n                        /* credentials */ undefined,\n                        this._getConnectionFailedReasonDetails());\n                } else {\n                    this.eventEmitter.emit(\n                        JitsiConnectionEvents.CONNECTION_FAILED,\n                        JitsiConnectionErrors.CONNECTION_DROPPED_ERROR,\n                        errMsg || 'connection-dropped-error',\n                        /* credentials */ undefined,\n                        this._getConnectionFailedReasonDetails());\n                }\n            }\n        } else if (status === Strophe.Status.AUTHFAIL) {\n            const lastFailedRawMessage = this.getConnection().getLastFailedMessage();\n\n            // wrong password or username, prompt user\n            this.eventEmitter.emit(\n                JitsiConnectionEvents.CONNECTION_FAILED,\n                JitsiConnectionErrors.PASSWORD_REQUIRED,\n                msg || this._parseConnectionFailedMessage(lastFailedRawMessage),\n                credentials);\n        }\n    }\n\n    /**\n     * Attach to existing connection. Can be used for optimizations. For\n     * example: if the connection is created on the server we can attach to it\n     * and start using it.\n     *\n     * @param options {object} connecting options - rid, sid, jid and password.\n     */\n    public attach(options: IConnectionCredentials): void {\n        this._resetState();\n\n        // we want to send this only on the initial connect\n        this.sendDiscoInfo = true;\n\n        const now = this.connectionTimes.attaching = window.performance.now();\n\n        logger.info('(TIME) Strophe Attaching:\\t', now);\n        this.connection.attach(options.jid, options.sid,\n            (Number.parseInt(options.rid, 10) + 1).toString(),\n            this.connectionHandler.bind(this, {\n                jid: options.jid,\n                password: options.password\n            }));\n    }\n\n    /**\n     *\n     * @param jid\n     * @param password\n     */\n    public connect(jid: string, password: string) {\n        if (!jid) {\n            const { anonymousdomain, domain } = this.options.hosts;\n            let configDomain = anonymousdomain || domain;\n\n            // Force authenticated domain if room is appended with '?login=true'\n            // or if we're joining with the token\n\n            // FIXME Do not rely on window.location because (1) React Native\n            // does not have a window.location by default and (2) here we cannot\n            // know for sure that query/search has not be stripped from\n            // window.location by the time the following executes.\n            const { location } = window;\n\n            if (anonymousdomain) {\n                const search = location?.search;\n\n                if ((search && search.indexOf('login=true') !== -1)\n                        || this.token) {\n                    configDomain = domain;\n                }\n            }\n\n            // eslint-disable-next-line no-param-reassign\n            jid = configDomain || (location?.hostname);\n        }\n\n        this._startConnecting = true;\n\n        return this._connect(jid, password);\n    }\n\n    /**\n     * Joins or creates a muc with the provided jid, created from the passed\n     * in room name and muc host and onCreateResource result.\n     *\n     * @param {string} roomName - The name of the muc to join.\n     * @param {Object} options - Configuration for how to join the muc.\n     * @param {Function} [onCreateResource] - Callback to invoke when a resource\n     * is to be added to the jid.\n     * @returns {ChatRoom} Resolves with an instance of a strophe muc.\n     */\n    public createRoom(roomName: string, options: IRoomCreationOptions, onCreateResource: (jid: string, user: any) => string): ChatRoom {\n        // Support passing the domain in a String object as part of the room name.\n        const domain = (roomName as { domain?: string; }).domain || options.customDomain;\n\n        // There are cases (when using subdomain) where muc can hold an uppercase part\n        let roomjid = `${this.getRoomJid(roomName, domain)}/`;\n        const mucNickname = onCreateResource\n            ? onCreateResource(this.connection.jid, this.authenticatedUser)\n            : RandomUtil.randomHexString(8).toLowerCase();\n\n        logger.info(`JID ${this.connection.jid} using MUC nickname ${mucNickname}`);\n        roomjid += mucNickname;\n\n        return this.connection.emuc?.createRoom?.(roomjid, null, options);\n    }\n\n    /**\n     * Returns the room JID based on the passed room name and domain.\n     *\n     * @param {string} roomName - The room name.\n     * @param {string} domain - The domain.\n     * @returns {string} - The room JID.\n     */\n    public getRoomJid(roomName: string, domain: string): string {\n        return `${roomName}@${domain ? domain : this.options.hosts.muc.toLowerCase()}`;\n    }\n\n    /**\n     * Check if a room with the passed JID is already created.\n     *\n     * @param {string} roomJid - The JID of the room.\n     * @returns {boolean}\n     */\n    public isRoomCreated(roomName: string, domain: string): boolean {\n        return this.connection.emuc?.isRoomCreated?.(this.getRoomJid(roomName, domain)) || false;\n    }\n\n    /**\n     * Returns the jid of the participant associated with the Strophe connection.\n     *\n     * @returns {string} The jid of the participant.\n     */\n    public getJid(): string {\n        return this.connection.jid;\n    }\n\n    /**\n     * Returns the logs from strophe.jingle.\n     * @returns {Record<string, unknown>} - The jingle logs.\n     */\n    public getJingleLog(): Record<string, unknown> {\n        const jingle = this.connection.jingle;\n\n\n        return jingle ? jingle.getLog() : { metadata: {} };\n    }\n\n    /**\n     * Returns the logs from strophe.\n     */\n    public getXmppLog(): Nullable<object> {\n        return this.connection.logger?.log || null;\n    }\n\n    /**\n     *\n     */\n    public dial(...args: [to: string, from: string, roomName: string, roomPass: string, focusMucJid: string]): Promise<void> {\n        return this.connection.rayo?.dial(...args);\n    }\n\n    /**\n     * Pings the server.\n     * @param timeout how many ms before a timeout should occur.\n     * @returns {Promise} resolved on ping success and reject on an error or\n     * a timeout.\n     */\n    public ping(timeout: number): Promise<void> {\n        return new Promise((resolve, reject) => {\n            this.connection.ping.ping(this.connection.pingDomain, resolve, reject, timeout);\n        });\n    }\n\n    /**\n     *\n     */\n    public getSessions(): object {\n        return this.connection.jingle.sessions;\n    }\n\n    /**\n     * Disconnects this from the XMPP server (if this is connected).\n     *\n     * @param {Object} ev - Optionally, the event which triggered the necessity to\n     * disconnect from the XMPP server (e.g. beforeunload, unload).\n     * @returns {Promise} - Resolves when the disconnect process is finished or rejects with an error.\n     */\n    public disconnect(ev: Optional<Event> = undefined): Promise<void> | boolean {\n        logger.info(`XMPP disconnect triggered by the event=${ev?.type}`);\n        if (this._disconnectInProgress) {\n            return this._disconnectInProgress;\n        } else if (!this.connection || !this._startConnecting) {\n            // we have created a connection, but never called connect we still want to resolve on calling disconnect\n            // this is visitors use case when using http to send conference request.\n            return Promise.resolve();\n        }\n\n        this._disconnectInProgress = new Promise(resolve => {\n            const disconnectListener = (credentials, status) => {\n                if (status === Strophe.Status.DISCONNECTED) {\n                    this.eventEmitter.removeListener(XMPPEvents.CONNECTION_STATUS_CHANGED, disconnectListener);\n                    resolve();\n                }\n            };\n\n            this.eventEmitter.on(XMPPEvents.CONNECTION_STATUS_CHANGED, disconnectListener);\n        });\n\n        this._cleanupXmppConnection(ev);\n\n        return this._disconnectInProgress;\n    }\n\n    /**\n     * Notifies speaker stats component if available that we are the new\n     * dominant speaker in the conference.\n     * @param {String} roomJid - The room jid where the speaker event occurred.\n     * @param {boolean} silence - Whether the dominant speaker is silent or not.\n     */\n    public sendDominantSpeakerEvent(roomJid: string, silence: boolean): void {\n        // no speaker stats component advertised\n        if (!this.speakerStatsComponentAddress || !roomJid) {\n            return;\n        }\n\n        const msg = $msg({ to: this.speakerStatsComponentAddress });\n\n        msg.c('speakerstats', {\n            room: roomJid,\n            silence,\n            xmlns: 'http://jitsi.org/jitmeet'\n        }).up();\n\n        this.connection.send(msg);\n    }\n\n    /**\n     * Sends face landmarks to speaker stats component.\n     * @param {String} roomJid - The room jid where the speaker event occurred.\n     * @param {Object} payload - The expression to be sent to the speaker stats.\n     */\n    public sendFaceLandmarksEvent(roomJid: string, payload: IFaceLandmarksPayload): void {\n        // no speaker stats component advertised\n        if (!this.speakerStatsComponentAddress || !roomJid) {\n            return;\n        }\n\n        const msg = $msg({ to: this.speakerStatsComponentAddress });\n\n        msg.c('faceLandmarks', {\n            duration: payload.duration,\n            faceExpression: payload.faceExpression,\n            room: roomJid,\n            timestamp: payload.timestamp,\n            xmlns: 'http://jitsi.org/jitmeet'\n        }).up();\n\n        this.connection.send(msg);\n    }\n\n    /**\n     * Check if the given argument is a valid JSON ENDPOINT_MESSAGE string by\n     * parsing it and checking if it has a field called 'type'.\n     *\n     * @param {string} jsonString check if this string is a valid json string\n     * and contains the special structure.\n     * @returns {boolean, object} if given object is a valid JSON string, return\n     * the json object. Otherwise, returns false.\n     */\n    public tryParseJSONAndVerify(jsonString: string): boolean | IJsonMessage {\n        // ignore empty strings, like message errors\n        if (!jsonString) {\n            return false;\n        }\n\n        try {\n            // Note: we use `unescape` to also convert HTML entities to UTF-8 since\n            // Jigasi seems to encode them like that in some circumstances.\n            const json = safeJsonParse(unescape(jsonString));\n\n            // Handle non-exception-throwing cases:\n            // Neither JSON.parse(false) or JSON.parse(1234) throw errors,\n            // hence the type-checking,\n            // but... JSON.parse(null) returns null, and\n            // typeof null === \"object\",\n            // so we must check for that, too.\n            // Thankfully, null is falsey, so this suffices:\n            if (json && typeof json === 'object') {\n                const type = json[JITSI_MEET_MUC_TYPE];\n\n                if (typeof type !== 'undefined') {\n                    return json;\n                }\n\n                logger.debug('parsing valid json but does not have correct '\n                    + 'structure', 'topic: ', type);\n            }\n        } catch (e) {\n            logger.error(`Error parsing json ${jsonString}`, e);\n\n            return false;\n        }\n\n        return false;\n    }\n}\n","export enum E2EEErrors {\n    E2EE_OLM_NO_ONE_TIME_KEYS = 'e2ee.olm.no-one-time-keys',\n    E2EE_OLM_SESSION_ALREADY_EXISTS = 'e2ee.olm.session-already-exists',\n    E2EE_OLM_SESSION_INIT_PENDING = 'e2ee.olm.session-init-pending',\n    E2EE_SAS_CHANNEL_VERIFICATION_FAILED = 'e2ee.sas.channel-verification-failed',\n    E2EE_SAS_COMMITMENT_MISMATCHED = 'e2ee.sas.commitment-mismatched',\n    E2EE_SAS_INVALID_SAS_VERIFICATION = 'e2ee.sas.invalid-sas-verification',\n    E2EE_SAS_KEYS_MAC_MISMATCH = 'e2ee.sas.keys-mac-mismatch',\n    E2EE_SAS_MAC_MISMATCH = 'e2ee.sas.mac-mismatch',\n    E2EE_SAS_MISSING_KEY = 'e2ee.sas.missing-key'\n}\n","/* eslint-disable no-bitwise */\n/* eslint-disable no-mixed-operators */\n\n/**\n * Generates a SAS composed of decimal numbers.\n * Borrowed from the Matrix JS SDK.\n *\n * @param {Uint8Array} sasBytes - The bytes from sas.generate_bytes.\n * @returns Array<number>\n */\nfunction generateDecimalSas(sasBytes: Uint8Array): number[] {\n    /**\n     *      +--------+--------+--------+--------+--------+\n     *      | Byte 0 | Byte 1 | Byte 2 | Byte 3 | Byte 4 |\n     *      +--------+--------+--------+--------+--------+\n     * bits: 87654321 87654321 87654321 87654321 87654321\n     *       \\____________/\\_____________/\\____________/\n     *         1st number    2nd number     3rd number\n     */\n    return [\n        (sasBytes[0] << 5 | sasBytes[1] >> 3) + 1000,\n        ((sasBytes[1] & 0x7) << 10 | sasBytes[2] << 2 | sasBytes[3] >> 6) + 1000,\n        ((sasBytes[3] & 0x3f) << 7 | sasBytes[4] >> 1) + 1000\n    ];\n}\n\nconst emojiMapping: [string, string][] = [\n    [ '', 'dog' ],\n    [ '', 'cat' ],\n    [ '', 'lion' ],\n    [ '', 'horse' ],\n    [ '', 'unicorn' ],\n    [ '', 'pig' ],\n    [ '', 'elephant' ],\n    [ '', 'rabbit' ],\n    [ '', 'panda' ],\n    [ '', 'rooster' ],\n    [ '', 'penguin' ],\n    [ '', 'turtle' ],\n    [ '', 'fish' ],\n    [ '', 'octopus' ],\n    [ '', 'butterfly' ],\n    [ '', 'flower' ],\n    [ '', 'tree' ],\n    [ '', 'cactus' ],\n    [ '', 'mushroom' ],\n    [ '', 'globe' ],\n    [ '', 'moon' ],\n    [ '', 'cloud' ],\n    [ '', 'fire' ],\n    [ '', 'banana' ],\n    [ '', 'apple' ],\n    [ '', 'strawberry' ],\n    [ '', 'corn' ],\n    [ '', 'pizza' ],\n    [ '', 'cake' ],\n    [ '', 'heart' ],\n    [ '', 'smiley' ],\n    [ '', 'robot' ],\n    [ '', 'hat' ],\n    [ '', 'glasses' ],\n    [ '', 'spanner' ],\n    [ '', 'santa' ],\n    [ '', 'thumbs up' ],\n    [ '', 'umbrella' ],\n    [ '', 'hourglass' ],\n    [ '', 'clock' ],\n    [ '', 'gift' ],\n    [ '', 'light bulb' ],\n    [ '', 'book' ],\n    [ '', 'pencil' ],\n    [ '', 'paperclip' ],\n    [ '', 'scissors' ],\n    [ '', 'lock' ],\n    [ '', 'key' ],\n    [ '', 'hammer' ],\n    [ '', 'telephone' ],\n    [ '', 'flag' ],\n    [ '', 'train' ],\n    [ '', 'bicycle' ],\n    [ '', 'aeroplane' ],\n    [ '', 'rocket' ],\n    [ '', 'trophy' ],\n    [ '', 'ball' ],\n    [ '', 'guitar' ],\n    [ '', 'trumpet' ],\n    [ '', 'bell' ],\n    [ '', 'anchor' ],\n    [ '', 'headphones' ],\n    [ '', 'folder' ],\n    [ '', 'pin' ]\n];\n\n/**\n * Generates a SAS composed of defimal numbers.\n * Borrowed from the Matrix JS SDK.\n *\n * @param {Uint8Array} sasBytes - The bytes from sas.generate_bytes.\n * @returns Array<number>\n */\nfunction generateEmojiSas(sasBytes: Uint8Array): [string, string][] {\n    // Just like base64.\n    const emojis = [\n        sasBytes[0] >> 2,\n        (sasBytes[0] & 0x3) << 4 | sasBytes[1] >> 4,\n        (sasBytes[1] & 0xf) << 2 | sasBytes[2] >> 6,\n        sasBytes[2] & 0x3f,\n        sasBytes[3] >> 2,\n        (sasBytes[3] & 0x3) << 4 | sasBytes[4] >> 4,\n        (sasBytes[4] & 0xf) << 2 | sasBytes[5] >> 6\n    ];\n\n    return emojis.map(num => emojiMapping[num]);\n}\n\nconst sasGenerators: { [key: string]: (sasBytes: Uint8Array) => number[] | [string, string][]; } = {\n    decimal: generateDecimalSas,\n    emoji: generateEmojiSas\n};\n\nexport interface ISas {\n    [key: string]: number[] | [string, string][];\n}\n\n/**\n * Generates multiple SAS for the given bytes.\n *\n * @param {Uint8Array} sasBytes - The bytes from sas.generate_bytes.\n * @returns {ISas}\n */\nexport function generateSas(sasBytes: Uint8Array): ISas {\n    const sas: ISas = {};\n\n    Object.keys(sasGenerators).forEach(method => {\n        sas[method] = sasGenerators[method](sasBytes);\n    });\n\n    return sas;\n}\n","/* global Olm */\n\nimport { safeJsonParse as _safeJsonParse } from '@jitsi/js-utils/json';\nimport { getLogger } from '@jitsi/logger';\nimport base64js from 'base64-js';\nimport { isEqual } from 'lodash-es';\nimport { v4 as uuidv4 } from 'uuid';\n\nimport { JitsiConferenceEvents } from '../../JitsiConferenceEvents';\nimport Deferred from '../util/Deferred';\nimport Listenable from '../util/Listenable';\nimport { FEATURE_E2EE, JITSI_MEET_MUC_TYPE } from '../xmpp/xmpp';\n\nimport { E2EEErrors } from './E2EEErrors';\nimport { generateSas } from './SAS';\n\nconst logger = getLogger('e2ee:OlmAdapter');\n\nconst REQ_TIMEOUT = 5 * 1000;\nconst OLM_MESSAGE_TYPE = 'olm';\nconst OLM_MESSAGE_TYPES = {\n    ERROR: 'error',\n    KEY_INFO: 'key-info',\n    KEY_INFO_ACK: 'key-info-ack',\n    SAS_ACCEPT: 'sas-accept',\n    SAS_KEY: 'sas-key',\n    SAS_MAC: 'sas-mac',\n    SAS_START: 'sas-start',\n    SESSION_ACK: 'session-ack',\n    SESSION_INIT: 'session-init'\n};\n\nconst OLM_SAS_NUM_BYTES = 6;\nconst OLM_KEY_VERIFICATION_MAC_INFO = 'Jitsi-KEY_VERIFICATION_MAC';\nconst OLM_KEY_VERIFICATION_MAC_KEY_IDS = 'Jitsi-KEY_IDS';\n\nconst kOlmData = Symbol('OlmData');\n\nconst OlmAdapterEvents = {\n    PARTICIPANT_E2EE_CHANNEL_READY: 'olm.participant_e2ee_channel_ready',\n    PARTICIPANT_KEY_UPDATED: 'olm.partitipant_key_updated',\n    PARTICIPANT_SAS_AVAILABLE: 'olm.participant_sas_available',\n    PARTICIPANT_SAS_READY: 'olm.participant_sas_ready',\n    PARTICIPANT_VERIFICATION_COMPLETED: 'olm.participant_verification_completed'\n};\n\n/**\n * This class implements an End-to-End Encrypted communication channel between every two peers\n * in the conference. This channel uses libolm to achieve E2EE.\n *\n * The created channel is then used to exchange the secret key that each participant will use\n * to encrypt the actual media (see {@link E2EEContext}).\n *\n * A simple JSON message based protocol is implemented, which follows a request - response model:\n * - session-init: Initiates an olm session establishment procedure. This message will be sent\n *                 by the participant who just joined, to everyone else.\n * - session-ack: Completes the olm session etablishment. This messsage may contain ancilliary\n *                encrypted data, more specifically the sender's current key.\n * - key-info: Includes the sender's most up to date key information.\n * - key-info-ack: Acknowledges the reception of a key-info request. In addition, it may contain\n *                 the sender's key information, if available.\n * - error: Indicates a request processing error has occurred.\n *\n * These requessts and responses are transport independent. Currently they are sent using XMPP\n * MUC private messages.\n */\nexport class OlmAdapter extends Listenable {\n    /**\n     * Creates an adapter instance for the given conference.\n     */\n    constructor(conference) {\n        super();\n\n        this._conf = conference;\n        this._init = new Deferred();\n        this._mediaKey = undefined;\n        this._mediaKeyIndex = -1;\n        this._reqs = new Map();\n        this._sessionInitialization = undefined;\n        this._sessionReadyCallbacks = new Map(); // participantId -> callback\n\n        if (OlmAdapter.isSupported()) {\n            this._bootstrapOlm();\n\n            this._conf.on(JitsiConferenceEvents.ENDPOINT_MESSAGE_RECEIVED, this._onEndpointMessageReceived.bind(this));\n            this._conf.on(JitsiConferenceEvents.CONFERENCE_LEFT, this._onConferenceLeft.bind(this));\n            this._conf.on(JitsiConferenceEvents.USER_LEFT, this._onParticipantLeft.bind(this));\n            this._conf.on(JitsiConferenceEvents.PARTICIPANT_PROPERTY_CHANGED,\n                this._onParticipantPropertyChanged.bind(this));\n        } else {\n            this._init.reject(new Error('Olm not supported'));\n        }\n    }\n\n    /**\n     * Returns the current participants conference ID.\n     *\n     * @returns {string}\n     */\n    get myId() {\n        return this._conf.myUserId();\n    }\n\n    /**\n     * Starts new olm sessions with every other participant and waits for all sessions to be established.\n     * This includes both outgoing sessions (initiated by us to participants with higher IDs) and\n     * incoming sessions (initiated by participants with lower IDs).\n     */\n    async initSessions() {\n        if (this._sessionInitialization) {\n            throw new Error('OlmAdapter initSessions called multiple times');\n        }\n\n        this._sessionInitialization = new Deferred();\n\n        await this._init;\n\n        const localParticipantId = this._conf.myUserId();\n        const e2eeParticipants = this._conf.getParticipants().filter(p => p.hasFeature(FEATURE_E2EE));\n        const outgoingParticipants = e2eeParticipants.filter(p => localParticipantId < p.getId());\n\n        // Send session-init to participants with higher IDs (outgoing sessions)\n        const outgoingPromises = outgoingParticipants.map(participant =>\n            this._sendSessionInit(participant)\n        );\n\n        await Promise.allSettled(outgoingPromises);\n\n        // TODO: retry failed ones.\n\n        const waitPromises = [];\n\n        for (const participant of e2eeParticipants) {\n            const pId = participant.getId();\n            const olmData = this._getParticipantOlmData(participant);\n\n            if (olmData.session) {\n                // Session already established\n                continue;\n            }\n\n            logger.debug(`Waiting for session with participant ${pId}`);\n            const sessionPromise = new Promise(resolve => {\n                this._sessionReadyCallbacks.set(pId, resolve);\n            });\n\n            waitPromises.push(sessionPromise);\n        }\n\n        if (waitPromises.length > 0) {\n            logger.debug(`Waiting for ${waitPromises.length} sessions to be established`);\n\n            await Promise.race([\n                Promise.allSettled(waitPromises),\n                new Promise(resolve => setTimeout(resolve, 10000)) // 10s timeout\n            ]);\n            this._sessionReadyCallbacks.clear();\n        }\n\n        logger.debug('All Olm sessions established (outgoing and incoming)');\n        this._sessionInitialization.resolve();\n        this._sessionInitialization = undefined;\n    }\n\n    /**\n     * Indicates if olm is supported on the current platform.\n     *\n     * @returns {boolean}\n     */\n    static isSupported() {\n        return typeof window.Olm !== 'undefined';\n    }\n\n    /**\n     * Updates the current participant key and distributes it to all participants in the conference\n     * by sending a key-info message.\n     *\n     * @param {Uint8Array|boolean} key - The new key.\n     * @retrns {Promise<Number>}\n     */\n    async updateKey(key) {\n        // Store it locally for new sessions.\n        this._mediaKey = key;\n        this._mediaKeyIndex++;\n\n        // Broadcast it.\n        const promises = [];\n\n        for (const participant of this._conf.getParticipants()) {\n            const pId = participant.getId();\n            const olmData = this._getParticipantOlmData(participant);\n\n            // TODO: skip those who don't support E2EE.\n            if (!olmData.session) {\n                logger.warn(`Tried to send key to participant ${pId} but we have no session`);\n\n                // eslint-disable-next-line no-continue\n                continue;\n            }\n\n            const uuid = uuidv4();\n            const data = {\n                [JITSI_MEET_MUC_TYPE]: OLM_MESSAGE_TYPE,\n                olm: {\n                    data: {\n                        ciphertext: this._encryptKeyInfo(olmData.session),\n                        uuid\n                    },\n                    type: OLM_MESSAGE_TYPES.KEY_INFO\n                }\n            };\n            const d = new Deferred();\n\n            d.setRejectTimeout(REQ_TIMEOUT);\n            d.catch(() => {\n                this._reqs.delete(uuid);\n            });\n            this._reqs.set(uuid, d);\n            promises.push(d);\n\n            this._sendMessage(data, pId);\n        }\n\n        await Promise.allSettled(promises);\n\n        // TODO: retry failed ones?\n\n        return this._mediaKeyIndex;\n    }\n\n    /**\n     * Updates the current participant key.\n     * @param {Uint8Array|boolean} key - The new key.\n     * @returns {number}\n    */\n    updateCurrentMediaKey(key) {\n        this._mediaKey = key;\n\n        return this._mediaKeyIndex;\n    }\n\n    /**\n     * Frees the olmData session for the given participant and clears all session-related state.\n     *\n     */\n    clearParticipantSession(participant) {\n        const olmData = this._getParticipantOlmData(participant);\n\n        if (olmData.session) {\n            olmData.session.free();\n            olmData.session = undefined;\n        }\n\n        // Clear all session-related state to allow clean re-initialization\n        olmData.pendingSessionUuid = undefined;\n        olmData.lastKey = undefined;\n\n        // Clean up SAS verification if active\n        if (olmData.sasVerification?.sas) {\n            olmData.sasVerification.sas.free();\n        }\n        olmData.sasVerification = undefined;\n    }\n\n    /**\n     * Frees the olmData sessions for all participants.\n     *\n     */\n    clearAllParticipantsSessions() {\n        for (const participant of this._conf.getParticipants()) {\n            this.clearParticipantSession(participant);\n        }\n        this._reqs.clear();\n        this._sessionInitialization = undefined;\n    }\n\n    /**\n     * Sends sacMac if channel verification waas successful.\n     *\n     */\n    markParticipantVerified(participant, isVerified) {\n        const olmData = this._getParticipantOlmData(participant);\n\n        const pId = participant.getId();\n\n        if (!isVerified) {\n            olmData.sasVerification = undefined;\n            logger.warn(`Verification failed for participant ${pId}`);\n            this.eventEmitter.emit(\n                OlmAdapterEvents.PARTICIPANT_VERIFICATION_COMPLETED,\n                pId,\n                false,\n                E2EEErrors.E2EE_SAS_CHANNEL_VERIFICATION_FAILED);\n\n            return;\n        }\n\n        if (!olmData.sasVerification) {\n            logger.warn(`Participant ${pId} does not have valid sasVerification`);\n            this.eventEmitter.emit(\n                OlmAdapterEvents.PARTICIPANT_VERIFICATION_COMPLETED,\n                pId,\n                false,\n                E2EEErrors.E2EE_SAS_INVALID_SAS_VERIFICATION);\n\n            return;\n        }\n\n        const { sas, sasMacSent } = olmData.sasVerification;\n\n        if (sas && sas.is_their_key_set() && !sasMacSent) {\n            this._sendSasMac(participant);\n\n            // Mark the MAC as sent so we don't send it multiple times.\n            olmData.sasVerification.sasMacSent = true;\n        }\n    }\n\n    /**\n     * Internal helper to bootstrap the olm library.\n     *\n     * @returns {Promise<void>}\n     * @private\n     */\n    async _bootstrapOlm() {\n        logger.debug('Initializing Olm...');\n\n        try {\n            await Olm.init();\n\n            this._olmAccount = new Olm.Account();\n            this._olmAccount.create();\n\n            this._idKeys = _safeJsonParse(this._olmAccount.identity_keys());\n\n            logger.debug(`Olm ${Olm.get_library_version().join('.')} initialized`);\n            this._init.resolve();\n            this._onIdKeysReady(this._idKeys);\n        } catch (e) {\n            logger.error('Failed to initialize Olm', e);\n            this._init.reject(e);\n        }\n    }\n\n    /**\n     * Starts the verification process for the given participant as described here\n     * https://spec.matrix.org/latest/client-server-api/#short-authentication-string-sas-verification\n     *\n     *    |                                 |\n          | m.key.verification.start        |\n          |-------------------------------->|\n          |                                 |\n          |       m.key.verification.accept |\n          |<--------------------------------|\n          |                                 |\n          | m.key.verification.key          |\n          |-------------------------------->|\n          |                                 |\n          |          m.key.verification.key |\n          |<--------------------------------|\n          |                                 |\n          | m.key.verification.mac          |\n          |-------------------------------->|\n          |                                 |\n          |          m.key.verification.mac |\n          |<--------------------------------|\n          |                                 |\n     *\n     * @param {JitsiParticipant} participant - The target participant.\n     * @returns {Promise<void>}\n     * @private\n     */\n    startVerification(participant) {\n        const pId = participant.getId();\n        const olmData = this._getParticipantOlmData(participant);\n\n        if (!olmData.session) {\n            logger.warn(`Tried to start verification with participant ${pId} but we have no session`);\n\n            return;\n        }\n\n        if (olmData.sasVerification) {\n            logger.warn(`There is already a verification in progress with participant ${pId}`);\n\n            return;\n        }\n\n        olmData.sasVerification = {\n            sas: new Olm.SAS(),\n            transactionId: uuidv4()\n        };\n\n        const startContent = {\n            transactionId: olmData.sasVerification.transactionId\n        };\n\n        olmData.sasVerification.startContent = startContent;\n        olmData.sasVerification.isInitiator = true;\n\n        const startMessage = {\n            [JITSI_MEET_MUC_TYPE]: OLM_MESSAGE_TYPE,\n            olm: {\n                data: startContent,\n                type: OLM_MESSAGE_TYPES.SAS_START\n            }\n        };\n\n        this._sendMessage(startMessage, pId);\n    }\n\n    /**\n     * Publishes our own Olmn id key in presence.\n     * @private\n     */\n    _onIdKeysReady(idKeys) {\n        logger.debug(`Olm id key ready: ${idKeys}`);\n\n        // Publish it in presence.\n        for (const keyType in idKeys) {\n            if (idKeys.hasOwnProperty(keyType)) {\n                const key = idKeys[keyType];\n\n                this._conf.setLocalParticipantProperty(`e2ee.idKey.${keyType}`, key);\n            }\n        }\n    }\n\n    /**\n     * Event posted when the E2EE signalling channel has been established with the given participant.\n     * @private\n     */\n    _onParticipantE2EEChannelReady(id) {\n        logger.debug(`E2EE channel with participant ${id} is ready`);\n\n        // Notify any waiting promises that this session is ready\n        const callback = this._sessionReadyCallbacks.get(id);\n\n        if (callback) {\n            callback();\n            this._sessionReadyCallbacks.delete(id);\n        }\n    }\n\n    /**\n     * Internal helper for encrypting the current key information for a given participant.\n     *\n     * @param {Olm.Session} session - Participant's session.\n     * @returns {string} - The encrypted text with the key information.\n     * @private\n     */\n    _encryptKeyInfo(session) {\n        const keyInfo = {};\n\n        if (this._mediaKey !== undefined) {\n            keyInfo.key = this._mediaKey ? base64js.fromByteArray(this._mediaKey) : false;\n            keyInfo.keyIndex = this._mediaKeyIndex;\n        }\n\n        return session.encrypt(JSON.stringify(keyInfo));\n    }\n\n    /**\n     * Internal helper for getting the olm related data associated with a participant.\n     *\n     * @param {JitsiParticipant} participant - Participant whose data wants to be extracted.\n     * @returns {Object}\n     * @private\n     */\n    _getParticipantOlmData(participant) {\n        participant[kOlmData] = participant[kOlmData] || {};\n\n        return participant[kOlmData];\n    }\n\n    /**\n     * Handles leaving the conference, cleaning up olm sessions.\n     *\n     * @private\n     */\n    async _onConferenceLeft() {\n        logger.debug('Conference left');\n\n        await this._init;\n\n        for (const participant of this._conf.getParticipants()) {\n            this._onParticipantLeft(participant.getId(), participant);\n        }\n\n        if (this._olmAccount) {\n            this._olmAccount.free();\n            this._olmAccount = undefined;\n        }\n    }\n\n    /**\n     * Main message handler. Handles 1-to-1 messages received from other participants\n     * and send the appropriate replies.\n     *\n     * @private\n     */\n    async _onEndpointMessageReceived(participant, payload) {\n        if (payload[JITSI_MEET_MUC_TYPE] !== OLM_MESSAGE_TYPE) {\n            return;\n        }\n\n        if (!payload.olm) {\n            logger.warn('Incorrectly formatted message');\n\n            return;\n        }\n\n        await this._init;\n\n        const msg = payload.olm;\n        const pId = participant.getId();\n        const olmData = this._getParticipantOlmData(participant);\n\n        switch (msg.type) {\n        case OLM_MESSAGE_TYPES.SESSION_INIT: {\n            if (olmData.session) {\n                logger.warn(`Participant ${pId} already has a session`);\n\n                this._sendError(participant, 'Session already established');\n            } else {\n                // Create a session for communicating with this participant.\n\n                const session = new Olm.Session();\n\n                session.create_outbound(this._olmAccount, msg.data.idKey, msg.data.otKey);\n                olmData.session = session;\n\n                // Send ACK\n                const ack = {\n                    [JITSI_MEET_MUC_TYPE]: OLM_MESSAGE_TYPE,\n                    olm: {\n                        data: {\n                            ciphertext: this._encryptKeyInfo(session),\n                            uuid: msg.data.uuid\n                        },\n                        type: OLM_MESSAGE_TYPES.SESSION_ACK\n\n                    }\n                };\n\n                this._sendMessage(ack, pId);\n                this._onParticipantE2EEChannelReady(pId);\n            }\n            break;\n        }\n        case OLM_MESSAGE_TYPES.SESSION_ACK: {\n            if (olmData.session) {\n                logger.warn(`Participant ${pId} already has a session`);\n\n                this._sendError(participant, 'No session found');\n            } else if (msg.data.uuid === olmData.pendingSessionUuid) {\n                const { ciphertext } = msg.data;\n                const d = this._reqs.get(msg.data.uuid);\n                const session = new Olm.Session();\n\n                session.create_inbound(this._olmAccount, ciphertext.body);\n\n                // Remove OT keys that have been used to setup this session.\n                this._olmAccount.remove_one_time_keys(session);\n\n                // Decrypt first message.\n                const data = session.decrypt(ciphertext.type, ciphertext.body);\n\n                olmData.session = session;\n                olmData.pendingSessionUuid = undefined;\n\n                this._onParticipantE2EEChannelReady(pId);\n\n                this._reqs.delete(msg.data.uuid);\n                d.resolve();\n\n                const json = safeJsonParse(data);\n\n                if (json.key) {\n                    const key = base64js.toByteArray(json.key);\n                    const keyIndex = json.keyIndex;\n\n                    olmData.lastKey = key;\n                    this.eventEmitter.emit(OlmAdapterEvents.PARTICIPANT_KEY_UPDATED, pId, key, keyIndex);\n                }\n            } else {\n                logger.warn('Received ACK with the wrong UUID');\n\n                this._sendError(participant, 'Invalid UUID');\n            }\n            break;\n        }\n        case OLM_MESSAGE_TYPES.ERROR: {\n            logger.error(msg.data.error);\n\n            break;\n        }\n        case OLM_MESSAGE_TYPES.KEY_INFO: {\n            if (olmData.session) {\n                const { ciphertext } = msg.data;\n                const data = olmData.session.decrypt(ciphertext.type, ciphertext.body);\n                const json = safeJsonParse(data);\n\n                if (json.key !== undefined && json.keyIndex !== undefined) {\n                    const key = json.key ? base64js.toByteArray(json.key) : false;\n                    const keyIndex = json.keyIndex;\n\n                    if (!isEqual(olmData.lastKey, key)) {\n                        olmData.lastKey = key;\n                        this.eventEmitter.emit(OlmAdapterEvents.PARTICIPANT_KEY_UPDATED, pId, key, keyIndex);\n                    }\n\n                    // Send ACK.\n                    const ack = {\n                        [JITSI_MEET_MUC_TYPE]: OLM_MESSAGE_TYPE,\n                        olm: {\n                            data: {\n                                ciphertext: this._encryptKeyInfo(olmData.session),\n                                uuid: msg.data.uuid\n                            },\n                            type: OLM_MESSAGE_TYPES.KEY_INFO_ACK\n                        }\n                    };\n\n                    this._sendMessage(ack, pId);\n                }\n            } else {\n                logger.debug(`Received key info message from ${pId} but we have no session for them!`);\n\n                this._sendError(participant, 'No session found while processing key-info');\n            }\n            break;\n        }\n        case OLM_MESSAGE_TYPES.KEY_INFO_ACK: {\n            if (olmData.session) {\n                const { ciphertext } = msg.data;\n                const data = olmData.session.decrypt(ciphertext.type, ciphertext.body);\n                const json = safeJsonParse(data);\n\n                if (json.key !== undefined && json.keyIndex !== undefined) {\n                    const key = json.key ? base64js.toByteArray(json.key) : false;\n                    const keyIndex = json.keyIndex;\n\n                    if (!isEqual(olmData.lastKey, key)) {\n                        olmData.lastKey = key;\n                        this.eventEmitter.emit(OlmAdapterEvents.PARTICIPANT_KEY_UPDATED, pId, key, keyIndex);\n                    }\n                }\n\n                const d = this._reqs.get(msg.data.uuid);\n\n                this._reqs.delete(msg.data.uuid);\n                d.resolve();\n            } else {\n                logger.debug(`Received key info ack message from ${pId} but we have no session for them!`);\n\n                this._sendError(participant, 'No session found while processing key-info-ack');\n            }\n            break;\n        }\n        case OLM_MESSAGE_TYPES.SAS_START: {\n            if (!olmData.session) {\n                logger.debug(`Received sas init message from ${pId} but we have no session for them!`);\n\n                this._sendError(participant, 'No session found while processing sas-init');\n\n                return;\n            }\n\n            if (olmData.sasVerification?.sas) {\n                logger.warn(`SAS already created for participant ${pId}`);\n                this.eventEmitter.emit(\n                    OlmAdapterEvents.PARTICIPANT_VERIFICATION_COMPLETED,\n                    pId,\n                    false,\n                    E2EEErrors.E2EE_SAS_INVALID_SAS_VERIFICATION);\n\n                return;\n            }\n\n            const { transactionId } = msg.data;\n\n            const sas = new Olm.SAS();\n\n            olmData.sasVerification = {\n                isInitiator: false,\n                sas,\n                transactionId\n            };\n\n            const pubKey = olmData.sasVerification.sas.get_pubkey();\n            const commitment = this._computeCommitment(pubKey, msg.data);\n\n            /* The first phase of the verification process, the Key agreement phase\n                https://spec.matrix.org/latest/client-server-api/#short-authentication-string-sas-verification\n            */\n            const acceptMessage = {\n                [JITSI_MEET_MUC_TYPE]: OLM_MESSAGE_TYPE,\n                olm: {\n                    data: {\n                        commitment,\n                        transactionId\n                    },\n                    type: OLM_MESSAGE_TYPES.SAS_ACCEPT\n\n                }\n            };\n\n            this._sendMessage(acceptMessage, pId);\n            break;\n        }\n        case OLM_MESSAGE_TYPES.SAS_ACCEPT: {\n            if (!olmData.session) {\n                logger.debug(`Received sas accept message from ${pId} but we have no session for them!`);\n\n                this._sendError(participant, 'No session found while processing sas-accept');\n\n                return;\n            }\n\n            const { commitment, transactionId } = msg.data;\n\n\n            if (!olmData.sasVerification) {\n                logger.warn(`SAS_ACCEPT Participant ${pId} does not have valid sasVerification`);\n                this.eventEmitter.emit(\n                    OlmAdapterEvents.PARTICIPANT_VERIFICATION_COMPLETED,\n                    pId,\n                    false,\n                    E2EEErrors.E2EE_SAS_INVALID_SAS_VERIFICATION);\n\n                return;\n            }\n\n            if (olmData.sasVerification.sasCommitment) {\n                logger.debug(`Already received sas commitment message from ${pId}!`);\n\n                this._sendError(participant, 'Already received sas commitment message from ${pId}!');\n\n                return;\n            }\n\n            olmData.sasVerification.sasCommitment = commitment;\n\n            const pubKey = olmData.sasVerification.sas.get_pubkey();\n\n            // Send KEY.\n            const keyMessage = {\n                [JITSI_MEET_MUC_TYPE]: OLM_MESSAGE_TYPE,\n                olm: {\n                    data: {\n                        key: pubKey,\n                        transactionId\n                    },\n                    type: OLM_MESSAGE_TYPES.SAS_KEY\n                }\n            };\n\n            this._sendMessage(keyMessage, pId);\n\n            olmData.sasVerification.keySent = true;\n            break;\n        }\n        case OLM_MESSAGE_TYPES.SAS_KEY: {\n            if (!olmData.session) {\n                logger.debug(`Received sas key message from ${pId} but we have no session for them!`);\n\n                this._sendError(participant, 'No session found while processing sas-key');\n\n                return;\n            }\n\n            if (!olmData.sasVerification) {\n                logger.warn(`SAS_KEY Participant ${pId} does not have valid sasVerification`);\n                this.eventEmitter.emit(\n                    OlmAdapterEvents.PARTICIPANT_VERIFICATION_COMPLETED,\n                    pId,\n                    false,\n                    E2EEErrors.E2EE_SAS_INVALID_SAS_VERIFICATION);\n\n                return;\n            }\n\n            const { isInitiator, sas, sasCommitment, startContent, keySent } = olmData.sasVerification;\n\n            if (sas.is_their_key_set()) {\n                logger.warn('SAS already has their key!');\n\n                return;\n            }\n\n            const { key: theirKey, transactionId } = msg.data;\n\n            if (sasCommitment) {\n                const commitment = this._computeCommitment(theirKey, startContent);\n\n                if (sasCommitment !== commitment) {\n                    this._sendError(participant, 'OlmAdapter commitments mismatched');\n                    this.eventEmitter.emit(\n                        OlmAdapterEvents.PARTICIPANT_VERIFICATION_COMPLETED,\n                        pId,\n                        false,\n                        E2EEErrors.E2EE_SAS_COMMITMENT_MISMATCHED);\n                    olmData.sasVerification.free();\n\n                    return;\n                }\n            }\n\n            sas.set_their_key(theirKey);\n\n            const pubKey = sas.get_pubkey();\n\n            const myInfo = `${this.myId}|${pubKey}`;\n            const theirInfo = `${pId}|${theirKey}`;\n\n            const info = isInitiator ? `${myInfo}|${theirInfo}` : `${theirInfo}|${myInfo}`;\n\n            const sasBytes = sas.generate_bytes(info, OLM_SAS_NUM_BYTES);\n            const generatedSas = generateSas(sasBytes);\n\n            this.eventEmitter.emit(OlmAdapterEvents.PARTICIPANT_SAS_READY, pId, generatedSas);\n\n            if (keySent) {\n                return;\n            }\n\n            const keyMessage = {\n                [JITSI_MEET_MUC_TYPE]: OLM_MESSAGE_TYPE,\n                olm: {\n                    data: {\n                        key: pubKey,\n                        transactionId\n                    },\n                    type: OLM_MESSAGE_TYPES.SAS_KEY\n                }\n            };\n\n            this._sendMessage(keyMessage, pId);\n\n            olmData.sasVerification.keySent = true;\n            break;\n        }\n        case OLM_MESSAGE_TYPES.SAS_MAC: {\n            if (!olmData.session) {\n                logger.debug(`Received sas mac message from ${pId} but we have no session for them!`);\n\n                this._sendError(participant, 'No session found while processing sas-mac');\n\n                return;\n            }\n\n            const { keys, mac, transactionId } = msg.data;\n\n            if (!mac || !keys) {\n                logger.warn('Invalid SAS MAC message');\n\n                return;\n            }\n\n            if (!olmData.sasVerification) {\n                logger.warn(`SAS_MAC Participant ${pId} does not have valid sasVerification`);\n\n                return;\n            }\n\n            const sas = olmData.sasVerification.sas;\n\n            // Verify the received MACs.\n            const baseInfo = `${OLM_KEY_VERIFICATION_MAC_INFO}${pId}${this.myId}${transactionId}`;\n            const keysMac = sas.calculate_mac(\n                Object.keys(mac).sort().join(','), // eslint-disable-line newline-per-chained-call\n                baseInfo + OLM_KEY_VERIFICATION_MAC_KEY_IDS\n            );\n\n            if (keysMac !== keys) {\n                logger.error('SAS verification error: keys MAC mismatch');\n                this.eventEmitter.emit(\n                    OlmAdapterEvents.PARTICIPANT_VERIFICATION_COMPLETED,\n                    pId,\n                    false,\n                    E2EEErrors.E2EE_SAS_KEYS_MAC_MISMATCH);\n\n                return;\n            }\n\n            if (!olmData.ed25519) {\n                logger.warn('SAS verification error: Missing ed25519 key');\n\n                this.eventEmitter.emit(\n                    OlmAdapterEvents.PARTICIPANT_VERIFICATION_COMPLETED,\n                    pId,\n                    false,\n                    E2EEErrors.E2EE_SAS_MISSING_KEY);\n\n                return;\n            }\n\n            for (const [ keyInfo, computedMac ] of Object.entries(mac)) {\n                const ourComputedMac = sas.calculate_mac(\n                    olmData.ed25519,\n                    baseInfo + keyInfo\n                );\n\n                if (computedMac !== ourComputedMac) {\n                    logger.error('SAS verification error: MAC mismatch');\n                    this.eventEmitter.emit(\n                        OlmAdapterEvents.PARTICIPANT_VERIFICATION_COMPLETED,\n                        pId,\n                        false,\n                        E2EEErrors.E2EE_SAS_MAC_MISMATCH);\n\n                    return;\n                }\n            }\n\n            logger.info(`SAS MAC verified for participant ${pId}`);\n            this.eventEmitter.emit(OlmAdapterEvents.PARTICIPANT_VERIFICATION_COMPLETED, pId, true);\n\n            break;\n        }\n        }\n    }\n\n    /**\n     * Handles a participant leaving. When a participant leaves their olm session is destroyed.\n     *\n     * @private\n     */\n    _onParticipantLeft(id, participant) {\n        logger.debug(`Participant ${id} left`);\n\n        this.clearParticipantSession(participant);\n    }\n\n    /**\n    * Handles an update in a participant's presence property.\n    *\n    * @param {JitsiParticipant} participant - The participant.\n    * @param {string} name - The name of the property that changed.\n    * @param {*} oldValue - The property's previous value.\n    * @param {*} newValue - The property's new value.\n    * @private\n    */\n    async _onParticipantPropertyChanged(participant, name, oldValue, newValue) {\n        const participantId = participant.getId();\n        const olmData = this._getParticipantOlmData(participant);\n\n        switch (name) {\n        case 'e2ee.enabled':\n            if (newValue && this._conf.isE2EEEnabled()) {\n                const localParticipantId = this._conf.myUserId();\n                const participantFeatures = await participant.getFeatures();\n\n                if (participantFeatures.has(FEATURE_E2EE) && localParticipantId < participantId) {\n                    let sessionEstablished = false;\n\n                    try {\n                        // eslint-disable-next-line max-depth\n                        if (this._sessionInitialization) {\n                            await this._sessionInitialization;\n                        }\n                        await this._sendSessionInit(participant);\n                        sessionEstablished = true;\n                    } catch (error) {\n                        // Handle specific error cases\n                        // eslint-disable-next-line max-depth\n                        if (error.message === E2EEErrors.E2EE_OLM_SESSION_ALREADY_EXISTS) {\n                            sessionEstablished = true;\n                        } else if (error.message !== E2EEErrors.E2EE_OLM_SESSION_INIT_PENDING) {\n                            logger.error(`Failed to establish Olm session with ${participantId}:`, error);\n                        }\n                    }\n\n                    // Only proceed with KEY_INFO if session is ready\n                    if (!sessionEstablished) {\n                        return;\n                    }\n\n                    const uuid = uuidv4();\n\n                    const d = new Deferred();\n\n                    d.setRejectTimeout(REQ_TIMEOUT);\n                    d.catch(() => {\n                        this._reqs.delete(uuid);\n                        olmData.pendingSessionUuid = undefined;\n                    });\n                    this._reqs.set(uuid, d);\n\n                    const data = {\n                        [JITSI_MEET_MUC_TYPE]: OLM_MESSAGE_TYPE,\n                        olm: {\n                            data: {\n                                ciphertext: this._encryptKeyInfo(olmData.session),\n                                uuid\n                            },\n                            type: OLM_MESSAGE_TYPES.KEY_INFO\n                        }\n                    };\n\n                    this._sendMessage(data, participantId);\n                }\n            }\n            break;\n        case 'e2ee.idKey.ed25519':\n            olmData.ed25519 = newValue;\n            this.eventEmitter.emit(OlmAdapterEvents.PARTICIPANT_SAS_AVAILABLE, participantId);\n            break;\n        }\n    }\n\n    /**\n     * Builds and sends an error message to the target participant.\n     *\n     * @param {JitsiParticipant} participant - The target participant.\n     * @param {string} error - The error message.\n     * @returns {void}\n     */\n    _sendError(participant, error) {\n        const pId = participant.getId();\n        const err = {\n            [JITSI_MEET_MUC_TYPE]: OLM_MESSAGE_TYPE,\n            olm: {\n                data: {\n                    error\n                },\n                type: OLM_MESSAGE_TYPES.ERROR\n            }\n        };\n\n        this._sendMessage(err, pId);\n    }\n\n    /**\n     * Internal helper to send the given object to the given participant ID.\n     * This function merely exists so the transport can be easily swapped.\n     * Currently messages are transmitted via XMPP MUC private messages.\n     *\n     * @param {object} data - The data that will be sent to the target participant.\n     * @param {string} participantId - ID of the target participant.\n     */\n    _sendMessage(data, participantId) {\n        this._conf.sendMessage(data, participantId);\n    }\n\n    /**\n     * Builds and sends the session-init request to the target participant.\n     *\n     * @param {JitsiParticipant} participant - Participant to whom we'll send the request.\n     * @returns {Promise} - The promise will be resolved when the session-ack is received.\n     * @private\n     */\n    _sendSessionInit(participant) {\n        const pId = participant.getId();\n        const olmData = this._getParticipantOlmData(participant);\n\n        if (olmData.session) {\n            logger.warn(`Tried to send session-init to ${pId} but we already have a session`);\n\n            return Promise.reject(new Error(E2EEErrors.E2EE_OLM_SESSION_ALREADY_EXISTS));\n        }\n\n        if (olmData.pendingSessionUuid !== undefined) {\n            logger.warn(`Tried to send session-init to ${pId} but we already have a pending session`);\n\n            return Promise.reject(new Error(E2EEErrors.E2EE_OLM_SESSION_INIT_PENDING));\n        }\n\n        // Generate a One Time Key.\n        this._olmAccount.generate_one_time_keys(1);\n\n        const otKeys = _safeJsonParse(this._olmAccount.one_time_keys());\n        const otKey = Object.values(otKeys.curve25519)[0];\n\n        if (!otKey) {\n            return Promise.reject(new Error(E2EEErrors.E2EE_OLM_NO_ONE_TIME_KEYS));\n        }\n\n        // Mark the OT keys (one really) as published so they are not reused.\n        this._olmAccount.mark_keys_as_published();\n\n        const uuid = uuidv4();\n        const init = {\n            [JITSI_MEET_MUC_TYPE]: OLM_MESSAGE_TYPE,\n            olm: {\n                data: {\n                    idKey: this._idKeys.curve25519,\n                    otKey,\n                    uuid\n                },\n                type: OLM_MESSAGE_TYPES.SESSION_INIT\n            }\n        };\n\n        const d = new Deferred();\n\n        d.setRejectTimeout(REQ_TIMEOUT);\n        d.catch(() => {\n            this._reqs.delete(uuid);\n            olmData.pendingSessionUuid = undefined;\n        });\n        this._reqs.set(uuid, d);\n\n        this._sendMessage(init, pId);\n\n        // Store the UUID for matching with the ACK.\n        olmData.pendingSessionUuid = uuid;\n\n        return d;\n    }\n\n    /**\n     * Builds and sends the SAS MAC message to the given participant.\n     * The second phase of the verification process, the Key verification phase\n        https://spec.matrix.org/latest/client-server-api/#short-authentication-string-sas-verification\n     */\n    _sendSasMac(participant) {\n        const pId = participant.getId();\n        const olmData = this._getParticipantOlmData(participant);\n        const { sas, transactionId } = olmData.sasVerification;\n\n        // Calculate and send MAC with the keys to be verified.\n        const mac = {};\n        const keyList = [];\n        const baseInfo = `${OLM_KEY_VERIFICATION_MAC_INFO}${this.myId}${pId}${transactionId}`;\n\n        const deviceKeyId = `ed25519:${pId}`;\n\n        mac[deviceKeyId] = sas.calculate_mac(\n            this._idKeys.ed25519,\n            baseInfo + deviceKeyId);\n        keyList.push(deviceKeyId);\n\n        const keys = sas.calculate_mac(\n            keyList.sort().join(','),\n            baseInfo + OLM_KEY_VERIFICATION_MAC_KEY_IDS\n        );\n\n        const macMessage = {\n            [JITSI_MEET_MUC_TYPE]: OLM_MESSAGE_TYPE,\n            olm: {\n                data: {\n                    keys,\n                    mac,\n                    transactionId\n                },\n                type: OLM_MESSAGE_TYPES.SAS_MAC\n            }\n        };\n\n        this._sendMessage(macMessage, pId);\n    }\n\n    /**\n     * Computes the commitment.\n     */\n    _computeCommitment(pubKey, data) {\n        const olmUtil = new Olm.Utility();\n        const commitment = olmUtil.sha256(pubKey + JSON.stringify(data));\n\n        olmUtil.free();\n\n        return commitment;\n    }\n}\n\n/**\n * Helper to ensure JSON parsing always returns an object.\n *\n * @param {string} data - The data that needs to be parsed.\n * @returns {object} - Parsed data or empty object in case of failure.\n */\nfunction safeJsonParse(data) {\n    try {\n        return _safeJsonParse(data);\n    } catch (e) {\n        return {};\n    }\n}\n\nOlmAdapter.events = OlmAdapterEvents;\n","import { getLogger } from '@jitsi/logger';\nimport { debounce } from 'lodash-es';\n\nimport { JitsiConferenceEvents } from '../../JitsiConferenceEvents';\n\nimport { KeyHandler } from './KeyHandler';\nimport { OlmAdapter } from './OlmAdapter';\nimport { importKey, ratchet } from './crypto-utils';\n\nconst logger = getLogger('e2ee:ManagedKeyHandler');\n\n// Period which we'll wait before updating / rotating our keys when a participant\n// joins or leaves.\nconst DEBOUNCE_PERIOD = 5000;\n\n/**\n * This module integrates {@link E2EEContext} with {@link OlmAdapter} in order to distribute the keys for encryption.\n */\nexport class ManagedKeyHandler extends KeyHandler {\n    /**\n     * Build a new AutomaticKeyHandler instance, which will be used in a given conference.\n     */\n    constructor(conference) {\n        super(conference);\n\n        this._key = undefined;\n        this._conferenceJoined = false;\n\n        this._olmAdapter = new OlmAdapter(conference);\n\n        this._rotateKey = debounce(this._rotateKeyImpl, DEBOUNCE_PERIOD);\n        this._ratchetKey = debounce(this._ratchetKeyImpl, DEBOUNCE_PERIOD);\n\n        // Olm signalling events.\n        this._olmAdapter.on(\n            OlmAdapter.events.PARTICIPANT_KEY_UPDATED,\n            this._onParticipantKeyUpdated.bind(this));\n\n        this._olmAdapter.on(\n            OlmAdapter.events.PARTICIPANT_SAS_READY,\n            this._onParticipantSasReady.bind(this));\n\n        this._olmAdapter.on(\n            OlmAdapter.events.PARTICIPANT_SAS_AVAILABLE,\n            this._onParticipantSasAvailable.bind(this));\n\n        this._olmAdapter.on(\n            OlmAdapter.events.PARTICIPANT_VERIFICATION_COMPLETED,\n            this._onParticipantVerificationCompleted.bind(this));\n\n        this.conference.on(\n            JitsiConferenceEvents.PARTICIPANT_PROPERTY_CHANGED,\n            this._onParticipantPropertyChanged.bind(this));\n        this.conference.on(\n            JitsiConferenceEvents.USER_JOINED,\n            this._onParticipantJoined.bind(this));\n        this.conference.on(\n            JitsiConferenceEvents.USER_LEFT,\n            this._onParticipantLeft.bind(this));\n        this.conference.on(\n                JitsiConferenceEvents.CONFERENCE_JOINED,\n                () => {\n                    this._conferenceJoined = true;\n                });\n    }\n\n    /**\n     * Returns the sasVerficiation object.\n     *\n     * @returns {Object}\n     */\n    get sasVerification() {\n        return this._olmAdapter;\n    }\n\n    /**\n     * When E2EE is enabled it initializes sessions and sets the key.\n     * Cleans up the sessions when disabled.\n     *\n     * @param {boolean} enabled - whether E2EE should be enabled or not.\n     * @returns {void}\n     */\n    async _setEnabled(enabled) {\n        if (enabled) {\n            // Initialize Olm sessions with all participants.\n            await this._olmAdapter.initSessions();\n            logger.debug('All Olm sessions established, proceeding with key distribution');\n        }\n        this._key = enabled ? this._generateKey() : false;\n        const index = await this._olmAdapter.updateKey(this._key);\n\n        this.e2eeCtx.setKey(this.conference.myUserId(), this._key, index);\n\n        // Clear sessions after key distribution when disabling.\n        if (!enabled) {\n            this._olmAdapter.clearAllParticipantsSessions();\n        }\n    }\n\n    /**\n     * Handles an update in a participant's presence property.\n     *\n     * @param {JitsiParticipant} participant - The participant.\n     * @param {string} name - The name of the property that changed.\n     * @param {*} oldValue - The property's previous value.\n     * @param {*} newValue - The property's new value.\n     * @private\n     */\n    _onParticipantPropertyChanged(participant, name, oldValue, newValue) {\n        switch (name) {\n        case 'e2ee.idKey':\n            logger.debug(`Participant ${participant.getId()} updated their id key: ${newValue}`);\n            break;\n        case 'e2ee.enabled':\n            if (!newValue && this.enabled) {\n                this._olmAdapter.clearParticipantSession(participant);\n            }\n            break;\n        }\n    }\n\n    /**\n     * Advances (using ratcheting) the current key when a new participant joins the conference.\n     * @private\n     */\n    _onParticipantJoined() {\n        if (this._conferenceJoined && this.enabled) {\n            this._ratchetKey();\n        }\n    }\n\n    /**\n     * Rotates the current key when a participant leaves the conference.\n     * @private\n     */\n    _onParticipantLeft(id) {\n        this.e2eeCtx.cleanup(id);\n\n        if (this.enabled) {\n            this._rotateKey();\n        }\n    }\n\n    /**\n     * Rotates the local key. Rotating the key implies creating a new one, then distributing it\n     * to all participants and once they all received it, start using it.\n     *\n     * @private\n     */\n    async _rotateKeyImpl() {\n        logger.debug('Rotating key');\n\n        this._key = this._generateKey();\n        const index = await this._olmAdapter.updateKey(this._key);\n\n        this.e2eeCtx.setKey(this.conference.myUserId(), this._key, index);\n    }\n\n    /**\n     * Advances the current key by using ratcheting.\n     *\n     * @private\n     */\n    async _ratchetKeyImpl() {\n        logger.debug('Ratchetting key');\n\n        const material = await importKey(this._key);\n        const newKey = await ratchet(material);\n\n        this._key = new Uint8Array(newKey);\n\n        const index = this._olmAdapter.updateCurrentMediaKey(this._key);\n\n        this.e2eeCtx.setKey(this.conference.myUserId(), this._key, index);\n    }\n\n    /**\n     * Handles an update in a participant's key.\n     *\n     * @param {string} id - The participant ID.\n     * @param {Uint8Array | boolean} key - The new key for the participant.\n     * @param {Number} index - The new key's index.\n     * @private\n     */\n    _onParticipantKeyUpdated(id, key, index) {\n        logger.debug(`Participant ${id} updated their key`);\n\n        this.e2eeCtx.setKey(id, key, index);\n    }\n\n    /**\n     * Handles the SAS ready event.\n     *\n     * @param {string} pId - The participant ID.\n     * @param {Uint8Array} sas - The bytes from sas.generate_bytes..\n     * @private\n     */\n    _onParticipantSasReady(pId, sas) {\n        this.conference.eventEmitter.emit(JitsiConferenceEvents.E2EE_VERIFICATION_READY, pId, sas);\n    }\n\n    /**\n     * Handles the sas available event.\n     *\n     * @param {string} pId - The participant ID.\n     * @private\n     */\n    _onParticipantSasAvailable(pId) {\n        this.conference.eventEmitter.emit(JitsiConferenceEvents.E2EE_VERIFICATION_AVAILABLE, pId);\n    }\n\n    /**\n     * Handles the SAS completed event.\n     *\n     * @param {string} pId - The participant ID.\n     * @param {boolean} success - Wheter the verification was succesfull.\n     * @private\n     */\n    _onParticipantVerificationCompleted(pId, success, message) {\n        this.conference.eventEmitter.emit(JitsiConferenceEvents.E2EE_VERIFICATION_COMPLETED, pId, success, message);\n    }\n\n    /**\n     * Generates a new 256 bit random key.\n     *\n     * @returns {Uint8Array}\n     * @private\n     */\n    _generateKey() {\n        return window.crypto.getRandomValues(new Uint8Array(32));\n    }\n}\n","/**\n * Derives a set of keys from the master key.\n * @param {CryptoKey} material - master key to derive from\n *\n * See https://tools.ietf.org/html/draft-omara-sframe-00#section-4.3.1\n */\nexport async function deriveKeys(material: CryptoKey): Promise<{ encryptionKey: CryptoKey; material: CryptoKey; }> {\n    const info = new ArrayBuffer();\n    const textEncoder = new TextEncoder();\n\n    // https://developer.mozilla.org/en-US/docs/Web/API/SubtleCrypto/deriveKey#HKDF\n    // https://developer.mozilla.org/en-US/docs/Web/API/HkdfParams\n    const encryptionKey = await crypto.subtle.deriveKey({\n        hash: 'SHA-256',\n        info,\n        name: 'HKDF',\n        salt: textEncoder.encode('JFrameEncryptionKey')\n    }, material, {\n        length: 128,\n        name: 'AES-GCM'\n    }, false, [ 'encrypt', 'decrypt' ]);\n\n    return {\n        encryptionKey,\n        material\n    };\n}\n\n/**\n * Ratchets a key. See\n * https://tools.ietf.org/html/draft-omara-sframe-00#section-4.3.5.1\n * @param {CryptoKey} material - base key material\n * @returns {Promise<ArrayBuffer>} - ratcheted key material\n */\nexport async function ratchet(material: CryptoKey): Promise<ArrayBuffer> {\n    const textEncoder = new TextEncoder();\n\n    // https://developer.mozilla.org/en-US/docs/Web/API/SubtleCrypto/deriveBits\n    return await crypto.subtle.deriveBits({\n        hash: 'SHA-256',\n        info: new ArrayBuffer(),\n        name: 'HKDF',\n        salt: textEncoder.encode('JFrameRatchetKey')\n    }, material, 256);\n}\n\n/**\n * Converts a raw key into a WebCrypto key object with default options\n * suitable for our usage.\n * @param {ArrayBuffer} keyBytes - raw key\n * @param {Array} keyUsages - key usages, see importKey documentation\n * @returns {Promise<CryptoKey>} - the WebCrypto key.\n */\nexport async function importKey(keyBytes: ArrayBuffer): Promise<CryptoKey> {\n    // https://developer.mozilla.org/en-US/docs/Web/API/SubtleCrypto/importKey\n    return await crypto.subtle.importKey('raw', keyBytes, 'HKDF', false, [ 'deriveBits', 'deriveKey' ]);\n}\n","import browser from '../browser';\n\nimport { ExternallyManagedKeyHandler } from './ExternallyManagedKeyHandler';\nimport { ManagedKeyHandler } from './ManagedKeyHandler';\nimport { OlmAdapter } from './OlmAdapter';\n\n/**\n * This module integrates {@link KeyHandler} with {@link JitsiConference} in order to enable E2E encryption.\n */\nexport class E2EEncryption {\n    /**\n     * A constructor.\n     * @param {JitsiConference} conference - The conference instance for which E2E encryption is to be enabled.\n     */\n    constructor(conference) {\n        const { e2ee = {} } = conference.options.config;\n\n        this._externallyManaged = e2ee.externallyManagedKey;\n\n        if (this._externallyManaged) {\n            this._keyHandler = new ExternallyManagedKeyHandler(conference);\n        } else {\n            this._keyHandler = new ManagedKeyHandler(conference);\n        }\n    }\n\n    /**\n     * Indicates if E2EE is supported in the current platform.\n     *\n     * @param {object} config - Global configuration.\n     * @returns {boolean}\n     */\n    static isSupported(config) {\n        const { e2ee = {} } = config;\n\n        if (!e2ee.externallyManagedKey && !OlmAdapter.isSupported()) {\n            return false;\n        }\n\n        if (e2ee.disabled || config.testing?.disableE2EE) {\n            return false;\n        }\n\n        return browser.supportsInsertableStreams()\n                || (config.enableEncodedTransformSupport && browser.supportsEncodedTransform());\n    }\n\n    /**\n     * Indicates whether E2EE is currently enabled or not.\n     *\n     * @returns {boolean}\n     */\n    isEnabled() {\n        return this._keyHandler.isEnabled();\n    }\n\n    /**\n     * Enables / disables End-To-End encryption.\n     *\n     * @param {boolean} enabled - whether E2EE should be enabled or not.\n     * @returns {void}\n     */\n    async setEnabled(enabled) {\n        await this._keyHandler.setEnabled(enabled);\n    }\n\n    /**\n     * Sets the key and index for End-to-End encryption.\n     *\n     * @param {CryptoKey} [keyInfo.encryptionKey] - encryption key.\n     * @param {Number} [keyInfo.index] - the index of the encryption key.\n     * @returns {void}\n     */\n    setEncryptionKey(keyInfo) {\n        this._keyHandler.setKey(keyInfo);\n    }\n\n    /**\n     * Starts the verification process of the participant\n     *\n     * @param {Participant} - participant to be verified.\n     * @returns {void}\n     */\n    startVerification(participant) {\n        this._keyHandler.sasVerification?.startVerification(participant);\n    }\n\n    /**\n     * Marks the channel as verified\n     *\n     * @param {Participant} - participant to be verified.\n     * @param {boolean} isVerified - whether the verification was succesfull.\n     * @returns {void}\n     */\n    markParticipantVerified(participant, isVerified) {\n        this._keyHandler.sasVerification?.markParticipantVerified(participant, isVerified);\n    }\n}\n","export enum E2ePingEvents {\n\n    /**\n     * Indicates that the end-to-end round-trip-time for a participant has changed.\n     */\n    E2E_RTT_CHANGED = 'e2eping.e2e_rtt_changed'\n}\n","import { getLogger } from '@jitsi/logger';\n\nimport JitsiConference from '../../JitsiConference';\nimport { JitsiConferenceEvents } from '../../JitsiConferenceEvents';\nimport JitsiParticipant from '../../JitsiParticipant';\nimport { E2ePingEvents } from '../../service/e2eping/E2ePingEvents';\n\nconst logger = getLogger('e2eping');\n\n/**\n * The 'type' of a message which designates an e2e ping request.\n * @type {string}\n */\nconst E2E_PING_REQUEST: string = 'e2e-ping-request';\n\n/**\n * The 'type' of a message which designates an e2e ping response.\n * @type {string}\n */\nconst E2E_PING_RESPONSE: string = 'e2e-ping-response';\n\n/**\n * The number of requests to wait for before emitting an RTT value.\n */\nconst DEFAULT_NUM_REQUESTS: number = 5;\n\n/**\n * The maximum number of messages per second to aim for. This is for the entire\n * conference, with the assumption that all endpoints join at once.\n */\nconst DEFAULT_MAX_MESSAGES_PER_SECOND: number = 250;\n\n/**\n * The conference size beyond which e2e pings will be disabled.\n */\nconst DEFAULT_MAX_CONFERENCE_SIZE: number = 200;\n\nexport interface IPingMessage {\n    id: number;\n    type: string;\n}\n\nexport interface IE2ePingOptions {\n    e2eping?: {\n        enabled?: boolean;\n        maxConferenceSize?: number;\n        maxMessagesPerSecond?: number;\n        numRequests?: number;\n    };\n}\n\nexport interface IRequest {\n    id: number;\n    rtt?: number;\n    timeSent: number;\n}\n\n/**\n * Saves e2e ping related state for a single JitsiParticipant.\n */\nclass ParticipantWrapper {\n    participant: JitsiParticipant;\n    e2eping: E2ePing;\n    id: string;\n    requests: { [key: number]: IRequest; };\n    lastRequestId: number;\n    timeout: Nullable<number>;\n\n    /**\n     * Creates a ParticipantWrapper\n     * @param {JitsiParticipant} participant - The remote participant that this\n     * object wraps.\n     * @param {E2ePing} e2eping\n     */\n    constructor(participant: JitsiParticipant, e2eping: E2ePing) {\n        // The JitsiParticipant\n        this.participant = participant;\n\n        // The E2ePing\n        this.e2eping = e2eping;\n\n        // Caches the ID\n        this.id = participant.getId();\n\n        // Recently sent requests\n        this.requests = {};\n\n        // The ID of the last sent request. We just increment it for each new\n        // request. Start at 1 so we can consider only thruthy values valid.\n        this.lastRequestId = 1;\n\n        this.sendRequest = this.sendRequest.bind(this);\n        this.handleResponse = this.handleResponse.bind(this);\n        this.maybeLogRttAndStop = this.maybeLogRttAndStop.bind(this);\n        this.scheduleNext = this.scheduleNext.bind(this);\n        this.stop = this.stop.bind(this);\n        this.getDelay = this.getDelay.bind(this);\n        this.timeout = this.scheduleNext();\n    }\n\n    /**\n     * Schedule the next ping to be sent.\n     */\n    scheduleNext(): number {\n        return window.setTimeout(this.sendRequest, this.getDelay());\n    }\n\n    /**\n     * Stop pinging this participant, canceling a scheduled ping, if any.\n     */\n    stop(): void {\n        if (this.timeout) {\n            window.clearTimeout(this.timeout);\n        }\n        this.e2eping.removeParticipant(this.id);\n    }\n\n    /**\n     * Get the delay until the next ping in milliseconds.\n     */\n    getDelay(): number {\n        const conferenceSize = this.e2eping.conference.getParticipants().length;\n        const endpointPairs = conferenceSize * (conferenceSize - 1) / 2;\n        const totalMessages = endpointPairs * this.e2eping.numRequests;\n        const totalSeconds = totalMessages / this.e2eping.maxMessagesPerSecond;\n\n        // Randomize between .5 and 1.5\n        const r = 1.5 - Math.random();\n        const delayBetweenMessages = r * Math.max(1000 * (totalSeconds / this.e2eping.numRequests), 1000);\n\n        return delayBetweenMessages;\n    }\n\n    /**\n     * Sends the next ping request.\n     * @type {*}\n     */\n    sendRequest(): void {\n        const requestId = this.lastRequestId++;\n        const requestMessage = {\n            id: requestId,\n            type: E2E_PING_REQUEST\n        };\n\n        this.e2eping.sendMessage(requestMessage, this.id);\n        this.requests[requestId] = {\n            id: requestId,\n            timeSent: window.performance.now()\n        };\n    }\n\n    /**\n     * Handles a response from this participant.\n     * @type {*}\n     */\n    handleResponse(response: any): void {\n        const request = this.requests[response.id];\n\n        if (request) {\n            request.rtt = window.performance.now() - request.timeSent;\n        }\n        this.maybeLogRttAndStop();\n    }\n\n    /**\n     * Check if we've received the pre-configured number of responses, and if\n     * so log the measured RTT and stop sending requests.\n     * @type {*}\n     */\n    maybeLogRttAndStop(): void {\n        // The RTT we'll report is the minimum RTT measured\n        let rtt = Infinity;\n        let request: any, requestId: any;\n        let numRequestsWithResponses = 0;\n        let totalNumRequests = 0;\n\n        for (requestId in this.requests) {\n            if (this.requests.hasOwnProperty(requestId)) {\n                request = this.requests[requestId];\n\n                totalNumRequests++;\n                if (request.rtt) {\n                    numRequestsWithResponses++;\n                    rtt = Math.min(rtt, request.rtt);\n                }\n            }\n        }\n\n        if (numRequestsWithResponses >= this.e2eping.numRequests) {\n            logger.info(`Measured RTT=${rtt} ms to ${this.id} (in ${this.participant.getProperty('region')})`);\n            this.stop();\n\n            this.e2eping.conference.eventEmitter.emit(\n                E2ePingEvents.E2E_RTT_CHANGED, this.participant, rtt);\n\n            return;\n        } else if (totalNumRequests > 2 * this.e2eping.numRequests) {\n            logger.info(`Stopping e2eping for ${this.id} because we sent ${totalNumRequests} with only `\n                + `${numRequestsWithResponses} responses.`);\n            this.stop();\n\n            return;\n        }\n\n        this.timeout = this.scheduleNext();\n    }\n}\n\n/**\n * Implements end-to-end ping (from one conference participant to another) via\n * the jitsi-videobridge channel (either WebRTC data channel or web socket).\n *\n * TODO: use a broadcast message instead of individual pings to each remote\n * participant.\n *\n * This class:\n * 1. Sends periodic ping requests to all other participants in the\n * conference.\n * 2. Responds to ping requests from other participants.\n * 3. Fires events with the end-to-end RTT to each participant whenever a\n * response is received.\n * 4. Fires analytics events with the end-to-end RTT periodically.\n */\nexport default class E2ePing {\n\n    conference: JitsiConference;\n    eventEmitter: any;\n    sendMessage: (message: IPingMessage, participantId: string) => void;\n    participants: { [key: string]: ParticipantWrapper; };\n    numRequests: number;\n    maxConferenceSize: number;\n    maxMessagesPerSecond: number;\n\n    /**\n     * @param {JitsiConference} conference - The conference.\n     * @param {Function} sendMessage - The function to use to send a message.\n     * @param {Object} options\n     */\n    constructor(\n            conference: JitsiConference,\n            options: IE2ePingOptions,\n            sendMessage: (message: IPingMessage, participantId: string) => void) {\n        this.conference = conference;\n        this.eventEmitter = conference.eventEmitter;\n        this.sendMessage = sendMessage;\n\n        // Maps a participant ID to its ParticipantWrapper\n        this.participants = {};\n\n        this.numRequests = DEFAULT_NUM_REQUESTS;\n        this.maxConferenceSize = DEFAULT_MAX_CONFERENCE_SIZE;\n        this.maxMessagesPerSecond = DEFAULT_MAX_MESSAGES_PER_SECOND;\n\n        if (options?.e2eping) {\n            if (typeof options.e2eping.numRequests === 'number') {\n                this.numRequests = options.e2eping.numRequests;\n            }\n            if (typeof options.e2eping.maxConferenceSize === 'number') {\n                this.maxConferenceSize = options.e2eping.maxConferenceSize;\n            }\n            if (typeof options.e2eping.maxMessagesPerSecond === 'number') {\n                this.maxMessagesPerSecond = options.e2eping.maxMessagesPerSecond;\n            }\n        }\n        logger.info(\n            `Initializing e2e ping with numRequests=${this.numRequests}, maxConferenceSize=${this.maxConferenceSize}, `\n            + `maxMessagesPerSecond=${this.maxMessagesPerSecond}.`);\n\n        this.participantJoined = this.participantJoined.bind(this);\n\n        this.participantLeft = this.participantLeft.bind(this);\n        conference.on(JitsiConferenceEvents.USER_LEFT, this.participantLeft);\n\n        this.messageReceived = this.messageReceived.bind(this);\n        conference.on(JitsiConferenceEvents.ENDPOINT_MESSAGE_RECEIVED, this.messageReceived);\n\n        this.conferenceJoined = this.conferenceJoined.bind(this);\n        conference.on(JitsiConferenceEvents.CONFERENCE_JOINED, this.conferenceJoined);\n    }\n\n    /**\n     * Delay processing USER_JOINED events until the MUC is fully joined,\n     * otherwise the apparent conference size will be wrong.\n     */\n    conferenceJoined(): void {\n        this.conference.getParticipants().forEach(p => this.participantJoined(p.getId(), p));\n        this.conference.on(JitsiConferenceEvents.USER_JOINED, this.participantJoined);\n    }\n\n    /**\n     * Handles a message that was received.\n     *\n     * @param participant - The message sender.\n     * @param payload - The payload of the message.\n     */\n    messageReceived(participant: JitsiParticipant, payload: IPingMessage): void {\n        // Listen to E2E PING requests and responses from other participants\n        // in the conference.\n        if (payload.type === E2E_PING_REQUEST) {\n            this.handleRequest(participant.getId(), payload);\n        } else if (payload.type === E2E_PING_RESPONSE) {\n            this.handleResponse(participant.getId(), payload);\n        }\n    }\n\n    /**\n     * Handles a participant joining the conference. Starts to send ping\n     * requests to the participant.\n     *\n     * @param {String} id - The ID of the participant.\n     * @param {JitsiParticipant} participant - The participant that joined.\n     */\n    participantJoined(id: string, participant: JitsiParticipant): void {\n        if (this.participants[id]) {\n            logger.info(`Participant wrapper already exists for ${id}. Clearing.`);\n            this.participants[id].stop();\n        }\n\n        if (this.conference.getParticipants().length > this.maxConferenceSize) {\n            return;\n        }\n\n        // We don't need to send e2eping in both directions for a pair of\n        // endpoints. Force only one direction with just string comparison of\n        // the IDs.\n        if (this.conference.myUserId() > id) {\n            logger.info(`Starting e2eping for participant ${id}`);\n            this.participants[id] = new ParticipantWrapper(participant, this);\n        }\n    }\n\n    /**\n     * Remove a participant without calling \"stop\".\n     */\n    removeParticipant(id: string): void {\n        if (this.participants[id]) {\n            delete this.participants[id];\n        }\n    }\n\n    /**\n     * Handles a participant leaving the conference. Stops sending requests.\n     *\n     * @param {String} id - The ID of the participant.\n     */\n    participantLeft(id: string): void {\n        if (this.participants[id]) {\n            this.participants[id].stop();\n            delete this.participants[id];\n        }\n    }\n\n    /**\n     * Handles a ping request coming from another participant.\n     *\n     * @param {string} participantId - The ID of the participant who sent the\n     * request.\n     * @param {Object} request - The request.\n     */\n    handleRequest(participantId: string, request: { id: number; }): void {\n        // If it's a valid request, just send a response.\n        if (request?.id) {\n            const response = {\n                id: request.id,\n                type: E2E_PING_RESPONSE\n            };\n\n            this.sendMessage(response, participantId);\n        } else {\n            logger.info(`Received an invalid e2e ping request from ${participantId}.`);\n        }\n    }\n\n    /**\n     * Handles a ping response coming from another participant\n     * @param {string} participantId - The ID of the participant who sent the\n     * response.\n     * @param {Object} response - The response.\n     */\n    handleResponse(participantId: string, response: { id: number; }): void {\n        const participantWrapper = this.participants[participantId];\n\n        if (participantWrapper) {\n            participantWrapper.handleResponse(response);\n        }\n    }\n\n    /**\n     * Stops this E2ePing (i.e. stop sending requests).\n     */\n    stop(): void {\n        logger.info('Stopping e2eping');\n\n        this.conference.off(JitsiConferenceEvents.USER_JOINED, this.participantJoined);\n        this.conference.off(JitsiConferenceEvents.USER_LEFT, this.participantLeft);\n        this.conference.off(JitsiConferenceEvents.ENDPOINT_MESSAGE_RECEIVED, this.messageReceived);\n\n        for (const id in this.participants) {\n            if (this.participants.hasOwnProperty(id)) {\n                this.participants[id].stop();\n            }\n        }\n\n        this.participants = {};\n    }\n}\n","import { getLogger } from '@jitsi/logger';\n\nimport JitsiConference from '../../JitsiConference';\nimport { RTCEvents } from '../../service/RTC/RTCEvents';\nimport JitsiRemoteTrack from '../RTC/JitsiRemoteTrack';\nimport TraceablePeerConnection from '../RTC/TraceablePeerConnection';\nimport FeatureFlags from '../flags/FeatureFlags';\n\n// Flag to set on receivers to avoid setting up the lite mode\n// more than once.\nconst kJitsiLiteMode = Symbol('kJitsiLiteMode');\n\nconst logger = getLogger('testing:LiteModeContext');\n\n/**\n * This module implements a discard-all insertable stream.  Use to reduce decoder CPU load for testing.\n */\nexport class LiteModeContext {\n    private enabled: boolean;\n\n    /**\n     * A constructor.\n     * @param {JitsiConference} conference - The conference instance for which lite mode is to be enabled.\n     */\n    constructor(conference: JitsiConference) {\n        this.enabled = FeatureFlags.isRunInLiteModeEnabled();\n        if (!this.enabled) {\n            return;\n        }\n\n        conference.rtc.on(\n            RTCEvents.REMOTE_TRACK_ADDED,\n            (track: JitsiRemoteTrack, tpc: TraceablePeerConnection) => this._setupLiteModeForTrack(tpc, track));\n    }\n\n    /**\n     * Setup Lite Mode for a track.\n     *\n     * @private\n     */\n    private _setupLiteModeForTrack(tpc: TraceablePeerConnection, track: JitsiRemoteTrack): void {\n        if (!this.enabled) {\n            return;\n        }\n\n        const receiver = tpc.findReceiverForTrack(track.getTrack());\n\n        if (!receiver) {\n            logger.warn(`Could not set up lite mode for ${track}: receiver not found in: ${tpc}`);\n\n            return;\n        }\n\n        if (receiver[kJitsiLiteMode]) {\n            return;\n        }\n        receiver[kJitsiLiteMode] = true;\n\n        const receiverStreams = receiver.createEncodedStreams();\n\n        const transformStream = new TransformStream({\n            transform: () => {\n                // Don't call controller.enqueue(encodedFrame), and so drop everything\n            }\n        });\n\n        receiverStreams.readable.pipeThrough(transformStream).pipeTo(receiverStreams.writable);\n    }\n}\n","import { getLogger } from '@jitsi/logger';\n\nimport JitsiConference from '../../JitsiConference';\nimport { CodecMimeType } from '../../service/RTC/CodecMimeType';\nimport { MediaType } from '../../service/RTC/MediaType';\nimport { VIDEO_CODECS_BY_COMPLEXITY } from '../../service/RTC/StandardVideoQualitySettings';\nimport { VideoType } from '../../service/RTC/VideoType';\nimport JitsiLocalTrack from '../RTC/JitsiLocalTrack';\nimport browser from '../browser';\nimport JingleSessionPC from '../xmpp/JingleSessionPC';\n\nconst logger = getLogger('qc:CodecSelection');\n\n// Default video codec preferences on mobile and desktop endpoints.\nconst DESKTOP_VIDEO_CODEC_ORDER = [ CodecMimeType.AV1, CodecMimeType.VP9, CodecMimeType.VP8, CodecMimeType.H264 ];\nconst MOBILE_P2P_VIDEO_CODEC_ORDER = [ CodecMimeType.H264, CodecMimeType.VP8, CodecMimeType.VP9, CodecMimeType.AV1 ];\nconst MOBILE_VIDEO_CODEC_ORDER = [ CodecMimeType.VP8, CodecMimeType.VP9, CodecMimeType.H264, CodecMimeType.AV1 ];\n\nexport interface ICodecSelectionOptions {\n    [connectionType: string]: {\n        disabledCodec?: string;\n        enableAV1ForFF?: boolean;\n        preferenceOrder?: string[];\n        preferredCodec?: string;\n        screenshareCodec?: string;\n    };\n}\n\nexport type CodecPreferenceOrder = { [connectionType: string]: string[]; };\nexport type ScreenshareCodec = { [connectionType: string]: string; };\n\n/**\n * This class handles the codec selection mechanism for the conference based on the config.js settings.\n * The preferred codec is selected based on the settings and the list of codecs supported by the browser.\n * The preferred codec is published in presence which is then used by the other endpoints in the\n * conference to pick a supported codec at join time and when the call transitions between p2p and jvb\n * connections.\n */\nexport class CodecSelection {\n    private codecPreferenceOrder: CodecPreferenceOrder;\n    private conference: JitsiConference;\n    private encodeTimeStats: Map<string, unknown>;\n    private options: ICodecSelectionOptions;\n    private screenshareCodec: ScreenshareCodec;\n    private visitorCodecs: string[];\n\n    /**\n     * Creates a new instance for a given conference.\n     *\n     * @param {JitsiConference} conference the conference instance\n     * @param {*} options\n     * @param {string} options.jvb settings (codec list, preferred and disabled) for the jvb connection.\n     * @param {string} options.p2p settings (codec list, preferred and disabled) for the p2p connection.\n     */\n    constructor(conference: JitsiConference, options: ICodecSelectionOptions) {\n        this.codecPreferenceOrder = {};\n        this.conference = conference;\n        this.encodeTimeStats = new Map();\n        this.options = options;\n        this.screenshareCodec = {};\n        this.visitorCodecs = [];\n\n        for (const connectionType of Object.keys(options)) {\n            let { disabledCodec, preferredCodec, preferenceOrder } = options[connectionType];\n            const { enableAV1ForFF = false, screenshareCodec } = options[connectionType];\n            const supportedCodecs = new Set(this._getSupportedVideoCodecs(connectionType));\n\n            // Default preference codec order when no codec preferences are set in config.js\n            let selectedOrder = Array.from(supportedCodecs);\n\n            if (preferenceOrder) {\n                preferenceOrder = preferenceOrder.map(codec => codec.toLowerCase());\n\n                // Select all codecs that are supported by the browser.\n                selectedOrder = preferenceOrder.filter(codec => supportedCodecs.has(codec));\n\n            // Generate the codec list based on the supported codecs and the preferred/disabled (deprecated) settings\n            } else if (preferredCodec || disabledCodec) {\n                disabledCodec = disabledCodec?.toLowerCase();\n                preferredCodec = preferredCodec?.toLowerCase();\n\n                // VP8 cannot be disabled since it the default codec.\n                if (disabledCodec && disabledCodec !== CodecMimeType.VP8) {\n                    selectedOrder = selectedOrder.filter(codec => codec !== disabledCodec);\n                }\n\n                const index = selectedOrder.findIndex(codec => codec === preferredCodec);\n\n                // Move the preferred codec to the top of the list.\n                if (preferredCodec && index !== -1) {\n                    selectedOrder.splice(index, 1);\n                    selectedOrder.unshift(preferredCodec);\n                }\n            }\n\n            // Push AV1 and VP9 to the end of the list if they are supported by the browser but has implementation bugs\n            // For example, 136 and newer versions of Firefox supports AV1 but only simulcast and not SVC. Even with\n            // simulcast, temporal scalability is not supported. This way Firefox will continue to decode AV1 from\n            // other endpoints but will use VP8 for encoding. Similar issues exist with VP9 on Safari and Firefox.\n            const isVp9EncodeSupported = browser.supportsVP9() || (browser.isWebKitBased() && connectionType === 'p2p');\n\n            [ CodecMimeType.AV1, CodecMimeType.VP9 ].forEach(codec => {\n                if ((codec === CodecMimeType.AV1 && browser.isFirefox() && !enableAV1ForFF)\n                    || (codec === CodecMimeType.VP9 && !isVp9EncodeSupported)) {\n                    const index = selectedOrder.findIndex(selectedCodec => selectedCodec === codec);\n\n                    if (index !== -1) {\n                        selectedOrder.splice(index, 1);\n\n                        selectedOrder.push(codec);\n                    }\n                }\n            });\n\n            // Safari retports AV1 as supported on M3+ macs. Because of some decoder/encoder issues reported AV1 should\n            // be disabled until all issues are resolved.\n            if (browser.isWebKitBased()) {\n                selectedOrder = selectedOrder.filter(codec => codec !== CodecMimeType.AV1);\n            }\n\n            logger.info(`Codec preference order for ${connectionType} connection is ${selectedOrder}`);\n            this.codecPreferenceOrder[connectionType] = selectedOrder;\n\n            // Set the preferred screenshare codec.\n            if (screenshareCodec && supportedCodecs.has(screenshareCodec.toLowerCase())) {\n                this.screenshareCodec[connectionType] = screenshareCodec.toLowerCase();\n            }\n        }\n    }\n\n    /**\n     * Returns a list of video codecs that are supported by the browser.\n     *\n     * @param {string} connectionType - media connection type, p2p or jvb.\n     * @returns {Array}\n     */\n    _getSupportedVideoCodecs(connectionType: string): string[] {\n        const videoCodecMimeTypes = browser.isMobileDevice() && connectionType === 'p2p'\n            ? MOBILE_P2P_VIDEO_CODEC_ORDER\n            : browser.isMobileDevice() ? MOBILE_VIDEO_CODEC_ORDER : DESKTOP_VIDEO_CODEC_ORDER;\n\n        const supportedCodecs = videoCodecMimeTypes.filter(codec =>\n            (window.RTCRtpReceiver?.getCapabilities?.(MediaType.VIDEO)?.codecs ?? [])\n                .some(supportedCodec => supportedCodec.mimeType.toLowerCase() === `${MediaType.VIDEO}/${codec}`));\n\n        // Select VP8 as the default codec if RTCRtpReceiver.getCapabilities() is not supported by the browser or if it\n        // returns an empty set.\n        !supportedCodecs.length && supportedCodecs.push(CodecMimeType.VP8);\n\n        return supportedCodecs;\n    }\n\n    /**\n     * Returns the current codec preference order for the given connection type.\n     *\n     * @param {String} connectionType The media connection type, 'p2p' or 'jvb'.\n     * @returns {Array<string>}\n     */\n    getCodecPreferenceList(connectionType: string): string[] {\n        return this.codecPreferenceOrder[connectionType];\n    }\n\n    /**\n     * Returns the preferred screenshare codec for the given connection type.\n     *\n     * @param {Optional} connectionType The media connection type, 'p2p' or 'jvb'.\n     * @returns CodecMimeType\n     */\n    getScreenshareCodec(connectionType: string): Optional<string> {\n        return this.screenshareCodec[connectionType];\n    }\n\n    /**\n     * Sets the codec on the media session based on the codec preference order configured in config.js and the supported\n     * codecs published by the remote participants in their presence.\n     *\n     * @param {JingleSessionPC} mediaSession session for which the codec selection has to be made.\n     */\n    selectPreferredCodec(mediaSession?: JingleSessionPC): void {\n        const session = mediaSession ? mediaSession : this.conference.jvbJingleSession;\n\n        if (!session) {\n            return;\n        }\n\n        let localPreferredCodecOrder = this.codecPreferenceOrder.jvb;\n\n        // E2EE is curently supported only for VP8 codec.\n        if (this.conference.isE2EEEnabled()) {\n            localPreferredCodecOrder = [ CodecMimeType.VP8 ];\n        }\n\n        const remoteParticipants = this.conference.getParticipants().map(participant => participant.getId());\n        const remoteCodecsPerParticipant = remoteParticipants?.map(remote => {\n            const peerMediaInfo = session._signalingLayer.getPeerMediaInfo(remote, MediaType.VIDEO);\n\n            if (peerMediaInfo?.codecList) {\n                return peerMediaInfo.codecList;\n            } else if (peerMediaInfo?.codecType) {\n                return [ peerMediaInfo.codecType ];\n            }\n\n            return [];\n        }) ?? [];\n\n        // Include the visitor codecs.\n        this.visitorCodecs.length && remoteCodecsPerParticipant.push(this.visitorCodecs);\n\n        const selectedCodecOrder = localPreferredCodecOrder.reduce<CodecMimeType[]>((acc, localCodec) => {\n            let codecNotSupportedByRemote = false;\n\n            // Remove any codecs that are not supported by any of the remote endpoints. The order of the supported\n            // codecs locally however will remain the same since we want to support asymmetric codecs.\n            for (const remoteCodecs of remoteCodecsPerParticipant) {\n                // Ignore remote participants that do not publish codec preference in presence (transcriber).\n                if (remoteCodecs.length) {\n                    codecNotSupportedByRemote = codecNotSupportedByRemote\n                    || !remoteCodecs.find(participantCodec => participantCodec === localCodec);\n                }\n            }\n            if (!codecNotSupportedByRemote) {\n                acc.push(localCodec as CodecMimeType);\n            }\n\n            return acc;\n        }, []);\n\n        if (!selectedCodecOrder.length) {\n            logger.warn('Invalid codec list generated because of a user joining/leaving the call');\n\n            return;\n        }\n\n        session.setVideoCodecs(selectedCodecOrder, this.screenshareCodec?.jvb as CodecMimeType);\n    }\n\n    /**\n     * Changes the codec preference order.\n     *\n     * @param {JitsiLocalTrack} localTrack - The local video track.\n     * @param {CodecMimeType} codec - The codec used for encoding the given local video track.\n     * @returns boolean - Returns true if the codec order has been updated, false otherwise.\n     */\n    changeCodecPreferenceOrder(localTrack: JitsiLocalTrack, codec: string): boolean {\n        const session = this.conference.getActiveMediaSession();\n        const connectionType = session.isP2P ? 'p2p' : 'jvb';\n        const codecOrder = this.codecPreferenceOrder[connectionType];\n        const videoType = localTrack.getVideoType();\n        const codecsByVideoType = VIDEO_CODECS_BY_COMPLEXITY[videoType]\n            .filter(val => Boolean(codecOrder.find(supportedCodec => supportedCodec === val)));\n        const codecIndex = codecsByVideoType.findIndex(val => val === codec.toLowerCase());\n\n        // Do nothing if we are using the lowest complexity codec already.\n        if (codecIndex === codecsByVideoType.length - 1) {\n            return false;\n        }\n\n        const newCodec = codecsByVideoType[codecIndex + 1];\n\n        if (videoType === VideoType.CAMERA) {\n            const idx = codecOrder.findIndex(val => val === newCodec);\n\n            codecOrder.splice(idx, 1);\n            codecOrder.unshift(newCodec);\n            logger.info(`QualityController - switching camera codec to ${newCodec} because of cpu restriction`);\n        } else {\n            this.screenshareCodec[connectionType] = newCodec;\n            logger.info(`QualityController - switching screenshare codec to ${newCodec} because of cpu restriction`);\n        }\n\n        this.selectPreferredCodec(session);\n\n        return true;\n    }\n\n    /**\n     * Updates the aggregate list of the codecs supported by all the visitors in the call and calculates the\n     * selected codec if needed.\n     * @param {Array} codecList - visitor codecs.\n     * @returns {void}\n     */\n    updateVisitorCodecs(codecList: string[]): void {\n        if (this.visitorCodecs === codecList) {\n            return;\n        }\n\n        this.visitorCodecs = codecList;\n        this.selectPreferredCodec();\n    }\n}\n","/**\n * Enum representing the audio subscription options for remote audio streams. The Jitsi Vide Bridge will forward the\n * remote audio streams to the client based on the selected subscription option and also based on the route loudest\n * configuration described at\n * https://github.com/jitsi/jitsi-videobridge/blob/master/jvb/src/main/resources/reference.conf#L344\n */\nexport enum ReceiverAudioSubscription {\n    /**\n     * Subscribe to all remote audio streams signaled in the conference.\n     */\n    ALL = 'All',\n\n    /**\n     * Subscribe to all remote audio streams signaled in the conference, except for the one that are explicitly\n     * excluded.\n     */\n    EXCLUDE = 'Exclude',\n\n    /**\n     * Subscribe only to the remote audio streams that are explicitly included in the subscription.\n     */\n    INCLUDE = 'Include',\n\n    /**\n     * Do not subscribe to any remote audio streams signaled in the conference.\n     */\n    NONE = 'None'\n}\n\n/**\n * Interface representing a message for audio subscription updates.\n */\nexport interface IReceiverAudioSubscriptionMessage {\n    list?: string[];\n    mode: ReceiverAudioSubscription;\n}\n","\nimport { getLogger } from '@jitsi/logger';\nimport { isEqual } from 'lodash-es';\n\nimport JitsiConference from '../../JitsiConference';\nimport { IReceiverAudioSubscriptionMessage, ReceiverAudioSubscription } from '../../service/RTC/ReceiverAudioSubscription';\nimport RTC from '../RTC/RTC';\n\nconst logger = getLogger('qc:ReceiveAudioController');\n\n/**\n * Controller for managing audio subscriptions in a Jitsi conference. It allows subscribing to remote audio streams\n * based on different modes such as ALL, EXCLUDE, INCLUDE, and NONE.\n */\nexport class ReceiverAudioController {\n    private _rtc: RTC;\n\n    /**\n     * The list of remote audio sources that the local endpoint is subscribed/unsubscribed to.\n     * This is used when the subscription mode is set to INCLUDE or EXCLUDE.\n     */\n    private _sourceList: string[];\n\n    /**\n     * The audio subscription options for remote audio streams.\n     */\n    private _subscriptionMode: ReceiverAudioSubscription;\n\n    /**\n     * Creates a new instance of the ReceiverAudioController.\n     */\n    constructor(conference: JitsiConference) {\n        this._rtc = conference.rtc;\n        this._sourceList = [];\n        this._subscriptionMode = ReceiverAudioSubscription.ALL;\n    }\n\n    /**\n     * Gets the current audio subscription option.\n     *\n     * @returns {ReceiverAudioSubscription} The current audio subscription option.\n     */\n    get audioSubscription(): ReceiverAudioSubscription {\n        return this._subscriptionMode;\n    }\n\n    /**\n     * Mutes or unmutes the remote audio streams based on the provided parameter.\n     *\n     * @param {boolean} muted - Indicates whether the remote audio should be muted or not.\n     * @returns {void}\n     */\n    muteRemoteAudio(muted: boolean): void {\n        this.setAudioSubscriptionMode({\n            mode: muted ? ReceiverAudioSubscription.NONE : ReceiverAudioSubscription.ALL\n        });\n    }\n\n    /**\n     * Sets the audio subscription options.\n     *\n     * @param message The audio subscription message containing the mode and optional source list.\n     * @returns {void}\n     */\n    setAudioSubscriptionMode(message: IReceiverAudioSubscriptionMessage): void {\n        if ((message.mode == ReceiverAudioSubscription.NONE || message.mode == ReceiverAudioSubscription.ALL)\n            && this._subscriptionMode == message.mode) {\n            logger.debug(`Ignoring ReceiverAudioSubscription with mode: ${message.mode}, no change needed.`);\n\n            return;\n        }\n        this._subscriptionMode = message.mode;\n        if (message.mode == ReceiverAudioSubscription.INCLUDE\n            || message.mode == ReceiverAudioSubscription.EXCLUDE) {\n\n            if (!message.list?.length) {\n                this._subscriptionMode = message.mode == ReceiverAudioSubscription.INCLUDE\n                    ? ReceiverAudioSubscription.NONE : ReceiverAudioSubscription.ALL;\n            } else if (this._subscriptionMode == message.mode && isEqual(this._sourceList, message.list)) {\n                logger.debug(`Ignoring ReceiverAudioSubscription with mode: ${message.mode},`\n                    + ` sourceList: ${message.list.join(', ')}, no change needed.`);\n\n                return;\n            }\n            this._sourceList = message.list || [];\n        } else {\n            // Clear the source list for ALL or NONE modes.\n            this._sourceList = [];\n        }\n\n        this._rtc.sendReceiverAudioSubscriptionMessage({\n            list: this._sourceList,\n            mode: this._subscriptionMode\n        });\n    }\n}\n","import { getLogger } from '@jitsi/logger';\nimport { isEqual } from 'lodash-es';\n\nimport JitsiConference from '../../JitsiConference';\nimport { MediaType } from '../../service/RTC/MediaType';\nimport { ASSUMED_BANDWIDTH_BPS, LAST_N_UNLIMITED } from '../../service/RTC/StandardVideoQualitySettings';\nimport RTC from '../RTC/RTC';\nimport JingleSessionPC from '../xmpp/JingleSessionPC';\n\nconst logger = getLogger('qc:ReceiveVideoController');\nconst MAX_HEIGHT = 2160;\n\nexport interface IReceiverVideoConstraint {\n    maxHeight: number;\n}\n\nexport interface IReceiverVideoConstraints {\n    assumedBandwidthBps?: number;\n    constraints?: { [sourceName: string]: IReceiverVideoConstraint; };\n    defaultConstraints?: IReceiverVideoConstraint;\n    lastN?: number;\n}\n\n/**\n * This class manages the receive video contraints for a given {@link JitsiConference}. These constraints are\n * determined by the application based on how the remote video streams need to be displayed. This class is responsible\n * for communicating these constraints to the bridge over the bridge channel.\n */\nexport default class ReceiveVideoController {\n    private _conference: JitsiConference;\n    private _rtc: RTC;\n    private _lastN: number;\n    private _maxFrameHeight: number;\n    /**\n     * The map that holds the max frame height requested per remote source for p2p connection.\n     *\n     * @type Map<string, number>\n     */\n    private _sourceReceiverConstraints: Map<string, number>;\n    /**\n     * The number of bps requested from the bridge.\n     */\n    private _assumedBandwidthBps: number;\n    private _lastNLimitedByCpu: boolean;\n    private _receiveResolutionLimitedByCpu: boolean;\n    private _receiverVideoConstraints: IReceiverVideoConstraints;\n\n    /**\n     * Creates a new instance for a given conference.\n     *\n     * @param {JitsiConference} conference the conference instance for which the new instance will be managing\n     * the receive video quality constraints.\n     */\n    constructor(conference: JitsiConference) {\n        this._conference = conference;\n        this._rtc = conference.rtc;\n        const { config } = conference.options;\n\n        // The number of videos requested from the bridge, -1 represents unlimited or all available videos.\n        this._lastN = config?.startLastN ?? config?.channelLastN ?? LAST_N_UNLIMITED;\n\n        // The number representing the maximum video height the local client should receive from the bridge.\n        this._maxFrameHeight = MAX_HEIGHT;\n\n        /**\n         * The map that holds the max frame height requested per remote source for p2p connection.\n         *\n         * @type Map<string, number>\n         */\n        this._sourceReceiverConstraints = new Map();\n\n        /**\n         * The number of bps requested from the bridge.\n         */\n        this._assumedBandwidthBps = ASSUMED_BANDWIDTH_BPS;\n\n        this._lastNLimitedByCpu = false;\n        this._receiveResolutionLimitedByCpu = false;\n\n        // The default receiver video constraints.\n        this._receiverVideoConstraints = {\n            assumedBandwidthBps: this._assumedBandwidthBps,\n            lastN: this._lastN\n        };\n    }\n\n    /**\n     * Returns a map of all the remote source names and the corresponding max frame heights.\n     *\n     * @param {JingleSessionPC} mediaSession - the media session.\n     * @param {number} maxFrameHeight - the height to be requested for remote sources.\n     * @returns\n     */\n    _getDefaultSourceReceiverConstraints(\n            mediaSession: JingleSessionPC,\n            maxFrameHeight?: number\n    ): Map<string, number> {\n        const height = maxFrameHeight ?? MAX_HEIGHT;\n        const remoteVideoTracks = mediaSession.peerconnection?.getRemoteTracks(null, MediaType.VIDEO) || [];\n        const receiverConstraints = new Map<string, number>();\n\n        for (const track of remoteVideoTracks) {\n            receiverConstraints.set(track.getSourceName(), height);\n        }\n\n        return receiverConstraints;\n    }\n\n    /**\n     * Updates the source based constraints based on the maxHeight set.\n     *\n     * @param {number} maxFrameHeight - the height to be requested for remote sources.\n     * @returns {void}\n     */\n    _updateIndividualConstraints(maxFrameHeight?: number): void {\n        const individualConstraints = this._receiverVideoConstraints.constraints;\n\n        if (individualConstraints && Object.keys(individualConstraints).length) {\n            for (const value of Object.values(individualConstraints)) {\n                value.maxHeight = maxFrameHeight ?? Math.min(value.maxHeight, this._maxFrameHeight);\n            }\n        } else {\n            this._receiverVideoConstraints.defaultConstraints = { 'maxHeight': this._maxFrameHeight };\n        }\n    }\n\n    /**\n     * Returns the last set of receiver constraints that were set on the bridge channel.\n     *\n     * @returns {IReceiverVideoConstraints}\n     */\n    getCurrentReceiverConstraints(): IReceiverVideoConstraints {\n        return this._receiverVideoConstraints;\n    }\n\n    /**\n     * Returns the lastN value for the conference.\n     *\n     * @returns {number}\n     */\n    getLastN(): number {\n        return this._lastN;\n    }\n\n    /**\n     * Checks whether last-n was lowered because of a cpu limitation.\n     *\n     * @returns {boolean}\n     */\n    isLastNLimitedByCpu(): boolean {\n        return this._lastNLimitedByCpu;\n    }\n\n    /**\n     * Handles the {@link JitsiConferenceEvents.MEDIA_SESSION_STARTED}, that is when the conference creates new media\n     * session. The preferred receive frameHeight is applied on the media session.\n     *\n     * @param {JingleSessionPC} mediaSession - the started media session.\n     * @returns {void}\n     */\n    onMediaSessionStarted(mediaSession: JingleSessionPC): void {\n        if (mediaSession.isP2P) {\n            mediaSession.setReceiverVideoConstraint(this._getDefaultSourceReceiverConstraints(mediaSession));\n        } else {\n            this._rtc.setReceiverVideoConstraints(this._receiverVideoConstraints);\n        }\n    }\n\n    /**\n     * Sets the assumed bandwidth bps the local participant should receive from remote participants.\n     *\n     * @param {number|undefined} assumedBandwidthBps - the new value.\n     * @returns {void}\n     */\n    setAssumedBandwidthBps(assumedBandwidthBps?: number): void {\n        if (this._receiverVideoConstraints.assumedBandwidthBps !== assumedBandwidthBps) {\n            this._receiverVideoConstraints.assumedBandwidthBps = assumedBandwidthBps;\n            this._rtc.setReceiverVideoConstraints(this._receiverVideoConstraints);\n        }\n    }\n\n    /**\n     * Selects a new value for \"lastN\". The requested amount of videos are going to be delivered after the value is\n     * in effect. Set to -1 for unlimited or all available videos.\n     *\n     * @param {number} value the new value for lastN.\n     * @returns {void}\n     */\n    setLastN(value: number): void {\n        if (this._lastN !== value) {\n            this._lastN = value;\n            this._receiverVideoConstraints.lastN = value;\n            this._rtc.setReceiverVideoConstraints(this._receiverVideoConstraints);\n        }\n    }\n\n    /**\n     * Updates the lastNLimitedByCpu field.\n     *\n     * @param {boolean} enabled\n     * @returns {void}\n     */\n    setLastNLimitedByCpu(enabled: boolean): void {\n        if (this._lastNLimitedByCpu !== enabled) {\n            this._lastNLimitedByCpu = enabled;\n            logger.info(`ReceiveVideoController - Setting the lastNLimitedByCpu flag to ${enabled}`);\n        }\n    }\n\n    /**\n     * Sets the maximum video resolution the local participant should receive from remote participants.\n     *\n     * @param {number|undefined} maxFrameHeight - the new value.\n     * @returns {void}\n     */\n    setPreferredReceiveMaxFrameHeight(maxFrameHeight?: number): void {\n        this._maxFrameHeight = maxFrameHeight;\n\n        for (const session of this._conference.getMediaSessions()) {\n            if (session.isP2P) {\n                session.setReceiverVideoConstraint(this._getDefaultSourceReceiverConstraints(session, maxFrameHeight));\n            } else {\n                this._updateIndividualConstraints(maxFrameHeight);\n                this._rtc.setReceiverVideoConstraints(this._receiverVideoConstraints);\n            }\n        }\n    }\n\n    /**\n     * Sets the receiver constraints for the conference.\n     *\n     * @param {IReceiverVideoConstraints} constraints The video constraints.\n     */\n    setReceiverConstraints(constraints: IReceiverVideoConstraints): void {\n        if (!constraints) {\n            return;\n        }\n\n        const constraintsChanged = !isEqual(this._receiverVideoConstraints, constraints);\n\n        if (constraintsChanged || this._lastNLimitedByCpu || this._receiveResolutionLimitedByCpu) {\n            this._receiverVideoConstraints = constraints;\n\n            this._assumedBandwidthBps = constraints.assumedBandwidthBps ?? this._assumedBandwidthBps;\n            this._lastN = typeof constraints.lastN !== 'undefined' && !this._lastNLimitedByCpu\n                ? constraints.lastN : this._lastN;\n            this._receiverVideoConstraints.lastN = this._lastN;\n            this._receiveResolutionLimitedByCpu && this._updateIndividualConstraints();\n\n            // Send the constraints on the bridge channel.\n            this._rtc.setReceiverVideoConstraints(this._receiverVideoConstraints);\n\n            const p2pSession = this._conference.getMediaSessions().find(session => session.isP2P);\n\n            if (!p2pSession || !this._receiverVideoConstraints.constraints) {\n                return;\n            }\n\n            const mappedConstraints: [string, number][] = Array.from(Object.entries(this._receiverVideoConstraints.constraints))\n                .map(([ key, value ]) => [ key, value.maxHeight ]);\n\n            this._sourceReceiverConstraints = new Map(mappedConstraints);\n\n            // Send the receiver constraints to the peer through a \"content-modify\" message.\n            p2pSession.setReceiverVideoConstraint(this._sourceReceiverConstraints);\n        }\n    }\n\n    /**\n     * Updates the receivedResolutioLimitedByCpu field.\n     *\n     * @param {boolean} enabled\n     * @return {void}\n     */\n    setReceiveResolutionLimitedByCpu(enabled: boolean): void {\n        if (this._receiveResolutionLimitedByCpu !== enabled) {\n            this._receiveResolutionLimitedByCpu = enabled;\n            logger.info(`ReceiveVideoController - Setting the receiveResolutionLimitedByCpu flag to ${enabled}`);\n        }\n    }\n}\n","import { getLogger } from '@jitsi/logger';\n\nimport JitsiConference from '../../JitsiConference';\nimport JingleSessionPC from '../xmpp/JingleSessionPC';\nimport { MediaSessionEvents } from '../xmpp/MediaSessionEvents';\n\nconst logger = getLogger('qc:SendVideoController');\nconst MAX_LOCAL_RESOLUTION = 2160;\n\nexport interface IVideoConstraint {\n    maxHeight: number;\n    sourceName: string;\n}\n\n/**\n * The class manages send video constraints across media sessions({@link JingleSessionPC}) which belong to\n * {@link JitsiConference}. It finds the lowest common value, between the local user's send preference and\n * the remote party's receive preference. Also this module will consider only the active session's receive value,\n * because local tracks are shared and while JVB may have no preference, the remote p2p may have and they may be totally\n * different.\n */\nexport default class SendVideoController {\n    private _conference: JitsiConference;\n    private _preferredSendMaxFrameHeight: number;\n    /**\n     * Source name based sender constraints.\n     * @type {Map<string, number>};\n     */\n    private _sourceSenderConstraints: Map<string, number>;\n\n    /**\n     * Creates new instance for a given conference.\n     *\n     * @param {JitsiConference} conference - the conference instance for which the new instance will be managing\n     * the send video quality constraints.\n     */\n    constructor(conference: JitsiConference) {\n        this._conference = conference;\n        this._preferredSendMaxFrameHeight = MAX_LOCAL_RESOLUTION;\n\n        /**\n         * Source name based sender constraints.\n         * @type {Map<string, number>};\n         */\n        this._sourceSenderConstraints = new Map();\n    }\n\n    /**\n     * Figures out the send video constraint as specified by {@link _selectSendMaxFrameHeight} and sets it on all media\n     * sessions for the reasons mentioned in this class description.\n     *\n     * @param {string} sourceName - The source for which sender constraints have changed.\n     * @returns {Promise<void>}\n     * @private\n     */\n    async _propagateSendMaxFrameHeight(sourceName: string): Promise<void> {\n        if (!sourceName) {\n            throw new Error('sourceName missing for calculating the sendMaxHeight for video tracks');\n        }\n        const sendMaxFrameHeight = this._selectSendMaxFrameHeight(sourceName);\n        const promises = [];\n\n        if (sendMaxFrameHeight !== undefined && sendMaxFrameHeight >= 0) {\n            for (const session of this._conference.getMediaSessions()) {\n                promises.push(session.setSenderVideoConstraint(sendMaxFrameHeight, sourceName));\n            }\n        }\n\n        await Promise.all(promises);\n    }\n\n    /**\n     * Selects the lowest common value for the local video send constraint by looking at local user's preference and\n     * the active media session's receive preference set by the remote party.\n     *\n     * @param {string} sourceName - The source for which sender constraints have changed.\n     * @returns {Optional<number>}\n     * @private\n     */\n    _selectSendMaxFrameHeight(sourceName: string): Optional<number> {\n        if (!sourceName) {\n            throw new Error('sourceName missing for calculating the sendMaxHeight for video tracks');\n        }\n        const activeMediaSession = this._conference.getActiveMediaSession();\n        const remoteRecvMaxFrameHeight = activeMediaSession\n            ? this._sourceSenderConstraints.get(sourceName)\n            : undefined;\n\n        if (this._preferredSendMaxFrameHeight >= 0 && remoteRecvMaxFrameHeight !== undefined && remoteRecvMaxFrameHeight >= 0) {\n            return Math.min(this._preferredSendMaxFrameHeight, remoteRecvMaxFrameHeight);\n        } else if (remoteRecvMaxFrameHeight !== undefined && remoteRecvMaxFrameHeight >= 0) {\n            return remoteRecvMaxFrameHeight;\n        }\n\n        return this._preferredSendMaxFrameHeight;\n    }\n\n    /**\n     * Configures the video encodings on the local sources when a media connection is established or becomes active.\n     *\n     * @returns {void}\n     */\n    configureConstraintsForLocalSources(): void {\n        for (const track of this._conference.getLocalVideoTracks()) {\n            const sourceName = track.getSourceName();\n\n            sourceName && this._propagateSendMaxFrameHeight(sourceName);\n        }\n    }\n\n    /**\n     * Handles the {@link JitsiConferenceEvents.MEDIA_SESSION_STARTED}, that is when the conference creates new media\n     * session. It doesn't mean it's already active though. For example the JVB connection may be created after\n     * the conference has entered the p2p mode already.\n     *\n     * @param {JingleSessionPC} mediaSession - the started media session.\n     */\n    onMediaSessionStarted(mediaSession: JingleSessionPC): void {\n        mediaSession.addListener(\n            MediaSessionEvents.REMOTE_SOURCE_CONSTRAINTS_CHANGED,\n            (session: JingleSessionPC, sourceConstraints: Array<IVideoConstraint>) => {\n                session === this._conference.getActiveMediaSession()\n                    && sourceConstraints.forEach(constraint => this.onSenderConstraintsReceived(constraint));\n            });\n    }\n\n    /**\n     * Propagates the video constraints if they have changed.\n     *\n     * @param {IVideoConstraint} videoConstraints - The sender video constraints received from the bridge.\n     * @returns {Promise<void>}\n     */\n    async onSenderConstraintsReceived(videoConstraints: IVideoConstraint): Promise<void> {\n        const { maxHeight, sourceName } = videoConstraints;\n        const localVideoTracks = this._conference.getLocalVideoTracks() ?? [];\n\n        for (const track of localVideoTracks) {\n            // Propagate the sender constraint only if it has changed.\n            if (track.getSourceName() === sourceName\n                && this._sourceSenderConstraints.get(sourceName) !== maxHeight) {\n                this._sourceSenderConstraints.set(\n                    sourceName,\n                    maxHeight === -1\n                        ? Math.min(MAX_LOCAL_RESOLUTION, this._preferredSendMaxFrameHeight)\n                        : maxHeight);\n                logger.debug(`Sender constraints for source:${sourceName} changed to maxHeight:${maxHeight}`);\n                await this._propagateSendMaxFrameHeight(sourceName);\n            }\n        }\n    }\n\n    /**\n     * Sets local preference for max send video frame height.\n     *\n     * @param {number} maxFrameHeight - the new value to set.\n     * @returns {Promise<void>} - resolved when the operation is complete.\n     */\n    async setPreferredSendMaxFrameHeight(maxFrameHeight: number): Promise<void> {\n        this._preferredSendMaxFrameHeight = maxFrameHeight;\n        const promises: Promise<void>[] = [];\n\n        for (const sourceName of this._sourceSenderConstraints.keys()) {\n            promises.push(this._propagateSendMaxFrameHeight(sourceName));\n        }\n\n        await Promise.allSettled(promises);\n    }\n}\n","import { getLogger } from '@jitsi/logger';\n\nimport JitsiConference from '../../JitsiConference';\nimport { JitsiConferenceEvents } from '../../JitsiConferenceEvents';\nimport { CodecMimeType } from '../../service/RTC/CodecMimeType';\nimport { RTCEvents } from '../../service/RTC/RTCEvents';\nimport {\n    DEFAULT_LAST_N,\n    LAST_N_UNLIMITED,\n    VIDEO_CODECS_BY_COMPLEXITY,\n    VIDEO_QUALITY_LEVELS\n} from '../../service/RTC/StandardVideoQualitySettings';\nimport JitsiLocalTrack from '../RTC/JitsiLocalTrack';\nimport TraceablePeerConnection from '../RTC/TraceablePeerConnection';\nimport RTCStats from '../RTCStats/RTCStats';\nimport { RTCStatsEvents } from '../RTCStats/RTCStatsEvents';\nimport { isValidNumber } from '../util/MathUtil';\nimport JingleSessionPC from '../xmpp/JingleSessionPC';\n\nimport { CodecSelection } from './CodecSelection';\nimport { ReceiverAudioController } from './ReceiveAudioController';\nimport ReceiveVideoController from './ReceiveVideoController';\nimport SendVideoController, { IVideoConstraint } from './SendVideoController';\n\n\nconst logger = getLogger('qc:QualityController');\n\n// Period for which the client will wait for the cpu limitation flag to be reset in the peerconnection stats before it\n// attempts to rectify the situation by attempting a codec switch.\nconst LIMITED_BY_CPU_TIMEOUT = 60000;\n\n// The min. value that lastN will be set to while trying to fix video qaulity issues.\nconst MIN_LAST_N = 3;\n\nenum QualityLimitationReason {\n    BANDWIDTH = 'bandwidth',\n    CPU = 'cpu',\n    NONE = 'none'\n}\n\ninterface IResolution {\n    height: number;\n    width: number;\n}\n\ninterface IOutboundRtpStats {\n    codec: CodecMimeType;\n    encodeTime: number;\n    qualityLimitationReason: QualityLimitationReason;\n    resolution: IResolution;\n    timestamp: number;\n}\n\nexport interface ISourceStats {\n    avgEncodeTime: number;\n    codec: CodecMimeType;\n    encodeResolution: number;\n    localTrack: JitsiLocalTrack;\n    qualityLimitationReason: QualityLimitationReason;\n    timestamp: number;\n    tpc: TraceablePeerConnection;\n}\n\ninterface ITrackStats {\n    encodeResolution: number;\n    encodeTime: number;\n    qualityLimitationReason: QualityLimitationReason;\n}\n\n/* eslint-disable require-jsdoc */\nexport class FixedSizeArray {\n    private _data: ISourceStats[];\n    private _maxSize: number;\n\n    constructor(size: number) {\n        this._maxSize = size;\n        this._data = [];\n    }\n\n    add(item: ISourceStats): void {\n        if (this._data.length >= this._maxSize) {\n            this._data.shift();\n        }\n        this._data.push(item);\n    }\n\n    get(index: number): Optional<ISourceStats> {\n        if (index < 0 || index >= this._data.length) {\n            throw new Error('Index out of bounds');\n        }\n\n        return this._data[index];\n    }\n\n    size(): number {\n        return this._data.length;\n    }\n}\n/* eslint-enable require-jsdoc */\n\n/**\n * QualityController class that is responsible for maintaining optimal video quality experience on the local endpoint\n * by controlling the codec, encode resolution and receive resolution of the remote video streams. It also makes\n * adjustments based on the outbound and inbound rtp stream stats reported by the underlying peer connection.\n */\nexport class QualityController {\n    private _audioController: ReceiverAudioController;\n    private _codecController: CodecSelection;\n    private _conference: JitsiConference;\n    private _enableAdaptiveMode: boolean;\n    private _encodeTimeStats: Map<number, FixedSizeArray>;\n    private _isLastNRampupBlocked: boolean;\n    private _lastNRampupTime: number;\n    private _lastNRampupTimeout: Optional<number>;\n    private _limitedByCpuTimeout: Optional<number>;\n    private _receiveVideoController: ReceiveVideoController;\n    private _sendVideoController: SendVideoController;\n    private _timer: Optional<number>;\n\n    /**\n     *\n     * @param {JitsiConference} conference - The JitsiConference instance.\n     * @param {Object} options - video quality settings passed through config.js.\n     */\n    constructor(conference: JitsiConference, options: {\n        enableAdaptiveMode: boolean;\n        jvb: object;\n        lastNRampupTime: number;\n        p2p: object;\n    }) {\n        this._audioController = new ReceiverAudioController(conference);\n        this._conference = conference;\n        const { jvb, p2p } = options;\n\n        this._codecController = new CodecSelection(conference, { jvb,\n            p2p });\n        this._enableAdaptiveMode = options.enableAdaptiveMode ?? true;\n        this._encodeTimeStats = new Map();\n        this._isLastNRampupBlocked = false;\n        this._lastNRampupTime = options.lastNRampupTime;\n        this._receiveVideoController = new ReceiveVideoController(conference);\n        this._sendVideoController = new SendVideoController(conference);\n\n        this._conference.on(\n            JitsiConferenceEvents._MEDIA_SESSION_STARTED,\n            (session: JingleSessionPC) => {\n                this._codecController.selectPreferredCodec(session);\n                this._receiveVideoController.onMediaSessionStarted(session);\n                this._sendVideoController.onMediaSessionStarted(session);\n            });\n        this._conference.on(\n                JitsiConferenceEvents._MEDIA_SESSION_ACTIVE_CHANGED,\n                () => this._sendVideoController.configureConstraintsForLocalSources());\n        this._conference.on(\n            JitsiConferenceEvents.CONFERENCE_VISITOR_CODECS_CHANGED,\n            (codecList: CodecMimeType[]) => this._codecController.updateVisitorCodecs(codecList));\n\n        // Debounce the calls to codec selection when there is a burst of joins and leaves.\n        const debouncedSelectCodec = this._debounce(\n            () => this._codecController.selectPreferredCodec(this._conference.jvbJingleSession),\n            1000);\n\n        this._conference.on(JitsiConferenceEvents.USER_JOINED, debouncedSelectCodec.bind(this));\n        this._conference.on(JitsiConferenceEvents.USER_LEFT, debouncedSelectCodec.bind(this));\n        this._conference.rtc.on(\n            RTCEvents.SENDER_VIDEO_CONSTRAINTS_CHANGED,\n            (videoConstraints: IVideoConstraint) =>\n                this._sendVideoController.onSenderConstraintsReceived(videoConstraints));\n        this._conference.on(\n            JitsiConferenceEvents.ENCODE_TIME_STATS_RECEIVED,\n            (tpc: TraceablePeerConnection, stats: Map<number, IOutboundRtpStats>) =>\n                this._processOutboundRtpStats(tpc, stats));\n    }\n\n    /**\n     * Creates a debounced function that delays the execution of the provided function until after the specified delay\n     * has elapsed. Unlike typical debounce implementations, the timer does not reset when the function is called again\n     * within the delay period.\n     *\n     * @param {Function} func - The function to be debounced.\n     * @param {number} delay - The delay in milliseconds.\n     * @returns {Function} - The debounced function.\n     */\n    _debounce(func: Function, delay: number) { // eslint-disable-line @typescript-eslint/no-unsafe-function-type\n        return function(...args: any) {\n            /* eslint-disable @typescript-eslint/no-invalid-this */\n            if (!this._timer) {\n                this._timer = setTimeout(() => {\n                    this._timer = null;\n                    func.apply(this, args);\n                }, delay);\n            }\n            /* eslint-enable @typescript-eslint/no-invalid-this */\n        };\n    }\n\n    /**\n     * Adjusts the lastN value so that fewer remote video sources are received from the bridge in an attempt to improve\n     * encode resolution of the outbound video streams based on cpuLimited parameter passed. If cpuLimited is false,\n     * the lastN value will slowly be ramped back up to the channelLastN value set in config.js.\n     *\n     * @param {boolean} cpuLimited - whether the endpoint is cpu limited or not.\n     * @returns boolean - Returns true if an action was taken, false otherwise.\n     */\n    _lowerOrRaiseLastN(cpuLimited: boolean): boolean {\n        const lastN = this.receiveVideoController.getLastN();\n        let newLastN = lastN;\n\n        if (cpuLimited && (lastN !== LAST_N_UNLIMITED && lastN <= MIN_LAST_N)) {\n            return false;\n        }\n\n        // If channelLastN is not set or set to -1 in config.js, the client will ramp up lastN to only up to 25.\n        let { channelLastN = DEFAULT_LAST_N } = this._conference.options.config;\n\n        channelLastN = channelLastN === LAST_N_UNLIMITED ? DEFAULT_LAST_N : channelLastN;\n        if (cpuLimited) {\n            const videoStreamsReceived = this._conference.getForwardedSources().length;\n\n            newLastN = Math.floor(videoStreamsReceived / 2);\n            if (newLastN < MIN_LAST_N) {\n                newLastN = MIN_LAST_N;\n            }\n\n        // Increment lastN by 1 every LAST_N_RAMPUP_TIME (60) secs.\n        } else if (lastN < channelLastN) {\n            newLastN++;\n        }\n\n        if (newLastN === lastN) {\n            return false;\n        }\n\n        const isStillLimitedByCpu = newLastN < channelLastN;\n\n        this.receiveVideoController.setLastNLimitedByCpu(isStillLimitedByCpu);\n        logger.info(`QualityController - setting lastN=${newLastN}, limitedByCpu=${isStillLimitedByCpu}`);\n        this.receiveVideoController.setLastN(newLastN);\n\n        return true;\n    }\n\n    /**\n     * Adjusts the requested resolution for remote video sources by updating the receiver constraints in an attempt to\n     * improve the encode resolution of the outbound video streams.\n     * @return {void}\n     */\n    _maybeLowerReceiveResolution(): void {\n        const currentConstraints = this.receiveVideoController.getCurrentReceiverConstraints();\n        const individualConstraints = currentConstraints.constraints;\n        let maxHeight = 0;\n\n        if (individualConstraints && Object.keys(individualConstraints).length) {\n            for (const value of Object.values(individualConstraints)) {\n                const v: any = value;\n\n                maxHeight = Math.max(maxHeight, v.maxHeight);\n            }\n        }\n\n        const currentLevel = VIDEO_QUALITY_LEVELS.findIndex(lvl => lvl.height <= maxHeight);\n\n        // Do not lower the resolution to less than 180p.\n        if (VIDEO_QUALITY_LEVELS[currentLevel].height === 180) {\n            return;\n        }\n\n        this.receiveVideoController.setPreferredReceiveMaxFrameHeight(VIDEO_QUALITY_LEVELS[currentLevel + 1].height);\n    }\n\n    /**\n     * Updates the codec preference order for the local endpoint on the active media session and switches the video\n     * codec if needed.\n     *\n     * @param {number} trackId - The track ID of the local video track for which stats have been captured.\n     * @returns {boolean} - Returns true if video codec was changed.\n     */\n    _maybeSwitchVideoCodec(trackId: number): boolean {\n        const stats = this._encodeTimeStats.get(trackId);\n        const { codec, encodeResolution, localTrack } = stats.get(stats.size() - 1);\n        const codecsByVideoType = VIDEO_CODECS_BY_COMPLEXITY[localTrack.getVideoType()];\n        const codecIndex = codecsByVideoType.findIndex(val => val === codec.toLowerCase());\n\n        // Do nothing if the encoder is using the lowest complexity codec already.\n        if (codecIndex === codecsByVideoType.length - 1) {\n            return false;\n        }\n\n        if (!this._limitedByCpuTimeout) {\n            this._limitedByCpuTimeout = window.setTimeout(() => {\n                this._limitedByCpuTimeout = undefined;\n                const updatedStats = this._encodeTimeStats.get(trackId);\n                const latestSourceStats: ISourceStats = updatedStats.get(updatedStats.size() - 1);\n                const expectedSendResolution\n                    = Math.min(localTrack.maxEnabledResolution, localTrack.getCaptureResolution());\n\n                // If the encoder is still limited by CPU, switch to a lower complexity codec.\n                if (latestSourceStats.qualityLimitationReason === QualityLimitationReason.CPU\n                        || encodeResolution < expectedSendResolution) {\n                    return this.codecController.changeCodecPreferenceOrder(localTrack, codec);\n                }\n            }, LIMITED_BY_CPU_TIMEOUT);\n        }\n\n        return false;\n    }\n\n    /**\n     * Adjusts codec, lastN or receive resolution based on the send resolution (of the outbound streams) and limitation\n     * reported by the browser in the WebRTC stats. Recovery is also attempted if the limitation goes away. No action\n     * is taken if the adaptive mode has been disabled through config.js.\n     *\n     * @param {ISourceStats} sourceStats - The outbound-rtp stats for a local video track.\n     * @returns {void}\n     */\n    _performQualityOptimizations(sourceStats: ISourceStats): void {\n        // Do not attempt run time adjustments if the adaptive mode is disabled.\n        if (!this._enableAdaptiveMode) {\n            return;\n        }\n        const { encodeResolution, localTrack, qualityLimitationReason, tpc } = sourceStats;\n\n        // Older browser versions might not report the resolution in the stats.\n        if (!isValidNumber(encodeResolution)) {\n            return;\n        }\n        const trackId = localTrack.rtcId;\n\n        if (encodeResolution === tpc.calculateExpectedSendResolution(localTrack)) {\n            if (this._limitedByCpuTimeout) {\n                window.clearTimeout(this._limitedByCpuTimeout);\n                this._limitedByCpuTimeout = undefined;\n            }\n\n            if (qualityLimitationReason === QualityLimitationReason.NONE\n                && this.receiveVideoController.isLastNLimitedByCpu()) {\n                if (!this._lastNRampupTimeout && !this._isLastNRampupBlocked) {\n                    RTCStats.sendStatsEntry(RTCStatsEvents.ENCODER_CPU_RESTRICTED_EVENT, null, false);\n\n                    // Ramp up the number of received videos if CPU limitation no longer exists. If the cpu\n                    // limitation returns as a consequence, do not attempt to ramp up again, continue to\n                    // increment the lastN value otherwise until it is equal to the channelLastN value.\n                    this._lastNRampupTimeout = window.setTimeout(() => {\n                        this._lastNRampupTimeout = undefined;\n                        const updatedStats = this._encodeTimeStats.get(trackId);\n                        const latestSourceStats: ISourceStats = updatedStats.get(updatedStats.size() - 1);\n\n                        if (latestSourceStats.qualityLimitationReason === QualityLimitationReason.CPU) {\n                            this._isLastNRampupBlocked = true;\n                        } else {\n                            this._lowerOrRaiseLastN(false /* raise */);\n                        }\n                    }, this._lastNRampupTime);\n                }\n            }\n\n            return;\n        }\n\n        // Do nothing if the limitation reason is bandwidth since the browser will dynamically adapt the outbound\n        // resolution based on available uplink bandwith. Otherwise,\n        // 1. Switch the codec to the lowest complexity one incrementally.\n        // 2. Switch to a lower lastN value, cutting the receive videos by half in every iteration until\n        // MIN_LAST_N value is reached.\n        // 3. Lower the receive resolution of individual streams up to 180p.\n        if (qualityLimitationReason === QualityLimitationReason.CPU) {\n            if (this._lastNRampupTimeout) {\n                window.clearTimeout(this._lastNRampupTimeout);\n                this._lastNRampupTimeout = undefined;\n                this._isLastNRampupBlocked = true;\n            }\n            RTCStats.sendStatsEntry(RTCStatsEvents.ENCODER_CPU_RESTRICTED_EVENT, null, true);\n            const codecSwitched = this._maybeSwitchVideoCodec(trackId);\n\n            if (!codecSwitched && !this._limitedByCpuTimeout) {\n                const lastNChanged = this._lowerOrRaiseLastN(true /* lower */);\n\n                if (!lastNChanged) {\n                    this.receiveVideoController.setReceiveResolutionLimitedByCpu(true);\n                    this._maybeLowerReceiveResolution();\n                }\n            }\n        }\n    }\n\n    /**\n     * Processes the outbound RTP stream stats as reported by the WebRTC peerconnection and makes runtime adjustments\n     * to the client for better quality experience if the adaptive mode is enabled.\n     *\n     * @param {TraceablePeerConnection} tpc - The underlying WebRTC peerconnection where stats have been captured.\n     * @param {Map<number, IOutboundRtpStats>} stats - Outbound-rtp stream stats per SSRC.\n     * @returns void\n     */\n    _processOutboundRtpStats(tpc: TraceablePeerConnection, stats: Map<number, IOutboundRtpStats>): void {\n        const activeSession = this._conference.getActiveMediaSession();\n\n        // Process stats only for the active media session.\n        if (activeSession.peerconnection !== tpc) {\n            return;\n        }\n\n        const statsPerTrack = new Map();\n\n        for (const ssrc of stats.keys()) {\n            const { codec, encodeTime, qualityLimitationReason, resolution, timestamp } = stats.get(ssrc);\n            const track = tpc.getTrackBySSRC(ssrc);\n            const trackId = track.rtcId;\n            let existingStats = statsPerTrack.get(trackId);\n            const encodeResolution = Math.min(resolution?.height, resolution?.width);\n            const ssrcStats = {\n                encodeResolution,\n                encodeTime,\n                qualityLimitationReason\n            };\n\n            if (existingStats) {\n                existingStats.codec = codec;\n                existingStats.timestamp = timestamp;\n                existingStats.trackStats.push(ssrcStats);\n            } else {\n                existingStats = {\n                    codec,\n                    timestamp,\n                    trackStats: [ ssrcStats ]\n                };\n\n                statsPerTrack.set(trackId, existingStats);\n            }\n        }\n\n        // Aggregate the stats for multiple simulcast streams with different SSRCs but for the same video stream.\n        for (const trackId of statsPerTrack.keys()) {\n            const { codec, timestamp, trackStats } = statsPerTrack.get(trackId);\n            const totalEncodeTime = trackStats\n                .map((stat: ITrackStats) => stat.encodeTime)\n                .reduce((totalValue: number, currentValue: number) => totalValue + currentValue, 0);\n            const avgEncodeTime: number = totalEncodeTime / trackStats.length;\n            const { qualityLimitationReason = QualityLimitationReason.NONE }\n                = trackStats\n                    .find((stat: ITrackStats) => stat.qualityLimitationReason !== QualityLimitationReason.NONE) ?? {};\n            const encodeResolution: number = trackStats\n                .map((stat: ITrackStats) => stat.encodeResolution)\n                .reduce((resolution: number, currentValue: number) => Math.max(resolution, currentValue), 0);\n            const localTrack = this._conference.getLocalVideoTracks().find(t => t.rtcId === trackId);\n\n            const exisitingStats: FixedSizeArray = this._encodeTimeStats.get(trackId);\n            const sourceStats = {\n                avgEncodeTime,\n                codec,\n                encodeResolution,\n                localTrack,\n                qualityLimitationReason,\n                timestamp,\n                tpc\n            };\n\n            if (exisitingStats) {\n                exisitingStats.add(sourceStats);\n            } else {\n                // Save stats for only the last 5 mins.\n                const data = new FixedSizeArray(300);\n\n                data.add(sourceStats);\n                this._encodeTimeStats.set(trackId, data);\n            }\n\n            logger.debug(`Encode stats for ${localTrack}: codec=${codec}, time=${avgEncodeTime},`\n                + `resolution=${encodeResolution}, qualityLimitationReason=${qualityLimitationReason}`);\n\n            this._performQualityOptimizations(sourceStats);\n        }\n    }\n\n    /**\n     * Gets the audio controller instance.\n     */\n    get audioController() {\n        return this._audioController;\n    }\n\n    /**\n     * Gets the codec controller instance.\n     */\n    get codecController() {\n        return this._codecController;\n    }\n\n    /**\n     * Gets the receive video controller instance.\n     */\n    get receiveVideoController() {\n        return this._receiveVideoController;\n    }\n\n    /**\n     * Gets the send video controller instance.\n     */\n    get sendVideoController() {\n        return this._sendVideoController;\n    }\n\n    /**\n     * Cleans up the QualityController by clearing all active timeouts and disposing of controllers.\n     * This prevents memory leaks and ensures proper cleanup when the controller is no longer needed.\n     */\n    dispose(): void {\n        // Clear all active timeouts to prevent memory leaks\n        if (this._timer) {\n            clearTimeout(this._timer);\n            this._timer = undefined;\n        }\n\n        if (this._limitedByCpuTimeout) {\n            clearTimeout(this._limitedByCpuTimeout);\n            this._limitedByCpuTimeout = undefined;\n        }\n\n        if (this._lastNRampupTimeout) {\n            clearTimeout(this._lastNRampupTimeout);\n            this._lastNRampupTimeout = undefined;\n        }\n\n        // Clear the encode time stats\n        this._encodeTimeStats.clear();\n\n        logger.info('QualityController disposed, all timeouts cleared');\n    }\n}\n","import { getLogger } from '@jitsi/logger';\nimport { $iq } from 'strophe.js';\n\nimport JitsiParticipant from '../../JitsiParticipant';\nimport { handleStropheError } from '../xmpp/StropheErrorHandler';\nimport XmppConnection from '../xmpp/XmppConnection';\n\nimport { getSessionIdFromIq } from './recordingXMLUtils';\n\nconst logger = getLogger('recording:JibriSession');\n\nexport interface IJibriSessionOptions {\n    connection?: XmppConnection;\n    focusMucJid?: string;\n    mode?: string;\n    sessionID?: string;\n    status?: string;\n}\n\nexport interface IStartOptions {\n    appData?: string;\n    broadcastId?: string;\n    focusMucJid: string;\n    streamId?: string;\n}\n\nexport interface IStopOptions {\n    focusMucJid: string;\n}\n\nexport interface IQOptions {\n    action?: 'start' | 'stop';\n    appData?: string;\n    broadcastId?: string;\n    focusMucJid: string;\n    streamId?: string;\n}\n\n/**\n * Represents a recording session.\n */\nexport default class JibriSession {\n    private _connection?: XmppConnection;\n    private _mode?: string;\n    private _jibriJid: Nullable<string> = null;\n    private _statusFromJicofo: string = '';\n    private _sessionID?: string;\n    private _status?: string;\n    private _error?: string;\n    private _liveStreamViewURL?: string;\n    private _initiator?: JitsiParticipant | string;\n    private _terminator?: JitsiParticipant | string;\n    private _focusMucJid?: string;\n\n    /**\n     * Initializes a new JibriSession instance.\n     *\n     * @constructor\n     */\n    constructor(options: IJibriSessionOptions = {}) {\n        this._connection = options.connection;\n        this._mode = options.mode;\n        this._jibriJid = null;\n        this._statusFromJicofo = '';\n        this._setSessionID(options.sessionID);\n        this.setStatus(options.status);\n        this._focusMucJid = options.focusMucJid;\n    }\n\n    /**\n     * Returns the error related to the session instance, if any.\n     *\n     * @returns {Optional<string>}\n     */\n    getError(): Optional<string> {\n        return this._error;\n    }\n\n    /**\n     * Returns the session ID of the session instance.\n     *\n     * @returns {Optional<string>}\n     */\n    getID(): Optional<string> {\n        return this._sessionID;\n    }\n\n    /**\n     * Returns the initiator of the session instance.\n     *\n     * @returns {JitsiParticipant|string} The participant that started the session.\n     */\n    getInitiator(): JitsiParticipant | string {\n        return this._initiator;\n    }\n\n    /**\n     * Returns the streaming URL of the session.\n     *\n     * @returns {Optional<string>}\n     */\n    getLiveStreamViewURL(): Optional<string> {\n        return this._liveStreamViewURL;\n    }\n\n    /**\n     * Returns the current status of the session.\n     *\n     * @returns {Optional<string>}\n     */\n    getStatus(): Optional<string> {\n        // If _status is not set fallback to the status reported by jicofo.\n        if (this._status) {\n            return this._status;\n        }\n\n        return this._statusFromJicofo;\n    }\n\n    /**\n     * @returns {Optional<string>}\n     */\n    getJibriJid(): Optional<string> {\n        return this._jibriJid;\n    }\n\n    /**\n     * Returns the jid of the participant that stopped the session.\n     *\n     * @returns {JitsiParticipant|string} The participant that stopped the session.\n     */\n    getTerminator(): JitsiParticipant | string {\n        return this._terminator;\n    }\n\n    /**\n     * Returns the current recording mode of the session, such as \"file\".\n     *\n     * @returns {string}\n     */\n    getMode(): string {\n        return this._mode;\n    }\n\n    /**\n     * Sets the last known error message related to the session.\n     *\n     * @param {string} error - The error string explaining why the session\n     * entered an error state.\n     * @returns {void}\n     */\n    setError(error: string): void {\n        this._error = error;\n    }\n\n    /**\n     * Sets the last live stream URL for the session instance. Usually this is\n     * a YouTube URL and usually this is only set for \"stream\" sessions.\n     *\n     * @param {string} url - The live stream URL associated with the session.\n     * @returns {void}\n     */\n    setLiveStreamViewURL(url: string): void {\n        this._liveStreamViewURL = url;\n    }\n\n    /**\n     * Sets the last known status for this recording session.\n     *\n     * @param {string} status - The new status to set.\n     * @returns {void}\n     */\n    setStatus(status?: string): void {\n        this._status = status;\n    }\n\n    /**\n     * Set the session status reported by jicofo. If a jibri is present in the room,\n     * the status is always 'on'. Otherwise, we fallback to the status reported by jicofo.\n     *\n     * @param {string} status\n     */\n    setStatusFromJicofo(status: string): void {\n        this._statusFromJicofo = status;\n    }\n\n    /**\n     * Set the JID of the jibri associated with this session.\n     *\n     * @param {*} jibriJid\n     */\n    setJibriJid(jibriJid: Nullable<string>): void {\n        this._jibriJid = jibriJid;\n    }\n\n    /**\n     * Sets the participant that started the session.\n     * @param {JitsiParticipant | string} participant - The participant or resource id\n     * if local participant.\n     */\n    setInitiator(participant: JitsiParticipant | string): void {\n        this._initiator = participant;\n    }\n\n    /**\n     * Sets the participant that stopped the session.\n     * @param {JitsiParticipant | string} participant - The participant or the resource id\n     * if local participant.\n     */\n    setTerminator(participant: JitsiParticipant | string): void {\n        this._terminator = participant;\n    }\n\n    /**\n     * Sends a message to start the actual recording.\n     *\n     * @param {Object} options - Additional arguments for starting therecording.\n     * @param {string} [options.appData] - Data specific to the app/service that the result file will be uploaded.\n     * @param {string} [options.broadcastId] - The broadcast ID of an associated YouTube stream, used for knowing the\n     * URL from which the stream can be viewed.\n     * @param {string} options.focusMucJid - The JID of the focus participant that controls recording.\n     * @param {streamId} options.streamId - Necessary for live streaming, this is the stream key needed to start a live\n     * streaming session with the streaming service provider.\n     * @returns Promise\n     */\n    start({ appData, broadcastId, focusMucJid, streamId }: IStartOptions): Promise<void> {\n        logger.info('Starting recording session');\n\n        return new Promise((resolve, reject) => {\n            this._connection?.sendIQ(\n                this._createIQ({\n                    action: 'start',\n                    appData,\n                    broadcastId,\n                    focusMucJid,\n                    streamId\n                }),\n                (result: any) => {\n                    this.setStatus('pending');\n                    this._setSessionID(\n                        getSessionIdFromIq(result)\n                    );\n\n                    resolve();\n                },\n                (error: any) => {\n                    this._setErrorFromIq(error);\n                    handleStropheError(error, {\n                        operation: 'start Jibri session request',\n                        userJid: this._connection?.jid,\n                    });\n\n                    reject(error);\n                }\n            );\n        });\n    }\n\n    /**\n     * Sends a message to actually stop the recording session.\n     *\n     * @param {Object} options - Additional arguments for stopping the recording.\n     * @param {Object} options.focusMucJid - The JID of the focus participant that controls recording.\n     * @returns Promise\n     */\n    stop({ focusMucJid }: IStopOptions): Promise<any> {\n        logger.info('Stopping recording session');\n\n        return new Promise((resolve, reject) => {\n            this._connection?.sendIQ(\n                this._createIQ({\n                    action: 'stop',\n                    focusMucJid\n                }),\n                resolve,\n                (error: any) => {\n                    handleStropheError(error, {\n                        operation: 'stop Jibri session request',\n                        userJid: this._connection?.jid\n                    });\n                    reject(error);\n                }\n            );\n        });\n    }\n\n    /**\n     * Generates the message to change the status of the recording session.\n     *\n     * @param {string} [options.action] - The action to set the IQ\n     * @param {string} [options.appData] - Data specific to the app/service that\n     * the result file will be uploaded.\n     * @param {string} [options.broadcastId] - The broadcast ID of an\n     * associated YouTube stream, used for knowing the URL from which the stream\n     * can be viewed.\n     * @param {string} options.focusMucJid - The JID of the focus participant\n     * that controls recording.\n     * @param {streamId} options.streamId - Necessary for live streaming, this\n     * is the stream key needed to start a live streaming session with the\n     * streaming service provider.\n     * @returns Object - The XMPP IQ message.\n     */\n    _createIQ({ action, appData, broadcastId, focusMucJid, streamId }: IQOptions) {\n        return $iq({\n            to: focusMucJid,\n            type: 'set'\n        })\n        .c('jibri', {\n            'action': action,\n            'app_data': appData,\n            'recording_mode': this._mode,\n            'streamid': streamId,\n            'xmlns': 'http://jitsi.org/protocol/jibri',\n            'you_tube_broadcast_id': broadcastId\n        })\n        .up();\n    }\n\n    /**\n     * Handles the error from an iq and stores the error.\n     *\n     * @param {Node} errorIq - The error response from an Iq.\n     * @private\n     * @returns {void}\n     */\n    _setErrorFromIq(errorIq: any): void {\n        let error;\n\n        if (errorIq) {\n            if (typeof errorIq === 'string') {\n                error = errorIq;\n            } else if (errorIq.nodeType === 1) {\n                const errors = errorIq.getElementsByTagName('error');\n\n                if (errors?.length > 0) {\n                    const errorChildren = errors[0].children;\n\n                    error = errorChildren?.length > 0 ? errorChildren[0].tagName : undefined;\n                }\n            }\n        } else {\n            error = 'timeout';\n        }\n\n        this.setError(error ?? 'unknown');\n    }\n\n    /**\n     * Sets the known session ID for this recording session.\n     *\n     * @param {string} sessionID\n     * @private\n     * @returns {void}\n     */\n    _setSessionID(sessionID?: string): void {\n        this._sessionID = sessionID;\n    }\n}\n","/**\n * A collection of utility functions for taking in XML and parsing it to return\n * certain values.\n */\n\nexport interface IFocusRecordingUpdate {\n    error?: string;\n    initiator?: string;\n    recordingMode?: string;\n    sessionID?: string;\n    status?: string;\n}\n\nexport interface IHiddenDomainUpdate {\n    liveStreamViewURL?: string;\n    mode?: string;\n    sessionID?: string;\n}\n\n/**\n * Parses the presence update of the focus and returns an object with the\n * statuses related to recording.\n *\n * @param {Element} presence - An XMPP presence update.\n * @returns {Optional<Object>} The current presence values related to recording.\n */\nexport function getFocusRecordingUpdate(presence: Element): Optional<IFocusRecordingUpdate> {\n    const jibriStatus = presence?.getElementsByTagName('jibri-recording-status')[0];\n\n    if (!jibriStatus) {\n        return;\n    }\n\n    return {\n        error: jibriStatus.getAttribute('failure_reason'),\n        initiator: jibriStatus.getAttribute('initiator'),\n        recordingMode: jibriStatus.getAttribute('recording_mode'),\n        sessionID: jibriStatus.getAttribute('session_id'),\n        status: jibriStatus.getAttribute('status')\n    };\n}\n\n/**\n * Parses the presence update from a hidden domain participant and returns\n * an object with the statuses related to recording.\n *\n * @param {Element} presence - An XMPP presence update.\n * @returns {Object} The current presence values related to recording.\n */\nexport function getHiddenDomainUpdate(presence: Element): IHiddenDomainUpdate {\n    const liveStreamViewURL = presence.getElementsByTagName('live-stream-view-url')[0]?.textContent;\n    const mode = presence.getElementsByTagName('mode')[0]?.textContent?.toLowerCase();\n    const sessionID = presence.getElementsByTagName('session_id')[0]?.textContent;\n\n    return {\n        liveStreamViewURL,\n        mode,\n        sessionID\n    };\n}\n\n/**\n * Returns the recording session ID from a successful IQ.\n *\n * @param {Element} response - The response from the IQ.\n * @returns {string} The session ID of the recording session.\n */\nexport function getSessionIdFromIq(response: Element): Nullable<string> {\n    return response?.getElementsByTagName('jibri')[0]?.getAttribute('session_id') ?? null;\n}\n\n/**\n * Returns the recording session ID from a presence, if it exists.\n *\n * @param {Element} presence - An XMPP presence update.\n * @returns {string|null|undefined} The session ID of the recording session.\n */\nexport function getSessionId(presence: Element): Optional<Nullable<string>> {\n    return presence.getElementsByTagName('session_id')[0]?.textContent;\n}\n\n/**\n * Returns whether or not a presence is from the focus.\n *\n * @param {Element} presence - An XMPP presence update.\n * @returns {boolean} True if the presence is from the focus.\n */\nexport function isFromFocus(presence: Element): boolean {\n    return presence.getAttribute('from')?.includes('focus') ?? false;\n}\n","import { getLogger } from '@jitsi/logger';\n\nimport { XMPPEvents } from '../../service/xmpp/XMPPEvents';\nimport ChatRoom from '../xmpp/ChatRoom';\n\nimport JibriSession from './JibriSession';\nimport { getFocusRecordingUpdate, getHiddenDomainUpdate, isFromFocus } from './recordingXMLUtils';\n\nconst logger = getLogger('recording:RecordingManager');\n\nexport interface IRecordingOptions {\n    appData?: string;\n    broadcastId?: string;\n    mode: string;\n    streamId?: string;\n}\n\n/**\n * A class responsible for starting and stopping recording sessions and emitting\n * state updates for them.\n */\nclass RecordingManager {\n    private _sessions: { [key: string]: JibriSession; } = {};\n    private _chatRoom: ChatRoom;\n\n    /**\n     * Initialize {@code RecordingManager} with other objects that are necessary\n     * for starting a recording.\n     *\n     * @param {ChatRoom} chatRoom - The chat room to handle.\n     * @returns {void}\n     */\n    constructor(chatRoom: ChatRoom) {\n        /**\n         * All known recording sessions from the current conference.\n         */\n        this._chatRoom = chatRoom;\n\n        this.onPresence = this.onPresence.bind(this);\n\n        this.onMemberLeft = this.onMemberLeft.bind(this);\n\n        this._chatRoom.eventEmitter.addListener(\n            XMPPEvents.PRESENCE_RECEIVED, this.onPresence);\n        this._chatRoom.eventEmitter.addListener(\n            XMPPEvents.MUC_MEMBER_LEFT, this.onMemberLeft);\n    }\n\n    /**\n     * Finds an existing recording session by session ID.\n     *\n     * @param {string} sessionID - The session ID associated with the recording.\n     * @returns {Optional<JibriSession>}\n     */\n    getSession(sessionID: string): Optional<JibriSession> {\n        return this._sessions[sessionID];\n    }\n\n    /**\n     * Find a session with a specific jibri JID.\n     *\n     * @param {string} jibriJid the JID to search for.\n     * @returns\n     */\n    getSessionByJibriJid(jibriJid: string): Optional<JibriSession> {\n        let s: Optional<JibriSession>;\n\n        Object.values(this._sessions).forEach(session => {\n            if (session.getJibriJid() === jibriJid) {\n                s = session;\n            }\n        });\n\n        return s;\n    }\n\n    /**\n     * Callback to invoke to parse through a presence update to find recording\n     * related updates (from Jibri participant doing the recording and the\n     * focus which controls recording).\n     *\n     * @param {Object} event - The presence data from the pubsub event.\n     * @param {Element} event.presence - An XMPP presence update.\n     * @param {boolean} event.fromHiddenDomain - Whether or not the update comes\n     * from a participant that is trusted but not visible, as would be the case\n     * with the Jibri recorder participant.\n     * @returns {void}\n     */\n    onPresence({ fromHiddenDomain, presence }: { fromHiddenDomain: boolean; presence: Element; }): void {\n        if (isFromFocus(presence)) {\n            this._handleFocusPresence(presence);\n        } else if (fromHiddenDomain) {\n            this._handleJibriPresence(presence);\n        }\n    }\n\n    /**\n     * Handle a participant leaving the room.\n     * @param {string} jid the JID of the participant that left.\n     */\n    onMemberLeft(jid: string): void {\n        const session = this.getSessionByJibriJid(jid);\n\n        if (session) {\n\n            const prevStatus = session.getStatus();\n\n            // Setting to ''\n            session.setStatus('');\n            session.setJibriJid(null);\n\n            if (session.getStatus() !== prevStatus) {\n                this._emitSessionUpdate(session);\n            }\n        }\n    }\n\n    /**\n     * Start a recording session.\n     *\n     * @param {Object} options - Configuration for the recording.\n     * @param {string} [options.appData] - Data specific to the app/service that\n     * the result file will be uploaded.\n     * @param {string} [optional] options.broadcastId - The channel on which a\n     * live stream will occur.\n     * @param {string} options.mode - The mode in which recording should be\n     * started. Recognized values are \"file\" and \"stream\".\n     * @param {string} [optional] options.streamId - The stream key to be used\n     * for live stream broadcasting. Required for live streaming.\n     * @returns {Promise} A promise for starting a recording, which will pass\n     * back the session on success. The promise resolves after receiving an\n     * acknowledgment of the start request success or fail.\n     */\n    startRecording(options: IRecordingOptions): Promise<JibriSession> {\n        const session = new JibriSession({\n            ...options,\n            connection: this._chatRoom.connection\n        });\n\n        return session.start({\n            appData: options.appData,\n            broadcastId: options.broadcastId,\n            focusMucJid: this._chatRoom.focusMucJid,\n            streamId: options.streamId\n        })\n            .then(() => {\n                // Only store the session and emit if the session has not been\n                // added already. This is a workaround for the session getting\n                // created due to a presence update to announce a \"pending\"\n                // recording being received before JibriSession#start finishes.\n                if (!this.getSession(session.getID())) {\n                    this._addSession(session);\n                    this._emitSessionUpdate(session);\n                }\n\n                return session;\n            })\n            .catch(error => {\n                this._emitSessionUpdate(session);\n\n                return Promise.reject(error);\n            });\n    }\n\n    /**\n     * Stop a recording session.\n     *\n     * @param {string} sessionID - The ID associated with the recording session\n     * to be stopped.\n     * @returns {Promise} The promise resolves after receiving an\n     * acknowledgment of the stop request success or fail.\n     */\n    stopRecording(sessionID: string): Promise<any> {\n        const session = this.getSession(sessionID);\n\n        if (session) {\n            return session.stop({ focusMucJid: this._chatRoom.focusMucJid });\n        }\n\n        return Promise.reject(new Error('Could not find session'));\n    }\n\n    /**\n     * Stores a reference to the passed in JibriSession.\n     *\n     * @param {string} session - The JibriSession instance to store.\n     * @returns {void}\n     */\n    _addSession(session: JibriSession): void {\n        this._sessions[session.getID()] = session;\n    }\n\n    /**\n     * Create a new instance of a recording session and stores a reference to\n     * it.\n     *\n     * @param {string} sessionID - The session ID of the recording in progress.\n     * @param {string} status - The current status of the recording session.\n     * @param {string} mode - The recording mode of the session.\n     * @returns {JibriSession}\n     */\n    _createSession(sessionID: string, status: string, mode: string): JibriSession {\n        const session = new JibriSession({\n            connection: this._chatRoom.connection,\n            focusMucJid: this._chatRoom.focusMucJid,\n            mode,\n            sessionID,\n            status\n        });\n\n        this._addSession(session);\n\n        return session;\n    }\n\n    /**\n     * Notifies listeners of an update to a recording session.\n     *\n     * @param {JibriSession} session - The session that has been updated.\n     * @param {string|undefined} initiator - The jid of the initiator of the update.\n     */\n    _emitSessionUpdate(session: JibriSession, initiator?: string): void {\n        this._chatRoom.eventEmitter.emit(\n            XMPPEvents.RECORDER_STATE_CHANGED, session, initiator);\n    }\n\n    /**\n     * Parses presence to update an existing JibriSession or to create a new\n     * JibriSession.\n     *\n     * @param {Element} presence - An XMPP presence update.\n     * @returns {void}\n     */\n    _handleFocusPresence(presence: Element): void {\n        const jibriStatus = getFocusRecordingUpdate(presence);\n\n        if (!jibriStatus) {\n            return;\n        }\n\n        const { error, initiator, recordingMode, sessionID, status } = jibriStatus;\n\n        // We'll look for an existing session or create one (in case we're a\n        // participant joining a call with an existing recording going on).\n        let session = this.getSession(sessionID);\n\n        // Handle the case where a status update is received in presence but\n        // the local participant has joined while the JibriSession has already\n        // ended.\n        if (!session && status === 'off') {\n            logger.warn(\n                'Ignoring recording presence update',\n                'Received a new session with status off.');\n\n            return;\n        }\n\n        // Jicofo sends updates via presence, and any extension in presence\n        // is sent until it is explicitly removed.  It's difficult for\n        // Jicofo to know when a presence has been sent once, so it won't\n        // remove jibri status extension.  This means we may receive the same\n        // status update more than once, so check for that here\n        if (session\n            && session.getStatus() === status\n            && session.getError() === error) {\n            logger.warn('Ignoring duplicate presence update: ',\n                JSON.stringify(jibriStatus));\n\n            return;\n        }\n\n        if (!session) {\n            session = this._createSession(sessionID, status, recordingMode);\n        }\n\n        session.setStatusFromJicofo(status);\n\n        if (this._chatRoom.role === 'visitor') {\n            // visitors will not receive presence updates from jibri, so we handle their status here\n            session.setStatus(status);\n        }\n\n        if (error) {\n            session.setError(error);\n        }\n\n        this._emitSessionUpdate(session, initiator);\n    }\n\n    /**\n     * Handles updates from the Jibri which can broadcast a YouTube URL that\n     * needs to be updated in a JibriSession.\n     *\n     * @param {Element} presence - An XMPP presence update.\n     * @returns {void}\n     */\n    _handleJibriPresence(presence: Element): void {\n        const { liveStreamViewURL, mode, sessionID }\n            = getHiddenDomainUpdate(presence);\n\n        if (!sessionID) {\n            logger.warn(\n                'Ignoring potential jibri presence due to no session id.');\n\n            return;\n        }\n\n        let session = this.getSession(sessionID);\n\n        if (!session) {\n            session = this._createSession(sessionID, 'on', mode);\n        }\n\n        // When a jibri is present the status is always 'on';\n        session.setStatus('on');\n        session.setJibriJid(presence.getAttribute('from'));\n        session.setLiveStreamViewURL(liveStreamViewURL);\n\n        this._emitSessionUpdate(session);\n    }\n}\n\nexport default RecordingManager;\n","import { getLogger } from '@jitsi/logger';\nimport { isEqual } from 'lodash-es';\n\nimport JitsiConference from '../../JitsiConference';\nimport { JitsiConferenceEvents as ConferenceEvents } from '../../JitsiConferenceEvents';\nimport JitsiParticipant from '../../JitsiParticipant';\nimport { MediaType } from '../../service/RTC/MediaType';\nimport { VideoType } from '../../service/RTC/VideoType';\nimport { ConnectionQualityEvents } from '../../service/connectivity/ConnectionQualityEvents';\nimport {\n    createRtpStatsEvent,\n    createTransportStatsEvent\n} from '../../service/statistics/AnalyticsEvents';\nimport JitsiLocalTrack from '../RTC/JitsiLocalTrack';\nimport JitsiRemoteTrack from '../RTC/JitsiRemoteTrack';\nimport TraceablePeerConnection from '../RTC/TraceablePeerConnection';\nimport browser from '../browser';\nimport { isValidNumber } from '../util/MathUtil';\nimport JingleSession from '../xmpp/JingleSession';\n\nimport Statistics from './statistics';\n\nconst logger = getLogger('stats:AvgRTPStatsReporter');\n\n/**\n * This will calculate an average for one, named stat and submit it to\n * the analytics module when requested. It automatically counts the samples.\n */\nclass AverageStatReport {\n    private _name: string;\n    private _count: number;\n    private _sum: number;\n    private _samples: number[];\n\n    /**\n     * Creates new <tt>AverageStatReport</tt> for given name.\n     * @param {string} name that's the name of the event that will be reported\n     * to the analytics module.\n     */\n    constructor(name: string) {\n        this._name = name;\n        this._count = 0;\n        this._sum = 0;\n        this._samples = [];\n    }\n\n    /**\n     * Adds the next value that will be included in the average when\n     * {@link calculate} is called.\n     * @param {Optional<number>} nextValue\n     */\n    addNext(nextValue: Optional<number>): void {\n        if (typeof nextValue === 'undefined') {\n            return;\n        }\n\n        if (typeof nextValue !== 'number') {\n            logger.error(`${this._name} - invalid value for idx: ${this._count}`, nextValue);\n        } else if (isValidNumber(nextValue)) {\n            this._sum += nextValue;\n            this._samples.push(nextValue);\n            this._count += 1;\n        }\n    }\n\n    /**\n     * Calculates an average for the samples collected using {@link addNext}.\n     * @return {number|NaN} an average of all collected samples or <tt>NaN</tt>\n     * if no samples were collected.\n     */\n    calculate(): number {\n        return this._count === 0 ? NaN : this._sum / this._count;\n    }\n\n    /**\n     * Appends the report to the analytics \"data\" object. The object will be\n     * set under <tt>prefix</tt> + {@link this.name} key.\n     * @param {Object} report the analytics \"data\" object\n     */\n    appendReport(report: Record<string, unknown>): void {\n        report[`${this._name}_avg`] = this.calculate();\n        report[`${this._name}_samples`] = JSON.stringify(this._samples);\n    }\n\n    /**\n     * Clears all memory of any samples collected, so that new average can be\n     * calculated using this instance.\n     */\n    reset(): void {\n        this._samples = [];\n        this._sum = 0;\n        this._count = 0;\n    }\n}\n\n/**\n * Class gathers the stats that are calculated and reported for a\n * {@link TraceablePeerConnection} even if it's not currently active. For\n * example we want to monitor RTT for the JVB connection while in P2P mode.\n */\nclass ConnectionAvgStats {\n    private _n: number;\n    private _sampleIdx: number;\n    private _avgRTT: AverageStatReport;\n    private _avgRemoteRTTMap: Map<string, AverageStatReport>;\n    private _avgRtpStatsReporter: AvgRTPStatsReporter;\n    private _avgEnd2EndRTT: Optional<number>;\n    private _onConnectionStats: (tpc: TraceablePeerConnection) => void;\n    private _onUserLeft?: (id: string) => void;\n    private _onRemoteStatsUpdated?: (id: string, data: any) => void;\n    public isP2P: boolean;\n\n    /**\n     * Creates new <tt>ConnectionAvgStats</tt>\n     * @param {AvgRTPStatsReporter} avgRtpStatsReporter\n     * @param {boolean} isP2P\n     * @param {number} n the number of samples, before arithmetic mean is to be\n     * calculated and values submitted to the analytics module.\n     */\n    constructor(avgRtpStatsReporter: AvgRTPStatsReporter, isP2P: boolean, n: number) {\n        /**\n         * Is this instance for JVB or P2P connection ?\n         * @type {boolean}\n         */\n        this.isP2P = isP2P;\n\n        /**\n         * How many samples are to be included in arithmetic mean calculation.\n         * @type {number}\n         * @private\n         */\n        this._n = n;\n\n        /**\n         * The current sample index. Starts from 0 and goes up to {@link _n})\n         * when analytics report will be submitted.\n         * @type {number}\n         * @private\n         */\n        this._sampleIdx = 0;\n\n        /**\n         * Average round trip time reported by the ICE candidate pair.\n         * @type {AverageStatReport}\n         */\n        this._avgRTT = new AverageStatReport('rtt');\n\n        /**\n         * Map stores average RTT to the JVB reported by remote participants.\n         * Mapped per participant id {@link JitsiParticipant.getId}.\n         *\n         * This is used only when {@link ConnectionAvgStats.isP2P} equals to\n         * <tt>false</tt>.\n         *\n         * @type {Map<string,AverageStatReport>}\n         * @private\n         */\n        this._avgRemoteRTTMap = new Map();\n\n        /**\n         * The conference for which stats will be collected and reported.\n         * @type {JitsiConference}\n         * @private\n         */\n        this._avgRtpStatsReporter = avgRtpStatsReporter;\n\n        /**\n         * The latest average E2E RTT for the JVB connection only.\n         *\n         * This is used only when {@link ConnectionAvgStats.isP2P} equals to\n         * <tt>false</tt>.\n         *\n         * @type {number}\n         */\n        this._avgEnd2EndRTT = undefined;\n\n        this._onConnectionStats = (tpc: TraceablePeerConnection) => {\n            if (this.isP2P === tpc.isP2P) {\n                this._calculateAvgStats(tpc.getStats());\n            }\n        };\n\n        const conference = avgRtpStatsReporter._conference;\n\n        conference.statistics.addConnectionStatsListener(\n            this._onConnectionStats);\n\n        if (!this.isP2P) {\n            this._onUserLeft = (id: string) => this._avgRemoteRTTMap.delete(id);\n            conference.on(ConferenceEvents.USER_LEFT, this._onUserLeft);\n\n            this._onRemoteStatsUpdated\n                = (id: string, data: any) => this._processRemoteStats(id, data);\n            conference.on(\n                ConnectionQualityEvents.REMOTE_STATS_UPDATED,\n                this._onRemoteStatsUpdated);\n        }\n    }\n\n    /**\n     * Processes next batch of stats.\n     * @param {go figure} data\n     * @private\n     */\n    private _calculateAvgStats(data: any): void {\n        if (!data) {\n            logger.error('No stats');\n\n            return;\n        }\n\n        if (browser.supportsRTTStatistics()) {\n            if (data.transport?.length) {\n                this._avgRTT.addNext(data.transport[0].rtt);\n            }\n        }\n\n        this._sampleIdx += 1;\n\n        if (this._sampleIdx >= this._n) {\n            if (browser.supportsRTTStatistics()) {\n                const conference = this._avgRtpStatsReporter._conference;\n\n                const batchReport: Record<string, unknown> = {\n                    'conference_size': conference.getParticipantCount(),\n                    p2p: this.isP2P\n                };\n\n                if (data.transport?.length) {\n                    Object.assign(batchReport, {\n                        'local_candidate_type':\n                            data.transport[0].localCandidateType,\n                        'remote_candidate_type':\n                            data.transport[0].remoteCandidateType,\n                        'transport_type': data.transport[0].type\n                    });\n                }\n\n                this._avgRTT.appendReport(batchReport);\n\n                if (this.isP2P) {\n                    // Report RTT diff only for P2P.\n                    const jvbEnd2EndRTT = this\n                        ._avgRtpStatsReporter.jvbStatsMonitor._avgEnd2EndRTT;\n\n                    if (isValidNumber(jvbEnd2EndRTT)) {\n                        batchReport.rtt_diff\n                            = this._avgRTT.calculate() - jvbEnd2EndRTT;\n                    }\n                } else {\n                    // Report end to end RTT only for JVB.\n                    const avgRemoteRTT = this._calculateAvgRemoteRTT();\n                    const avgLocalRTT = this._avgRTT.calculate();\n\n                    this._avgEnd2EndRTT = avgLocalRTT + avgRemoteRTT;\n\n                    if (isValidNumber(avgLocalRTT) && isValidNumber(avgRemoteRTT)) {\n                        batchReport.end2end_rtt_avg = this._avgEnd2EndRTT;\n                    }\n                }\n\n                Statistics.sendAnalytics(createRtpStatsEvent(batchReport));\n            }\n\n            this._resetAvgStats();\n        }\n    }\n\n    /**\n     * Calculates arithmetic mean of all RTTs towards the JVB reported by\n     * participants.\n     * @return {number|NaN} NaN if not available (not enough data)\n     * @private\n     */\n    private _calculateAvgRemoteRTT(): number {\n        let count = 0, sum = 0;\n\n        // FIXME should we ignore RTT for participant\n        // who \"is having connectivity issues\" ?\n        for (const remoteAvg of this._avgRemoteRTTMap.values()) {\n            const avg = remoteAvg.calculate();\n\n            if (isValidNumber(avg)) {\n                sum += avg;\n                count += 1;\n                remoteAvg.reset();\n            }\n        }\n\n        return count === 0 ? NaN : sum / count;\n    }\n\n    /**\n     * Processes {@link ConnectionQualityEvents.REMOTE_STATS_UPDATED} to analyse\n     * RTT towards the JVB reported by each participant.\n     * @param {string} id {@link JitsiParticipant.getId}\n     * @param {go figure in ConnectionQuality.js} data\n     * @private\n     */\n    private _processRemoteStats(id: string, data: any): void {\n        const validData = typeof data.jvbRTT === 'number';\n        let rttAvg = this._avgRemoteRTTMap.get(id);\n\n        if (!rttAvg && validData) {\n            rttAvg = new AverageStatReport(`${id}_stat_rtt`);\n            this._avgRemoteRTTMap.set(id, rttAvg);\n        }\n\n        if (validData) {\n            rttAvg.addNext(data.jvbRTT);\n        } else if (rttAvg) {\n            this._avgRemoteRTTMap.delete(id);\n        }\n    }\n\n    /**\n     * Reset cache of all averages and {@link _sampleIdx}.\n     * @internal\n     */\n    _resetAvgStats(): void {\n        this._avgRTT.reset();\n        if (this._avgRemoteRTTMap) {\n            this._avgRemoteRTTMap.clear();\n        }\n        this._sampleIdx = 0;\n    }\n\n    /**\n     *\n     */\n    public dispose(): void {\n        const conference = this._avgRtpStatsReporter._conference;\n\n        conference.statistics.removeConnectionStatsListener(\n            this._onConnectionStats);\n        if (!this.isP2P) {\n            conference.off(\n                ConnectionQualityEvents.REMOTE_STATS_UPDATED,\n                this._onRemoteStatsUpdated);\n            conference.off(\n                ConferenceEvents.USER_LEFT,\n                this._onUserLeft);\n        }\n    }\n}\n\n/**\n * Reports average RTP statistics values (arithmetic mean) to the analytics\n * module for things like bit rate, bandwidth, packet loss etc. It keeps track\n * of the P2P vs JVB conference modes and submits the values under different\n * namespaces (the events for P2P mode have 'p2p.' prefix). Every switch between\n * P2P mode resets the data collected so far and averages are calculated from\n * scratch.\n */\nexport default class AvgRTPStatsReporter {\n    _n: number;\n    _sampleIdx: number;\n    _conference: JitsiConference;\n    _avgAudioBitrateUp: AverageStatReport;\n    _avgAudioBitrateDown: AverageStatReport;\n    _avgVideoBitrateUp: AverageStatReport;\n    _avgVideoBitrateDown: AverageStatReport;\n    _avgBandwidthUp: AverageStatReport;\n    _avgBandwidthDown: AverageStatReport;\n    _avgPacketLossTotal: AverageStatReport;\n    _avgPacketLossUp: AverageStatReport;\n    _avgPacketLossDown: AverageStatReport;\n    _avgRemoteFPS: AverageStatReport;\n    _avgRemoteScreenFPS: AverageStatReport;\n    _avgLocalFPS: AverageStatReport;\n    _avgLocalScreenFPS: AverageStatReport;\n    _avgRemoteCameraPixels: AverageStatReport;\n    _avgRemoteScreenPixels: AverageStatReport;\n    _avgLocalCameraPixels: AverageStatReport;\n    _avgLocalScreenPixels: AverageStatReport;\n    _avgCQ: AverageStatReport;\n    _cachedTransportStats: Optional<Record<string, unknown>>;\n    _onLocalStatsUpdated: (data: any) => void;\n    _onP2PStatusChanged: () => void;\n    _onJvb121StatusChanged: (activeSession: JingleSession) => void;\n    jvbStatsMonitor: ConnectionAvgStats;\n    p2pStatsMonitor: ConnectionAvgStats;\n\n    /**\n     * Creates new instance of <tt>AvgRTPStatsReporter</tt>\n     * @param {JitsiConference} conference\n     * @param {number} n the number of samples, before arithmetic mean is to be\n     * calculated and values submitted to the analytics module.\n     */\n    constructor(conference: JitsiConference, n: number) {\n        /**\n         * How many {@link ConnectionQualityEvents.LOCAL_STATS_UPDATED} samples\n         * are to be included in arithmetic mean calculation.\n         * @type {number}\n         * @private\n         */\n        this._n = n;\n\n        if (n > 0) {\n            logger.info(`Avg RTP stats will be calculated every ${n} samples`);\n        } else {\n            logger.info('Avg RTP stats reports are disabled.');\n\n            // Do not initialize\n            return;\n        }\n\n        /**\n         * The current sample index. Starts from 0 and goes up to {@link _n})\n         * when analytics report will be submitted.\n         * @type {number}\n         * @private\n         */\n        this._sampleIdx = 0;\n\n        /**\n         * The conference for which stats will be collected and reported.\n         * @type {JitsiConference}\n         * @private\n         */\n        this._conference = conference;\n\n        /**\n         * Average audio upload bitrate\n         * XXX What are the units?\n         * @type {AverageStatReport}\n         * @private\n         */\n        this._avgAudioBitrateUp\n            = new AverageStatReport('bitrate_audio_upload');\n\n        /**\n         * Average audio download bitrate\n         * XXX What are the units?\n         * @type {AverageStatReport}\n         * @private\n         */\n        this._avgAudioBitrateDown\n            = new AverageStatReport('bitrate_audio_download');\n\n        /**\n         * Average video upload bitrate\n         * XXX What are the units?\n         * @type {AverageStatReport}\n         * @private\n         */\n        this._avgVideoBitrateUp\n            = new AverageStatReport('bitrate_video_upload');\n\n        /**\n         * Average video download bitrate\n         * XXX What are the units?\n         * @type {AverageStatReport}\n         * @private\n         */\n        this._avgVideoBitrateDown\n            = new AverageStatReport('bitrate_video_download');\n\n        /**\n         * Average upload bandwidth\n         * XXX What are the units?\n         * @type {AverageStatReport}\n         * @private\n         */\n        this._avgBandwidthUp\n            = new AverageStatReport('bandwidth_upload');\n\n        /**\n         * Average download bandwidth\n         * XXX What are the units?\n         * @type {AverageStatReport}\n         * @private\n         */\n        this._avgBandwidthDown\n            = new AverageStatReport('bandwidth_download');\n\n        /**\n         * Average total packet loss\n         * XXX What are the units?\n         * @type {AverageStatReport}\n         * @private\n         */\n        this._avgPacketLossTotal\n            = new AverageStatReport('packet_loss_total');\n\n        /**\n         * Average upload packet loss\n         * XXX What are the units?\n         * @type {AverageStatReport}\n         * @private\n         */\n        this._avgPacketLossUp\n            = new AverageStatReport('packet_loss_upload');\n\n        /**\n         * Average download packet loss\n         * XXX What are the units?\n         * @type {AverageStatReport}\n         * @private\n         */\n        this._avgPacketLossDown\n            = new AverageStatReport('packet_loss_download');\n\n        /**\n         * Average FPS for remote videos\n         * @type {AverageStatReport}\n         * @private\n         */\n        this._avgRemoteFPS = new AverageStatReport('framerate_remote');\n\n        /**\n         * Average FPS for remote screen streaming videos (reported only if not\n         * a <tt>NaN</tt>).\n         * @type {AverageStatReport}\n         * @private\n         */\n        this._avgRemoteScreenFPS\n            = new AverageStatReport('framerate_screen_remote');\n\n        /**\n         * Average FPS for local video (camera)\n         * @type {AverageStatReport}\n         * @private\n         */\n        this._avgLocalFPS = new AverageStatReport('framerate_local');\n\n        /**\n         * Average FPS for local screen streaming video (reported only if not\n         * a <tt>NaN</tt>).\n         * @type {AverageStatReport}\n         * @private\n         */\n        this._avgLocalScreenFPS\n            = new AverageStatReport('framerate_screen_local');\n\n        /**\n         * Average pixels for remote screen streaming videos (reported only if\n         * not a <tt>NaN</tt>).\n         * @type {AverageStatReport}\n         * @private\n         */\n        this._avgRemoteCameraPixels\n            = new AverageStatReport('pixels_remote');\n\n        /**\n         * Average pixels for remote screen streaming videos (reported only if\n         * not a <tt>NaN</tt>).\n         * @type {AverageStatReport}\n         * @private\n         */\n        this._avgRemoteScreenPixels\n            = new AverageStatReport('pixels_screen_remote');\n\n        /**\n         * Average pixels for local video (camera)\n         * @type {AverageStatReport}\n         * @private\n         */\n        this._avgLocalCameraPixels\n            = new AverageStatReport('pixels_local');\n\n        /**\n         * Average pixels for local screen streaming video (reported only if not\n         * a <tt>NaN</tt>).\n         * @type {AverageStatReport}\n         * @private\n         */\n        this._avgLocalScreenPixels\n            = new AverageStatReport('pixels_screen_local');\n\n        /**\n         * Average connection quality as defined by\n         * the {@link ConnectionQuality} module.\n         * @type {AverageStatReport}\n         * @private\n         */\n        this._avgCQ = new AverageStatReport('connection_quality');\n        this._cachedTransportStats = undefined;\n\n        this._onLocalStatsUpdated = (data: any) => {\n            this._calculateAvgStats(data);\n            this._maybeSendTransportAnalyticsEvent(data);\n        };\n        conference.on(\n            ConnectionQualityEvents.LOCAL_STATS_UPDATED,\n            this._onLocalStatsUpdated);\n\n        this._onP2PStatusChanged = () => {\n            logger.debug('Resetting average stats calculation');\n            this._resetAvgStats();\n            this.jvbStatsMonitor._resetAvgStats();\n            this.p2pStatsMonitor._resetAvgStats();\n        };\n        conference.on(\n            ConferenceEvents.P2P_STATUS,\n            this._onP2PStatusChanged);\n\n        this._onJvb121StatusChanged = activeSession => {\n\n            if (activeSession === conference.jvbJingleSession) {\n                logger.info('Resetting JVB avg RTP stats');\n                this._resetAvgJvbStats();\n            }\n        };\n        conference.on(\n            ConferenceEvents._MEDIA_SESSION_ACTIVE_CHANGED,\n            this._onJvb121StatusChanged);\n\n        this.jvbStatsMonitor\n            = new ConnectionAvgStats(this, false /* JVB */, n);\n\n        this.p2pStatsMonitor\n            = new ConnectionAvgStats(this, true /* P2P */, n);\n    }\n\n    /**\n     * Processes next batch of stats reported on\n     * {@link ConnectionQualityEvents.LOCAL_STATS_UPDATED}.\n     * @param {*} data\n     * @private\n     */\n    private _calculateAvgStats(data: any): void {\n\n        if (!data) {\n            logger.error('No stats');\n\n            return;\n        }\n\n        const isP2P = this._conference.isP2PActive();\n        const confSize = this._conference.getParticipantCount();\n\n        if (!isP2P && confSize < 2) {\n\n            // There's no point in collecting stats for a JVB conference of 1.\n            // That happens for short period of time after everyone leaves\n            // the room, until Jicofo terminates the session.\n            return;\n        }\n\n        /* Uncomment to figure out stats structure\n        for (const key in data) {\n            if (data.hasOwnProperty(key)) {\n                logger.info(`local stat ${key}: `, data[key]);\n            }\n        } */\n\n        const bitrate = data.bitrate;\n        const bandwidth = data.bandwidth;\n        const packetLoss = data.packetLoss;\n        const frameRate = data.framerate;\n        const resolution = data.resolution;\n\n        if (!bitrate) {\n            logger.error('No \"bitrate\"');\n\n            return;\n        } else if (!bandwidth) {\n            logger.error('No \"bandwidth\"');\n\n            return;\n        } else if (!packetLoss) {\n            logger.error('No \"packetloss\"');\n\n            return;\n        } else if (!frameRate) {\n            logger.error('No \"framerate\"');\n\n            return;\n        } else if (!resolution) {\n            logger.error('No resolution');\n\n            return;\n        }\n\n        this._avgAudioBitrateUp.addNext(bitrate.audio.upload);\n        this._avgAudioBitrateDown.addNext(bitrate.audio.download);\n\n        this._avgVideoBitrateUp.addNext(bitrate.video.upload);\n        this._avgVideoBitrateDown.addNext(bitrate.video.download);\n\n        if (browser.supportsBandwidthStatistics()) {\n            this._avgBandwidthUp.addNext(bandwidth.upload);\n            this._avgBandwidthDown.addNext(bandwidth.download);\n        }\n\n        this._avgPacketLossUp.addNext(packetLoss.upload);\n        this._avgPacketLossDown.addNext(packetLoss.download);\n        this._avgPacketLossTotal.addNext(packetLoss.total);\n\n        this._avgCQ.addNext(data.connectionQuality);\n\n        if (frameRate) {\n            this._avgRemoteFPS.addNext(\n                this._calculateAvgVideoFps(\n                    frameRate, false /* remote */, VideoType.CAMERA));\n            this._avgRemoteScreenFPS.addNext(\n                this._calculateAvgVideoFps(\n                    frameRate, false /* remote */, VideoType.DESKTOP));\n\n            this._avgLocalFPS.addNext(\n                this._calculateAvgVideoFps(\n                    frameRate, true /* local */, VideoType.CAMERA));\n            this._avgLocalScreenFPS.addNext(\n                this._calculateAvgVideoFps(\n                    frameRate, true /* local */, VideoType.DESKTOP));\n        }\n\n        if (resolution) {\n            this._avgRemoteCameraPixels.addNext(\n                this._calculateAvgVideoPixels(\n                    resolution, false /* remote */, VideoType.CAMERA));\n\n            this._avgRemoteScreenPixels.addNext(\n                this._calculateAvgVideoPixels(\n                    resolution, false /* remote */, VideoType.DESKTOP));\n\n            this._avgLocalCameraPixels.addNext(\n                this._calculateAvgVideoPixels(\n                    resolution, true /* local */, VideoType.CAMERA));\n\n            this._avgLocalScreenPixels.addNext(\n                this._calculateAvgVideoPixels(\n                    resolution, true /* local */, VideoType.DESKTOP));\n        }\n\n        this._sampleIdx += 1;\n\n        if (this._sampleIdx >= this._n) {\n            const batchReport: Record<string, unknown> = {\n                'conference_size': confSize,\n                p2p: isP2P\n            };\n\n            if (data.transport?.length) {\n                Object.assign(batchReport, {\n                    'local_candidate_type':\n                        data.transport[0].localCandidateType,\n                    'remote_candidate_type':\n                        data.transport[0].remoteCandidateType,\n                    'transport_type': data.transport[0].type\n                });\n            }\n\n            this._avgAudioBitrateUp.appendReport(batchReport);\n            this._avgAudioBitrateDown.appendReport(batchReport);\n\n            this._avgVideoBitrateUp.appendReport(batchReport);\n            this._avgVideoBitrateDown.appendReport(batchReport);\n\n            if (browser.supportsBandwidthStatistics()) {\n                this._avgBandwidthUp.appendReport(batchReport);\n                this._avgBandwidthDown.appendReport(batchReport);\n            }\n            this._avgPacketLossUp.appendReport(batchReport);\n            this._avgPacketLossDown.appendReport(batchReport);\n            this._avgPacketLossTotal.appendReport(batchReport);\n\n            this._avgRemoteFPS.appendReport(batchReport);\n            if (isValidNumber(this._avgRemoteScreenFPS.calculate())) {\n                this._avgRemoteScreenFPS.appendReport(batchReport);\n            }\n            this._avgLocalFPS.appendReport(batchReport);\n            if (isValidNumber(this._avgLocalScreenFPS.calculate())) {\n                this._avgLocalScreenFPS.appendReport(batchReport);\n            }\n\n            this._avgRemoteCameraPixels.appendReport(batchReport);\n            if (isValidNumber(this._avgRemoteScreenPixels.calculate())) {\n                this._avgRemoteScreenPixels.appendReport(batchReport);\n            }\n            this._avgLocalCameraPixels.appendReport(batchReport);\n            if (isValidNumber(this._avgLocalScreenPixels.calculate())) {\n                this._avgLocalScreenPixels.appendReport(batchReport);\n            }\n\n            this._avgCQ.appendReport(batchReport);\n\n            Statistics.sendAnalytics(createRtpStatsEvent(batchReport));\n\n            this._resetAvgStats();\n        }\n    }\n\n    /**\n     * Calculates average number of pixels for the report\n     *\n     * @param {map} peerResolutions a map of peer resolutions\n     * @param {boolean} isLocal if the average is to be calculated for the local\n     * video or <tt>false</tt> if for remote videos.\n     * @param {VideoType} videoType\n     * @return {number|NaN} average number of pixels or <tt>NaN</tt> if there\n     * are no samples.\n     * @private\n     */\n    private _calculateAvgVideoPixels(peerResolutions: Record<string, any>, isLocal: boolean, videoType: VideoType): number {\n        let peerPixelsSum = 0;\n        let peerCount = 0;\n        const myID = this._conference.myUserId();\n\n        for (const peerID of Object.keys(peerResolutions)) {\n            if (isLocal ? peerID === myID : peerID !== myID) {\n                const participant\n                    = isLocal\n                        ? null\n                        : this._conference.getParticipantById(peerID);\n                const videosResolution = peerResolutions[peerID];\n\n                // Do not continue without participant for non local peerID\n                if ((isLocal || participant) && videosResolution) {\n                    const peerAvgPixels = this._calculatePeerAvgVideoPixels(\n                        videosResolution, participant, videoType);\n\n                    if (isValidNumber(peerAvgPixels)) {\n                        peerPixelsSum += peerAvgPixels;\n                        peerCount += 1;\n                    }\n                }\n            }\n        }\n\n        return peerCount === 0 ? NaN : peerPixelsSum / peerCount;\n    }\n\n    /**\n     * Calculate average pixels for either remote or local participant\n     * @param {object} videos maps resolution per video SSRC\n     * @param {JitsiParticipant|null} participant remote participant or\n     * <tt>null</tt> for local video pixels calculation.\n     * @param {VideoType} videoType the type of the video for which an average\n     * will be calculated.\n     * @return {number|NaN} average video pixels of all participant's videos or\n     * <tt>NaN</tt> if currently not available\n     * @private\n     */\n    private _calculatePeerAvgVideoPixels(videos: Record<string, any>, participant: Nullable<JitsiParticipant>, videoType: VideoType): number {\n        let ssrcs = Object.keys(videos).map(ssrc => Number(ssrc));\n        let videoTracks: Nullable<JitsiLocalTrack[] | JitsiRemoteTrack[]> = null;\n\n        // NOTE that this method is supposed to be called for the stats\n        // received from the current peerconnection.\n        const tpc = this._conference.getActivePeerConnection();\n\n        if (participant) {\n            videoTracks = participant.getTracksByMediaType(MediaType.VIDEO);\n            if (videoTracks) {\n                ssrcs\n                    = ssrcs.filter(\n                        ssrc => videoTracks.find(\n                            track =>\n                                !track.isMuted()\n                                    && track.getSsrc() === ssrc\n                                    && track.videoType === videoType));\n            }\n        } else {\n            videoTracks = this._conference.getLocalTracks(MediaType.VIDEO);\n            ssrcs\n                = ssrcs.filter(\n                    ssrc => videoTracks.find(\n                        track =>\n                            !track.isMuted()\n                                && tpc.getLocalSSRC(track as JitsiLocalTrack) === ssrc\n                                && track.videoType === videoType));\n        }\n\n        let peerPixelsSum = 0;\n        let peerSsrcCount = 0;\n\n        for (const ssrc of ssrcs) {\n            const peerSsrcPixels\n                = Number(videos[ssrc].height) * Number(videos[ssrc].width);\n\n            // FPS is reported as 0 for users with no video\n            if (isValidNumber(peerSsrcPixels) && peerSsrcPixels > 0) {\n                peerPixelsSum += peerSsrcPixels;\n                peerSsrcCount += 1;\n            }\n        }\n\n        return peerSsrcCount === 0 ? NaN : peerPixelsSum / peerSsrcCount;\n    }\n\n    /**\n     * Calculates average FPS for the report\n     * @param {go figure} frameRate\n     * @param {boolean} isLocal if the average is to be calculated for the local\n     * video or <tt>false</tt> if for remote videos.\n     * @param {VideoType} videoType\n     * @return {number|NaN} average FPS or <tt>NaN</tt> if there are no samples.\n     * @private\n     */\n    private _calculateAvgVideoFps(frameRate: Record<string, any>, isLocal: boolean, videoType: VideoType): number {\n        let peerFpsSum = 0;\n        let peerCount = 0;\n        const myID = this._conference.myUserId();\n\n        for (const peerID of Object.keys(frameRate)) {\n            if (isLocal ? peerID === myID : peerID !== myID) {\n                const participant\n                    = isLocal\n                        ? null : this._conference.getParticipantById(peerID);\n                const videosFps = frameRate[peerID];\n\n                // Do not continue without participant for non local peerID\n                if ((isLocal || participant) && videosFps) {\n                    const peerAvgFPS\n                        = this._calculatePeerAvgVideoFps(\n                            videosFps, participant, videoType);\n\n                    if (isValidNumber(peerAvgFPS)) {\n                        peerFpsSum += peerAvgFPS;\n                        peerCount += 1;\n                    }\n                }\n            }\n        }\n\n        return peerCount === 0 ? NaN : peerFpsSum / peerCount;\n    }\n\n    /**\n     * Calculate average FPS for either remote or local participant\n     * @param {object} videos maps FPS per video SSRC\n     * @param {JitsiParticipant|null} participant remote participant or\n     * <tt>null</tt> for local FPS calculation.\n     * @param {VideoType} videoType the type of the video for which an average\n     * will be calculated.\n     * @return {number|NaN} average FPS of all participant's videos or\n     * <tt>NaN</tt> if currently not available\n     * @private\n     */\n    private _calculatePeerAvgVideoFps(videos: Record<string, any>, participant: Nullable<JitsiParticipant>, videoType: VideoType): number {\n        let ssrcs = Object.keys(videos).map(ssrc => Number(ssrc));\n        let videoTracks: Nullable<JitsiLocalTrack[] | JitsiRemoteTrack[]> = null;\n\n        // NOTE that this method is supposed to be called for the stats\n        // received from the current peerconnection.\n        const tpc = this._conference.getActivePeerConnection();\n\n        if (participant) {\n            videoTracks = participant.getTracksByMediaType(MediaType.VIDEO);\n            if (videoTracks) {\n                ssrcs\n                    = ssrcs.filter(\n                        ssrc => videoTracks.find(\n                            track => !track.isMuted()\n                                && track.getSsrc() === ssrc\n                                && track.videoType === videoType));\n            }\n        } else {\n            videoTracks = this._conference.getLocalTracks(MediaType.VIDEO);\n            ssrcs\n                = ssrcs.filter(\n                    ssrc => videoTracks.find(\n                        track => !track.isMuted()\n                            && tpc.getLocalSSRC(track as JitsiLocalTrack) === ssrc\n                            && track.videoType === videoType));\n        }\n\n        let peerFpsSum = 0;\n        let peerSsrcCount = 0;\n\n        for (const ssrc of ssrcs) {\n            const peerSsrcFps = Number(videos[ssrc]);\n\n            // FPS is reported as 0 for users with no video\n            if (isValidNumber(peerSsrcFps) && peerSsrcFps > 0) {\n                peerFpsSum += peerSsrcFps;\n                peerSsrcCount += 1;\n            }\n        }\n\n        return peerSsrcCount === 0 ? NaN : peerFpsSum / peerSsrcCount;\n    }\n\n    /**\n     * Sends the 'transport.stats' analytics event whenever we detect that\n     * there is a change in the local or remote candidate type on the transport\n     * that is currently selected.\n     * @param {*} data\n     * @private\n     */\n    private _maybeSendTransportAnalyticsEvent(data: any): void {\n        if (!data?.transport?.length) {\n            return;\n        }\n        const transportStats = {\n            'local_candidate_type': data.transport[0].localCandidateType,\n            'p2p': data.transport[0].p2p,\n            'remote_candidate_type': data.transport[0].remoteCandidateType,\n            'transport_type': data.transport[0].type\n        };\n\n        if (!this._cachedTransportStats || !isEqual(transportStats, this._cachedTransportStats)) {\n            this._cachedTransportStats = transportStats;\n            Statistics.sendAnalytics(createTransportStatsEvent(transportStats));\n        }\n    }\n\n    /**\n     * Resets the stats related to JVB connection. Must not be called when in\n     * P2P mode, because then the {@link AverageStatReport} instances are\n     * tracking P2P stats. Note that this should never happen unless something\n     * is wrong with the P2P and JVB121 events.\n     * @private\n     */\n    private _resetAvgJvbStats(): void {\n        this._resetAvgStats();\n        this.jvbStatsMonitor._resetAvgStats();\n    }\n\n    /**\n     * Reset cache of all averages and {@link _sampleIdx}.\n     * @private\n     */\n    private _resetAvgStats(): void {\n        this._avgAudioBitrateUp.reset();\n        this._avgAudioBitrateDown.reset();\n\n        this._avgVideoBitrateUp.reset();\n        this._avgVideoBitrateDown.reset();\n\n        this._avgBandwidthUp.reset();\n        this._avgBandwidthDown.reset();\n\n        this._avgPacketLossUp.reset();\n        this._avgPacketLossDown.reset();\n        this._avgPacketLossTotal.reset();\n\n        this._avgRemoteFPS.reset();\n        this._avgRemoteScreenFPS.reset();\n        this._avgLocalFPS.reset();\n        this._avgLocalScreenFPS.reset();\n\n        this._avgRemoteCameraPixels.reset();\n        this._avgRemoteScreenPixels.reset();\n        this._avgLocalCameraPixels.reset();\n        this._avgLocalScreenPixels.reset();\n\n        this._avgCQ.reset();\n\n        this._sampleIdx = 0;\n    }\n\n    /**\n     * Unregisters all event listeners and stops working.\n     */\n    public dispose(): void {\n        this._conference.off(\n            ConferenceEvents.P2P_STATUS,\n            this._onP2PStatusChanged);\n        this._conference.off(\n            ConnectionQualityEvents.LOCAL_STATS_UPDATED,\n            this._onLocalStatsUpdated);\n        this._conference.off(\n            ConferenceEvents._MEDIA_SESSION_ACTIVE_CHANGED,\n            this._onJvb121StatusChanged);\n        this.jvbStatsMonitor.dispose();\n        this.p2pStatsMonitor.dispose();\n    }\n}\n","/**\n * Interface for face landmarks.\n */\nexport interface IFaceLandmarks {\n    duration: number;\n    faceExpression: string;\n}\n\n/**\n * A model for keeping track of each user's total\n * time as a dominant speaker. The model also\n * keeps track of the user's last known name\n * in case the user has left the meeting,\n * which is also tracked.\n */\nclass SpeakerStats {\n    private _userId: string;\n    private displayName: string;\n    private _isLocalStats: boolean;\n    private totalDominantSpeakerTime: number;\n    private _dominantSpeakerStart: number;\n    private _isDominantSpeaker: boolean;\n    private _isSilent: boolean;\n    private _hasLeft: boolean;\n    private _faceLandmarks: IFaceLandmarks[];\n\n    /**\n     * Initializes a new SpeakerStats instance.\n     *\n     * @constructor\n     * @param {string} userId - The id of the user being tracked.\n     * @param {string} displayName - The name of the user being tracked.\n     * @param {boolean} isLocalStats - True if the stats model tracks\n     * the local user.\n     * @returns {void}\n     */\n    constructor(userId: string, displayName: string, isLocalStats: boolean) {\n        this._userId = userId;\n        this.setDisplayName(displayName);\n        this._isLocalStats = isLocalStats || false;\n        this.setDominantSpeaker(false, false);\n        this.totalDominantSpeakerTime = 0;\n        this._dominantSpeakerStart = 0;\n        this._isDominantSpeaker = false;\n        this._isSilent = false;\n        this._hasLeft = false;\n        this._faceLandmarks = [];\n    }\n\n    /**\n     * Get the user id being tracked.\n     *\n     * @returns {string} The user id.\n     */\n    getUserId(): string {\n        return this._userId;\n    }\n\n    /**\n     * Get the name of the user being tracked.\n     *\n     * @returns {string} The user name.\n     */\n    getDisplayName(): string {\n        return this.displayName;\n    }\n\n    /**\n     * Updates the last known name of the user being tracked.\n     *\n     * @param {string} newName - The user name.\n     * @returns {void}\n     */\n    setDisplayName(newName: string): void {\n        this.displayName = newName;\n    }\n\n    /**\n     * Returns true if the stats are tracking the local user.\n     *\n     * @returns {boolean}\n     */\n    isLocalStats(): boolean {\n        return this._isLocalStats;\n    }\n\n    /**\n     * Returns true if the tracked user is currently a dominant speaker.\n     *\n     * @returns {boolean}\n     */\n    isDominantSpeaker(): boolean {\n        return this._isDominantSpeaker;\n    }\n\n    /**\n     * Returns true if the tracked user is currently a dominant speaker.\n     *\n     * @param {boolean} isNowDominantSpeaker - If true, the user will be accumulating time\n     * as dominant speaker. If false, the user will not accumulate time\n     * and will record any time accumulated since starting as dominant speaker.\n     * @param {boolean} silence - Indicates whether the dominant speaker is silent or not.\n     * @returns {void}\n     */\n    setDominantSpeaker(isNowDominantSpeaker: boolean, silence: boolean): void {\n        if (!this.isDominantSpeaker() && isNowDominantSpeaker && !silence) {\n            this._dominantSpeakerStart = Date.now();\n        } else if (this.isDominantSpeaker()) {\n            if (!isNowDominantSpeaker) {\n                if (!this._isSilent) {\n                    const now = Date.now();\n                    const timeElapsed = now - this._dominantSpeakerStart;\n\n                    this.totalDominantSpeakerTime += timeElapsed;\n                    this._dominantSpeakerStart = 0;\n                }\n            } else if (this._isSilent && !silence) {\n                this._dominantSpeakerStart = Date.now();\n            } else if (!this._isSilent && silence) {\n                const now = Date.now();\n                const timeElapsed = now - this._dominantSpeakerStart;\n\n                this.totalDominantSpeakerTime += timeElapsed;\n                this._dominantSpeakerStart = 0;\n            }\n        }\n\n        this._isDominantSpeaker = isNowDominantSpeaker;\n        this._isSilent = silence;\n    }\n\n    /**\n     * Get how long the tracked user has been dominant speaker.\n     *\n     * @returns {number} - The speaker time in milliseconds.\n     */\n    getTotalDominantSpeakerTime(): number {\n        let total = this.totalDominantSpeakerTime;\n\n        if (this.isDominantSpeaker() && !this._isSilent) {\n            total += Date.now() - this._dominantSpeakerStart;\n        }\n\n        return total;\n    }\n\n    /**\n     * Get whether or not the user is still in the meeting.\n     *\n     * @returns {boolean} True if the user is no longer in the meeting.\n     */\n    hasLeft(): boolean {\n        return this._hasLeft;\n    }\n\n    /**\n     * Set the user as having left the meeting.\n     *\n     * @returns {void}\n     */\n    markAsHasLeft(): void {\n        this._hasLeft = true;\n        this.setDominantSpeaker(false, false);\n    }\n\n    /**\n     * Gets the face landmarks of the user.\n     *\n     * @returns {IFaceLandmarks[]}\n     */\n    getFaceLandmarks(): IFaceLandmarks[] {\n        return this._faceLandmarks;\n    }\n\n    /**\n     * Sets the face landmarks of the user.\n     *\n     * @param {IFaceLandmarks[]} faceLandmarks - object with face expressions.\n     * @returns {void}\n     */\n    setFaceLandmarks(faceLandmarks: IFaceLandmarks[]): void {\n        this._faceLandmarks = faceLandmarks;\n    }\n\n    /**\n     * Adds new face landmarks to speaker stats.\n     *\n     * @param  {IFaceLandmarks} faceLandmarks\n     */\n    addFaceLandmarks(faceLandmarks: IFaceLandmarks): void {\n        this._faceLandmarks.push(faceLandmarks);\n    }\n}\n\nexport default SpeakerStats;\n","import JitsiConference from '../../JitsiConference';\nimport { JitsiConferenceEvents } from '../../JitsiConferenceEvents';\nimport JitsiParticipant from '../../JitsiParticipant';\nimport { XMPPEvents } from '../../service/xmpp/XMPPEvents';\n\nimport { type IFaceLandmarks, default as SpeakerStats } from './SpeakerStats';\n\n/**\n * The value to use for the \"type\" field for messages sent\n * over the data channel that contain a face landmark.\n */\n\nconst FACE_LANDMARK_MESSAGE_TYPE = 'face-landmarks';\n\nexport interface ISpeakerStatsState {\n    dominantSpeakerId: Nullable<string>;\n    users: {\n        [userId: string]: SpeakerStats;\n    };\n}\n\nexport interface IFaceLandmarkMessage {\n    faceLandmarks: IFaceLandmarks;\n    type: string;\n}\n\n/**\n * A collection for tracking speaker stats. Attaches listeners\n * to the conference to automatically update on tracked events.\n */\nexport default class SpeakerStatsCollector {\n    stats: ISpeakerStatsState;\n    conference: JitsiConference;\n\n    /**\n     * Initializes a new SpeakerStatsCollector instance.\n     *\n     * @constructor\n     * @param {JitsiConference} conference - The conference to track.\n     * @returns {void}\n     */\n    constructor(conference: JitsiConference) {\n        this.stats = {\n            dominantSpeakerId: null,\n            users: {\n\n                // userId: SpeakerStats\n            }\n        };\n\n        const userId = conference.myUserId();\n\n        this.stats.users[userId] = new SpeakerStats(userId, null, true);\n        this.conference = conference;\n\n        conference.addEventListener(\n            JitsiConferenceEvents.DOMINANT_SPEAKER_CHANGED,\n            this._onDominantSpeaker.bind(this));\n        conference.addEventListener(\n            JitsiConferenceEvents.USER_JOINED,\n            this._onUserJoin.bind(this));\n        conference.addEventListener(\n            JitsiConferenceEvents.USER_LEFT,\n            this._onUserLeave.bind(this));\n        conference.addEventListener(\n            JitsiConferenceEvents.DISPLAY_NAME_CHANGED,\n            this._onDisplayNameChange.bind(this));\n\n        conference.on(\n            JitsiConferenceEvents.ENDPOINT_MESSAGE_RECEIVED,\n                (participant: JitsiParticipant, { type, faceLandmarks }: IFaceLandmarkMessage) => {\n                    if (type === FACE_LANDMARK_MESSAGE_TYPE) {\n                        this._onFaceLandmarkAdd(participant.getId(), faceLandmarks);\n                    }\n                });\n        if (conference.xmpp) {\n            conference.xmpp.addListener(\n                XMPPEvents.SPEAKER_STATS_RECEIVED,\n                this._updateStats.bind(this));\n        }\n    }\n\n    /**\n     * Reacts to dominant speaker change events by changing its speaker stats\n     * models to reflect the current dominant speaker.\n     *\n     * @param {string} dominantSpeakerId - The user id of the new dominant speaker.\n     * @param {Array[string]} previous - The array with previous speakers.\n     * @param {boolean} silence - Indecates whether the dominant speaker is silent or not.\n     * @returns {void}\n     * @private\n     */\n    _onDominantSpeaker(dominantSpeakerId: string, previous: string[], silence: boolean): void {\n        const oldDominantSpeaker\n            = this.stats.users[this.stats.dominantSpeakerId as string];\n        const newDominantSpeaker = this.stats.users[dominantSpeakerId];\n\n        oldDominantSpeaker && oldDominantSpeaker.setDominantSpeaker(false, false);\n        newDominantSpeaker && newDominantSpeaker.setDominantSpeaker(true, silence);\n        this.stats.dominantSpeakerId = dominantSpeakerId;\n    }\n\n    /**\n     * Reacts to user join events by creating a new SpeakerStats model.\n     *\n     * @param {string} userId - The user id of the new user.\n     * @param {JitsiParticipant} - The JitsiParticipant model for the new user.\n     * @returns {void}\n     * @private\n     */\n    _onUserJoin(userId: string, participant: JitsiParticipant): void {\n        if (participant.isHidden()) {\n            return;\n        }\n\n        if (!this.stats.users[userId]) {\n            this.stats.users[userId] = new SpeakerStats(userId, participant.getDisplayName(), false);\n        }\n    }\n\n    /**\n     * Reacts to user leave events by updating the associated user's\n     * SpeakerStats model.\n     *\n     * @param {string} userId - The user id of the user that left.\n     * @returns {void}\n     * @private\n     */\n    _onUserLeave(userId: string): void {\n        const savedUser = this.stats.users[userId];\n\n        if (savedUser) {\n            savedUser.markAsHasLeft();\n        }\n    }\n\n    /**\n     * Reacts to user name change events by updating the last known name\n     * tracked in the associated SpeakerStats model.\n     *\n     * @param {string} userId - The user id of the user that left.\n     * @returns {void}\n     * @private\n     */\n    _onDisplayNameChange(userId: string, newName: string): void {\n        const savedUser = this.stats.users[userId];\n\n        if (savedUser) {\n            savedUser.setDisplayName(newName);\n        }\n    }\n\n    /**\n     * Processes a new face landmark object of a remote user.\n     *\n     * @param {string} userId - The user id of the user that left.\n     * @param {IFaceLandmarks} data - The face landmark object.\n     * @returns {void}\n     * @private\n     */\n    _onFaceLandmarkAdd(userId: string, data: IFaceLandmarks): void {\n        const savedUser = this.stats.users[userId];\n\n        if (savedUser && data) {\n            savedUser.addFaceLandmarks(data);\n        }\n    }\n\n    /**\n     * Return a copy of the tracked SpeakerStats models.\n     *\n     * @returns {Object} The keys are the user ids and the values are the\n     * associated user's SpeakerStats model.\n     */\n    getStats(): { [userId: string]: SpeakerStats; } {\n        return this.stats.users;\n    }\n\n    /**\n     * Updates of the current stats is requested, passing the new values.\n     *\n     * @param {Object} newStats - The new values used to update current one.\n     * @private\n     */\n    _updateStats(newStats: { [userId: string]: any; }): void {\n        for (const userId in newStats) { // eslint-disable-line guard-for-in\n            let speakerStatsToUpdate;\n            const newParticipant = this.conference.getParticipantById(userId);\n\n            // we want to ignore hidden participants\n            if (!newParticipant?.isHidden()) {\n                if (this.stats.users[userId]) {\n                    speakerStatsToUpdate = this.stats.users[userId];\n\n                    if (!speakerStatsToUpdate.getDisplayName()) {\n                        speakerStatsToUpdate\n                            .setDisplayName(newStats[userId].displayName);\n                    }\n                } else {\n                    speakerStatsToUpdate = new SpeakerStats(\n                        userId, newStats[userId].displayName, false);\n                    this.stats.users[userId] = speakerStatsToUpdate;\n                    speakerStatsToUpdate.markAsHasLeft();\n                }\n\n                speakerStatsToUpdate.totalDominantSpeakerTime\n                    = newStats[userId].totalDominantSpeakerTime;\n\n                if (Array.isArray(newStats[userId].faceLandmarks)) {\n                    speakerStatsToUpdate.setFaceLandmarks(newStats[userId].faceLandmarks);\n                }\n            }\n        }\n    }\n}\n","import { getLogger } from '@jitsi/logger';\n\nimport JitsiConference from '../../JitsiConference';\n\nconst logger = getLogger('misc:ComponentsVersions');\n\n/**\n * Discovers component versions in a conference.\n */\nexport default class ComponentsVersions {\n    versions: { [key: string]: string; };\n    conference: JitsiConference;\n\n    /**\n     * Creates new instance of <tt>ComponentsVersions</tt> which will be discovering\n     * the versions of conferencing system components in given\n     * <tt>JitsiConference</tt>.\n     * @param conference <tt>JitsiConference</tt> instance which will be used to\n     *        listen for focus presence updates.\n     * @constructor\n     */\n    constructor(conference) {\n        this.versions = {};\n\n        this.conference = conference;\n        this.conference.addCommandListener('versions', this._processVersions.bind(this));\n    }\n\n    /**\n     * Processes versions information from presence.\n     *\n     * @param {*} versions - The versions element.\n     * @param {*} mucJid - MUC JID for the sender.\n     * @returns {void}\n     */\n    _processVersions(versions, _, mucJid) {\n        if (!this.conference.isFocus(mucJid)) {\n            logger.warn(\n                `Received versions not from the focus user: ${versions}`,\n                mucJid);\n\n            return;\n        }\n\n        versions.children.forEach(component => {\n            const name = component.attributes.name;\n            const version = component.value;\n\n            if (this.versions[name] !== version) {\n                this.versions[name] = version;\n                logger.info(`Got ${name} version: ${version}`);\n            }\n        });\n    }\n\n    /**\n     * Obtains the version of conferencing system component.\n     * @param componentName the name of the component for which we want to obtain\n     *        the version.\n     * @returns {String} which describes the version of the component identified by\n     *          given <tt>componentName</tt> or <tt>undefined</tt> if not found.\n     */\n    getComponentVersion(componentName) {\n        return this.versions[componentName];\n    }\n}\n","export enum VideoSIPGWStatusConstants {\n\n    /**\n     * Status that video SIP GW service is available.\n     */\n    STATUS_AVAILABLE = 'available',\n\n    /**\n     * Status that video SIP GW service is available but there are no free nodes\n     * at the moment to serve new requests.\n     */\n    STATUS_BUSY = 'busy',\n\n    /**\n     * Status that video SIP GW service is not available.\n     */\n    STATUS_UNDEFINED = 'undefined'\n}\n\nexport enum VideoSIPGWStateConstants {\n\n    /**\n     * Video SIP GW session state, tried to start but it failed.\n     */\n    STATE_FAILED = 'failed',\n\n    /**\n     * Video SIP GW session state, currently stopped and not running.\n     */\n    STATE_OFF = 'off',\n\n    /**\n     * Video SIP GW session state, currently running.\n     */\n    STATE_ON = 'on',\n\n    /**\n     * Video SIP GW session state, currently is starting.\n     */\n    STATE_PENDING = 'pending',\n\n    /**\n     * Video SIP GW session state, has observed some issues and is retrying at the\n     * moment.\n     */\n    STATE_RETRYING = 'retrying'\n}\n\nexport enum VideoSIPGWErrorConstants {\n\n    /**\n     * Error on trying to create video SIP GW session in conference where\n     * there is no room connection (hasn't joined or has left the room).\n     */\n    ERROR_NO_CONNECTION = 'error_no_connection',\n\n    /**\n     * Error on trying to create video SIP GW session with address for which\n     * there is an already created session.\n     */\n    ERROR_SESSION_EXISTS = 'error_session_already_exists'\n}\n\n// exported for backward compatibility\nexport const STATUS_AVAILABLE = VideoSIPGWStatusConstants.STATUS_AVAILABLE;\nexport const STATUS_UNDEFINED = VideoSIPGWStatusConstants.STATUS_UNDEFINED;\nexport const STATUS_BUSY = VideoSIPGWStatusConstants.STATUS_BUSY;\n\nexport const STATE_ON = VideoSIPGWStateConstants.STATE_ON;\nexport const STATE_OFF = VideoSIPGWStateConstants.STATE_OFF;\nexport const STATE_PENDING = VideoSIPGWStateConstants.STATE_PENDING;\nexport const STATE_RETRYING = VideoSIPGWStateConstants.STATE_RETRYING;\nexport const STATE_FAILED = VideoSIPGWStateConstants.STATE_FAILED;\n\nexport const ERROR_NO_CONNECTION = VideoSIPGWErrorConstants.ERROR_NO_CONNECTION;\nexport const ERROR_SESSION_EXISTS = VideoSIPGWErrorConstants.ERROR_SESSION_EXISTS;\n","import { getLogger } from '@jitsi/logger';\nimport { $iq } from 'strophe.js';\n\nimport Listenable from '../util/Listenable';\nimport ChatRoom from '../xmpp/ChatRoom';\nimport { handleStropheError } from '../xmpp/StropheErrorHandler';\n\nimport * as VideoSIPGWConstants from './VideoSIPGWConstants';\n\nconst logger = getLogger('videosipgw:JitsiVideoSIPGWSession');\n\n/**\n * The event name for current sip video session state changed.\n * @type {string} event name for sip video session state changed.\n */\nconst STATE_CHANGED: string = 'STATE_CHANGED';\n\n/**\n * Jitsi video SIP GW session. Holding its state and able to start/stop it.\n * When session is in OFF or FAILED stated it cannot be used anymore.\n */\nexport default class JitsiVideoSIPGWSession extends Listenable {\n    sipAddress: string;\n    displayName: string;\n    chatRoom: ChatRoom;\n    state?: string;\n\n    /**\n     * Creates new session with the desired sip address and display name.\n     *\n     * @param {string} sipAddress - The sip address to use when\n     * starting the session.\n     * @param {string} displayName - The display name to use for\n     * that participant.\n     * @param {ChatRoom} chatRoom - The chat room this session is bound to.\n     */\n    constructor(sipAddress: string, displayName: string, chatRoom: ChatRoom) {\n        super();\n\n        this.sipAddress = sipAddress;\n        this.displayName = displayName;\n        this.chatRoom = chatRoom;\n\n        /*\n         * The initial state is undefined. Initial state cannot be STATE_OFF,\n         * the session enters this state when it was in STATE_ON and was stopped\n         * and such session cannot be used anymore.\n         *\n         * @type {VideoSIPGWConstants|undefined}\n         */\n        this.state = undefined;\n    }\n\n    /**\n     * Sends a jibri command using an iq.\n     *\n     * @private\n     * @param {string} action - The action to send ('start' or 'stop').\n     */\n    private _sendJibriIQ(action: string): void {\n        const attributes = {\n            'action': action,\n            'displayname': this.displayName,\n            'sipaddress': this.sipAddress,\n            'xmlns': 'http://jitsi.org/protocol/jibri'\n        };\n\n        const iq = $iq({\n            to: this.chatRoom.focusMucJid,\n            type: 'set' })\n            .c('jibri', attributes)\n            .up();\n\n        logger.debug(`${action} video SIP GW session`, iq.nodeTree);\n        this.chatRoom.connection.sendIQ(\n            iq,\n            () => {}, // eslint-disable-line @typescript-eslint/no-empty-function\n            (error: any) => {\n                handleStropheError(error, {\n                    operation: `${action} video SIP GW session`,\n                    roomJid: this.chatRoom.roomjid,\n                    sipAddress: this.sipAddress,\n                    userJid: this.chatRoom.connection.jid\n                });\n                this.setState(VideoSIPGWConstants.STATE_FAILED);\n            },\n            undefined);\n    }\n\n    /**\n     * Stops the current session.\n     */\n    stop(): void {\n        if (this.state === VideoSIPGWConstants.STATE_OFF\n            || this.state === VideoSIPGWConstants.STATE_FAILED) {\n            logger.warn('Video SIP GW session already stopped or failed!');\n\n            return;\n        }\n\n        this._sendJibriIQ('stop');\n    }\n\n    /**\n     * Starts a new session. Sends an iq to the focus.\n     */\n    start(): void {\n        // if state is off, this session was active for some reason\n        // and we should create new one, rather than reusing it\n        if (this.state === VideoSIPGWConstants.STATE_ON\n            || this.state === VideoSIPGWConstants.STATE_OFF\n            || this.state === VideoSIPGWConstants.STATE_PENDING\n            || this.state === VideoSIPGWConstants.STATE_RETRYING) {\n            logger.warn('Video SIP GW session already started!');\n\n            return;\n        }\n\n        this._sendJibriIQ('start');\n    }\n\n    /**\n     * Changes the state of this session.\n     *\n     * @param {string} newState - The new {VideoSIPGWConstants} state to set.\n     * @param {string} [optional] failureReason - The reason why a failure state\n     * was entered.\n     * @returns {void}\n     */\n    setState(newState: string, failureReason?: string): void {\n        if (newState === this.state) {\n            return;\n        }\n\n        const oldState = this.state;\n\n        this.state = newState;\n        this.eventEmitter.emit(STATE_CHANGED,\n            {\n                address: this.sipAddress,\n                displayName: this.displayName,\n                failureReason,\n                newState: this.state,\n                oldState\n            }\n        );\n    }\n\n    /**\n     * Subscribes the passed listener to the event for state change of this\n     * session.\n     *\n     * @param {EventListener} listener - The function that will receive the event.\n     */\n    addStateListener(listener: EventListener): void {\n        this.addListener(STATE_CHANGED, listener);\n    }\n\n    /**\n     * Unsubscribes the passed handler.\n     *\n     * @param {EventListener} listener - The function to be removed.\n     */\n    removeStateListener(listener: EventListener): void {\n        this.removeListener(STATE_CHANGED, listener);\n    }\n}\n","import { getLogger } from '@jitsi/logger';\nconst logger = getLogger('videosipgw:VideoSIPGW');\n\nimport { XMPPEvents } from '../../service/xmpp/XMPPEvents';\nimport EventEmitter from '../util/EventEmitter';\nimport ChatRoom from '../xmpp/ChatRoom';\n\nimport JitsiVideoSIPGWSession from './JitsiVideoSIPGWSession';\nimport * as Constants from './VideoSIPGWConstants';\n\n\nexport interface ISessionStateChangeEvent {\n    address: string;\n    displayName?: string;\n    newState: string;\n    oldState?: string;\n}\n\nexport interface INodeAttributes {\n    failure_reason?: string;\n    sipaddress?: string;\n    state: string;\n}\n\n/**\n * Main video SIP GW handler. Stores references of all created sessions.\n */\nexport default class VideoSIPGW {\n    private chatRoom: ChatRoom;\n    private eventEmitter: EventEmitter;\n    private sessions: Record<string, JitsiVideoSIPGWSession>;\n    private sessionStateChangeListener: (event: ISessionStateChangeEvent) => void;\n    private state?: string;\n\n    /**\n     * Creates new handler.\n     *\n     * @param {ChatRoom} chatRoom - Tha chat room to handle.\n     */\n    constructor(chatRoom: ChatRoom) {\n        this.chatRoom = chatRoom;\n        this.eventEmitter = chatRoom.eventEmitter;\n        logger.debug('creating VideoSIPGW');\n        this.sessions = {};\n\n        this.sessionStateChangeListener = this.sessionStateChanged.bind(this);\n\n        // VideoSIPGW, JitsiConference and ChatRoom are not reusable and no\n        // more than one VideoSIPGW can be created per JitsiConference,\n        // so we don't bother to cleanup\n        chatRoom.addPresenceListener('jibri-sip-call-state',\n            this.handleJibriSIPState.bind(this));\n    }\n\n    /**\n     * Handles presence nodes with name: jibri-sip-call-state.\n     *\n     * @param {Object} node the presence node Object to handle.\n     * Object representing part of the presence received over xmpp.\n     */\n    handleJibriSIPState(node: { attributes?: INodeAttributes; }): void {\n        const attributes = node.attributes;\n\n        if (!attributes) {\n            return;\n        }\n\n        logger.debug('Handle video sip gw state : ', attributes);\n\n        const newState = attributes.state;\n\n        if (newState === this.state) {\n            return;\n        }\n\n        switch (newState) {\n        case Constants.STATE_ON:\n        case Constants.STATE_OFF:\n        case Constants.STATE_PENDING:\n        case Constants.STATE_RETRYING:\n        case Constants.STATE_FAILED: {\n            const address = attributes.sipaddress;\n\n            if (!address) {\n                return;\n            }\n\n            // find the corresponding session and set its state\n            const session = this.sessions[address];\n\n            if (session) {\n                session.setState(newState, attributes.failure_reason);\n            } else {\n                logger.warn('Video SIP GW session not found:', address);\n            }\n        }\n        }\n    }\n\n    /**\n     * Creates new session and stores its reference if it does not exist or\n     * returns an error otherwise.\n     *\n     * @param {string} sipAddress - The sip address to use.\n     * @param {string} displayName - The display name to use.\n     * @returns {JitsiVideoSIPGWSession|Error}\n     */\n    createVideoSIPGWSession(sipAddress: string, displayName: string): JitsiVideoSIPGWSession | Error {\n        if (this.sessions[sipAddress]) {\n            logger.warn('There was already a Video SIP GW session for address',\n                sipAddress);\n\n            return new Error(Constants.ERROR_SESSION_EXISTS);\n        }\n\n        const session = new JitsiVideoSIPGWSession(\n            sipAddress, displayName, this.chatRoom);\n\n        session.addStateListener(this.sessionStateChangeListener as unknown as EventListener);\n\n        this.sessions[sipAddress] = session;\n\n        return session;\n    }\n\n    /**\n     * Listener for session state changed. When a session goes to off or failed\n     * we delete its reference.\n     *\n     * @param {options} event - { address, oldState, newState, displayName }\n     */\n    sessionStateChanged(event: ISessionStateChangeEvent): void {\n        const address = event.address;\n\n        if (event.newState === Constants.STATE_OFF\n            || event.newState === Constants.STATE_FAILED) {\n            const session = this.sessions[address];\n\n            if (!session) {\n                logger.error('Missing Video SIP GW session with address:',\n                    address);\n\n                return;\n            }\n\n            session.removeStateListener(this.sessionStateChangeListener as unknown as EventListener);\n            delete this.sessions[address];\n        }\n\n        this.eventEmitter.emit(\n            XMPPEvents.VIDEO_SIP_GW_SESSION_STATE_CHANGED,\n            event);\n    }\n}\n","import { safeJsonParse } from '@jitsi/js-utils/json';\nimport { getLogger } from '@jitsi/logger';\nimport { Strophe } from 'strophe.js';\n\nimport { MediaType } from '../../service/RTC/MediaType';\nimport { SignalingEvents } from '../../service/RTC/SignalingEvents';\nimport SignalingLayer, { EndpointId, IPeerMediaInfo, ISourceInfo, SourceName, getMediaTypeFromSourceName } from '../../service/RTC/SignalingLayer';\nimport { VideoType } from '../../service/RTC/VideoType';\nimport { XMPPEvents } from '../../service/xmpp/XMPPEvents';\nimport FeatureFlags from '../flags/FeatureFlags';\n\nimport ChatRoom, { filterNodeFromPresenceJSON } from './ChatRoom';\n\n\nconst logger = getLogger('xmpp:SignalingLayerImpl');\n\nexport const SOURCE_INFO_PRESENCE_ELEMENT = 'SourceInfo';\n\nexport interface IPresenceNode {\n    [key: string]: any;\n    tagName: string;\n    value?: string; // for other possible properties\n}\n\n/**\n * Default XMPP implementation of the {@link SignalingLayer} interface. Obtains\n * the data from the MUC presence.\n */\nexport default class SignalingLayerImpl extends SignalingLayer {\n    /**\n     * A map that stores SSRCs of remote streams and the corresponding jid and source name.\n     * @type {Map<number, { endpointId: EndpointId, sourceName: SourceName }>}\n     */\n    private _ssrcOwners: Map<number, { endpointId: EndpointId; sourceName: SourceName; }>;\n\n    /**\n     * @type {ChatRoom|null}\n     */\n    private _chatRoom?: ChatRoom;\n\n    /**\n     * @type {Record<SourceName, Partial<ISourceInfo>>}\n     * @private\n     */\n    private _localSourceState: Record<SourceName, Partial<ISourceInfo>>;\n\n    /**\n     * @type {Record<EndpointId, Record<SourceName, ISourceInfo>>}\n     * @private\n     */\n    private _remoteSourceState: Record<EndpointId, Record<SourceName, ISourceInfo>>;\n\n    // Event handler references for cleanup\n    private _audioMuteHandler?: (node: IPresenceNode, from: string) => void;\n    private _videoMuteHandler?: (node: IPresenceNode, from: string) => void;\n    private _videoTypeHandler?: (node: IPresenceNode, from: string) => void;\n    private _sourceInfoHandler?: (node: IPresenceNode, mucNick: string) => void;\n    private _memberLeftHandler?: (jid: string) => void;\n\n    /**\n     * Creates new instance.\n     */\n    constructor() {\n        super();\n\n        this._ssrcOwners = new Map();\n        this._chatRoom = null;\n        this._localSourceState = { };\n        this._remoteSourceState = { };\n\n    }\n\n    /**\n     * Adds <SourceInfo> element to the local presence.\n     *\n     * @returns {boolean}\n     * @private\n     */\n    private _addLocalSourceInfoToPresence(): boolean {\n        if (this._chatRoom) {\n            return this._chatRoom.addOrReplaceInPresence(\n                SOURCE_INFO_PRESENCE_ELEMENT,\n                { value: JSON.stringify(this._localSourceState) });\n        }\n\n        return false;\n    }\n\n    /**\n     * Binds event listeners to the chat room instance.\n     * @param {ChatRoom} room\n     * @private\n     * @returns {void}\n     */\n    private _bindChatRoomEventHandlers(room: ChatRoom): void {\n        // Add handlers for 'audiomuted', 'videomuted' and 'videoType' fields in presence in order to support interop\n        // with very old versions of mobile clients and jigasi that do not support source-name signaling.\n        const emitAudioMutedEvent = (endpointId: string, muted: boolean) => {\n            this.eventEmitter.emit(\n                SignalingEvents.PEER_MUTED_CHANGED,\n                endpointId,\n                MediaType.AUDIO,\n                muted);\n        };\n\n        this._audioMuteHandler = (node: IPresenceNode, from: string) => {\n            if (!this._doesEndpointSendNewSourceInfo(from)) {\n                emitAudioMutedEvent(from, node.value === 'true');\n            }\n        };\n        room.addPresenceListener('audiomuted', this._audioMuteHandler);\n\n        const emitVideoMutedEvent = (endpointId: string, muted: boolean) => {\n            this.eventEmitter.emit(\n                SignalingEvents.PEER_MUTED_CHANGED,\n                endpointId,\n                MediaType.VIDEO,\n                muted);\n        };\n\n        this._videoMuteHandler = (node: IPresenceNode, from: string) => {\n            if (!this._doesEndpointSendNewSourceInfo(from)) {\n                emitVideoMutedEvent(from, node.value === 'true');\n            }\n        };\n        room.addPresenceListener('videomuted', this._videoMuteHandler);\n\n        const emitVideoTypeEvent = (endpointId: string, videoType: string) => {\n            this.eventEmitter.emit(\n                SignalingEvents.PEER_VIDEO_TYPE_CHANGED,\n                endpointId, videoType);\n        };\n\n        this._videoTypeHandler = (node: IPresenceNode, from: string) => {\n            if (!this._doesEndpointSendNewSourceInfo(from)) {\n                emitVideoTypeEvent(from, node.value);\n            }\n        };\n        room.addPresenceListener('videoType', this._videoTypeHandler);\n\n        // Add handlers for presence in the new format.\n        this._sourceInfoHandler = (node: IPresenceNode, mucNick: string) => {\n            const endpointId = mucNick;\n            const { value } = node;\n            const sourceInfoJSON = safeJsonParse(value);\n            const emitEventsFromHere = this._doesEndpointSendNewSourceInfo(endpointId);\n            const endpointSourceState = this._remoteSourceState[endpointId] || (this._remoteSourceState[endpointId] = {});\n\n            for (const sourceName of Object.keys(sourceInfoJSON)) {\n                let sourceChanged = false;\n                const mediaType = getMediaTypeFromSourceName(sourceName);\n                const newMutedState = Boolean(sourceInfoJSON[sourceName].muted);\n                const oldSourceState = endpointSourceState[sourceName]\n                    || (endpointSourceState[sourceName] = { sourceName });\n\n                if (oldSourceState.muted !== newMutedState) {\n                    sourceChanged = true;\n                    oldSourceState.muted = newMutedState;\n                    if (emitEventsFromHere && !this._localSourceState[sourceName]) {\n                        this.eventEmitter.emit(SignalingEvents.SOURCE_MUTED_CHANGED, sourceName, newMutedState);\n                    }\n                }\n\n                // Assume a default videoType of 'camera' for video sources.\n                const newVideoType = mediaType === MediaType.VIDEO\n                    ? sourceInfoJSON[sourceName].videoType ?? VideoType.CAMERA\n                    : undefined;\n\n                if (oldSourceState.videoType !== newVideoType) {\n                    oldSourceState.videoType = newVideoType;\n                    sourceChanged = true;\n\n                    // Since having a mix of eps that do/don't support multi-stream in the same call is supported, emit\n                    // SOURCE_VIDEO_TYPE_CHANGED event when the remote source changes videoType.\n                    if (emitEventsFromHere && !this._localSourceState[sourceName]) {\n                        this.eventEmitter.emit(SignalingEvents.SOURCE_VIDEO_TYPE_CHANGED, sourceName, newVideoType);\n                    }\n                }\n\n                if (sourceChanged && FeatureFlags.isSsrcRewritingSupported()) {\n                    this.eventEmitter.emit(\n                        SignalingEvents.SOURCE_UPDATED,\n                        sourceName,\n                        mucNick,\n                        newMutedState,\n                        newVideoType);\n                }\n            }\n\n            // Cleanup removed source names\n            const newSourceNames = Object.keys(sourceInfoJSON);\n\n            for (const sourceName of Object.keys(endpointSourceState)) {\n                if (newSourceNames.indexOf(sourceName) === -1) {\n                    delete endpointSourceState[sourceName];\n                }\n            }\n        };\n        room.addPresenceListener('SourceInfo', this._sourceInfoHandler);\n\n        // Cleanup when participant leaves\n        this._memberLeftHandler = (jid: string) => {\n            const endpointId = Strophe.getResourceFromJid(jid);\n\n            delete this._remoteSourceState[endpointId];\n        };\n        room.addEventListener(XMPPEvents.MUC_MEMBER_LEFT, this._memberLeftHandler);\n    }\n\n    /**\n     * Check is given endpoint has advertised <SourceInfo/> in it's presence which means that the source name signaling\n     * is used by this endpoint.\n     *\n     * @param {EndpointId} endpointId\n     * @returns {boolean}\n     */\n    private _doesEndpointSendNewSourceInfo(endpointId: EndpointId): boolean {\n        const presence = this._chatRoom?.getLastPresence(endpointId);\n\n        return Boolean(presence?.find((node: IPresenceNode) => node.tagName === SOURCE_INFO_PRESENCE_ELEMENT));\n    }\n\n    /**\n     * Logs a debug or error message to console depending on whether SSRC rewriting is enabled or not.\n     * Owner changes are permitted only when SSRC rewriting is enabled.\n     *\n     * @param {string} message - The message to be logged.\n     * @returns {void}\n     */\n    private _logOwnerChangedMessage(message: string): void {\n        if (FeatureFlags.isSsrcRewritingSupported()) {\n            logger.debug(message);\n        } else {\n            logger.error(message);\n        }\n    }\n\n    /**\n     * @inheritDoc\n     */\n    public override getPeerMediaInfo(owner: string, mediaType: MediaType, sourceName?: SourceName): Optional<IPeerMediaInfo> {\n        const legacyGetPeerMediaInfo = (): Optional<IPeerMediaInfo> => {\n            if (this._chatRoom) {\n                return this._chatRoom.getMediaPresenceInfo(owner, mediaType);\n            }\n            logger.warn('Requested peer media info, before room was set');\n        };\n\n        const lastPresence = this._chatRoom?.getLastPresence(owner);\n\n        if (!lastPresence) {\n            logger.warn(`getPeerMediaInfo - no presence stored for: ${owner}`);\n\n            return;\n        }\n        if (!this._doesEndpointSendNewSourceInfo(owner)) {\n            return legacyGetPeerMediaInfo();\n        }\n\n        if (sourceName) {\n            return this.getPeerSourceInfo(owner, sourceName);\n        }\n\n        const mediaInfo: IPeerMediaInfo = {\n            muted: true\n        };\n\n        if (mediaType === MediaType.VIDEO) {\n            mediaInfo.videoType = undefined;\n            const codecListNode = filterNodeFromPresenceJSON(lastPresence, 'jitsi_participant_codecList');\n            const codecTypeNode = filterNodeFromPresenceJSON(lastPresence, 'jitsi_participant_codecType');\n\n            if (codecListNode.length) {\n                mediaInfo.codecList = codecListNode[0].value?.split(',') ?? [];\n            } else if (codecTypeNode.length > 0) {\n                mediaInfo.codecType = codecTypeNode[0].value;\n            }\n        }\n\n        return mediaInfo;\n    }\n\n    /**\n     * @inheritDoc\n     */\n    public override getPeerSourceInfo(owner: EndpointId, sourceName: SourceName): Optional<ISourceInfo> {\n        const mediaType = getMediaTypeFromSourceName(sourceName);\n        const mediaInfo: ISourceInfo = mediaType === MediaType.VIDEO\n            ? { muted: true, sourceName, videoType: VideoType.CAMERA }\n            : { muted: true, sourceName };\n\n        return this._remoteSourceState[owner]\n            ? this._remoteSourceState[owner][sourceName] ?? mediaInfo\n            : undefined;\n    }\n\n    /**\n     * @inheritDoc\n     */\n    public override getSSRCOwner(ssrc: number): Optional<string> {\n        return this._ssrcOwners.get(ssrc)?.endpointId;\n    }\n\n    /**\n     * @inheritDoc\n     */\n    public override getTrackSourceName(ssrc: number): Optional<SourceName> {\n        return this._ssrcOwners.get(ssrc)?.sourceName;\n    }\n\n    /**\n     * @inheritDoc\n     */\n    public override removeSSRCOwners(ssrcList: number[]): void {\n        if (!ssrcList?.length) {\n            return;\n        }\n\n        for (const ssrc of ssrcList) {\n            this._ssrcOwners.delete(ssrc);\n        }\n    }\n\n    /**\n     * Sets the <tt>ChatRoom</tt> instance used and binds presence listeners.\n     * @param {ChatRoom} room\n     */\n    public setChatRoom(room: ChatRoom): void {\n        const oldChatRoom = this._chatRoom;\n\n        this._chatRoom = room;\n        if (oldChatRoom) {\n            oldChatRoom.removePresenceListener(\n                'audiomuted', this._audioMuteHandler);\n            oldChatRoom.removePresenceListener(\n                'videomuted', this._videoMuteHandler);\n            oldChatRoom.removePresenceListener(\n                'videoType', this._videoTypeHandler);\n            this._sourceInfoHandler\n                && oldChatRoom.removePresenceListener(SOURCE_INFO_PRESENCE_ELEMENT, this._sourceInfoHandler);\n            this._memberLeftHandler\n                && oldChatRoom.removeEventListener(XMPPEvents.MUC_MEMBER_LEFT, this._memberLeftHandler);\n        }\n        if (room) {\n            this._bindChatRoomEventHandlers(room);\n            this._addLocalSourceInfoToPresence();\n        }\n    }\n\n    /**\n     * @inheritDoc\n     */\n    public override setSSRCOwner(ssrc: number, newEndpointId: string, newSourceName: string): void {\n        if (typeof ssrc !== 'number') {\n            throw new TypeError(`SSRC(${ssrc}) must be a number`);\n        }\n\n        // Now signaling layer instance is shared between different JingleSessionPC instances, so although very unlikely\n        // an SSRC conflict could potentially occur. Log a message to make debugging easier.\n        const existingOwner = this._ssrcOwners.get(ssrc);\n\n        if (existingOwner) {\n            const { endpointId, sourceName } = existingOwner;\n\n            if (endpointId !== newEndpointId || sourceName !== newSourceName) {\n                this._logOwnerChangedMessage(\n                    `SSRC owner re-assigned from ${existingOwner}(source-name=${sourceName}) to ${\n                        newEndpointId}(source-name=${newSourceName})`);\n            }\n        }\n        this._ssrcOwners.set(ssrc, {\n            endpointId: newEndpointId,\n            sourceName: newSourceName\n        });\n    }\n\n    /**\n     * @inheritDoc\n     */\n    public override setTrackMuteStatus(sourceName: SourceName, muted: boolean): boolean {\n        if (!this._localSourceState[sourceName]) {\n            this._localSourceState[sourceName] = {};\n        }\n\n        this._localSourceState[sourceName].muted = muted;\n        logger.debug(`Mute state of ${sourceName} changed to muted=${muted}`);\n\n        if (this._chatRoom) {\n            return this._addLocalSourceInfoToPresence();\n        }\n\n        return false;\n    }\n\n    /**\n     * @inheritDoc\n     */\n    public override setTrackVideoType(sourceName: SourceName, videoType: VideoType): boolean {\n        if (!this._localSourceState[sourceName]) {\n            this._localSourceState[sourceName] = {};\n        }\n\n        if (this._localSourceState[sourceName].videoType !== videoType) {\n            // Include only if not a camera (default)\n            this._localSourceState[sourceName].videoType = videoType === VideoType.CAMERA ? undefined : videoType;\n\n            return this._addLocalSourceInfoToPresence();\n        }\n\n        return false;\n    }\n\n    /**\n     * @inheritDoc\n     */\n    public override updateSsrcOwnersOnLeave(id: string): void {\n        const ssrcs: number[] = [];\n\n        this._ssrcOwners.forEach(({ endpointId }, ssrc) => {\n            if (endpointId === id) {\n                ssrcs.push(ssrc);\n            }\n        });\n\n        if (!ssrcs?.length) {\n            return;\n        }\n\n        this.removeSSRCOwners(ssrcs);\n    }\n}\n","/**\n * Enumeration of the video types that are signaled to the bridge\n * @type {{CAMERA: string, DESKTOP: string, DESKTOP_HIGH_FPS: string, NONE: string}}\n */\nexport enum BridgeVideoType {\n\n    /**\n     * The camera video type.\n     */\n    CAMERA = 'camera',\n\n    /**\n     * The low fps desktop video type.\n     */\n    DESKTOP = 'desktop',\n\n    /**\n     * The high fps desktop video type.\n     */\n    DESKTOP_HIGH_FPS = 'desktop_high_fps',\n\n    /**\n     * Video type when no local source is present.\n     */\n    NONE = 'none'\n}\n","import { getLogger } from '@jitsi/logger';\nimport { isEqual } from 'lodash-es';\nimport { Strophe } from 'strophe.js';\n\nimport * as JitsiConferenceErrors from './JitsiConferenceErrors';\nimport JitsiConferenceEventManager from './JitsiConferenceEventManager';\nimport { JitsiConferenceEvents } from './JitsiConferenceEvents';\nimport type JitsiConnection from './JitsiConnection';\nimport { JitsiConnectionEvents } from './JitsiConnectionEvents';\nimport JitsiParticipant from './JitsiParticipant';\nimport JitsiTrackError from './JitsiTrackError';\nimport * as JitsiTrackErrors from './JitsiTrackErrors';\nimport { JitsiTrackEvents } from './JitsiTrackEvents';\nimport type JitsiLocalTrack from './modules/RTC/JitsiLocalTrack';\nimport type JitsiRemoteTrack from './modules/RTC/JitsiRemoteTrack';\nimport JitsiTrack from './modules/RTC/JitsiTrack';\nimport RTC from './modules/RTC/RTC';\nimport { SS_DEFAULT_FRAME_RATE } from './modules/RTC/ScreenObtainer';\nimport type TraceablePeerConnection from './modules/RTC/TraceablePeerConnection';\nimport browser from './modules/browser';\nimport ConnectionQuality from './modules/connectivity/ConnectionQuality';\nimport IceFailedHandling from './modules/connectivity/IceFailedHandling';\nimport { DetectionEvents } from './modules/detection/DetectionEvents';\nimport NoAudioSignalDetection from './modules/detection/NoAudioSignalDetection';\nimport P2PDominantSpeakerDetection from './modules/detection/P2PDominantSpeakerDetection';\nimport VADAudioAnalyser, { IVADProcessor } from './modules/detection/VADAudioAnalyser';\nimport VADNoiseDetection from './modules/detection/VADNoiseDetection';\nimport VADTalkMutedDetection from './modules/detection/VADTalkMutedDetection';\nimport { E2EEncryption } from './modules/e2ee/E2EEncryption';\nimport E2ePing from './modules/e2eping/e2eping';\nimport FeatureFlags from './modules/flags/FeatureFlags';\nimport { LiteModeContext } from './modules/litemode/LiteModeContext';\nimport { QualityController } from './modules/qualitycontrol/QualityController';\nimport { IReceiverVideoConstraints } from './modules/qualitycontrol/ReceiveVideoController';\nimport JibriSession from './modules/recording/JibriSession';\nimport RecordingManager, { IRecordingOptions } from './modules/recording/RecordingManager';\nimport Settings from './modules/settings/Settings';\nimport AvgRTPStatsReporter from './modules/statistics/AvgRTPStatsReporter';\nimport LocalStatsCollector from './modules/statistics/LocalStatsCollector';\nimport SpeakerStats from './modules/statistics/SpeakerStats';\nimport SpeakerStatsCollector from './modules/statistics/SpeakerStatsCollector';\nimport Statistics from './modules/statistics/statistics';\nimport Listenable from './modules/util/Listenable';\nimport { isValidNumber, safeSubtract } from './modules/util/MathUtil';\nimport RandomUtil from './modules/util/RandomUtil';\nimport { getJitterDelay } from './modules/util/Retry';\nimport { findAll, findFirst, getAttribute } from './modules/util/XMLUtils';\nimport ComponentsVersions from './modules/version/ComponentsVersions';\nimport JitsiVideoSIPGWSession from './modules/videosipgw/JitsiVideoSIPGWSession';\nimport VideoSIPGW from './modules/videosipgw/VideoSIPGW';\nimport * as VideoSIPGWConstants from './modules/videosipgw/VideoSIPGWConstants';\nimport BreakoutRooms from './modules/xmpp/BreakoutRooms';\nimport type { ChatRoom, PresenceHandler } from './modules/xmpp/ChatRoom';\nimport FileSharing from './modules/xmpp/FileSharing';\nimport type JingleSessionPC from './modules/xmpp/JingleSessionPC';\nimport { MediaSessionEvents } from './modules/xmpp/MediaSessionEvents';\nimport Polls from './modules/xmpp/Polls';\nimport RoomMetadata from './modules/xmpp/RoomMetadata';\nimport SignalingLayerImpl from './modules/xmpp/SignalingLayerImpl';\nimport XMPP, {\n    FEATURE_E2EE,\n    FEATURE_JIGASI,\n    IFaceLandmarksPayload,\n    JITSI_MEET_MUC_TYPE\n} from './modules/xmpp/xmpp';\nimport { BridgeVideoType } from './service/RTC/BridgeVideoType';\nimport { CodecMimeType } from './service/RTC/CodecMimeType';\nimport { MediaType } from './service/RTC/MediaType';\nimport { RTCEvents } from './service/RTC/RTCEvents';\nimport { IReceiverAudioSubscriptionMessage } from './service/RTC/ReceiverAudioSubscription';\nimport { SignalingEvents } from './service/RTC/SignalingEvents';\nimport { getMediaTypeFromSourceName, getSourceNameForJitsiTrack } from './service/RTC/SignalingLayer';\nimport { VideoType } from './service/RTC/VideoType';\nimport { MAX_CONNECTION_RETRIES } from './service/connectivity/Constants';\nimport {\n    AnalyticsEvents,\n    createConferenceEvent,\n    createJingleEvent,\n    createJvbIceFailedEvent,\n    createP2PEvent\n} from './service/statistics/AnalyticsEvents';\nimport { XMPPEvents } from './service/xmpp/XMPPEvents';\n\nexport interface IConferenceOptions {\n    config: {\n        _p2pConnStatusRtcMuteTimeout?: number;\n        _peerConnStatusOutOfLastNTimeout?: number;\n        _peerConnStatusRtcMuteTimeout?: number;\n        analytics?: {\n            rtcstatsEnabled?: boolean;\n            rtcstatsEndpoint?: string;\n        };\n        applicationName?: string;\n        avgRtpStatsN?: number;\n        channelLastN?: number;\n        confID?: string;\n        createVADProcessor?: () => IVADProcessor;\n        deploymentInfo?: {\n            userRegion?: string;\n        };\n        disableAudioLevels?: boolean;\n        disableLocalStats?: boolean;\n        disableLocalStatsBroadcast?: boolean;\n        e2eping?: {\n            enabled?: boolean;\n        };\n        enableNoAudioDetection?: boolean;\n        enableNoisyMicDetection?: boolean;\n        enableTalkWhileMuted?: boolean;\n        hiddenDomain?: string;\n        p2p?: {\n            backToP2PDelay?: number;\n            codecPreferenceOrder?: string[];\n            disabledCodec?: string;\n            enabled?: boolean;\n            mobileCodecPreferenceOrder?: string[];\n            mobileScreenshareCodec?: string;\n            preferredCodec?: string;\n            screenshareCodec?: string;\n        };\n        pcStatsInterval?: number;\n        startAudioMuted?: number;\n        startLastN?: number;\n        startSilent?: boolean;\n        startVideoMuted?: number;\n        statisticsDisplayName?: string;\n        statisticsId?: string;\n        testing?: {\n            allowMultipleTracks?: boolean;\n            enableAV1ForFF?: boolean;\n            enableFirefoxP2p?: boolean;\n            forceInitiator?: boolean;\n            forceResponder?: boolean;\n            lastNRampupTime?: number;\n            p2pTestMode?: boolean;\n        };\n        transcriptionLanguage?: string;\n        videoQuality?: {\n            codecPreferenceOrder?: string[];\n            disabledCodec?: string;\n            enableAdaptiveMode?: boolean;\n            mobileCodecPreferenceOrder?: string[];\n            mobileScreenshareCodec?: string;\n            preferredCodec?: string;\n            screenshareCodec?: string;\n        };\n    };\n    connection: JitsiConnection;\n    customDomain?: string;\n    name: string;\n}\n\nexport interface IStartMutedPolicy {\n    audio: boolean;\n    video: boolean;\n}\n\nexport interface IConferenceProperties {\n    'audio-limit-reached'?: string;\n    'bridge-count'?: string;\n    'video-limit-reached'?: string;\n    'visitor-codecs'?: string;\n    'visitor-count'?: number;\n}\n\nexport interface IStatisticsOptions {\n    aliasName?: string;\n    applicationName?: string;\n    confID?: string;\n    roomName?: string;\n    userName?: string;\n}\n\nexport interface IStopSessionOptions {\n    reason?: string;\n    reasonDescription?: string;\n    requestRestart?: boolean;\n    sendSessionTerminate?: boolean;\n}\n\nconst logger = getLogger('core:JitsiConference');\n\n/**\n * How long since Jicofo is supposed to send a session-initiate, before\n * {@link ACTION_JINGLE_SI_TIMEOUT} analytics event is sent (in ms).\n * @type {number}\n */\nconst JINGLE_SI_TIMEOUT: number = 5000;\n\n/**\n * Default source language for transcribing the local participant.\n */\nconst DEFAULT_TRANSCRIPTION_LANGUAGE: string = 'en-US';\n\n/**\n * Checks if a given string is a valid video codec mime type.\n *\n * @param {string} codec the codec string that needs to be validated.\n * @returns {CodecMimeType|null} mime type if valid, null otherwise.\n * @private\n */\nfunction _getCodecMimeType(codec: string): Nullable<CodecMimeType> {\n    if (typeof codec === 'string') {\n        return Object.values(CodecMimeType).find(value => value === codec.toLowerCase()) || null;\n    }\n\n    return null;\n}\n\n/**\n * Error returned by authenticateAndUpgradeRole when authentication or connection fails.\n */\ninterface IUpgradeRoleError {\n    authenticationError?: string;\n    connectionError?: JitsiConnectionEvents;\n    credentials?: {\n        jid?: string;\n        password?: string;\n    };\n    message?: string;\n}\n\n/**\n * Options for authenticateAndUpgradeRole.\n */\ninterface IAuthenticateAndUpgradeRoleOptions {\n    id: string;\n    onCreateResource?: typeof JitsiConference.resourceCreator;\n    onLoginSuccessful?: () => void;\n    password: string;\n}\ninterface IProcessWithCancel extends Promise<void> {\n    cancel: () => void;\n}\n\n\n/**\n * Creates a JitsiConference object with the given name and properties.\n * Note: this constructor is not a part of the public API (objects should be\n * created using JitsiConnection.createConference).\n * @param options.config properties / settings related to the conference that\n * will be created.\n * @param options.name the name of the conference\n * @param options.connection the JitsiConnection object for this\n * JitsiConference.\n * @param {number} [options.config.avgRtpStatsN=15] how many samples are to be\n * collected by `AvgRTPStatsReporter`, before arithmetic mean is\n * calculated and submitted to the analytics module.\n * @param {boolean} [options.config.p2p.enabled] when set to <tt>true</tt>\n * the peer to peer mode will be enabled. It means that when there are only 2\n * participants in the conference an attempt to make direct connection will be\n * made. If the connection succeeds the conference will stop sending data\n * through the JVB connection and will use the direct one instead.\n * @param {number} [options.config.p2p.backToP2PDelay=5] a delay given in\n * seconds, before the conference switches back to P2P, after the 3rd\n * participant has left the room.\n * @param {number} [options.config.channelLastN=-1] The requested amount of\n * videos are going to be delivered after the value is in effect. Set to -1 for\n * unlimited or all available videos.\n *\n * @noInheritDoc\n */\nexport default class JitsiConference extends Listenable {\n    private _transcribingEnabled?: boolean;\n    private _visitorCodecs?: string[];\n    private _hasVisitors?: boolean;\n    private _sessionInitiateTimeout?: number;\n    private _desktopSharingFrameRate?: number;\n    private _numberOfParticipantsOnJoin?: number;\n    private _delayedIceFailed?: IceFailedHandling;\n    private _audioAnalyser?: VADAudioAnalyser;\n    private _noAudioSignalDetection?: NoAudioSignalDetection;\n    private _signalingLayer: SignalingLayerImpl;\n    private _conferenceJoinAnalyticsEventSent?: number;\n    private _e2eEncryption?: E2EEncryption;\n    private _liteModeContext?: LiteModeContext;\n    private _audioSenderLimitReached?: boolean;\n    private _videoSenderLimitReached?: boolean;\n    private _firefoxP2pEnabled: boolean;\n    private _iceRestarts: number;\n    private _unsubscribers: Array<() => void>;\n    private _xmpp: XMPP;\n\n    /**\n     * @internal\n     */\n    _statsCurrentId: string;\n\n    public options: IConferenceOptions;\n    public connection: JitsiConnection;\n    public eventManager: JitsiConferenceEventManager;\n    public participants: Map<string, JitsiParticipant>;\n    public componentsVersions: ComponentsVersions;\n    public jvbJingleSession?: JingleSessionPC;\n    public lastDominantSpeaker?: string;\n    public dtmfManager?: object;\n    public somebodySupportsDTMF: boolean;\n    public authEnabled: boolean;\n    public startMutedPolicy: IStartMutedPolicy;\n    public isMutedByFocus: boolean;\n    public mutedByFocusActor?: string;\n    public isVideoMutedByFocus: boolean;\n    public mutedVideoByFocusActor?: string;\n    public wasStopped: boolean;\n    public properties: IConferenceProperties;\n    public connectionQuality: ConnectionQuality;\n    public avgRtpStatsReporter?: AvgRTPStatsReporter;\n    public isJvbConnectionInterrupted: boolean;\n    public speakerStatsCollector: SpeakerStatsCollector;\n    public deferredStartP2PTask?: number;\n    public backToP2PDelay: number;\n    public isP2PConnectionInterrupted: boolean;\n    public p2p: boolean;\n    public p2pJingleSession?: JingleSessionPC;\n    public videoSIPGWHandler: VideoSIPGW;\n    public recordingManager: RecordingManager;\n    public room?: ChatRoom;\n    public e2eping?: E2ePing;\n    public rtc?: RTC;\n    public qualityController?: QualityController;\n    public statistics?: Statistics;\n    public p2pDominantSpeakerDetection?: P2PDominantSpeakerDetection;\n    public authIdentity?: string;\n    public p2pEstablishmentDuration?: number;\n    public jvbEstablishmentDuration?: number;\n    public isDesktopMutedByFocus: boolean;\n    public mutedDesktopByFocusActor?: string;\n    public dominantSpeakerIsSilent?: boolean;\n\n\n    /**\n     * @param {IConferenceOptions} options\n     */\n    constructor(options: IConferenceOptions) {\n        super();\n        if (!options.name || options.name.toLowerCase() !== options.name.toString()) {\n            const errmsg\n                = 'Invalid conference name (no conference name passed or it '\n                + 'contains invalid characters like capital letters)!';\n            const additionalLogMsg = options.name\n                ? `roomName=${options.name}; condition - ${options.name.toLowerCase()}!==${options.name.toString()}`\n                : 'No room name passed!';\n\n            logger.error(`${errmsg} ${additionalLogMsg}`);\n            throw new Error(errmsg);\n        }\n\n        this.connection = options.connection;\n        this._xmpp = this.connection?.xmpp;\n\n        if (this._xmpp.isRoomCreated(options.name, options.customDomain)) {\n            const errmsg = 'A conference with the same name has already been created!';\n\n            delete this.connection;\n            delete this._xmpp;\n            logger.error(errmsg);\n            throw new Error(errmsg);\n        }\n\n        this.options = options;\n        this.eventManager = new JitsiConferenceEventManager(this);\n\n        /**\n         * List of all the participants in the conference.\n         * @type {Map<string, JitsiParticipant>}\n         */\n        this.participants = new Map();\n\n        /**\n         * The signaling layer instance.\n         * @type {SignalingLayerImpl}\n         * @private\n         */\n        this._signalingLayer = new SignalingLayerImpl();\n\n        this._init(options);\n        this.componentsVersions = new ComponentsVersions(this);\n\n        /**\n         * Jingle session instance for the JVB connection.\n         * @type {JingleSessionPC}\n         */\n        this.jvbJingleSession = null;\n        this.lastDominantSpeaker = null;\n        this.dtmfManager = null;\n        this.somebodySupportsDTMF = false;\n        this.authEnabled = false;\n        this.startMutedPolicy = {\n            audio: false,\n            video: false\n        };\n\n        // AV Moderation.\n        this.isMutedByFocus = false;\n        this.isVideoMutedByFocus = false;\n        this.isDesktopMutedByFocus = false;\n        this.mutedByFocusActor = null;\n        this.mutedVideoByFocusActor = null;\n        this.mutedDesktopByFocusActor = null;\n\n        // Flag indicates if the 'onCallEnded' method was ever called on this\n        // instance. Used to log extra analytics event for debugging purpose.\n        // We need to know if the potential issue happened before or after\n        // the restart.\n        this.wasStopped = false;\n\n        // Conference properties, maintained by jicofo.\n        this.properties = {};\n\n        /**\n         * The object which monitors local and remote connection statistics (e.g.\n         * sending bitrate) and calculates a number which represents the connection\n         * quality.\n         */\n        this.connectionQuality = new ConnectionQuality(this, this.eventEmitter, options);\n\n        /**\n         * Reports average RTP statistics to the analytics module.\n         * @type {AvgRTPStatsReporter}\n         */\n        this.avgRtpStatsReporter = new AvgRTPStatsReporter(this, options.config.avgRtpStatsN || 15);\n\n        /**\n         * Indicates whether the connection is interrupted or not.\n         */\n        this.isJvbConnectionInterrupted = false;\n\n        /**\n         * The object which tracks active speaker times\n         */\n        this.speakerStatsCollector = new SpeakerStatsCollector(this);\n\n        /* P2P related fields below: */\n\n        /**\n         * Stores reference to deferred start P2P task. It's created when 3rd\n         * participant leaves the room in order to avoid ping pong effect (it\n         * could be just a page reload).\n         * @type {number|null}\n         */\n        this.deferredStartP2PTask = null;\n\n        const delay = Number.parseInt(String(options.config.p2p?.backToP2PDelay || 5), 10);\n\n        /**\n         * A delay given in seconds, before the conference switches back to P2P\n         * after the 3rd participant has left.\n         * @type {number}\n         */\n        this.backToP2PDelay = isValidNumber(delay) ? delay : 5;\n        logger.info(`backToP2PDelay: ${this.backToP2PDelay}`);\n\n        /**\n         * If set to <tt>true</tt> it means the P2P ICE is no longer connected.\n         * When <tt>false</tt> it means that P2P ICE (media) connection is up\n         * and running.\n         * @type {boolean}\n         */\n        this.isP2PConnectionInterrupted = false;\n\n        /**\n         * Flag set to <tt>true</tt> when P2P session has been established\n         * (ICE has been connected) and this conference is currently in the peer to\n         * peer mode (P2P connection is the active one).\n         * @type {boolean}\n         */\n        this.p2p = false;\n\n        /**\n         * A JingleSession for the direct peer to peer connection.\n         * @type {JingleSessionPC}\n         */\n        this.p2pJingleSession = null;\n\n        this.videoSIPGWHandler = new VideoSIPGW(this.room);\n        this.recordingManager = new RecordingManager(this.room);\n\n        /**\n         * If the conference.joined event has been sent this will store the timestamp when it happened.\n         *\n         * @type {undefined|number}\n         * @private\n         */\n        this._conferenceJoinAnalyticsEventSent = undefined;\n\n        /**\n         * End-to-End Encryption. Make it available if supported.\n         */\n        if (this.isE2EESupported()) {\n            logger.info('End-to-End Encryption is supported');\n            this._e2eEncryption = new E2EEncryption(this);\n        }\n\n        if (FeatureFlags.isRunInLiteModeEnabled()) {\n            logger.info('Lite mode enabled');\n            this._liteModeContext = new LiteModeContext(this);\n        }\n\n        /**\n         * Flag set to <tt>true</tt> when Jicofo sends a presence message indicating that the max audio sender limit has\n         * been reached for the call. Once this is set, unmuting audio will be disabled\n         * from the client until it gets reset\n         * again by Jicofo.\n         */\n        this._audioSenderLimitReached = undefined;\n\n        /**\n         * Flag set to <tt>true</tt> when Jicofo sends a presence message indicating that the max video sender limit has\n         * been reached for the call. Once this is set, unmuting video will be disabled\n         * from the client until it gets reset\n         * again by Jicofo.\n         */\n        this._videoSenderLimitReached = undefined;\n\n        this._firefoxP2pEnabled = browser.isVersionGreaterThan(109)\n            && (this.options.config.testing?.enableFirefoxP2p ?? true);\n\n        /**\n         * Number of times ICE restarts that have been attempted after ICE connectivity with the JVB was lost.\n         */\n        this._iceRestarts = 0;\n        this._unsubscribers = [];\n    }\n\n    /**\n     * Create a resource for the a jid. We use the room nickname (the resource part\n     * of the occupant JID, see XEP-0045) as the endpoint ID in colibri. We require\n     * endpoint IDs to be 8 hex digits because in some cases they get serialized\n     * into a 32bit field.\n     *\n     * @param {string} jid - The id set onto the XMPP connection.\n     * @param {boolean} isAuthenticatedUser - Whether or not the user has connected\n     * to the XMPP service with a password.\n     * @returns {string}\n     */\n    static resourceCreator(jid: string, isAuthenticatedUser: boolean): string {\n        let mucNickname: string;\n\n        if (isAuthenticatedUser) {\n            // For authenticated users generate a random ID.\n            mucNickname = RandomUtil.randomHexString(8).toLowerCase();\n        } else {\n            // Use first part of node for anonymous users if it matches format\n            mucNickname = Strophe.getNodeFromJid(jid)?.substr(0, 8)\n.toLowerCase();\n\n            // But if this doesn't have the required format we just generate a new\n            // random nickname.\n            const re = /[0-9a-f]{8}/g;\n\n            if (!mucNickname || !re.test(mucNickname)) {\n                mucNickname = RandomUtil.randomHexString(8).toLowerCase();\n            }\n        }\n\n        return mucNickname;\n    }\n\n    /**\n     * Initializes the conference object properties\n     * @param options {object}\n     * @param options.connection {JitsiConnection} overrides this.connection\n     */\n    private _init(options: IConferenceOptions): void {\n        this.eventManager.setupXMPPListeners();\n\n        const { config } = this.options;\n\n        this._statsCurrentId = config.statisticsId ?? Settings.callStatsUserName;\n        this.room = this._xmpp.createRoom(\n            this.options.name, {\n                ...config,\n                statsId: this._statsCurrentId\n            },\n            JitsiConference.resourceCreator\n        );\n\n        this._signalingLayer.setChatRoom(this.room);\n        this._signalingLayer.on(\n            SignalingEvents.SOURCE_UPDATED,\n            (sourceName, endpointId, muted, videoType) => {\n                const participant = this.participants.get(endpointId);\n                const mediaType = getMediaTypeFromSourceName(sourceName);\n\n                if (participant) {\n                    participant._setSources(mediaType, muted, sourceName, videoType);\n                    this.eventEmitter.emit(JitsiConferenceEvents.PARTICIPANT_SOURCE_UPDATED, participant);\n                }\n            });\n\n        // ICE Connection interrupted/restored listeners.\n        this._onIceConnectionEstablished = this._onIceConnectionEstablished.bind(this);\n        this.room.addListener(XMPPEvents.CONNECTION_ESTABLISHED, this._onIceConnectionEstablished);\n\n        this._onIceConnectionFailed = this._onIceConnectionFailed.bind(this);\n        this.room.addListener(XMPPEvents.CONNECTION_ICE_FAILED, this._onIceConnectionFailed);\n\n        this._onIceConnectionInterrupted = this._onIceConnectionInterrupted.bind(this);\n        this.room.addListener(XMPPEvents.CONNECTION_INTERRUPTED, this._onIceConnectionInterrupted);\n\n        this._onIceConnectionRestored = this._onIceConnectionRestored.bind(this);\n        this.room.addListener(XMPPEvents.CONNECTION_RESTORED, this._onIceConnectionRestored);\n\n        this._updateProperties = this._updateProperties.bind(this);\n        this.room.addListener(XMPPEvents.CONFERENCE_PROPERTIES_CHANGED, this._updateProperties);\n\n        this._sendConferenceJoinAnalyticsEvent = this._sendConferenceJoinAnalyticsEvent.bind(this);\n        this.room.addListener(XMPPEvents.MEETING_ID_SET, this._sendConferenceJoinAnalyticsEvent);\n\n        this._removeLocalSourceOnReject = this._removeLocalSourceOnReject.bind(this);\n        this._updateRoomPresence = this._updateRoomPresence.bind(this);\n        this.room.addListener(XMPPEvents.SESSION_ACCEPT, this._updateRoomPresence);\n        this.room.addListener(XMPPEvents.SOURCE_ADD, this._updateRoomPresence);\n        this.room.addListener(XMPPEvents.SOURCE_ADD_ERROR, this._removeLocalSourceOnReject);\n        this.room.addListener(XMPPEvents.SOURCE_REMOVE, this._updateRoomPresence);\n\n        if (config.e2eping?.enabled) {\n            this.e2eping = new E2ePing(\n                this,\n                config,\n                (message, to) => {\n                    try {\n                        this.sendMessage(message, to, true /* sendThroughVideobridge */);\n                    } catch (error) {\n                        logger.warn('Failed to send E2E ping request or response.', error?.msg);\n                    }\n                });\n        }\n\n        if (!this.rtc) {\n            this.rtc = new RTC(this, options);\n            this.eventManager.setupRTCListeners();\n            this._registerRtcListeners(this.rtc);\n        }\n\n        // Get the codec preference settings from config.js.\n        const qualityOptions = {\n            enableAdaptiveMode: config.videoQuality?.enableAdaptiveMode,\n            jvb: {\n                disabledCodec: _getCodecMimeType(config.videoQuality?.disabledCodec),\n                enableAV1ForFF: config.testing?.enableAV1ForFF,\n                preferenceOrder: browser.isMobileDevice()\n                    ? config.videoQuality?.mobileCodecPreferenceOrder\n                    : config.videoQuality?.codecPreferenceOrder,\n                preferredCodec: _getCodecMimeType(config.videoQuality?.preferredCodec),\n                screenshareCodec: browser.isMobileDevice()\n                    ? _getCodecMimeType(config.videoQuality?.mobileScreenshareCodec)\n                    : _getCodecMimeType(config.videoQuality?.screenshareCodec)\n            },\n            lastNRampupTime: config.testing?.lastNRampupTime ?? 60000,\n            p2p: {\n                disabledCodec: _getCodecMimeType(config.p2p?.disabledCodec),\n                enableAV1ForFF: true, // For P2P no simulcast is needed, therefore AV1 can be used.\n                preferenceOrder: browser.isMobileDevice()\n                    ? config.p2p?.mobileCodecPreferenceOrder\n                    : config.p2p?.codecPreferenceOrder,\n                preferredCodec: _getCodecMimeType(config.p2p?.preferredCodec),\n                screenshareCodec: browser.isMobileDevice()\n                    ? _getCodecMimeType(config.p2p?.mobileScreenshareCodec)\n                    : _getCodecMimeType(config.p2p?.screenshareCodec)\n            }\n        };\n\n        this.qualityController = new QualityController(this, qualityOptions);\n\n        if (!this.statistics) {\n            this.statistics = new Statistics(this, {\n                // @ts-ignore\n                aliasName: this._statsCurrentId,\n                applicationName: config.applicationName,\n                confID: config.confID ?? `${this.connection.options.hosts.domain}/${this.options.name}`,\n                roomName: this.options.name,\n                userName: config.statisticsDisplayName ?? this.myUserId()\n            });\n            Statistics.analytics.addPermanentProperties({\n                'callstats_name': this._statsCurrentId\n            });\n        }\n\n        this.eventManager.setupChatRoomListeners();\n\n        // Always add listeners because on reload we are executing leave and the\n        // listeners are removed from statistics module.\n        this.eventManager.setupStatisticsListeners();\n\n        // Disable VAD processing on Safari since it causes audio input to\n        // fail on some of the mobile devices.\n        if (config.enableTalkWhileMuted && browser.supportsVADDetection()) {\n            // If VAD processor factory method is provided uses VAD based detection, otherwise fallback to audio level\n            // based detection.\n            if (config.createVADProcessor) {\n                logger.info('Using VAD detection for generating talk while muted events');\n\n                if (!this._audioAnalyser) {\n                    this._audioAnalyser = new VADAudioAnalyser(this, config.createVADProcessor);\n                }\n\n                const vadTalkMutedDetection = new VADTalkMutedDetection();\n\n                vadTalkMutedDetection.on(DetectionEvents.VAD_TALK_WHILE_MUTED, () =>\n                    this.eventEmitter.emit(JitsiConferenceEvents.TALK_WHILE_MUTED));\n                this._audioAnalyser.addVADDetectionService(vadTalkMutedDetection);\n            } else {\n                logger.warn('No VAD Processor was provided. Talk while muted detection service was not initialized!');\n            }\n        }\n\n        // Disable noisy mic detection on safari since it causes the audio input to\n        // fail on Safari on iPadOS.\n        if (config.enableNoisyMicDetection && browser.supportsVADDetection()) {\n            if (config.createVADProcessor) {\n                if (!this._audioAnalyser) {\n                    this._audioAnalyser = new VADAudioAnalyser(this, config.createVADProcessor);\n                }\n\n                const vadNoiseDetection = new VADNoiseDetection();\n\n                vadNoiseDetection.on(DetectionEvents.VAD_NOISY_DEVICE, () =>\n                    this.eventEmitter.emit(JitsiConferenceEvents.NOISY_MIC));\n                this._audioAnalyser.addVADDetectionService(vadNoiseDetection);\n            } else {\n                logger.warn('No VAD Processor was provided. Noisy microphone detection service was not initialized!');\n            }\n        }\n\n        // Generates events based on no audio input detector.\n        if (config.enableNoAudioDetection && !config.disableAudioLevels\n            && LocalStatsCollector.isLocalStatsSupported()) {\n            this._noAudioSignalDetection = new NoAudioSignalDetection(this);\n            this._noAudioSignalDetection.on(DetectionEvents.NO_AUDIO_INPUT, () =>\n                this.eventEmitter.emit(JitsiConferenceEvents.NO_AUDIO_INPUT));\n            this._noAudioSignalDetection.on(DetectionEvents.AUDIO_INPUT_STATE_CHANGE, hasAudioSignal =>\n                this.eventEmitter.emit(JitsiConferenceEvents.AUDIO_INPUT_STATE_CHANGE, hasAudioSignal));\n        }\n\n        if ('channelLastN' in config) {\n            this.setLastN(config.channelLastN);\n        }\n\n        // creates dominant speaker detection that works only in p2p mode\n        this.p2pDominantSpeakerDetection = new P2PDominantSpeakerDetection(this);\n\n        // TODO: Drop this after the change to use the region from the http requests\n        //  to prosody is propagated to majority of deployments\n        if (config?.deploymentInfo?.userRegion) {\n            this.setLocalParticipantProperty('region', config.deploymentInfo.userRegion);\n        }\n\n        // Publish the codec preference to presence.\n        this.setLocalParticipantProperty('codecList',\n             this.qualityController.codecController.getCodecPreferenceList('jvb'));\n\n        // Set transcription language presence extension.\n        // In case the language config is undefined or has the default value that the transcriber uses\n        // (in our case Jigasi uses 'en-US'), don't set the participant property in order to avoid\n        // needlessly polluting the presence stanza.\n        const transcriptionLanguage = config?.transcriptionLanguage ?? DEFAULT_TRANSCRIPTION_LANGUAGE;\n\n        if (transcriptionLanguage !== DEFAULT_TRANSCRIPTION_LANGUAGE) {\n            this.setTranscriptionLanguage(transcriptionLanguage);\n        }\n    }\n\n    /**\n   * Registers event listeners on the RTC instance.\n   * @param {RTC} rtc - the RTC module instance used by this conference.\n   * @private\n   * @returns {void}\n   */\n    private _registerRtcListeners(rtc: RTC): void {\n        rtc.addListener(RTCEvents.DATA_CHANNEL_OPEN, () => {\n            for (const localTrack of this.rtc.localTracks) {\n                localTrack.isVideoTrack() && this._sendBridgeVideoTypeMessage(localTrack);\n            }\n        });\n    }\n\n\n    /**\n     * Sends a conference.join analytics event.\n     *\n     * @returns {void}\n     */\n    private _sendConferenceJoinAnalyticsEvent(): void {\n        const meetingId = this.getMeetingUniqueId();\n\n        if (this._conferenceJoinAnalyticsEventSent || !meetingId || this.getActivePeerConnection() === null) {\n            return;\n        }\n\n        const conferenceConnectionTimes = this.getConnectionTimes();\n        const xmppConnectionTimes = this.connection.getConnectionTimes();\n        const gumStart = window.connectionTimes['firstObtainPermissions.start'];\n        const gumEnd = window.connectionTimes['firstObtainPermissions.end'];\n        const globalNSConnectionTimes = window.JitsiMeetJS?.app?.connectionTimes ?? {};\n        const connectionTimes = {\n            ...conferenceConnectionTimes,\n            ...xmppConnectionTimes,\n            ...globalNSConnectionTimes,\n            connectedToMUCJoinedTime: safeSubtract(\n                conferenceConnectionTimes['muc.joined'], xmppConnectionTimes.connected),\n            connectingToMUCJoinedTime: safeSubtract(\n                conferenceConnectionTimes['muc.joined'], xmppConnectionTimes.connecting),\n            gumDuration: safeSubtract(gumEnd, gumStart),\n            numberOfParticipantsOnJoin: this._numberOfParticipantsOnJoin,\n            xmppConnectingTime: safeSubtract(xmppConnectionTimes.connected, xmppConnectionTimes.connecting)\n        };\n\n        Statistics.sendAnalytics(createConferenceEvent('joined', {\n            ...connectionTimes,\n            meetingId,\n            participantId: `${meetingId}.${this._statsCurrentId}`\n        }));\n        this._conferenceJoinAnalyticsEventSent = Date.now();\n    }\n\n    /**\n     * Sends conference.left analytics event.\n     * @private\n     */\n    private _sendConferenceLeftAnalyticsEvent(): void {\n        const meetingId = this.getMeetingUniqueId();\n\n        if (!meetingId || !this._conferenceJoinAnalyticsEventSent) {\n\n            return;\n        }\n\n        Statistics.sendAnalytics(createConferenceEvent('left', {\n            meetingId,\n            participantId: `${meetingId}.${this._statsCurrentId}`,\n            stats: {\n                duration: Math.floor((Date.now() - this._conferenceJoinAnalyticsEventSent) / 1000)\n            }\n        }));\n    }\n\n    /**\n     * Restarts all active media sessions.\n     *\n     * @returns {void}\n     */\n    private _restartMediaSessions(): void {\n        if (this.p2pJingleSession) {\n            this._stopP2PSession({\n                reasonDescription: 'restart',\n                requestRestart: true\n            });\n        }\n\n        if (this.jvbJingleSession) {\n            this._stopJvbSession({\n                reason: 'success',\n                reasonDescription: 'restart required',\n                requestRestart: true,\n                sendSessionTerminate: true\n            });\n        }\n\n        this._maybeStartOrStopP2P(false);\n    }\n\n\n    /**\n   * Fires TRACK_AUDIO_LEVEL_CHANGED change conference event (for local tracks).\n   * @param {number} audioLevel - The audio level.\n   * @param {TraceablePeerConnection} [tpc] - The peer connection.\n   * @private\n   */\n    private _fireAudioLevelChangeEvent(audioLevel: number, tpc: TraceablePeerConnection): void {\n        const activeTpc = this.getActivePeerConnection();\n\n        // There will be no TraceablePeerConnection if audio levels do not come from\n        // a peerconnection. LocalStatsCollector.js measures audio levels using Web\n        // Audio Analyser API and emits local audio levels events through\n        // JitsiTrack.setAudioLevel, but does not provide TPC instance which is\n        // optional.\n        if (!tpc || activeTpc === tpc) {\n            this.eventEmitter.emit(\n                JitsiConferenceEvents.TRACK_AUDIO_LEVEL_CHANGED,\n                this.myUserId(), audioLevel);\n        }\n    }\n\n    /**\n   * Fires TRACK_MUTE_CHANGED change conference event.\n   * @param {JitsiLocalTrack} track - The JitsiTrack object related to the event.\n   */\n    private _fireMuteChangeEvent(track: JitsiLocalTrack): void {\n        // check if track was muted by focus and now is unmuted by user\n        if (this.isMutedByFocus && track.isAudioTrack() && !track.isMuted()) {\n            this.isMutedByFocus = false;\n\n            // unmute local user on server\n            this.room.muteParticipant(this.room.myroomjid, false, MediaType.AUDIO);\n        } else if (this.isVideoMutedByFocus && track.isVideoTrack()\n                && track.getVideoType() !== VideoType.DESKTOP && !track.isMuted()) {\n            this.isVideoMutedByFocus = false;\n\n            // unmute local user on server\n            this.room.muteParticipant(this.room.myroomjid, false, MediaType.VIDEO);\n        } else if (this.isDesktopMutedByFocus && track.isVideoTrack()\n                && track.getVideoType() === VideoType.DESKTOP && !track.isMuted()) {\n            this.isDesktopMutedByFocus = false;\n\n            // unmute local user on server\n            this.room.muteParticipant(this.room.myroomjid, false, MediaType.DESKTOP);\n        }\n\n        let actorParticipant;\n\n        if (this.mutedByFocusActor && track.isAudioTrack()) {\n            const actorId = Strophe.getResourceFromJid(this.mutedByFocusActor);\n\n            actorParticipant = this.participants.get(actorId);\n        } else if (this.mutedVideoByFocusActor && track.isVideoTrack()\n                && track.getVideoType() !== VideoType.DESKTOP) {\n            const actorId = Strophe.getResourceFromJid(this.mutedVideoByFocusActor);\n\n            actorParticipant = this.participants.get(actorId);\n        } else if (this.mutedDesktopByFocusActor && track.isVideoTrack()\n                && track.getVideoType() === VideoType.DESKTOP) {\n            const actorId = Strophe.getResourceFromJid(this.mutedDesktopByFocusActor);\n\n            actorParticipant = this.participants.get(actorId);\n        }\n\n        // Send the video type message to the bridge if the track is not removed/added to the pc as part of\n        // the mute/unmute operation.\n        // In React Native we mute the camera by setting track.enabled but that doesn't\n        // work for screen-share tracks, so do the remove-as-mute for those.\n        const doesVideoMuteByStreamRemove\n           = browser.isReactNative() ? track.videoType === VideoType.DESKTOP : browser.doesVideoMuteByStreamRemove();\n\n        if (track.isVideoTrack() && !doesVideoMuteByStreamRemove) {\n            this._sendBridgeVideoTypeMessage(track);\n        }\n\n        this.eventEmitter.emit(JitsiConferenceEvents.TRACK_MUTE_CHANGED, track, actorParticipant);\n    }\n\n\n    /**\n   * Replaces the tracks at the lower level by going through the Jingle session\n   * and WebRTC peer connection. The method will resolve immediately if there is\n   * currently no JingleSession started.\n   * @param {JitsiLocalTrack|null} oldTrack - The track to be removed during\n   * the process or <tt>null</t> if the method should act as \"add track\".\n   * @param {JitsiLocalTrack|null} newTrack - The new track to be added or\n   * <tt>null</tt> if the method should act as \"remove track\".\n   * @return {Promise} Resolved when the process is done or rejected with a string\n   * which describes the error.\n   * @private\n   */\n    private async _doReplaceTrack(oldTrack?: JitsiLocalTrack, newTrack?: JitsiLocalTrack): Promise<void> {\n        const replaceTrackPromises = [];\n\n        if (this.jvbJingleSession) {\n            replaceTrackPromises.push(this.jvbJingleSession.replaceTrack(oldTrack, newTrack));\n        } else {\n            logger.info('_doReplaceTrack - no JVB JingleSession');\n        }\n\n        if (this.p2pJingleSession) {\n            replaceTrackPromises.push(this.p2pJingleSession.replaceTrack(oldTrack, newTrack));\n        } else {\n            logger.info('_doReplaceTrack - no P2P JingleSession');\n        }\n\n        await Promise.all(replaceTrackPromises);\n    }\n\n    /**\n   * Handler for when a source-add for a local source is rejected by Jicofo.\n   * @param {JingleSessionPC} jingleSession - The media session.\n   * @param {Error} error - The error message.\n   * @param {MediaType} mediaType - The media type of the track associated with the source that was rejected.\n   * @returns {void}\n   */\n    private _removeLocalSourceOnReject(jingleSession: JingleSessionPC, error: Error, mediaType: MediaType): void {\n        if (!jingleSession) {\n            return;\n        }\n        const errorReason = (error as { reason?: string; })?.reason;\n\n        logger.warn(`Source-add rejected on ${jingleSession}, reason=\"${errorReason}\", message=\"${error?.message}\"`);\n        const track = this.getLocalTracks(mediaType)[0];\n\n        this.eventEmitter.emit(JitsiConferenceEvents.TRACK_UNMUTE_REJECTED, track);\n    }\n\n    /**\n   * Operations related to creating a new track.\n   * @param {JitsiLocalTrack} newTrack - The new track being created.\n   */\n    private _setupNewTrack(newTrack: JitsiLocalTrack): void {\n        const mediaType = newTrack.getType();\n\n        if (!newTrack.getSourceName()) {\n            const sourceName = getSourceNameForJitsiTrack(\n            this.myUserId(),\n            mediaType,\n            this.getLocalTracks(mediaType)?.length);\n\n            newTrack.setSourceName(sourceName);\n        }\n\n        this.rtc.addLocalTrack(newTrack);\n        newTrack.setConference(this);\n\n\n        // Add event handlers.\n        this._unsubscribers.push(newTrack.addCancellableListener(JitsiTrackEvents.TRACK_MUTE_CHANGED, this._fireMuteChangeEvent.bind(this, newTrack)));\n\n        if (newTrack.isAudioTrack()) {\n            this._unsubscribers.push(newTrack.addCancellableListener(JitsiTrackEvents.TRACK_AUDIO_LEVEL_CHANGED, this._fireAudioLevelChangeEvent.bind(this)));\n        }\n\n        this.eventEmitter.emit(JitsiConferenceEvents.TRACK_ADDED, newTrack);\n    }\n\n    /**\n   * Sets the video type.\n   * @param {JitsiLocalTrack} track - The track.\n   * @return {boolean} <tt>true</tt> if video type was changed in presence.\n   * @private\n   */\n    private _setNewVideoType(track: JitsiLocalTrack): boolean {\n        let videoTypeChanged = false;\n\n        if (track) {\n            videoTypeChanged = this._signalingLayer.setTrackVideoType(track.getSourceName(), track.videoType) || false;\n        }\n\n        return videoTypeChanged;\n    }\n\n    /**\n     * Maybe clears the timeout which emits {@link ACTION_JINGLE_SI_TIMEOUT}\n     * analytics event.\n     * @private\n     */\n    private _maybeClearSITimeout(): void {\n        if (this._sessionInitiateTimeout\n                && (this.jvbJingleSession || this.getParticipantCount() < 2)) {\n            window.clearTimeout(this._sessionInitiateTimeout);\n            this._sessionInitiateTimeout = null;\n        }\n    }\n\n    /**\n     * Sets a timeout which will emit {@link ACTION_JINGLE_SI_TIMEOUT} analytics\n     * event.\n     * @private\n     */\n    private _maybeSetSITimeout(): void {\n        // Jicofo is supposed to invite if there are at least 2 participants\n        if (!this.jvbJingleSession\n                && this.getParticipantCount() >= 2\n                && !this._sessionInitiateTimeout) {\n            this._sessionInitiateTimeout = window.setTimeout(() => {\n                this._sessionInitiateTimeout = null;\n                Statistics.sendAnalytics(createJingleEvent(\n                    AnalyticsEvents.ACTION_JINGLE_SI_TIMEOUT,\n                    {\n                        p2p: false,\n                        value: JINGLE_SI_TIMEOUT\n                    }));\n            }, JINGLE_SI_TIMEOUT);\n        }\n    }\n\n\n    /**\n     * Clears the deferred start P2P task if it has been scheduled.\n     * @private\n     */\n    private _maybeClearDeferredStartP2P(): void {\n        if (this.deferredStartP2PTask) {\n            logger.info('Cleared deferred start P2P task');\n            clearTimeout(this.deferredStartP2PTask);\n            this.deferredStartP2PTask = null;\n        }\n    }\n\n    /**\n         * Removes from the conference remote tracks associated with the JVB\n     * connection.\n     * @private\n     */\n    private _removeRemoteJVBTracks(): void {\n        this._removeRemoteTracks(\n            'JVB', this.jvbJingleSession.peerconnection.getRemoteTracks());\n    }\n\n    /**\n     * Removes from the conference remote tracks associated with the P2P\n     * connection.\n     * @private\n     */\n    private _removeRemoteP2PTracks(): void {\n        this._removeRemoteTracks(\n            'P2P', this.p2pJingleSession.peerconnection.getRemoteTracks());\n    }\n\n    /**\n     * Generates fake \"remote track removed\" events for given Jingle session.\n     * @param {string} sessionNickname the session's nickname which will appear in\n     * log messages.\n     * @param {Array<JitsiRemoteTrack>} remoteTracks the tracks that will be removed\n     * @private\n     */\n    private _removeRemoteTracks(sessionNickname: string, remoteTracks: JitsiRemoteTrack[]): void {\n        for (const track of remoteTracks) {\n            logger.info(`Removing remote ${sessionNickname} track: ${track}`);\n            this.onRemoteTrackRemoved(track);\n        }\n    }\n\n    /**\n     * Resumes media transfer over the JVB connection.\n     * @private\n     */\n    private _resumeMediaTransferForJvbConnection(): void {\n        logger.info('Resuming media transfer over the JVB connection...');\n        this.jvbJingleSession.setMediaTransferActive(true)\n            .then(() => {\n                logger.info('Resumed media transfer over the JVB connection!');\n            })\n            .catch(error => {\n                logger.error('Failed to resume media transfer over the JVB connection:', error);\n            });\n    }\n\n    /**\n     * Sets new P2P status and updates some events/states hijacked from\n     * the <tt>JitsiConference</tt>.\n         * @param {boolean} newStatus the new P2P status value, <tt>true</tt> means that\n     * P2P is now in use, <tt>false</tt> means that the JVB connection is now in use\n     * @private\n     */\n    private _setP2PStatus(newStatus: boolean): void {\n        if (this.p2p === newStatus) {\n            logger.debug(`Called _setP2PStatus with the same status: ${newStatus}`);\n\n            return;\n        }\n        this.p2p = newStatus;\n        if (newStatus) {\n            logger.info('Peer to peer connection established!');\n\n            // When we end up in a valid P2P session need to reset the properties\n            // in case they have persisted, after session with another peer.\n            Statistics.analytics.addPermanentProperties({\n                p2pFailed: false\n            });\n\n            // Sync up video transfer active in case p2pJingleSession not existed\n            // when the lastN value was being adjusted.\n            const isVideoActive = this.getLastN() !== 0;\n\n            this.p2pJingleSession.setP2pVideoTransferActive(isVideoActive)\n                .catch(error => {\n                    logger.error(`Failed to sync up P2P video transfer status (${isVideoActive}), ${error}`);\n                });\n        } else {\n            logger.info('Peer to peer connection closed!');\n        }\n\n        // Clear dtmfManager, so that it can be recreated with new connection\n        this.dtmfManager = null;\n\n        // Update P2P status\n        this.eventEmitter.emit(\n            JitsiConferenceEvents.P2P_STATUS,\n            this,\n            this.p2p);\n        this.eventEmitter.emit(JitsiConferenceEvents._MEDIA_SESSION_ACTIVE_CHANGED, this.getActiveMediaSession());\n\n        // Refresh connection interrupted/restored\n        this.eventEmitter.emit(\n            this.isConnectionInterrupted()\n                ? JitsiConferenceEvents.CONNECTION_INTERRUPTED\n                : JitsiConferenceEvents.CONNECTION_RESTORED);\n    }\n\n    /**\n     * Starts new P2P session.\n     * @param {string} remoteJid the JID of the remote participant\n     * @private\n     */\n    private _startP2PSession(remoteJid: string): void {\n        this._maybeClearDeferredStartP2P();\n        if (this.p2pJingleSession) {\n            logger.error('P2P session already started!');\n\n            return;\n        }\n\n        this.isP2PConnectionInterrupted = false;\n        this.p2pJingleSession\n            = this.xmpp.connection.jingle.newP2PJingleSession(\n                this.room.myroomjid,\n                remoteJid);\n        logger.info(\n            'Created new P2P JingleSession', this.room.myroomjid, remoteJid);\n        this._sendConferenceJoinAnalyticsEvent();\n\n        this.p2pJingleSession.initialize(\n            this.room,\n            this.rtc,\n            this._signalingLayer,\n            {\n                ...this.options.config,\n                codecSettings: {\n                    codecList: this.qualityController.codecController.getCodecPreferenceList('p2p'),\n                    mediaType: MediaType.VIDEO,\n                    screenshareCodec: this.qualityController.codecController.getScreenshareCodec('p2p')\n                },\n                enableInsertableStreams: this.isE2EEEnabled() || FeatureFlags.isRunInLiteModeEnabled()\n            });\n\n        const localTracks = this.getLocalTracks();\n\n        this.p2pJingleSession.invite(localTracks)\n            .then(() => {\n                this.p2pJingleSession?.addEventListener(MediaSessionEvents.VIDEO_CODEC_CHANGED, () => {\n                    this.eventEmitter.emit(JitsiConferenceEvents.VIDEO_CODEC_CHANGED);\n                });\n            })\n            .catch(error => {\n                logger.error('Failed to start P2P Jingle session', error);\n\n                if (this.p2pJingleSession) {\n                    this.eventEmitter.emit(JitsiConferenceEvents.CONFERENCE_FAILED,\n                    JitsiConferenceErrors.OFFER_ANSWER_FAILED, error);\n                }\n            });\n    }\n\n    /**\n     * Suspends media transfer over the JVB connection.\n     * @private\n     */\n    private _suspendMediaTransferForJvbConnection(): void {\n        logger.info('Suspending media transfer over the JVB connection...');\n        this.jvbJingleSession.setMediaTransferActive(false)\n            .then(() => {\n                logger.info('Suspended media transfer over the JVB connection !');\n            })\n            .catch(error => {\n                logger.error('Failed to suspend media transfer over the JVB connection:', error);\n            });\n    }\n\n    /**\n     * Method when called will decide whether it's the time to start or stop\n     * the P2P session.\n     * @param {boolean} userLeftEvent if <tt>true</tt> it means that the call\n     * originates from the user left event.\n     * @private\n     */\n    private _maybeStartOrStopP2P(userLeftEvent: boolean = false): void {\n        if (!this.isP2PEnabled()\n                || this.isP2PTestModeEnabled()\n                || (browser.isFirefox() && !this._firefoxP2pEnabled)\n                || this.isE2EEEnabled()) {\n            logger.info('Auto P2P disabled');\n\n            return;\n        }\n        const peers = this.getParticipants();\n        const peerCount = peers.length;\n\n        // FIXME 1 peer and it must *support* P2P switching\n        const shouldBeInP2P = this._shouldBeInP2PMode();\n\n        // Clear deferred \"start P2P\" task\n        if (!shouldBeInP2P && this.deferredStartP2PTask) {\n            this._maybeClearDeferredStartP2P();\n        }\n\n        // Start peer to peer session\n        if (!this.p2pJingleSession && shouldBeInP2P) {\n            const peer = peerCount && peers[0];\n            const myId = this.myUserId();\n            const peersId = peer.getId();\n            const jid = peer.getJid();\n\n            // Force initiator or responder mode for testing if option is passed to config.\n            if (this.options.config.testing?.forceInitiator) {\n                logger.debug(`Forcing P2P initiator, will start P2P with: ${jid}`);\n                this._startP2PSession(jid);\n            } else if (this.options.config.testing?.forceResponder) {\n                logger.debug(`Forcing P2P responder, will wait for the other peer ${jid} to start P2P`);\n            } else {\n                if (myId > peersId) {\n                    logger.debug('I\\'m the bigger peersId - the other peer should start P2P', myId, peersId);\n\n                    return;\n                } else if (myId === peersId) {\n                    logger.error('The same IDs ? ', myId, peersId);\n\n                    return;\n                }\n\n                if (userLeftEvent) {\n                    if (this.deferredStartP2PTask) {\n                        logger.error('Deferred start P2P task\\'s been set already!');\n\n                        return;\n                    }\n                    logger.info(`Will start P2P with: ${jid} after ${this.backToP2PDelay} seconds...`);\n                    this.deferredStartP2PTask = Number(setTimeout(\n                        this._startP2PSession.bind(this, jid),\n                        this.backToP2PDelay * 1000));\n                } else {\n                    logger.info(`Will start P2P with: ${jid}`);\n                    this._startP2PSession(jid);\n                }\n            }\n        } else if (this.p2pJingleSession && !shouldBeInP2P) {\n            logger.info(`Will stop P2P with: ${this.p2pJingleSession.remoteJid}`);\n\n            // Log that there will be a switch back to the JVB connection\n            if (this.p2pJingleSession.isInitiator && peerCount > 1) {\n                Statistics.sendAnalyticsAndLog(\n                    createP2PEvent(AnalyticsEvents.ACTION_P2P_SWITCH_TO_JVB));\n            }\n            this._stopP2PSession();\n        }\n    }\n\n    /**\n     * Tells whether or not this conference should be currently in the P2P mode.\n     *\n     * @private\n     * @returns {boolean}\n     */\n    private _shouldBeInP2PMode(): boolean {\n        const peers = this.getParticipants();\n        const peerCount = peers.length;\n        const hasBotPeer = peers.find(p => p.getBotType() === 'poltergeist'\n            || p.hasFeature(FEATURE_JIGASI)) !== undefined;\n        const shouldBeInP2P = peerCount === 1 && !hasBotPeer && !this._hasVisitors\n        && !this._hasVisitors && !this._transcribingEnabled;\n\n        logger.debug(`P2P? peerCount: ${peerCount}, hasBotPeer: ${hasBotPeer} => ${shouldBeInP2P}`);\n\n        return shouldBeInP2P;\n    }\n\n    /**\n     * Stops the current P2P session.\n     * @param {Object} options - Options for stopping P2P.\n     * @param {string} options.reason - One of the Jingle \"reason\" element\n     * names as defined by https://xmpp.org/extensions/xep-0166.html#def-reason\n     * @param {string} options.reasonDescription - Text description that will be\n     * included in the session terminate message.\n     * @param {boolean} options.requestRestart - Whether this is due to a session restart, in which case\n     * media will not be resumed on the JVB.\n     * @private\n     */\n    private _stopP2PSession(options: { reason?: string; reasonDescription?: string; requestRestart?: boolean; } = {}): void {\n        const {\n            reason = 'success',\n            reasonDescription = 'Turning off P2P session',\n            requestRestart = false\n        } = options;\n\n        if (!this.p2pJingleSession) {\n            logger.error('No P2P session to be stopped!');\n\n            return;\n        }\n\n        const wasP2PEstablished = this.isP2PActive();\n\n        // Swap remote tracks, but only if the P2P has been fully established\n        if (wasP2PEstablished) {\n            if (this.jvbJingleSession && !requestRestart) {\n                this._resumeMediaTransferForJvbConnection();\n            }\n\n            // Remove remote P2P tracks\n            this._removeRemoteP2PTracks();\n        }\n\n        // Stop P2P stats\n        logger.info('Stopping remote stats for P2P connection');\n        this.statistics.stopRemoteStats(this.p2pJingleSession.peerconnection);\n\n        this.p2pJingleSession.terminate(\n            () => {\n                logger.info('P2P session terminate RESULT');\n                this.p2pJingleSession = null;\n            },\n            error => {\n                // Because both initiator and responder are simultaneously\n                // terminating their JingleSessions in case of the 'to JVB switch'\n                // when 3rd participant joins, both will dispose their sessions and\n                // reply with 'item-not-found' (see strophe.jingle.js). We don't\n                // want to log this as an error since it's expected behaviour.\n                //\n                // We want them both to terminate, because in case of initiator's\n                // crash the responder would stay in P2P mode until ICE fails which\n                // could take up to 20 seconds.\n                //\n                // NOTE: whilst this is an error callback,  'success' as a reason is\n                // considered as graceful session terminate\n                // where both initiator and responder terminate their sessions\n                // simultaneously.\n                if (reason !== 'success') {\n                    logger.error('An error occurred while trying to terminate P2P Jingle session', error);\n                }\n            }, {\n                reason,\n                reasonDescription,\n                sendSessionTerminate: Boolean(this.room\n                    && this.getParticipantById(\n                        Strophe.getResourceFromJid(this.p2pJingleSession.remoteJid))\n                )\n            });\n\n        this.p2pJingleSession = null;\n\n        // Update P2P status and other affected events/states\n        this._setP2PStatus(false);\n\n        if (wasP2PEstablished) {\n            // Add back remote JVB tracks\n            if (this.jvbJingleSession && !requestRestart) {\n                this._addRemoteJVBTracks();\n            } else {\n                logger.info('Not adding remote JVB tracks - no session yet');\n            }\n        }\n    }\n\n    /**\n     * Updates room presence if needed and send the packet in case of a modification.\n     * @param {JingleSessionPC} jingleSession the session firing the event, contains the peer connection which\n     * tracks we will check.\n     * @param {Object|null} ctx a context object we can distinguish multiple calls of the same pass of updating tracks.\n     */\n    private _updateRoomPresence(jingleSession: JingleSessionPC, ctx: { skip?: boolean; } = {}): void {\n        if (!jingleSession) {\n            return;\n        }\n\n        // skips sending presence twice for the same pass of updating ssrcs\n        if (ctx) {\n            if (ctx.skip) {\n                return;\n            }\n            ctx.skip = true;\n        }\n\n        let presenceChanged = false;\n        let muteStatusChanged: boolean;\n        let videoTypeChanged: boolean;\n        const localTracks = jingleSession.peerconnection.getLocalTracks();\n\n        // Set presence for all the available local tracks.\n        for (const track of localTracks) {\n            const muted = track.isMuted();\n\n            muteStatusChanged = this._setTrackMuteStatus(track, muted);\n            muteStatusChanged && logger.debug(`Updating mute state of ${track} in presence to muted=${muted}`);\n            if (track.getType() === MediaType.VIDEO) {\n                videoTypeChanged = this._setNewVideoType(track);\n                videoTypeChanged && logger.debug(`Updating videoType in presence to ${track.getVideoType()}`);\n            }\n            presenceChanged = presenceChanged || muteStatusChanged || videoTypeChanged;\n        }\n\n        presenceChanged && this.room.sendPresence();\n    }\n\n\n    /**\n     * Updates features for a participant.\n     * @param {JitsiParticipant} participant - The participant to query for features.\n     * @returns {void}\n     * @private\n     */\n    private _updateFeatures(participant: JitsiParticipant): void {\n        participant.getFeatures()\n            .then(features => {\n                participant._supportsDTMF = features.has('urn:xmpp:jingle:dtmf:0');\n                this.updateDTMFSupport();\n\n                if (features.has(FEATURE_JIGASI)) {\n                    participant.setProperty('features_jigasi', true);\n                }\n\n                if (features.has(FEATURE_E2EE)) {\n                    participant.setProperty('features_e2ee', true);\n                }\n            })\n            .catch(() => false);\n    }\n\n\n    /**\n     * Accepts an incoming call event for the JVB Jingle session.\n     * @param {JingleSessionPC} jingleSession - The Jingle session for the incoming call.\n     * @param {Element} jingleOffer - An element pointing to 'jingle' IQ element containing the offer.\n     * @param {number} now - The timestamp when the call was received.\n     * @private\n     */\n    private _acceptJvbIncomingCall(jingleSession: JingleSessionPC, jingleOffer: Element, now: number): void {\n        // Accept incoming call\n        this.jvbJingleSession = jingleSession;\n        this.room.connectionTimes['session.initiate'] = now;\n        this._sendConferenceJoinAnalyticsEvent();\n\n        if (this.wasStopped) {\n            Statistics.sendAnalyticsAndLog(createJingleEvent(AnalyticsEvents.ACTION_JINGLE_RESTART, { p2p: false }));\n        }\n\n        // Use *|xmlns to match xmlns attributes across any namespace (CSS Selectors Level 3)\n        const serverRegion = getAttribute(findFirst(jingleOffer, ':scope>bridge-session[*|xmlns=\"http://jitsi.org/protocol/focus\"]'), 'region');\n\n        this.eventEmitter.emit(JitsiConferenceEvents.SERVER_REGION_CHANGED, serverRegion);\n\n        this._maybeClearSITimeout();\n        Statistics.sendAnalytics(createJingleEvent(\n            AnalyticsEvents.ACTION_JINGLE_SI_RECEIVED,\n            {\n                p2p: false,\n                value: now\n            }));\n\n        try {\n            jingleSession.initialize(\n                this.room,\n                this.rtc,\n                this._signalingLayer,\n                {\n                    ...this.options.config,\n                    codecSettings: {\n                        codecList: this.qualityController.codecController.getCodecPreferenceList('jvb'),\n                        mediaType: MediaType.VIDEO,\n                        screenshareCodec: this.qualityController.codecController.getScreenshareCodec('jvb')\n                    },\n                    enableInsertableStreams: this.isE2EEEnabled() || FeatureFlags.isRunInLiteModeEnabled()\n                });\n        } catch (error) {\n            logger.error(error);\n\n            return;\n        }\n\n        // Open a channel with the videobridge.\n        this._setBridgeChannel(jingleOffer, jingleSession.peerconnection);\n\n        const localTracks = this.getLocalTracks();\n\n        try {\n            jingleSession.acceptOffer(\n                jingleOffer,\n                () => {\n                    // If for any reason invite for the JVB session arrived after\n                    // the P2P has been established already the media transfer needs\n                    // to be turned off here.\n                    if (this.isP2PActive() && this.jvbJingleSession) {\n                        this._suspendMediaTransferForJvbConnection();\n                    }\n\n                    this.eventEmitter.emit(JitsiConferenceEvents._MEDIA_SESSION_STARTED, jingleSession);\n                    if (!this.isP2PActive()) {\n                        this.eventEmitter.emit(JitsiConferenceEvents._MEDIA_SESSION_ACTIVE_CHANGED, jingleSession);\n                    }\n\n                    jingleSession.addEventListener(MediaSessionEvents.VIDEO_CODEC_CHANGED, () => {\n                        this.eventEmitter.emit(JitsiConferenceEvents.VIDEO_CODEC_CHANGED);\n                    });\n                },\n                error => {\n                    logger.error('Failed to accept incoming JVB Jingle session', error);\n                    this.eventEmitter.emit(JitsiConferenceEvents.CONFERENCE_FAILED,\n                        JitsiConferenceErrors.OFFER_ANSWER_FAILED, error);\n                },\n                localTracks\n            );\n\n            // Set the capture fps for screenshare if it is set through the UI.\n            this._desktopSharingFrameRate\n                && jingleSession.peerconnection.setDesktopSharingFrameRate(this._desktopSharingFrameRate);\n\n            this.statistics.startRemoteStats(this.jvbJingleSession.peerconnection);\n        } catch (e) {\n            logger.error(e);\n        }\n    }\n\n    /**\n     * Sets the BridgeChannel.\n     *\n     * @param {Object} offerIq - An element pointing to the jingle element of\n     * the offer IQ which may carry the WebSocket URL for the 'websocket'\n     * BridgeChannel mode.\n     * @param {TraceablePeerConnection} pc - The peer connection which will be used\n     * to listen for new WebRTC Data Channels (in the 'datachannel' mode).\n     * @private\n     */\n    private _setBridgeChannel(offerIq: Element, pc: TraceablePeerConnection): void {\n        const ignoreDomain = this.connection?.options?.bridgeChannel?.ignoreDomain;\n        const preferSctp = this.connection?.options?.bridgeChannel?.preferSctp ?? true;\n        const sctpOffered = findAll(offerIq, ':scope>content[name=\"data\"]').length === 1;\n        let wsUrl = null;\n\n        logger.info(`SCTP: offered=${sctpOffered}, prefered=${preferSctp}`);\n\n        if (!(sctpOffered && preferSctp)) {\n            findAll(offerIq, ':scope>content>transport>web-socket')\n                .map(e => e.getAttribute('url'))\n                .forEach(url => {\n                    if (!wsUrl && (!ignoreDomain || ignoreDomain !== new URL(url).hostname)) {\n                        wsUrl = url;\n                        logger.info(`Using colibri-ws url ${url}`);\n                    } else if (!wsUrl) {\n                        logger.info(`Ignoring colibri-ws url with domain ${ignoreDomain}`);\n                    }\n                });\n\n            if (!wsUrl) {\n                const firstWsUrl = findFirst(offerIq, ':scope>content>transport>web-socket');\n\n                if (firstWsUrl) {\n                    wsUrl = firstWsUrl.getAttribute('url');\n                    logger.info(`Falling back to ${wsUrl}`);\n                }\n            }\n        }\n\n        if (wsUrl && !(sctpOffered && preferSctp)) {\n            // If the offer contains a websocket and we don't prefer SCTP use it.\n            this.rtc.initializeBridgeChannel(null, wsUrl);\n        } else if (sctpOffered) {\n            // Otherwise, fall back to an attempt to use SCTP.\n            this.rtc.initializeBridgeChannel(pc.peerconnection, null);\n        } else {\n            logger.warn('Neither SCTP nor a websocket is available. Will not initialize bridge channel.');\n        }\n    }\n\n    /**\n     * Rejects incoming Jingle call.\n     * @param {JingleSessionPC} jingleSession - The session instance to be rejected.\n     * @param {object} [options] - Optional parameters for rejection.\n     * @param {string} options.reason - The name of the reason element as defined by Jingle.\n     * @param {string} options.reasonDescription - The reason description which will be\n     *  included in Jingle 'session-terminate' message.\n     * @param {string} options.errorMsg - An error message to be logged on global error handler.\n     * @private\n     */\n    private _rejectIncomingCall(jingleSession: JingleSessionPC, options: {\n        errorMsg?: string;\n        reason?: string;\n        reasonDescription?: string;\n    }): void {\n        if (options?.errorMsg) {\n            logger.warn(options.errorMsg);\n        }\n\n        // Terminate the jingle session with a reason\n        jingleSession.terminate(\n            null /* success callback => we don't care */,\n            error => {\n                logger.warn(\n                    'An error occurred while trying to terminate'\n                        + ' invalid Jingle session', error);\n            }, {\n                reason: options?.reason,\n                reasonDescription: options?.reasonDescription,\n                sendSessionTerminate: true\n            });\n    }\n\n    /**\n     * Handles an incoming call event for the P2P Jingle session.\n     * @param {JingleSessionPC} jingleSession - The Jingle session for the incoming call.\n     * @param {Element} jingleOffer - An element pointing to 'jingle' IQ element containing the offer.\n     * @private\n     */\n    private _onIncomingCallP2P(jingleSession: JingleSessionPC, jingleOffer: Element): void {\n        let rejectReason;\n        const contentName = getAttribute(findFirst(jingleOffer, ':scope>content'), 'name');\n        const peerUsesUnifiedPlan = contentName === '0' || contentName === '1';\n\n        // Reject P2P between endpoints that are not running in the same mode w.r.t to SDPs (plan-b and unified plan).\n        if (!peerUsesUnifiedPlan) {\n            rejectReason = {\n                errorMsg: 'P2P across two endpoints in different SDP modes is disabled',\n                reason: 'decline',\n                reasonDescription: 'P2P disabled'\n            };\n        } else if ((!this.isP2PEnabled() && !this.isP2PTestModeEnabled())\n            || (browser.isFirefox() && !this._firefoxP2pEnabled)) {\n            rejectReason = {\n                errorMsg: 'P2P mode disabled in the configuration or browser unsupported',\n                reason: 'decline',\n                reasonDescription: 'P2P disabled'\n            };\n        } else if (this.p2pJingleSession) {\n            // Reject incoming P2P call (already in progress)\n            rejectReason = {\n                errorMsg: 'Duplicated P2P \"session-initiate\"',\n                reason: 'busy',\n                reasonDescription: 'P2P already in progress'\n            };\n        } else if (!this._shouldBeInP2PMode()) {\n            rejectReason = {\n                errorMsg: 'Received P2P \"session-initiate\" when should not be in P2P mode',\n                reason: 'decline',\n                reasonDescription: 'P2P requirements not met'\n            };\n            Statistics.sendAnalytics(createJingleEvent(AnalyticsEvents.ACTION_P2P_DECLINED));\n        }\n\n        if (rejectReason) {\n            this._rejectIncomingCall(jingleSession, rejectReason);\n        } else {\n            this._acceptP2PIncomingCall(jingleSession, jingleOffer);\n        }\n    }\n\n\n    /**\n     * Handles CONNECTION_INTERRUPTED event.\n     * @param {JingleSessionPC} session - The Jingle session.\n     * @private\n     */\n    private _onIceConnectionInterrupted(session: JingleSessionPC): void {\n        if (session.isP2P) {\n            this.isP2PConnectionInterrupted = true;\n        } else {\n            this.isJvbConnectionInterrupted = true;\n        }\n        if (session.isP2P === this.isP2PActive()) {\n            this.eventEmitter.emit(JitsiConferenceEvents.CONNECTION_INTERRUPTED);\n        }\n    }\n\n    /**\n     * Handles CONNECTION_ICE_FAILED event.\n     * @param {JingleSessionPC} session - The Jingle session.\n     * @private\n     */\n    private _onIceConnectionFailed(session: JingleSessionPC): void {\n        if (session.isP2P) {\n            // Add p2pFailed property to analytics to distinguish, between \"good\"\n            // and \"bad\" connection\n            Statistics.analytics.addPermanentProperties({ p2pFailed: true });\n\n            if (this.p2pJingleSession) {\n                Statistics.sendAnalyticsAndLog(\n                    createP2PEvent(\n                        AnalyticsEvents.ACTION_P2P_FAILED,\n                        {\n                            initiator: this.p2pJingleSession.isInitiator\n                        }));\n\n            }\n            this._stopP2PSession({\n                reason: 'connectivity-error',\n                reasonDescription: 'ICE FAILED'\n            });\n        } else if (session && this.jvbJingleSession === session && this._iceRestarts < MAX_CONNECTION_RETRIES) {\n            // Use an exponential backoff timer for ICE restarts.\n            const jitterDelay = getJitterDelay(this._iceRestarts, 1000 /* min. delay */);\n\n            this._delayedIceFailed = new IceFailedHandling(this);\n            setTimeout(() => {\n                logger.error(`triggering ice restart after ${jitterDelay} `);\n                this._delayedIceFailed.start();\n                this._iceRestarts++;\n            }, jitterDelay);\n        } else if (this.jvbJingleSession === session) {\n            logger.warn('ICE failed, force reloading the conference after failed attempts to re-establish ICE');\n            Statistics.sendAnalyticsAndLog(\n                createJvbIceFailedEvent(\n                    AnalyticsEvents.ACTION_JVB_ICE_FAILED,\n                    {\n                        participantId: this.myUserId(),\n                        userRegion: this.options.config.deploymentInfo?.userRegion\n                    }));\n            this.eventEmitter.emit(JitsiConferenceEvents.CONFERENCE_FAILED, JitsiConferenceErrors.ICE_FAILED);\n        }\n    }\n\n    /**\n     * Handles CONNECTION_RESTORED event.\n     * @param {JingleSessionPC} session - The Jingle session.\n     * @private\n     */\n    private _onIceConnectionRestored(session: JingleSessionPC): void {\n        if (session.isP2P) {\n            this.isP2PConnectionInterrupted = false;\n        } else {\n            this.isJvbConnectionInterrupted = false;\n            this._delayedIceFailed && this._delayedIceFailed.cancel();\n        }\n\n        if (session.isP2P === this.isP2PActive()) {\n            this.eventEmitter.emit(JitsiConferenceEvents.CONNECTION_RESTORED);\n        }\n    }\n\n    /**\n     * Accepts an incoming P2P Jingle call.\n     * @param {JingleSessionPC} jingleSession - The Jingle session instance.\n     * @param {Element} jingleOffer - An element pointing to 'jingle' IQ element containing the offer.\n     * @private\n     */\n    private _acceptP2PIncomingCall(jingleSession: JingleSessionPC, jingleOffer: Element): void {\n        this.isP2PConnectionInterrupted = false;\n\n        // Accept the offer\n        this.p2pJingleSession = jingleSession;\n        this._sendConferenceJoinAnalyticsEvent();\n\n        this.p2pJingleSession.initialize(\n            this.room,\n            this.rtc,\n            this._signalingLayer,\n            {\n                ...this.options.config,\n                codecSettings: {\n                    codecList: this.qualityController.codecController.getCodecPreferenceList('p2p'),\n                    mediaType: MediaType.VIDEO,\n                    screenshareCodec: this.qualityController.codecController.getScreenshareCodec('p2p')\n                },\n                enableInsertableStreams: this.isE2EEEnabled() || FeatureFlags.isRunInLiteModeEnabled()\n            });\n\n        const localTracks = this.getLocalTracks();\n\n        this.p2pJingleSession.acceptOffer(\n            jingleOffer,\n            () => {\n                logger.debug('Got RESULT for P2P \"session-accept\"');\n\n                this.eventEmitter.emit(\n                    JitsiConferenceEvents._MEDIA_SESSION_STARTED,\n                    jingleSession);\n\n                jingleSession.addEventListener(MediaSessionEvents.VIDEO_CODEC_CHANGED, () => {\n                    this.eventEmitter.emit(JitsiConferenceEvents.VIDEO_CODEC_CHANGED);\n                });\n            },\n            error => {\n                logger.error('Failed to accept incoming P2P Jingle session', error);\n                if (this.p2pJingleSession) {\n                    this.eventEmitter.emit(JitsiConferenceEvents.CONFERENCE_FAILED,\n                        JitsiConferenceErrors.OFFER_ANSWER_FAILED, error);\n                }\n            },\n            localTracks);\n    }\n\n    /**\n     * Adds remote tracks to the conference associated with the JVB session.\n     * @private\n     * @returns {void}\n     */\n    private _addRemoteJVBTracks(): void {\n        this._addRemoteTracks('JVB', this.jvbJingleSession.peerconnection.getRemoteTracks());\n    }\n\n    /**\n     * Adds remote tracks to the conference associated with the P2P session.\n     * @private\n     * @returns {void}\n     */\n    private _addRemoteP2PTracks(): void {\n        this._addRemoteTracks('P2P', this.p2pJingleSession.peerconnection.getRemoteTracks());\n    }\n\n    /**\n     * Generates fake \"remote track added\" events for given Jingle session.\n     * @param {string} logName - The session's nickname which will appear in log messages.\n     * @param {Array<JitsiRemoteTrack>} remoteTracks - The tracks that will be added.\n     * @private\n     */\n    private _addRemoteTracks(logName: string, remoteTracks: JitsiRemoteTrack[]): void {\n        for (const track of remoteTracks) {\n            if (this.participants.has(track.ownerEndpointId)) {\n                logger.info(`Adding remote ${logName} track: ${track}`);\n                this.onRemoteTrackAdded(track);\n            }\n        }\n    }\n\n    /**\n     * Handles the ICE connection establishment event for a Jingle session.\n     * @private\n     * @param {JingleSessionPC} jingleSession - The Jingle session for which ICE connection was established.\n     */\n    private _onIceConnectionEstablished(jingleSession: JingleSessionPC): void {\n        if (this.p2pJingleSession !== null) {\n            // store the establishment time of the p2p session as a field of the\n            // JitsiConference because the p2pJingleSession might get disposed (thus\n            // the value is lost).\n            this.p2pEstablishmentDuration\n                = this.p2pJingleSession.establishmentDuration;\n        }\n\n        if (this.jvbJingleSession !== null) {\n            this.jvbEstablishmentDuration\n                = this.jvbJingleSession.establishmentDuration;\n        }\n\n        let done = false;\n\n        // We don't care about the JVB case, there's nothing to be done\n        if (!jingleSession.isP2P) {\n            done = true;\n        } else if (this.p2pJingleSession !== jingleSession) {\n            logger.error('CONNECTION_ESTABLISHED - wrong P2P session instance ?!');\n\n            done = true;\n        }\n\n        if (isValidNumber(this.p2pEstablishmentDuration)\n                && isValidNumber(this.jvbEstablishmentDuration)) {\n            const establishmentDurationDiff\n                = this.p2pEstablishmentDuration - this.jvbEstablishmentDuration;\n\n            Statistics.sendAnalytics(\n                AnalyticsEvents.ICE_ESTABLISHMENT_DURATION_DIFF,\n                { value: establishmentDurationDiff });\n        }\n\n        if (jingleSession.isP2P === this.isP2PActive()) {\n            this.eventEmitter.emit(JitsiConferenceEvents.CONNECTION_ESTABLISHED);\n        }\n\n        if (done) {\n\n            return;\n        }\n\n        // Update P2P status and emit events\n        this._setP2PStatus(true);\n\n        // Remove remote tracks\n        if (this.jvbJingleSession) {\n            this._removeRemoteJVBTracks();\n        } else {\n            logger.info('Not removing remote JVB tracks - no session yet');\n        }\n\n        this._addRemoteP2PTracks();\n\n        // Stop media transfer over the JVB connection\n        if (this.jvbJingleSession) {\n            this._suspendMediaTransferForJvbConnection();\n        }\n\n        logger.info('Starting remote stats with p2p connection');\n        this.statistics.startRemoteStats(this.p2pJingleSession.peerconnection);\n\n        Statistics.sendAnalyticsAndLog(\n            createP2PEvent(\n                AnalyticsEvents.ACTION_P2P_ESTABLISHED,\n                {\n                    initiator: this.p2pJingleSession.isInitiator\n                }));\n    }\n\n    /**\n     * Called when the chat room reads a new list of properties from jicofo's\n     * presence. The properties may have changed, but they don't have to.\n     *\n     * @param {Object} properties - The properties keyed by the property name\n     * ('key').\n     * @private\n     */\n    private _updateProperties(properties: IConferenceProperties = {}): void {\n        const changed = !isEqual(properties, this.properties);\n\n        this.properties = properties;\n        if (changed) {\n            this.eventEmitter.emit(JitsiConferenceEvents.PROPERTIES_CHANGED, this.properties);\n\n            const audioLimitReached = this.properties['audio-limit-reached'] === 'true';\n            const videoLimitReached = this.properties['video-limit-reached'] === 'true';\n\n            if (this._audioSenderLimitReached !== audioLimitReached) {\n                this._audioSenderLimitReached = audioLimitReached;\n                this.eventEmitter.emit(JitsiConferenceEvents.AUDIO_UNMUTE_PERMISSIONS_CHANGED, audioLimitReached);\n                logger.info(`Audio unmute permissions set by Jicofo to ${audioLimitReached}`);\n            }\n\n            if (this._videoSenderLimitReached !== videoLimitReached) {\n                this._videoSenderLimitReached = videoLimitReached;\n                this.eventEmitter.emit(JitsiConferenceEvents.VIDEO_UNMUTE_PERMISSIONS_CHANGED, videoLimitReached);\n                logger.info(`Video unmute permissions set by Jicofo to ${videoLimitReached}`);\n            }\n\n            // Some of the properties need to be added to analytics events.\n            const analyticsKeys = [\n\n                // The number of jitsi-videobridge instances currently used for the\n                // conference.\n                'bridge-count'\n            ];\n\n            analyticsKeys.forEach(key => {\n                if (properties[key] !== undefined) {\n                    Statistics.analytics.addPermanentProperties({\n                        [key.replace('-', '_')]: properties[key]\n                    });\n                }\n            });\n\n            // Handle changes to aggregate list of visitor codecs.\n            let publishedCodecs = this.properties['visitor-codecs']?.split(',');\n\n            if (publishedCodecs?.length) {\n                publishedCodecs = publishedCodecs.filter(codec => typeof codec === 'string'\n                    && codec.trim().length\n                    && Object.values(CodecMimeType).find(val => val === codec));\n            }\n\n            if (this._visitorCodecs !== publishedCodecs) {\n                this._visitorCodecs = publishedCodecs;\n                this.eventEmitter.emit(JitsiConferenceEvents.CONFERENCE_VISITOR_CODECS_CHANGED, this._visitorCodecs);\n            }\n\n            const oldValue = this._hasVisitors;\n\n            this._hasVisitors = this.properties['visitor-count'] > 0;\n\n            oldValue !== this._hasVisitors && this._maybeStartOrStopP2P(true);\n        }\n    }\n\n    /**\n     * Fires CONFERENCE_FAILED event with INCOMPATIBLE_SERVER_VERSIONS parameter.\n     * @returns {void}\n     * @private\n     */\n    private _fireIncompatibleVersionsEvent(): void {\n        this.eventEmitter.emit(JitsiConferenceEvents.CONFERENCE_FAILED,\n            JitsiConferenceErrors.INCOMPATIBLE_SERVER_VERSIONS);\n    }\n\n    /**\n   * Sends the 'VideoTypeMessage' to the bridge on the bridge channel so that the bridge can make bitrate allocation\n   * decisions based on the video type of the local source.\n   *\n   * @param {JitsiLocalTrack} localtrack - The track associated with the local source signaled to the bridge.\n   * @returns {void}\n   * @internal\n   */\n    _sendBridgeVideoTypeMessage(localtrack: JitsiLocalTrack): void {\n        let videoType = !localtrack || localtrack.isMuted() ? BridgeVideoType.NONE : localtrack.getVideoType();\n\n        if (videoType === VideoType.DESKTOP && this._desktopSharingFrameRate > SS_DEFAULT_FRAME_RATE) {\n            videoType = BridgeVideoType.DESKTOP_HIGH_FPS;\n        }\n\n        localtrack && this.rtc.sendSourceVideoType(localtrack.getSourceName(), videoType);\n    }\n\n    /**\n     * Stops the current JVB jingle session.\n     *\n     * @param {Object} options - options for stopping JVB session.\n     * @param {string} options.reason - One of the Jingle \"reason\" element\n     * names as defined by https://xmpp.org/extensions/xep-0166.html#def-reason\n     * @param {string} options.reasonDescription - Text description that will be included\n     * in the session terminate message.\n     * @param {boolean} options.requestRestart - Whether this is due to\n     * a session restart, in which case, session will be\n     * set to null.\n     * @param {boolean} options.sendSessionTerminate - Whether session-terminate needs to be sent to Jicofo.\n     * @internal\n     */\n    _stopJvbSession(options?: { reason?: string; reasonDescription?: string; requestRestart?: boolean; sendSessionTerminate?: boolean; }): void {\n        const {\n            requestRestart = false,\n            sendSessionTerminate = false\n        } = options;\n\n        if (!this.jvbJingleSession) {\n            logger.error('No JVB session to be stopped');\n\n            return;\n        }\n\n        // Remove remote JVB tracks.\n        !this.isP2PActive() && this._removeRemoteJVBTracks();\n\n        logger.info('Stopping stats for jvb connection');\n        this.statistics.stopRemoteStats(this.jvbJingleSession.peerconnection);\n\n        this.jvbJingleSession.terminate(\n            () => {\n                if (requestRestart && sendSessionTerminate) {\n                    logger.info('session-terminate for ice restart - done');\n                }\n                this.jvbJingleSession = null;\n            },\n            error => {\n                if (requestRestart && sendSessionTerminate) {\n                    logger.error('session-terminate for ice restart failed: reloading the client');\n\n                    // Initiate a client reload if Jicofo responds to the session-terminate with an error.\n                    this.eventEmitter.emit(\n                        JitsiConferenceEvents.CONFERENCE_FAILED,\n                        JitsiConferenceErrors.ICE_FAILED);\n                }\n                logger.error(`An error occurred while trying to terminate the JVB session', reason=${error.reason},`\n                    + `msg=${error.msg}`);\n            },\n            options);\n    }\n\n    /**\n     * Method called by the {@link JitsiLocalTrack} in order to remove the underlying MediaStream from the\n     * RTCPeerConnection.\n     * @param {JitsiLocalTrack} track - The local track that will be removed.\n     * @return {Promise} Resolved when the process is done or rejected with a string which describes the error.\n     * @internal\n     */\n    _removeLocalTrackFromPc(track: JitsiLocalTrack): Promise<PromiseSettledResult<void>[]> {\n        const removePromises = [];\n\n        if (track.conference === this) {\n            if (this.jvbJingleSession) {\n                removePromises.push(this.jvbJingleSession.removeTrackFromPc(track));\n            } else {\n                logger.debug('Remove local MediaStream - no JVB JingleSession started yet');\n            }\n            if (this.p2pJingleSession) {\n                removePromises.push(this.p2pJingleSession.removeTrackFromPc(track));\n            } else {\n                logger.debug('Remove local MediaStream - no P2P JingleSession started yet');\n            }\n        }\n\n        return Promise.allSettled(removePromises);\n    }\n\n\n    /**\n   * Method called by the {@link JitsiLocalTrack} in order to add the underlying MediaStream to the RTCPeerConnection.\n   * @param {JitsiLocalTrack} track - The local track that will be added to the pc.\n   * @return {Promise} Resolved when the process is done or rejected with a string which describes the error.\n   * @internal\n   */\n    async _addLocalTrackToPc(track: JitsiLocalTrack): Promise<void> {\n        const addPromises = [];\n\n        if (track.conference === this) {\n            if (this.jvbJingleSession) {\n                addPromises.push(this.jvbJingleSession.addTrackToPc(track));\n            } else {\n                logger.debug('Add local MediaStream - no JVB Jingle session started yet');\n            }\n\n            if (this.p2pJingleSession) {\n                addPromises.push(this.p2pJingleSession.addTrackToPc(track));\n            } else {\n                logger.debug('Add local MediaStream - no P2P Jingle session started yet');\n            }\n        } else {\n            // If the track hasn't been added to the conference yet because of start muted by focus, add it to the\n            // conference instead of adding it only to the media sessions.\n            addPromises.push(this.addTrack(track));\n        }\n\n        await Promise.allSettled(addPromises);\n    }\n\n\n    /**\n   * Sets mute status.\n   * @param {JitsiLocalTrack} localTrack - The local track.\n   * @param {boolean} isMuted - Whether the track is muted.\n   * @return {boolean} <tt>true</tt> when presence was changed, <tt>false</tt> otherwise.\n   * @internal\n   */\n    _setTrackMuteStatus(localTrack: JitsiLocalTrack, isMuted: boolean): boolean {\n        let presenceChanged = false;\n\n        if (localTrack) {\n            presenceChanged = this._signalingLayer.setTrackMuteStatus(localTrack.getSourceName(), isMuted) || false;\n            presenceChanged && logger.debug(`Mute state of ${localTrack} changed to muted=${isMuted}`);\n        }\n\n        return presenceChanged;\n    }\n\n\n    /**\n     * Updates conference startMuted policy if needed and fires an event.\n     * @param {boolean} audio - Whether audio should be muted.\n     * @param {boolean} video - Whether video should be muted.\n     * @returns {void}\n     * @internal\n     */\n    _updateStartMutedPolicy(audio: boolean, video: boolean): void {\n        // Update the start muted policy for the conference only if the meta data is received before conference join.\n        if (this.isJoined()) {\n            return;\n        }\n\n        let updated = false;\n\n        if (audio !== this.startMutedPolicy.audio) {\n            this.startMutedPolicy.audio = audio;\n            updated = true;\n        }\n\n        if (video !== this.startMutedPolicy.video) {\n            this.startMutedPolicy.video = video;\n            updated = true;\n        }\n        if (updated) {\n            this.eventEmitter.emit(\n                JitsiConferenceEvents.START_MUTED_POLICY_CHANGED,\n                this.startMutedPolicy\n            );\n        }\n    }\n\n    /**\n     * Set the transcribingEnabled flag. When transcribing is enabled, p2p is disabled.\n     * @param {boolean} enabled - Whether transcribing should be enabled.\n     * @internal\n     */\n    _setTranscribingEnabled(enabled: boolean): void {\n        if (this._transcribingEnabled !== enabled) {\n            this._transcribingEnabled = enabled;\n            this._maybeStartOrStopP2P(true);\n        }\n    }\n\n\n    /**\n     * Get notified when we joined the room.\n     *\n     * @internal\n     */\n    _onMucJoined(): void {\n        this._numberOfParticipantsOnJoin = this.getParticipantCount();\n        this._maybeStartOrStopP2P();\n    }\n\n    /**\n     * Get notified when member bot type had changed.\n     * @param jid the member jid\n     * @param botType the new botType value\n     * @internal\n     */\n    _onMemberBotTypeChanged(jid: string, botType: string): void {\n\n        // find the participant and mark it as non bot, as the real one will join\n        // in a moment\n        const peers = this.getParticipants();\n        const botParticipant = peers.find(p => p.getJid() === jid);\n\n        if (botParticipant) {\n            botParticipant.setBotType(botType);\n            const id = Strophe.getResourceFromJid(jid);\n\n            this.eventEmitter.emit(\n                JitsiConferenceEvents.BOT_TYPE_CHANGED,\n                id,\n                botType);\n        }\n\n        // if botType changed to undefined, botType was removed, in case of\n        // poltergeist mode this is the moment when the poltergeist had exited and\n        // the real participant had already replaced it.\n        // In this case we can check and try p2p\n        if (!botParticipant.getBotType()) {\n            this._maybeStartOrStopP2P();\n        }\n    }\n\n\n    /**\n     * Handles the suspend detected event. Leaves the room and fires suspended.\n     * @param {JingleSessionPC} jingleSession - The Jingle session.\n     * @internal\n     */\n    onSuspendDetected(jingleSession: JingleSessionPC): void {\n        if (!jingleSession.isP2P) {\n            this.leave();\n            this.eventEmitter.emit(JitsiConferenceEvents.SUSPEND_DETECTED);\n        }\n    }\n\n\n    /**\n     * Joins the conference.\n     * @param password {string} the password\n     * @param replaceParticipant {boolean} whether the current join replaces\n     * an existing participant with same jwt from the meeting.\n     */\n    public join(password: string = '', replaceParticipant: boolean = false) {\n        if (this.room) {\n            this.room.join(password, replaceParticipant).then(() => this._maybeSetSITimeout());\n        }\n    }\n\n    /**\n     * Connects to the XMPP server using the specified credentials and contacts\n     * Jicofo in order to obtain a session ID (which is then stored in the local\n     * storage). The user's role of the parent conference will be upgraded to\n     * moderator (by Jicofo). It's also used to join the conference when starting\n     * from anonymous domain and only authenticated users are allowed to create new\n     * rooms.\n     *\n     * @param options - Options for authentication and upgrade.\n     * @returns A thenable which settles when the process finishes and has a cancel method.\n     * @internal\n     */\n    authenticateAndUpgradeRole({\n        id,\n        password,\n        onCreateResource,\n\n        // 2. Let the API client/consumer know as soon as the XMPP user has been\n        //    successfully logged in.\n        onLoginSuccessful\n    }: IAuthenticateAndUpgradeRoleOptions): Promise<void> {\n        let canceled = false;\n        let rejectPromise: (reason?: IUpgradeRoleError | {}) => void;\n        let xmpp: XMPP = new XMPP(this.connection.options, undefined);\n\n        const process = new Promise<void>((resolve, reject) => {\n            // The process is represented by a Thenable with a cancel method. The\n            // Thenable is implemented using Promise and the cancel using the\n            // Promise's reject function.\n            rejectPromise = reject;\n            xmpp.addListener(\n                JitsiConnectionEvents.CONNECTION_DISCONNECTED,\n                () => {\n                    xmpp = undefined;\n                });\n            xmpp.addListener(\n                JitsiConnectionEvents.CONNECTION_ESTABLISHED,\n                () => {\n                    if (canceled) {\n                        return;\n                    }\n\n                    // Let the caller know that the XMPP login was successful.\n                    onLoginSuccessful?.();\n                    const { config } = this.options;\n\n                    // Now authenticate with Jicofo and get a new session ID.\n                    const room = xmpp.createRoom(\n                    this.options.name,\n                    {\n                        ...config,\n                        statsId: this._statsCurrentId\n                    },\n                    onCreateResource\n                    );\n\n                    room.xmpp.moderator.authenticate(room.roomjid)\n                    .then(() => {\n                        xmpp?.disconnect();\n\n                        if (canceled) {\n                            return;\n                        }\n\n                        // we execute this logic in JitsiConference where we bind the current conference as `this`\n                        // At this point we should have the new session ID\n                        // stored in the settings. Send a new conference IQ.\n                        this.room.xmpp.moderator.sendConferenceRequest(this.room.roomjid)\n                            .catch(e => logger.trace('sendConferenceRequest rejected', e))\n                            .finally(() => {\n                                // we need to reset it because of breakout rooms which will\n                                // reuse connection but will invite jicofo\n                                this.room.xmpp.moderator.conferenceRequestSent = false;\n\n                                resolve(undefined);\n                            });\n                    })\n                    .catch(({ error, message }) => {\n                        xmpp.disconnect();\n\n                        reject({\n                            authenticationError: error,\n                            message\n                        });\n                    });\n                });\n            xmpp.addListener(\n                JitsiConnectionEvents.CONNECTION_FAILED,\n                (connectionError: JitsiConnectionEvents, message: string, credentials: { jid?: string; password?: string; }) => {\n                    reject({\n                        connectionError,\n                        credentials,\n                        message\n                    });\n                    xmpp = undefined;\n                });\n\n            canceled || xmpp.connect(id, password);\n        });\n\n        /**\n     * Cancels the process, if it's in progress, of authenticating and upgrading\n     * the role of the local participant/user.\n     *\n     * @public\n     * @returns {void}\n     */\n        (process as IProcessWithCancel).cancel = () => {\n            canceled = true;\n            rejectPromise({});\n            xmpp?.disconnect();\n        };\n\n        return process;\n    }\n\n    /**\n   * Check if joined to the conference.\n   * @returns {boolean} True if joined, false otherwise.\n   */\n    public isJoined(): boolean {\n        return this.room?.joined;\n    }\n\n    /**\n   * Tells whether or not the P2P mode is enabled in the configuration.\n   * @returns {boolean} True if P2P is enabled, false otherwise.\n   */\n    public isP2PEnabled(): boolean {\n        return (\n            Boolean(this.options.config.p2p?.enabled)\n\n      // FIXME: remove once we have a default config template. -saghul\n      || typeof this.options.config.p2p === 'undefined'\n        );\n    }\n\n    /**\n   * When in P2P test mode, the conference will not automatically switch to P2P\n   * when there are 2 participants.\n   * @returns {boolean} True if P2P test mode is enabled, false otherwise.\n   */\n    public isP2PTestModeEnabled(): boolean {\n        return Boolean(\n      this.options.config.testing?.p2pTestMode\n        );\n    }\n\n    /**\n   * Leaves the conference.\n   * @param {string|undefined} reason - The reason for leaving the conference.\n   * @returns {Promise}\n   */\n    public async leave(reason?: string): Promise<void> {\n        if (this.avgRtpStatsReporter) {\n            this.avgRtpStatsReporter.dispose();\n            this.avgRtpStatsReporter = null;\n        }\n\n        if (this.e2eping) {\n            this.e2eping.stop();\n            this.e2eping = null;\n        }\n\n        this.getLocalTracks().forEach(track => this.onLocalTrackRemoved(track));\n\n        this.rtc.closeBridgeChannel();\n\n        this._sendConferenceLeftAnalyticsEvent();\n\n        if (this.statistics) {\n            this.statistics.dispose();\n        }\n\n        this._delayedIceFailed && this._delayedIceFailed.cancel();\n\n        this._maybeClearSITimeout();\n\n        // Close both JVb and P2P JingleSessions\n        if (this.jvbJingleSession) {\n            this.jvbJingleSession.close();\n            this.jvbJingleSession = null;\n        }\n        if (this.p2pJingleSession) {\n            this.p2pJingleSession.close();\n            this.p2pJingleSession = null;\n        }\n\n        // Leave the conference. If this.room == null we are calling second time leave().\n        if (!this.room) {\n            return;\n        }\n\n        // let's check is this breakout\n        if (reason === 'switch_room' && this.getBreakoutRooms()?.isBreakoutRoom()) {\n            const mJid = this.getBreakoutRooms().getMainRoomJid();\n\n            this.xmpp.connection._breakoutMovingToMain = mJid;\n        }\n\n        const room = this.room;\n\n        // Unregister connection state listeners\n        room.removeListener(\n            XMPPEvents.CONNECTION_INTERRUPTED,\n            this._onIceConnectionInterrupted\n        );\n        room.removeListener(\n            XMPPEvents.CONNECTION_RESTORED,\n            this._onIceConnectionRestored\n        );\n        room.removeListener(\n            XMPPEvents.CONNECTION_ESTABLISHED,\n            this._onIceConnectionEstablished\n        );\n\n        room.removeListener(\n            XMPPEvents.CONFERENCE_PROPERTIES_CHANGED,\n            this._updateProperties\n        );\n\n        room.removeListener(XMPPEvents.MEETING_ID_SET, this._sendConferenceJoinAnalyticsEvent);\n        room.removeListener(XMPPEvents.SESSION_ACCEPT, this._updateRoomPresence);\n        room.removeListener(XMPPEvents.SOURCE_ADD, this._updateRoomPresence);\n        room.removeListener(XMPPEvents.SOURCE_ADD_ERROR, this._removeLocalSourceOnReject);\n        room.removeListener(XMPPEvents.SOURCE_REMOVE, this._updateRoomPresence);\n\n        this.eventManager.removeXMPPListeners();\n\n        this._signalingLayer.setChatRoom(null);\n\n        this.room = null;\n\n        let leaveError;\n\n        try {\n            await room.leave(reason);\n        } catch (err) {\n            leaveError = err;\n\n            // Remove all participants because currently the conference\n            // won't be usable anyway. This is done on success automatically\n            // by the ChatRoom instance.\n            this.getParticipants().forEach(\n        participant => this.onMemberLeft(participant.getJid())\n            );\n        }\n\n        if (this.qualityController) {\n            this.qualityController.dispose();\n        }\n\n        if (this.rtc) {\n            this.rtc.destroy();\n        }\n\n        if (leaveError) {\n            throw leaveError;\n        }\n    }\n\n    /**\n   * Disposes of conference resources. This operation is a short-hand for leaving\n   * the conference and disconnecting the connection.\n   * @returns {Promise}\n   */\n    public async dispose(): Promise<void> {\n        await this.leave();\n        await this.connection?.disconnect();\n    }\n\n    /**\n   * Returns true if end conference support is enabled in the backend.\n   * @returns {boolean} whether end conference is supported in the backend.\n   */\n    public isEndConferenceSupported(): boolean {\n        return Boolean(this.room?.xmpp.endConferenceComponentAddress);\n    }\n\n    /**\n   * Ends the conference.\n   */\n    public end(): void {\n        if (!this.isEndConferenceSupported()) {\n            logger.warn('Cannot end conference: is not supported.');\n\n            return;\n        }\n        if (!this.room) {\n            throw new Error('You have already left the conference');\n        }\n\n        this.room.end();\n    }\n\n    /**\n   * Returns the currently active media session if any.\n   * @returns {Optional<JingleSessionPC>}\n   */\n    public getActiveMediaSession(): Optional<JingleSessionPC> {\n        return this.isP2PActive() ? this.p2pJingleSession : this.jvbJingleSession;\n    }\n\n    /**\n   * Returns an array containing all media sessions existing in this conference.\n   * @returns {Array<JingleSessionPC>}\n   */\n    public getMediaSessions(): JingleSessionPC[] {\n        const sessions = [];\n\n        this.jvbJingleSession && sessions.push(this.jvbJingleSession);\n        this.p2pJingleSession && sessions.push(this.p2pJingleSession);\n\n        return sessions;\n    }\n\n    /**\n   * Returns name of this conference.\n   * @returns {string}\n   */\n    public getName(): string {\n        return this.options.name.toString();\n    }\n\n    /**\n   * Returns the {@link JitsiConnection} used by this conference.\n   * @returns {JitsiConnection}\n   */\n    public getConnection(): JitsiConnection {\n        return this.connection;\n    }\n\n    /**\n   * Check if authentication is enabled for this conference.\n   * @returns {boolean}\n   */\n    public isAuthEnabled(): boolean {\n        return this.authEnabled;\n    }\n\n    /**\n   * Check if user is logged in.\n   * @returns {boolean}\n   */\n    public isLoggedIn(): boolean {\n        return Boolean(this.authIdentity);\n    }\n\n    /**\n   * Get authorized login.\n   * @returns {string|null}\n   */\n    public getAuthLogin(): Nullable<string> {\n        return this.authIdentity;\n    }\n\n    /**\n   * Returns the local tracks of the given media type, or all local tracks if no\n   * specific type is given.\n   * @param {MediaType} [mediaType] Optional media type (audio or video).\n   * @returns {Array<JitsiLocalTrack>}\n   */\n    public getLocalTracks(mediaType?: MediaType): JitsiLocalTrack[] {\n        let tracks = [];\n\n        if (this.rtc) {\n            tracks = this.rtc.getLocalTracks(mediaType);\n        }\n\n        return tracks;\n    }\n\n    /**\n   * Obtains local audio track.\n   * @returns {JitsiLocalTrack|null}\n   */\n    public getLocalAudioTrack(): Nullable<JitsiLocalTrack> {\n        return this.rtc ? this.rtc.getLocalAudioTrack() : null;\n    }\n\n    /**\n   * Obtains local video track.\n   * @returns {JitsiLocalTrack|null}\n   */\n    public getLocalVideoTrack(): Nullable<JitsiLocalTrack> {\n        return this.rtc ? this.rtc.getLocalVideoTrack() : null;\n    }\n\n    /**\n   * Returns all the local video tracks.\n   * @returns {Array<JitsiLocalTrack>|null}\n   */\n    public getLocalVideoTracks(): Nullable<JitsiLocalTrack[]> {\n        return this.rtc ? this.rtc.getLocalVideoTracks() : null;\n    }\n\n    /**\n   * Receives notifications from other participants about commands / custom events\n   * (sent by sendCommand or sendCommandOnce methods).\n   * @param {string} command - The name of the command.\n   * @param {Function} handler - Handler for the command.\n   */\n    public addCommandListener(command: string, handler: PresenceHandler): void {\n        if (this.room) {\n            this.room.addPresenceListener(command, handler);\n        }\n    }\n\n    /**\n   * Removes command listener.\n   * @param {string} command - The name of the command.\n   * @param {Function} handler - Handler to remove for the command.\n   */\n    public removeCommandListener(command: string, handler: PresenceHandler): void {\n        if (this.room) {\n            this.room.removePresenceListener(command, handler);\n        }\n    }\n\n    /**\n    /**\n   * Sends text message to the other participants in the conference.\n   * @param {string} message - The text message.\n   * @param {string} [elementName='body'] - The element name to encapsulate the message.\n   * @param {string} [replyToId] - The ID of the message being replied to.\n   * @deprecated Use 'sendMessage' instead. TODO: this should be private.\n   */\n    public sendTextMessage(message: string, elementName: string = 'body', replyToId?: string): void {\n        if (this.room) {\n            this.room.sendMessage(message, elementName, replyToId);\n        }\n    }\n\n    /**\n   * Sends a reaction to the other participants in the conference.\n   * @param {string} reaction - The reaction.\n   * @param {string} messageId - The ID of the message to attach the reaction to.\n   * @param {string} receiverId - The intended recipient, if the message is private.\n   */\n    public sendReaction(reaction: string, messageId: string, receiverId: string): void {\n        if (this.room) {\n            this.room.sendReaction(reaction, messageId, receiverId);\n        }\n    }\n\n    /**\n   * Sends private text message to another participant of the conference.\n   * @param {string} id - The ID of the participant to send a private message.\n   * @param {string} message - The text message.\n   * @param {string} [elementName='body'] - The element name to encapsulate the message.\n   * @param {boolean} [useFullJid=false] - Whether to use the full JID.\n   * @param {string} [replyToId] - The ID of the message being replied to.\n   * @deprecated Use 'sendMessage' instead. TODO: this should be private.\n   */\n    public sendPrivateTextMessage(id: string, message: string, elementName: string = 'body', useFullJid = false, replyToId?: string): void {\n        if (this.room) {\n            this.room.sendPrivateMessage(id, message, elementName, useFullJid, replyToId);\n        }\n    }\n\n    /**\n   * Send presence command.\n   * @param {string} name - The name of the command.\n   * @param {Record<string, unknown>} values - With keys and values that will be sent.\n   */\n    public sendCommand(name: string, values: Record<string, unknown>): void {\n        if (this.room) {\n            this.room.addOrReplaceInPresence(name, values) && this.room.sendPresence();\n        } else {\n            logger.warn('Not sending a command, room not initialized.');\n        }\n    }\n\n    /**\n   * Send presence command one time.\n   * @param {string} name - The name of the command.\n   * @param {Record<string, unknown>} values - With keys and values that will be sent.\n   */\n    public sendCommandOnce(name: string, values: Record<string, unknown>): void {\n        this.sendCommand(name, values);\n        this.removeCommand(name);\n    }\n\n    /**\n   * Removes presence command.\n   * @param {string} name - The name of the command.\n   */\n    public removeCommand(name: string): void {\n        if (this.room) {\n            this.room.removeFromPresence(name);\n        }\n    }\n\n    /**\n   * Sets the display name for this conference.\n   * @param {string} name - The display name to set.\n   */\n    public setDisplayName(name: string): void {\n        if (this.room) {\n            const nickKey = 'nick';\n\n            if (name) {\n                this.room.addOrReplaceInPresence(nickKey, {\n                    attributes: { xmlns: 'http://jabber.org/protocol/nick' },\n                    value: name\n                }) && this.room.sendPresence(false);\n            } else if (this.room.getFromPresence(nickKey)) {\n                this.room.removeFromPresence(nickKey);\n                this.room.sendPresence(false);\n            }\n        }\n    }\n\n    /**\n   * Set join without audio.\n   * @param {boolean} silent - Whether user joined without audio.\n   */\n    public setIsSilent(silent: boolean): void {\n        if (this.room) {\n            this.room.addOrReplaceInPresence('silent', {\n                attributes: { xmlns: 'http://jitsi.org/protocol/silent' },\n                value: silent\n            }) && this.room.sendPresence(false);\n        }\n    }\n\n    /**\n   * Set new subject for this conference. (Available only for moderator)\n   * @param {string} subject - New subject.\n   */\n    public setSubject(subject: string): void {\n        if (this.room && this.isModerator()) {\n            this.room.setSubject(subject);\n        } else {\n            logger.warn(`Failed to set subject, ${this.room ? '' : 'not in a room, '}${\n                this.isModerator() ? '' : 'participant is not a moderator'}`);\n        }\n    }\n\n    /**\n   * Returns the transcription status.\n   * @returns {string} \"on\" or \"off\".\n   */\n    public getTranscriptionStatus(): string {\n        return this.room.transcriptionStatus;\n    }\n\n    /**\n   * Adds JitsiLocalTrack object to the conference.\n   * @param {JitsiLocalTrack} track - The JitsiLocalTrack object.\n   * @returns {Promise<void>}\n   * @throws {Error} If the specified track is a video track and there is already\n   * another video track in the conference.\n   */\n    public addTrack(track: JitsiLocalTrack): Promise<void> {\n        if (!track) {\n            throw new Error('addTrack - a track is required');\n        }\n\n        const mediaType = track.getType();\n        const localTracks = this.rtc.getLocalTracks(mediaType);\n\n        // Ensure there's exactly 1 local track of each media type in the conference.\n        if (localTracks.length > 0) {\n            // Don't be excessively harsh and severe if the API\n            // client happens to attempt to add the same local track twice.\n            if (track === localTracks[0]) {\n                return Promise.resolve();\n            }\n\n            // Currently, only adding multiple video streams of different video types is supported.\n            // TODO - remove this limitation once issues with jitsi-meet trying to add multiple camera streams is fixed.\n            if (\n                this.options.config.testing?.allowMultipleTracks\n                || (mediaType === MediaType.VIDEO && !localTracks.find(t =>\n                    t.getVideoType() === track.getVideoType()))) {\n                const sourceName = getSourceNameForJitsiTrack(\n                    this.myUserId(),\n                    mediaType,\n                    this.getLocalTracks(mediaType)?.length);\n\n                track.setSourceName(sourceName);\n                const addTrackPromises = [];\n\n                this.p2pJingleSession && addTrackPromises.push(this.p2pJingleSession.addTracks([ track ]));\n                this.jvbJingleSession && addTrackPromises.push(this.jvbJingleSession.addTracks([ track ]));\n\n                return Promise.all(addTrackPromises)\n                    .then(() => {\n                        this._setupNewTrack(track);\n                        mediaType === MediaType.VIDEO && this._sendBridgeVideoTypeMessage(track);\n                        this._updateRoomPresence(this.getActiveMediaSession());\n\n                        if (this.isMutedByFocus || this.isVideoMutedByFocus || this.isDesktopMutedByFocus) {\n                            this._fireMuteChangeEvent(track);\n                        }\n                    });\n            }\n\n            return Promise.reject(new Error(`Cannot add second ${mediaType} track to the conference`));\n        }\n\n        return this.replaceTrack(null, track)\n            .then(() => {\n                // Presence needs to be sent here for desktop track since we need the presence to reach the remote peer\n                // before signaling so that a fake participant tile is created for screenshare. Otherwise, presence will\n                // only be sent after a session-accept or source-add is ack'ed.\n                if (track.getVideoType() === VideoType.DESKTOP) {\n                    this._updateRoomPresence(this.getActiveMediaSession());\n                }\n            });\n    }\n\n    /**\n   * Clear JitsiLocalTrack properties and listeners.\n   * @param {JitsiLocalTrack} track - The JitsiLocalTrack object.\n   * @internal\n   */\n    onLocalTrackRemoved(track: JitsiLocalTrack): void {\n        track.setConference(null);\n        this.rtc.removeLocalTrack(track);\n        this._unsubscribers.forEach(remove => remove());\n        this._unsubscribers = [];\n\n        this.eventEmitter.emit(JitsiConferenceEvents.TRACK_REMOVED, track);\n    }\n\n    /**\n   * Removes JitsiLocalTrack from the conference and performs\n   * a new offer/answer cycle.\n   * @param {JitsiLocalTrack} track - The track to remove.\n   * @returns {Promise}\n   */\n    public removeTrack(track: JitsiLocalTrack): Promise<void> {\n        return this.replaceTrack(track, null);\n    }\n\n    /**\n   * Replaces oldTrack with newTrack and performs a single offer/answer\n   * cycle after both operations are done. Either oldTrack or newTrack\n   * can be null; replacing a valid 'oldTrack' with a null 'newTrack'\n   * effectively just removes 'oldTrack'\n   * @param {JitsiLocalTrack} oldTrack - The current stream in use to be replaced.\n   * @param {JitsiLocalTrack} newTrack - The new stream to use.\n   * @returns {Promise} Resolves when the replacement is finished.\n   */\n    public replaceTrack(oldTrack?: JitsiLocalTrack, newTrack?: JitsiLocalTrack): Promise<void> {\n        const oldVideoType = oldTrack?.getVideoType();\n        const mediaType = oldTrack?.getType() || newTrack?.getType();\n        const newVideoType = newTrack?.getVideoType();\n\n        if (oldTrack && newTrack && oldVideoType !== newVideoType) {\n            throw new Error(\n                `Replacing a track of videoType=${oldVideoType} with a track of videoType=${newVideoType} is`\n                + ' not supported in this mode.');\n        }\n\n        if (newTrack) {\n            const sourceName = oldTrack\n                ? oldTrack.getSourceName()\n                : getSourceNameForJitsiTrack(\n                    this.myUserId(),\n                    mediaType,\n                    this.getLocalTracks(mediaType)?.length);\n\n            newTrack.setSourceName(sourceName);\n        }\n        const oldTrackBelongsToConference = this === oldTrack?.conference;\n\n        if (oldTrackBelongsToConference && oldTrack.disposed) {\n            return Promise.reject(new JitsiTrackError(JitsiTrackErrors.TRACK_IS_DISPOSED));\n        }\n        if (newTrack?.disposed) {\n            return Promise.reject(new JitsiTrackError(JitsiTrackErrors.TRACK_IS_DISPOSED));\n        }\n\n        if (oldTrack && !oldTrackBelongsToConference) {\n            logger.warn(`JitsiConference.replaceTrack oldTrack (${oldTrack} does not belong to this conference`);\n        }\n\n\n        // Now replace the stream at the lower levels\n        return this._doReplaceTrack(oldTrackBelongsToConference ? oldTrack : null, newTrack)\n            .then(() => {\n                if (oldTrackBelongsToConference && !oldTrack.isMuted() && !newTrack) {\n                    oldTrack._sendMuteStatus(true);\n                }\n                oldTrackBelongsToConference && this.onLocalTrackRemoved(oldTrack);\n                newTrack && this._setupNewTrack(newTrack);\n\n                // Send 'VideoTypeMessage' on the bridge channel when a video track is added/removed.\n                if ((oldTrackBelongsToConference && oldTrack?.isVideoTrack()) || newTrack?.isVideoTrack()) {\n                    this._sendBridgeVideoTypeMessage(newTrack);\n                }\n                this._updateRoomPresence(this.getActiveMediaSession());\n                if (newTrack !== null && (this.isMutedByFocus || this.isVideoMutedByFocus\n                        || this.isDesktopMutedByFocus)) {\n                    this._fireMuteChangeEvent(newTrack);\n                }\n\n                return Promise.resolve();\n            })\n            .catch(error => {\n                logger.error(`replaceTrack failed: ${error?.stack}`);\n\n                return Promise.reject(error);\n            });\n    }\n\n    /**\n   * Get role of the local user.\n   * @returns {string} User role: 'moderator' or 'none'.\n   */\n    public getRole(): string {\n        return this.room.role;\n    }\n\n    /**\n     * Returns whether or not the current conference has been joined as a hidden user.\n     * @returns {boolean} True if hidden, false otherwise. Will return false if no connection is active.\n     */\n    public isHidden(): boolean {\n        if (!this.connection) {\n            return false;\n        }\n\n        return Strophe.getDomainFromJid(this.connection.getJid())\n             === this.options.config.hiddenDomain;\n    }\n\n    /**\n     * Check if local user is moderator.\n     * @returns {boolean} true if local user is moderator, false otherwise. If\n     * we're no longer in the conference room then <tt>false</tt> is returned.\n     */\n    public isModerator(): boolean {\n        return this.room ? this.room.isModerator() : false;\n    }\n\n    /**\n     * Set password for the room.\n     * @param {string} password new password for the room.\n     * @returns {Promise}\n     */\n    public lock(password: string): Promise<void> {\n        if (!this.isModerator()) {\n            return Promise.reject(new Error('You are not moderator.'));\n        }\n\n        return new Promise((resolve, reject) => {\n            this.room.lockRoom(\n                password || '',\n                () => resolve(),\n                (err: Error) => reject(err),\n                () => reject(JitsiConferenceErrors.PASSWORD_NOT_SUPPORTED)\n            );\n        });\n    }\n\n    /**\n     * Remove password from the room.\n     * @returns {Promise}\n     */\n    public unlock(): Promise<void> {\n        return this.lock('');\n    }\n\n    /**\n     * Obtains the current value for \"lastN\". See {@link setLastN} for more info.\n     * @returns {number}\n     */\n    public getLastN(): number {\n        return this.qualityController.receiveVideoController.getLastN();\n    }\n\n    /**\n     * Obtains the forwarded sources list in this conference.\n     * @return {Array<string>}\n     * @internal\n     */\n    getForwardedSources(): string[] {\n        return this.rtc.getForwardedSources();\n    }\n\n    /**\n     * Sets the audio subscription mode for the local user.\n     *\n     * @param {IReceiverAudioSubscriptionMessage} message - The audio subscription mode to set.\n     * @returns {void}\n     */\n    public setAudioSubscriptionMode(message: IReceiverAudioSubscriptionMessage): void {\n        this.qualityController.audioController.setAudioSubscriptionMode(message);\n    }\n\n    /**\n     * Selects a new value for \"lastN\". The requested amount of videos are going\n     * to be delivered after the value is in effect. Set to -1 for unlimited or\n     * all available videos.\n     * @param lastN the new number of videos the user would like to receive.\n     * @throws Error or RangeError if the given value is not a number or is smaller\n     * than -1.\n     */\n    public setLastN(lastN: number): void {\n        if (!Number.isInteger(lastN)) {\n            throw new Error(`Invalid value for lastN: ${lastN}`);\n        }\n        const n = Number(lastN);\n\n        if (n < -1) {\n            throw new RangeError('lastN cannot be smaller than -1');\n        }\n        this.qualityController.receiveVideoController.setLastN(n);\n\n        // If the P2P session is not fully established yet, we wait until it gets established.\n        if (this.p2pJingleSession) {\n            const isVideoActive = n !== 0;\n\n            this.p2pJingleSession\n                .setP2pVideoTransferActive(isVideoActive)\n                .catch(error => {\n                    logger.error(`Failed to adjust video transfer status (${isVideoActive})`, error);\n                });\n        }\n    }\n\n    /**\n     * @return Array<JitsiParticipant> an array of all participants in this conference.\n     */\n    public getParticipants(): JitsiParticipant[] {\n        return Array.from(this.participants.values());\n    }\n\n    /**\n     * Returns the number of participants in the conference, including the local\n     * participant.\n     * @param countHidden {boolean} Whether or not to include hidden participants\n     * in the count. Default: false.\n     **/\n    public getParticipantCount(countHidden = false): number {\n        let participants = this.getParticipants();\n\n        if (!countHidden) {\n            participants = participants.filter(p => !p.isHidden());\n        }\n\n        // Add one for the local participant.\n        return participants.length + 1;\n    }\n\n    /**\n     * @returns {JitsiParticipant} the participant in this conference with the\n     * specified id (or undefined if there isn't one).\n     * @param id the id of the participant.\n     */\n    public getParticipantById(id: string): Optional<JitsiParticipant> {\n        return this.participants.get(id);\n    }\n\n    /**\n     * Grant owner rights to the participant.\n     * @param {string} id id of the participant to grant owner rights to.\n     */\n    public grantOwner(id: string): void {\n        const participant = this.getParticipantById(id);\n\n        if (!participant) {\n            return;\n        }\n        this.room.setAffiliation(participant.getConnectionJid(), 'owner');\n    }\n\n    /**\n     * Revoke owner rights to the participant or local Participant as\n     * the user might want to refuse to be a moderator.\n     * @param {string} id id of the participant to revoke owner rights to.\n     */\n    public revokeOwner(id: string): void {\n        const participant = this.getParticipantById(id);\n        const isMyself = this.myUserId() === id;\n        const role = this.isMembersOnly() ? 'member' : 'none';\n\n        if (isMyself) {\n            this.room.setAffiliation(this.connection.getJid(), role);\n        } else if (participant) {\n            this.room.setAffiliation(participant.getConnectionJid(), role);\n        }\n    }\n\n    /**\n     * Kick participant from this conference.\n     * @param {string} id id of the participant to kick\n     * @param {string} reason reason of the participant to kick\n     */\n    public kickParticipant(id: string, reason: string): void {\n        const participant = this.getParticipantById(id);\n\n        if (!participant) {\n            return;\n        }\n        this.room.kick(participant.getJid(), reason);\n    }\n\n    /**\n     * Mutes or unmutes the remote audio streams based on the provided parameter.\n     *\n     * @param {boolean} muted - Whether the user should stop receiving remote audio.\n     * @returns {void}\n     */\n    public muteRemoteAudio(muted: boolean): void {\n        this.qualityController.audioController.muteRemoteAudio(muted);\n    }\n\n    /**\n     * Mutes a participant.\n     * @param {string} id The id of the participant to mute.\n     */\n    public muteParticipant(id: string, mediaType: MediaType = MediaType.AUDIO): void {\n        if (!mediaType) {\n            logger.error(`Unsupported media type: ${mediaType}`);\n\n            return;\n        }\n\n        const participant = this.getParticipantById(id);\n\n        if (!participant) {\n            return;\n        }\n\n        this.room.muteParticipant(participant.getJid(), true, mediaType);\n    }\n\n\n    /* eslint-disable max-params */\n\n    /**\n     * Notifies this JitsiConference that a new member has joined its chat room.\n     *\n     * FIXME This should NOT be exposed!\n     *\n     * @param jid the jid of the participant in the MUC\n     * @param nick the display name of the participant\n     * @param role the role of the participant in the MUC\n     * @param isHidden indicates if this is a hidden participant (system\n     * participant for example a recorder).\n     * @param statsID the participant statsID (optional)\n     * @param status the initial status if any\n     * @param identity the member identity, if any\n     * @param botType the member botType, if any\n     * @param fullJid the member full jid, if any\n     * @param features the member features, if any.\n     * @param isReplaceParticipant whether this join replaces a participant with\n     * the same jwt.\n     * @internal\n     */\n    onMemberJoined(\n            jid: string, nick: string, role: string, isHidden: boolean, statsID: string, status: string, identity: object, botType: string, fullJid: string, features: Set<string> | undefined, isReplaceParticipant: boolean\n    ): void {\n        const id = Strophe.getResourceFromJid(jid);\n\n        if (id === 'focus' || this.myUserId() === id) {\n            return;\n        }\n        const participant = new JitsiParticipant(jid, this, nick, isHidden, statsID, status, identity);\n\n        participant.setConnectionJid(fullJid);\n        participant.setRole(role);\n        participant.setBotType(botType);\n        participant.setFeatures(features);\n        participant.setIsReplacing(isReplaceParticipant);\n\n        // Set remote tracks on the participant if source signaling was received before presence.\n        const remoteTracks = this.isP2PActive()\n            ? this.p2pJingleSession?.peerconnection.getRemoteTracks(id) ?? []\n            : this.jvbJingleSession?.peerconnection.getRemoteTracks(id) ?? [];\n\n        for (const track of remoteTracks) {\n            participant._tracks.push(track);\n        }\n\n        this.participants.set(id, participant);\n        this.eventEmitter.emit(\n            JitsiConferenceEvents.USER_JOINED,\n            id,\n            participant);\n\n        this._updateFeatures(participant);\n\n        // maybeStart only if we had finished joining as then we will have information for the number of participants\n        if (this.isJoined()) {\n            this._maybeStartOrStopP2P();\n        }\n\n        this._maybeSetSITimeout();\n        const { startAudioMuted, startVideoMuted } = this.options.config;\n\n        // Ignore startAudio/startVideoMuted settings if the media session has already been established.\n        // Apply the policy if the number of participants exceeds the startMuted thresholds.\n        if ((this.jvbJingleSession && this.getActiveMediaSession() === this.jvbJingleSession)\n            || ((typeof startAudioMuted === 'undefined' || startAudioMuted === -1)\n                && (typeof startVideoMuted === 'undefined' || startVideoMuted === -1))) {\n            return;\n        }\n\n        let audioMuted = false;\n        let videoMuted = false;\n        const numberOfParticipants = this.getParticipantCount();\n\n        if (numberOfParticipants > this.options.config.startAudioMuted) {\n            audioMuted = true;\n        }\n\n        if (numberOfParticipants > this.options.config.startVideoMuted) {\n            videoMuted = true;\n        }\n\n        if ((audioMuted && !this.startMutedPolicy.audio) || (videoMuted && !this.startMutedPolicy.video)) {\n            this._updateStartMutedPolicy(audioMuted, videoMuted);\n        }\n    }\n\n    /**\n     * Handles the logic when a remote participant leaves the conference.\n     * @param {string} jid - The Jabber ID (JID) of the participant who left.\n     * @param {string} [reason] - Optional reason provided for the participant leaving.\n     * @internal\n     */\n    onMemberLeft(jid: string, reason?: string): void {\n        const id = Strophe.getResourceFromJid(jid);\n\n        if (id === 'focus' || this.myUserId() === id) {\n            return;\n        }\n\n        const mediaSessions = this.getMediaSessions();\n        let tracksToBeRemoved = [];\n\n        for (const session of mediaSessions) {\n            const remoteTracks = session.peerconnection.getRemoteTracks(id);\n\n            remoteTracks && (tracksToBeRemoved = [ ...tracksToBeRemoved, ...remoteTracks ]);\n\n            // Update the SSRC owners list.\n            session._signalingLayer.updateSsrcOwnersOnLeave(id);\n            if (!FeatureFlags.isSsrcRewritingSupported()) {\n                // Remove the ssrcs from the remote description and renegotiate.\n                session.removeRemoteStreamsOnLeave(id);\n            }\n        }\n\n        tracksToBeRemoved.forEach(track => {\n            // Fire the event before renegotiation is done so that the thumbnails can be removed immediately.\n            this.eventEmitter.emit(JitsiConferenceEvents.TRACK_REMOVED, track);\n\n            if (FeatureFlags.isSsrcRewritingSupported()) {\n                track.setSourceName(null);\n                track.setOwner(null);\n            }\n        });\n\n        const participant = this.participants.get(id);\n\n        if (participant) {\n            this.participants.delete(id);\n            this.eventEmitter.emit(JitsiConferenceEvents.USER_LEFT, id, participant, reason);\n        }\n\n        if (this.room !== null) { // Skip if we have left the room already.\n            this._maybeStartOrStopP2P(true /* triggered by user left event */);\n            this._maybeClearSITimeout();\n        }\n    }\n\n    /* eslint-disable max-params */\n\n    /**\n     * Designates an event indicating that we were kicked from the XMPP MUC.\n     * @param {boolean} isSelfPresence - whether it is for local participant\n     * or another participant.\n     * @param {string} actorId - the id of the participant who was initiator\n     * of the kick.\n     * @param {string?} kickedParticipantId - when it is not a kick for local participant,\n     * this is the id of the participant which was kicked.\n     * @param {string} reason - reason of the participant to kick\n     * @param {boolean?} isReplaceParticipant - whether this is a server initiated kick in order\n     * to replace it with a participant with same jwt.\n     * @internal\n     */\n    onMemberKicked(isSelfPresence: boolean, actorId: string, kickedParticipantId: string, reason: string, isReplaceParticipant: boolean): void {\n        let actorParticipant;\n\n        if (actorId === this.myUserId()) {\n            // When we kick someone we also want to send the PARTICIPANT_KICKED event, but there is no\n            // JitsiParticipant object for ourselves so create a minimum fake one.\n            actorParticipant = {\n                getId: () => actorId\n            };\n        } else {\n            actorParticipant = this.participants.get(actorId);\n        }\n\n        if (isSelfPresence) {\n            this.leave().finally(() => this._xmpp.disconnect());\n            this.eventEmitter.emit(\n                JitsiConferenceEvents.KICKED, actorParticipant, reason, isReplaceParticipant);\n\n            return;\n        }\n\n        const kickedParticipant = this.participants.get(kickedParticipantId);\n\n        kickedParticipant.setIsReplaced(isReplaceParticipant);\n\n        this.eventEmitter.emit(\n            JitsiConferenceEvents.PARTICIPANT_KICKED, actorParticipant, kickedParticipant, reason);\n    }\n\n    /**\n     * Method called on local MUC role change.\n     * @param {string} role the name of new user's role as defined by XMPP MUC.\n     * @internal\n     */\n    onLocalRoleChanged(role: string): void {\n        // Emit role changed for local JID\n        this.eventEmitter.emit(\n            JitsiConferenceEvents.USER_ROLE_CHANGED, this.myUserId(), role);\n    }\n\n    /**\n     * Handles changes to a user's role within the conference.\n     * @param {string} jid - The Jabber ID (JID) of the user whose role has changed.\n     * @param {string} role - The new role assigned to the user (e.g., 'moderator', 'participant').\n     * @internal\n     */\n    onUserRoleChanged(jid: string, role: string): void {\n        const id = Strophe.getResourceFromJid(jid);\n        const participant = this.getParticipantById(id);\n\n        if (!participant) {\n            return;\n        }\n        participant.setRole(role);\n        this.eventEmitter.emit(JitsiConferenceEvents.USER_ROLE_CHANGED, id, role);\n    }\n\n    /**\n     * Handles updates to a participant's display name.\n     * @param {string} jid - The Jabber ID (JID) of the participant whose display name changed.\n     * @param {string} displayName - The new display name for the participant.\n     * @internal\n     */\n    onDisplayNameChanged(jid: string, displayName: string): void {\n        const id = Strophe.getResourceFromJid(jid);\n        const participant = this.getParticipantById(id);\n\n        if (!participant) {\n            return;\n        }\n\n        if (participant._displayName === displayName) {\n            return;\n        }\n\n        participant._displayName = displayName;\n        this.eventEmitter.emit(\n            JitsiConferenceEvents.DISPLAY_NAME_CHANGED,\n            id,\n            displayName);\n    }\n\n    /**\n     * Handles changes to a participant's silent status.\n     * @param {string} jid - The Jabber ID (JID) of the participant whose silent status has changed.\n     * @param {boolean} isSilent - The new silent status of the participant (true if silent, false otherwise).\n     * @internal\n     */\n    onSilentStatusChanged(jid: string, isSilent: boolean): void {\n        const id = Strophe.getResourceFromJid(jid);\n        const participant = this.getParticipantById(id);\n\n        if (!participant) {\n            return;\n        }\n\n        participant.setIsSilent(isSilent);\n        this.eventEmitter.emit(\n            JitsiConferenceEvents.SILENT_STATUS_CHANGED,\n            id,\n            isSilent);\n    }\n\n    /**\n     * Notifies this JitsiConference that a JitsiRemoteTrack was added to the conference.\n     *\n     * @param {JitsiRemoteTrack} track the JitsiRemoteTrack which was added to this JitsiConference.\n     * @internal\n     */\n    onRemoteTrackAdded(track: JitsiRemoteTrack): void {\n        if (track.isP2P && !this.isP2PActive()) {\n            logger.info('Trying to add remote P2P track, when not in P2P - IGNORED');\n\n            return;\n        } else if (!track.isP2P && this.isP2PActive()) {\n            logger.info('Trying to add remote JVB track, when in P2P - IGNORED');\n\n            return;\n        }\n\n        const id = track.getParticipantId();\n        const participant = this.getParticipantById(id);\n\n        // Add track to JitsiParticipant.\n        if (participant) {\n            participant._tracks.push(track);\n        } else {\n            logger.info(`Source signaling received before presence for ${id}`);\n        }\n\n        const emitter = this.eventEmitter;\n\n        track.addEventListener(\n            JitsiTrackEvents.TRACK_MUTE_CHANGED,\n            () => emitter.emit(JitsiConferenceEvents.TRACK_MUTE_CHANGED, track));\n        track.isAudioTrack() && track.addEventListener(\n            JitsiTrackEvents.TRACK_AUDIO_LEVEL_CHANGED,\n            (audioLevel: number, tpc: TraceablePeerConnection) => {\n                const activeTPC = this.getActivePeerConnection();\n\n                if (activeTPC === tpc) {\n                    emitter.emit(JitsiConferenceEvents.TRACK_AUDIO_LEVEL_CHANGED, id, audioLevel);\n                }\n            }\n        );\n\n        emitter.emit(JitsiConferenceEvents.TRACK_ADDED, track);\n    }\n\n\n    // eslint-disable-next-line no-unused-vars\n    /**\n     * Callback called by the Jingle plugin when 'session-answer' is received.\n     * @param {JingleSessionPC} session - The Jingle session for which an answer was received.\n     * @param {Element} answer - An element pointing to 'jingle' IQ element.\n     * @internal\n     */\n    onCallAccepted(session: JingleSessionPC, answer: Element): void {\n        if (this.p2pJingleSession === session) {\n            logger.info('P2P setAnswer');\n\n            this.p2pJingleSession.setAnswer(answer)\n                .then(() => {\n                    this.eventEmitter.emit(JitsiConferenceEvents._MEDIA_SESSION_STARTED, this.p2pJingleSession);\n                })\n                .catch(error => {\n                    logger.error('Error setting P2P answer', error);\n                    if (this.p2pJingleSession) {\n                        this.eventEmitter.emit(JitsiConferenceEvents.CONFERENCE_FAILED,\n                            JitsiConferenceErrors.OFFER_ANSWER_FAILED, error);\n                    }\n                });\n        }\n    }\n\n\n    // eslint-disable-next-line no-unused-vars\n    /**\n     * Callback called by the Jingle plugin when 'transport-info' is received.\n     * @param {JingleSessionPC} session - The Jingle session for which the IQ was received.\n     * @param {Element} transportInfo - An element pointing to 'jingle' IQ element.\n     * @internal\n     */\n    onTransportInfo(session: JingleSessionPC, transportInfo: Element): void {\n        if (this.p2pJingleSession === session) {\n            logger.info('P2P addIceCandidates');\n            this.p2pJingleSession.addIceCandidates(transportInfo);\n        }\n    }\n\n    /**\n     * Notifies this JitsiConference that a JitsiRemoteTrack was removed from the conference.\n     *\n     * @param {JitsiRemoteTrack} removedTrack - The track that was removed.\n     * @internal\n     */\n    onRemoteTrackRemoved(removedTrack: JitsiRemoteTrack): void {\n        this.getParticipants().forEach(participant => {\n            const tracks = participant.getTracks();\n\n            for (let i = 0; i < tracks.length; i++) {\n                if (tracks[i] === removedTrack) {\n                    // Since the tracks have been compared and are\n                    // considered equal the result of splice can be ignored.\n                    participant._tracks.splice(i, 1);\n\n                    this.eventEmitter.emit(JitsiConferenceEvents.TRACK_REMOVED, removedTrack);\n\n                    break;\n                }\n            }\n        }, this);\n    }\n\n    /**\n     * Handles an incoming call event.\n     * @param {JingleSessionPC} jingleSession - The Jingle session for the incoming call.\n     * @param {Element} jingleOffer - An element pointing to 'jingle' IQ element containing the offer.\n     * @param {number} now - The timestamp when the call was received.\n     * @internal\n     */\n    onIncomingCall(jingleSession: JingleSessionPC, jingleOffer: Element, now: number): void {\n        // Handle incoming P2P call\n        if (jingleSession.isP2P) {\n            this._onIncomingCallP2P(jingleSession, jingleOffer);\n        } else {\n            if (!this.isFocus(jingleSession.remoteJid)) {\n                const description = 'Rejecting session-initiate from non-focus.';\n\n                this._rejectIncomingCall(\n                    jingleSession, {\n                        errorMsg: description,\n                        reason: 'security-error',\n                        reasonDescription: description\n                    });\n\n                return;\n            }\n            this._acceptJvbIncomingCall(jingleSession, jingleOffer, now);\n        }\n    }\n\n    /**\n     * Handles the call ended event.\n     * XXX is this due to the remote side terminating the Jingle session?\n     *\n     * @param {JingleSessionPC} jingleSession - The Jingle session which has been terminated.\n     * @param {String} reasonCondition - The Jingle reason condition.\n     * @param {String|null} reasonText - Human readable reason text which may provide\n     *  more details about why the call has been terminated.\n     * @internal\n     */\n    onCallEnded(jingleSession: JingleSessionPC, reasonCondition: string, reasonText: string): void {\n        logger.info(\n            `Call ended: ${reasonCondition} - ${reasonText} P2P ?${\n                jingleSession.isP2P}`);\n        if (jingleSession === this.jvbJingleSession) {\n            this.wasStopped = true;\n\n            Statistics.sendAnalytics(\n                createJingleEvent(AnalyticsEvents.ACTION_JINGLE_TERMINATE, { p2p: false }));\n\n            // Stop the stats\n            if (this.statistics) {\n                this.statistics.stopRemoteStats(this.jvbJingleSession.peerconnection);\n            }\n\n            // Current JVB JingleSession is no longer valid, so set it to null\n            this.jvbJingleSession = null;\n\n            // Let the RTC service do any cleanups\n            this.rtc.onCallEnded();\n        } else if (jingleSession === this.p2pJingleSession) {\n            const stopOptions: { requestRestart?: boolean; } = {};\n\n            if (reasonCondition === 'connectivity-error' && reasonText === 'ICE FAILED') {\n                // It can happen that the other peer detects ICE failed and\n                // terminates the session, before we get the event\n                // on our side. But we are able to parse the reason and mark it here.\n                Statistics.analytics.addPermanentProperties({ p2pFailed: true });\n            } else if (reasonCondition === 'success' && reasonText === 'restart') {\n                // When we are restarting media sessions we don't want to switch the tracks to the JVB just yet.\n                stopOptions.requestRestart = true;\n            }\n            this._stopP2PSession(stopOptions);\n        } else {\n            logger.error(\n                'Received onCallEnded for invalid session',\n                jingleSession.sid,\n                jingleSession.remoteJid,\n                reasonCondition,\n                reasonText);\n        }\n    }\n\n    /**\n     * Updates DTMF support based on participants' capabilities.\n     * @returns {void}\n     */\n    public updateDTMFSupport(): void {\n        let somebodySupportsDTMF = false;\n        const participants = this.getParticipants();\n\n        // check if at least 1 participant supports DTMF\n        for (let i = 0; i < participants.length; i += 1) {\n            if (participants[i].supportsDTMF()) {\n                somebodySupportsDTMF = true;\n                break;\n            }\n        }\n        if (somebodySupportsDTMF !== this.somebodySupportsDTMF) {\n            this.somebodySupportsDTMF = somebodySupportsDTMF;\n            this.eventEmitter.emit(\n                JitsiConferenceEvents.DTMF_SUPPORT_CHANGED,\n                somebodySupportsDTMF);\n        }\n    }\n\n    /**\n     * Allows to check if there is at least one user in the conference that supports DTMF.\n     * @returns {boolean} True if somebody supports DTMF, false otherwise.\n     */\n    public isDTMFSupported(): boolean {\n        return this.somebodySupportsDTMF;\n    }\n\n    /**\n     * Returns the local user's ID.\n     * @returns {string|null} Local user's ID or null if not available.\n     */\n    public myUserId(): Nullable<string> {\n        return (\n            this.room?.myroomjid\n                ? Strophe.getResourceFromJid(this.room.myroomjid)\n                : null);\n    }\n\n    /**\n     * Sends DTMF tones to the active peer connection.\n     * @param {string} tones - The DTMF tones to send.\n     * @param {number} duration - The duration of each tone in milliseconds.\n     * @param {number} pause - The pause duration between tones in milliseconds.\n     * @returns {void}\n     */\n    public sendTones(tones: string, duration: number, pause: number): void {\n        const peerConnection = this.getActivePeerConnection();\n\n        if (peerConnection) {\n            peerConnection.sendTones(tones, duration, pause);\n        } else {\n            logger.warn('cannot sendTones: no peer connection');\n        }\n    }\n\n    /**\n     * Starts recording the current conference.\n     *\n     * @param {IRecordingOptions} options - Configuration for the recording.\n     * @returns {Promise} Resolves when recording starts successfully, rejects otherwise.\n     */\n    public startRecording(options: IRecordingOptions): Promise<JibriSession> {\n        if (this.room) {\n            return this.recordingManager.startRecording(options);\n        }\n\n        return Promise.reject(new Error('The conference is not created yet!'));\n    }\n\n    /**\n     * Stops a recording session.\n     *\n     * @param {string} sessionID - The ID of the recording session to stop.\n     * @returns {Promise} Resolves when recording stops successfully, rejects otherwise.\n     */\n    public stopRecording(sessionID: string): Promise<void> {\n        if (this.room) {\n            return this.recordingManager.stopRecording(sessionID);\n        }\n\n        return Promise.reject(new Error('The conference is not created yet!'));\n    }\n\n    /**\n     * Returns true if SIP calls are supported, false otherwise.\n     * @returns {boolean} True if SIP calling is supported, false otherwise.\n     */\n    public isSIPCallingSupported(): boolean {\n        return this.room?.xmpp?.moderator?.isSipGatewayEnabled() ?? false;\n    }\n\n    /**\n     * Dials a phone number to join the conference.\n     * @param {string} number - The phone number to dial.\n     * @returns {Promise} Resolves when the dial is successful, rejects otherwise.\n     */\n    public dial(number: string): Promise<void> {\n        if (this.room) {\n            return this.room.dial(number);\n        }\n\n        return Promise.reject(new Error('The conference is not created yet!'));\n    }\n\n    /**\n     * Hangs up an existing call.\n     * @returns {Promise} Resolves when the hangup is successful.\n     */\n    public hangup(): Promise<void> {\n        if (this.room) {\n            return this.room.hangup();\n        }\n\n        return Promise.resolve();\n    }\n\n    /**\n     * Returns the phone number for joining the conference.\n     * @returns {string|null} The phone number or null if not available.\n     */\n    public getPhoneNumber(): Nullable<string> {\n        if (this.room) {\n            return this.room.getPhoneNumber();\n        }\n\n        return null;\n    }\n\n    /**\n     * Returns the PIN for joining the conference via phone.\n     * @returns {string|null} The phone PIN or null if not available.\n     */\n    public getPhonePin(): Nullable<string> {\n        if (this.room) {\n            return this.room.getPhonePin();\n        }\n\n        return null;\n    }\n\n    /**\n     * Returns the meeting unique ID if any.\n     * @returns {string|undefined} The meeting ID or undefined if not available.\n     */\n    public getMeetingUniqueId(): Optional<string> {\n        if (this.room) {\n            return this.room.getMeetingId();\n        }\n    }\n\n    /**\n     * Returns the active peer connection (P2P or JVB).\n     * @returns {TraceablePeerConnection|null} The active peer connection or null if none is available.\n     * @public\n     */\n    public getActivePeerConnection(): Nullable<TraceablePeerConnection> {\n        const session = this.isP2PActive() ? this.p2pJingleSession : this.jvbJingleSession;\n\n        return session ? session.peerconnection : null;\n    }\n\n    /**\n     * Returns the connection state for the current room.\n     * NOTE that \"completed\" ICE state which can appear on the P2P connection will\n     * be converted to \"connected\".\n     * @returns {string|null} The ICE connection state or null if no active peer connection exists.\n     */\n    public getConnectionState(): Nullable<string> {\n        const peerConnection = this.getActivePeerConnection();\n\n        return peerConnection ? peerConnection.getConnectionState() : null;\n    }\n\n    /**\n     * Sets the start muted policy for new participants.\n     * @param {Object} policy - Object with boolean properties for audio and video muting.\n     * @param {boolean} policy.audio - Whether audio should be muted for new participants.\n     * @param {boolean} policy.video - Whether video should be muted for new participants.\n     * @returns {void}\n     */\n    public setStartMutedPolicy(policy: { audio: boolean; video: boolean; }): void {\n        if (!this.isModerator()) {\n            logger.warn(`Failed to set start muted policy, ${this.room ? '' : 'not in a room, '}${\n                this.isModerator() ? '' : 'participant is not a moderator'}`);\n\n            return;\n        }\n\n        logger.info(`Setting start muted policy: ${JSON.stringify(policy)} in presence and in conference metadata`);\n\n        // TODO: to remove using presence for startmuted policy after old clients update to using metadata always.\n        this.room.addOrReplaceInPresence('startmuted', {\n            attributes: {\n                audio: policy.audio,\n                video: policy.video,\n                xmlns: 'http://jitsi.org/jitmeet/start-muted'\n            }\n        }) && this.room.sendPresence();\n\n        this.getMetadataHandler().setMetadata('startMuted', {\n            audio: policy.audio,\n            video: policy.video\n        });\n    }\n\n    /**\n     * Returns the current start muted policy.\n     * @returns {Object} Object with audio and video properties indicating the start muted policy.\n     * @internal\n     */\n    getStartMutedPolicy(): { audio: boolean; video: boolean; } {\n        return this.startMutedPolicy;\n    }\n\n    /**\n     * Returns measured connection times.\n     * @returns {Object} The connection times for the room.\n     */\n    public getConnectionTimes(): object {\n        return this.room.connectionTimes;\n    }\n\n    /**\n     * Sets a property for the local participant.\n     * @param {string} name - The name of the property.\n     * @param {string} value - The value of the property.\n     * @returns {void}\n     */\n    public setLocalParticipantProperty(name: string, value: string | string[]): void {\n        this.sendCommand(`jitsi_participant_${name}`, { value });\n    }\n\n    /**\n     * Removes a property for the local participant and sends the updated presence.\n     * @param {string} name - The name of the property to remove.\n     * @returns {void}\n     */\n    public removeLocalParticipantProperty(name: string): void {\n        this.removeCommand(`jitsi_participant_${name}`);\n        if (this.room) {\n            this.room.sendPresence();\n        }\n    }\n\n    /**\n     * Sets the transcription language.\n     * NB: Unlike _init_ here we don't check for the default value since we want to allow\n     * the value to be reset.\n     * @param {string} lang - The new transcription language to be used.\n     * @returns {void}\n     */\n    public setTranscriptionLanguage(lang: string): void {\n        this.setLocalParticipantProperty('transcription_language', lang);\n    }\n\n    /**\n     * Gets a local participant property.\n     * @param {string} name - The name of the property to retrieve.\n     * @returns {string|undefined} The value of the property if it exists, otherwise undefined.\n     */\n    public getLocalParticipantProperty(name: string): Optional<string> {\n        const property = this.room.presMap.nodes.find(prop =>\n            prop.tagName === `jitsi_participant_${name}`\n        );\n\n        return property ? property.value : undefined;\n    }\n\n    /**\n     * Sends feedback if enabled.\n     * @param {number} overallFeedback - An integer between 1 and 5 indicating user feedback.\n     * @param {string} detailedFeedback - Detailed feedback from the user (not yet used).\n     * @returns {Promise} Resolves if feedback is submitted successfully.\n     */\n    public sendFeedback(overallFeedback: number, detailedFeedback: string): Promise<void> {\n        return this.statistics.sendFeedback(overallFeedback, detailedFeedback);\n    }\n\n\n    /**\n     * Finds the SSRC of a given track.\n     * @param {JitsiTrack} track - The track to find the SSRC for.\n     * @returns {Optional<number>} The SSRC of the specified track, or undefined if not found.\n     */\n    public getSsrcByTrack(track: JitsiTrack): Optional<number> {\n        return track.isLocal() ? this.getActivePeerConnection()?.getLocalSSRC(track as JitsiLocalTrack) : track.getSsrc();\n    }\n\n\n    /**\n     * Sends an application log (no-op since callstats is no longer supported).\n     * @returns {void}\n     */\n    public sendApplicationLog(): void {\n        // eslint-disable-next-line no-empty-function\n    }\n\n    /**\n     * Checks if the user identified by given MUC JID is the conference focus.\n     * @param {string} mucJid - The full MUC address of the user to check.\n     * @returns {boolean|null} True if the user is the conference focus,\n     * false if not, null if not in MUC or invalid JID.\n     * @internal\n     */\n    isFocus(mucJid: string): Nullable<boolean> {\n        return this.room ? this.room.isFocus(mucJid) : null;\n    }\n\n    /**\n     * Sends a message via the data channel.\n     * @param {string} to - The ID of the endpoint to receive the message, or empty string to broadcast.\n     * @param {object} payload - The payload of the message.\n     * @throws {NetworkError|InvalidStateError|Error} If the operation fails.\n     * @deprecated Use 'sendMessage' instead. TODO: this should be private.\n     */\n    public sendEndpointMessage(to: string, payload: object): void {\n        this.rtc.sendChannelMessage(to, payload);\n    }\n\n    /**\n     * Sends local stats via the bridge channel to other endpoints selectively.\n     * @param {Object} payload - The payload of the message.\n     * @throws {NetworkError|InvalidStateError|Error} If the operation fails or no data channel exists.\n     * @internal\n     */\n    sendEndpointStatsMessage(payload: object): void {\n        this.rtc.sendEndpointStatsMessage(payload);\n    }\n\n    /**\n     * Sends a broadcast message via the data channel.\n     * @param {object} payload - The payload of the message.\n     * @throws {NetworkError|InvalidStateError|Error} If the operation fails.\n     * @deprecated Use 'sendMessage' instead. TODO: this should be private.\n     */\n    public broadcastEndpointMessage(payload: object): void {\n        this.sendEndpointMessage('', payload);\n    }\n\n    /**\n     * Sends a message to a given endpoint or broadcasts it to all endpoints.\n     * @param {string|object} message - The message to send (string for chat, object for JSON).\n     * @param {string} [to=''] - The ID of the recipient endpoint, or empty string to broadcast.\n     * @param {boolean} [sendThroughVideobridge=false] - Whether to send through jitsi-videobridge.\n     * @param {string} [replyToId] - The ID of the message being replied to.\n     */\n    public sendMessage(message: any, to = '', sendThroughVideobridge = false, replyToId?: string): void {\n        const messageType = typeof message;\n\n        // Through videobridge we support only objects. Through XMPP we support\n        // objects (encapsulated in a specific JSON format) and strings (i.e.\n        // regular chat messages).\n        if (messageType !== 'object'\n                && (sendThroughVideobridge || messageType !== 'string')) {\n            logger.error(`Can not send a message of type ${messageType}`);\n\n            return;\n        }\n\n        if (sendThroughVideobridge) {\n            this.sendEndpointMessage(to, message);\n        } else {\n            let messageToSend = message;\n\n            // Name of packet extension of message stanza to send the required\n            // message in.\n            let elementName = 'body';\n\n            if (messageType === 'object') {\n                elementName = 'json-message';\n\n                // Mark as valid JSON message if not already\n                if (!messageToSend.hasOwnProperty(JITSI_MEET_MUC_TYPE)) {\n                    messageToSend[JITSI_MEET_MUC_TYPE] = '';\n                }\n\n                try {\n                    messageToSend = JSON.stringify(messageToSend);\n                } catch (e) {\n                    logger.error('Can not send a message, stringify failed: ', e);\n\n                    return;\n                }\n            }\n\n            if (to) {\n                this.sendPrivateTextMessage(to, messageToSend, elementName, false, replyToId);\n            } else {\n                // Broadcast\n                this.sendTextMessage(messageToSend, elementName, replyToId);\n            }\n        }\n    }\n\n    /**\n     * Checks if the connection is interrupted.\n     * @returns {boolean} True if the connection is interrupted, false otherwise.\n     */\n    public isConnectionInterrupted(): boolean {\n        return this.isP2PActive()\n            ? this.isP2PConnectionInterrupted : this.isJvbConnectionInterrupted;\n    }\n\n    /**\n     * Gets a conference property with a given key.\n     *\n     * @param {string} key - The key.\n     * @returns {*} The value\n     */\n    public getProperty(key: string): any {\n        return this.properties[key];\n    }\n\n    /**\n     * Checks whether or not the conference is currently in the peer to peer mode.\n     * Being in peer to peer mode means that the direct connection has been\n     * established and the P2P connection is being used for media transmission.\n     * @return {boolean} <tt>true</tt> if in P2P mode or <tt>false</tt> otherwise.\n     */\n    public isP2PActive(): boolean {\n        return this.p2p;\n    }\n\n    /**\n     * Returns the current ICE state of the P2P connection.\n     * NOTE: method is used by the jitsi-meet-torture tests.\n     * @return {string|null} an ICE state or <tt>null</tt> if there's currently\n     * no P2P connection.\n     */\n    public getP2PConnectionState(): Nullable<string> {\n        if (this.isP2PActive()) {\n            return this.p2pJingleSession.peerconnection.getConnectionState();\n        }\n\n        return null;\n    }\n\n    /**\n     * Configures the peerconnection so that a given framre rate can be achieved for desktop share.\n     *\n     * @param {number} maxFps The capture framerate to be used for desktop tracks.\n     * @returns {boolean} true if the operation is successful, false otherwise.\n     */\n    public setDesktopSharingFrameRate(maxFps: number): boolean {\n        if (!isValidNumber(maxFps)) {\n            logger.error(`Invalid value ${maxFps} specified for desktop capture frame rate`);\n\n            return false;\n        }\n\n        const fps = Number(maxFps);\n\n        this._desktopSharingFrameRate = fps;\n\n        // Set capture fps for screenshare.\n        this.jvbJingleSession?.peerconnection.setDesktopSharingFrameRate(fps);\n\n        // Set the capture rate for desktop sharing.\n        this.rtc.setDesktopSharingFrameRate(fps);\n\n        return true;\n    }\n\n    /**\n     * Manually starts new P2P session (should be used only in the tests).\n     * @returns {void}\n     * @internal\n     */\n    startP2PSession(): void {\n        const peers = this.getParticipants();\n\n        // Start peer to peer session\n        if (peers.length === 1) {\n            const peerJid = peers[0].getJid();\n\n            this._startP2PSession(peerJid);\n        } else {\n            throw new Error(\n                'There must be exactly 1 participant to start the P2P session !');\n        }\n    }\n\n    /**\n     * Manually stops the current P2P session (should be used only in the tests).\n     * @param {Object} options - Options for stopping P2P.\n     * @returns {void}\n     * @internal\n     */\n    stopP2PSession(options: {\n        reason: string;\n        reasonDescription: string;\n        requestRestart: boolean;\n    }): void {\n        this._stopP2PSession(options);\n    }\n\n    /**\n     * Get a summary of how long current participants have been the dominant speaker\n     * @returns {{[userId: string]: SpeakerStats}} The speaker statistics.\n     */\n    public getSpeakerStats(): { [userId: string]: SpeakerStats; } {\n        return this.speakerStatsCollector.getStats();\n    }\n\n    /**\n     * Sends a face landmarks object to the xmpp server.\n     * @param {IFaceLandmarksPayload} payload - The face landmarks data to send.\n     * @returns {void}\n     */\n    public sendFaceLandmarks(payload: IFaceLandmarksPayload): void {\n        if (payload.faceExpression) {\n            this._xmpp.sendFaceLandmarksEvent(this.room.roomjid, payload);\n        }\n    }\n\n    /**\n     * Sets the constraints for the video that is requested from the bridge.\n     *\n     * @param {IReceiverVideoConstraints} videoConstraints The constraints which are specified in the following format. The message updates\n     * the fields that are present and leaves the rest unchanged on the bridge.\n     * Therefore, any field that is not applicable\n     * anymore should be cleared by passing an empty object or list (whatever is applicable).\n     * {\n     *      'lastN': 20,\n     *      'selectedSources': ['A', 'B', 'C'],\n     *      'onStageSources': ['A'],\n     *      'defaultConstraints': { 'maxHeight': 180 },\n     *      'constraints': {\n     *          'A': { 'maxHeight': 720 }\n     *      }\n     * }\n     * Where A, B and C are source-names of the remote tracks that are being requested from the bridge.\n     * @returns {void}\n     */\n    public setReceiverConstraints(videoConstraints: IReceiverVideoConstraints): void {\n        this.qualityController.receiveVideoController.setReceiverConstraints(videoConstraints);\n    }\n\n    /**\n     * Sets the assumed bandwidth bps for the video that is requested from the bridge.\n     *\n     * @param {Number} assumedBandwidthBps - The bandwidth value expressed in bits per second.\n     * @returns {void}\n     */\n    public setAssumedBandwidthBps(assumedBandwidthBps: number): void {\n        this.qualityController.receiveVideoController.setAssumedBandwidthBps(assumedBandwidthBps);\n    }\n\n    /**\n     * Sets the maximum video size the local participant should receive from remote\n     * participants.\n     *\n     * @param {number} maxFrameHeight - the maximum frame height, in pixels,\n     * this receiver is willing to receive.\n     * @returns {void}\n     */\n    public setReceiverVideoConstraint(maxFrameHeight: number): void {\n        this.qualityController.receiveVideoController.setPreferredReceiveMaxFrameHeight(maxFrameHeight);\n    }\n\n    /**\n     * Sets the maximum video size the local participant should send to remote\n     * participants.\n     * @param {number} maxFrameHeight - The user preferred max frame height.\n     * @returns {Promise} promise that will be resolved when the operation is\n     * successful and rejected otherwise.\n     */\n    public setSenderVideoConstraint(maxFrameHeight: number): Promise<void> {\n        return this.qualityController.sendVideoController.setPreferredSendMaxFrameHeight(maxFrameHeight);\n    }\n\n    /**\n     * Creates a video SIP GW session and returns it if service is enabled. Before\n     * creating a session one need to check whether video SIP GW service is\n     * available in the system. Even\n     * if there are available nodes to serve this request, after creating the\n     * session those nodes can be taken and the request about using the\n     * created session can fail.\n     *\n     * @param {string} sipAddress - The sip address to be used.\n     * @param {string} displayName - The display name to be used for this session.\n     * @returns {JitsiVideoSIPGWSession|Error} Returns null if conference is not\n     * initialised and there is no room.\n     */\n    public createVideoSIPGWSession(sipAddress: string, displayName: string): JitsiVideoSIPGWSession | Error {\n        if (!this.room) {\n            return new Error(VideoSIPGWConstants.ERROR_NO_CONNECTION);\n        }\n\n        return this.videoSIPGWHandler\n            .createVideoSIPGWSession(sipAddress, displayName);\n    }\n\n    /**\n     * Returns whether End-To-End encryption is enabled.\n     *\n     * @returns {boolean}\n     */\n    public isE2EEEnabled(): boolean {\n        return Boolean(this._e2eEncryption?.isEnabled());\n    }\n\n    /**\n     * Returns whether End-To-End encryption is supported. Note that not all participants\n     * in the conference may support it.\n     *\n     * @returns {boolean}\n     */\n    public isE2EESupported(): boolean {\n        return E2EEncryption.isSupported(this.options.config);\n    }\n\n    /**\n     * Enables / disables End-to-End encryption.\n     *\n     * @param {boolean} enabled whether to enable E2EE or not.\n     * @returns {void}\n     */\n    public toggleE2EE(enabled: boolean): void {\n        if (!this.isE2EESupported()) {\n            logger.warn('Cannot enable / disable E2EE: platform is not supported.');\n\n            return;\n        }\n\n        this._e2eEncryption.setEnabled(enabled);\n    }\n\n    /**\n     * Sets the key and index for End-to-End encryption.\n     *\n     * @param {CryptoKey} [keyInfo.encryptionKey] - encryption key.\n     * @param {Number} [keyInfo.index] - the index of the encryption key.\n     * @returns {void}\n     */\n    public setMediaEncryptionKey(keyInfo: CryptoKey): void {\n        this._e2eEncryption.setEncryptionKey(keyInfo);\n    }\n\n    /**\n     * Starts the participant verification process.\n     *\n     * @param {string} participantId The participant which will be marked as verified.\n     * @returns {void}\n     */\n    public startVerification(participantId: string): void {\n        const participant = this.getParticipantById(participantId);\n\n        if (!participant) {\n            return;\n        }\n\n        this._e2eEncryption.startVerification(participant);\n    }\n\n    /**\n     * Marks the given participant as verified. After this is done, MAC verification will\n     * be performed and an event will be emitted with the result.\n     *\n     * @param {string} participantId The participant which will be marked as verified.\n     * @param {boolean} isVerified - whether the verification was succesfull.\n     * @returns {void}\n     */\n    public markParticipantVerified(participantId: string, isVerified: boolean): void {\n        const participant = this.getParticipantById(participantId);\n\n        if (!participant) {\n            return;\n        }\n\n        this._e2eEncryption.markParticipantVerified(participant, isVerified);\n    }\n\n    /**\n     * Returns <tt>true</tt> if lobby support is enabled in the backend.\n     *\n     * @returns {boolean} whether lobby is supported in the backend.\n     */\n    public isLobbySupported(): boolean {\n        return Boolean(this.room?.getLobby().isSupported());\n    }\n\n    /**\n     * Returns <tt>true</tt> if the room has members only enabled.\n     *\n     * @returns {boolean} whether conference room is members only.\n     */\n    public isMembersOnly(): boolean {\n        return Boolean(this.room?.membersOnlyEnabled);\n    }\n\n    /**\n     * Returns <tt>true</tt> if the room supports visitors feature.\n     *\n     * @returns {boolean} whether conference room has visitors support.\n     */\n    public isVisitorsSupported(): boolean {\n        return Boolean(this.room?.visitorsSupported);\n    }\n\n    /**\n     * Enables lobby by moderators\n     *\n     * @returns {Promise} resolves when lobby room is joined or rejects with the error.\n     */\n    public enableLobby(): Promise<void> {\n        if (this.room && this.isModerator()) {\n            return this.room.getLobby().enable();\n        }\n\n        return Promise.reject(\n            new Error('The conference not started or user is not moderator'));\n    }\n\n    /**\n     * Disabled lobby by moderators\n     *\n     * @returns {void}\n     */\n    public disableLobby(): void {\n        if (this.room && this.isModerator()) {\n            this.room.getLobby().disable();\n        } else {\n            logger.warn(`Failed to disable lobby, ${this.room ? '' : 'not in a room, '}${\n                this.isModerator() ? '' : 'participant is not a moderator'}`);\n        }\n    }\n\n    /**\n     * Joins the lobby room with display name and optional email or with a shared password to skip waiting.\n     *\n     * @param {string} displayName Display name should be set to show it to moderators.\n     * @param {string} email Optional email is used to present avatar to the moderator.\n     * @returns {Promise<never>}\n     */\n    public joinLobby(displayName: string, email: string): Promise<void> {\n        if (this.room) {\n            return this.room.getLobby().join(displayName, email);\n        }\n\n        return Promise.reject(new Error('The conference not started'));\n    }\n\n    /**\n     * Gets the local id for a participant in a lobby room.\n     * Returns undefined when current participant is not in the lobby room.\n     * This is used for lobby room private chat messages.\n     *\n     * @returns {string}\n     */\n    public myLobbyUserId(): Optional<string> {\n        if (this.room) {\n            return this.room.getLobby().getLocalId();\n        }\n    }\n\n    /**\n     * Sends a message to a lobby room.\n     * When id is specified it sends a private message.\n     * Otherwise it sends the message to all moderators.\n     * @param {object} message The message to send\n     * @param {string} id The participant id.\n     *\n     * @returns {void}\n     */\n    public sendLobbyMessage(message: object, id: string): void {\n        if (this.room) {\n            if (id) {\n                return this.room.getLobby().sendPrivateMessage(id, message);\n            }\n\n            return this.room.getLobby().sendMessage(message);\n        }\n    }\n\n    /**\n     * Adds a message listener to the lobby room\n     * @param {Function} listener The listener function,\n     * called when a new message is received in the lobby room.\n     *\n     * @returns {Function} Handler returned to be able to remove it later.\n     */\n    public addLobbyMessageListener(listener: (message: object) => void): Optional<EventListener> {\n        if (this.room) {\n            return this.room.getLobby().addMessageListener(listener) as Optional<EventListener>;\n        }\n    }\n\n    /**\n     * Removes a message handler from the lobby room\n     * @param {Function} handler The handler function  to remove.\n     *\n     * @returns {void}\n     */\n    public removeLobbyMessageHandler(handler: (message: object) => void): void {\n        if (this.room) {\n            return this.room.getLobby().removeMessageHandler(handler);\n        }\n    }\n\n    /**\n     * Denies an occupant in the lobby room access to the conference.\n     * @param {string} id The participant id.\n     * @returns {void}\n     */\n    public lobbyDenyAccess(id: string): void {\n        if (this.room) {\n            this.room.getLobby().denyAccess(id);\n        }\n    }\n\n    /**\n     * Approves the request to join the conference to a participant waiting in the lobby.\n     *\n     * @param {string|Array<string>} param The participant id or an array of ids.\n     * @returns {void}\n     */\n    public lobbyApproveAccess(param: string | string[]): void {\n        if (this.room) {\n            this.room.getLobby().approveAccess(param);\n        }\n    }\n\n    /**\n     * Returns <tt>true</tt> if AV Moderation support is enabled in the backend.\n     *\n     * @returns {boolean} whether AV Moderation is supported in the backend.\n     */\n    public isAVModerationSupported(): boolean {\n        return Boolean(this.room?.getAVModeration().isSupported());\n    }\n\n    /**\n     * Enables AV Moderation.\n     * @param {MediaType} mediaType \"audio\", \"desktop\" or \"video\"\n     * @returns {void}\n     */\n    public enableAVModeration(mediaType: MediaType): void {\n        if (this.room && this.isModerator()\n            && (mediaType === MediaType.AUDIO || mediaType === MediaType.DESKTOP || mediaType === MediaType.VIDEO)) {\n            this.room.getAVModeration().enable(true, mediaType);\n        } else {\n            logger.warn(`Failed to enable AV moderation, ${this.room ? '' : 'not in a room, '}${\n                this.isModerator() ? '' : 'participant is not a moderator, '}${\n                this.room && this.isModerator() ? 'wrong media type passed' : ''}`);\n        }\n    }\n\n    /**\n     * Disables AV Moderation.\n     * @param {MediaType} mediaType \"audio\", \"desktop\" or \"video\"\n     * @returns {void}\n     */\n    public disableAVModeration(mediaType: MediaType): void {\n        if (this.room && this.isModerator()\n            && (mediaType === MediaType.AUDIO || mediaType === MediaType.DESKTOP || mediaType === MediaType.VIDEO)) {\n            this.room.getAVModeration().enable(false, mediaType);\n        } else {\n            logger.warn(`Failed to disable AV moderation, ${this.room ? '' : 'not in a room, '}${\n                this.isModerator() ? '' : 'participant is not a moderator, '}${\n                this.room && this.isModerator() ? 'wrong media type passed' : ''}`);\n        }\n    }\n\n    /**\n     * Approve participant access to certain media, allows unmuting audio or video.\n     *\n     * @param {MediaType} mediaType \"audio\", \"desktop\" or \"video\"\n     * @param id the id of the participant.\n     * @returns {void}\n     */\n    public avModerationApprove(mediaType: MediaType, id: string): void {\n        if (this.room && this.isModerator()\n            && (mediaType === MediaType.AUDIO || mediaType === MediaType.DESKTOP || mediaType === MediaType.VIDEO)) {\n\n            const participant = this.getParticipantById(id);\n\n            if (!participant) {\n                return;\n            }\n\n            this.room.getAVModeration().approve(mediaType, participant.getJid());\n        } else {\n            logger.warn(`AV moderation approve skipped , ${this.room ? '' : 'not in a room, '}${\n                this.isModerator() ? '' : 'participant is not a moderator, '}${\n                this.room && this.isModerator() ? 'wrong media type passed' : ''}`);\n        }\n    }\n\n    /**\n     * Reject participant access to certain media, blocks unmuting audio or video.\n     *\n     * @param {MediaType} mediaType \"audio\", \"desktop\" or \"video\"\n     * @param id the id of the participant.\n     * @returns {void}\n     */\n    public avModerationReject(mediaType: MediaType, id: string): void {\n        if (this.room && this.isModerator()\n            && (mediaType === MediaType.AUDIO || mediaType === MediaType.DESKTOP || mediaType === MediaType.VIDEO)) {\n\n            const participant = this.getParticipantById(id);\n\n            if (!participant) {\n                return;\n            }\n\n            this.room.getAVModeration().reject(mediaType, participant.getJid());\n        } else {\n            logger.warn(`AV moderation reject skipped , ${this.room ? '' : 'not in a room, '}${\n                this.isModerator() ? '' : 'participant is not a moderator, '}${\n                this.room && this.isModerator() ? 'wrong media type passed' : ''}`);\n        }\n    }\n\n    /**\n     * Returns the breakout rooms manager object.\n     *\n     * @returns {Optional<BreakoutRooms>} the breakout rooms manager.\n     */\n    public getBreakoutRooms(): Optional<BreakoutRooms> {\n        return this.room?.getBreakoutRooms();\n    }\n\n    /**\n     * Returns the file sharing manager object.\n     *\n     * @returns {Optional<FileSharing>} the file sharing manager.\n     */\n    public getFileSharing(): Optional<FileSharing> {\n        return this.room?.getFileSharing();\n    }\n\n    /**\n     * Returns the metadata handler object.\n     *\n     * @returns {Optional<RoomMetadata>} the room metadata handler.\n     */\n    public getMetadataHandler(): Optional<RoomMetadata> {\n        return this.room?.getMetadataHandler();\n    }\n\n    /**\n     * Returns the polls object.\n     *\n     * @returns {Optional<Polls>} the polls.\n     */\n    public getPolls(): Optional<Polls> {\n        return this.room?.getPolls();\n    }\n\n    /**\n     * Requests short-term credentials from the backend if available.\n     * @param {string} service - The service for which to request the credentials.\n     * @returns {Promise} A promise that resolves with the credentials or rejects with an error.\n     */\n    public getShortTermCredentials(service: string): Promise<string> {\n        if (this.room) {\n            return this.room.getShortTermCredentials(service);\n        }\n\n        return Promise.reject(new Error('The conference is not created yet!'));\n    }\n\n    /**\n     * @internal\n     * @returns {Optional<VADAudioAnalyser>} the audio analyser.\n     */\n    getAudioAnalyser(): Optional<VADAudioAnalyser> {\n        return this?._audioAnalyser;\n    }\n\n    /**\n     * @internal\n     * @returns {XMPP} the XMPP connection object.\n     */\n    get xmpp(): XMPP {\n        return this._xmpp;\n    }\n}\n","import { getLogger } from '@jitsi/logger';\n\nimport JitsiConference from './JitsiConference';\nimport { JitsiConnectionEvents } from './JitsiConnectionEvents';\nimport RTCStats from './modules/RTCStats/RTCStats';\nimport FeatureFlags from './modules/flags/FeatureFlags';\nimport Statistics from './modules/statistics/statistics';\nimport XMPP from './modules/xmpp/xmpp';\nimport {\n    AnalyticsEvents,\n    createConnectionFailedEvent\n} from './service/statistics/AnalyticsEvents';\n\nconst logger = getLogger('core:JitsiConnection');\n\nexport interface IConnectionOptions {\n    analytics?: any;\n    bridgeChannel?: {\n        ignoreDomain?: string;\n        preferSctp?: boolean;\n    };\n    disableFocus?: boolean;\n    enableWebsocketResume: boolean;\n    flags?: Record<string, any>;\n    hosts: {\n        domain: string;\n    };\n    name?: string;\n    p2pStunServers: any[];\n    serviceUrl: string;\n    websocketKeepAlive?: number;\n    websocketKeepAliveUrl?: string;\n    xmppPing?: any;\n}\n\nexport interface IConnectOptions {\n    id?: string;\n    name?: string;\n    password?: string;\n}\n\nexport interface IAttachOptions {\n    jid: string;\n    rid: string;\n    sid: string;\n}\n\n/**\n * Creates a new connection object for the Jitsi Meet server side video\n * conferencing service. Provides access to the JitsiConference interface.\n */\nexport default class JitsiConnection {\n    private appID?: string;\n    private token?: string;\n    private _xmpp: XMPP;\n    readonly options: IConnectionOptions;\n\n    /**\n     * Creates a new JitsiConnection instance.\n     * @param appID - Identification for the provider of Jitsi Meet video conferencing services.\n     * @param token - The JWT token used to authenticate with the server (optional).\n     * @param options - Object with properties / settings related to connection with the server.\n     */\n    constructor(appID: string, token: Nullable<string>, options: IConnectionOptions) {\n        this.appID = appID;\n        this.token = token;\n        this.options = options;\n\n        // Initialize the feature flags so that they are advertised through the disco-info.\n        FeatureFlags.init(options.flags || {});\n\n        this._xmpp = new XMPP(options, token);\n\n        this.addEventListener(JitsiConnectionEvents.CONNECTION_FAILED,\n            (errType: string, msg: string, credentials: any, details: any) => {\n                Statistics.sendAnalyticsAndLog(\n                    createConnectionFailedEvent(errType, msg, details));\n            });\n\n        this.addEventListener(JitsiConnectionEvents.CONNECTION_DISCONNECTED,\n            (msg: string) => {\n                // we can see disconnects from normal tab closing of the browser\n                // and then there are no msgs, but we want to log only disconnects\n                // when there is real error\n                // XXX Do we need the difference in handling between the log and\n                // analytics event here?\n                if (msg) {\n                    Statistics.sendAnalytics(\n                        AnalyticsEvents.CONNECTION_DISCONNECTED,\n                        { message: msg });\n                }\n            });\n    }\n\n    /**\n     * Connect the client with the server.\n     * @param options - Connecting options (for example authentications parameters).\n     * @param options.id - The username to use when connecting, if any.\n     * @param options.password - The password to use when connecting with username, if any.\n     * @param options.name - The name of the room/conference we will be connecting to. This is needed on connection\n     * time to be able to send conference-request over http. If missing the flow where we send conference-iq to jicofo over\n     * the established xmpp connection will be used, even in the case where we have configured conference http request url\n     * to be used.\n     */\n    connect(options: IConnectOptions = {}): void {\n\n        RTCStats.startWithConnection(this);\n\n        // if we get redirected, we set disableFocus to skip sending the conference request twice\n        if (this.xmpp.moderator.targetUrl && !this.options.disableFocus && options.name) {\n            // The domain (optional) will uses this.options.hosts.muc.toLowerCase() if not provided\n            this.xmpp.moderator.sendConferenceRequest(this.xmpp.getRoomJid(options.name, undefined))\n                .then(() => {\n                    this.xmpp.connect(options.id, options.password);\n                })\n                .catch(e => logger.trace('sendConferenceRequest rejected', e));\n        } else {\n            this.xmpp.connect(options.id, options.password);\n        }\n    }\n\n    /**\n     * Attach to existing connection. Can be used for optimizations. For example:\n     * if the connection is created on the server we can attach to it and start\n     * using it.\n     *\n     * @param options - Connecting options - rid, sid and jid.\n     */\n    attach(options: IAttachOptions): void {\n        this.xmpp.attach(options);\n    }\n\n    /**\n     * Disconnect the client from the server.\n     * @param args - Optional arguments to be passed to XMPP.disconnect\n     * @returns Promise that resolves when the disconnect process is finished or rejects with an error.\n     */\n    disconnect(...args: any): boolean | Promise<void> {\n        // XXX Forward any arguments passed to JitsiConnection.disconnect to\n        // XMPP.disconnect. For example, the caller of JitsiConnection.disconnect\n        // may optionally pass the event which triggered the disconnect in order to\n        // provide the implementation with finer-grained context.\n        return this.xmpp.disconnect(...args);\n    }\n\n    /**\n     * Returns the jid of the participant associated with the XMPP connection.\n     *\n     * @returns The jid of the participant.\n     */\n    getJid(): string {\n        return this.xmpp.getJid();\n    }\n\n    /**\n     * This method allows renewal of the tokens if they are expiring.\n     * @param token - The new token.\n     */\n    setToken(token: string): void {\n        this.token = token;\n    }\n\n    /**\n     * Creates and joins new conference.\n     * @param name - The name of the conference; if null - a generated name will be\n     * provided from the api\n     * @param options - Object with properties / settings related to the conference\n     * that will be created.\n     * @returns The new conference object.\n     */\n    initJitsiConference(name: Nullable<string>, options: Record<string, any>): JitsiConference {\n        return new JitsiConference({\n            config: options,\n            connection: this,\n            name\n        });\n    }\n\n    /**\n     * Subscribes the passed listener to the event.\n     * @param event - The connection event.\n     * @param listener - The function that will receive the event\n     */\n    addEventListener(event: JitsiConnectionEvents, listener: (...args: any[]) => void): void {\n        this.xmpp.addListener(event, listener);\n    }\n\n    /**\n     * Unsubscribes the passed handler.\n     * @param event - The connection event.\n     * @param listener - The function that will receive the event\n     */\n    removeEventListener(event: JitsiConnectionEvents, listener: (...args: any[]) => void): void {\n        this.xmpp.removeListener(event, listener);\n    }\n\n    /**\n     * Returns measured connectionTimes.\n     * @returns Object containing connection timing information\n     */\n    getConnectionTimes(): Record<string, any> {\n        return this.xmpp.connectionTimes;\n    }\n\n    /**\n     * Adds new feature to the list of supported features for the local\n     * participant.\n     * @param feature - The name of the feature.\n     * @param submit - If true - the new list of features will be\n     * immediately submitted to the others.\n     */\n    addFeature(feature: string, submit: boolean = false): void {\n        this.xmpp.caps.addFeature(feature, submit, true);\n    }\n\n    /**\n     * Removes a feature from the list of supported features for the local\n     * participant\n     * @param feature - The name of the feature.\n     * @param submit - If true - the new list of features will be\n     * immediately submitted to the others.\n     */\n    removeFeature(feature: string, submit: boolean = false): void {\n        this.xmpp.caps.removeFeature(feature, submit, true);\n    }\n\n    /**\n     * Get object with internal logs.\n     * @returns Object containing connection logs and metadata\n     */\n    getLogs(): Record<string, any> {\n        const data = this.xmpp.getJingleLog();\n\n        const metadata: Record<string, any> = {};\n\n        metadata.time = new Date();\n        metadata.url = window.location.href;\n        metadata.ua = navigator.userAgent;\n\n        const log = this.xmpp.getXmppLog();\n\n        if (log) {\n            metadata.xmpp = log;\n        }\n\n        data.metadata = metadata;\n\n        return data;\n    }\n\n    /**\n     * Get the XMPP instance.\n     * @internal\n     */\n    get xmpp(): XMPP {\n        return this._xmpp;\n    }\n}\n","export enum JitsiMediaDevicesEvents {\n\n    /**\n     * Indicates that the list of available media devices has been changed. The\n     * event provides the following parameters to its listeners:\n     *\n     * @param {MediaDeviceInfo[]} devices - array of MediaDeviceInfo or\n     *  MediaDeviceInfo-like objects that are currently connected.\n     *  @see https://developer.mozilla.org/en-US/docs/Web/API/MediaDeviceInfo\n     */\n    DEVICE_LIST_CHANGED = 'mediaDevices.devicechange',\n\n    /**\n     * Event emitted when the user granted/blocked a permission for the camera / mic.\n     * Used to keep track of the granted permissions on browsers which don't\n     * support the Permissions API.\n     */\n    PERMISSIONS_CHANGED = 'rtc.permissions_changed',\n\n    /**\n     * Indicates that the environment is currently showing permission prompt to\n     * access camera and/or microphone. The event provides the following\n     * parameters to its listeners:\n     *\n     * @param {'chrome'|'opera'|'firefox'|'safari'|'nwjs'\n     *  |'react-native'|'android'} environmentType - type of browser or\n     *  other execution environment.\n     */\n    PERMISSION_PROMPT_IS_SHOWN = 'mediaDevices.permissionPromptIsShown'\n}\n","import { JitsiMediaDevicesEvents } from './JitsiMediaDevicesEvents';\nimport RTC from './modules/RTC/RTC';\nimport browser from './modules/browser';\nimport Listenable from './modules/util/Listenable';\nimport { MediaType } from './service/RTC/MediaType';\nimport { RTCEvents } from './service/RTC/RTCEvents';\n\nconst AUDIO_PERMISSION_NAME = 'microphone' as PermissionName;\nconst PERMISSION_GRANTED_STATUS = 'granted';\nconst VIDEO_PERMISSION_NAME = 'camera' as PermissionName;\n\n/**\n * Media devices utilities for Jitsi.\n * @noInheritDoc\n */\nexport default class JitsiMediaDevices extends Listenable {\n    private _initialized: boolean;\n    private _permissions: { [key: string]: boolean; };\n    private _permissionsApiSupported: Promise<boolean>;\n\n    /**\n     * Initializes a `JitsiMediaDevices` object. There will be a single\n     * instance of this class.\n     */\n    constructor() {\n        super();\n        this._initialized = false;\n        this._permissions = {};\n        this._permissionsApiSupported = Promise.resolve(false);\n    }\n\n    /**\n     * Parses a PermissionState object and returns true for granted and false otherwise.\n     *\n     * @param {PermissionState} permissionStatus - The PermissionState object retrieved from the Permissions API.\n     * @returns {boolean} - True for granted and false for denied.\n     * @throws {TypeError}\n     */\n    private _parsePermissionState(permissionStatus: PermissionStatus = {} as PermissionStatus): boolean {\n        const status = permissionStatus.state;\n\n        if (typeof status !== 'string') {\n            throw new TypeError();\n        }\n\n        return status === PERMISSION_GRANTED_STATUS;\n    }\n\n    /**\n     * Updates the local granted/denied permissions cache. A permissions might be\n     * granted, denied, or undefined. This is represented by having its media\n     * type key set to `true` or `false` respectively.\n     *\n     * @param {Object} permissions - Object with the permissions.\n     */\n    private _handlePermissionsChange(permissions: { [key: string]: boolean; }): void {\n        const hasPermissionsChanged\n            = [ MediaType.AUDIO, MediaType.VIDEO ]\n                .some(type => type in permissions && permissions[type] !== this._permissions[type]);\n\n        if (hasPermissionsChanged) {\n            this._permissions = {\n                ...this._permissions,\n                ...permissions\n            };\n            this.eventEmitter.emit(JitsiMediaDevicesEvents.PERMISSIONS_CHANGED, this._permissions);\n\n            if (this._permissions[MediaType.AUDIO] || this._permissions[MediaType.VIDEO]) {\n                // Triggering device list update when the permissions are granted in order to update\n                // the labels the devices.\n                this.enumerateDevices(() => {\n                    // Empty callback - device list update triggered\n                });\n            }\n        }\n    }\n\n    /**\n     * Initialize. Start listening for device changes and initialize permissions checks.\n     * @internal\n     */\n    init(): void {\n        if (this._initialized) {\n            return;\n        }\n        this._initialized = true;\n\n        RTC.addListener(\n            RTCEvents.DEVICE_LIST_CHANGED,\n            devices =>\n                this.eventEmitter.emit(\n                    JitsiMediaDevicesEvents.DEVICE_LIST_CHANGED,\n                    devices));\n\n        // We would still want to update the permissions cache in case the permissions API is not supported.\n        RTC.addListener(\n            RTCEvents.PERMISSIONS_CHANGED,\n            permissions => this._handlePermissionsChange(permissions));\n\n        // Test if the W3C Permissions API is implemented and the 'camera' and 'microphone' permissions are\n        // implemented. If supported add onchange listeners.\n        this._permissionsApiSupported = new Promise(resolve => {\n            if (!navigator.permissions) {\n                resolve(false);\n\n                return;\n            }\n\n            const promises: Promise<boolean>[] = [];\n\n            promises.push(navigator.permissions.query({ name: VIDEO_PERMISSION_NAME })\n                .then(status => {\n                    this._handlePermissionsChange({\n                        [MediaType.VIDEO]: this._parsePermissionState(status)\n                    });\n                    status.onchange = () => {\n                        try {\n                            this._handlePermissionsChange({\n                                [MediaType.VIDEO]: this._parsePermissionState(status)\n                            });\n                        } catch (error) {\n                            // Nothing to do.\n                        }\n                    };\n\n                    return true;\n                })\n                .catch(() => false));\n\n            promises.push(navigator.permissions.query({ name: AUDIO_PERMISSION_NAME })\n                .then(status => {\n                    this._handlePermissionsChange({\n                        [MediaType.AUDIO]: this._parsePermissionState(status)\n                    });\n                    status.onchange = () => {\n                        try {\n                            this._handlePermissionsChange({\n                                [MediaType.AUDIO]: this._parsePermissionState(status)\n                            });\n                        } catch (error) {\n                            // Nothing to do.\n                        }\n                    };\n\n                    return true;\n                })\n                .catch(() => false));\n\n            Promise.all(promises).then(results => resolve(results.every(supported => supported)));\n\n        });\n    }\n\n    /**\n     * Executes callback with list of media devices connected.\n     * @param {function} callback\n     */\n    enumerateDevices(callback: (devices: MediaDeviceInfo[]) => void): void {\n        RTC.enumerateDevices(callback);\n    }\n\n    /**\n     * Returns true if changing the input (camera / microphone) or output\n     * (audio) device is supported and false if not.\n     * @param {string} [deviceType] - type of device to change. Default is\n     *      undefined or 'input', 'output' - for audio output device change.\n     * @returns {boolean} true if available, false otherwise.\n     */\n    isDeviceChangeAvailable(deviceType?: string): boolean {\n        return RTC.isDeviceChangeAvailable(deviceType);\n    }\n\n    /**\n     * Checks if the permission for the given device was granted.\n     *\n     * @param {'audio'|'video'} [type] - type of devices to check,\n     *      undefined stands for both 'audio' and 'video' together\n     * @returns {Promise<boolean>}\n     */\n    isDevicePermissionGranted(type?: MediaType): Promise<boolean> {\n        return new Promise(resolve => {\n            // Shortcut: first check if we already know the permission was\n            // granted.\n            if (type in this._permissions) {\n                resolve(this._permissions[type]);\n\n                return;\n            }\n\n            // Check using the Permissions API.\n            this._permissionsApiSupported.then(supported => {\n                if (!supported) {\n                    resolve(false);\n\n                    return;\n                }\n\n                const promises: Promise<PermissionStatus>[] = [];\n\n                switch (type) {\n                case MediaType.VIDEO:\n                    promises.push(\n                        navigator.permissions.query({\n                            name: VIDEO_PERMISSION_NAME\n                        }));\n                    break;\n                case MediaType.AUDIO:\n                    promises.push(\n                        navigator.permissions.query({\n                            name: AUDIO_PERMISSION_NAME\n                        }));\n                    break;\n                default:\n                    promises.push(\n                        navigator.permissions.query({\n                            name: VIDEO_PERMISSION_NAME\n                        }));\n                    promises.push(\n                        navigator.permissions.query({\n                            name: AUDIO_PERMISSION_NAME\n                        }));\n                }\n\n                Promise.all(promises).then(\n                    results => resolve(results.every(permissionStatus => {\n                        try {\n                            return this._parsePermissionState(permissionStatus);\n                        } catch {\n                            return false;\n                        }\n                    })),\n                    () => resolve(false)\n                );\n            });\n        });\n    }\n\n    /**\n     * Returns true if it is possible to be simultaneously capturing audio from more than one device.\n     *\n     * @returns {boolean}\n     */\n    isMultipleAudioInputSupported(): boolean {\n        return !(\n            (browser.isFirefox() && browser.isVersionLessThan(101))\n            || browser.isIosBrowser()\n        );\n    }\n\n    /**\n     * Returns currently used audio output device id, 'default' stands\n     * for default device\n     * @returns {string}\n     */\n    getAudioOutputDevice(): string {\n        return RTC.getAudioOutputDevice();\n    }\n\n    /**\n     * Sets current audio output device.\n     * @param {string} deviceId - id of 'audiooutput' device from\n     *      navigator.mediaDevices.enumerateDevices(), 'default' is for\n     *      default device\n     * @returns {Promise} - resolves when audio output is changed, is rejected\n     *      otherwise\n     */\n    setAudioOutputDevice(deviceId: string): Promise<void> {\n        return RTC.setAudioOutputDevice(deviceId);\n    }\n}\n","import { getLogger } from '@jitsi/logger';\n\nimport { JitsiTrackEvents } from '../../JitsiTrackEvents';\nimport JitsiLocalTrack from '../RTC/JitsiLocalTrack';\nimport RTC from '../RTC/RTC';\nimport Statistics from '../statistics/statistics';\n\nexport interface IActiveDeviceInfo {\n    deviceId: string;\n    deviceLabel: string;\n}\n\nconst logger = getLogger('vad:ActiveDeviceDetector');\n\n// If after 3000 ms the detector did not find any active devices consider that there aren't any usable ones available\n// i.e. audioLevel > 0.008\nconst DETECTION_TIMEOUT = 3000;\n\n\n/**\n * Go through all audio devices on the system and return one that is active, i.e. has audio signal.\n *\n * @returns Promise<IActiveDeviceInfo> - Object containing information about the found device.\n */\nexport default function getActiveAudioDevice(): Promise<IActiveDeviceInfo> {\n\n    return new Promise(resolve => {\n        RTC.enumerateDevices((devices: MediaDeviceInfo[]) => {\n            const audioDevices = devices.filter(device => device.kind === 'audioinput');\n            const devicePromiseArray: Promise<JitsiLocalTrack>[] = [];\n\n\n            for (const micDevice of audioDevices) {\n                const devicePromise = RTC.obtainAudioAndVideoPermissions({\n                    devices: [ 'audio' ],\n                    micDeviceId: micDevice.deviceId\n                }).then((tracks: JitsiLocalTrack[]) => {\n\n                    // We expect a single device to be available when obtained from obtainAudioAndVideoPermissions\n                    // that's  why only take p.value[0].\n                    const track = tracks[0];\n\n                    Statistics.startLocalStats(track, track.setAudioLevel.bind(track));\n\n                    return track;\n                });\n\n                devicePromiseArray.push(devicePromise);\n            }\n\n            Promise.allSettled(devicePromiseArray).then(outcomeArray => {\n                const successfulPromises = outcomeArray.filter(p => p.status === 'fulfilled');\n                const rejectedPromises = outcomeArray.filter(p => p.status === 'rejected');\n\n\n                const availableDevices = successfulPromises.map(p => (p as PromiseFulfilledResult<JitsiLocalTrack>).value);\n                const rejectReasons = rejectedPromises.map(p => (p as any).value);\n\n                for (const reason of rejectReasons) {\n                    logger.error('Failed to acquire audio device with error: ', reason);\n                }\n\n                // Setup event handlers for monitored devices.\n                for (const device of availableDevices) {\n                    device.on(JitsiTrackEvents.TRACK_AUDIO_LEVEL_CHANGED, audioLevel => {\n                        // This is a very naive approach but works, a more accurate one would be to use rnnoise in\n                        // order to limit  the number of false positives. The 0.008 constant is due to how\n                        // LocalStatsCollector from lib-jitsi-meet publishes audio-levels, in this case 0.008 denotes //\n                        // no input.\n                        if (audioLevel > 0.008) {\n                            stopActiveDevices(availableDevices);\n                            resolve({\n                                deviceId: device.deviceId,\n                                deviceLabel: device.getTrack().label\n                            });\n                        }\n                    });\n                }\n\n                // Cancel the detection in case no devices was found with audioLevel > 0 in the set timeout.\n                setTimeout(() => {\n                    stopActiveDevices(availableDevices);\n                    resolve({\n                        deviceId: '',\n                        deviceLabel: ''\n                    });\n                }, DETECTION_TIMEOUT);\n\n            });\n\n        });\n    });\n}\n\n/**\n * Stop the streams of the provided JitsiLocalTracks.\n *\n * @param {Array<JitsiLocalTrack>} deviceList - Array of JitsiLocalTracks to stop.\n * @returns {void}\n */\nfunction stopActiveDevices(deviceList: JitsiLocalTrack[]): void {\n    for (const device of deviceList) {\n        device.stopStream();\n    }\n}\n","import { getLogger } from '@jitsi/logger';\n\nimport { MediaType } from '../../service/RTC/MediaType';\nimport { type IPeerMediaInfo, default as SignalingLayer } from '../../service/RTC/SignalingLayer';\nimport ChatRoom from '../xmpp/ChatRoom';\n\nconst logger = getLogger('proxyconnection:CustomSignalingLayer');\n\n/**\n * Custom semi-mock implementation for the Proxy connection service.\n */\nexport default class CustomSignalingLayer extends SignalingLayer {\n    /**\n     * A map that stores SSRCs of remote streams.\n     * @type {Map<number, string>} maps SSRC number to jid\n     */\n    private ssrcOwners: Map<number, string>;\n\n    /**\n     *\n     * @type {ChatRoom|null}\n     */\n    public chatRoom: Nullable<ChatRoom>;\n\n    /**\n     * Creates new instance.\n     */\n    constructor() {\n        super();\n\n        this.ssrcOwners = new Map<number, string>();\n        this.chatRoom = null;\n    }\n\n    /**\n     * @inheritDoc\n     */\n    override getPeerMediaInfo(_owner: string, _mediaType: MediaType, _sourceName: string): IPeerMediaInfo {\n        return { };\n    }\n\n    /**\n     * @inheritDoc\n     */\n    override getPeerSourceInfo(_owner: string, _sourceName: string): any {\n        return undefined;\n    }\n\n    /**\n     * @inheritDoc\n     */\n    override getSSRCOwner(ssrc: number): Optional<string> {\n        return this.ssrcOwners.get(ssrc);\n    }\n\n    /**\n     * @inheritDoc\n     */\n    override getTrackSourceName(_ssrc: number): Optional<string> {\n        return undefined;\n    }\n\n    /**\n     * @inheritDoc\n     */\n    override removeSSRCOwners(ssrcList: number[]): void {\n        if (!ssrcList?.length) {\n            return;\n        }\n\n        for (const ssrc of ssrcList) {\n            this.ssrcOwners.delete(ssrc);\n        }\n    }\n\n    /**\n     * Sets the <tt>ChatRoom</tt> instance used.\n     * @param {ChatRoom} room\n     */\n    setChatRoom(room: ChatRoom): void {\n        this.chatRoom = room;\n    }\n\n    /**\n     * @inheritDoc\n     */\n    override setSSRCOwner(ssrc: number, endpointId: string): void {\n        if (typeof ssrc !== 'number') {\n            throw new TypeError(`SSRC(${ssrc}) must be a number`);\n        }\n\n        // Now signaling layer instance is shared between different JingleSessionPC instances, so although very unlikely\n        // an SSRC conflict could potentially occur. Log a message to make debugging easier.\n        const existingOwner = this.ssrcOwners.get(ssrc);\n\n        if (existingOwner && existingOwner !== endpointId) {\n            logger.error(`SSRC owner re-assigned from ${existingOwner} to ${endpointId}`);\n        }\n        this.ssrcOwners.set(ssrc, endpointId);\n    }\n\n    /**\n     * @inheritDoc\n     */\n    override setTrackMuteStatus(_sourceName: string, _muted: boolean): boolean {\n        return false;\n    }\n\n    /**\n     * @inheritDoc\n     */\n    override setTrackVideoType(_sourceName: string, _videoType: string): boolean {\n        return false;\n    }\n\n    /**\n     * @inheritDoc\n     */\n    override updateSsrcOwnersOnLeave(id: string): void {\n        const ssrcs = Array.from(this.ssrcOwners)\n            .filter((entry: [number, string]) => entry[1] === id)\n            .map((entry: [number, string]) => entry[0]);\n\n        if (!ssrcs?.length) {\n            return;\n        }\n\n        this.removeSSRCOwners(ssrcs);\n    }\n}\n","/**\n * The know jingle actions that can be sent and should be acted upon by\n * {@code ProxyConnectionService} and {@code ProxyConnectionPC}.\n */\nexport enum ACTIONS {\n    ACCEPT = 'session-accept',\n    CONNECTION_ERROR = 'connection-error-encountered',\n    INITIATE = 'session-initiate',\n    TERMINATE = 'session-terminate',\n    TRANSPORT_INFO = 'transport-info',\n    UNAVAILABLE = 'unavailable'\n}\n","import { getLogger } from '@jitsi/logger';\n\nimport { getAttribute } from '../../modules/util/XMLUtils';\nimport { RTCEvents } from '../../service/RTC/RTCEvents';\nimport { XMPPEvents } from '../../service/xmpp/XMPPEvents';\nimport RTC from '../RTC/RTC';\nimport JingleSessionPC from '../xmpp/JingleSessionPC';\nimport { DEFAULT_STUN_SERVERS } from '../xmpp/xmpp';\n\nimport CustomSignalingLayer from './CustomSignalingLayer';\nimport { ACTIONS } from './constants';\n\nconst logger = getLogger('proxyconnection:ProxyConnectionPC');\n\n/**\n * An adapter around {@code JingleSessionPC} so its logic can be re-used without\n * an XMPP connection. It is being re-used for consistency with the rest of the\n * codebase and to leverage existing peer connection event handling. Also\n * this class provides a facade to hide most of the API for\n * {@code JingleSessionPC}.\n */\nexport default class ProxyConnectionPC {\n    /**\n     * Initializes a new {@code ProxyConnectionPC} instance.\n     *\n     * @param {Object} options - Values to initialize the instance with.\n     * @param {Object} [options.pcConfig] - The {@code RTCConfiguration} to use for the WebRTC peer connection.\n     * @param {boolean} [options.isInitiator] - If true, the local client should send offers. If false, the local\n     * client should send answers. Defaults to false.\n     * @param {Function} options.onRemoteStream - Callback to invoke when a remote media stream has been received\n     * through the peer connection.\n     * @param {string} options.peerJid - The jid of the remote client with which the peer connection is being establish\n     * and which should receive direct messages regarding peer connection updates.\n     * @param {boolean} [options.receiveVideo] - Whether or not the peer connection should accept incoming video\n     * streams. Defaults to false.\n     * @param {Function} options.onSendMessage - Callback to invoke when a message has to be sent (signaled) out.\n     */\n    constructor(options = {}) {\n        this._options = {\n            isInitiator: false,\n            pcConfig: {},\n            receiveAudio: false,\n            receiveVideo: false,\n            ...options\n        };\n\n        /**\n         * Instances of {@code JitsiTrack} associated with this instance of\n         * {@code ProxyConnectionPC}.\n         *\n         * @type {Array<JitsiTrack>}\n         */\n        this._tracks = [];\n\n        /**\n         * The active instance of {@code JingleSessionPC}.\n         *\n         * @type {JingleSessionPC|null}\n         */\n        this._peerConnection = null;\n\n        // Bind event handlers so they are only bound once for every instance.\n        this._onError = this._onError.bind(this);\n        this._onRemoteStream = this._onRemoteStream.bind(this);\n        this._onSendMessage = this._onSendMessage.bind(this);\n    }\n\n    /**\n     * Returns the jid of the remote peer with which this peer connection should\n     * be established with.\n     *\n     * @returns {string}\n     */\n    getPeerJid() {\n        return this._options.peerJid;\n    }\n\n    /**\n     * Updates the peer connection based on the passed in jingle.\n     *\n     * @param {Element} jingleElement - An XML jingle element describing how the peer connection should be updated.\n     * @returns {void}\n     */\n    processMessage(jingleElement) {\n        switch (getAttribute(jingleElement, 'action')) {\n        case ACTIONS.ACCEPT:\n            this._onSessionAccept(jingleElement);\n            break;\n\n        case ACTIONS.INITIATE:\n            this._onSessionInitiate(jingleElement);\n            break;\n\n        case ACTIONS.TERMINATE:\n            this._onSessionTerminate(jingleElement);\n            break;\n\n        case ACTIONS.TRANSPORT_INFO:\n            this._onTransportInfo(jingleElement);\n            break;\n        }\n    }\n\n    /**\n     * Instantiates a peer connection and starts the offer/answer cycle to\n     * establish a connection with a remote peer.\n     *\n     * @param {Array<JitsiLocalTrack>} localTracks - Initial local tracks to add\n     * to add to the peer connection.\n     * @returns {void}\n     */\n    start(localTracks = []) {\n        if (this._peerConnection) {\n            return;\n        }\n\n        this._tracks = this._tracks.concat(localTracks);\n\n        this._peerConnection = this._createPeerConnection();\n\n        this._peerConnection.invite(localTracks);\n    }\n\n    /**\n     * Begins the process of disconnecting from a remote peer and cleaning up\n     * the peer connection.\n     *\n     * @returns {void}\n     */\n    stop() {\n        if (this._peerConnection) {\n            this._peerConnection.terminate();\n        }\n\n        this._onSessionTerminate();\n    }\n\n    /**\n     * Instantiates a new {@code JingleSessionPC} by stubbing out the various\n     * dependencies of {@code JingleSessionPC}.\n     *\n     * @private\n     * @returns {JingleSessionPC}\n     */\n    _createPeerConnection() {\n        /**\n         * {@code JingleSessionPC} takes in the entire jitsi-meet config.js\n         * object, which may not be accessible from the caller.\n         *\n         * @type {Object}\n         */\n        const configStub = {};\n\n        /**\n         * {@code JingleSessionPC} assumes an XMPP/Strophe connection object is\n         * passed through, which also has the jingle plugin initialized on it.\n         * This connection object is used to signal out peer connection updates\n         * via iqs, and those updates need to be piped back out to the remote\n         * peer.\n         *\n         * @type {Object}\n         */\n        const connectionStub = {\n            // At the time this is used for Spot and it's okay to say the connection is always connected, because if\n            // spot has no signalling it will not be in a meeting where this is used.\n            // eslint-disable-next-line no-empty-function\n            addCancellableListener: () => () => { },\n            // eslint-disable-next-line no-empty-function\n            addEventListener: () => () => { },\n            connected: true,\n            jingle: {\n                terminate: () => { /** no-op */ }\n            },\n            sendIQ: this._onSendMessage\n        };\n\n        /**\n         * {@code JingleSessionPC} can take in a custom ice configuration,\n         * depending on the peer connection type, peer-to-peer or other.\n         * However, {@code ProxyConnectionPC} always assume a peer-to-peer\n         * connection so the ice configuration is hard-coded with defaults.\n         *\n         * @type {Object}\n         */\n        const pcConfigStub = {\n            iceServers: DEFAULT_STUN_SERVERS,\n            ...this._options.pcConfig\n        };\n\n        /**\n         * {@code JingleSessionPC} expects an instance of\n         * {@code JitsiConference}, which has an event emitter that is used\n         * to signal various connection updates that the local client should\n         * act upon. The conference instance is not a dependency of a proxy\n         * connection, but the emitted events can be relevant to the proxy\n         * connection so the event emitter is stubbed.\n         *\n         * @param {string} event - The constant for the event type.\n         * @type {Function}\n         * @returns {void}\n         */\n        const emitter = event => {\n            switch (event) {\n            case XMPPEvents.CONNECTION_ICE_FAILED:\n            case XMPPEvents.CONNECTION_FAILED:\n                this._onError(ACTIONS.CONNECTION_ERROR, event);\n                break;\n            }\n        };\n\n        /**\n         * {@link JingleSessionPC} expects an instance of\n         * {@link ChatRoom} to be passed in. {@link ProxyConnectionPC}\n         * is instantiated outside of the {@code JitsiConference}, so it must be\n         * stubbed to prevent errors.\n         *\n         * @type {Object}\n         */\n        const roomStub = {\n            addEventListener: () => { /* no op */ },\n            addPresenceListener: () => { /* no-op */ },\n            connectionTimes: [],\n            eventEmitter: { emit: emitter },\n            removeEventListener: () => { /* no op */ },\n            removePresenceListener: () => { /* no-op */ }\n        };\n\n        /**\n         * A {@code JitsiConference} stub passed to the {@link RTC} module.\n         * @type {Object}\n         */\n        const conferenceStub = {\n            myUserId: () => ''\n        };\n\n        /**\n         * Create an instance of {@code RTC} as it is required for peer\n         * connection creation by {@code JingleSessionPC}. An existing instance\n         * of {@code RTC} from elsewhere should not be re-used because it is\n         * a stateful grouping of utilities.\n         */\n        this._rtc = new RTC(conferenceStub, {});\n\n        /**\n         * Add the remote track listener here as {@code JingleSessionPC} has\n         * {@code TraceablePeerConnection} which uses {@code RTC}'s event\n         * emitter.\n         */\n        this._rtc.addListener(\n            RTCEvents.REMOTE_TRACK_ADDED,\n            this._onRemoteStream\n        );\n\n        const peerConnection = new JingleSessionPC(\n            undefined, // sid\n            undefined, // localJid\n            this._options.peerJid, // remoteJid\n            connectionStub, // connection\n            {\n                offerToReceiveAudio: this._options.receiveAudio,\n                offerToReceiveVideo: this._options.receiveVideo\n            }, // mediaConstraints\n            pcConfigStub, // pcConfig\n            true, // isP2P\n            this._options.isInitiator // isInitiator\n        );\n\n        const signalingLayer = new CustomSignalingLayer();\n\n        signalingLayer.setChatRoom(roomStub);\n\n        /**\n         * An additional initialize call is necessary to properly set instance\n         * variable for calling.\n         */\n        peerConnection.initialize(roomStub, this._rtc, signalingLayer, configStub);\n\n        return peerConnection;\n    }\n\n    /**\n     * Invoked when a connection related issue has been encountered.\n     *\n     * @param {string} errorType - The constant indicating the type of the error\n     * that occurred.\n     * @param {string} details - Optional additional data about the error.\n     * @private\n     * @returns {void}\n     */\n    _onError(errorType, details = '') {\n        this._options.onError(this._options.peerJid, errorType, details);\n    }\n\n    /**\n     * Callback invoked when the peer connection has received a remote media\n     * stream.\n     *\n     * @param {JitsiRemoteTrack} jitsiRemoteTrack - The remote media stream\n     * wrapped in {@code JitsiRemoteTrack}.\n     * @private\n     * @returns {void}\n     */\n    _onRemoteStream(jitsiRemoteTrack) {\n        this._tracks.push(jitsiRemoteTrack);\n\n        this._options.onRemoteStream(jitsiRemoteTrack);\n    }\n\n    /**\n     * Callback invoked when {@code JingleSessionPC} needs to signal a message\n     * out to the remote peer.\n     *\n     * @param {XML} iq - The message to signal out.\n     * @param {Function} callback - Callback when the IQ was acknowledged.\n     * @private\n     * @returns {void}\n     */\n    _onSendMessage(iq, callback) {\n        this._options.onSendMessage(this._options.peerJid, iq);\n\n        if (callback) {\n            // Fake some time to receive the acknowledge.\n            setTimeout(callback, 250);\n        }\n    }\n\n    /**\n     * Callback invoked in response to an agreement to start a proxy connection.\n     * The passed in jingle element should contain an SDP answer to a previously\n     * sent SDP offer.\n     *\n     * @param {Element} jingleElement - The jingle element.\n     * @private\n     * @returns {void}\n     */\n    _onSessionAccept(jingleElement) {\n        if (!this._peerConnection) {\n            logger.error('Received an answer when no peer connection exists.');\n\n            return;\n        }\n\n        this._peerConnection.setAnswer(jingleElement);\n    }\n\n    /**\n     * Callback invoked in response to a request to start a proxy connection.\n     * The passed in jingle element should contain an SDP offer.\n     *\n     * @param {Element} jingleElement - The jingle element.\n     * @private\n     * @returns {void}\n     */\n    _onSessionInitiate(jingleElement) {\n        if (this._peerConnection) {\n            logger.error('Received an offer when an offer was already sent.');\n\n            return;\n        }\n\n        this._peerConnection = this._createPeerConnection();\n\n        this._peerConnection.acceptOffer(\n            jingleElement,\n            () => { /** no-op */ },\n            () => this._onError(\n                this._options.peerJid,\n                ACTIONS.CONNECTION_ERROR,\n                'session initiate error'\n            ),\n            []\n        );\n    }\n\n    /**\n     * Callback invoked in response to a request to disconnect an active proxy\n     * connection. Cleans up tracks and the peer connection.\n     *\n     * @private\n     * @returns {void}\n     */\n    _onSessionTerminate() {\n        this._tracks.forEach(track => track.dispose());\n        this._tracks = [];\n\n        if (this._peerConnection) {\n            this._peerConnection.onTerminated();\n        }\n\n        if (this._rtc) {\n            this._rtc.removeListener(\n                RTCEvents.REMOTE_TRACK_ADDED,\n                this._onRemoteStream\n            );\n\n            this._rtc.destroy();\n        }\n    }\n\n    /**\n     * Callback invoked in response to ICE candidates from the remote peer.\n     * The passed in jingle element should contain an ICE candidate.\n     *\n     * @param {Element} jingleElement - The jingle element.\n     * @private\n     * @returns {void}\n     */\n    _onTransportInfo(jingleElement) {\n        this._peerConnection.addIceCandidates(jingleElement);\n    }\n}\n","import { getLogger } from '@jitsi/logger';\nimport { $iq } from 'strophe.js';\n\nimport { findFirst, getAttribute, parseXML } from '../../modules/util/XMLUtils';\nimport { MediaType } from '../../service/RTC/MediaType';\nimport { getSourceNameForJitsiTrack } from '../../service/RTC/SignalingLayer';\nimport { VideoType } from '../../service/RTC/VideoType';\nimport RTC from '../RTC/RTC';\n\nimport ProxyConnectionPC from './ProxyConnectionPC';\nimport { ACTIONS } from './constants';\n\nconst logger = getLogger('proxyconnection:ProxyConnectionService');\n\n/**\n * Instantiates a new ProxyConnectionPC and ensures only one exists at a given\n * time. Currently it assumes ProxyConnectionPC is used only for screensharing\n * and assumes IQs to be used for communication.\n */\nexport default class ProxyConnectionService {\n    /**\n     * Initializes a new {@code ProxyConnectionService} instance.\n     *\n     * @param {Object} options - Values to initialize the instance with.\n     * @param {boolean} [options.convertVideoToDesktop] - Whether or not proxied video should be returned as a desktop\n     * stream. Defaults to false.\n     * @param {Object} [options.pcConfig] - The {@code RTCConfiguration} to use for the WebRTC peer connection.\n     * @param {JitsiConnection} [options.jitsiConnection] - The {@code JitsiConnection} which will be used to fetch\n     * TURN credentials for the P2P connection.\n     * @param {Function} options.onRemoteStream - Callback to invoke when a remote video stream has been received and\n     * converted to a {@code JitsiLocakTrack}. The {@code JitsiLocakTrack} will be passed in.\n     * @param {Function} options.onSendMessage - Callback to invoke when a message has to be sent (signaled) out. The\n     * arguments passed in are the jid to send the message to and the message.\n     */\n    constructor(options = {}) {\n        const {\n            jitsiConnection,\n            ...otherOptions\n        } = options;\n\n        /**\n         * Holds a reference to the collection of all callbacks.\n         *\n         * @type {Object}\n         */\n        this._options = {\n            pcConfig: jitsiConnection && jitsiConnection.xmpp.connection.jingle.p2pIceConfig,\n            ...otherOptions\n        };\n\n        /**\n         * The active instance of {@code ProxyConnectionService}.\n         *\n         * @type {ProxyConnectionPC|null}\n         */\n        this._peerConnection = null;\n\n        // Bind event handlers so they are only bound once for every instance.\n        this._onFatalError = this._onFatalError.bind(this);\n        this._onSendMessage = this._onSendMessage.bind(this);\n        this._onRemoteStream = this._onRemoteStream.bind(this);\n    }\n\n    /**\n     * Parses a message object regarding a proxy connection to create a new\n     * proxy connection or update and existing connection.\n     *\n     * @param {Object} message - A message object regarding establishing or\n     * updating a proxy connection.\n     * @param {Object} message.data - An object containing additional message\n     * details.\n     * @param {string} message.data.iq - The stringified iq which explains how\n     * and what to update regarding the proxy connection.\n     * @param {string} message.from - The message sender's full jid. Used for\n     * sending replies.\n     * @returns {void}\n     */\n    processMessage(message) {\n        const peerJid = message.from;\n\n        if (!peerJid) {\n            return;\n        }\n\n        // If a proxy connection has already been established and messages come\n        // from another peer jid then those messages should be replied to with\n        // a rejection.\n        if (this._peerConnection\n            && this._peerConnection.getPeerJid() !== peerJid) {\n            this._onFatalError(\n                peerJid,\n                ACTIONS.CONNECTION_ERROR,\n                'rejected'\n            );\n\n            return;\n        }\n\n        const iq = this._convertStringToXML(message.data.iq);\n        const jingleElement = findFirst(iq, 'jingle');\n        const action = getAttribute(jingleElement, 'action');\n\n        if (action === ACTIONS.INITIATE) {\n            this._peerConnection = this._createPeerConnection(peerJid, {\n                isInitiator: false,\n                receiveVideo: true\n            });\n        }\n\n        // Truthy check for peer connection added to protect against possibly\n        // receiving actions before an ACTIONS.INITIATE.\n        if (this._peerConnection && jingleElement) {\n            this._peerConnection.processMessage(jingleElement);\n        }\n\n        // Take additional steps to ensure the peer connection is cleaned up\n        // if it is to be closed.\n        if (action === ACTIONS.CONNECTION_ERROR\n            || action === ACTIONS.UNAVAILABLE\n            || action === ACTIONS.TERMINATE) {\n            this._selfCloseConnection();\n        }\n\n\n    }\n\n    /**\n     * Instantiates and initiates a proxy peer connection.\n     *\n     * @param {string} peerJid - The jid of the remote client that should\n     * receive messages.\n     * @param {Array<JitsiLocalTrack>} localTracks - Initial media tracks to\n     * send through to the peer.\n     * @returns {void}\n     */\n    start(peerJid, localTracks = []) {\n        this._peerConnection = this._createPeerConnection(peerJid, {\n            isInitiator: true,\n            receiveVideo: false\n        });\n\n        localTracks.forEach((localTrack, localTrackIndex) => {\n            const localSourceNameTrack = getSourceNameForJitsiTrack('peer', localTrack.getType(), localTrackIndex);\n\n            localTrack.setSourceName(localSourceNameTrack);\n        });\n\n        this._peerConnection.start(localTracks);\n    }\n\n    /**\n     * Terminates any active proxy peer connection.\n     *\n     * @returns {void}\n     */\n    stop() {\n        if (this._peerConnection) {\n            this._peerConnection.stop();\n        }\n\n        this._peerConnection = null;\n    }\n\n    /**\n     * Transforms a stringified xML into a XML element.\n     *\n     * @param {string} xml - The XML in string form.\n     * @private\n     * @returns {Object|null} An element version of the xml. Null will be returned\n     * if an error is encountered during transformation.\n     */\n    _convertStringToXML(xml) {\n        try {\n            const xmlDom = parseXML(xml);\n\n            return xmlDom;\n        } catch (e) {\n            logger.error('Attempted to convert incorrectly formatted xml');\n\n            return null;\n        }\n    }\n\n    /**\n     * Helper for creating an instance of {@code ProxyConnectionPC}.\n     *\n     * @param {string} peerJid - The jid of the remote peer with which the\n     * {@code ProxyConnectionPC} will be established with.\n     * @param {Object} options - Additional defaults to instantiate the\n     * {@code ProxyConnectionPC} with. See the constructor of ProxyConnectionPC\n     * for more details.\n     * @private\n     * @returns {ProxyConnectionPC}\n     */\n    _createPeerConnection(peerJid, options = {}) {\n        if (!peerJid) {\n            throw new Error('Cannot create ProxyConnectionPC without a peer.');\n        }\n\n        const pcOptions = {\n            onError: this._onFatalError,\n            onRemoteStream: this._onRemoteStream,\n            onSendMessage: this._onSendMessage,\n            pcConfig: this._options.pcConfig,\n            peerJid,\n            ...options\n        };\n\n        return new ProxyConnectionPC(pcOptions);\n    }\n\n    /**\n     * Callback invoked when an error occurs that should cause\n     * {@code ProxyConnectionPC} to be closed if the peer is currently\n     * connected. Sends an error message/reply back to the peer.\n     *\n     * @param {string} peerJid - The peer jid with which the connection was\n     * attempted or started, and to which an iq with error details should be\n     * sent.\n     * @param {string} errorType - The constant indicating the type of the error\n     * that occurred.\n     * @param {string} details - Optional additional data about the error.\n     * @private\n     * @returns {void}\n     */\n    _onFatalError(peerJid, errorType, details = '') {\n        logger.error(\n            'Received a proxy connection error', peerJid, errorType, details);\n\n        const iq = $iq({\n            to: peerJid,\n            type: 'set'\n        })\n            .c('jingle', {\n                action: errorType,\n                xmlns: 'urn:xmpp:jingle:1'\n            })\n            .c('details')\n            .t(details)\n            .up();\n\n        this._onSendMessage(peerJid, iq);\n\n        if (this._peerConnection\n            && this._peerConnection.getPeerJid() === peerJid) {\n            this._selfCloseConnection();\n        }\n    }\n\n    /**\n     * Callback invoked when the remote peer of the {@code ProxyConnectionPC}\n     * has offered a media stream. The stream is converted into a\n     * {@code JitsiLocalTrack} for local usage if the {@code onRemoteStream}\n     * callback is defined.\n     *\n     * @param {JitsiRemoteTrack} jitsiRemoteTrack - The {@code JitsiRemoteTrack}\n     * for the peer's media stream.\n     * @private\n     * @returns {void}\n     */\n    _onRemoteStream(jitsiRemoteTrack) {\n        if (!this._options.onRemoteStream) {\n            logger.error('Remote track received without callback.');\n            jitsiRemoteTrack.dispose();\n\n            return;\n        }\n\n        const isVideo = jitsiRemoteTrack.isVideoTrack();\n        let videoType;\n\n        if (isVideo) {\n            videoType = this._options.convertVideoToDesktop\n                ? VideoType.DESKTOP : VideoType.CAMERA;\n        }\n\n        // Grab the webrtc media stream and pipe it through the same processing\n        // that would occur for a locally obtained media stream.\n        const mediaStream = jitsiRemoteTrack.getOriginalStream();\n        const jitsiLocalTracks = RTC.createLocalTracks(\n            [\n                {\n                    deviceId:\n                        `proxy:${this._peerConnection.getPeerJid()}`,\n                    mediaType: isVideo ? MediaType.VIDEO : MediaType.AUDIO,\n                    sourceType: 'proxy',\n                    stream: mediaStream,\n                    track: mediaStream.getVideoTracks()[0],\n                    videoType\n                }\n            ]);\n\n        this._options.onRemoteStream(jitsiLocalTracks[0]);\n    }\n\n    /**\n     * Formats and forwards a message an iq to be sent to a peer jid.\n     *\n     * @param {string} peerJid - The jid the iq should be sent to.\n     * @param {Object} iq - The iq which would be sent to the peer jid.\n     * @private\n     * @returns {void}\n     */\n    _onSendMessage(peerJid, iq) {\n        if (!this._options.onSendMessage) {\n            return;\n        }\n\n        try {\n            const stringifiedIq\n                = new XMLSerializer().serializeToString(iq.nodeTree || iq);\n\n            this._options.onSendMessage(peerJid, { iq: stringifiedIq });\n        } catch (e) {\n            logger.error('Attempted to send an incorrectly formatted iq.');\n        }\n    }\n\n    /**\n     * Invoked when preemptively closing the {@code ProxyConnectionPC}.\n     *\n     * @private\n     * @returns {void}\n     */\n    _selfCloseConnection() {\n        this.stop();\n\n        this._options.onConnectionClosed\n            && this._options.onConnectionClosed();\n    }\n}\n","/** Class for providing information about an ICE candidate */\nclass ParsedIceCandidate {\n  /** Create a new object\n   * @param {Object} iceCandidate the ice candidate */\n  constructor(iceCandidate) {\n    this.iceCandidateStr = iceCandidate.candidate;\n\n    this.parse();\n  }\n\n  /** Parse the ICE candidate\n   * @private\n   */\n  parse() {\n    let parsed = this.iceCandidateStr.split(' ');\n    if (parsed.length < 8) {\n      return;\n    }\n\n    /* Candidate string examples with indices:\n               0            1  2    3           4           5\n       \"candidate:911959162 1 udp 2113937151 192.168.1.175 49977\n        6   7     8        9   10   11    12         13\n       typ host generation 0 ufrag WBVw network-cost 50\"\n\n               0             1  2    3           4          5\n       \"candidate:3941065291 1 udp 33562367   172.18.0.2   30704\n        6   7     8        9   10   11    12      13  14    15   16         17\n       typ relay raddr 0.0.0.0 rport 0 generation 0 ufrag 2R2F network-cost 50\"\n    */\n\n    this.protocol = (parsed[1] === '1' ? 'rtp' : 'rtcp');\n    this.transport = parsed[2];\n    this.typeTransport = this.extractTypeTransport(parsed[3]);\n\n    this.ipv6 = parsed[4].indexOf(':') !== -1;\n    this.ipAddress = parsed[4];\n    this.port = parsed[5];\n\n    this.type = parsed[7];\n  }\n\n  /** get the type of transport from the preference\n   * @param {String} preference the preference from the ICE candidate\n   * @return {String} UDP, TCP, or TLS\n   * @private\n   */\n  extractTypeTransport(preference) {\n    let ret = 'None';\n\n    let tmp = (preference >> 24);\n    if (this.protocol === 'rtp' && tmp >= 0 && tmp <= 2) {\n      switch (tmp) {\n        case 0:\n          ret = 'TLS';\n          break;\n        case 1:\n          ret = 'TCP';\n          break;\n        case 2:\n          ret = 'UDP';\n          break;\n      }\n    }\n\n    return ret;\n  };\n\n  /** the candidate as string\n   * @return {String} the candidate\n   * @public\n   */\n  getString() {\n    return this.iceCandidateStr;\n  }\n\n  /* --------- Type --------- */\n\n  /** Type\n   * @return {String} type\n   * @public\n   */\n  getType() {\n    return this.type;\n  }\n\n  /** host candidate or not\n   * @return {Boolean} host or not\n   * @public\n   */\n  isHost() {\n    return this.type.toLowerCase() === 'host';\n  }\n\n  /** server reflexive candidate or not\n   * @return {Boolean} reflexive or not\n   * @public\n   */\n  isServerReflexive() {\n    return this.type.toLowerCase() === 'srflx';\n  }\n\n  /** peer reflexive candidate or not\n   * @return {Boolean} reflexive or not\n   * @public\n   */\n  isPeerReflexive() {\n    return this.type.toLowerCase() === 'prflx';\n  }\n\n  /** relay candidate or not\n   * @return {Boolean} relay or not\n   * @public\n   */\n  isRelay() {\n    return this.type.toLowerCase() === 'relay' || this.type.toLowerCase() === 'relayed';\n  }\n\n  /** public candidate or not\n   * @return {Boolean} relay or not\n   * @public\n   */\n  isPublicIp() {\n    return this.type.toLowerCase() === 'srflx' || this.type.toLowerCase() === 'prflx';\n  }\n\n  /* --------- Type transport --------- */\n\n  /** type transport\n   * @return {String} type transport (UDP, TCP, or TLS)\n   * @public\n   */\n  getTypeTransport() {\n    return this.typeTransport;\n  }\n\n  /** Type transport UDP\n   * @return {Boolean} if UDP or not\n   */\n  isTypeTransportUdp() {\n    return this.typeTransport === 'UDP';\n  }\n\n  /** Type transport TCP\n   * @return {Boolean} if TCP or not\n   */\n  isTypeTransportTcp() {\n    return this.typeTransport === 'TCP';\n  }\n\n  /** Type transport TLS\n   * @return {Boolean} if TLS or not\n   */\n  isTypeTransportTls() {\n    return this.typeTransport === 'TLS';\n  }\n\n  /* --------- Transport --------- */\n\n  /** Transport used\n   * @return {String} transport (udp or tcp)\n   * @public\n   */\n  getTransport() {\n    return this.transport;\n  }\n\n  /** UDP\n   * @return {Boolean} UDP or not\n   * @public\n   */\n  isUdp() {\n    return this.transport.toLowerCase() === 'udp';\n  }\n\n  /** TCP\n   * @return {Boolean} TCP or not\n   * @public\n   */\n  isTcp() {\n    return this.transport.toLowerCase() === 'tcp';\n  }\n\n\n  /* --------- Protocol --------- */\n\n  /** Protocol used\n   * @return {String} protocol (rtp or rtcp)\n   * @public\n   */\n  getProtocol() {\n    return this.protocol;\n  }\n\n  /** RTP\n   * @return {Boolean} RTP or not\n   * @public\n   */\n  isRtp() {\n    return this.protocol === 'rtp';\n  }\n\n  /** RTCP\n   * @return {Boolean} RTCP or not\n   * @public\n   */\n  isRtcp() {\n    return this.protocol === 'rtcp';\n  }\n\n\n  /* --------- IP/port --------- */\n\n  /** IPv6 or not\n   * @return {Boolean} ipv6 or not\n   */\n  isIpv6() {\n    return this.ipv6;\n  }\n\n  /** IP address\n   * @return {String} IP address\n   * @public\n   */\n  getIpAddress() {\n    return this.ipAddress;\n  }\n\n  /** port\n   * @return {String} port\n   * @public\n   */\n  getPort() {\n    return this.port;\n  }\n}\n\nexport {ParsedIceCandidate};\n","export const Constants = {\n  codeBaseType: {\n    chrome: 'Chrome',\n    firefox: 'Firefox',\n    edge: 'Edge',\n    plugin: 'Plugin',\n  },\n\n  browserName: {\n    chrome: 'Chrome',\n    firefox: 'Firefox',\n    edge: 'Edge',\n    msie: 'Microsoft Internet Explorer',\n    safari: 'Safari',\n  },\n\n  osName: {\n    windows: 'Windows',\n    mac: 'Mac OS X',\n    android: 'Android',\n    ios: 'iOS',\n  },\n};\n\n/**\n * detect - Detect the browser related inforamtion\n * @public\n * @return {Object} Browser and OS information\n */\nexport function detect() {\n  let browserName = Constants.browserName.chrome;\n  let osName = null;\n  let osVersion = null;\n  let userAgent = null;\n  let agentVersion = null;\n\n  let codeBaseType = Constants.codeBaseType.chrome;\n\n  if (window && (!window.navigator || !window.navigator.userAgent || window.csioReactNative)) {\n    if (window && window.csioGetOsName) {\n      osName = window.csioGetOsName();\n    }\n\n    if (window && window.csioGetOsVer) {\n      osVersion = window.csioGetOsVer();\n    }\n\n    if (window && window.csioReactNative) {\n      userAgent = 'react-native';\n    }\n\n    return {\n      browserName: browserName,\n      codeBase: codeBaseType,\n      os: osName,\n      osVersion: osVersion,\n      userAgent: userAgent,\n    };\n  }\n\n  userAgent = navigator.userAgent;\n  let nAgt = userAgent.toLowerCase();\n\n  agentVersion = navigator.appVersion;\n  let nVer;\n  let fullVersion;\n  if (agentVersion) {\n    nVer = agentVersion.toLowerCase();\n    fullVersion = '' + parseFloat(nVer);\n  }\n  let verOffset;\n  let version = 'version';\n\n\n  // In Opera, the true version is after \"Opera\" or after \"Version\"\n  if ((verOffset = nAgt.indexOf('opera')) !== -1) {\n    browserName = Constants.browserName.opera;\n    fullVersion = nAgt.substring(verOffset + 6);\n    if ((verOffset = nAgt.indexOf(version)) !== -1) {\n      fullVersion = nAgt.substring(verOffset + 8);\n    }\n    codeBaseType = Constants.codeBaseType.chrome;\n  } else if ((verOffset = nAgt.indexOf('opr')) !== -1) {\n    browserName = Constants.browserName.opera;\n    fullVersion = nAgt.substring(verOffset + 4);\n    if ((verOffset = nAgt.indexOf(version)) !== -1) {\n      fullVersion = nAgt.substring(verOffset + 8);\n    }\n    codeBaseType = Constants.codeBaseType.chrome;\n  } else if ((verOffset = nAgt.indexOf('msie')) !== -1) { // In MSIE, the true version is after \"MSIE\" in userAgent\n    browserName = Constants.browserName.msie;\n    fullVersion = nAgt.substring(verOffset + 5);\n    codeBaseType = Constants.codeBaseType.chrome;\n  } else if ((verOffset = nAgt.indexOf('edge')) !== -1) {\n    browserName = Constants.browserName.edge;\n    fullVersion = nAgt.substring(verOffset + 5);\n    codeBaseType = Constants.codeBaseType.edge;\n  } else if ((verOffset = nAgt.indexOf('edg')) !== -1) {\n    browserName = Constants.browserName.edge;\n    fullVersion = nAgt.substring(verOffset + 4);\n    codeBaseType = Constants.codeBaseType.chrome;\n  } else if ((verOffset = nAgt.indexOf('chrome')) !== -1) { // In Chrome, the true version is after \"Chrome\"\n    browserName = Constants.browserName.chrome;\n    fullVersion = nAgt.substring(verOffset + 7);\n    codeBaseType = Constants.codeBaseType.chrome;\n  } else if ((verOffset = nAgt.indexOf('safari')) !== -1) { // In Safari, the true version is after \"Safari\" or after \"Version\"\n    browserName = Constants.browserName.safari;\n    fullVersion = nAgt.substring(verOffset + 7);\n    if ((verOffset = nAgt.indexOf(version)) !== -1) {\n      fullVersion = nAgt.substring(verOffset + 8);\n      if (fullVersion) {\n        let version = fullVersion.split(' ');\n        if (version && version.length > 0) {\n          fullVersion = version[0];\n        }\n      }\n    }\n    codeBaseType = Constants.codeBaseType.chrome;\n  } else if ((verOffset = nAgt.indexOf('firefox')) !== -1) { // In Firefox, the true version is after \"Firefox\"\n    browserName = Constants.browserName.firefox;\n    fullVersion = nAgt.substring(verOffset + 8);\n    codeBaseType = Constants.codeBaseType.firefox;\n  } else if ((verOffset = nAgt.indexOf('trident')) !== -1) { // IE 11 has no MSIE\n    browserName = Constants.browserName.msie;\n    verOffset = nAgt.indexOf('rv'); // In IE11, the true version is after \"rv\"\n    fullVersion = nAgt.substring(verOffset + 3, verOffset + 7);\n    codeBaseType = Constants.codeBaseType.chrome;\n  }\n\n  // system\n  // source: http://jsfiddle.net/ChristianL/AVyND/\n  let clientStrings = [\n    {s: 'Windows 3.11', r: /win16/},\n    {s: 'Windows 95', r: /(windows 95|win95|windows_95)/},\n    {s: 'Windows ME', r: /(win 9x 4.90|windows me)/},\n    {s: 'Windows 98', r: /(windows 98|win98)/},\n    {s: 'Windows CE', r: /windows ce/},\n    {s: 'Windows 2000', r: /(windows nt 5.0|windows 2000)/},\n    {s: 'Windows XP', r: /(windows nt 5.1|windows xp)/},\n    {s: 'Windows Server 2003', r: /windows nt 5.2/},\n    {s: 'Windows Vista', r: /windows nt 6.0/},\n    {s: 'Windows 7', r: /(windows 7|windows nt 6.1)/},\n    {s: 'Windows 8.1', r: /(windows 8.1|windows nt 6.3)/},\n    {s: 'Windows 8', r: /(windows 8|windows nt 6.2)/},\n    {s: 'Windows 10', r: /(windows 10|windows nt 10.0)/},\n    {s: 'Windows NT 4.0', r: /(windows nt 4.0|winnt4.0|winnt|windows nt)/},\n    {s: 'Windows ME', r: /windows me/},\n    {s: 'Android', r: /android/},\n    {s: 'Open BSD', r: /openbsd/},\n    {s: 'Sun OS', r: /sunos/},\n    {s: 'Linux', r: /(linux|x11)/},\n    {s: 'iOS', r: /(iphone|ipad|ipod)/},\n    {s: 'Mac OS X', r: /mac os x/},\n    {s: 'Mac OS', r: /(macppc|macintel|mac_powerpc|macintosh)/},\n    {s: 'QNX', r: /qnx/},\n    {s: 'UNIX', r: /unix/},\n    {s: 'BeOS', r: /beos/},\n    {s: 'OS/2', r: /os\\/2/},\n    {s: 'Search Bot', r: /(nuhk|googlebot|yammybot|openbot|slurp|msnbot|ask jeeves\\/teoma|ia_archiver)/},\n  ];\n\n  let id;\n  let cs;\n  for (id in clientStrings) {\n    if (!clientStrings.hasOwnProperty(id)) {\n      continue;\n    }\n    cs = clientStrings[id];\n    if (cs.r.test(nAgt)) {\n      osName = cs.s;\n      break;\n    }\n  }\n\n\n  if (osName && (/Windows/.test(osName))) {\n    osVersion = /Windows (.*)/.exec(osName)[1];\n    osName = Constants.osName.windows;\n  }\n\n  switch (osName) {\n    case Constants.osName.mac:\n      osVersion = /mac os x (1[\\.\\_\\d]+)/.exec(nAgt);\n      if (!osVersion) {\n        break;\n      }\n      osVersion = osVersion[1];\n      break;\n    case Constants.osName.android:\n      osVersion = /android ([\\.\\_\\d]+)/.exec(nAgt);\n      if (!osVersion) {\n        break;\n      }\n      osVersion = osVersion[1];\n      break;\n    case Constants.osName.ios:\n      if (!nVer) {\n        break;\n      }\n      osVersion = /os (\\d+)_(\\d+)_?(\\d+)?/.exec(nVer);\n      if (!osVersion) {\n        break;\n      }\n      osVersion = osVersion[1] + '.' + osVersion[2] + '.' + (osVersion[3] | 0);\n      break;\n  }\n\n  const splitWords = fullVersion.split(' ');\n  let browserVersion = fullVersion;\n  if (splitWords && splitWords.length > 0) {\n    browserVersion = splitWords[0];\n  }\n\n  return {\n    browserName: browserName,\n    browserVersion: browserVersion,\n    os: osName,\n    osVersion: osVersion,\n    codeBase: codeBaseType,\n    userAgent: userAgent,\n  };\n};\n","import {Constants} from './detectbrowser';\n\n\n/** Represents a adapter for the result of getStats*/\nclass StatsAdapter {\n  /**\n  * Create a StatsAdapter Component for parsing WebRTC getStats\n  * @param {Object} codeBase The codebase for the stats\n  * @param {Object} browser The browser for the stats\n  * @constructor\n  */\n  constructor(codeBase, browser) {\n    this.codeBase = codeBase;\n    this.browser = browser;\n  }\n\n  /**\n   * getIceCandidates - Obtains ice candidates from stats\n   *\n   * @param {Object} rawData - Raw data by browser on getstats call/promise.\n   *\n   * @return {Object} Ice candidate information\n   */\n  getIceCandidates(rawData) {\n    if (!rawData) {\n      return {localCandidates: [], remoteCandidates: [],\n        iceCandidatePairs: []};\n    }\n    let rawStats = this.extractRawStats(rawData);\n    let result = this.processRawStatsForIceInfo(rawStats);\n    return result;\n  }\n\n  /**\n   * extractRawStats - extracts the objects from raw stats\n   * @private\n   * @param {Object} rawStats raw stats from browser\n   *\n   * @return {Object[]} Array of Objects from raw stats\n   */\n  extractRawStats(rawStats) {\n    let results = [];\n    let key;\n\n    let firefox = Constants.codeBaseType.firefox;\n    let chrome = Constants.codeBaseType.chrome;\n    let safari = Constants.browserName.safari;\n    if (this.codeBase === firefox && this.browser !== safari) {\n      rawStats.forEach(function(item) {\n        results.push(item);\n      });\n    } else if (this.codeBase === chrome && this.browser !== safari) {\n      if (rawStats && rawStats.result) {\n        results = rawStats.result();\n      } else if (rawStats && rawStats.forEach) {\n        results = [];\n        rawStats.forEach(function(item) {\n          results.push(item);\n        });\n      }\n    } else {\n      for (key in rawStats) {\n        if (rawStats.hasOwnProperty(key)) {\n          results.push(rawStats[key]);\n        }\n      }\n    }\n    return results;\n  }\n\n  /**\n   * processRawStatsForIceInfo - process the raw stats to obtain ICE related information\n   *\n   * @param {Object} rawStats extracted raw stats\n   *\n   * @return {Object} Ice information\n   */\n  processRawStatsForIceInfo(rawStats) {\n    let localCandidates = [];\n    let remoteCandidates = [];\n    let candidatePairs = [];\n    let selectedCandidatePairId;\n\n    if (!rawStats) {\n      return {localCandidates: localCandidates, remoteCandidates: remoteCandidates,\n        iceCandidatePairs: candidatePairs};\n    }\n\n    for (let i = 0; i < rawStats.length; ++i) {\n      let parsedStats = this.getParsedStats(rawStats[i]);\n      let classifiedStats = this.statsClassifier(parsedStats);\n      if (classifiedStats.candidatePair) {\n        candidatePairs.push(classifiedStats.candidatePair);\n      } else if (classifiedStats.transportStats) {\n        if (classifiedStats.transportStats.type === 'transport') {\n          selectedCandidatePairId = classifiedStats.transportStats.selectedCandidatePairId;\n          continue;\n        }\n        candidatePairs.push(classifiedStats.transportStats);\n      } else if (classifiedStats.localCandidate) {\n        let cand = classifiedStats.localCandidate;\n        if (cand.candidateType == 'relay' || cand.candidateType == 'relayed') {\n          if (!cand.mozLocalTransport) {\n            // assume Chrome, get it from the priority\n            let relayType = cand.priority >> 24;\n            cand.mozLocalTransport = this.formatRelayType(relayType);\n          }\n          cand.mozLocalTransport = cand.mozLocalTransport.toLowerCase();\n        }\n        localCandidates.push(cand);\n      } else if (classifiedStats.remoteCandidate) {\n        remoteCandidates.push(classifiedStats.remoteCandidate);\n      }\n    }\n\n    if (selectedCandidatePairId) {\n      for (let i=0; i < candidatePairs.length; ++i) {\n        if (candidatePairs[i].id === selectedCandidatePairId) {\n          candidatePairs[i].googActiveConnection = 'true';\n        }\n      }\n    }\n\n    return {localCandidates: localCandidates, remoteCandidates: remoteCandidates,\n      iceCandidatePairs: candidatePairs};\n  }\n\n  /**\n   * getParsedStats - Parse the each raw stats object to dictionary\n   * @private\n   * @param {Object} rawStats raw stats object from browser\n   * @return {Object} parsed stats dictionary\n   */\n  getParsedStats(rawStats) {\n    let stats = {};\n    if (rawStats.timestamp instanceof Date) {\n      stats.timestamp = rawStats.timestamp.getTime().toString();\n    }\n\n    if (rawStats.type) {\n      stats.type = rawStats.type;\n    }\n\n    if (rawStats.names) {\n      let names = rawStats.names();\n      for (let i = 0; i < names.length; ++i) {\n        stats[names[i]] = rawStats.stat(names[i]);\n      }\n    } else {\n      Object.assign(stats, rawStats);\n    }\n\n    // for react-native, values is a array of objects each contains a single -\n    // stat value\n    if (stats.values) {\n      for (let i = 0; i < stats.values.length; i++) {\n        let values = stats.values[i];\n        Object.assign(stats, values);\n      }\n      delete stats.values;\n    }\n    return stats;\n  }\n\n  /**\n   * statsClassifier - classifies the parsed stats dictionary\n   * @private\n   * @param {Object} stats dictionary\n   * @return {Object} stats dictionary after on classification\n   */\n  statsClassifier(stats) {\n    let result = {};\n    let isType = (...expectedTypes) => {\n      for (let i = 0; i < expectedTypes.length; i++) {\n        let expectedType = expectedTypes[i];\n        if (stats.type === expectedType) {\n          return true;\n        }\n      }\n      return false;\n    };\n\n    let typeIsInbound = isType('inbound-rtp', 'inboundrtp');\n    let isRemote = (stats.isRemote === 'true' || stats.isRemote === true);\n    if (typeIsInbound || isType('outbound-rtp', 'outboundrtp')) {\n      result.tracks = {};\n      result.tracks.data = stats;\n      result.tracks.ssrc = stats.ssrc;\n      result.tracks.streamType = typeIsInbound ? 'inbound' : 'outbound';\n      result.tracks.reportType = 'local';\n      if (stats.isRemote !== undefined) {\n        result.tracks.reportType = isRemote ? 'remote' : 'local';\n      }\n    } else if (isType('candidatepair') && stats.selected) {\n      result.transportStats = stats;\n    } else if (isType('localcandidate', 'local-candidate')) {\n      result.localCandidate = stats;\n    } else if (isType('remotecandidate', 'remote-candidate')) {\n      result.remoteCandidate = stats;\n    } else if (isType('transport', 'googCandidatePair')) {\n      result.transportStats = stats;\n    } else if (isType('VideoBwe')) {\n      result.bwe = stats;\n    } else if (isType('track')) {\n      result.trackStats = stats;\n    } else if (isType('candidate-pair')) {\n      result.candidatePair = stats;\n    } else if (isType('codec')) {\n      result.codec = stats;\n    } else if (isType('ssrc')) {\n      result.tracks = {};\n      result.tracks.data = stats;\n      result.tracks.ssrc = stats.ssrc;\n      result.tracks.reportType = 'local';\n      result.tracks.streamType = (stats.bytesSent) ? 'outbound' : 'inbound';\n    }\n    return result;\n  }\n\n   /**\n    * formatRelayType - returns the formated realayType\n    *\n    * @param {Number} relayType\n    *\n    * @return {String} formated relayType string\n    */\n   formatRelayType(relayType) {\n    let ret = 'none';\n    switch (relayType) {\n      case 0:\n        ret = 'tls';\n        break;\n      case 1:\n        ret = 'tcp';\n        break;\n      case 2:\n        ret = 'udp';\n        break;\n    }\n    return ret;\n  }\n}\n\nexport {StatsAdapter};\n","import {Constants} from './detectbrowser';\nimport {StatsAdapter} from './statsadapter';\n\n/** Class that handles getStats */\nclass GetStatsHandler {\n  /**\n   * Creates an instance of GetStatsHandler.\n   * @param {Object} browserInfo\n   * @constructor\n   */\n  constructor(browserInfo) {\n    this.codeBase = browserInfo.codeBase;\n    this.browserName = browserInfo.browserName;\n\n    this.adapter = new StatsAdapter(this.codeBase, this.browserName);\n\n    this.isPromiseBased = true;\n  }\n\n  /**\n   * getIceCandidates - gets ice candiates information from getstats\n   * @param {Object} pc\n   * @public\n   * @return {Promise} promise resolves when the ice candiates are obtained from getstats\n   */\n  getIceCandidates(pc) {\n    let self = this;\n    return new Promise( function(resolve, reject) {\n      self.csioGetStats(self.iceCandidatesHandler.bind(self), pc, (candidatesObj) => {\n        resolve(candidatesObj);\n      });\n    });\n  }\n\n\n  /**\n   * iceCandidatesHandler - getstats callback handler for getting ice candidate information\n   * @param {Object} stats\n   * @param {Function} callback\n   * @private\n   */\n  iceCandidatesHandler(stats, callback) {\n    let candidatesObj = this.adapter.getIceCandidates(stats);\n    callback(candidatesObj);\n  }\n\n  /**\n   * Calls the broswer getStats promise or function\n   * @private\n   * @param {Function} statsHandler\n   * @param {Object} pc\n   * @param {Function} callback\n   *\n   */\n  csioGetStats(statsHandler, pc, callback) {\n    let firefox = Constants.codeBaseType.firefox;\n    let chrome = Constants.codeBaseType.chrome;\n    let edge = Constants.codeBaseType.edge;\n    let safari = Constants.browserName.safari;\n\n    if (!pc) {\n      return;\n    }\n\n    if (this.codeBase === firefox) {\n      this.getStatsFirefox(statsHandler, pc, callback);\n    } else if (this.browserName === safari) {\n      this.getStatsSafari(statsHandler, pc, callback);\n    } else if (this.codeBase === chrome) {\n      this.getStatsChrome(statsHandler, pc, callback);\n    } else if (this.codeBase === edge) {\n      this.getStatsEdge(statsHandler, pc, callback);\n    }\n  }\n\n  /**\n   * Calls the broswer getStats promise or function for firefox\n   * @private\n   * @memberof GetStatsHandler\n   * @param {Function} statsHandler\n   * @param {Object} pc\n   * @param {Function} callback\n   */\n  getStatsFirefox(statsHandler, pc, callback) {\n    let self = this;\n\n    if (!self.isPromiseBased) {\n      pc.getStats(null, (stats) => {\n        statsHandler(stats, callback);\n      }, () => {});\n      return;\n    }\n\n    try {\n      pc.getStats()\n      .then((stats) => {\n        statsHandler(stats, callback);\n      })\n      .catch(function(e) {\n        self.isPromiseBased = false;\n        pc.getStats(null, (stats)=>{\n          statsHandler(stats, callback);\n        }, () => {});\n      });\n    } catch (e) {\n      self.isPromiseBased = false;\n      pc.getStats(null, (stats) => {\n        statsHandler(stats, callback);\n      }, () => {});\n    }\n  }\n\n  /**\n   * Calls the broswer getStats promise or function for chrome\n   * @private\n   * @memberof GetStatsHandler\n   * @param {Function} statsHandler\n   * @param {Object} pc\n   * @param {Function} callback\n   */\n  getStatsChrome(statsHandler, pc, callback) {\n    let self = this;\n\n    if (window && window.csioReactNative) {\n      pc.getStats(null, (stats) => {\n        statsHandler(stats, callback);\n      },\n      function logError(e) {\n      });\n      return;\n    }\n\n    if (!self.isPromiseBased) {\n      pc.getStats((stats) => {\n        statsHandler(stats, callback);\n      });\n      return;\n    }\n\n    try {\n      pc.getStats()\n      .then((stats) => {\n        statsHandler(stats, callback);\n      })\n      .catch(function(e) {\n         // console.error('Error ', e);\n        self.isPromiseBased = false;\n        pc.getStats((stats) => {\n          statsHandler(stats, callback);\n        });\n      });\n    } catch (e) {\n      // todo @karthik can you please check whether it will be self.isPromiseBased or not ?\n      self.isPromiseBased = false;\n      pc.getStats((stats) => {\n        statsHandler(stats, callback);\n      });\n    }\n  }\n\n  /**\n   * Calls the broswer getStats for edge\n   * @private\n   * @memberof GetStatsHandler\n   * @param {Function} statsHandler\n   * @param {Object} pc\n   * @param {Function} callback\n   */\n  getStatsEdge(statsHandler, pc, callback) {\n    pc.getStats()\n    .then((stats) => {\n      statsHandler(stats, callback);\n    })\n    .catch(function(e) {\n    });\n  }\n\n  /**\n   * Calls the broswer getStats for safari\n   * @private\n   * @memberof GetStatsHandler\n   * @param {Function} statsHandler\n   * @param {Object} pc\n   * @param {Function} callback\n   */\n  getStatsSafari(statsHandler, pc, callback) {\n    pc.getStats()\n    .then((stats) => {\n       statsHandler(stats, callback);\n    })\n    .catch(function(e) {\n    });\n  }\n}\n\nexport {GetStatsHandler};\n","import {ParsedIceCandidate} from './utility/parsedIceCandidate';\nimport {GetStatsHandler} from './utility/stats/getstatshandler';\nimport {Constants} from './utility/stats/detectbrowser';\n\nconst ICE_CHECKING_TIMEOUT = 10000;\nconst CONNECTION_TIMEOUT = 30000;\n\nclass TurnConnection {\n  /**\n   * Create a new instance\n   * @param {Object} browserInfo\n   */\n  constructor(browserInfo) {\n    this.reset();\n\n    this.statshandler = new GetStatsHandler(browserInfo);\n  }\n\n  /**\n   * Reset the module\n   */\n  reset() {\n    this.disconnect();\n\n    this.iceServers = null;\n\n    this.pctpc1 = null;\n    this.pctpc2 = null;\n\n    this.sendChannel = null;\n\n    this.messageCallback = null;\n    this.errorCallback = null;\n\n    this.parsedIceResults = {};\n\n    this.resolveCb = null;\n    this.rejectCb = null;\n    this.localIpAddressInfo = [];\n    this.localIpAddresses = [];\n    this.localIp = null;\n    this.localIpType = null;\n    this.numberOfLocalIp = 0;\n  }\n\n  setMessageCallback(func) {\n    this.messageCallback = func;\n  }\n\n  setErrorCallback(func) {\n    this.errorCallback = func;\n  }\n\n  send(data) {\n    if (this.sendChannel && this.sendChannel.readyState === 'open') {\n      try {\n        this.sendChannel.send(data);\n      } catch (error) {\n        this.raiseSendError(new Error('Send channel Error'));\n      }\n    } else {\n      this.raiseSendError(new Error('No send channel'));\n    }\n  }\n\n  raiseSendError(error) {\n    if (this.errorCallback) {\n      this.errorCallback(error);\n    }\n    // console.error('sendChannel error:', error);\n  }\n\n  assignEvent(obj, ev, func) {\n    if (obj.addEventListener) {\n      obj.addEventListener(ev, func.bind(this), false);\n    } else if (obj.attachEvent) {\n      ev = 'on' + ev;\n      obj.attachEvent(ev, func.bind(this));\n    }\n  }\n\n  /**\n   * Start the TURN connection\n   * @param {JSON} iceServers\n   * @return {Promise} resolves when the datachannel is open\n   */\n  connect(iceServers) {\n    this.reset();\n\n    let promise = new Promise((resolve, reject) => {\n      this.resolveCb = resolve;\n      this.rejectCb = reject;\n    });\n\n    this.iceServers = iceServers;\n\n    let CSRTCPeerConnection = null;\n    try {\n      if (RTCPeerConnection) {\n        CSRTCPeerConnection = RTCPeerConnection;\n      } else if (webkitRTCPeerConnection) {\n        CSRTCPeerConnection = webkitRTCPeerConnection;\n      } else if (mozRTCPeerConnection) {\n        CSRTCPeerConnection = mozRTCPeerConnection;\n      } else if (window && window.RTCPeerConnection) {\n        CSRTCPeerConnection = window.RTCPeerConnection;\n      }\n\n      if (!CSRTCPeerConnection) {\n        let err = new Error('RTCPeerConnection not found');\n        err.continueFlag = false,\n        this.rejectCb(err);\n        return promise;\n      }\n    } catch (err) {\n        err.continueFlag = false,\n        this.rejectCb(err);\n        return promise;\n    }\n\n    // Settings\n    let datachannelLabel = 'precalltest';\n    let datachannelSettings = {\n      ordered: false,\n      maxRetransmits: 0,\n    };\n    let servers = {\n      'iceTransportPolicy': 'all',\n      'iceServers': this.iceServers,\n    };\n    // console.log('ICE servers:', servers);\n\n    // PeerConnection objects\n    try {\n      this.pctpc1 = new CSRTCPeerConnection(servers);\n      this.pctpc2 = new CSRTCPeerConnection(servers);\n    } catch (err) {\n      // console.error('Error creating PCs:', err);\n      this.rejectDisconnect(false, new Error('Error creating PCs'));\n      return promise;\n    }\n\n    // console.log('created pcs:', this.pctpc1, this.pctpc2);\n\n    // make sure the connection gets closed at some point\n    this.connectionTimer = setTimeout(() => {\n      // console.error('Connection timeout');\n      delete this.connectionTimer;\n      this.rejectDisconnect(false, new Error('Connection timeout'));\n    }, CONNECTION_TIMEOUT);\n\n    try {\n      // Datachannel as only source\n      this.sendChannel = this.pctpc1.createDataChannel(datachannelLabel, datachannelSettings);\n       // console.log('created datachannel');\n      this.sendChannel.binaryType = 'arraybuffer';\n      this.assignEvent(this.sendChannel, 'error', (error) => {\n        // console.error('Datachannel error:', error);\n        this.raiseSendError(new Error('Datachannel error'));\n        this.rejectDisconnect(true, new Error('Datachannel error'));\n      });\n       // console.log('add onerror event');\n      this.assignEvent(this.pctpc2, 'datachannel', (event) => {\n        let channel = event.channel;\n        this.assignEvent(channel, 'open', (event) => {\n          if (this.resolveCb) {\n            this.resolveCb();\n            this.resolveCb = null;\n          }\n        });\n        this.assignEvent(channel, 'close', (event) => {\n          if (this && this.disconnect) {\n            // console.log('datachannel close');\n            this.disconnect();\n          }\n        });\n        this.assignEvent(channel, 'message', (event) => {\n          if (this.messageCallback) {\n            this.messageCallback(event.data);\n          }\n        });\n        this.assignEvent(channel, 'error', (error) => {\n          if (this.errorCallback) {\n            this.errorCallback(error);\n          }\n          // console.error('receiveChannel error:', error);\n          this.rejectDisconnect(true, new Error('receiveChannel error'));\n        });\n      });\n    } catch (err) {\n      // console.error('Error adding datachannel:', err);\n      this.rejectDisconnect(false, new Error('Error adding datachannel'));\n      return promise;\n    }\n\n    try {\n      // Set callbacks for connection procedure\n      this.assignEvent(this.pctpc1, 'icecandidate', (e) => {\n        this.onIceCandidate(this.pctpc1, e);\n      });\n      this.assignEvent(this.pctpc1, 'iceconnectionstatechange', (e) => {\n        this.onIceStateChange(this.pctpc1, e);\n      });\n\n      this.assignEvent(this.pctpc2, 'icecandidate', (e) => {\n        this.onIceCandidate(this.pctpc2, e);\n      });\n      this.assignEvent(this.pctpc2, 'iceconnectionstatechange', (e) => {\n        this.onIceStateChange(this.pctpc2, e);\n      });\n\n      // Start connection procedure\n      // console.log('pctpc1 createOffer start');\n      this.pctpc1.createOffer()\n      .then(\n        (desc, test) => {\n          this.onCreateOfferSuccess(desc);\n        },\n        (e) => {\n          this.onCreateOfferError(this.pctpc1, e);\n        }\n      );\n    } catch (err) {\n      // console.error('Error starting connection:', err);\n      this.rejectDisconnect(false, new Error('Error starting connection'));\n      return promise;\n    }\n\n    return promise;\n  }\n\n  /**\n   * Reject and disconnect\n   * @param {Boolean} continueFlag indicate if it should be tried again\n   * @param {Error} err the occured error\n   */\n  rejectDisconnect(continueFlag, err) {\n    this.disconnect();\n    if (this.rejectCb) {\n      // console.log('rejectDisconnect');\n      err.continueFlag = continueFlag;\n      this.rejectCb(err);\n    }\n\n    this.resolveCb = null;\n    this.rejectCb = null;\n  }\n\n  /**\n   * Stop the precall tests\n   */\n  disconnect() {\n    // console.log('disconnect');\n    clearTimeout(this.connectionTimer);\n    clearTimeout(this.iceTimer);\n    if (this.sendChannel) {\n      try {\n        this.sendChannel.close();\n      } catch (err) {\n        // console.error(err);\n      }\n    }\n\n    if (this.pctpc1) {\n      try {\n        this.pctpc1.close();\n      } catch (err) {\n        // console.error(err);\n      }\n    }\n    this.pctpc1 = null;\n\n    if (this.pctpc2) {\n      try {\n        this.pctpc2.close();\n      } catch (err) {\n        // console.error(err);\n      }\n    }\n    this.pctpc2 = null;\n  }\n\n  /*\n   * PRIVATE: Methods for connection procedure\n   */\n  getName(pc) {\n    return (pc === this.pctpc1) ? 'pctpc1' : 'pctpc2';\n  }\n\n  getOtherPc(pc) {\n    return (pc === this.pctpc1) ? this.pctpc2 : this.pctpc1;\n  }\n\n  onCreateOfferError(pc, error) {\n    // console.error('Failed to create offer: ' + error.toString());\n    this.rejectDisconnect(false, new Error('Failed to create offer'));\n  }\n\n  onCreateAnswerError(pc, error) {\n    // console.error('Failed to create answer: ' + error.toString());\n    this.rejectDisconnect(false, new Error('Failed to create answer'));\n  }\n\n  onCreateOfferSuccess(desc) {\n    try {\n      // console.log('Offer from pctpc1, pctpc1 setLocalDescription start', this.pctpc1);\n      this.pctpc1.setLocalDescription(desc).then(\n        () => {\n          this.onSetLocalSuccess(this.pctpc1);\n        },\n        (e) => {\n          this.onSetSessionDescriptionError(this.pctpc1, e);\n        }\n      );\n       // console.log('pctpc2 setRemoteDescription start');\n      this.pctpc2.setRemoteDescription(desc).then(\n        () => {\n          this.onSetRemoteSuccess(this.pctpc2);\n        },\n        (e) => {\n          this.onSetRemoteSessionDescriptionError(this.pctpc2, e);\n        }\n      );\n      // console.log('pctpc2 createAnswer start');\n      // Since the 'remote' side has no media stream we need\n      // to pass in the right constraints in order for it to\n      // accept the incoming offer of audio and video.\n      this.pctpc2.createAnswer().then(\n        (desc) => {\n          this.onCreateAnswerSuccess(desc);\n        },\n        (e) => {\n          this.onCreateAnswerError(this.pctpc2, e);\n        }\n      );\n    } catch (err) {\n      // console.error('Error processing offer:', err);\n      this.rejectDisconnect(false, new Error('Error processing offer'));\n    }\n  }\n\n  onSetLocalSuccess(pc) {\n     (this.getName(pc) + ' setLocalDescription complete');\n  }\n\n  onSetRemoteSuccess(pc) {\n     (this.getName(pc) + ' setRemoteDescription complete');\n  }\n\n  onSetSessionDescriptionError(pc, error) {\n    // console.error('Failed to set session description: ' + error.toString());\n    this.rejectDisconnect(false, new Error('Failed to set session description'));\n  }\n\n  onSetRemoteSessionDescriptionError(pc, error) {\n    // console.error('Failed to set session description: ' + error.toString());\n    this.rejectDisconnect(false, new Error('Failed to set session description'));\n  }\n\n  onCreateAnswerSuccess(desc) {\n    try {\n      // console.log('Answer from pctpc2, pctpc2 setLocalDescription start');\n      this.pctpc2.setLocalDescription(desc).then(\n        () => {\n          this.onSetLocalSuccess(this.pctpc2);\n        },\n        (e) => {\n          this.onSetSessionDescriptionError(this.pctpc2, e);\n        }\n      );\n      // console.log('pctpc1 setRemoteDescription start');\n      this.pctpc1.setRemoteDescription(desc).then(\n        () => {\n          this.onSetRemoteSuccess(this.pctpc1);\n        },\n        (e) => {\n          this.onSetRemoteSessionDescriptionError(this.pctpc1, e);\n        }\n      );\n    } catch (err) {\n      // console.error('Error processing answer:', err);\n      this.rejectDisconnect(false, new Error('Error processing answer'));\n    }\n  }\n\n  onIceCandidate(pc, event) {\n    try {\n      // null - indicates iceGatheringState is complete\n      if (!event.candidate) {\n        return;\n      }\n      // end-of-candidates -  indicates end of generation of candidates\n      // https://github.com/w3c/webrtc-pc/issues/1952#issuecomment-416645360\n      if (!event.candidate.candidate) {\n        return;\n      }\n\n      // only add relay candidates\n      let parsed = new ParsedIceCandidate(event.candidate);\n\n      if (pc == this.pctpc1) {\n        // console.log('candidate:', parsed.getType(), parsed);\n\n        if (this.statshandler.codeBase == Constants.codeBaseType.chrome) {\n          // check seen candidates for Chrome (doesn't work reliably with getStats)\n          if (parsed.isRelay()) {\n            if (parsed.isTypeTransportUdp()) {\n              this.parsedIceResults.relayUdpGathered = true;\n            }\n            if (parsed.isTypeTransportTcp()) {\n              this.parsedIceResults.relayTcpGathered = true;\n            }\n            if (parsed.isTypeTransportTls()) {\n              this.parsedIceResults.relayTlsGathered = true;\n            }\n          }\n\n          if (parsed.isServerReflexive()) {\n            this.parsedIceResults.srflxGathered = true;\n          }\n        }\n      }\n\n      if (!parsed.isRelay()) {\n        if (!this.localIpAddresses.includes(parsed.getIpAddress())) {\n          this.localIpAddresses.push(parsed.getIpAddress());\n          this.localIpAddressInfo.push({\n            ip: parsed.getIpAddress(),\n            candidateType: parsed.getType(),\n            networkType: 'unknown',\n          });\n          if (parsed.isPublicIp()) {\n            this.numberOfLocalIp++;\n          }\n        }\n        if (parsed.isPublicIp() && this.localIp === null) {\n          this.localIp = parsed.getIpAddress();\n          this.localIpType = parsed.getType();\n        }\n        return;\n      }\n\n      this.getOtherPc(pc).addIceCandidate(event.candidate)\n      .then(\n        () => {\n          this.onAddIceCandidateSuccess(pc);\n        },\n        (err) => {\n          this.onAddIceCandidateError(pc, err, parsed.isRelay());\n        }\n      );\n    } catch (err) {\n      // console.error('Error processing ICE candidate:', err);\n      this.rejectDisconnect(false, err);\n    }\n  }\n\n  onAddIceCandidateSuccess(pc) {\n     (this.getName(pc) + ' addIceCandidate success');\n  }\n\n  onAddIceCandidateError(pc, error, isRelay) {\n    // console.error(this.getName(pc) + ' failed to add ICE Candidate: ' + error.toString());\n    if (isRelay) {\n      this.rejectDisconnect(false, new Error('failed to add ICE Candidate'));\n    }\n  }\n\n  onIceStateChange(pc, event) {\n    try {\n      let newstate = '(?)';\n      if (pc) {\n        newstate = pc.iceConnectionState;\n      }\n      if (newstate === 'failed') {\n        // console.error('ICE failure');\n        this.rejectDisconnect(true, new Error('ICE failure'));\n      }\n\n      // timeout, since chrome seems to be stuck in checking\n      if (newstate === 'checking' && !this.iceTimer) {\n        this.iceTimer = setTimeout(() => {\n          delete this.iceTimer;\n          // console.error('ICE timeout');\n          this.rejectDisconnect(true, new Error('ICE timeout'));\n        }, ICE_CHECKING_TIMEOUT);\n      }\n      if (newstate === 'completed' || newstate === 'connected') {\n        clearTimeout(this.iceTimer);\n        delete this.iceTimer;\n      }\n\n      // console.warn('ICE state change:', newstate);\n    } catch (err) {\n      // console.error('Error processing ICE state change:', err);\n      this.rejectDisconnect(false, new Error('Error processing ICE state change'));\n    }\n  }\n\n  getIceResults() {\n    return new Promise((resolve, reject) => {\n      let iceServers = JSON.parse(JSON.stringify(this.iceServers)); // deepcopy, needed for react native\n      for (let i = 0; i < iceServers.length; i++) {\n        let server = iceServers[i];\n        if (!iceServers.hasOwnProperty(server)) {\n          delete server.credential;\n        }\n      };\n\n      let iceResults = {\n        turnIpAddress: '',\n        turnIpVersion: '',\n        turnTransport: '',\n        iceServers: iceServers,\n        ipv6Supported: false,\n        ipv4Supported: false,\n        relayTlsGathered: false,\n        relayTcpGathered: false,\n        relayUdpGathered: false,\n        srflxGathered: false,\n        relayTlsSuccess: false,\n        relayTcpSuccess: false,\n        relayUdpSuccess: false,\n        srflxSuccess: false,\n        localIpAddressInfo: [],\n        localIP: '',\n        numberOfLocalIPs: 0,\n        localIPType: '',\n        localIPNetworkType: '',\n      };\n\n      // merge results from parsed ICE candidates (to get Chrome's seen candidates)\n      for (let entry in this.parsedIceResults) {\n        if (this.parsedIceResults.hasOwnProperty(entry)) {\n          iceResults[entry] = this.parsedIceResults[entry];\n        }\n      }\n\n      // get stats\n      if (!this.pctpc1) {\n        reject(new Error('PC not available for stats'));\n        return;\n      }\n      this.statshandler.getIceCandidates(this.pctpc1).then((results) => {\n         // console.log('ICE results:', results);\n        iceResults.localIP = this.localIp;\n        iceResults.localIPType = this.localIpType;\n        iceResults.numberOfLocalIPs = this.numberOfLocalIp;\n        for (let j = 0; j < this.localIpAddressInfo.length; j++) {\n          let ipInfo = this.localIpAddressInfo[j];\n          for (let i = 0; i < results.localCandidates.length; i++) {\n            let candidate = results.localCandidates[i];\n            let ip = null;\n            if (candidate.ip) {\n              ip = candidate.ip;\n            } else if (candidate.address) {\n              ip = candidate.address;\n            } else {\n              ip = candidate.ipAddress;\n            }\n            if (ip === ipInfo.ip && candidate.networkType !== 'unknown') {\n              ipInfo.networkType = candidate.networkType;\n            }\n          }\n          iceResults.localIpAddressInfo.push(ipInfo);\n        }\n\n        let foundActiveCand = false;\n        for (let i = 0; i < results.iceCandidatePairs.length; i++) {\n          let pair = results.iceCandidatePairs[i];\n          const googActiveConnection = typeof pair.googActiveConnection === 'string' ?\n              pair.googActiveConnection === 'true' : pair.googActiveConnection;\n          const selected = typeof pair.selected === 'string' ?\n              pair.selected === 'true' : pair.selected;\n          if (googActiveConnection || selected) {\n            for (let i = 0; i < results.localCandidates.length; i++) {\n              let cand = results.localCandidates[i];\n              // figure out IP address\n              let ip = null;\n              if (cand.ip) {\n                ip = cand.ip;\n              } else if (cand.address) {\n                ip = cand.address;\n              } else {\n                ip = cand.ipAddress;\n              }\n\n              // fill infos for active pair\n              if (cand.id == pair.localCandidateId) {\n                 // console.log('Active candidate local transport:', cand);\n\n                iceResults.turnIpAddress = ip;\n                iceResults.turnNetworkType = cand.networkType;\n                iceResults.localIPNetworkType = cand.networkType;\n                let ipv6 = ip.indexOf(':') !== -1;\n                iceResults.turnIpVersion = ipv6?'ipv6':'ipv4';\n\n                iceResults.turnTransport = cand.mozLocalTransport;\n\n                foundActiveCand = true;\n              }\n              /* For Chrome, the active candidate sometimes is not in 'succeeded' state,\n                  so it would not trigger the normal relay*Succeeded setting below ..\n              */\n              if (cand.candidateType === 'relay' || cand.candidateType === 'relayed') {\n                if (cand.mozLocalTransport === 'udp') {\n                  iceResults.relayUdpSuccess = true;\n                }\n                if (cand.mozLocalTransport === 'tcp') {\n                  iceResults.relayTcpSuccess = true;\n                }\n                if (cand.mozLocalTransport === 'tls') {\n                  iceResults.relayTlsSuccess = true;\n                }\n              }\n\n              if (!ip) {\n                continue;\n              }\n              // IPv6 candidate seen?\n              if (ip.indexOf(':') !== -1) {\n                iceResults.ipv6Supported = true;\n              } else {\n                iceResults.ipv4Supported = true;\n              }\n            }\n          }\n        }\n\n        // NOTE candidate and pair checking is unreliable for getStats (e.g. chrome doesnt necessarily generate stats for all candidates)\n\n        // check for existing candidates\n        for (let i = 0; i < results.localCandidates.length; i++) {\n          let cand = results.localCandidates[i];\n          if (cand.candidateType === 'relay' || cand.candidateType === 'relayed') {\n            if (cand.mozLocalTransport === 'udp') {\n              iceResults.relayUdpGathered = true;\n            }\n            if (cand.mozLocalTransport === 'tcp') {\n              iceResults.relayTcpGathered = true;\n            }\n            if (cand.mozLocalTransport === 'tls') {\n              iceResults.relayTlsGathered = true;\n            }\n          }\n\n          if (cand.candidateType === 'srflx' || cand.candidateType === 'serverreflexive') {\n            iceResults.srflxGathered = true;\n          }\n        }\n\n        // check for successful pairs\n        for (let i = 0; i < results.iceCandidatePairs.length; i++) {\n          let pair = results.iceCandidatePairs[i];\n          if (pair.state === 'succeeded') {\n            for (let i = 0; i < results.localCandidates.length; i++) {\n              let cand = results.localCandidates[i];\n              if (cand.id == pair.localCandidateId) {\n                if (cand.candidateType === 'relay' || cand.candidateType === 'relayed') {\n                  if (cand.mozLocalTransport === 'udp') {\n                    iceResults.relayUdpSuccess = true;\n                  }\n                  if (cand.mozLocalTransport === 'tcp') {\n                    iceResults.relayTcpSuccess = true;\n                  }\n                  if (cand.mozLocalTransport === 'tls') {\n                    iceResults.relayTlsSuccess = true;\n                  }\n                }\n\n                if (cand.candidateType === 'srflx' || cand.candidateType === 'serverreflexive') {\n                  iceResults.srflxSuccess = true;\n                }\n              }\n            }\n          }\n        }\n\n        if (!foundActiveCand) {\n          // console.error('Active ICE candidate pair not found.');\n        }\n        resolve(iceResults);\n      },\n      (e) => {\n        reject(e);\n      });\n    },\n    (e) => {\n      reject(e);\n    });\n  }\n}\n\nexport {TurnConnection};\n","/** @module Timestamps */\n\n/** Return the current timestamp with millisecond accuracy if available\n * @return {Number} The timestamp\n * @public */\nexport function getCurrent() {\n  if (!window || !window.performance || !window.performance.now) {\n    return Date.now();\n  }\n  if (!window.performance.timing || !window.performance.timing.navigationStart) {\n    return Date.now();\n  }\n  return window.performance.now() + window.performance.timing.navigationStart;\n}\n","/** A base class for tests that need the TURN server */\nclass TurnTest {\n  /** Create a new instance (normally with super())\n   * @param {TurnConnection} connection the connection to the TURN server\n   */\n  constructor(connection) {\n    this.connection = connection;\n    this.active = false;\n\n    this.results = {};\n  }\n\n  /*\n   * Public functions\n   */\n\n  /** Returns the obtained results from the test\n   * @return {Object} the results\n   * @public\n   */\n  getResults() {\n    return this.results;\n  }\n\n  /** Start the tests\n   * @return {Promise} resolve when test is completed successfully\n   * @public\n   */\n  start() {\n    let promise = new Promise((resolve, reject) => {\n      this.resolveCb = resolve;\n      this.rejectCb = reject;\n    });\n\n    this.connection.setMessageCallback(this.handleMessage.bind(this));\n    this.connection.setErrorCallback(this.handleError.bind(this));\n\n    this.active = true;\n    this.forceStopped = false;\n    this.initiate();\n\n    return promise;\n  }\n\n  /** Stop the test\n   * @protected */\n  stop() {\n    this.active = false;\n  }\n\n  /** Force the test to stop\n   * @public\n   */\n  forceStop() {\n    this.forceStopped = true;\n    this.stop();\n    this.finished();\n  }\n\n  /** Returns if this test is currently running\n   * @return {Boolean} active or not\n   * @public\n   */\n  isActive() {\n    return this.active;\n  }\n\n  /*\n   * Override functions\n   */\n\n  /** Initiate the test sequence\n   * @protected\n   */\n  initiate() {\n    // console.error('initiate not implemented');\n  }\n\n  /** Handle the response for a sent msg\n   * @param {String} msg The received message\n   * @protected\n   */\n  handleMessage(msg) {\n    // console.error('handleMessage not implemented');\n  }\n\n  /** Handle an error occuring on the connection's datachannel\n   * @param {Error} error The received message\n   * @protected\n   */\n  handleError(error) {\n    // console.error('handleError not implemented');\n  }\n\n  /*\n   * Protected functions\n   */\n\n  /** Send data through the connection\n   * @param {String} msg The message to send\n   * @protected\n   */\n  send(msg) {\n    this.connection.send(msg);\n  }\n\n  /** The test finished successful.\n   * WARNING finished() or failed() HAS to be called by the inherited class\n   * @protected\n   */\n  finished() {\n    this.active = false;\n    if (this.resolveCb) {\n      this.resolveCb();\n      this.resolveCb = null;\n    }\n  }\n\n  /** The test failed.\n   * WARNING finished() or failed() HAS to be called by the inherited class\n   * @param {Error} error The error that was raised\n   * @protected\n   */\n  failed(error) {\n    this.active = false;\n    if (this.rejectCb) {\n      this.rejectCb(error);\n      this.rejectCb = null;\n    }\n  }\n}\n\nexport {TurnTest};\n","import * as Timestamps from '../utility/timestamps';\n/* eslint require-jsdoc: 0 */\n\nimport {TurnTest} from './turnTest';\n\nconst RTTSAMPLES = 10;\nconst TIMEOUT = 100; // ms\nconst LAST_TIMEOUT = 500; // ms\n\nclass RttTest extends TurnTest {\n  constructor(connection) {\n    super(connection);\n\n    this.sendTimer = null;\n    this.countSent = 0;\n    this.rtts = [];\n  }\n\n  /*\n   * Override functions\n   */\n  initiate() {\n    this.results.startTimestamp = Timestamps.getCurrent();\n    this.sendPing();\n  }\n\n  handleMessage(msg) {\n    if (!this.isActive()) {\n      return;\n    }\n\n    let sentTs = parseInt(msg, 10);\n    let rtt = this.calculateRtt(sentTs); // ms\n\n    this.rtts.push(rtt);\n    if (this.countSent < RTTSAMPLES) {\n      this.sendPing();\n      return;\n    }\n\n    // enough samples arrived\n    this.calculateMetrics();\n  }\n\n  handleError(error) {\n    this.fillResults();\n\n    this.failed(error);\n  }\n\n  /*\n   * Private functions\n   */\n  sendPing() {\n    if (!this.isActive()) {\n      return;\n    }\n\n    let now = Timestamps.getCurrent(); // ms\n    this.send(now.toString());\n    this.countSent += 1;\n\n    // cancel timer\n    if (this.sendTimer) {\n      clearTimeout(this.sendTimer);\n      this.sendTimer = null;\n    }\n    // setup timer\n    if (this.countSent < RTTSAMPLES) {\n      this.sendTimer = setTimeout(this.sendPing.bind(this), TIMEOUT);\n      return;\n    }\n    this.sendTimer = setTimeout(this.calculateMetrics.bind(this), LAST_TIMEOUT);\n  }\n\n  calculateRtt(sentTs) {\n    let now = Timestamps.getCurrent();\n    return now - sentTs;\n  }\n\n  calculateMetrics() {\n    if (this.sendTimer) {\n      clearTimeout(this.sendTimer);\n      this.sendTimer = null;\n    }\n\n    this.fillResults();\n\n    this.finished();\n  }\n\n  fillResults() {\n    this.results.sentMessages = this.countSent;\n    this.results.unAckedMessages = this.countSent - this.rtts.length;\n    this.results.maxMessages = RTTSAMPLES;\n    this.results.forceStopped = this.forceStopped;\n\n    this.results.median = this.median();\n    this.results.average = this.average();\n\n    /* use standard deviation instead of variance\n    when calculating jitter\n    ToDo: clean up the code so that key 'variance'\n    is not used instead of std  */\n    this.results.variance = this.std();\n\n    this.results.endTimestamp = Timestamps.getCurrent();\n  }\n\n  median() {\n    if (this.rtts.length == 0) {\n      return LAST_TIMEOUT;\n    }\n\n    // the middle entry of the sorted list\n    this.rtts.sort();\n    let half = Math.floor(this.rtts.length/2);\n    return this.rtts[half];\n  }\n\n  average() {\n    if (this.rtts.length == 0) {\n      return LAST_TIMEOUT;\n    }\n\n    let sum = 0;\n    for (let i = 0; i < this.rtts.length; i++ ) {\n      sum += this.rtts[i];\n    }\n    return sum / this.rtts.length;\n  }\n\n  variance() {\n    if (this.rtts.length == 0) {\n      return LAST_TIMEOUT;\n    }\n\n    let variance = 0;\n    let average = this.average();\n    for (let i = 0; i < this.rtts.length; i++) {\n      let rtt = this.rtts[i];\n      variance += Math.pow(rtt - average, 2);\n    }\n    variance /= this.rtts.length;\n    return variance;\n  }\n\n  std() {\n    let variance = this.variance();\n    if (variance <= 0) {\n      return 0;\n    }\n    let std = Math.sqrt(variance);\n    return std;\n  }\n\n  stop() {\n    if (!this.isActive()) {\n      return;\n    }\n    super.stop();\n    this.fillResults();\n  }\n}\n\nexport {RttTest};\n","import * as Timestamps from '../utility/timestamps';\n\n\n/** Create a random string\n * @param {Integer} length The length of the string\n * @return {String} The string of a certain length\n */\nfunction randomAsciiString(length) {\n  let result = '';\n  for (let i = 0; i < length; i++) {\n    // Visible ASCII chars are between 35 and 93.\n    result += String.fromCharCode(35 + Math.random() * (93-35));\n  }\n  return result;\n}\n\n/** Class produces strings of a certain length that contain a timestamp.\n * Due to the timestamp, the message is always unique, although the padding is constant.\n * The random padding ensures that the effect of compression in the network is mitigated.\n * Since the timestamp should be kept in float, the size of the message might vary by a few bytes. */\nclass MessageMaker {\n  /** Create a new object\n   * @param {Integer} size The total size of the message\n   */\n  constructor(size = 1200) {\n    this.message = {timestamp: '', sentBytes: 10000, padding: ''};\n\n    const TIMESTAMP_BYTES = Timestamps.getCurrent().toString().length;\n    const MESSAGE_BYTES = JSON.stringify(this.message).length;\n    const PADDING = randomAsciiString(size - TIMESTAMP_BYTES - MESSAGE_BYTES);\n\n    // NOTE somehow this creates slightly too big messages?\n    this.message.padding = PADDING;\n  }\n\n  /** Make a new message\n   * @param {Number} sentBytes the amount of bytes sent so far\n   * @return {String} The message\n   * @public\n   */\n  make(sentBytes) {\n    this.message.timestamp = Timestamps.getCurrent();\n    this.message.sentBytes = sentBytes;\n    return JSON.stringify(this.message);\n  }\n}\n\nexport {MessageMaker, randomAsciiString};\n","import * as Timestamps from '../utility/timestamps';\nimport {MessageMaker} from '../utility/messageMaker';\n/* eslint require-jsdoc: 0 */\n\nimport {TurnTest} from './turnTest';\n\nclass ThroughputTest extends TurnTest {\n  constructor(connection, rtt, loss) {\n    super(connection);\n\n    this.sentBytes = 0;\n    this.receivedBytes = 0;\n    this.secondHalfBytes = 0;\n    this.secondHalfStart = null;\n    this.bufferEmpty = 1;\n\n    this.chunkSize = 1200;\n    this.messageMaker = new MessageMaker(this.chunkSize);\n\n    this.duration = 5000; // ms\n    if (rtt != null) {\n      // duration is dependent on RTT, upper bound 10 s, lower bound 1 s\n      // it seems 50 RTTs is needed for reliable testing\n      let duration = 50 * rtt;\n      this.duration = Math.max(Math.min(duration, 10*1000), 1*1000);\n    }\n    this.sendTimer = null;\n\n    this.intervals = [];\n    this.intervalStart = 0;\n    this.intervalLength = 100; // ms\n    this.intervalBytes = 0;\n    this.loss = loss;\n    this.lastReceivedTimestamp = 0;\n  }\n\n  /*\n   * Override functions\n   */\n  initiate() {\n    if (window && window.csioReactNative) {\n      /* NOTE react-native does not support RTCDataChannel.bufferedAmount, so it\n          is stuck in a loop when putting data to the buffer.\n          Also, when it is ever supported, there is no removeEventListener which has be taken care of */\n      let errMsg = 'Not running throughput test for react-native';\n      // console.error(errMsg);\n      this.handleError(new Error(errMsg));\n      return;\n    }\n    // console.log('start', this.duration);\n    this.startSend();\n  }\n\n  handleMessage(msg) {\n    if (!this.isActive()) {\n      return;\n    }\n\n    // save last received message for loss calculations\n    this.lastMessage = msg;\n\n    // count the total received bytes\n    this.receivedBytes += msg.length;\n\n    // record start time, and set timer to stop\n    let now = Timestamps.getCurrent();\n    this.lastReceivedTimestamp = now;\n    if (!this.sendTimer) {\n      this.results.startTimestamp = now;\n      this.sendTimer = setTimeout(() => {\n        this.stop();\n        this.finished();\n      }, this.duration);\n    }\n\n    // calculate intervals\n    if (this.intervalStart == 0) {\n      this.intervalStart = now;\n    }\n    this.intervalBytes += msg.length;\n    if (now - this.intervalStart >= this.intervalLength) {\n      // average throughput\n      let intervalDuration = now - this.intervalStart; // ms\n      let intervalAvg = this.averageThroughput(this.intervalBytes, intervalDuration);\n\n      // RTT\n      let rtt = null;\n      try {\n        let msgJson = JSON.parse(this.lastMessage);\n        rtt = now - msgJson.timestamp;\n      } catch (e) {\n        // console.error('Error parsing msg:', msg, e);\n      }\n\n      // add and reset\n      this.intervals.push({\n        'startTimestamp': this.intervalStart,\n        'endTimestamp': now,\n        'bytesReceived': this.intervalBytes,\n        'average': intervalAvg,\n        'rtt': rtt,\n      });\n\n      this.intervalStart = now;\n      this.intervalBytes = 0;\n    }\n\n    // calculation for second half of the connection\n    if (this.results.startTimestamp && now - this.results.startTimestamp > this.duration/2) {\n      if (!this.secondHalfStart) {\n        this.secondHalfStart = now;\n      }\n      this.secondHalfBytes += msg.length;\n    }\n  }\n\n  handleError(error) {\n    this.stop();\n\n    this.failed(error);\n  }\n\n  /*\n   * Private functions\n   */\n  averageThroughput(bytes, milliseconds) {\n    if (milliseconds === 0) {\n      return 0;\n    }\n    let seconds = milliseconds/1000.0;\n    let avg = ((bytes / seconds) * 8.0 ) / 1024.0; // kbps\n    return avg;\n  }\n\n   // Listen for one bufferedamountlow event.\n  bufferListener() {\n    this.sendChannel.removeEventListener('bufferedamountlow', this.bufferListener.bind(this));\n    this.fillBuffer();\n  }\n\n  fillBuffer() {\n    // NOTE bufferedAmount might be 0 when the event is processed too late\n    if (this.sendChannel.bufferedAmount == 0) {\n      this.bufferEmpty += 1;\n    }\n\n    while (this.isActive()) {\n      if (this.sentBytes > 1000000) {\n        break;\n      }\n      if (this.sendChannel.bufferedAmount > this.bufferFullThreshold) {\n        if (this.usePolling) {\n          setTimeout(this.fillBuffer.bind(this), 250); // max rate: 11Mbps <= (300 * 1200 Bytes) / 0.25 s\n        } else {\n          this.sendChannel.addEventListener('bufferedamountlow', this.bufferListener.bind(this));\n        }\n        return;\n      }\n      let message = this.messageMaker.make(this.sentBytes);\n      this.sentBytes += message.length;\n      this.send(message);\n    }\n    this.sendChannel.removeEventListener('bufferedamountlow', this.bufferListener.bind(this));\n  }\n\n  startSend() {\n    if (!this.isActive()) {\n      return;\n    }\n\n    // the amount of data to be buffered\n    this.bufferFullThreshold = 1000 * this.chunkSize;\n    this.sendChannel = this.connection.sendChannel;\n    this.usePolling = true;\n    if (typeof this.sendChannel.bufferedAmountLowThreshold === 'number') {\n       // console.log('Using the bufferedamountlow event for flow control');\n      this.usePolling = false;\n\n      this.sendChannel.bufferedAmountLowThreshold = this.bufferFullThreshold/10;\n    }\n    setTimeout(this.fillBuffer.bind(this), 0);\n  }\n\n  fillResults() {\n    this.results.endTimestamp = this.lastReceivedTimestamp;\n    this.results.maxDuration = this.duration;\n    this.results.forceStopped = this.forceStopped;\n    this.results.bufferEmpty = this.bufferEmpty;\n    this.results.intervals = this.intervals;\n\n    this.results.bytesPrepared = this.sentBytes;\n    this.results.bytesReceived = this.receivedBytes;\n\n    if (!this.results.startTimestamp) {\n      this.results.startTimestamp = this.results.endTimestamp;\n    }\n    // calculate average throughput\n    let duration = 0;\n    let average = 0;\n    if (this.secondHalfStart) {\n      duration = this.results.endTimestamp - this.secondHalfStart; // ms\n      average = this.averageThroughput(this.secondHalfBytes, duration);\n    }\n    // fallback if there is no data for second half\n    let allDuration = this.results.endTimestamp - this.results.startTimestamp; // ms\n    let allAverage = this.averageThroughput(this.receivedBytes, allDuration);\n    if (allAverage > average) {\n      average = allAverage;\n    }\n\n    this.results.average = average;\n    this.results.fractionLostBytes = this.loss;\n  }\n\n  stop() {\n    if (!this.isActive()) {\n      return;\n    }\n    clearTimeout(this.sendTimer);\n    this.sendTimer = null;\n\n    super.stop();\n    this.fillResults();\n  }\n}\n\nexport {ThroughputTest};\n","import * as Timestamps from '../utility/timestamps';\nimport {MessageMaker} from '../utility/messageMaker';\n/* eslint require-jsdoc: 0 */\n\nimport {TurnTest} from './turnTest';\n\nconst MAX_BUFFER_FILL = 2;\nclass LossTest extends TurnTest {\n  constructor(connection) {\n    super(connection);\n\n    this.sentBytes = 0;\n    this.receivedBytes = 0;\n\n    this.chunkSize = 1024;\n    this.messageMaker = new MessageMaker(this.chunkSize);\n\n    this.duration = 3000; // ms\n    this.sendTimer = null;\n    this.lastMessage = null;\n    this.numBufferFill = 0;\n  }\n\n  /*\n   * Override functions\n   */\n  initiate() {\n    if (window && window.csioReactNative) {\n      /* NOTE react-native does not support RTCDataChannel.bufferedAmount, so it\n          is stuck in a loop when putting data to the buffer.\n          Also, when it is ever supported, there is no removeEventListener which has be taken care of */\n      let errMsg = 'Not running loss test for react-native';\n       (errMsg);\n      this.handleError(new Error(errMsg));\n      return;\n    }\n     // console.log('LossTest start', this.duration);\n    let now = Timestamps.getCurrent();\n    this.results.startTimestamp = now;\n    this.startSend();\n  }\n\n  handleMessage(msg) {\n    if (!this.isActive()) {\n      return;\n    }\n    this.lastMessage = msg;\n    // count the total received bytes\n    this.receivedBytes += msg.length;\n\n    // record start time, and set timer to stop\n    if (!this.sendTimer) {\n      this.sendTimer = setTimeout(() => {\n        this.stop();\n        this.finished();\n      }, this.duration);\n    }\n  }\n\n  handleError(error) {\n    this.stop();\n    this.failed(error);\n  }\n\n  fillBuffer() {\n    let sentData = 0;\n    while (this.isActive()) {\n      if (sentData > this.bufferFullThreshold) {\n        break;\n      }\n      let message = this.messageMaker.make(this.sentBytes);\n      this.sentBytes += message.length;\n      sentData += message.length;\n      setTimeout(this.send(message), 8); // sending by pacing, making sure we send 1Mbps\n    }\n    sentData = 0;\n    this.numBufferFill++;\n    if (this.numBufferFill >= MAX_BUFFER_FILL) {\n      return;\n    } else {\n      this.startSend();\n    }\n  }\n\n  startSend() {\n    if (!this.isActive()) {\n      return;\n    }\n    // the amount of data to be buffered\n    this.bufferFullThreshold = (1000 * this.chunkSize) / 8; // The threshold is 1 Mbps\n    this.sendChannel = this.connection.sendChannel;\n    setTimeout(this.fillBuffer.bind(this), 250);\n  }\n\n  fillResults() {\n    this.results.endTimestamp = Timestamps.getCurrent();\n    this.results.maxDuration = this.duration;\n    this.results.forceStopped = this.forceStopped;\n    this.results.sentBytes = this.sentBytes;\n    this.results.bytesReceived = this.receivedBytes;\n\n    let msgJson = null;\n    try {\n      msgJson = JSON.parse(this.lastMessage);\n    } catch (e) {\n      // console.error('Error parsing msg:', msg, e);\n      return;\n    }\n    if (msgJson) {\n      let totalBytes = msgJson.sentBytes + this.lastMessage.length;\n\n      this.results.bytesSent = totalBytes;\n      this.results.fractionLostBytes = 1 - this.receivedBytes/totalBytes;\n    } else {\n      this.results.bytesSent = -1;\n      this.results.fractionLostBytes = -1;\n    }\n     // console.log('Loss Results are ', this.results);\n  }\n\n  stop() {\n    if (!this.isActive()) {\n      return;\n    }\n    clearTimeout(this.sendTimer);\n    this.sendTimer = null;\n\n    super.stop();\n    this.fillResults();\n  }\n}\n\nexport {LossTest};\n","import * as Timestamps from './timestamps';\nimport {randomAsciiString} from './messageMaker';\n\nlet status = {\n  'success': 'success',\n  'stopped': 'stopped',\n  'failed': 'failed',\n};\n\n/** Stores results for tests and failures, and returns a complete results object.\n * The tests themselves are responsible for the format of their own results. */\nclass ResultsHandler {\n  /** Creates a new object */\n  constructor() {\n    this.start = Timestamps.getCurrent();\n    this.id = `${Math.trunc(this.start)}-${randomAsciiString(20)}`;\n    this.version = '@@pctVersion';\n    this.failures = [];\n    this.results = {};\n    this.status = status.success;\n  }\n\n  /** Sets status to stopped\n   */\n  setStatusStopped() {\n    if (this.status === status.failed) {\n      return;\n    }\n    this.status = status.stopped;\n  }\n\n  /** Sets status to failed\n   */\n  setStatusFailed() {\n    this.status = status.failed;\n  }\n\n  /** Sets status to success\n   */\n  setStatusSuccess() {\n    if (this.status === status.stopped) {\n      return;\n    }\n    this.status = status.success;\n  }\n\n  /** Returns the overall result of the PreCallTest\n   * @return {Object} the results\n   */\n  getResults() {\n    let results = {\n      id: this.id,\n      version: this.version,\n      status: this.status,\n      startTimestamp: this.start,\n      endTimestamp: Timestamps.getCurrent(),\n      failures: this.failures,\n      tests: this.results,\n    };\n\n    return results;\n  }\n\n  /** Return the number of failures that have occured\n   * @return {Number} the number of failures\n   */\n  getFailureNumber() {\n    return this.failures.length;\n  }\n\n  /** Returns the current ID\n   * @return {String} the ID\n   */\n  getId() {\n    return this.id;\n  }\n\n  /** adds test result\n   * @param {String} testName the name of the test\n   * @param {Object} result the test result\n   */\n  add(testName, result) {\n    this.results[testName] = result;\n    if (result.hasOwnProperty('forceStopped') && result.forceStopped == true) {\n      this.setStatusStopped();\n    }\n  }\n\n  /** adds a failure to start a PreCallTest, e.g. no connection to TURN server\n   * @param {Error} reason A description for the failure\n   */\n  failure(reason) {\n    if (typeof reason === 'object') {\n      reason = reason.toString();\n    }\n    let failure = {\n      timestamp: Timestamps.getCurrent(),\n      reason: reason,\n    };\n    this.failures.push(failure);\n  }\n}\n\nexport {ResultsHandler};\n","import * as Timestamps from './timestamps';\n\n/** ---- Online checks ---- */\nclass OnlineCheck {\n  /**\n   * constructor\n   */\n  constructor() {\n    this.active = false; // added, because react-native does not support removeEventListener\n  }\n\n  /** checks if the browser has a connection\n   * @private\n   */\n  start() {\n    this.active = true;\n    this.onlineCheck = [];\n\n    if (!window || !window.addEventListener || typeof window.addEventListener != 'function') {\n      return;\n    }\n\n    window.addEventListener('offline', () => {\n      this.addEntry();\n    });\n    window.addEventListener('online', () => {\n      this.addEntry();\n    });\n\n    this.addEntry();\n  }\n\n  /** adds an entry for online check\n   * @private\n   */\n  addEntry() {\n    if (!this.active) {\n      return;\n    }\n\n    let now = Timestamps.getCurrent();\n    if (navigator && navigator.onLine) {\n      let entry = navigator.onLine;\n\n      this.onlineCheck.push({'timestamp': now, 'online': entry});\n    }\n  }\n\n  /** stops checking for browser connection\n   * @return {Object} online check results\n   * @private\n   */\n  stop() {\n    this.active = false;\n\n    if (window && window.removeEventListener && typeof window.removeEventListener === 'function') {\n      window.removeEventListener('offline', () => {\n        this.addEntry();\n      });\n      window.removeEventListener('online', () => {\n        this.addEntry();\n      });\n    }\n\n    return this.onlineCheck;\n  }\n}\n\nexport {OnlineCheck};\n","import {TurnConnection} from './turnConnection';\nimport {RttTest} from './tests/rttTest';\nimport {ThroughputTest} from './tests/throughputTest';\nimport {LossTest} from './tests/lossTest';\nimport {ResultsHandler} from './utility/resultsHandler';\nimport {OnlineCheck} from './utility/onlineCheck';\nimport {detect, Constants} from './utility/stats/detectbrowser';\n\n/** the names of the tests */\nconst TEST_NAMES = {\n  RTT: 'rtt',\n  LOSS: 'loss',\n  THROUGHPUT: 'throughput',\n};\n\n/** the number of times the connection to the TURN server is retried if failed */\nconst FAILURE_RETRIES = 10;\n\n/**\n * Main class for PreCallTest. It performs a series of tests to measure the\n * user's connectivity.\n */\nclass PreCallTest {\n  /** Create a new instance */\n  constructor() {\n    this.browserInfo = detect();\n    this.onlineCheck = new OnlineCheck();\n    this.callsInProgress = 0;\n\n    /* The sequence of TURN tests */\n    this.turnTests = [\n      TEST_NAMES.RTT,\n      TEST_NAMES.LOSS,\n      TEST_NAMES.THROUGHPUT,\n    ];\n    this.active = false;\n    this.rtt = null;\n    this.fractionLostBytes = -1;\n    this.resultsHandler = null;\n    this.startResolve = null;\n    this.startReject = null;\n  }\n\n  /*\n   * Public methods\n   */\n\n  /** Start the precall tests\n   * @param {JSON} iceServers an RTCIceServer object/array\n   * @public\n   */\n  start(iceServers) {\n    this.iceServers = iceServers;\n\n    return new Promise((resolve, reject) => {\n      this.startResolve = resolve;\n      this.startReject = reject;\n\n      if (this.browserInfo.browserName === Constants.browserName.msie) {\n        // console.warn('precalltest: disable for IE');\n        // this.callback(null, 'Not started: disabled for IE');\n        this.startReject(new Error('Not started: disabled for IE'));\n        \n        return;\n      }\n\n      if (this.active) {\n        // console.warn('Not started: already in progress');\n        // this.callback(null, 'Not started: already in progress');\n        this.startReject(new Error('Not started: already in progress'));\n        \n        return;\n      }\n\n      if (this.callsInProgress > 0) {\n        // console.warn('Not started: call in progress');\n        // this.callback(null, 'Not started: call in progress');\n        this.startReject(new Error('Not started: call in progress'));\n        \n        return;\n      }\n\n      if (!iceServers) {\n        // console.warn('Not started: no ICE servers given');\n        // this.callback(null, 'Not started: no ICE servers given');\n        this.startReject(new Error('Not started: no ICE servers given'));\n        \n        return;\n      }\n\n      // console.log('PreCallTest start');\n      this.turnTestCounter = 0;\n      this.resultsHandler = new ResultsHandler();\n\n      let endpointInfo = {\n        type: 'browser',\n        os: this.browserInfo.os,\n        osVersion: this.browserInfo.osVersion,\n        buildName: this.browserInfo.browserName,\n        buildVersion: this.browserInfo.browserVersion,\n        userAgent: this.browserInfo.userAgent,\n      };\n      this.resultsHandler.add('endpointInfo', endpointInfo);\n\n      this.onlineCheck.start();\n\n      this.active = true;\n\n      this._start();\n    });\n  }\n\n  /** Internal start function\n   * @private\n   */\n  _start() {\n    if (!this.active) {\n      return;\n    }\n    this.turnConnection = new TurnConnection(this.browserInfo);\n    this.turnConnection.connect(this.iceServers).then(\n      () => {\n        // console.log('TURN connected.');\n        if (!this.active) {\n          this.stop();\n          return;\n        }\n\n        if (this.resultsHandler) {\n          this.resultsHandler.setStatusSuccess();\n        }\n        this.startTurnTests().then(() => {\n          // console.log('All TURN tests completed');\n          this.stop();\n        }, (e) => {\n          // console.error(e);\n          this.stop();\n        });\n      }, (e) => {\n        let continueFlag = e.continueFlag;\n        // console.log('TURN connection failed:', e);\n        if (this.resultsHandler) {\n          this.resultsHandler.failure(e);\n        }\n        if (!continueFlag) {\n          this.turnConnection.disconnect();\n          this.active = false;\n          let message = '';\n          try {\n            message = e.stack;\n          } catch (err) {\n            message = e.toString();\n          }\n          if (!message || message === '') {\n            message = e.toString();\n          }\n\n          if (this.resultsHandler) {\n            this.resultsHandler.setStatusFailed();\n          }\n\n          // console.warn('Error:', message);\n          // this.callback(null, message);\n          this.startReject(new Error(message));\n\n          return;\n        }\n        if (this.resultsHandler) {\n          this.resultsHandler.setStatusFailed();\n          if (this.resultsHandler.getFailureNumber() >= FAILURE_RETRIES) {\n            this.stop();\n            return;\n          }\n        } else {\n          this.stop();\n          return;\n        }\n        // restart if it hasn't failed too often already\n        this.turnConnection.disconnect();\n        setTimeout(() => {\n          // console.warn('PreCallTest REstart');\n          this._start();\n        }, 0);\n      });\n  }\n\n  /** Stop the precall tests\n   * @private */\n  stop() {\n    if (!this.active) {\n      return;\n    }\n\n    this.active = false;\n    if (this.activeTurnTest) {\n       // console.warn('Stopping active test');\n      this.activeTurnTest.forceStop();\n    }\n    // console.log('PreCallTest stop');\n\n    let onlineCheckResults = this.onlineCheck.stop();\n    if (this.resultsHandler) {\n      this.resultsHandler.add('onlineStatus', onlineCheckResults);\n    }\n\n    this.turnConnection.getIceResults().then((iceResults) => {\n      if (this.resultsHandler) {\n        this.resultsHandler.add('ice', iceResults);\n      }\n\n      // stop everything\n      // console.log('ICE obtained');\n      this.turnConnection.disconnect();\n\n      // send results\n      this.sendResults();\n    }, (err) => {\n      if (this.resultsHandler) {\n        this.resultsHandler.failure(err);\n      }\n\n      // stop everything\n      // console.log('ICE failure');\n      this.turnConnection.disconnect();\n\n      // send results\n      this.sendResults();\n    });\n  }\n\n  /** Start the precall tests\n   * @param {JSON} results full pct results\n   * @return {JSON}\n   * @private\n   */\n  getPublicPrecalltestResults(results) {\n    const publicResults = {\n      mediaConnectivity: false,\n      throughput: null,\n      fractionalLoss: null,\n      rtt: null,\n      jitter: null,\n      timestamp: Date.now(),\n    };\n    if (!results || !results.tests) {\n      return publicResults;\n    }\n\n    publicResults.startTimestamp = results.startTimestamp;\n    publicResults.endTimestamp = results.endTimestamp;\n\n    if (results.tests.rtt) {\n      publicResults.rtt = results.tests.rtt.median;\n      publicResults.mediaConnectivity = true;\n      publicResults.jitter = results.tests.rtt.variance;\n    }\n\n    if (results.tests.throughput) {\n      publicResults.throughput = results.tests.throughput.average;\n      publicResults.fractionalLoss = Math.max(results.tests.throughput.fractionLostBytes, 0);\n      publicResults.mediaConnectivity = true;\n      // publicResults.bytesSent = results.tests.throughput.bytesSent;\n    }\n\n    if (results.tests.ice) {\n      if (results.tests.ice.relayTcpSuccess ||\n          results.tests.ice.relayTlsSuccess ||\n          results.tests.ice.relayUdpSuccess) {\n        publicResults.mediaConnectivity = true;\n      }\n    }\n    return publicResults;\n  }\n\n  /** Send results via callback\n   * @private\n   */\n  sendResults() {\n    if (!this.resultsHandler) {\n        // this.callback(null, 'No results present');\n        this.startReject(new Error('No results present'));\n        return;\n    }\n\n    const results = this.resultsHandler.getResults();\n    const resultsMin = this.getPublicPrecalltestResults(results);\n    // console.log('**** Results ', results, resultsMin);\n      //this.callback(resultsMin, null);\n    this.startResolve(resultsMin);\n  }\n\n  /** Call starts\n   * @public */\n  callStarts() {\n    this.callsInProgress += 1;\n\n    if (this.resultsHandler) {\n      this.resultsHandler.setStatusStopped();\n    }\n\n    this.stop();\n  }\n\n  /** Call finished\n   * @public */\n  callFinished() {\n    this.callsInProgress -= 1;\n    // NOTE tests could be restarted here, if callsInProgress is 0\n  }\n\n  /**\n   * Disconnect the peer connection (used only when some crash occurs)\n   */\n  crashDisconnect() {\n    try {\n       // console.error('something crashed');\n      this.turnConnection.disconnect();\n    } catch (err) {\n       (err);\n    }\n  }\n\n  /*\n   * Private methods\n   */\n\n  /** Start TURN tests. The tests are serialized, the sequence given in this.turnTests\n   * @return {Promise} all tests completed or error, does not reject if a single test fails\n   * @private */\n  startTurnTests() {\n    if (this.turnTestCounter >= this.turnTests.length) {\n      return new Promise((resolve, reject) => {\n        resolve();\n      });\n    }\n\n    let testName = this.turnTests[this.turnTestCounter];\n    let test = null;\n    switch (testName) {\n      case TEST_NAMES.RTT:\n        test = new RttTest(this.turnConnection);\n        break;\n      case TEST_NAMES.LOSS:\n        test = new LossTest(this.turnConnection);\n        break;\n      case TEST_NAMES.THROUGHPUT:\n        test = new ThroughputTest(this.turnConnection, this.rtt, this.fractionLostBytes);\n        break;\n      default:\n        return new Promise((resolve, reject) => {\n          reject(new Error(`Unknown test: ${testName}`));\n        });\n    }\n\n    this.activeTurnTest = test;\n    if (!this.active) {\n      return new Promise((resolve, reject) => {\n        reject(new Error('Test trying to start while testing is not active'));\n      });\n    }\n    return test.start() // returns the Promise\n    .then(() => {\n      // console.info('Test succeeded', testName);\n      this.handleTestResults(testName, test.getResults());\n\n      this.turnTestCounter += 1;\n      this.activeTurnTest = null;\n      return this.startTurnTests();\n    }, (e) => {\n      // console.error('Test failed', testName, e);\n      this.handleTestResults(testName, test.getResults(), e);\n\n      this.turnTestCounter += 1;\n      this.activeTurnTest = null;\n      return this.startTurnTests();\n    });\n  }\n\n  /** handle the results from a test\n   * @param {String} testName the name of the test\n   * @param {Object} results the results of the test\n   * @param {Error=} error if the test failed\n   */\n  handleTestResults(testName, results, error=null) {\n    if (error == null && testName == TEST_NAMES.RTT) {\n      this.rtt = results.median;\n    } else if (error == null && testName == TEST_NAMES.LOSS) {\n      this.fractionLostBytes = results.fractionLostBytes;\n    }\n    if (this.resultsHandler) {\n      this.resultsHandler.add(testName, results);\n    }\n  }\n}\n\nexport default PreCallTest;\n\n// for standlone browserify based testing\n// (function() {\n//   if (('function' === typeof define) && (define.amd)) {/* AMD support */\n//     define('PreCallTest', [], PreCallTest);\n//   } else {/* Browsers and Web Workers*/\n//     global.PreCallTest = PreCallTest;\n//   }\n//   module.exports = PreCallTest;\n// })(typeof window !== 'undefined' ? window : typeof global !== 'undefined' ? global : this); // eslint-disable-line\n","import currentExecutingScript from 'current-executing-script';\n\n/* eslint-disable max-params */\n\nexport interface ILoadScriptOptions {\n    async: boolean;\n    errorCallback?: () => void;\n    loadCallback?: () => void;\n    prepend: boolean;\n    relativeURL: boolean;\n    src: string;\n}\n\n/**\n * Implements utility functions which facilitate the dealing with scripts such\n * as the download and execution of a JavaScript file.\n */\nconst ScriptUtil = {\n    /**\n     * Loads a script from a specific source.\n     * @param options\n     * @param options.src the source from the which the script is to be (down)loaded\n     * @param options.async true to asynchronously load the script or false to\n     * synchronously load the script\n     * @param options.prepend true to schedule the loading of the script as soon as\n     * possible or false to schedule the loading of the script at the end of the\n     * scripts known at the time\n     * @param options.relativeURL whether we need load the library from url relative\n     * to the url that lib-jitsi-meet was loaded. Useful when sourcing the\n     * library from different location than the app that is using it\n     * @param options.loadCallback on load callback function\n     * @param options.errorCallback callback to be called on error loading the script\n     */\n    loadScript({\n        src,\n        async,\n        prepend,\n        relativeURL,\n        loadCallback,\n        errorCallback\n    }: ILoadScriptOptions): void {\n        const d = document;\n        const tagName = 'script';\n        const script = d.createElement(tagName);\n        const referenceNode = d.getElementsByTagName(tagName)[0];\n\n        script.async = async;\n\n        if (relativeURL) {\n            // finds the src url of the current loaded script\n            // and use it as base of the src supplied argument\n            const scriptEl = currentExecutingScript();\n\n            if (scriptEl) {\n                const scriptSrc = scriptEl.src;\n                const baseScriptSrc\n                    = scriptSrc.substring(0, scriptSrc.lastIndexOf('/') + 1);\n\n                if (scriptSrc && baseScriptSrc) {\n                    // eslint-disable-next-line no-param-reassign\n                    src = baseScriptSrc + src;\n                }\n            }\n        }\n\n        if (loadCallback) {\n            script.onload = loadCallback;\n        }\n        if (errorCallback) {\n            script.onerror = errorCallback;\n        }\n\n        script.src = src;\n        if (prepend) {\n            referenceNode.parentNode.insertBefore(script, referenceNode);\n        } else {\n            referenceNode.parentNode.appendChild(script);\n        }\n    }\n};\n\n/* eslint-enable max-params */\n\nexport default ScriptUtil;\n","import { getLogger } from '@jitsi/logger';\n\nimport { createAudioContext } from './WebAudioUtils';\n\nconst logger = getLogger('webaudio:AudioMixer');\n\n/**\n * The AudioMixer, as the name implies, mixes a number of MediaStreams containing audio tracks into a single\n * MediaStream.\n */\nexport default class AudioMixer {\n    private _started: boolean;\n    private _streamsToMix: MediaStream[];\n    private _streamMSSArray: MediaStreamAudioSourceNode[];\n    private _audioContext?: AudioContext;\n    private _mixedMSD?: MediaStreamAudioDestinationNode;\n\n    /**\n     * Create AudioMixer instance.\n     */\n    constructor() {\n        this._started = false;\n        this._streamsToMix = [];\n        this._streamMSSArray = [];\n    }\n\n    /**\n     * Add audio MediaStream to be mixed, if the stream doesn't contain any audio tracks it will be ignored.\n     *\n     * @param {MediaStream} stream - MediaStream to be mixed.\n     */\n    addMediaStream(stream: MediaStream): void {\n        if (!stream.getAudioTracks() || stream.getAudioTracks().length === 0) {\n            logger.warn('Added MediaStream doesn\\'t contain audio tracks.');\n        }\n\n        this._streamsToMix.push(stream);\n    }\n\n    /**\n     * At this point a WebAudio ChannelMergerNode is created and and the two associated MediaStreams are connected to\n     * it; the resulting mixed MediaStream is returned.\n     *\n     * @returns {Nullable<MediaStream>} - MediaStream containing added streams mixed together, or null if no MediaStream\n     * is added.\n     */\n    start(): Nullable<MediaStream> {\n        // If the mixer was already started just return the existing mixed stream.\n        if (this._started && this._mixedMSD) {\n            return this._mixedMSD.stream;\n        }\n\n        this._audioContext = createAudioContext();\n\n        if (!this._streamsToMix.length) {\n            logger.warn('No MediaStream\\'s added to AudioMixer, nothing will happen.');\n\n            return null;\n        }\n\n        this._started = true;\n\n        this._mixedMSD = this._audioContext!.createMediaStreamDestination();\n\n        for (const stream of this._streamsToMix) {\n            const streamMSS = this._audioContext!.createMediaStreamSource(stream);\n\n            streamMSS.connect(this._mixedMSD);\n\n            // Maintain a list of MediaStreamAudioSourceNode so we can disconnect them on reset.\n            this._streamMSSArray.push(streamMSS);\n        }\n\n        return this._mixedMSD.stream;\n    }\n\n    /**\n     * Disconnect MediaStreamAudioSourceNode and clear references.\n     *\n     * @returns {void}\n     */\n    reset(): void {\n        this._started = false;\n        this._streamsToMix = [];\n\n        // Clean up created MediaStreamAudioSourceNode.\n        for (const streamMSS of this._streamMSSArray) {\n            streamMSS.disconnect();\n        }\n\n        this._streamMSSArray = [];\n\n        if (this._audioContext) {\n            this._audioContext = undefined;\n        }\n        this._mixedMSD = undefined;\n    }\n}\n","// This file is auto-generated during build\nexport const COMMIT_HASH = 'a189bcad';\n","import Logger from '@jitsi/logger';\nimport { merge } from 'lodash-es';\n\nimport JitsiConference, { IConferenceOptions } from './JitsiConference';\nimport * as JitsiConferenceErrors from './JitsiConferenceErrors';\nimport { JitsiConferenceEvents } from './JitsiConferenceEvents';\nimport JitsiConnection, { IConnectionOptions } from './JitsiConnection';\nimport * as JitsiConnectionErrors from './JitsiConnectionErrors';\nimport { JitsiConnectionEvents } from './JitsiConnectionEvents';\nimport JitsiMediaDevices from './JitsiMediaDevices';\nimport { JitsiMediaDevicesEvents } from './JitsiMediaDevicesEvents';\nimport JitsiTrackError from './JitsiTrackError';\nimport * as JitsiTrackErrors from './JitsiTrackErrors';\nimport { JitsiTrackEvents } from './JitsiTrackEvents';\nimport * as JitsiTranscriptionStatus from './JitsiTranscriptionStatus';\nimport JitsiLocalTrack from './modules/RTC/JitsiLocalTrack';\nimport RTC from './modules/RTC/RTC';\nimport RTCStats from './modules/RTCStats/RTCStats';\nimport { RTCStatsEvents } from './modules/RTCStats/RTCStatsEvents';\nimport browser from './modules/browser';\nimport NetworkInfo from './modules/connectivity/NetworkInfo';\nimport { TrackStreamingStatus } from './modules/connectivity/TrackStreamingStatus';\nimport getActiveAudioDevice from './modules/detection/ActiveDeviceDetector';\nimport { DetectionEvents } from './modules/detection/DetectionEvents';\nimport TrackVADEmitter from './modules/detection/TrackVADEmitter';\nimport ProxyConnectionService\n    from './modules/proxyconnection/ProxyConnectionService';\nimport recordingConstants from './modules/recording/recordingConstants';\nimport Settings from './modules/settings/Settings';\nimport LocalStatsCollector from './modules/statistics/LocalStatsCollector';\nimport runPreCallTest, { IIceServer, IPreCallResult } from './modules/statistics/PreCallTest';\nimport Statistics from './modules/statistics/statistics';\nimport Deferred from './modules/util/Deferred';\nimport ScriptUtil from './modules/util/ScriptUtil';\nimport * as VideoSIPGWConstants from './modules/videosipgw/VideoSIPGWConstants';\nimport AudioMixer from './modules/webaudio/AudioMixer';\nimport { MediaType } from './service/RTC/MediaType';\nimport { VideoType } from './service/RTC/VideoType';\nimport { ConnectionQualityEvents } from './service/connectivity/ConnectionQualityEvents';\nimport { E2ePingEvents } from './service/e2eping/E2ePingEvents';\nimport { createGetUserMediaEvent } from './service/statistics/AnalyticsEvents';\nimport { COMMIT_HASH } from './version';\n\nconst logger = Logger.getLogger('core:JitsiMeetJS');\n\n// Settin the default log levels to info early so that we avoid overriding a log level set externally.\nLogger.setLogLevel(Logger.levels.INFO);\n\n/**\n * Indicates whether GUM has been executed or not.\n */\nlet hasGUMExecuted = false;\n\n/**\n * Extracts from an 'options' objects with a specific format (TODO what IS the\n * format?) the attributes which are to be logged in analytics events.\n *\n * @param options gum options (???)\n * @returns {*} the attributes to attach to analytics events.\n */\nfunction getAnalyticsAttributesFromOptions(options) {\n    const attributes: any = {};\n\n    /* eslint-disable */\n\n    attributes.audio_requested = options.devices.includes(MediaType.AUDIO);\n    attributes.video_requested = options.devices.includes(MediaType.VIDEO);\n    attributes.screen_sharing_requested = options.devices.includes(VideoType.DESKTOP);\n\n    if (attributes.video_requested) {\n        attributes.resolution = options.resolution;\n    }\n\n    /* eslint-enable */\n\n    return attributes;\n}\n\ninterface ICreateLocalTrackOptions {\n    cameraDeviceId?: string;\n    devices?: any[];\n    fireSlowPromiseEvent?: boolean;\n    micDeviceId?: string;\n    resolution?: string;\n}\n\ntype desktopSharingSourceType = 'screen' | 'window';\n\ninterface IJitsiMeetJSOptions {\n    analytics?: {\n        rtcstatsLogFlushSizeBytes?: number;\n        rtcstatsStoreLogs?: boolean;\n    };\n    audioLevelsInterval?: number;\n    desktopSharingSources?: Array<desktopSharingSourceType>;\n    disableAudioLevels?: boolean;\n    disableThirdPartyRequests?: boolean;\n    enableAnalyticsLogging?: boolean;\n    enableWindowOnErrorHandler?: boolean;\n    externalStorage?: Storage;\n    flags?: {\n        runInLiteMode?: boolean;\n        ssrcRewritingEnabled?: boolean;\n    };\n    pcStatsInterval?: number;\n}\n\ninterface ICreateLocalTrackFromMediaStreamOptions {\n    mediaType: MediaType;\n    sourceType: string;\n    stream: MediaStream;\n    track: MediaStreamTrack;\n    videoType?: VideoType;\n}\n\nexport interface IJoinConferenceOptions {\n    conferenceOptions?: IConferenceOptions;\n    connectionOptions?: IConnectionOptions;\n    jaas?: {\n        release?: boolean;\n        useStaging?: boolean;\n    };\n    tracks?: JitsiLocalTrack[];\n}\n\nconst mediaDevices = new JitsiMediaDevices();\n\n/**\n * The public API of the Jitsi Meet library (a.k.a. `JitsiMeetJS`).\n */\nconst JitsiMeetJS = {\n    JitsiConnection,\n\n    /**\n     * `ProxyConnectionService` is used to connect a remote peer to a local Jitsi participant without going\n     * through a Jitsi conference. It is currently used for room integration development, specifically wireless\n     * screensharing. Its API is experimental and will likely change; usage of it is advised against.\n     */\n    ProxyConnectionService,\n\n    /**\n     * Registers new global logger transport to the library logging framework.\n     *\n     * @param globalTransport\n     * @see Logger.addGlobalTransport\n     */\n    addGlobalLogTransport(globalTransport) {\n        Logger.addGlobalTransport(globalTransport);\n    },\n\n    /**\n     * Analytics configuration.\n     */\n    analytics: Statistics.analytics as unknown,\n\n    /**\n     * Constants used throughout the library.\n     */\n    constants: {\n        recording: recordingConstants,\n        sipVideoGW: VideoSIPGWConstants,\n        trackStreamingStatus: TrackStreamingStatus,\n        transcriptionStatus: JitsiTranscriptionStatus,\n    },\n\n    /**\n     * Create AudioMixer, which is essentially a wrapper over web audio ChannelMergerNode. It essentially allows the\n     * user to mix multiple MediaStreams into a single one.\n     *\n     * @returns {AudioMixer}\n     */\n    createAudioMixer() {\n        return new AudioMixer();\n    },\n\n    /**\n     * Creates local media tracks.\n     *\n     * @param options Object with properties / settings specifying the tracks which should be created. should be\n     * created or some additional configurations about resolution for example.\n     * @param {Array} options.effects optional effects array for the track\n     * @param {Array} options.devices the devices that will be requested\n     * @param {string} options.resolution resolution constraints\n     * @param {string} options.cameraDeviceId\n     * @param {string} options.micDeviceId\n     *\n     * @returns {Promise.<{Array.<JitsiTrack>}, JitsiTrackError>} A promise that returns an array of created\n     * JitsiTracks if resolved, or a JitsiTrackError if rejected.\n     */\n    createLocalTracks(options: ICreateLocalTrackOptions = {}): Promise<JitsiLocalTrack[] | JitsiTrackError> {\n        let isFirstGUM = false;\n        const startTS = window.performance.now();\n\n        if (!window.connectionTimes) {\n            window.connectionTimes = {};\n        }\n\n        if (!hasGUMExecuted) {\n            hasGUMExecuted = true;\n            isFirstGUM = true;\n            window.connectionTimes['firstObtainPermissions.start'] = startTS;\n        }\n        window.connectionTimes['obtainPermissions.start'] = startTS;\n\n        return RTC.obtainAudioAndVideoPermissions(options)\n            .then(tracks => {\n                const endTS = window.performance.now();\n\n                window.connectionTimes['obtainPermissions.end'] = endTS;\n\n                if (isFirstGUM) {\n                    window.connectionTimes['firstObtainPermissions.end'] = endTS;\n                }\n\n                Statistics.sendAnalytics(\n                    createGetUserMediaEvent(\n                        'success',\n                        getAnalyticsAttributesFromOptions(options)));\n\n                if (this.isCollectingLocalStats()) {\n                    for (let i = 0; i < tracks.length; i++) {\n                        const track = tracks[i];\n\n                        if (track.getType() === MediaType.AUDIO) {\n                            Statistics.startLocalStats(track,\n                                track.setAudioLevel.bind(track));\n                        }\n                    }\n                }\n\n                // set real device ids\n                const currentlyAvailableMediaDevices\n                    = RTC.getCurrentlyAvailableMediaDevices();\n\n                if (currentlyAvailableMediaDevices) {\n                    for (let i = 0; i < tracks.length; i++) {\n                        const track = tracks[i];\n\n                        track._setRealDeviceIdFromDeviceList(\n                            currentlyAvailableMediaDevices);\n                    }\n                }\n\n                return tracks;\n            })\n            .catch(error => {\n                if (error.name === JitsiTrackErrors.SCREENSHARING_USER_CANCELED) {\n                    Statistics.sendAnalytics(\n                        createGetUserMediaEvent(\n                            'warning',\n                            {\n                                reason: 'extension install user canceled'\n                            }));\n                } else if (error.name === JitsiTrackErrors.NOT_FOUND) {\n                    const attributes\n                        = getAnalyticsAttributesFromOptions(options);\n\n                    attributes.reason = 'device not found';\n                    attributes.devices = error.gum.devices.join('.');\n                    Statistics.sendAnalytics(\n                        createGetUserMediaEvent('error', attributes));\n                } else {\n                    const attributes\n                        = getAnalyticsAttributesFromOptions(options);\n\n                    attributes.reason = error.name;\n                    Statistics.sendAnalytics(\n                        createGetUserMediaEvent('error', attributes));\n                }\n\n                const endTS = window.performance.now();\n\n                window.connectionTimes['obtainPermissions.end'] = endTS;\n\n                if (isFirstGUM) {\n                    window.connectionTimes['firstObtainPermissions.end'] = endTS;\n                }\n\n                return Promise.reject(error);\n            });\n    },\n\n    /**\n     * Manually create JitsiLocalTrack's from the provided track info, by exposing the RTC method\n     *\n     * @param {Array<ICreateLocalTrackFromMediaStreamOptions>} tracksInfo - array of track information\n     * @returns {Array<JitsiLocalTrack>} - created local tracks\n     */\n    createLocalTracksFromMediaStreams(tracksInfo: ICreateLocalTrackFromMediaStreamOptions[]): JitsiLocalTrack[] {\n        return RTC.createLocalTracks(tracksInfo.map(trackInfo => {\n            const tracks = trackInfo.stream.getTracks()\n                .filter(track => track.kind === trackInfo.mediaType);\n\n            if (!tracks || tracks.length === 0) {\n                // eslint-disable-next-line @typescript-eslint/only-throw-error\n                throw new JitsiTrackError(JitsiTrackErrors.TRACK_NO_STREAM_TRACKS_FOUND, null, null);\n            }\n\n            if (tracks.length > 1) {\n                // eslint-disable-next-line @typescript-eslint/only-throw-error\n                throw new JitsiTrackError(JitsiTrackErrors.TRACK_TOO_MANY_TRACKS_IN_STREAM, null, null);\n            }\n\n            trackInfo.track = tracks[0];\n\n            return trackInfo;\n        }));\n    },\n\n    /**\n     * Create a TrackVADEmitter service that connects an audio track to an VAD (voice activity detection) processor in\n     * order to obtain VAD scores for individual PCM audio samples.\n     *\n     * @param {string} localAudioDeviceId - The target local audio device.\n     * @param {number} sampleRate - Sample rate at which the emitter will operate. Possible values  256, 512, 1024,\n     * 4096, 8192, 16384. Passing other values will default to closes neighbor.\n     * I.e. Providing a value of 4096 means that the emitter will process 4096 PCM samples at a time, higher values mean\n     * longer calls, lowers values mean more calls but shorter.\n     * @param {Object} vadProcessor - VAD Processors that does the actual compute on a PCM sample.The processor needs\n     * to implement the following functions:\n     * - <tt>getSampleLength()</tt> - Returns the sample size accepted by calculateAudioFrameVAD.\n     * - <tt>getRequiredPCMFrequency()</tt> - Returns the PCM frequency at which the processor operates.\n     * i.e. (16KHz, 44.1 KHz etc.)\n     * - <tt>calculateAudioFrameVAD(pcmSample)</tt> - Process a 32 float pcm sample of getSampleLength size.\n     * @returns {Promise<TrackVADEmitter>}\n     */\n    createTrackVADEmitter(localAudioDeviceId, sampleRate, vadProcessor) {\n        return TrackVADEmitter.create(localAudioDeviceId, sampleRate, vadProcessor);\n    },\n\n    errorTypes: {\n        JitsiTrackError\n    },\n    errors: {\n        conference: JitsiConferenceErrors,\n        connection: JitsiConnectionErrors,\n        track: JitsiTrackErrors\n    },\n    events: {\n        conference: JitsiConferenceEvents,\n        connection: JitsiConnectionEvents,\n        connectionQuality: ConnectionQualityEvents,\n        detection: DetectionEvents,\n        e2eping: E2ePingEvents,\n        mediaDevices: JitsiMediaDevicesEvents,\n        rtcstats: RTCStatsEvents,\n        track: JitsiTrackEvents\n    },\n\n    /**\n     * Go through all audio devices on the system and return one that is active, i.e. has audio signal.\n     *\n     * @returns Promise<Object> - Object containing information about the found device.\n     */\n    getActiveAudioDevice() {\n        return getActiveAudioDevice();\n    },\n\n    /**\n     * Initializes the library.\n     *\n     * @param options - The options to use for initializing the library.\n     * @returns {void}\n     */\n    init(options: IJitsiMeetJSOptions = {}) {\n        // Start capturing and sending logs to the rtcstats server as soon as possible.\n        const {\n            analytics: {\n                rtcstatsStoreLogs,\n                rtcstatsLogFlushSizeBytes\n            } = {}\n        } = options;\n\n        if (rtcstatsStoreLogs) {\n            Logger.addGlobalTransport(RTCStats.getDefaultLogCollector(rtcstatsLogFlushSizeBytes));\n        }\n\n        // @ts-ignore\n        logger.info(`This appears to be ${browser.getName()}, ver: ${browser.getVersion()}`);\n\n        mediaDevices.init();\n        Settings.init(options.externalStorage);\n        Statistics.init(options);\n\n        // Initialize global window.connectionTimes\n        // FIXME do not use 'window'\n        if (!window.connectionTimes) {\n            window.connectionTimes = {};\n        }\n\n        if (options.enableAnalyticsLogging !== true) {\n            logger.warn('Analytics disabled, disposing.');\n            this.analytics.dispose();\n        }\n\n        RTC.init(options);\n    },\n\n    /**\n     * Checks if local tracks can collect stats and collection is enabled.\n     *\n     * @returns {boolean} True if local stats are being collected.\n     */\n    isCollectingLocalStats() {\n        return Statistics.audioLevelsEnabled && LocalStatsCollector.isLocalStatsSupported();\n    },\n\n    /**\n     * Returns whether the desktop sharing is enabled or not.\n     *\n     * @returns {boolean}\n     */\n    isDesktopSharingEnabled() {\n        return RTC.isDesktopSharingEnabled();\n    },\n\n    /**\n     * Checks if the current environment supports having multiple audio\n     * input devices in use simultaneously.\n     *\n     * @returns {boolean} True if multiple audio input devices can be used.\n     */\n    isMultipleAudioInputSupported() {\n        return this.mediaDevices.isMultipleAudioInputSupported();\n    },\n\n    /**\n     * Returns whether the current execution environment supports WebRTC (for\n     * use within this library).\n     *\n     * @returns {boolean} `true` if WebRTC is supported in the current\n     * execution environment (for use within this library); `false`,\n     * otherwise.\n     */\n    isWebRtcSupported() {\n        return RTC.isWebRtcSupported();\n    },\n\n    /**\n     * Simple way to create a {JitsiConference}. All options are optional and sane defaults\n     * will be chosen for JaaS users.\n     *\n     * @param roomName - The name of the conference.\n     * @param appId - The application id (also known as tenant).\n     * @param token - The token (JWT) to use for authentication.\n     * @param options - The options to use for joining the conference.\n     */\n    async joinConference(\n            roomName: string,\n            appId: string = '',\n            token: Nullable<string> = null,\n            options: IJoinConferenceOptions = {}): Promise<JitsiConference> {\n        const d = new Deferred();\n        let connectionOptions = options.connectionOptions ?? {};\n\n        // Provide a solid default config in case of JaaS.\n        if (appId.startsWith('vpaas-magic-cookie')) {\n            // Initialize RTCStats logging.\n            Logger.addGlobalTransport(RTCStats.getDefaultLogCollector());\n\n            const useStage = options.jaas?.useStaging ?? false;\n            const jaasDomain = useStage ? 'staging.8x8.vc' : '8x8.vc';\n            const opts = {\n                analytics: {\n                    rtcstatsEnabled: true,\n                    rtcstatsEndpoint: `wss://rtcstats-server-${useStage ? 'pilot' : '8x8'}.jitsi.net/`,\n                    rtcstatsSendSdp: true,\n                },\n                conferenceRequestUrl: `https://${jaasDomain}/${appId}/conference-request/v1?room=${roomName}`,\n                hosts: {\n                    domain: jaasDomain,\n                    muc: `conference.${appId}.${jaasDomain}`\n                },\n                serviceUrl: `wss://${jaasDomain}/${appId}/xmpp-websocket?room=${roomName}`,\n                websocketKeepAliveUrl: `https://${jaasDomain}/${appId}/_unlock?room=${roomName}`\n            };\n\n            connectionOptions = merge(connectionOptions, opts);\n        }\n\n        const conn = new JitsiConnection(appId, token, connectionOptions as IConnectionOptions);\n\n        function cleanupListeners() {\n            conn.removeEventListener(\n                JitsiConnectionEvents.CONNECTION_ESTABLISHED, onConnectionEstablished);\n            conn.removeEventListener(\n                JitsiConnectionEvents.CONNECTION_FAILED, onConnectionFailed);\n        }\n\n        function onConnectionEstablished() {\n            cleanupListeners();\n\n            const conf = conn.initJitsiConference(roomName, options.conferenceOptions ?? {});\n\n            d.resolve(conf);\n\n            // Make sure this runs after the promise was resolved so that local track events can be\n            // listened to.\n            queueMicrotask(() => {\n                for (const track of options.tracks || []) {\n                    conf.addTrack(track);\n                }\n\n                conf.join();\n\n                // Default to receiving 720p for everyone.\n                conf.setReceiverConstraints({\n                    defaultConstraints: { maxHeight: 720 },\n                    lastN: -1\n                });\n            });\n        }\n\n        function onConnectionFailed(error: string) {\n            cleanupListeners();\n            d.reject(error);\n        }\n\n        conn.addEventListener(\n            JitsiConnectionEvents.CONNECTION_ESTABLISHED, onConnectionEstablished);\n        conn.addEventListener(\n            JitsiConnectionEvents.CONNECTION_FAILED, onConnectionFailed);\n        conn.connect({ name: roomName });\n\n        return d as unknown as Promise<JitsiConference>;\n    },\n\n    logLevels: Logger.levels,\n    mediaDevices,\n\n    /**\n     * Removes global logging transport from the library logging framework.\n     *\n     * @param globalTransport\n     * @see Logger.removeGlobalTransport\n     */\n    removeGlobalLogTransport(globalTransport) {\n        Logger.removeGlobalTransport(globalTransport);\n    },\n\n    /**\n     * Expose rtcstats to the public API.\n     */\n    rtcstats: {\n        /**\n         * Checks if the rtcstats trace is available.\n         * The trace is the abstraction for the underlying rtcstats websocket connection.\n         *\n         * @returns {boolean} <tt>true</tt> if the rtcstats trace is available or\n         * <tt>false</tt> otherwise.\n         */\n        isTraceAvailable() {\n            return RTCStats.isTraceAvailable();\n        },\n\n        /**\n         * Events generated by rtcstats, such as PeerConnections state,\n         * and websocket connection state.\n         *\n         * @param {RTCStatsEvents} event - The event name.\n         * @param {function} handler - The event handler.\n         */\n        on(event, handler) {\n            RTCStats.events.on(event, handler);\n        },\n\n        /**\n         * Sends identity data to the rtcstats server. This data is used\n         * to identify the specifics of a particular client, it can be any object\n         * and will show in the generated rtcstats dump under \"identity\" entries.\n         *\n         * @param {Object} identityData - Identity data to send.\n         * @returns {void}\n         */\n        sendIdentityEntry(identityData) {\n            RTCStats.sendIdentity(identityData);\n        },\n\n        /**\n         * Sends a stats entry to rtcstats server.\n         * @param {string} statsType - The type of stats to send.\n         * @param {Object} data - The stats data to send.\n         */\n        sendStatsEntry(statsType: RTCStatsEvents, data?: Optional<any>) {\n            RTCStats.sendStatsEntry(statsType, null, data);\n        }\n    },\n\n    /**\n     * Run a pre-call test to check the network conditions.\n     *\n     * @param {IIceServer} iceServers  - The ICE servers to use for the test,\n     * @returns {Promise<PreCallResult | any>} - A Promise that resolves with the test results or rejects with an error\n     * message.\n     */\n    runPreCallTest(iceServers: IIceServer[]): Promise<IPreCallResult | any> {\n        return runPreCallTest(iceServers);\n    },\n\n    /**\n    * Sets global options which will be used by all loggers. Changing these\n    * works even after other loggers are created.\n    *\n    * @param options\n    * @see Logger.setGlobalOptions\n    */\n    setGlobalLogOptions(options) {\n        Logger.setGlobalOptions(options);\n    },\n\n    /**\n     * Sets the log level to the <tt>Logger</tt> instance.\n     *\n     * @param {Logger.levels} level the logging level to be set\n     * @see Logger.setLogLevel\n     */\n    setLogLevel(level) {\n        Logger.setLogLevel(level);\n    },\n\n    /**\n     * Sets the log level to the <tt>Logger</tt> instance with given id.\n     *\n     * @param {Logger.levels} level the logging level to be set\n     * @param {string} id the logger id to which new logging level will be set.\n     * Usually it's the name of the JavaScript source file including the path\n     * ex. \"modules/xmpp/ChatRoom.js\"\n     */\n    setLogLevelById(level, id) {\n        Logger.setLogLevelById(level, id);\n    },\n\n    /**\n     * Informs lib-jitsi-meet about the current network status.\n     *\n     * @param {object} state - The network info state.\n     * @param {boolean} state.isOnline - `true` if the internet connectivity is online or `false`\n     * otherwise.\n     */\n    setNetworkInfo({ isOnline }) {\n        NetworkInfo.updateNetworkInfo({ isOnline });\n    },\n\n    /**\n     * Represents a hub/namespace for utility functionality which may be of\n     * interest to lib-jitsi-meet clients.\n     */\n    util: {\n        ScriptUtil,\n        browser\n    },\n    version: COMMIT_HASH\n};\n\nexport default JitsiMeetJS;\n","export interface IRecordingConstants {\n    error: {\n        BUSY: string;\n        ERROR: string;\n        POLICY_VIOLATION: string;\n        RESOURCE_CONSTRAINT: string;\n        SERVICE_UNAVAILABLE: string;\n        UNEXPECTED_REQUEST: string;\n    };\n    mode: {\n        FILE: string;\n        STREAM: string;\n    };\n    status: {\n        OFF: string;\n        ON: string;\n        PENDING: string;\n    };\n}\n\nconst recordingConstants: IRecordingConstants = {\n    error: {\n        BUSY: 'busy',\n        ERROR: 'error',\n        POLICY_VIOLATION: 'policy-violation',\n        RESOURCE_CONSTRAINT: 'resource-constraint',\n        SERVICE_UNAVAILABLE: 'service-unavailable',\n        UNEXPECTED_REQUEST: 'unexpected-request'\n    },\n    mode: {\n        FILE: 'file',\n        STREAM: 'stream'\n    },\n    status: {\n        OFF: 'off',\n        ON: 'on',\n        PENDING: 'pending'\n    }\n};\n\nexport default recordingConstants;\n","import PreCallTest from '@jitsi/precall-test';\n\n\nexport interface IPreCallResult {\n\n    // Maximum bandwidth reached in kbps  (kilo bits per second).\n    fractionalLoss: number;\n\n    // Round trip time in milliseconds.\n    jitter: number;\n\n    // Variation in packet arrival times during the transmission of media.\n    mediaConnectivity: boolean;\n\n    // Packet loss percentage over all the test traffic.\n    rtt: number;\n    throughput: number; // Whether the data channel was able to send data or not.\n}\n\n// Same interface as a PeerConnection configuration object.\nexport interface IIceServer {\n    credential?: string;\n    urls: Array<string> | string;\n    username?: string;\n}\n\n/**\n * Run a pre-call test to check the network conditions. It uses a TURN server to establish\n * a connection between two PeerConnections using the server as a relay. Afterwards it sends\n * some test traffic through a data channel to measure the network conditions, these are\n * recorded and returned through a Promise.\n *\n * @param {Array<IIceServer>} - The ICE servers to use for the test, these are passes to the PeerConnection constructor.\n * @returns {Promise<IPreCallResult | any>} - A Promise that resolves with the test results or rejects with an error.\n */\nexport default async function runPreCallTest(iceServers: Array<IIceServer>): Promise<IPreCallResult | string> {\n    const test = new PreCallTest();\n\n    return await test.start(iceServers);\n}\n","const ljm = require('./JitsiMeetJS').default;\n\n/**\n * Tries to deal with the following problem: {@code JitsiMeetJS} is not only\n * this module, it's also a global (i.e. attached to {@code window}) namespace\n * for all globals of the projects in the Jitsi Meet family. If lib-jitsi-meet\n * is loaded through an HTML {@code script} tag, {@code JitsiMeetJS} will\n * automatically be attached to {@code window} by webpack. Unfortunately,\n * webpack's source code does not check whether the global variable has already\n * been assigned and overwrites it. Which is OK for the module\n * {@code JitsiMeetJS} but is not OK for the namespace {@code JitsiMeetJS}\n * because it may already contain the values of other projects in the Jitsi Meet\n * family. The solution offered here works around webpack by merging all\n * existing values of the namespace {@code JitsiMeetJS} into the module\n * {@code JitsiMeetJS}.\n *\n * @param {Object} module - The module {@code JitsiMeetJS} (which will be\n * exported and may be attached to {@code window} by webpack later on).\n * @private\n * @returns {Object} - A {@code JitsiMeetJS} module which contains all existing\n * value of the namespace {@code JitsiMeetJS} (if any).\n */\nfunction _mergeNamespaceAndModule(module) {\n    return (\n        typeof window.JitsiMeetJS === 'object'\n            ? { ...window.JitsiMeetJS,\n                ...module }\n            : module);\n}\n\nmodule.exports = _mergeNamespaceAndModule(ljm);\n","'use strict';\n\n\nconst internals = {\n    suspectRx: /\"(?:_|\\\\u005[Ff])(?:_|\\\\u005[Ff])(?:p|\\\\u0070)(?:r|\\\\u0072)(?:o|\\\\u006[Ff])(?:t|\\\\u0074)(?:o|\\\\u006[Ff])(?:_|\\\\u005[Ff])(?:_|\\\\u005[Ff])\"\\s*\\:/\n};\n\n\nexports.parse = function (text, ...args) {\n\n    // Normalize arguments\n\n    const firstOptions = typeof args[0] === 'object' && args[0];\n    const reviver = args.length > 1 || !firstOptions ? args[0] : undefined;\n    const options = (args.length > 1 && args[1]) || firstOptions || {};\n\n    // Parse normally, allowing exceptions\n\n    const obj = JSON.parse(text, reviver);\n\n    // options.protoAction: 'error' (default) / 'remove' / 'ignore'\n\n    if (options.protoAction === 'ignore') {\n        return obj;\n    }\n\n    // Ignore null and non-objects\n\n    if (!obj ||\n        typeof obj !== 'object') {\n\n        return obj;\n    }\n\n    // Check original string for potential exploit\n\n    if (!text.match(internals.suspectRx)) {\n        return obj;\n    }\n\n    // Scan result for proto keys\n\n    exports.scan(obj, options);\n\n    return obj;\n};\n\n\nexports.scan = function (obj, options = {}) {\n\n    let next = [obj];\n\n    while (next.length) {\n        const nodes = next;\n        next = [];\n\n        for (const node of nodes) {\n            if (Object.prototype.hasOwnProperty.call(node, '__proto__')) {      // Avoid calling node.hasOwnProperty directly\n                if (options.protoAction !== 'remove') {\n                    throw new SyntaxError('Object contains forbidden prototype property');\n                }\n\n                delete node.__proto__;\n            }\n\n            for (const key in node) {\n                const value = node[key];\n                if (value &&\n                    typeof value === 'object') {\n\n                    next.push(node[key]);\n                }\n            }\n        }\n    }\n};\n\n\nexports.safeParse = function (text, reviver) {\n\n    try {\n        return exports.parse(text, reviver);\n    }\n    catch (ignoreError) {\n        return null;\n    }\n};\n","/////////////////////////////////////////////////////////////////////////////////\n/* UAParser.js v1.0.35\n   Copyright  2012-2021 Faisal Salman <f@faisalman.com>\n   MIT License *//*\n   Detect Browser, Engine, OS, CPU, and Device type/model from User-Agent data.\n   Supports browser & node.js environment. \n   Demo   : https://faisalman.github.io/ua-parser-js\n   Source : https://github.com/faisalman/ua-parser-js */\n/////////////////////////////////////////////////////////////////////////////////\n\n(function (window, undefined) {\n\n    'use strict';\n\n    //////////////\n    // Constants\n    /////////////\n\n\n    var LIBVERSION  = '1.0.35',\n        EMPTY       = '',\n        UNKNOWN     = '?',\n        FUNC_TYPE   = 'function',\n        UNDEF_TYPE  = 'undefined',\n        OBJ_TYPE    = 'object',\n        STR_TYPE    = 'string',\n        MAJOR       = 'major',\n        MODEL       = 'model',\n        NAME        = 'name',\n        TYPE        = 'type',\n        VENDOR      = 'vendor',\n        VERSION     = 'version',\n        ARCHITECTURE= 'architecture',\n        CONSOLE     = 'console',\n        MOBILE      = 'mobile',\n        TABLET      = 'tablet',\n        SMARTTV     = 'smarttv',\n        WEARABLE    = 'wearable',\n        EMBEDDED    = 'embedded',\n        UA_MAX_LENGTH = 350;\n\n    var AMAZON  = 'Amazon',\n        APPLE   = 'Apple',\n        ASUS    = 'ASUS',\n        BLACKBERRY = 'BlackBerry',\n        BROWSER = 'Browser',\n        CHROME  = 'Chrome',\n        EDGE    = 'Edge',\n        FIREFOX = 'Firefox',\n        GOOGLE  = 'Google',\n        HUAWEI  = 'Huawei',\n        LG      = 'LG',\n        MICROSOFT = 'Microsoft',\n        MOTOROLA  = 'Motorola',\n        OPERA   = 'Opera',\n        SAMSUNG = 'Samsung',\n        SHARP   = 'Sharp',\n        SONY    = 'Sony',\n        VIERA   = 'Viera',\n        XIAOMI  = 'Xiaomi',\n        ZEBRA   = 'Zebra',\n        FACEBOOK    = 'Facebook',\n        CHROMIUM_OS = 'Chromium OS',\n        MAC_OS  = 'Mac OS';\n\n    ///////////\n    // Helper\n    //////////\n\n    var extend = function (regexes, extensions) {\n            var mergedRegexes = {};\n            for (var i in regexes) {\n                if (extensions[i] && extensions[i].length % 2 === 0) {\n                    mergedRegexes[i] = extensions[i].concat(regexes[i]);\n                } else {\n                    mergedRegexes[i] = regexes[i];\n                }\n            }\n            return mergedRegexes;\n        },\n        enumerize = function (arr) {\n            var enums = {};\n            for (var i=0; i<arr.length; i++) {\n                enums[arr[i].toUpperCase()] = arr[i];\n            }\n            return enums;\n        },\n        has = function (str1, str2) {\n            return typeof str1 === STR_TYPE ? lowerize(str2).indexOf(lowerize(str1)) !== -1 : false;\n        },\n        lowerize = function (str) {\n            return str.toLowerCase();\n        },\n        majorize = function (version) {\n            return typeof(version) === STR_TYPE ? version.replace(/[^\\d\\.]/g, EMPTY).split('.')[0] : undefined;\n        },\n        trim = function (str, len) {\n            if (typeof(str) === STR_TYPE) {\n                str = str.replace(/^\\s\\s*/, EMPTY);\n                return typeof(len) === UNDEF_TYPE ? str : str.substring(0, UA_MAX_LENGTH);\n            }\n    };\n\n    ///////////////\n    // Map helper\n    //////////////\n\n    var rgxMapper = function (ua, arrays) {\n\n            var i = 0, j, k, p, q, matches, match;\n\n            // loop through all regexes maps\n            while (i < arrays.length && !matches) {\n\n                var regex = arrays[i],       // even sequence (0,2,4,..)\n                    props = arrays[i + 1];   // odd sequence (1,3,5,..)\n                j = k = 0;\n\n                // try matching uastring with regexes\n                while (j < regex.length && !matches) {\n\n                    if (!regex[j]) { break; }\n                    matches = regex[j++].exec(ua);\n\n                    if (!!matches) {\n                        for (p = 0; p < props.length; p++) {\n                            match = matches[++k];\n                            q = props[p];\n                            // check if given property is actually array\n                            if (typeof q === OBJ_TYPE && q.length > 0) {\n                                if (q.length === 2) {\n                                    if (typeof q[1] == FUNC_TYPE) {\n                                        // assign modified match\n                                        this[q[0]] = q[1].call(this, match);\n                                    } else {\n                                        // assign given value, ignore regex match\n                                        this[q[0]] = q[1];\n                                    }\n                                } else if (q.length === 3) {\n                                    // check whether function or regex\n                                    if (typeof q[1] === FUNC_TYPE && !(q[1].exec && q[1].test)) {\n                                        // call function (usually string mapper)\n                                        this[q[0]] = match ? q[1].call(this, match, q[2]) : undefined;\n                                    } else {\n                                        // sanitize match using given regex\n                                        this[q[0]] = match ? match.replace(q[1], q[2]) : undefined;\n                                    }\n                                } else if (q.length === 4) {\n                                        this[q[0]] = match ? q[3].call(this, match.replace(q[1], q[2])) : undefined;\n                                }\n                            } else {\n                                this[q] = match ? match : undefined;\n                            }\n                        }\n                    }\n                }\n                i += 2;\n            }\n        },\n\n        strMapper = function (str, map) {\n\n            for (var i in map) {\n                // check if current value is array\n                if (typeof map[i] === OBJ_TYPE && map[i].length > 0) {\n                    for (var j = 0; j < map[i].length; j++) {\n                        if (has(map[i][j], str)) {\n                            return (i === UNKNOWN) ? undefined : i;\n                        }\n                    }\n                } else if (has(map[i], str)) {\n                    return (i === UNKNOWN) ? undefined : i;\n                }\n            }\n            return str;\n    };\n\n    ///////////////\n    // String map\n    //////////////\n\n    // Safari < 3.0\n    var oldSafariMap = {\n            '1.0'   : '/8',\n            '1.2'   : '/1',\n            '1.3'   : '/3',\n            '2.0'   : '/412',\n            '2.0.2' : '/416',\n            '2.0.3' : '/417',\n            '2.0.4' : '/419',\n            '?'     : '/'\n        },\n        windowsVersionMap = {\n            'ME'        : '4.90',\n            'NT 3.11'   : 'NT3.51',\n            'NT 4.0'    : 'NT4.0',\n            '2000'      : 'NT 5.0',\n            'XP'        : ['NT 5.1', 'NT 5.2'],\n            'Vista'     : 'NT 6.0',\n            '7'         : 'NT 6.1',\n            '8'         : 'NT 6.2',\n            '8.1'       : 'NT 6.3',\n            '10'        : ['NT 6.4', 'NT 10.0'],\n            'RT'        : 'ARM'\n    };\n\n    //////////////\n    // Regex map\n    /////////////\n\n    var regexes = {\n\n        browser : [[\n\n            /\\b(?:crmo|crios)\\/([\\w\\.]+)/i                                      // Chrome for Android/iOS\n            ], [VERSION, [NAME, 'Chrome']], [\n            /edg(?:e|ios|a)?\\/([\\w\\.]+)/i                                       // Microsoft Edge\n            ], [VERSION, [NAME, 'Edge']], [\n\n            // Presto based\n            /(opera mini)\\/([-\\w\\.]+)/i,                                        // Opera Mini\n            /(opera [mobiletab]{3,6})\\b.+version\\/([-\\w\\.]+)/i,                 // Opera Mobi/Tablet\n            /(opera)(?:.+version\\/|[\\/ ]+)([\\w\\.]+)/i                           // Opera\n            ], [NAME, VERSION], [\n            /opios[\\/ ]+([\\w\\.]+)/i                                             // Opera mini on iphone >= 8.0\n            ], [VERSION, [NAME, OPERA+' Mini']], [\n            /\\bopr\\/([\\w\\.]+)/i                                                 // Opera Webkit\n            ], [VERSION, [NAME, OPERA]], [\n\n            // Mixed\n            /(kindle)\\/([\\w\\.]+)/i,                                             // Kindle\n            /(lunascape|maxthon|netfront|jasmine|blazer)[\\/ ]?([\\w\\.]*)/i,      // Lunascape/Maxthon/Netfront/Jasmine/Blazer\n            // Trident based\n            /(avant |iemobile|slim)(?:browser)?[\\/ ]?([\\w\\.]*)/i,               // Avant/IEMobile/SlimBrowser\n            /(ba?idubrowser)[\\/ ]?([\\w\\.]+)/i,                                  // Baidu Browser\n            /(?:ms|\\()(ie) ([\\w\\.]+)/i,                                         // Internet Explorer\n\n            // Webkit/KHTML based                                               // Flock/RockMelt/Midori/Epiphany/Silk/Skyfire/Bolt/Iron/Iridium/PhantomJS/Bowser/QupZilla/Falkon\n            /(flock|rockmelt|midori|epiphany|silk|skyfire|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\\/([-\\w\\.]+)/i,\n                                                                                // Rekonq/Puffin/Brave/Whale/QQBrowserLite/QQ, aka ShouQ\n            /(heytap|ovi)browser\\/([\\d\\.]+)/i,                                  // Heytap/Ovi\n            /(weibo)__([\\d\\.]+)/i                                               // Weibo\n            ], [NAME, VERSION], [\n            /(?:\\buc? ?browser|(?:juc.+)ucweb)[\\/ ]?([\\w\\.]+)/i                 // UCBrowser\n            ], [VERSION, [NAME, 'UC'+BROWSER]], [\n            /microm.+\\bqbcore\\/([\\w\\.]+)/i,                                     // WeChat Desktop for Windows Built-in Browser\n            /\\bqbcore\\/([\\w\\.]+).+microm/i\n            ], [VERSION, [NAME, 'WeChat(Win) Desktop']], [\n            /micromessenger\\/([\\w\\.]+)/i                                        // WeChat\n            ], [VERSION, [NAME, 'WeChat']], [\n            /konqueror\\/([\\w\\.]+)/i                                             // Konqueror\n            ], [VERSION, [NAME, 'Konqueror']], [\n            /trident.+rv[: ]([\\w\\.]{1,9})\\b.+like gecko/i                       // IE11\n            ], [VERSION, [NAME, 'IE']], [\n            /ya(?:search)?browser\\/([\\w\\.]+)/i                                  // Yandex\n            ], [VERSION, [NAME, 'Yandex']], [\n            /(avast|avg)\\/([\\w\\.]+)/i                                           // Avast/AVG Secure Browser\n            ], [[NAME, /(.+)/, '$1 Secure '+BROWSER], VERSION], [\n            /\\bfocus\\/([\\w\\.]+)/i                                               // Firefox Focus\n            ], [VERSION, [NAME, FIREFOX+' Focus']], [\n            /\\bopt\\/([\\w\\.]+)/i                                                 // Opera Touch\n            ], [VERSION, [NAME, OPERA+' Touch']], [\n            /coc_coc\\w+\\/([\\w\\.]+)/i                                            // Coc Coc Browser\n            ], [VERSION, [NAME, 'Coc Coc']], [\n            /dolfin\\/([\\w\\.]+)/i                                                // Dolphin\n            ], [VERSION, [NAME, 'Dolphin']], [\n            /coast\\/([\\w\\.]+)/i                                                 // Opera Coast\n            ], [VERSION, [NAME, OPERA+' Coast']], [\n            /miuibrowser\\/([\\w\\.]+)/i                                           // MIUI Browser\n            ], [VERSION, [NAME, 'MIUI '+BROWSER]], [\n            /fxios\\/([-\\w\\.]+)/i                                                // Firefox for iOS\n            ], [VERSION, [NAME, FIREFOX]], [\n            /\\bqihu|(qi?ho?o?|360)browser/i                                     // 360\n            ], [[NAME, '360 '+BROWSER]], [\n            /(oculus|samsung|sailfish|huawei)browser\\/([\\w\\.]+)/i\n            ], [[NAME, /(.+)/, '$1 '+BROWSER], VERSION], [                      // Oculus/Samsung/Sailfish/Huawei Browser\n            /(comodo_dragon)\\/([\\w\\.]+)/i                                       // Comodo Dragon\n            ], [[NAME, /_/g, ' '], VERSION], [\n            /(electron)\\/([\\w\\.]+) safari/i,                                    // Electron-based App\n            /(tesla)(?: qtcarbrowser|\\/(20\\d\\d\\.[-\\w\\.]+))/i,                   // Tesla\n            /m?(qqbrowser|baiduboxapp|2345Explorer)[\\/ ]?([\\w\\.]+)/i            // QQBrowser/Baidu App/2345 Browser\n            ], [NAME, VERSION], [\n            /(metasr)[\\/ ]?([\\w\\.]+)/i,                                         // SouGouBrowser\n            /(lbbrowser)/i,                                                     // LieBao Browser\n            /\\[(linkedin)app\\]/i                                                // LinkedIn App for iOS & Android\n            ], [NAME], [\n\n            // WebView\n            /((?:fban\\/fbios|fb_iab\\/fb4a)(?!.+fbav)|;fbav\\/([\\w\\.]+);)/i       // Facebook App for iOS & Android\n            ], [[NAME, FACEBOOK], VERSION], [\n            /(kakao(?:talk|story))[\\/ ]([\\w\\.]+)/i,                             // Kakao App\n            /(naver)\\(.*?(\\d+\\.[\\w\\.]+).*\\)/i,                                  // Naver InApp\n            /safari (line)\\/([\\w\\.]+)/i,                                        // Line App for iOS\n            /\\b(line)\\/([\\w\\.]+)\\/iab/i,                                        // Line App for Android\n            /(chromium|instagram)[\\/ ]([-\\w\\.]+)/i                              // Chromium/Instagram\n            ], [NAME, VERSION], [\n            /\\bgsa\\/([\\w\\.]+) .*safari\\//i                                      // Google Search Appliance on iOS\n            ], [VERSION, [NAME, 'GSA']], [\n            /musical_ly(?:.+app_?version\\/|_)([\\w\\.]+)/i                        // TikTok\n            ], [VERSION, [NAME, 'TikTok']], [\n\n            /headlesschrome(?:\\/([\\w\\.]+)| )/i                                  // Chrome Headless\n            ], [VERSION, [NAME, CHROME+' Headless']], [\n\n            / wv\\).+(chrome)\\/([\\w\\.]+)/i                                       // Chrome WebView\n            ], [[NAME, CHROME+' WebView'], VERSION], [\n\n            /droid.+ version\\/([\\w\\.]+)\\b.+(?:mobile safari|safari)/i           // Android Browser\n            ], [VERSION, [NAME, 'Android '+BROWSER]], [\n\n            /(chrome|omniweb|arora|[tizenoka]{5} ?browser)\\/v?([\\w\\.]+)/i       // Chrome/OmniWeb/Arora/Tizen/Nokia\n            ], [NAME, VERSION], [\n\n            /version\\/([\\w\\.\\,]+) .*mobile\\/\\w+ (safari)/i                      // Mobile Safari\n            ], [VERSION, [NAME, 'Mobile Safari']], [\n            /version\\/([\\w(\\.|\\,)]+) .*(mobile ?safari|safari)/i                // Safari & Safari Mobile\n            ], [VERSION, NAME], [\n            /webkit.+?(mobile ?safari|safari)(\\/[\\w\\.]+)/i                      // Safari < 3.0\n            ], [NAME, [VERSION, strMapper, oldSafariMap]], [\n\n            /(webkit|khtml)\\/([\\w\\.]+)/i\n            ], [NAME, VERSION], [\n\n            // Gecko based\n            /(navigator|netscape\\d?)\\/([-\\w\\.]+)/i                              // Netscape\n            ], [[NAME, 'Netscape'], VERSION], [\n            /mobile vr; rv:([\\w\\.]+)\\).+firefox/i                               // Firefox Reality\n            ], [VERSION, [NAME, FIREFOX+' Reality']], [\n            /ekiohf.+(flow)\\/([\\w\\.]+)/i,                                       // Flow\n            /(swiftfox)/i,                                                      // Swiftfox\n            /(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\\/ ]?([\\w\\.\\+]+)/i,\n                                                                                // IceDragon/Iceweasel/Camino/Chimera/Fennec/Maemo/Minimo/Conkeror/Klar\n            /(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\\/([-\\w\\.]+)$/i,\n                                                                                // Firefox/SeaMonkey/K-Meleon/IceCat/IceApe/Firebird/Phoenix\n            /(firefox)\\/([\\w\\.]+)/i,                                            // Other Firefox-based\n            /(mozilla)\\/([\\w\\.]+) .+rv\\:.+gecko\\/\\d+/i,                         // Mozilla\n\n            // Other\n            /(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\\. ]?browser)[-\\/ ]?v?([\\w\\.]+)/i,\n                                                                                // Polaris/Lynx/Dillo/iCab/Doris/Amaya/w3m/NetSurf/Sleipnir/Obigo/Mosaic/Go/ICE/UP.Browser\n            /(links) \\(([\\w\\.]+)/i,                                             // Links\n            /panasonic;(viera)/i                                                // Panasonic Viera\n            ], [NAME, VERSION], [\n            \n            /(cobalt)\\/([\\w\\.]+)/i                                              // Cobalt\n            ], [NAME, [VERSION, /master.|lts./, \"\"]]\n        ],\n\n        cpu : [[\n\n            /(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\\)]/i                     // AMD64 (x64)\n            ], [[ARCHITECTURE, 'amd64']], [\n\n            /(ia32(?=;))/i                                                      // IA32 (quicktime)\n            ], [[ARCHITECTURE, lowerize]], [\n\n            /((?:i[346]|x)86)[;\\)]/i                                            // IA32 (x86)\n            ], [[ARCHITECTURE, 'ia32']], [\n\n            /\\b(aarch64|arm(v?8e?l?|_?64))\\b/i                                 // ARM64\n            ], [[ARCHITECTURE, 'arm64']], [\n\n            /\\b(arm(?:v[67])?ht?n?[fl]p?)\\b/i                                   // ARMHF\n            ], [[ARCHITECTURE, 'armhf']], [\n\n            // PocketPC mistakenly identified as PowerPC\n            /windows (ce|mobile); ppc;/i\n            ], [[ARCHITECTURE, 'arm']], [\n\n            /((?:ppc|powerpc)(?:64)?)(?: mac|;|\\))/i                            // PowerPC\n            ], [[ARCHITECTURE, /ower/, EMPTY, lowerize]], [\n\n            /(sun4\\w)[;\\)]/i                                                    // SPARC\n            ], [[ARCHITECTURE, 'sparc']], [\n\n            /((?:avr32|ia64(?=;))|68k(?=\\))|\\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\\b|pa-risc)/i\n                                                                                // IA64, 68K, ARM/64, AVR/32, IRIX/64, MIPS/64, SPARC/64, PA-RISC\n            ], [[ARCHITECTURE, lowerize]]\n        ],\n\n        device : [[\n\n            //////////////////////////\n            // MOBILES & TABLETS\n            /////////////////////////\n\n            // Samsung\n            /\\b(sch-i[89]0\\d|shw-m380s|sm-[ptx]\\w{2,4}|gt-[pn]\\d{2,4}|sgh-t8[56]9|nexus 10)/i\n            ], [MODEL, [VENDOR, SAMSUNG], [TYPE, TABLET]], [\n            /\\b((?:s[cgp]h|gt|sm)-\\w+|sc[g-]?[\\d]+a?|galaxy nexus)/i,\n            /samsung[- ]([-\\w]+)/i,\n            /sec-(sgh\\w+)/i\n            ], [MODEL, [VENDOR, SAMSUNG], [TYPE, MOBILE]], [\n\n            // Apple\n            /(?:\\/|\\()(ip(?:hone|od)[\\w, ]*)(?:\\/|;)/i                          // iPod/iPhone\n            ], [MODEL, [VENDOR, APPLE], [TYPE, MOBILE]], [\n            /\\((ipad);[-\\w\\),; ]+apple/i,                                       // iPad\n            /applecoremedia\\/[\\w\\.]+ \\((ipad)/i,\n            /\\b(ipad)\\d\\d?,\\d\\d?[;\\]].+ios/i\n            ], [MODEL, [VENDOR, APPLE], [TYPE, TABLET]], [\n            /(macintosh);/i\n            ], [MODEL, [VENDOR, APPLE]], [\n\n            // Sharp\n            /\\b(sh-?[altvz]?\\d\\d[a-ekm]?)/i\n            ], [MODEL, [VENDOR, SHARP], [TYPE, MOBILE]], [\n\n            // Huawei\n            /\\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\\d{2})\\b(?!.+d\\/s)/i\n            ], [MODEL, [VENDOR, HUAWEI], [TYPE, TABLET]], [\n            /(?:huawei|honor)([-\\w ]+)[;\\)]/i,\n            /\\b(nexus 6p|\\w{2,4}e?-[atu]?[ln][\\dx][012359c][adn]?)\\b(?!.+d\\/s)/i\n            ], [MODEL, [VENDOR, HUAWEI], [TYPE, MOBILE]], [\n\n            // Xiaomi\n            /\\b(poco[\\w ]+)(?: bui|\\))/i,                                       // Xiaomi POCO\n            /\\b; (\\w+) build\\/hm\\1/i,                                           // Xiaomi Hongmi 'numeric' models\n            /\\b(hm[-_ ]?note?[_ ]?(?:\\d\\w)?) bui/i,                             // Xiaomi Hongmi\n            /\\b(redmi[\\-_ ]?(?:note|k)?[\\w_ ]+)(?: bui|\\))/i,                   // Xiaomi Redmi\n            /\\b(mi[-_ ]?(?:a\\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\\d?\\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\\))/i // Xiaomi Mi\n            ], [[MODEL, /_/g, ' '], [VENDOR, XIAOMI], [TYPE, MOBILE]], [\n            /\\b(mi[-_ ]?(?:pad)(?:[\\w_ ]+))(?: bui|\\))/i                        // Mi Pad tablets\n            ],[[MODEL, /_/g, ' '], [VENDOR, XIAOMI], [TYPE, TABLET]], [\n\n            // OPPO\n            /; (\\w+) bui.+ oppo/i,\n            /\\b(cph[12]\\d{3}|p(?:af|c[al]|d\\w|e[ar])[mt]\\d0|x9007|a101op)\\b/i\n            ], [MODEL, [VENDOR, 'OPPO'], [TYPE, MOBILE]], [\n\n            // Vivo\n            /vivo (\\w+)(?: bui|\\))/i,\n            /\\b(v[12]\\d{3}\\w?[at])(?: bui|;)/i\n            ], [MODEL, [VENDOR, 'Vivo'], [TYPE, MOBILE]], [\n\n            // Realme\n            /\\b(rmx[12]\\d{3})(?: bui|;|\\))/i\n            ], [MODEL, [VENDOR, 'Realme'], [TYPE, MOBILE]], [\n\n            // Motorola\n            /\\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\\b[\\w ]+build\\//i,\n            /\\bmot(?:orola)?[- ](\\w*)/i,\n            /((?:moto[\\w\\(\\) ]+|xt\\d{3,4}|nexus 6)(?= bui|\\)))/i\n            ], [MODEL, [VENDOR, MOTOROLA], [TYPE, MOBILE]], [\n            /\\b(mz60\\d|xoom[2 ]{0,2}) build\\//i\n            ], [MODEL, [VENDOR, MOTOROLA], [TYPE, TABLET]], [\n\n            // LG\n            /((?=lg)?[vl]k\\-?\\d{3}) bui| 3\\.[-\\w; ]{10}lg?-([06cv9]{3,4})/i\n            ], [MODEL, [VENDOR, LG], [TYPE, TABLET]], [\n            /(lm(?:-?f100[nv]?|-[\\w\\.]+)(?= bui|\\))|nexus [45])/i,\n            /\\blg[-e;\\/ ]+((?!browser|netcast|android tv)\\w+)/i,\n            /\\blg-?([\\d\\w]+) bui/i\n            ], [MODEL, [VENDOR, LG], [TYPE, MOBILE]], [\n\n            // Lenovo\n            /(ideatab[-\\w ]+)/i,\n            /lenovo ?(s[56]000[-\\w]+|tab(?:[\\w ]+)|yt[-\\d\\w]{6}|tb[-\\d\\w]{6})/i\n            ], [MODEL, [VENDOR, 'Lenovo'], [TYPE, TABLET]], [\n\n            // Nokia\n            /(?:maemo|nokia).*(n900|lumia \\d+)/i,\n            /nokia[-_ ]?([-\\w\\.]*)/i\n            ], [[MODEL, /_/g, ' '], [VENDOR, 'Nokia'], [TYPE, MOBILE]], [\n\n            // Google\n            /(pixel c)\\b/i                                                      // Google Pixel C\n            ], [MODEL, [VENDOR, GOOGLE], [TYPE, TABLET]], [\n            /droid.+; (pixel[\\daxl ]{0,6})(?: bui|\\))/i                         // Google Pixel\n            ], [MODEL, [VENDOR, GOOGLE], [TYPE, MOBILE]], [\n\n            // Sony\n            /droid.+ (a?\\d[0-2]{2}so|[c-g]\\d{4}|so[-gl]\\w+|xq-a\\w[4-7][12])(?= bui|\\).+chrome\\/(?![1-6]{0,1}\\d\\.))/i\n            ], [MODEL, [VENDOR, SONY], [TYPE, MOBILE]], [\n            /sony tablet [ps]/i,\n            /\\b(?:sony)?sgp\\w+(?: bui|\\))/i\n            ], [[MODEL, 'Xperia Tablet'], [VENDOR, SONY], [TYPE, TABLET]], [\n\n            // OnePlus\n            / (kb2005|in20[12]5|be20[12][59])\\b/i,\n            /(?:one)?(?:plus)? (a\\d0\\d\\d)(?: b|\\))/i\n            ], [MODEL, [VENDOR, 'OnePlus'], [TYPE, MOBILE]], [\n\n            // Amazon\n            /(alexa)webm/i,\n            /(kf[a-z]{2}wi|aeo[c-r]{2})( bui|\\))/i,                             // Kindle Fire without Silk / Echo Show\n            /(kf[a-z]+)( bui|\\)).+silk\\//i                                      // Kindle Fire HD\n            ], [MODEL, [VENDOR, AMAZON], [TYPE, TABLET]], [\n            /((?:sd|kf)[0349hijorstuw]+)( bui|\\)).+silk\\//i                     // Fire Phone\n            ], [[MODEL, /(.+)/g, 'Fire Phone $1'], [VENDOR, AMAZON], [TYPE, MOBILE]], [\n\n            // BlackBerry\n            /(playbook);[-\\w\\),; ]+(rim)/i                                      // BlackBerry PlayBook\n            ], [MODEL, VENDOR, [TYPE, TABLET]], [\n            /\\b((?:bb[a-f]|st[hv])100-\\d)/i,\n            /\\(bb10; (\\w+)/i                                                    // BlackBerry 10\n            ], [MODEL, [VENDOR, BLACKBERRY], [TYPE, MOBILE]], [\n\n            // Asus\n            /(?:\\b|asus_)(transfo[prime ]{4,10} \\w+|eeepc|slider \\w+|nexus 7|padfone|p00[cj])/i\n            ], [MODEL, [VENDOR, ASUS], [TYPE, TABLET]], [\n            / (z[bes]6[027][012][km][ls]|zenfone \\d\\w?)\\b/i\n            ], [MODEL, [VENDOR, ASUS], [TYPE, MOBILE]], [\n\n            // HTC\n            /(nexus 9)/i                                                        // HTC Nexus 9\n            ], [MODEL, [VENDOR, 'HTC'], [TYPE, TABLET]], [\n            /(htc)[-;_ ]{1,2}([\\w ]+(?=\\)| bui)|\\w+)/i,                         // HTC\n\n            // ZTE\n            /(zte)[- ]([\\w ]+?)(?: bui|\\/|\\))/i,\n            /(alcatel|geeksphone|nexian|panasonic(?!(?:;|\\.))|sony(?!-bra))[-_ ]?([-\\w]*)/i         // Alcatel/GeeksPhone/Nexian/Panasonic/Sony\n            ], [VENDOR, [MODEL, /_/g, ' '], [TYPE, MOBILE]], [\n\n            // Acer\n            /droid.+; ([ab][1-7]-?[0178a]\\d\\d?)/i\n            ], [MODEL, [VENDOR, 'Acer'], [TYPE, TABLET]], [\n\n            // Meizu\n            /droid.+; (m[1-5] note) bui/i,\n            /\\bmz-([-\\w]{2,})/i\n            ], [MODEL, [VENDOR, 'Meizu'], [TYPE, MOBILE]], [\n\n            // MIXED\n            /(blackberry|benq|palm(?=\\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\\w]*)/i,\n                                                                                // BlackBerry/BenQ/Palm/Sony-Ericsson/Acer/Asus/Dell/Meizu/Motorola/Polytron\n            /(hp) ([\\w ]+\\w)/i,                                                 // HP iPAQ\n            /(asus)-?(\\w+)/i,                                                   // Asus\n            /(microsoft); (lumia[\\w ]+)/i,                                      // Microsoft Lumia\n            /(lenovo)[-_ ]?([-\\w]+)/i,                                          // Lenovo\n            /(jolla)/i,                                                         // Jolla\n            /(oppo) ?([\\w ]+) bui/i                                             // OPPO\n            ], [VENDOR, MODEL, [TYPE, MOBILE]], [\n\n            /(kobo)\\s(ereader|touch)/i,                                         // Kobo\n            /(archos) (gamepad2?)/i,                                            // Archos\n            /(hp).+(touchpad(?!.+tablet)|tablet)/i,                             // HP TouchPad\n            /(kindle)\\/([\\w\\.]+)/i,                                             // Kindle\n            /(nook)[\\w ]+build\\/(\\w+)/i,                                        // Nook\n            /(dell) (strea[kpr\\d ]*[\\dko])/i,                                   // Dell Streak\n            /(le[- ]+pan)[- ]+(\\w{1,9}) bui/i,                                  // Le Pan Tablets\n            /(trinity)[- ]*(t\\d{3}) bui/i,                                      // Trinity Tablets\n            /(gigaset)[- ]+(q\\w{1,9}) bui/i,                                    // Gigaset Tablets\n            /(vodafone) ([\\w ]+)(?:\\)| bui)/i                                   // Vodafone\n            ], [VENDOR, MODEL, [TYPE, TABLET]], [\n\n            /(surface duo)/i                                                    // Surface Duo\n            ], [MODEL, [VENDOR, MICROSOFT], [TYPE, TABLET]], [\n            /droid [\\d\\.]+; (fp\\du?)(?: b|\\))/i                                 // Fairphone\n            ], [MODEL, [VENDOR, 'Fairphone'], [TYPE, MOBILE]], [\n            /(u304aa)/i                                                         // AT&T\n            ], [MODEL, [VENDOR, 'AT&T'], [TYPE, MOBILE]], [\n            /\\bsie-(\\w*)/i                                                      // Siemens\n            ], [MODEL, [VENDOR, 'Siemens'], [TYPE, MOBILE]], [\n            /\\b(rct\\w+) b/i                                                     // RCA Tablets\n            ], [MODEL, [VENDOR, 'RCA'], [TYPE, TABLET]], [\n            /\\b(venue[\\d ]{2,7}) b/i                                            // Dell Venue Tablets\n            ], [MODEL, [VENDOR, 'Dell'], [TYPE, TABLET]], [\n            /\\b(q(?:mv|ta)\\w+) b/i                                              // Verizon Tablet\n            ], [MODEL, [VENDOR, 'Verizon'], [TYPE, TABLET]], [\n            /\\b(?:barnes[& ]+noble |bn[rt])([\\w\\+ ]*) b/i                       // Barnes & Noble Tablet\n            ], [MODEL, [VENDOR, 'Barnes & Noble'], [TYPE, TABLET]], [\n            /\\b(tm\\d{3}\\w+) b/i\n            ], [MODEL, [VENDOR, 'NuVision'], [TYPE, TABLET]], [\n            /\\b(k88) b/i                                                        // ZTE K Series Tablet\n            ], [MODEL, [VENDOR, 'ZTE'], [TYPE, TABLET]], [\n            /\\b(nx\\d{3}j) b/i                                                   // ZTE Nubia\n            ], [MODEL, [VENDOR, 'ZTE'], [TYPE, MOBILE]], [\n            /\\b(gen\\d{3}) b.+49h/i                                              // Swiss GEN Mobile\n            ], [MODEL, [VENDOR, 'Swiss'], [TYPE, MOBILE]], [\n            /\\b(zur\\d{3}) b/i                                                   // Swiss ZUR Tablet\n            ], [MODEL, [VENDOR, 'Swiss'], [TYPE, TABLET]], [\n            /\\b((zeki)?tb.*\\b) b/i                                              // Zeki Tablets\n            ], [MODEL, [VENDOR, 'Zeki'], [TYPE, TABLET]], [\n            /\\b([yr]\\d{2}) b/i,\n            /\\b(dragon[- ]+touch |dt)(\\w{5}) b/i                                // Dragon Touch Tablet\n            ], [[VENDOR, 'Dragon Touch'], MODEL, [TYPE, TABLET]], [\n            /\\b(ns-?\\w{0,9}) b/i                                                // Insignia Tablets\n            ], [MODEL, [VENDOR, 'Insignia'], [TYPE, TABLET]], [\n            /\\b((nxa|next)-?\\w{0,9}) b/i                                        // NextBook Tablets\n            ], [MODEL, [VENDOR, 'NextBook'], [TYPE, TABLET]], [\n            /\\b(xtreme\\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i                  // Voice Xtreme Phones\n            ], [[VENDOR, 'Voice'], MODEL, [TYPE, MOBILE]], [\n            /\\b(lvtel\\-)?(v1[12]) b/i                                           // LvTel Phones\n            ], [[VENDOR, 'LvTel'], MODEL, [TYPE, MOBILE]], [\n            /\\b(ph-1) /i                                                        // Essential PH-1\n            ], [MODEL, [VENDOR, 'Essential'], [TYPE, MOBILE]], [\n            /\\b(v(100md|700na|7011|917g).*\\b) b/i                               // Envizen Tablets\n            ], [MODEL, [VENDOR, 'Envizen'], [TYPE, TABLET]], [\n            /\\b(trio[-\\w\\. ]+) b/i                                              // MachSpeed Tablets\n            ], [MODEL, [VENDOR, 'MachSpeed'], [TYPE, TABLET]], [\n            /\\btu_(1491) b/i                                                    // Rotor Tablets\n            ], [MODEL, [VENDOR, 'Rotor'], [TYPE, TABLET]], [\n            /(shield[\\w ]+) b/i                                                 // Nvidia Shield Tablets\n            ], [MODEL, [VENDOR, 'Nvidia'], [TYPE, TABLET]], [\n            /(sprint) (\\w+)/i                                                   // Sprint Phones\n            ], [VENDOR, MODEL, [TYPE, MOBILE]], [\n            /(kin\\.[onetw]{3})/i                                                // Microsoft Kin\n            ], [[MODEL, /\\./g, ' '], [VENDOR, MICROSOFT], [TYPE, MOBILE]], [\n            /droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\\)/i             // Zebra\n            ], [MODEL, [VENDOR, ZEBRA], [TYPE, TABLET]], [\n            /droid.+; (ec30|ps20|tc[2-8]\\d[kx])\\)/i\n            ], [MODEL, [VENDOR, ZEBRA], [TYPE, MOBILE]], [\n\n            ///////////////////\n            // SMARTTVS\n            ///////////////////\n\n            /smart-tv.+(samsung)/i                                              // Samsung\n            ], [VENDOR, [TYPE, SMARTTV]], [\n            /hbbtv.+maple;(\\d+)/i\n            ], [[MODEL, /^/, 'SmartTV'], [VENDOR, SAMSUNG], [TYPE, SMARTTV]], [\n            /(nux; netcast.+smarttv|lg (netcast\\.tv-201\\d|android tv))/i        // LG SmartTV\n            ], [[VENDOR, LG], [TYPE, SMARTTV]], [\n            /(apple) ?tv/i                                                      // Apple TV\n            ], [VENDOR, [MODEL, APPLE+' TV'], [TYPE, SMARTTV]], [\n            /crkey/i                                                            // Google Chromecast\n            ], [[MODEL, CHROME+'cast'], [VENDOR, GOOGLE], [TYPE, SMARTTV]], [\n            /droid.+aft(\\w)( bui|\\))/i                                          // Fire TV\n            ], [MODEL, [VENDOR, AMAZON], [TYPE, SMARTTV]], [\n            /\\(dtv[\\);].+(aquos)/i,\n            /(aquos-tv[\\w ]+)\\)/i                                               // Sharp\n            ], [MODEL, [VENDOR, SHARP], [TYPE, SMARTTV]],[\n            /(bravia[\\w ]+)( bui|\\))/i                                              // Sony\n            ], [MODEL, [VENDOR, SONY], [TYPE, SMARTTV]], [\n            /(mitv-\\w{5}) bui/i                                                 // Xiaomi\n            ], [MODEL, [VENDOR, XIAOMI], [TYPE, SMARTTV]], [\n            /Hbbtv.*(technisat) (.*);/i                                         // TechniSAT\n            ], [VENDOR, MODEL, [TYPE, SMARTTV]], [\n            /\\b(roku)[\\dx]*[\\)\\/]((?:dvp-)?[\\d\\.]*)/i,                          // Roku\n            /hbbtv\\/\\d+\\.\\d+\\.\\d+ +\\([\\w\\+ ]*; *([\\w\\d][^;]*);([^;]*)/i         // HbbTV devices\n            ], [[VENDOR, trim], [MODEL, trim], [TYPE, SMARTTV]], [\n            /\\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\\b/i                   // SmartTV from Unidentified Vendors\n            ], [[TYPE, SMARTTV]], [\n\n            ///////////////////\n            // CONSOLES\n            ///////////////////\n\n            /(ouya)/i,                                                          // Ouya\n            /(nintendo) ([wids3utch]+)/i                                        // Nintendo\n            ], [VENDOR, MODEL, [TYPE, CONSOLE]], [\n            /droid.+; (shield) bui/i                                            // Nvidia\n            ], [MODEL, [VENDOR, 'Nvidia'], [TYPE, CONSOLE]], [\n            /(playstation [345portablevi]+)/i                                   // Playstation\n            ], [MODEL, [VENDOR, SONY], [TYPE, CONSOLE]], [\n            /\\b(xbox(?: one)?(?!; xbox))[\\); ]/i                                // Microsoft Xbox\n            ], [MODEL, [VENDOR, MICROSOFT], [TYPE, CONSOLE]], [\n\n            ///////////////////\n            // WEARABLES\n            ///////////////////\n\n            /((pebble))app/i                                                    // Pebble\n            ], [VENDOR, MODEL, [TYPE, WEARABLE]], [\n            /(watch)(?: ?os[,\\/]|\\d,\\d\\/)[\\d\\.]+/i                              // Apple Watch\n            ], [MODEL, [VENDOR, APPLE], [TYPE, WEARABLE]], [\n            /droid.+; (glass) \\d/i                                              // Google Glass\n            ], [MODEL, [VENDOR, GOOGLE], [TYPE, WEARABLE]], [\n            /droid.+; (wt63?0{2,3})\\)/i\n            ], [MODEL, [VENDOR, ZEBRA], [TYPE, WEARABLE]], [\n            /(quest( 2| pro)?)/i                                                // Oculus Quest\n            ], [MODEL, [VENDOR, FACEBOOK], [TYPE, WEARABLE]], [\n\n            ///////////////////\n            // EMBEDDED\n            ///////////////////\n\n            /(tesla)(?: qtcarbrowser|\\/[-\\w\\.]+)/i                              // Tesla\n            ], [VENDOR, [TYPE, EMBEDDED]], [\n            /(aeobc)\\b/i                                                        // Echo Dot\n            ], [MODEL, [VENDOR, AMAZON], [TYPE, EMBEDDED]], [\n\n            ////////////////////\n            // MIXED (GENERIC)\n            ///////////////////\n\n            /droid .+?; ([^;]+?)(?: bui|\\) applew).+? mobile safari/i           // Android Phones from Unidentified Vendors\n            ], [MODEL, [TYPE, MOBILE]], [\n            /droid .+?; ([^;]+?)(?: bui|\\) applew).+?(?! mobile) safari/i       // Android Tablets from Unidentified Vendors\n            ], [MODEL, [TYPE, TABLET]], [\n            /\\b((tablet|tab)[;\\/]|focus\\/\\d(?!.+mobile))/i                      // Unidentifiable Tablet\n            ], [[TYPE, TABLET]], [\n            /(phone|mobile(?:[;\\/]| [ \\w\\/\\.]*safari)|pda(?=.+windows ce))/i    // Unidentifiable Mobile\n            ], [[TYPE, MOBILE]], [\n            /(android[-\\w\\. ]{0,9});.+buil/i                                    // Generic Android Device\n            ], [MODEL, [VENDOR, 'Generic']]\n        ],\n\n        engine : [[\n\n            /windows.+ edge\\/([\\w\\.]+)/i                                       // EdgeHTML\n            ], [VERSION, [NAME, EDGE+'HTML']], [\n\n            /webkit\\/537\\.36.+chrome\\/(?!27)([\\w\\.]+)/i                         // Blink\n            ], [VERSION, [NAME, 'Blink']], [\n\n            /(presto)\\/([\\w\\.]+)/i,                                             // Presto\n            /(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\\/([\\w\\.]+)/i, // WebKit/Trident/NetFront/NetSurf/Amaya/Lynx/w3m/Goanna\n            /ekioh(flow)\\/([\\w\\.]+)/i,                                          // Flow\n            /(khtml|tasman|links)[\\/ ]\\(?([\\w\\.]+)/i,                           // KHTML/Tasman/Links\n            /(icab)[\\/ ]([23]\\.[\\d\\.]+)/i,                                      // iCab\n            /\\b(libweb)/i\n            ], [NAME, VERSION], [\n\n            /rv\\:([\\w\\.]{1,9})\\b.+(gecko)/i                                     // Gecko\n            ], [VERSION, NAME]\n        ],\n\n        os : [[\n\n            // Windows\n            /microsoft (windows) (vista|xp)/i                                   // Windows (iTunes)\n            ], [NAME, VERSION], [\n            /(windows) nt 6\\.2; (arm)/i,                                        // Windows RT\n            /(windows (?:phone(?: os)?|mobile))[\\/ ]?([\\d\\.\\w ]*)/i,            // Windows Phone\n            /(windows)[\\/ ]?([ntce\\d\\. ]+\\w)(?!.+xbox)/i\n            ], [NAME, [VERSION, strMapper, windowsVersionMap]], [\n            /(win(?=3|9|n)|win 9x )([nt\\d\\.]+)/i\n            ], [[NAME, 'Windows'], [VERSION, strMapper, windowsVersionMap]], [\n\n            // iOS/macOS\n            /ip[honead]{2,4}\\b(?:.*os ([\\w]+) like mac|; opera)/i,              // iOS\n            /ios;fbsv\\/([\\d\\.]+)/i,\n            /cfnetwork\\/.+darwin/i\n            ], [[VERSION, /_/g, '.'], [NAME, 'iOS']], [\n            /(mac os x) ?([\\w\\. ]*)/i,\n            /(macintosh|mac_powerpc\\b)(?!.+haiku)/i                             // Mac OS\n            ], [[NAME, MAC_OS], [VERSION, /_/g, '.']], [\n\n            // Mobile OSes\n            /droid ([\\w\\.]+)\\b.+(android[- ]x86|harmonyos)/i                    // Android-x86/HarmonyOS\n            ], [VERSION, NAME], [                                               // Android/WebOS/QNX/Bada/RIM/Maemo/MeeGo/Sailfish OS\n            /(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\\/ ]?([\\w\\.]*)/i,\n            /(blackberry)\\w*\\/([\\w\\.]*)/i,                                      // Blackberry\n            /(tizen|kaios)[\\/ ]([\\w\\.]+)/i,                                     // Tizen/KaiOS\n            /\\((series40);/i                                                    // Series 40\n            ], [NAME, VERSION], [\n            /\\(bb(10);/i                                                        // BlackBerry 10\n            ], [VERSION, [NAME, BLACKBERRY]], [\n            /(?:symbian ?os|symbos|s60(?=;)|series60)[-\\/ ]?([\\w\\.]*)/i         // Symbian\n            ], [VERSION, [NAME, 'Symbian']], [\n            /mozilla\\/[\\d\\.]+ \\((?:mobile|tablet|tv|mobile; [\\w ]+); rv:.+ gecko\\/([\\w\\.]+)/i // Firefox OS\n            ], [VERSION, [NAME, FIREFOX+' OS']], [\n            /web0s;.+rt(tv)/i,\n            /\\b(?:hp)?wos(?:browser)?\\/([\\w\\.]+)/i                              // WebOS\n            ], [VERSION, [NAME, 'webOS']], [\n            /watch(?: ?os[,\\/]|\\d,\\d\\/)([\\d\\.]+)/i                              // watchOS\n            ], [VERSION, [NAME, 'watchOS']], [\n\n            // Google Chromecast\n            /crkey\\/([\\d\\.]+)/i                                                 // Google Chromecast\n            ], [VERSION, [NAME, CHROME+'cast']], [\n            /(cros) [\\w]+(?:\\)| ([\\w\\.]+)\\b)/i                                  // Chromium OS\n            ], [[NAME, CHROMIUM_OS], VERSION],[\n\n            // Smart TVs\n            /panasonic;(viera)/i,                                               // Panasonic Viera\n            /(netrange)mmh/i,                                                   // Netrange\n            /(nettv)\\/(\\d+\\.[\\w\\.]+)/i,                                         // NetTV\n\n            // Console\n            /(nintendo|playstation) ([wids345portablevuch]+)/i,                 // Nintendo/Playstation\n            /(xbox); +xbox ([^\\);]+)/i,                                         // Microsoft Xbox (360, One, X, S, Series X, Series S)\n\n            // Other\n            /\\b(joli|palm)\\b ?(?:os)?\\/?([\\w\\.]*)/i,                            // Joli/Palm\n            /(mint)[\\/\\(\\) ]?(\\w*)/i,                                           // Mint\n            /(mageia|vectorlinux)[; ]/i,                                        // Mageia/VectorLinux\n            /([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\\/ ]?(?!chrom|package)([-\\w\\.]*)/i,\n                                                                                // Ubuntu/Debian/SUSE/Gentoo/Arch/Slackware/Fedora/Mandriva/CentOS/PCLinuxOS/RedHat/Zenwalk/Linpus/Raspbian/Plan9/Minix/RISCOS/Contiki/Deepin/Manjaro/elementary/Sabayon/Linspire\n            /(hurd|linux) ?([\\w\\.]*)/i,                                         // Hurd/Linux\n            /(gnu) ?([\\w\\.]*)/i,                                                // GNU\n            /\\b([-frentopcghs]{0,5}bsd|dragonfly)[\\/ ]?(?!amd|[ix346]{1,2}86)([\\w\\.]*)/i, // FreeBSD/NetBSD/OpenBSD/PC-BSD/GhostBSD/DragonFly\n            /(haiku) (\\w+)/i                                                    // Haiku\n            ], [NAME, VERSION], [\n            /(sunos) ?([\\w\\.\\d]*)/i                                             // Solaris\n            ], [[NAME, 'Solaris'], VERSION], [\n            /((?:open)?solaris)[-\\/ ]?([\\w\\.]*)/i,                              // Solaris\n            /(aix) ((\\d)(?=\\.|\\)| )[\\w\\.])*/i,                                  // AIX\n            /\\b(beos|os\\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i, // BeOS/OS2/AmigaOS/MorphOS/OpenVMS/Fuchsia/HP-UX/SerenityOS\n            /(unix) ?([\\w\\.]*)/i                                                // UNIX\n            ], [NAME, VERSION]\n        ]\n    };\n\n    /////////////////\n    // Constructor\n    ////////////////\n\n    var UAParser = function (ua, extensions) {\n\n        if (typeof ua === OBJ_TYPE) {\n            extensions = ua;\n            ua = undefined;\n        }\n\n        if (!(this instanceof UAParser)) {\n            return new UAParser(ua, extensions).getResult();\n        }\n\n        var _navigator = (typeof window !== UNDEF_TYPE && window.navigator) ? window.navigator : undefined;\n        var _ua = ua || ((_navigator && _navigator.userAgent) ? _navigator.userAgent : EMPTY);\n        var _uach = (_navigator && _navigator.userAgentData) ? _navigator.userAgentData : undefined;\n        var _rgxmap = extensions ? extend(regexes, extensions) : regexes;\n        var _isSelfNav = _navigator && _navigator.userAgent == _ua;\n\n        this.getBrowser = function () {\n            var _browser = {};\n            _browser[NAME] = undefined;\n            _browser[VERSION] = undefined;\n            rgxMapper.call(_browser, _ua, _rgxmap.browser);\n            _browser[MAJOR] = majorize(_browser[VERSION]);\n            // Brave-specific detection\n            if (_isSelfNav && _navigator && _navigator.brave && typeof _navigator.brave.isBrave == FUNC_TYPE) {\n                _browser[NAME] = 'Brave';\n            }\n            return _browser;\n        };\n        this.getCPU = function () {\n            var _cpu = {};\n            _cpu[ARCHITECTURE] = undefined;\n            rgxMapper.call(_cpu, _ua, _rgxmap.cpu);\n            return _cpu;\n        };\n        this.getDevice = function () {\n            var _device = {};\n            _device[VENDOR] = undefined;\n            _device[MODEL] = undefined;\n            _device[TYPE] = undefined;\n            rgxMapper.call(_device, _ua, _rgxmap.device);\n            if (_isSelfNav && !_device[TYPE] && _uach && _uach.mobile) {\n                _device[TYPE] = MOBILE;\n            }\n            // iPadOS-specific detection: identified as Mac, but has some iOS-only properties\n            if (_isSelfNav && _device[MODEL] == 'Macintosh' && _navigator && typeof _navigator.standalone !== UNDEF_TYPE && _navigator.maxTouchPoints && _navigator.maxTouchPoints > 2) {\n                _device[MODEL] = 'iPad';\n                _device[TYPE] = TABLET;\n            }\n            return _device;\n        };\n        this.getEngine = function () {\n            var _engine = {};\n            _engine[NAME] = undefined;\n            _engine[VERSION] = undefined;\n            rgxMapper.call(_engine, _ua, _rgxmap.engine);\n            return _engine;\n        };\n        this.getOS = function () {\n            var _os = {};\n            _os[NAME] = undefined;\n            _os[VERSION] = undefined;\n            rgxMapper.call(_os, _ua, _rgxmap.os);\n            if (_isSelfNav && !_os[NAME] && _uach && _uach.platform != 'Unknown') {\n                _os[NAME] = _uach.platform  \n                                    .replace(/chrome os/i, CHROMIUM_OS)\n                                    .replace(/macos/i, MAC_OS);           // backward compatibility\n            }\n            return _os;\n        };\n        this.getResult = function () {\n            return {\n                ua      : this.getUA(),\n                browser : this.getBrowser(),\n                engine  : this.getEngine(),\n                os      : this.getOS(),\n                device  : this.getDevice(),\n                cpu     : this.getCPU()\n            };\n        };\n        this.getUA = function () {\n            return _ua;\n        };\n        this.setUA = function (ua) {\n            _ua = (typeof ua === STR_TYPE && ua.length > UA_MAX_LENGTH) ? trim(ua, UA_MAX_LENGTH) : ua;\n            return this;\n        };\n        this.setUA(_ua);\n        return this;\n    };\n\n    UAParser.VERSION = LIBVERSION;\n    UAParser.BROWSER =  enumerize([NAME, VERSION, MAJOR]);\n    UAParser.CPU = enumerize([ARCHITECTURE]);\n    UAParser.DEVICE = enumerize([MODEL, VENDOR, TYPE, CONSOLE, MOBILE, SMARTTV, TABLET, WEARABLE, EMBEDDED]);\n    UAParser.ENGINE = UAParser.OS = enumerize([NAME, VERSION]);\n\n    ///////////\n    // Export\n    //////////\n\n    // check js environment\n    if (typeof(exports) !== UNDEF_TYPE) {\n        // nodejs env\n        if (typeof module !== UNDEF_TYPE && module.exports) {\n            exports = module.exports = UAParser;\n        }\n        exports.UAParser = UAParser;\n    } else {\n        // requirejs env (optional)\n        if (typeof(define) === FUNC_TYPE && define.amd) {\n            define(function () {\n                return UAParser;\n            });\n        } else if (typeof window !== UNDEF_TYPE) {\n            // browser env\n            window.UAParser = UAParser;\n        }\n    }\n\n    // jQuery/Zepto specific (optional)\n    // Note:\n    //   In AMD env the global scope should be kept clean, but jQuery is an exception.\n    //   jQuery always exports to global scope, unless jQuery.noConflict(true) is used,\n    //   and we should catch that.\n    var $ = typeof window !== UNDEF_TYPE && (window.jQuery || window.Zepto);\n    if ($ && !$.ua) {\n        var parser = new UAParser();\n        $.ua = parser.getResult();\n        $.ua.get = function () {\n            return parser.getUA();\n        };\n        $.ua.set = function (ua) {\n            parser.setUA(ua);\n            var result = parser.getResult();\n            for (var prop in result) {\n                $.ua[prop] = result[prop];\n            }\n        };\n    }\n\n})(typeof window === 'object' ? window : this);\n","/* Copyright @ 2016-present 8x8, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nvar Logger = require('./Logger.js');\n\n/**\n * Creates new <tt>LogCollector</tt>. Class implements <tt>LoggerTransport</tt>\n * and thus can be added as global transport in order to capture all the logs.\n *\n * It captures subsequent log lines created whenever <tt>Logger</tt> logs\n * a message and stores them in a queue in order to batch log entries. There are\n * time and size limit constraints which determine how often batch entries are\n * stored. Whenever one of these limits is exceeded the <tt>LogCollector</tt>\n * will use the <tt>logStorage</tt> object given as an argument to save\n * the batch log entry.\n *\n * @param {Object} logStorage an object which allows to store the logs collected\n * @param {function(string|object[])} logStorage.storeLogs a method called when\n * this <tt>LogCollector</tt> requests log entry storage. The method's argument\n * is an array which can contain <tt>string</tt>s and <tt>object</tt>s. If given\n * item is an object it means that it's an aggregated message. That is a message\n * which is the same as the previous one and it's representation has\n * the following format:\n * {\n *   {string} text: 'the text of some duplicated message'\n *   {number} count: 3 // how many times the message appeared in a row\n * }\n * If a message \"B\" after an aggregated message \"A\" is different, then it breaks\n * the sequence of \"A\". Which means that even if the next message \"C\" is\n * the same as \"A\" it will start a new aggregated message \"C\".\n * @param {function()} logStorage.isReady a method which should return\n * a <tt>boolean</tt> to tell the collector that it's ready to store. During the\n * time storage is not ready log batches will be cached and stored on the next\n * occasion (flush or interval timeout).\n *\n * @param {Object} options the <tt>LogCollector</tt> configuration options.\n * @param {number} options.maxEntryLength the size limit for a single log entry\n * to be stored. The <tt>LogCollector</tt> will push the entry as soon as it\n * reaches or exceeds this limit given that <tt>logStorage.isReady</tt>\n * returns <tt>true</tt>. Otherwise the log entry will be cached until the log\n * storage becomes ready. Note that the \"is ready\" condition is checked every\n * <tt>options.storeInterval</tt> milliseconds.\n * @param {number} options.storeInterval how often the logs should be stored in\n * case <tt>maxEntryLength</tt> was not exceeded.\n * @param {boolean} options.stringifyObjects indicates whether or not object\n * arguments should be \"stringified\" with <tt>JSON.stringify</tt> when a log\n * message is composed. Note that objects logged on the error log level are\n * always stringified.\n *\n * @constructor\n */\nfunction LogCollector(logStorage, options) {\n    this.logStorage = logStorage;\n    this.stringifyObjects = options && options.stringifyObjects ? options.stringifyObjects : false;\n    this.storeInterval = options && options.storeInterval ? options.storeInterval: 30000;\n    this.maxEntryLength = options && options.maxEntryLength ? options.maxEntryLength : 10000;\n    // Bind the log method for each level to the corresponding method name\n    // in order to implement \"global log transport\" object.\n    Object.values(Logger.levels).forEach(\n    function (logLevel) {\n        this[logLevel] = function () {\n            this._log.apply(this, arguments);\n        }.bind(this, logLevel);\n    }.bind(this));\n    /**\n     * The ID of store logs interval if one is currently scheduled or\n     * <tt>null</tt> otherwise.\n     * @type {number|null}\n     */\n    this.storeLogsIntervalID = null;\n    /**\n     * The log messages that are to be batched into log entry when\n     * {@link LogCollector._flush} method is called.\n     * @type {string[]}\n     */\n    this.queue = [];\n    /**\n     * The total length of all messages currently stored in the {@link queue}.\n     * @type {number}\n     */\n    this.totalLen = 0;\n    /**\n     * An array used to temporarily store log batches, before the storage gets\n     * ready.\n     * @type {string[]}\n     */\n    this.outputCache = [];\n}\n\n/**\n * Method called inside of {@link formatLogMessage} in order to covert an\n * <tt>Object</tt> argument to string. The conversion will happen when either\n * 'stringifyObjects' option is enabled or on the {@link Logger.levels.ERROR}\n * log level. The default implementation uses <tt>JSON.stringify</tt> and\n * returns \"[object with circular refs?]\" instead of an object if it fails.\n *\n * @param {object} someObject the <tt>object</tt> to be stringified.\n *\n * @return {string} the result of <tt>JSON.stringify</tt> or\n * \"[object with circular refs?]\" if any error occurs during \"stringification\".\n *\n * @protected\n */\nLogCollector.prototype.stringify = function (someObject) {\n    try {\n        return JSON.stringify(someObject);\n    } catch (error) {\n        return '[object with circular refs?]';\n    }\n};\n\n/**\n * Formats log entry for the given logging level and arguments passed to the\n * <tt>Logger</tt>'s log method. The first argument is log level and the next\n * arguments have to be captured using JS built-in 'arguments' variable.\n *\n * @param {Logger.levels} logLevel provides the logging level of the message to\n * be logged.\n * @param {Date} timestamp - The {@code Date} when a message has been logged.\n *\n * @return {string|null} a non-empty string representation of the log entry\n * crafted from the log arguments. If the return value is <tt>null</tt> then\n * the message wil be discarded by this <tt>LogCollector</tt>.\n *\n * @protected\n */\nLogCollector.prototype.formatLogMessage = function (\nlogLevel /* timestamp, arg2, arg3, arg4... */) { // jshint ignore:line\n    var msg = '';\n    for (var i = 1, len = arguments.length; i < len; i++) {\n        var arg = arguments[i];\n\n        if (arg instanceof Error) {\n            msg += arg.toString() + ': ' + arg.stack;\n        } else if (this.stringifyObjects && typeof arg === 'object') {\n        // NOTE: We were trying to stringify all error logs before but because of a bug that we were getting the keys\n        // of the log levels which are all with upper case and comparing it with the keys which are all lower case we\n        // were never actually strinfying the error logs. That's why I've removed the check for error logs here.\n        // NOTE: The non-enumerable properties of the objects wouldn't be included in the string after JSON.strigify.\n        // For example Map instance will be translated to '{}'. So I think we have to eventually do something better\n        // for parsing the arguments. But since this option for strigify is part of the public interface and I think\n        // it could be useful in some cases I will it for now.\n            msg += this.stringify(arg);\n        } else {\n            msg += arg;\n        }\n        if (i !== len - 1) {\n            msg += ' ';\n        }\n    }\n    return msg.length ? msg : null;\n};\n\n/**\n * The log method bound to each of the logging levels in order to implement\n * \"global log transport\" object.\n *\n * @private\n */\nLogCollector.prototype._log = function() {\n\n    // var logLevel = arguments[0]; first argument is the log level\n    var timestamp = arguments[1];\n    var msg = this.formatLogMessage.apply(this, arguments);\n    if (msg) {\n        // The same as the previous message aggregation logic\n        var prevMessage = this.queue[this.queue.length - 1];\n        var prevMessageText = prevMessage && prevMessage.text;\n        if (prevMessageText === msg) {\n            prevMessage.count += 1;\n        } else {\n            this.queue.push({\n                text: msg,\n                timestamp: timestamp,\n                count: 1\n            });\n            this.totalLen += msg.length;\n        }\n    }\n\n    if (this.totalLen >= this.maxEntryLength) {\n        this._flush(true /* force */, true /* reschedule */);\n    }\n};\n\n/**\n * Starts periodical \"store logs\" task which will be triggered at the interval\n * specified in the constructor options.\n */\nLogCollector.prototype.start = function () {\n    this._reschedulePublishInterval();\n};\n\n/**\n * Reschedules the periodical \"store logs\" task which will store the next batch\n * log entry in the storage.\n * @private\n */\nLogCollector.prototype._reschedulePublishInterval = function () {\n    if (this.storeLogsIntervalID) {\n        window.clearTimeout(this.storeLogsIntervalID);\n        this.storeLogsIntervalID = null;\n    }\n    // It's actually a timeout, because it is rescheduled on every flush\n    this.storeLogsIntervalID = window.setTimeout(\n        this._flush.bind(\n            this, false /* do not force */, true /* reschedule */),\n        this.storeInterval);\n};\n\n/**\n * Call this method to flush the log entry buffer and store it in the log\n * storage immediately (given that the storage is ready).\n */\nLogCollector.prototype.flush = function() {\n    this._flush(\n        false /* do not force, as it will not be stored anyway */,\n        true /* reschedule next update */ );\n};\n\n/**\n * Passes the logs to logStorage.storeLogs in order to store them. If logStorage.storeLogs throws an error, it prints it.\n * Note: We are not retrying to pass the logs to the logStorage if there is an error.\n * @param {string[]} logs - The logs to be stored.\n */\nLogCollector.prototype._storeLogs = function (logs) {\n    try {\n        this.logStorage.storeLogs(logs);\n    } catch (error) {\n        console.error('LogCollector error when calling logStorage.storeLogs(): ', error);\n    }\n};\n\n/**\n * Stores the next batch log entry in the log storage.\n * @param {boolean} force enforce current logs batch to be stored or cached if\n * there is anything to be logged, but the storage is not ready yet. One of\n * legitimate reasons to force is when the logs length exceeds size limit which\n * could result in truncation.\n * @param {boolean} reschedule <tt>true</tt> if the next periodic task should be\n * scheduled after the log entry is stored. <tt>false</tt> will end the periodic\n * task cycle.\n * @private\n */\nLogCollector.prototype._flush = function(force, reschedule) {\n    var logStorageReady = false;\n\n    try {\n        logStorageReady = this.logStorage.isReady();\n    } catch (error) {\n        console.error('LogCollector error when calling logStorage.isReady(): ', error);\n    }\n\n    // Publish only if there's anything to be logged\n    if (this.totalLen > 0 && (logStorageReady || force)) {\n        //FIXME avoid truncating\n        // right now we don't care if the message size is \"slightly\" exceeded\n        if (logStorageReady) {\n            // Sends all cached logs\n            if (this.outputCache.length) {\n                this.outputCache.forEach(\n                    function (cachedQueue) {\n                        this._storeLogs(cachedQueue);\n                    }.bind(this)\n                );\n                // Clear the cache\n                this.outputCache = [];\n            }\n            // Send current batch\n            this._storeLogs(this.queue);\n        } else {\n            this.outputCache.push(this.queue);\n        }\n\n        this.queue = [];\n        this.totalLen = 0;\n    }\n\n    if (reschedule) {\n        this._reschedulePublishInterval();\n    }\n};\n\n/**\n * Stops the periodical \"store logs\" task and immediately stores any pending\n * log entries as a batch.\n */\nLogCollector.prototype.stop = function() {\n    // Flush and stop publishing logs\n    this._flush(false /* do not force */, false /* do not reschedule */);\n};\n\nmodule.exports = LogCollector;\n","/* Copyright @ 2015-present 8x8, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n/*jslint latedef:false*/\n\n/**\n * Ordered log levels.\n */\nvar levels = {\n    \"trace\": 0,\n    \"debug\": 1,\n    \"info\": 2,\n    \"log\": 3,\n    \"warn\": 4,\n    \"error\": 5\n};\n\n/**\n * The default transport - console\n * @type LoggerTransport\n */\nLogger.consoleTransport = console;\n\n/**\n * The array which stores currently registered global transports.\n * @type {[LoggerTransport]}\n */\nvar globalTransports = [ Logger.consoleTransport ];\n\n/**\n * Adds given {@link LoggerTransport} instance to the list of global\n * transports which means that it'll be used by all {@link Logger}s\n * @param {LoggerTransport} transport\n */\nLogger.addGlobalTransport = function(transport) {\n    if (globalTransports.indexOf(transport) === -1) {\n        globalTransports.push(transport);\n    }\n};\n\n/**\n * Removes given {@link LoggerTransport} instance from the list of global\n * transports\n * @param {LoggerTransport} transport\n */\nLogger.removeGlobalTransport = function(transport) {\n    var transportIdx = globalTransports.indexOf(transport);\n    if (transportIdx !== -1) {\n        globalTransports.splice(transportIdx, 1);\n    }\n};\n\n/**\n * The global configuration options.\n */\nvar globalOptions = {};\n\n/**\n * Sets global options which will be used by all loggers. Changing these works\n * even after other loggers are created.\n */\nLogger.setGlobalOptions = function(options) {\n    globalOptions = options || {};\n};\n\n/**\n * Parses Error's object stack trace and extracts information about the last\n * caller before the log method was called.\n * @returns JS object with info about the caller - method name, file location,\n * line and column.\n */\nfunction getCallerInfo() {\n    var callerInfo = {\n        methodName: \"\",\n        fileLocation: \"\",\n        line: null,\n        column: null\n    };\n    //gets the part of the stack without the logger wrappers\n    var error = new Error();\n    var stack = error.stack? error.stack.split(\"\\n\") : [];\n    if(!stack || stack.length < 3) {\n        return callerInfo;\n    }\n    var m = null;\n    if(stack[3]) {\n        m = stack[3].match(/\\s*at\\s*(.+?)\\s*\\((\\S*)\\s*:(\\d*)\\s*:(\\d*)\\)/);\n    }\n    if(!m || m.length <= 4) {\n        //Firefox && Safari\n        if(stack[2].indexOf(\"log@\") === 0){\n            //Safari\n            callerInfo.methodName = stack[3].substr(0, stack[3].indexOf(\"@\"));\n        } else {\n            //Firefox\n            callerInfo.methodName = stack[2].substr(0, stack[2].indexOf(\"@\"));\n        }\n        return callerInfo;\n    }\n\n    callerInfo.methodName = m[1];\n    callerInfo.fileLocation = m[2];\n    callerInfo.line = m[3];\n    callerInfo.column = m[4];\n    return callerInfo;\n}\n\n/**\n * Logs messages using the transports and level from the logger.\n * @param logger a logger instance.\n * @param level the log level of the message. See the levels variable.\n * @param arguments array with arguments that will be logged.\n */\nfunction log() {\n    var logger = arguments[0], level = arguments[1],\n        args = Array.prototype.slice.call(arguments, 2);\n    if(levels[level] < logger.level) {\n        return;\n    }\n\n    var callerInfo\n        = !(logger.options.disableCallerInfo || globalOptions.disableCallerInfo) &&\n            getCallerInfo();\n    var transports = globalTransports.concat(logger.transports);\n    for(var i = 0; i < transports.length; i++) {\n        var t = transports[i];\n        var l = t[level];\n        if(l && typeof(l) === \"function\") {\n            var logPrefixes = [];\n\n            logPrefixes.push(new Date().toISOString());\n\n            // Include the log level for log parsing and filtering.\n            logPrefixes.push(\"[\" + level.toUpperCase() +\"]\");\n\n            if (logger.id) {\n                logPrefixes.push(\"[\" + logger.id + \"]\");\n            }\n\n            if (callerInfo && callerInfo.methodName.length > 1) {\n                logPrefixes.push(\"<\" + callerInfo.methodName + \">: \");\n            }\n\n            var fullLogParts = logPrefixes.concat(args);\n\n            try {\n                l.bind(t).apply(t, fullLogParts);\n            } catch (error) {\n                // It would be nice to send the error to the logger but this could send us into an endless loop.\n                // That's why we use only console for logging here.\n                console.error(\"An error occured when trying to log with one of the available transports\", error);\n            }\n        }\n    }\n}\n\n/**\n *\n * Constructs new logger object.\n * @param level the logging level for the new logger\n * @param id optional identifier for the logger instance.\n * @param {LoggerTransport} transports optional list of handlers(objects) for\n * the logs. The handlers must support - log, warn, error, debug, info, trace.\n * @param options optional configuration file for how the logger should behave.\n * @param {boolean} options.disableCallerInfo Whether the call site of a logger\n * method invocation should be included in the log. Defaults to false, so the\n * call site will be included.\n */\nfunction Logger(level, id, transports, options) {\n    this.id = id;\n    this.options = options || {};\n    this.transports = transports;\n    if(!this.transports) {\n        this.transports = [];\n    }\n    this.level = levels[level];\n    var methods = Object.keys(levels);\n    for(var i = 0; i < methods.length; i++){\n        this[methods[i]] =\n            log.bind(null, this, methods[i]);\n    }\n}\n\n/**\n * Sets the log level for the logger.\n * @param level the new log level.\n */\nLogger.prototype.setLevel = function (level) {\n    this.level = levels[level];\n};\nmodule.exports = Logger;\n\n/**\n * Enum for the supported log levels.\n */\nLogger.levels = {\n    TRACE: \"trace\",\n    DEBUG: \"debug\",\n    INFO: \"info\",\n    LOG: \"log\",\n    WARN: \"warn\",\n    ERROR: \"error\"\n};\n","/* Copyright @ 2015-present 8x8, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nvar Logger = require(\"./Logger\");\nvar LogCollector = require(\"./LogCollector\");\n\n/**\n * Definition of the log method\n * @name log_method\n * @function\n * @param {...*} log_args the arguments to be logged\n */\n/**\n * The logger's transport type definition.\n *\n * @typedef {object} LoggerTransport\n *\n * @property {log_method} trace method called to log on {@link Logger.levels.TRACE} logging level\n * @property {log_method} debug method called to log on {@link Logger.levels.DEBUG} logging level\n * @property {log_method} info method called to log on {@link Logger.levels.INFO} logging level\n * @property {log_method} log method called to log on {@link Logger.levels.LOG} logging level\n * @property {log_method} warn method called to log on {@link Logger.levels.WARN} logging level\n * @property {log_method} error method called to log on {@link Logger.levels.ERROR} logging level\n */\n\n/**\n * Map with the created loggers with ID.\n */\nvar idLoggers = {};\n\n/**\n * Array with the loggers without id.\n */\nvar loggers = [];\n\n/**\n * Log level for the lbrary.\n */\nvar curLevel = Logger.levels.TRACE;\n\n\nmodule.exports = {\n    /**\n     * Adds given {@link LoggerTransport} instance to the list of global\n     * transports which means that it'll be used by all {@link Logger}s\n     * @param {LoggerTransport} transport\n     */\n    addGlobalTransport: function(transport) {\n        Logger.addGlobalTransport(transport);\n    },\n    /**\n     * Removes given {@link LoggerTransport} instance from the list of global\n     * transports\n     * @param {LoggerTransport} transport\n     */\n    removeGlobalTransport: function(transport) {\n        Logger.removeGlobalTransport(transport);\n    },\n    /**\n    * Sets global options which will be used by all loggers. Changing these\n    * works even after other loggers are created.\n    */\n    setGlobalOptions: function(options) {\n        Logger.setGlobalOptions(options);\n    },\n    /**\n     * Creates new logger.\n     * @arguments the same as Logger constructor\n     */\n    getLogger: function(id, transports, options) {\n        var logger = new Logger(curLevel, id, transports, options);\n        if(id) {\n            idLoggers[id] = idLoggers[id] || [];\n            idLoggers[id].push(logger);\n        } else {\n            loggers.push(logger);\n        }\n        return logger;\n    },\n    /**\n     * Creates a new Logger, without keeping track of it in the loggers list\n     * @arguments the same as Logger constructor\n     */\n    getUntrackedLogger: function(id, transports, options) {\n        return new Logger(curLevel, id, transports, options);\n    },\n    /**\n     * Changes the log level for the existing loggers by id.\n     * @param level the new log level.\n     * @param id if specified the level will be changed only for loggers with the\n     * same id. Otherwise the operation will affect all loggers that don't\n     * have id.\n     */\n    setLogLevelById: function(level, id) {\n        var l = id? (idLoggers[id] || []) : loggers;\n        for(var i = 0; i < l.length; i++) {\n            l[i].setLevel(level);\n        }\n    },\n    /**\n     * Changes the log level for all existing loggers.\n     * @param level the new log level.\n     */\n    setLogLevel: function (level) {\n        curLevel = level;\n        var i = 0;\n        for(; i < loggers.length; i++) {\n            loggers[i].setLevel(level);\n        }\n\n        for(var id in idLoggers) {\n            var l = idLoggers[id] || [];\n            for(i = 0; i < l.length; i++) {\n                l[i].setLevel(level);\n            }\n        }\n    },\n    /**\n     * The supported log levels.\n     */\n    levels: Logger.levels,\n    /**\n     * Exports the <tt>LogCollector</tt>.\n     */\n    LogCollector: LogCollector\n};\n","/* Copyright @ 2016-present 8x8, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nvar Logger = require('./Logger.js');\n\n/**\n * Creates new <tt>LogCollector</tt>. Class implements <tt>LoggerTransport</tt>\n * and thus can be added as global transport in order to capture all the logs.\n *\n * It captures subsequent log lines created whenever <tt>Logger</tt> logs\n * a message and stores them in a queue in order to batch log entries. There are\n * time and size limit constraints which determine how often batch entries are\n * stored. Whenever one of these limits is exceeded the <tt>LogCollector</tt>\n * will use the <tt>logStorage</tt> object given as an argument to save\n * the batch log entry.\n *\n * @param {Object} logStorage an object which allows to store the logs collected\n * @param {function(string|object[])} logStorage.storeLogs a method called when\n * this <tt>LogCollector</tt> requests log entry storage. The method's argument\n * is an array which can contain <tt>string</tt>s and <tt>object</tt>s. If given\n * item is an object it means that it's an aggregated message. That is a message\n * which is the same as the previous one and it's representation has\n * the following format:\n * {\n *   {string} text: 'the text of some duplicated message'\n *   {number} count: 3 // how many times the message appeared in a row\n * }\n * If a message \"B\" after an aggregated message \"A\" is different, then it breaks\n * the sequence of \"A\". Which means that even if the next message \"C\" is\n * the same as \"A\" it will start a new aggregated message \"C\".\n * @param {function()} logStorage.isReady a method which should return\n * a <tt>boolean</tt> to tell the collector that it's ready to store. During the\n * time storage is not ready log batches will be cached and stored on the next\n * occasion (flush or interval timeout).\n *\n * @param {Object} options the <tt>LogCollector</tt> configuration options.\n * @param {number} options.maxEntryLength the size limit for a single log entry\n * to be stored. The <tt>LogCollector</tt> will push the entry as soon as it\n * reaches or exceeds this limit given that <tt>logStorage.isReady</tt>\n * returns <tt>true</tt>. Otherwise the log entry will be cached until the log\n * storage becomes ready. Note that the \"is ready\" condition is checked every\n * <tt>options.storeInterval</tt> milliseconds.\n * @param {number} options.storeInterval how often the logs should be stored in\n * case <tt>maxEntryLength</tt> was not exceeded.\n * @param {boolean} options.stringifyObjects indicates whether or not object\n * arguments should be \"stringified\" with <tt>JSON.stringify</tt> when a log\n * message is composed. Note that objects logged on the error log level are\n * always stringified.\n *\n * @constructor\n */\nfunction LogCollector(logStorage, options) {\n    this.logStorage = logStorage;\n    this.stringifyObjects = options && options.stringifyObjects ? options.stringifyObjects : false;\n    this.storeInterval = options && options.storeInterval ? options.storeInterval: 30000;\n    this.maxEntryLength = options && options.maxEntryLength ? options.maxEntryLength : 10000;\n    // Bind the log method for each level to the corresponding method name\n    // in order to implement \"global log transport\" object.\n    Object.values(Logger.levels).forEach(\n    function (logLevel) {\n        this[logLevel] = function () {\n            this._log.apply(this, arguments);\n        }.bind(this, logLevel);\n    }.bind(this));\n    /**\n     * The ID of store logs interval if one is currently scheduled or\n     * <tt>null</tt> otherwise.\n     * @type {number|null}\n     */\n    this.storeLogsIntervalID = null;\n    /**\n     * The log messages that are to be batched into log entry when\n     * {@link LogCollector._flush} method is called.\n     * @type {string[]}\n     */\n    this.queue = [];\n    /**\n     * The total length of all messages currently stored in the {@link queue}.\n     * @type {number}\n     */\n    this.totalLen = 0;\n    /**\n     * An array used to temporarily store log batches, before the storage gets\n     * ready.\n     * @type {string[]}\n     */\n    this.outputCache = [];\n}\n\n/**\n * Method called inside of {@link formatLogMessage} in order to covert an\n * <tt>Object</tt> argument to string. The conversion will happen when either\n * 'stringifyObjects' option is enabled or on the {@link Logger.levels.ERROR}\n * log level. The default implementation uses <tt>JSON.stringify</tt> and\n * returns \"[object with circular refs?]\" instead of an object if it fails.\n *\n * @param {object} someObject the <tt>object</tt> to be stringified.\n *\n * @return {string} the result of <tt>JSON.stringify</tt> or\n * \"[object with circular refs?]\" if any error occurs during \"stringification\".\n *\n * @protected\n */\nLogCollector.prototype.stringify = function (someObject) {\n    try {\n        return JSON.stringify(someObject);\n    } catch (error) {\n        return '[object with circular refs?]';\n    }\n};\n\n/**\n * Formats log entry for the given logging level and arguments passed to the\n * <tt>Logger</tt>'s log method. The first argument is log level and the next\n * arguments have to be captured using JS built-in 'arguments' variable.\n *\n * @param {Logger.levels} logLevel provides the logging level of the message to\n * be logged.\n * @param {Date} timestamp - The {@code Date} when a message has been logged.\n *\n * @return {string|null} a non-empty string representation of the log entry\n * crafted from the log arguments. If the return value is <tt>null</tt> then\n * the message wil be discarded by this <tt>LogCollector</tt>.\n *\n * @protected\n */\nLogCollector.prototype.formatLogMessage = function (\nlogLevel /* timestamp, arg2, arg3, arg4... */) { // jshint ignore:line\n    var msg = '';\n    for (var i = 1, len = arguments.length; i < len; i++) {\n        var arg = arguments[i];\n\n        if (arg instanceof Error) {\n            msg += arg.toString() + ': ' + arg.stack;\n        } else if (this.stringifyObjects && typeof arg === 'object') {\n        // NOTE: We were trying to stringify all error logs before but because of a bug that we were getting the keys\n        // of the log levels which are all with upper case and comparing it with the keys which are all lower case we\n        // were never actually strinfying the error logs. That's why I've removed the check for error logs here.\n        // NOTE: The non-enumerable properties of the objects wouldn't be included in the string after JSON.strigify.\n        // For example Map instance will be translated to '{}'. So I think we have to eventually do something better\n        // for parsing the arguments. But since this option for strigify is part of the public interface and I think\n        // it could be useful in some cases I will it for now.\n            msg += this.stringify(arg);\n        } else {\n            msg += arg;\n        }\n        if (i !== len - 1) {\n            msg += ' ';\n        }\n    }\n    return msg.length ? msg : null;\n};\n\n/**\n * The log method bound to each of the logging levels in order to implement\n * \"global log transport\" object.\n *\n * @private\n */\nLogCollector.prototype._log = function() {\n\n    // var logLevel = arguments[0]; first argument is the log level\n    var timestamp = arguments[1];\n    var msg = this.formatLogMessage.apply(this, arguments);\n    if (msg) {\n        // The same as the previous message aggregation logic\n        var prevMessage = this.queue[this.queue.length - 1];\n        var prevMessageText = prevMessage && prevMessage.text;\n        if (prevMessageText === msg) {\n            prevMessage.count += 1;\n        } else {\n            this.queue.push({\n                text: msg,\n                timestamp: timestamp,\n                count: 1\n            });\n            this.totalLen += msg.length;\n        }\n    }\n\n    if (this.totalLen >= this.maxEntryLength) {\n        this._flush(true /* force */, true /* reschedule */);\n    }\n};\n\n/**\n * Starts periodical \"store logs\" task which will be triggered at the interval\n * specified in the constructor options.\n */\nLogCollector.prototype.start = function () {\n    this._reschedulePublishInterval();\n};\n\n/**\n * Reschedules the periodical \"store logs\" task which will store the next batch\n * log entry in the storage.\n * @private\n */\nLogCollector.prototype._reschedulePublishInterval = function () {\n    if (this.storeLogsIntervalID) {\n        window.clearTimeout(this.storeLogsIntervalID);\n        this.storeLogsIntervalID = null;\n    }\n    // It's actually a timeout, because it is rescheduled on every flush\n    this.storeLogsIntervalID = window.setTimeout(\n        this._flush.bind(\n            this, false /* do not force */, true /* reschedule */),\n        this.storeInterval);\n};\n\n/**\n * Call this method to flush the log entry buffer and store it in the log\n * storage immediately (given that the storage is ready).\n */\nLogCollector.prototype.flush = function() {\n    this._flush(\n        false /* do not force, as it will not be stored anyway */,\n        true /* reschedule next update */ );\n};\n\n/**\n * Passes the logs to logStorage.storeLogs in order to store them. If logStorage.storeLogs throws an error, it prints it.\n * Note: We are not retrying to pass the logs to the logStorage if there is an error.\n * @param {string[]} logs - The logs to be stored.\n */\nLogCollector.prototype._storeLogs = function (logs) {\n    try {\n        this.logStorage.storeLogs(logs);\n    } catch (error) {\n        console.error('LogCollector error when calling logStorage.storeLogs(): ', error);\n    }\n};\n\n/**\n * Stores the next batch log entry in the log storage.\n * @param {boolean} force enforce current logs batch to be stored or cached if\n * there is anything to be logged, but the storage is not ready yet. One of\n * legitimate reasons to force is when the logs length exceeds size limit which\n * could result in truncation.\n * @param {boolean} reschedule <tt>true</tt> if the next periodic task should be\n * scheduled after the log entry is stored. <tt>false</tt> will end the periodic\n * task cycle.\n * @private\n */\nLogCollector.prototype._flush = function(force, reschedule) {\n    var logStorageReady = false;\n\n    try {\n        logStorageReady = this.logStorage.isReady();\n    } catch (error) {\n        console.error('LogCollector error when calling logStorage.isReady(): ', error);\n    }\n\n    // Publish only if there's anything to be logged\n    if (this.totalLen > 0 && (logStorageReady || force)) {\n        //FIXME avoid truncating\n        // right now we don't care if the message size is \"slightly\" exceeded\n        if (logStorageReady) {\n            // Sends all cached logs\n            if (this.outputCache.length) {\n                this.outputCache.forEach(\n                    function (cachedQueue) {\n                        this._storeLogs(cachedQueue);\n                    }.bind(this)\n                );\n                // Clear the cache\n                this.outputCache = [];\n            }\n            // Send current batch\n            this._storeLogs(this.queue);\n        } else {\n            this.outputCache.push(this.queue);\n        }\n\n        this.queue = [];\n        this.totalLen = 0;\n    }\n\n    if (reschedule) {\n        this._reschedulePublishInterval();\n    }\n};\n\n/**\n * Stops the periodical \"store logs\" task and immediately stores any pending\n * log entries as a batch.\n */\nLogCollector.prototype.stop = function() {\n    // Flush and stop publishing logs\n    this._flush(false /* do not force */, false /* do not reschedule */);\n};\n\nmodule.exports = LogCollector;\n","/* Copyright @ 2015-present 8x8, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n/*jslint latedef:false*/\n\n/**\n * Ordered log levels.\n */\nvar levels = {\n    \"trace\": 0,\n    \"debug\": 1,\n    \"info\": 2,\n    \"log\": 3,\n    \"warn\": 4,\n    \"error\": 5\n};\n\n/**\n * The default transport - console\n * @type LoggerTransport\n */\nLogger.consoleTransport = console;\n\n/**\n * The array which stores currently registered global transports.\n * @type {[LoggerTransport]}\n */\nvar globalTransports = [ Logger.consoleTransport ];\n\n/**\n * Adds given {@link LoggerTransport} instance to the list of global\n * transports which means that it'll be used by all {@link Logger}s\n * @param {LoggerTransport} transport\n */\nLogger.addGlobalTransport = function(transport) {\n    if (globalTransports.indexOf(transport) === -1) {\n        globalTransports.push(transport);\n    }\n};\n\n/**\n * Removes given {@link LoggerTransport} instance from the list of global\n * transports\n * @param {LoggerTransport} transport\n */\nLogger.removeGlobalTransport = function(transport) {\n    var transportIdx = globalTransports.indexOf(transport);\n    if (transportIdx !== -1) {\n        globalTransports.splice(transportIdx, 1);\n    }\n};\n\n/**\n * The global configuration options.\n */\nvar globalOptions = {};\n\n/**\n * Sets global options which will be used by all loggers. Changing these works\n * even after other loggers are created.\n */\nLogger.setGlobalOptions = function(options) {\n    globalOptions = options || {};\n};\n\n/**\n * Parses Error's object stack trace and extracts information about the last\n * caller before the log method was called.\n * @returns JS object with info about the caller - method name, file location,\n * line and column.\n */\nfunction getCallerInfo() {\n    var callerInfo = {\n        methodName: \"\",\n        fileLocation: \"\",\n        line: null,\n        column: null\n    };\n    //gets the part of the stack without the logger wrappers\n    var error = new Error();\n    var stack = error.stack? error.stack.split(\"\\n\") : [];\n    if(!stack || stack.length < 3) {\n        return callerInfo;\n    }\n    var m = null;\n    if(stack[3]) {\n        m = stack[3].match(/\\s*at\\s*(.+?)\\s*\\((\\S*)\\s*:(\\d*)\\s*:(\\d*)\\)/);\n    }\n    if(!m || m.length <= 4) {\n        //Firefox && Safari\n        if(stack[2].indexOf(\"log@\") === 0){\n            //Safari\n            callerInfo.methodName = stack[3].substr(0, stack[3].indexOf(\"@\"));\n        } else {\n            //Firefox\n            callerInfo.methodName = stack[2].substr(0, stack[2].indexOf(\"@\"));\n        }\n        return callerInfo;\n    }\n\n    callerInfo.methodName = m[1];\n    callerInfo.fileLocation = m[2];\n    callerInfo.line = m[3];\n    callerInfo.column = m[4];\n    return callerInfo;\n}\n\n/**\n * Logs messages using the transports and level from the logger.\n * @param logger a logger instance.\n * @param level the log level of the message. See the levels variable.\n * @param arguments array with arguments that will be logged.\n */\nfunction log() {\n    var logger = arguments[0], level = arguments[1],\n        args = Array.prototype.slice.call(arguments, 2);\n    if(levels[level] < logger.level) {\n        return;\n    }\n\n    var callerInfo\n        = !(logger.options.disableCallerInfo || globalOptions.disableCallerInfo) &&\n            getCallerInfo();\n    var transports = globalTransports.concat(logger.transports);\n    for(var i = 0; i < transports.length; i++) {\n        var t = transports[i];\n        var l = t[level];\n        if(l && typeof(l) === \"function\") {\n            var logPrefixes = [];\n\n            logPrefixes.push(new Date().toISOString());\n\n            if (logger.id) {\n                logPrefixes.push(\"[\" + logger.id + \"]\");\n            }\n\n            if (callerInfo && callerInfo.methodName.length > 1) {\n                logPrefixes.push(\"<\" + callerInfo.methodName + \">: \");\n            }\n\n            var fullLogParts = logPrefixes.concat(args);\n\n            try {\n                l.bind(t).apply(t, fullLogParts);\n            } catch (error) {\n                // It would be nice to send the error to the logger but this could send us into an endless loop.\n                // That's why we use only console for logging here.\n                console.error(\"An error occured when trying to log with one of the available transports\", error);\n            }\n        }\n    }\n}\n\n/**\n *\n * Constructs new logger object.\n * @param level the logging level for the new logger\n * @param id optional identifier for the logger instance.\n * @param {LoggerTransport} transports optional list of handlers(objects) for\n * the logs. The handlers must support - log, warn, error, debug, info, trace.\n * @param options optional configuration file for how the logger should behave.\n * @param {boolean} options.disableCallerInfo Whether the call site of a logger\n * method invocation should be included in the log. Defaults to false, so the\n * call site will be included.\n */\nfunction Logger(level, id, transports, options) {\n    this.id = id;\n    this.options = options || {};\n    this.transports = transports;\n    if(!this.transports) {\n        this.transports = [];\n    }\n    this.level = levels[level];\n    var methods = Object.keys(levels);\n    for(var i = 0; i < methods.length; i++){\n        this[methods[i]] =\n            log.bind(null, this, methods[i]);\n    }\n}\n\n/**\n * Sets the log level for the logger.\n * @param level the new log level.\n */\nLogger.prototype.setLevel = function (level) {\n    this.level = levels[level];\n};\nmodule.exports = Logger;\n\n/**\n * Enum for the supported log levels.\n */\nLogger.levels = {\n    TRACE: \"trace\",\n    DEBUG: \"debug\",\n    INFO: \"info\",\n    LOG: \"log\",\n    WARN: \"warn\",\n    ERROR: \"error\"\n};\n","/* Copyright @ 2015-present 8x8, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nvar Logger = require(\"./Logger\");\nvar LogCollector = require(\"./LogCollector\");\n\n/**\n * Definition of the log method\n * @name log_method\n * @function\n * @param {...*} log_args the arguments to be logged\n */\n/**\n * The logger's transport type definition.\n *\n * @typedef {object} LoggerTransport\n *\n * @property {log_method} trace method called to log on {@link Logger.levels.TRACE} logging level\n * @property {log_method} debug method called to log on {@link Logger.levels.DEBUG} logging level\n * @property {log_method} info method called to log on {@link Logger.levels.INFO} logging level\n * @property {log_method} log method called to log on {@link Logger.levels.LOG} logging level\n * @property {log_method} warn method called to log on {@link Logger.levels.WARN} logging level\n * @property {log_method} error method called to log on {@link Logger.levels.ERROR} logging level\n */\n\n/**\n * Map with the created loggers with ID.\n */\nvar idLoggers = {};\n\n/**\n * Array with the loggers without id.\n */\nvar loggers = [];\n\n/**\n * Log level for the lbrary.\n */\nvar curLevel = Logger.levels.TRACE;\n\n\nmodule.exports = {\n    /**\n     * Adds given {@link LoggerTransport} instance to the list of global\n     * transports which means that it'll be used by all {@link Logger}s\n     * @param {LoggerTransport} transport\n     */\n    addGlobalTransport: function(transport) {\n        Logger.addGlobalTransport(transport);\n    },\n    /**\n     * Removes given {@link LoggerTransport} instance from the list of global\n     * transports\n     * @param {LoggerTransport} transport\n     */\n    removeGlobalTransport: function(transport) {\n        Logger.removeGlobalTransport(transport);\n    },\n    /**\n    * Sets global options which will be used by all loggers. Changing these\n    * works even after other loggers are created.\n    */\n    setGlobalOptions: function(options) {\n        Logger.setGlobalOptions(options);\n    },\n    /**\n     * Creates new logger.\n     * @arguments the same as Logger constructor\n     */\n    getLogger: function(id, transports, options) {\n        var logger = new Logger(curLevel, id, transports, options);\n        if(id) {\n            idLoggers[id] = idLoggers[id] || [];\n            idLoggers[id].push(logger);\n        } else {\n            loggers.push(logger);\n        }\n        return logger;\n    },\n    /**\n     * Creates a new Logger, without keeping track of it in the loggers list\n     * @arguments the same as Logger constructor\n     */\n    getUntrackedLogger: function(id, transports, options) {\n        return new Logger(curLevel, id, transports, options);\n    },\n    /**\n     * Changes the log level for the existing loggers by id.\n     * @param level the new log level.\n     * @param id if specified the level will be changed only for loggers with the\n     * same id. Otherwise the operation will affect all loggers that don't\n     * have id.\n     */\n    setLogLevelById: function(level, id) {\n        var l = id? (idLoggers[id] || []) : loggers;\n        for(var i = 0; i < l.length; i++) {\n            l[i].setLevel(level);\n        }\n    },\n    /**\n     * Changes the log level for all existing loggers.\n     * @param level the new log level.\n     */\n    setLogLevel: function (level) {\n        curLevel = level;\n        var i = 0;\n        for(; i < loggers.length; i++) {\n            loggers[i].setLevel(level);\n        }\n\n        for(var id in idLoggers) {\n            var l = idLoggers[id] || [];\n            for(i = 0; i < l.length; i++) {\n                l[i].setLevel(level);\n            }\n        }\n    },\n    /**\n     * The supported log levels.\n     */\n    levels: Logger.levels,\n    /**\n     * Exports the <tt>LogCollector</tt>.\n     */\n    LogCollector: LogCollector\n};\n","(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"watchRTC\"] = factory();\n\telse\n\t\troot[\"watchRTC\"] = factory();\n})(this, function() {\nreturn ","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.addStateListener = exports.persistentStart = exports.persistentEnd = exports.addStatsListener = exports.disconnect = exports.connect = exports.mapTrack = exports.mapStream = exports.addEvent = exports.enableDataCollection = exports.disableDataCollection = exports.addKeys = exports.setUserRating = exports.addTags = exports.setConfig = exports.init = void 0;\nrequire(\"./types\");\nvar sdk_1 = require(\"./sdk\");\n/**\n * Initialize SDK. Can be called multiple times but it will be initialized only at the first time.\n * Use 'setConfig' function after if you don't have rtcRoomId and rtcPeerId yet.\n * @param watchrtc\n * @param prefixesToWrap\n * @param services\n */\nvar init = function (watchrtcConfig, services) {\n    (0, sdk_1.initSDK)((watchrtcConfig || {}), [\"\"], services);\n};\nexports.init = init;\n/**\n * You also can use watchRTC.setConfig function to set watchRTC configuration after calling init()\n * and before the creation of RTCPeerConnection objects\n */\nvar setConfig = function (watchrtcConfig) {\n    (0, sdk_1.setConfig)(watchrtcConfig);\n};\nexports.setConfig = setConfig;\n/**\n * @deprecated Tags no longer supported. Use addKeys instead\n * Add tags for peer session\n * @param rtcTags[]\n */\nvar addTags = function (\n/** [\"tag1\", \"tag2\", \"tag3\"] */\n_rtcTags) { };\nexports.addTags = addTags;\n/**\n * Set user rating and/or comment for peer session\n * @param rating number from 1 to 5\n * @param comment string\n */\nvar setUserRating = function (\n/** 1 | 2 | 3 | 4 | 5 */\nrating, comment) {\n    (0, sdk_1.setUserRating)(rating, comment);\n};\nexports.setUserRating = setUserRating;\n/**\n * Add keys for peer session\n * @param keys\n */\nvar addKeys = function (\n/** { \"key1\": \"value1\", \"key2\": [\"value2_1\", \"value2_2\"]} */\nkeys) {\n    (0, sdk_1.addKeys)(keys);\n};\nexports.addKeys = addKeys;\n/**\n * Disables data collection\n */\nvar disableDataCollection = function () {\n    (0, sdk_1.disableDataCollection)();\n};\nexports.disableDataCollection = disableDataCollection;\n/**\n * Enables data collection\n */\nvar enableDataCollection = function () {\n    (0, sdk_1.enableDataCollection)();\n};\nexports.enableDataCollection = enableDataCollection;\nvar addEvent = function (event) {\n    (0, sdk_1.addEvent)(event);\n};\nexports.addEvent = addEvent;\n/**\n * Map an incoming stream with a human-readable name\n * @param id The identifier of the stream (streamIdentifier attribute)\n * @param name The human-readable name\n * @deprecated\n */\nvar mapStream = function (id, name) {\n    (0, sdk_1.mapStream)(id, name);\n};\nexports.mapStream = mapStream;\n/**\n * Map an incoming track with a human-readable name\n * @param id The identifier of the track (trackIdentifier attribute)\n * @param name The human-readable name\n */\nvar mapTrack = function (id, name) {\n    (0, sdk_1.mapTrack)(id, name);\n};\nexports.mapTrack = mapTrack;\nvar connect = function () {\n    (0, sdk_1.connect)();\n};\nexports.connect = connect;\nvar disconnect = function () {\n    (0, sdk_1.disconnect)();\n};\nexports.disconnect = disconnect;\nvar addStatsListener = function (listener) {\n    (0, sdk_1.registerOnStatsListener)(listener);\n};\nexports.addStatsListener = addStatsListener;\nvar persistentEnd = function (nailUpCallEnd) {\n    (0, sdk_1.persistentEnd)(nailUpCallEnd);\n};\nexports.persistentEnd = persistentEnd;\nvar persistentStart = function (roomId, peerId) {\n    (0, sdk_1.persistentStart)(roomId, peerId);\n};\nexports.persistentStart = persistentStart;\nvar addStateListener = function (listener) {\n    (0, sdk_1.registerStateListener)(listener);\n};\nexports.addStateListener = addStateListener;\nexports.default = {\n    /**\n     * Initialize SDK. Can be called multiple times but it will be initialized only at the first time.\n     * Use 'setConfig' function after if you don't have rtcRoomId and rtcPeerId yet.\n     * @param watchrtc\n     * @param prefixesToWrap\n     */\n    init: exports.init,\n    /**\n     * @deprecated Tags no longer supported. Use addKeys instead\n     * Add tags for peer session\n     * @param rtcTags[]\n     */\n    addTags: exports.addTags,\n    /**\n     * Set user rating and/or comment for peer session\n     * @param rating number from 1 to 5\n     * @param comment string\n     */\n    setUserRating: exports.setUserRating,\n    /**\n     * Add keys for peer session\n     * @param keys\n     */\n    addKeys: exports.addKeys,\n    /**\n     * You also can use watchRTC.setConfig function to set watchRTC configuration after calling init()\n     * and before the creation of RTCPeerConnection objects\n     */\n    setConfig: exports.setConfig,\n    /**\n     * Disables data collection\n     */\n    disableDataCollection: exports.disableDataCollection,\n    /**\n     * Enables data collection\n     */\n    enableDataCollection: exports.enableDataCollection,\n    addEvent: exports.addEvent,\n    /**\n     * Map an incoming stream with a human-readable name\n     * @param id The identifier of the stream (streamIdentifier attribute)\n     * @param name The human-readable name\n     * @deprecated\n     */\n    mapStream: exports.mapStream,\n    /**\n     * Map an incoming track with a human-readable name\n     * @param id The identifier of the track (trackIdentifier attribute)\n     * @param name The human-readable name\n     */\n    mapTrack: exports.mapTrack,\n    connect: exports.connect,\n    disconnect: exports.disconnect,\n    addStatsListener: exports.addStatsListener,\n    persistentEnd: exports.persistentEnd,\n    persistentStart: exports.persistentStart,\n    addStateListener: exports.addStateListener,\n    qualityrtc: {\n        run: sdk_1.qrtcRun,\n        stop: sdk_1.qrtcStop,\n    },\n};\n","\"use strict\";\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n        if (ar || !(i in from)) {\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n            ar[i] = from[i];\n        }\n    }\n    return to.concat(ar || Array.prototype.slice.call(from));\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.qrtcStop = exports.qrtcRun = exports.persistentStart = exports.persistentEnd = exports.registerStateListener = exports.registerOnStatsListener = exports.disconnect = exports.connect = exports.mapTrack = exports.mapStream = exports.addEvent = exports.enableDataCollection = exports.disableDataCollection = exports.addKeys = exports.setUserRating = exports.setConfig = exports.initSDK = exports.sdkLogWithoutTrace = exports.sdkLog = void 0;\nvar watchrtcsocket_1 = require(\"./watchrtcsocket\");\nvar watchrtchttp_1 = require(\"./watchrtchttp\");\nvar utils_1 = require(\"./utils\");\nvar version_1 = require(\"./version\");\nvar isBrowser = typeof window !== \"undefined\";\nvar globalContext = isBrowser ? window : global;\nvar standardGetstats = true;\nvar isFirefox = isBrowser ? !!globalContext.mozRTCPeerConnection : false;\nvar isSafari = isBrowser\n    ? !isFirefox && globalContext.RTCPeerConnection && !globalContext.navigator.webkitGetUserMedia\n    : false;\n// Data structure for RTCPeerConnection related stuff we need\nvar openChannels = {};\nvar peerconnectioncounter = 0;\nvar connectionData = {};\nvar watchrtcIdentifiers = {\n    rtcRoomId: undefined,\n    rtcPeerId: undefined,\n    projectId: undefined,\n};\nvar watchrtcConfig = null;\nvar http = null;\nvar socket = null;\nvar trace;\nvar lastConnectionOpen = 0; // so we know when was the last active connection seen\nvar getStatsInterval;\nvar tryingToConnectSocket = false;\nvar hardwareInfo;\nvar currentAudioOutputId;\nvar authFailed = false;\nvar reconnectTimerId;\nvar lostConnectionTs = 0;\nvar isManualConnect = false;\nvar isManualDisconnect = false;\nvar getStatsCallback = null;\nvar stateListener = null;\nvar freshConnection = true;\nexports.sdkLog = (0, utils_1.getSdkLogger)(function () { return watchrtcConfig === null || watchrtcConfig === void 0 ? void 0 : watchrtcConfig.logLevel; });\nexports.sdkLogWithoutTrace = (0, utils_1.getSdkLogWithoutTrace)(function () { return watchrtcConfig === null || watchrtcConfig === void 0 ? void 0 : watchrtcConfig.logLevel; });\nvar debugTrack = function (track) {\n    if (track) {\n        return \"\".concat(track.kind, \":\").concat(track.id, \" state:\").concat(track.readyState, \" muted:\").concat(track.muted, \" label:\").concat(track.label);\n    }\n    return \"no track\";\n};\n// Data structure for storing and applying mapTrack\nvar mappedTrack = {};\nvar maybeOpenWebsocketConnection = function (_a) {\n    var _b;\n    var _c = _a.forceRecreate, forceRecreate = _c === void 0 ? false : _c, _d = _a.reconnecting, reconnecting = _d === void 0 ? false : _d, _e = _a.pcId, pcId = _e === void 0 ? \"PC_unknown\" : _e, _f = _a.nailUp, nailUp = _f === void 0 ? false : _f;\n    if (socket === null || socket === void 0 ? void 0 : socket.isDisabledDataCollection()) {\n        (0, exports.sdkLog)(\"debug\", \"maybeOpenWebsocketConnection. disabledDataCollection, ignore [\".concat(pcId, \"]\"));\n        return;\n    }\n    (0, exports.sdkLog)(\"debug\", \"maybeOpenWebsocketConnection called: [\".concat(pcId, \"]\"), {\n        forceRecreate: forceRecreate,\n        reconnecting: reconnecting,\n        isManualDisconnect: isManualDisconnect,\n        isManualConnect: isManualConnect,\n        tryingToConnectSocket: tryingToConnectSocket,\n        watchrtcConfig: JSON.stringify(watchrtcConfig),\n        disabled: socket === null || socket === void 0 ? void 0 : socket.isDisabledDataCollection(),\n        openChannels: JSON.stringify(openChannels),\n    });\n    isManualDisconnect = false;\n    var opened = ((_b = socket === null || socket === void 0 ? void 0 : socket.connection) === null || _b === void 0 ? void 0 : _b.readyState) === globalContext.WebSocket.OPEN;\n    if (opened) {\n        var roomIdOrPeerIdChanged = (0, utils_1.isRoomIdOrPeerIdChanged)(watchrtcIdentifiers, watchrtcConfig);\n        if (roomIdOrPeerIdChanged && forceRecreate) {\n            (0, exports.sdkLog)(\"debug\", \"maybeOpenWebsocketConnection. Closing WS connection. [\".concat(pcId, \"]\"));\n            socket === null || socket === void 0 ? void 0 : socket.close();\n        }\n        else {\n            (0, exports.sdkLog)(\"debug\", \"maybeOpenWebsocketConnection. WS connection already opened [\".concat(pcId, \"]\"));\n            return;\n        }\n    }\n    var connectionCount = (0, utils_1.countOfValidConnections)(openChannels);\n    if (!isManualConnect && connectionCount < 1 && !tryingToConnectSocket) {\n        (0, exports.sdkLog)(\"debug\", \"maybeOpenWebsocketConnection. WS connection not opened - previous connect call not finished or missing peer connection [\".concat(pcId, \"]\"), {\n            openChannels: JSON.stringify(openChannels),\n            connectionCount: connectionCount,\n            tryingToConnectSocket: tryingToConnectSocket,\n            isManualConnect: isManualConnect,\n        });\n        return;\n    }\n    var canConnect = (0, utils_1.validateConfig)(watchrtcConfig);\n    var id = Object.keys(openChannels)[connectionCount - 1]; // not very critical, but for consistency with trace\n    if (!canConnect) {\n        tryingToConnectSocket = false;\n        (0, exports.sdkLog)(\"debug\", \"maybeOpenWebsocketConnection. WS connection not opened - invalid config [\".concat(pcId, \"]\"), {\n            watchrtcConfig: watchrtcConfig,\n        });\n        return;\n    }\n    if (watchrtcConfig.keys) {\n        Object.keys(watchrtcConfig.keys || {}).forEach(function (k) {\n            if (typeof watchrtcConfig.keys[k] === \"string\") {\n                watchrtcConfig.keys[k] = [watchrtcConfig.keys[k]];\n            }\n        });\n    }\n    var useToken = !!watchrtcConfig.rtcToken;\n    var wsConnectionData = (0, utils_1.getConnectionData)(\"ws\", useToken ? watchrtcConfig.rtcToken : watchrtcConfig.rtcApiKey, watchrtcConfig.proxyUrl);\n    if (!socket) {\n        (0, exports.sdkLog)(\"debug\", \"maybeOpenWebsocketConnection. WS socket wasn't initialized [\".concat(pcId, \"]\"));\n    }\n    tryingToConnectSocket = true;\n    lastConnectionOpen = Date.now();\n    (0, exports.sdkLog)(\"debug\", \"maybeOpenWebsocketConnection. Opening websocket connection [\".concat(pcId, \"]\"));\n    startStatsCollection(nailUp);\n    var wsOpeningTimestamp = Date.now();\n    socket === null || socket === void 0 ? void 0 : socket.connect({\n        url: \"\".concat(wsConnectionData.url, \"?\").concat(useToken ? \"token\" : \"apiKey\", \"=\").concat(wsConnectionData.key, \"&timestamp=\").concat(Date.now()),\n        options: { cleanOldTraces: freshConnection },\n        onData: function (data) {\n            var _a;\n            for (var _i = 0, _b = Object.entries(data); _i < _b.length; _i++) {\n                var _c = _b[_i], key = _c[0], value = _c[1];\n                connectionData[key] = value;\n            }\n            watchrtcIdentifiers.projectId = data.projectId;\n            tryingToConnectSocket = false;\n            watchrtcConfig.allowBrowserLogCollection = Boolean(data.collectConsoleLogEnabled);\n            if (!watchrtcConfig.allowBrowserLogCollection) {\n                (0, utils_1.restoreOriginalConsoleMethods)();\n                // clean up collected logs from socket buffer\n                if (socket === null || socket === void 0 ? void 0 : socket.buffer) {\n                    socket.buffer = socket.buffer.filter(function (data) { return data[0] !== \"log\"; });\n                }\n            }\n            else {\n                if (!((_a = watchrtcConfig === null || watchrtcConfig === void 0 ? void 0 : watchrtcConfig.console) === null || _a === void 0 ? void 0 : _a.override) && data.collectConsoleLogLevel) {\n                    (0, utils_1.setConsoleLevel)(data.collectConsoleLogLevel, trace);\n                }\n            }\n            (0, exports.sdkLog)(\"info\", \"Connection established. watchRTCConnectionId: \".concat(data.connectionId, \" sdkVersion:\").concat(version_1.default, \" [\").concat(pcId, \"]\"));\n            if (data.interval !== watchrtcConfig.collectionInterval) {\n                var oldInterval = watchrtcConfig.collectionInterval;\n                watchrtcConfig.collectionInterval = data.interval;\n                resetConnectionState();\n                startStatsCollection();\n                (0, exports.sdkLog)(\"error\", \"Collection interval mismatch - connection state reset\");\n                trace({ data: [\"collectionIntervalChange\", null, { oldInterval: oldInterval }] });\n            }\n            trace({ data: [\"watchrtc\", id, __assign(__assign(__assign({}, watchrtcConfig), data), { sdkVersion: version_1.default })] });\n            if (reconnecting) {\n                (0, exports.sdkLog)(\"debug\", \"websocket onData reconnecting\");\n                trace({ data: [\"reconnect\", null, null] });\n            }\n            if (hardwareInfo) {\n                trace({ data: [\"hardware\", null, hardwareInfo] });\n            }\n            trace({ data: [\"sessionId\", null, globalContext.watchRTCSessionId] });\n        },\n        onError: function (_, type) {\n            (0, exports.sdkLog)(\"debug\", \"websocket onError \".concat(type));\n            if (type === \"auth\") {\n                authFailed = true;\n            }\n            tryingToConnectSocket = false;\n            lastConnectionOpen = 0;\n        },\n        onOpen: function () {\n            freshConnection = false;\n            if (stateListener) {\n                stateListener({ connectionStatus: \"connected\" });\n            }\n            if (reconnecting) {\n                var reconnectDuration = Date.now() - lostConnectionTs;\n                trace({ data: [\"reconnectDuration\", null, reconnectDuration] });\n            }\n            authFailed = false;\n            if (reconnectTimerId) {\n                clearInterval(reconnectTimerId);\n                reconnectTimerId = undefined;\n            }\n            var delta = Date.now() - wsOpeningTimestamp;\n            (0, exports.sdkLog)(\"debug\", \"maybeOpenWebsocketConnection. Connection opened. Opening time - \".concat(delta, \" ms [\").concat(pcId, \"]\"));\n        },\n        onClose: function (closeEvent) {\n            if (stateListener) {\n                stateListener({ connectionStatus: \"disconnected\" });\n            }\n            var code = closeEvent.code, reason = closeEvent.reason, wasClean = closeEvent.wasClean;\n            (0, exports.sdkLog)(\"debug\", \"close event. authFailed: \".concat(authFailed, \" code: \").concat(code, \" reason: \").concat(reason, \" wasClean: \").concat(wasClean, \" reconnectTimerId: \").concat(reconnectTimerId), { authFailed: authFailed, code: code, reason: reason, wasClean: wasClean, reconnectTimerId: reconnectTimerId });\n            if (authFailed) {\n                (0, exports.sdkLog)(\"debug\", \"websocket authFailed\");\n                if (reconnectTimerId) {\n                    clearInterval(reconnectTimerId);\n                }\n            }\n            else if (!reconnectTimerId && !isManualDisconnect) {\n                (0, exports.sdkLog)(\"debug\", \"websocket onClose reconnecting\");\n                lostConnectionTs = Date.now();\n                maybeOpenWebsocketConnection({ reconnecting: true, pcId: pcId });\n                reconnectTimerId = setInterval(function () {\n                    maybeOpenWebsocketConnection({ reconnecting: true, pcId: pcId });\n                }, 30 * 1000);\n            }\n        },\n    });\n};\nvar startStatsCollection = function (nailUp) {\n    if (nailUp === void 0) { nailUp = false; }\n    globalContext.clearInterval(getStatsInterval);\n    if (nailUp) {\n        (0, exports.sdkLog)(\"debug\", \"startStatsCollection - nail up\");\n        var _loop_1 = function (pcInfo) {\n            if (pcInfo.pc.signalingState !== \"closed\") {\n                pcInfo.pc.getStats(null).then(function (res) {\n                    var now = {};\n                    if (standardGetstats || isFirefox || isSafari) {\n                        if (isFirefox) {\n                            res.forEach(function (report) {\n                                now[\"\".concat(report.type, \"_\").concat(report.id)] = report;\n                            });\n                        }\n                        else {\n                            now = (0, utils_1.map2obj)(res);\n                        }\n                    }\n                    else {\n                        now = (0, utils_1.mangleChromeStats)(pcInfo.pc, res);\n                    }\n                    pcInfo.nailUpRef = JSON.parse(JSON.stringify(now));\n                });\n            }\n        };\n        // collect the new reference reports to use\n        for (var _i = 0, _a = Object.values(openChannels); _i < _a.length; _i++) {\n            var pcInfo = _a[_i];\n            _loop_1(pcInfo);\n        }\n    }\n    getStatsInterval = globalContext.setInterval(function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var stats, _i, _a, pcInfo, _b, peer, streams;\n            return __generator(this, function (_c) {\n                switch (_c.label) {\n                    case 0:\n                        if (!(!isManualConnect && (0, utils_1.countOfValidConnections)(openChannels) === 0)) return [3 /*break*/, 1];\n                        if (watchrtcConfig === null || watchrtcConfig === void 0 ? void 0 : watchrtcConfig.logGetStats) {\n                            (0, exports.sdkLog)(\"debug\", \"getStatsInterval. No valid connections at this time\");\n                        }\n                        // if we don't have any connection for 20 sec we can close the socket\n                        if (lastConnectionOpen && lastConnectionOpen + 20000 < Date.now()) {\n                            freshConnection = true;\n                            globalContext.clearInterval(getStatsInterval);\n                            socket === null || socket === void 0 ? void 0 : socket.close();\n                            (0, exports.sdkLog)(\"info\", \"Last connection closed. watchRTCConnectionId: \".concat(connectionData === null || connectionData === void 0 ? void 0 : connectionData.connectionId, \" sdkVersion: \").concat(version_1.default));\n                        }\n                        return [3 /*break*/, 6];\n                    case 1:\n                        lastConnectionOpen = Date.now();\n                        stats = { connections: {}, streams: {} };\n                        _i = 0, _a = Object.values(openChannels);\n                        _c.label = 2;\n                    case 2:\n                        if (!(_i < _a.length)) return [3 /*break*/, 5];\n                        pcInfo = _a[_i];\n                        if (watchrtcConfig === null || watchrtcConfig === void 0 ? void 0 : watchrtcConfig.logGetStats) {\n                            (0, exports.sdkLogWithoutTrace)(\"debug\", \"getStatsInterval. \".concat(pcInfo.id, \" signalingState: \").concat(pcInfo.pc.signalingState));\n                        }\n                        if (!(pcInfo.pc.signalingState !== \"closed\")) return [3 /*break*/, 4];\n                        return [4 /*yield*/, getStats(pcInfo)];\n                    case 3:\n                        _b = _c.sent(), peer = _b.peer, streams = _b.streams;\n                        stats.connections = __assign(__assign({}, stats.connections), peer);\n                        stats.streams = __assign(__assign({}, stats.streams), streams);\n                        _c.label = 4;\n                    case 4:\n                        _i++;\n                        return [3 /*break*/, 2];\n                    case 5:\n                        if (getStatsCallback) {\n                            getStatsCallback(stats);\n                        }\n                        _c.label = 6;\n                    case 6: return [2 /*return*/];\n                }\n            });\n        });\n    }, watchrtcConfig.collectionInterval);\n};\nvar getStats = function (pcInfo) {\n    return new Promise(function (resolve, __reject) {\n        if (pcInfo) {\n            var id_1 = pcInfo.id, pc_1 = pcInfo.pc, prev_1 = pcInfo.prev, nailUpRef_1 = pcInfo.nailUpRef;\n            if (standardGetstats || isFirefox || isSafari) {\n                pc_1.getStats(null).then(function (res) {\n                    if (watchrtcConfig === null || watchrtcConfig === void 0 ? void 0 : watchrtcConfig.logGetStats) {\n                        (0, exports.sdkLogWithoutTrace)(\"debug\", \"getStats res\", { res: res });\n                    }\n                    var now = {};\n                    if (isFirefox) {\n                        res.forEach(function (report) {\n                            now[\"\".concat(report.type, \"_\").concat(report.id)] = report;\n                        });\n                    }\n                    else {\n                        now = (0, utils_1.map2obj)(res);\n                    }\n                    var base = JSON.parse(JSON.stringify(now)); // our new prev\n                    now = (0, utils_1.applyPatchForRTT)(prev_1, now);\n                    if (nailUpRef_1) {\n                        now = (0, utils_1.subtractNailUpReferenceStats)(nailUpRef_1, now);\n                    }\n                    var data = (0, utils_1.deltaCompression)(prev_1, now);\n                    if (watchrtcConfig === null || watchrtcConfig === void 0 ? void 0 : watchrtcConfig.logGetStats) {\n                        (0, exports.sdkLogWithoutTrace)(\"debug\", \"getStats(null) [\".concat(id_1, \"]\"), { data: data });\n                    }\n                    if ((data === null || data === void 0 ? void 0 : data.timestamp) !== null && (data === null || data === void 0 ? void 0 : data.timestamp) !== -Infinity) {\n                        trace({ data: [\"getstats\", id_1, data] });\n                    }\n                    pcInfo.prev = base;\n                    resolve((0, utils_1.exposeApplicationStatsForPC)(id_1, prev_1, now, mappedTrack));\n                });\n            }\n            else {\n                pc_1.getStats(function (res) {\n                    var now = (0, utils_1.mangleChromeStats)(pc_1, res);\n                    var base = JSON.parse(JSON.stringify(now)); // our new prev\n                    if (nailUpRef_1) {\n                        now = (0, utils_1.subtractNailUpReferenceStats)(nailUpRef_1, now);\n                    }\n                    var data = (0, utils_1.deltaCompression)(prev_1, now);\n                    if (watchrtcConfig === null || watchrtcConfig === void 0 ? void 0 : watchrtcConfig.logGetStats) {\n                        (0, exports.sdkLogWithoutTrace)(\"debug\", \"getStats() [\".concat(id_1, \"]\"), { data: data });\n                    }\n                    if ((data === null || data === void 0 ? void 0 : data.timestamp) !== null && (data === null || data === void 0 ? void 0 : data.timestamp) !== -Infinity) {\n                        trace({ data: [\"getstats\", id_1, data] });\n                    }\n                    pcInfo.prev = base;\n                    resolve((0, utils_1.exposeApplicationStatsForPC)(id_1, prev_1, now, mappedTrack));\n                });\n            }\n        }\n    });\n};\nvar getHardware = function () {\n    setTimeout(function () {\n        // if get hardware take more than 50 ms then do not save it\n        var getHardwareStartTime = Date.now();\n        (0, utils_1.getHardwareInfo)()\n            .then(function (hwInfo) {\n            var getHardwareTime = Date.now() - getHardwareStartTime;\n            if (getHardwareTime <= 50000) {\n                hardwareInfo = hwInfo;\n                (0, exports.sdkLog)(\"debug\", \"getHardware\", { hardwareInfo: hardwareInfo });\n            }\n            else {\n                (0, exports.sdkLog)(\"debug\", \"getHardware failure: getHardwareTime: \".concat(getHardwareTime), { hardwareInfo: hardwareInfo });\n            }\n        })\n            .catch(function (err) {\n            (0, exports.sdkLog)(\"error\", \"Error. Get hardware info: \".concat(err.message));\n        });\n    }, 0);\n};\n/**\n * Initialize SDK.\n * @param watchrtc\n * @param prefixesToWrap\n * @param services\n */\nvar initSDK = function (watchrtc, prefixesToWrap, services) {\n    var _a, _b;\n    var initialized = globalContext.watchRTCInitialized;\n    if (initialized) {\n        (0, exports.sdkLogWithoutTrace)(\"info\", \"init. watchRTC SDK already has been initialized\");\n        return;\n    }\n    if (!globalContext.RTCPeerConnection) {\n        (0, exports.sdkLogWithoutTrace)(\"info\", \"init. RTCPeerConnection does not exist in global globalContext\");\n        return;\n    }\n    var isRTCPeerConnectionNative = globalContext.RTCPeerConnection.toString().indexOf(\"[native code]\") !== -1;\n    if (!isRTCPeerConnectionNative && isBrowser) {\n        (0, exports.sdkLog)(\"info\", \"init. RTCPeerConnection object has been already overridden\");\n    }\n    globalContext.watchRTCInitialized = true;\n    globalContext.watchRTCSessionId = (0, utils_1.generateID)();\n    getHardware();\n    if (isBrowser) {\n        var urlParams = new URLSearchParams(location.search);\n        if (urlParams.has(\"watchrtc\") && urlParams.get(\"watchrtc\") === \"debug\") {\n            watchrtc.logLevel = \"debug\";\n        }\n    }\n    socket = (services === null || services === void 0 ? void 0 : services.socketService) || new watchrtcsocket_1.default();\n    http = (services === null || services === void 0 ? void 0 : services.httpService) || new watchrtchttp_1.default();\n    watchrtc.collectionInterval = (_a = watchrtc.collectionInterval) !== null && _a !== void 0 ? _a : 8000;\n    watchrtc.logLevel = watchrtc.logLevel || \"debug\";\n    watchrtcConfig = watchrtc;\n    watchrtcIdentifiers.rtcRoomId = watchrtcConfig.rtcRoomId;\n    watchrtcIdentifiers.rtcPeerId = watchrtcConfig.rtcPeerId;\n    trace = socket.trace;\n    if (watchrtcConfig.wsUrl) {\n        (0, exports.sdkLog)(\"info\", \"\\\"wsUrl\\\" config property is deprecated. Use \\\"proxyUrl\\\" instead of it\");\n    }\n    if (watchrtcConfig.proxyUrl) {\n        (0, exports.sdkLog)(\"info\", \"\\\"proxyUrl\\\" is used\");\n    }\n    if (watchrtcConfig === null || watchrtcConfig === void 0 ? void 0 : watchrtcConfig.debug) {\n        (0, exports.sdkLog)(\"info\", \"\\\"debug\\\" config property is deprecated. Use \\\"logLevel\\\" instead of it\");\n    }\n    prefixesToWrap.forEach(function (prefix) {\n        if (!globalContext[prefix + \"RTCPeerConnection\"]) {\n            (0, exports.sdkLog)(\"debug\", \"RTCPeerConnection prefixes override failed\");\n            return;\n        }\n        var origPeerConnection = globalContext[prefix + \"RTCPeerConnection\"];\n        var peerconnection = function (config, constraints) {\n            if (config === null || config === void 0 ? void 0 : config.watchrtc) {\n                watchrtcConfig = __assign(__assign({}, watchrtcConfig), config.watchrtc);\n                watchrtcIdentifiers.rtcRoomId = watchrtcConfig.rtcRoomId;\n                watchrtcIdentifiers.rtcPeerId = watchrtcConfig.rtcPeerId;\n            }\n            var pc = new origPeerConnection(config, constraints);\n            var id = \"PC_\" + peerconnectioncounter++;\n            pc.__rtcStatsId = id;\n            openChannels[id] = {\n                id: id,\n                pc: pc,\n                validConnection: false,\n            };\n            if (!config) {\n                config = { nullConfig: true };\n            }\n            config = JSON.parse(JSON.stringify(config)); // deepcopy\n            // don't log credentials\n            ((config && config.iceServers) || []).forEach(function (server) {\n                delete server.credential;\n            });\n            if (config === null || config === void 0 ? void 0 : config.watchrtc) {\n                delete config.watchrtc;\n            }\n            if (isFirefox) {\n                config.browserType = \"moz\";\n            }\n            else {\n                config.browserType = \"webkit\";\n            }\n            (0, exports.sdkLog)(\"debug\", \"new RTCPeerConnection called.\", {\n                config: JSON.stringify(config),\n                constraints: constraints,\n            });\n            trace({ data: [\"create\", id, config] });\n            // TODO: do we want to log constraints here? They are chrome-proprietary.\n            // http://stackoverflow.com/questions/31003928/what-do-each-of-these-experimental-goog-rtcpeerconnectionconstraints-do\n            if (constraints) {\n                trace({ data: [\"constraints\", id, constraints] });\n            }\n            pc.addEventListener(\"icecandidate\", function (e) {\n                (0, exports.sdkLog)(\"debug\", \"onicecandidate id:[\".concat(id, \"], candidate:[\").concat(e.candidate, \"]\"));\n                trace({ data: [\"onicecandidate\", id, e.candidate] });\n            });\n            pc.addEventListener(\"icecandidateerror\", function (e) {\n                (0, exports.sdkLog)(\"debug\", \"onicecandidateerror id:[\".concat(id, \"], error:[\").concat(e.errorCode, \":\").concat(e.errorText, \"]\"));\n                trace({ data: [\"onicecandidateerror\", id, \"\".concat(e.errorCode, \":\").concat(e.errorText)] });\n            });\n            pc.addEventListener(\"addstream\", function (e) {\n                trace({\n                    data: [\n                        \"onaddstream\",\n                        id,\n                        e.stream.id +\n                            \" \" +\n                            e.stream.getTracks().map(function (t) {\n                                return t.kind + \":\" + t.id;\n                            }),\n                    ],\n                });\n            });\n            pc.addEventListener(\"track\", function (e) {\n                trace({\n                    data: [\n                        \"ontrack\",\n                        id,\n                        debugTrack(e.track) +\n                            \" \" +\n                            e.streams.map(function (stream) {\n                                return \"stream:\" + stream.id;\n                            }),\n                    ],\n                });\n                // https://redmine.testrtc.com/issues/7166\n                e.track.addEventListener(\"ended\", function () {\n                    trace({\n                        data: [\n                            \"ontrack\",\n                            id,\n                            debugTrack(e.track) +\n                                \" \" +\n                                e.streams.map(function (stream) {\n                                    return \"stream:\" + stream.id;\n                                }),\n                        ],\n                    });\n                });\n                // Disable mute/umute tracks events: https://redmine.testrtc.com/issues/9240\n                // e.track.addEventListener(\"mute\", () => {\n                //   trace({\n                //     data: [\n                //       \"ontrack\",\n                //       id,\n                //       debugTrack(e.track) +\n                //         \" \" +\n                //         e.streams.map((stream: any) => {\n                //           return \"stream:\" + stream.id;\n                //         }),\n                //     ],\n                //   });\n                // });\n                //\n                // e.track.addEventListener(\"unmute\", () => {\n                //   trace({\n                //     data: [\n                //       \"ontrack\",\n                //       id,\n                //       debugTrack(e.track) +\n                //         \" \" +\n                //         e.streams.map((stream: any) => {\n                //           return \"stream:\" + stream.id;\n                //         }),\n                //     ],\n                //   });\n                // });\n            });\n            pc.addEventListener(\"removestream\", function (e) {\n                trace({\n                    data: [\n                        \"onremovestream\",\n                        id,\n                        e.stream.id +\n                            \" \" +\n                            e.stream.getTracks().map(function (t) {\n                                return t.kind + \":\" + t.id;\n                            }),\n                    ],\n                });\n            });\n            pc.addEventListener(\"signalingstatechange\", function () {\n                if (openChannels[id] && !openChannels[id].validConnection) {\n                    openChannels[id].validConnection = true;\n                    setTimeout(function () {\n                        (0, exports.sdkLog)(\"debug\", \"signalingstatechage. forceRecreate websocket connection[\".concat(id, \"]\"), {\n                            openChannels: JSON.stringify(openChannels),\n                        });\n                        maybeOpenWebsocketConnection({ forceRecreate: true, pcId: id });\n                    }, 5000);\n                }\n                else {\n                    (0, exports.sdkLog)(\"debug\", \"signalingstatechage. WS connection opening not triggered - peer connection not in channels or was already opened [\".concat(id, \"]\"), { openChannels: JSON.stringify(openChannels) });\n                }\n                trace({ data: [\"onsignalingstatechange\", id, pc.signalingState] });\n            });\n            pc.addEventListener(\"iceconnectionstatechange\", function () {\n                (0, exports.sdkLog)(\"debug\", \"oniceconnectionstatechange id:[\".concat(id, \"], state:[\").concat(pc.iceConnectionState, \"]\"));\n                trace({ data: [\"oniceconnectionstatechange\", id, pc.iceConnectionState] });\n            });\n            pc.addEventListener(\"icegatheringstatechange\", function () {\n                (0, exports.sdkLog)(\"debug\", \"onicegatheringstatechange id:[\".concat(id, \"], state:[\").concat(pc.iceGatheringState, \"]\"));\n                trace({ data: [\"onicegatheringstatechange\", id, pc.iceGatheringState] });\n            });\n            pc.addEventListener(\"connectionstatechange\", function () {\n                (0, exports.sdkLog)(\"debug\", \"onconnectionstatechange id:[\".concat(id, \"], state:[\").concat(pc.connectionState, \"]\"));\n                trace({ data: [\"onconnectionstatechange\", id, pc.connectionState] });\n            });\n            pc.addEventListener(\"negotiationneeded\", function () {\n                (0, exports.sdkLog)(\"debug\", \"onnegotiationneeded id:[\".concat(id, \"]\"));\n                trace({ data: [\"onnegotiationneeded\", id, undefined] });\n            });\n            pc.addEventListener(\"datachannel\", function (event) {\n                (0, exports.sdkLog)(\"debug\", \"ondatachannel id:[\".concat(id, \"], data:[\").concat(event.channel.id, \" \").concat(event.channel.label, \"]\"));\n                trace({ data: [\"ondatachannel\", id, [event.channel.id, event.channel.label]] });\n            });\n            // https://redmine.testrtc.com/issues/6529\n            // pc.addEventListener(\"iceconnectionstatechange\", () => {\n            //   if (pc.iceConnectionState === \"connected\") {\n            //     getStats(openChannels[id]);\n            //   }\n            // });\n            (0, exports.sdkLog)(\"debug\", \"RTCPeerConnection override complete [\".concat(id, \"].\"));\n            return pc;\n        };\n        if (\"HTMLMediaElement\" in globalContext && \"setSinkId\" in HTMLMediaElement.prototype) {\n            var nativeMethod_1 = HTMLMediaElement.prototype.setSinkId;\n            HTMLMediaElement.prototype.setSinkId = function () {\n                var selectedDeviceId = arguments[0];\n                navigator.mediaDevices\n                    .enumerateDevices()\n                    .then(function (devices) {\n                    var currentDevice = devices.find(function (_a) {\n                        var deviceId = _a.deviceId;\n                        return deviceId === selectedDeviceId;\n                    });\n                    if (currentDevice && currentDevice.deviceId !== currentAudioOutputId) {\n                        trace({ data: [\"audioOutputChange\", null, currentDevice.label] });\n                    }\n                    currentAudioOutputId = selectedDeviceId;\n                })\n                    .catch(function (error) {\n                    (0, exports.sdkLog)(\"debug\", error.message, { error: error });\n                });\n                return nativeMethod_1.apply(this, arguments);\n            };\n        }\n        // wrap RTCRtpTransceiver.setCodecPreferences\n        if (\"RTCRtpTransceiver\" in globalContext && \"setCodecPreferences\" in globalContext.RTCRtpTransceiver.prototype) {\n            var origRTCRtpTransceiver = globalContext.RTCRtpTransceiver;\n            var nativeMethod_2 = origRTCRtpTransceiver.prototype.setCodecPreferences;\n            origRTCRtpTransceiver.prototype.setCodecPreferences = function () {\n                trace({ data: [\"setCodecPreferences\", this.__pcId, arguments] });\n                return nativeMethod_2.apply(this, arguments);\n            };\n        }\n        // wrap RTCRtpSender.setParameters\n        if (\"RTCRtpSender\" in globalContext && \"setParameters\" in globalContext.RTCRtpSender.prototype) {\n            var origRTCRtpSender = globalContext.RTCRtpSender;\n            var nativeMethod_3 = origRTCRtpSender.prototype.setParameters;\n            origRTCRtpSender.prototype.setParameters = function () {\n                trace({ data: [\"setParameters\", this.__pcId, arguments] });\n                return nativeMethod_3.apply(this, arguments);\n            };\n        }\n        // wrap RTCRtpSender.replaceTrack\n        if (\"RTCRtpSender\" in globalContext && \"replaceTrack\" in globalContext.RTCRtpSender.prototype) {\n            var origRTCRtpSender = globalContext.RTCRtpSender;\n            var nativeMethod_4 = origRTCRtpSender.prototype.replaceTrack;\n            origRTCRtpSender.prototype.replaceTrack = function () {\n                var track = arguments[0];\n                if (track) {\n                    trace({\n                        data: [\"replaceTrack\", this.__pcId, debugTrack(track)],\n                    });\n                    // Check if the label is not the same as previous one - to detect a device change\n                    var originalTrack = this.track;\n                    if (originalTrack && originalTrack.label !== track.label) {\n                        trace({ data: [\"\".concat(track.kind, \"InputChange\"), this.__pcId, track.label] });\n                    }\n                }\n                else {\n                    trace({ data: [\"replaceTrack\", this.__pcId, null] });\n                }\n                return nativeMethod_4.apply(this, arguments);\n            };\n        }\n        // adding pc id to sender for above logic\n        [\"addTransceiver\"].forEach(function (method) {\n            var nativeMethod = origPeerConnection.prototype[method];\n            if (nativeMethod) {\n                origPeerConnection.prototype[method] = function () {\n                    var _this_1 = this;\n                    var streams = \"\";\n                    if (arguments[1] && arguments[1].streams) {\n                        streams = arguments[1].streams.map(function (s) { return \"stream:\" + s.id; }).join(\";\");\n                    }\n                    var trackOrKind = typeof arguments[0] === \"string\"\n                        ? arguments[0]\n                        : arguments[0].kind + \":\" + arguments[0].id + \" \" + arguments[0].label;\n                    var init = arguments[1] ? __assign(__assign({}, arguments[1]), { streams: streams }) : null;\n                    trace({ data: [method, this.__rtcStatsId, [trackOrKind, init]] });\n                    var transceiver = nativeMethod.apply(this, arguments);\n                    transceiver.sender.__pcId = this.__rtcStatsId;\n                    // https://redmine.testrtc.com/issues/7166\n                    var track = arguments[0];\n                    if (typeof track === \"object\") {\n                        trace({\n                            data: [\"onlocaltrack\", this.__rtcStatsId, debugTrack(track)],\n                        });\n                        track.addEventListener(\"ended\", function () {\n                            trace({\n                                data: [\"onlocaltrack\", _this_1.__rtcStatsId, debugTrack(track)],\n                            });\n                        });\n                        // Disable mute/umute tracks events: https://redmine.testrtc.com/issues/9240\n                        // track.addEventListener(\"mute\", () => {\n                        //   trace({\n                        //     data: [\"onlocaltrack\", this.__rtcStatsId, debugTrack(track)],\n                        //   });\n                        // });\n                        //\n                        // track.addEventListener(\"unmute\", () => {\n                        //   trace({\n                        //     data: [\"onlocaltrack\", this.__rtcStatsId, debugTrack(track)],\n                        //   });\n                        // });\n                    }\n                    return transceiver;\n                };\n            }\n        });\n        [\"createDataChannel\", \"restartIce\"].forEach(function (method) {\n            var nativeMethod = origPeerConnection.prototype[method];\n            if (nativeMethod) {\n                origPeerConnection.prototype[method] = function () {\n                    trace({ data: [method, this.__rtcStatsId, arguments] });\n                    return nativeMethod.apply(this, arguments);\n                };\n            }\n        });\n        [\"close\"].forEach(function (method) {\n            var nativeMethod = origPeerConnection.prototype[method];\n            if (nativeMethod) {\n                origPeerConnection.prototype[method] = function () {\n                    trace({ data: [method, this.__rtcStatsId, arguments] });\n                    delete openChannels[this.__rtcStatsId];\n                    isManualDisconnect = true;\n                    (0, exports.sdkLog)(\"debug\", \"on RTCPeerConnection(\".concat(this.__rtcStatsId, \") close\"));\n                    return nativeMethod.apply(this, arguments);\n                };\n            }\n        });\n        [\"addStream\", \"removeStream\"].forEach(function (method) {\n            var nativeMethod = origPeerConnection.prototype[method];\n            if (nativeMethod) {\n                origPeerConnection.prototype[method] = function () {\n                    var _this_1 = this;\n                    var stream = arguments[0];\n                    var streamInfo = stream\n                        .getTracks()\n                        .map(function (t) {\n                        return t.kind + \":\" + t.id;\n                    })\n                        .join(\",\");\n                    trace({ data: [method, this.__rtcStatsId, stream.id + \" \" + streamInfo] });\n                    // https://redmine.testrtc.com/issues/7166\n                    if (method === \"addStream\") {\n                        stream.getTracks().map(function (track) {\n                            trace({\n                                data: [\"onlocaltrack\", _this_1.__rtcStatsId, debugTrack(track) + \" \" + stream.id],\n                            });\n                            track.addEventListener(\"ended\", function () {\n                                trace({\n                                    data: [\"onlocaltrack\", _this_1.__rtcStatsId, debugTrack(track) + \" \" + stream.id],\n                                });\n                            });\n                            // Disable mute/umute tracks events: https://redmine.testrtc.com/issues/9240\n                            // track.addEventListener(\"mute\", () => {\n                            //   trace({\n                            //     data: [\"onlocaltrack\", this.__rtcStatsId, debugTrack(track) + \" \" + stream.id],\n                            //   });\n                            // });\n                            //\n                            // track.addEventListener(\"unmute\", () => {\n                            //   trace({\n                            //     data: [\"onlocaltrack\", this.__rtcStatsId, debugTrack(track) + \" \" + stream.id],\n                            //   });\n                            // });\n                        });\n                    }\n                    return nativeMethod.apply(this, arguments);\n                };\n            }\n        });\n        [\"addTrack\"].forEach(function (method) {\n            var nativeMethod = origPeerConnection.prototype[method];\n            if (nativeMethod) {\n                origPeerConnection.prototype[method] = function () {\n                    var _this_1 = this;\n                    var track = arguments[0];\n                    var streams = [].slice.call(arguments, 1);\n                    trace({\n                        data: [\n                            method,\n                            this.__rtcStatsId,\n                            debugTrack(track) +\n                                \" \" +\n                                (streams\n                                    .map(function (s) {\n                                    return \"stream:\" + s.id;\n                                })\n                                    .join(\";\") || \"-\"),\n                        ],\n                    });\n                    // https://redmine.testrtc.com/issues/7166\n                    trace({\n                        data: [\n                            \"onlocaltrack\",\n                            this.__rtcStatsId,\n                            debugTrack(track) +\n                                \" \" +\n                                streams.map(function (stream) {\n                                    return \"stream:\" + stream.id;\n                                }),\n                        ],\n                    });\n                    track.addEventListener(\"ended\", function () {\n                        trace({\n                            data: [\n                                \"onlocaltrack\",\n                                _this_1.__rtcStatsId,\n                                debugTrack(track) +\n                                    \" \" +\n                                    streams.map(function (stream) {\n                                        return \"stream:\" + stream.id;\n                                    }),\n                            ],\n                        });\n                    });\n                    // Disable mute/umute tracks events: https://redmine.testrtc.com/issues/9240\n                    // track.addEventListener(\"mute\", () => {\n                    //   trace({\n                    //     data: [\n                    //       \"onlocaltrack\",\n                    //       this.__rtcStatsId,\n                    //       debugTrack(track) +\n                    //         \" \" +\n                    //         streams.map((stream: any) => {\n                    //           return \"stream:\" + stream.id;\n                    //         }),\n                    //     ],\n                    //   });\n                    // });\n                    //\n                    // track.addEventListener(\"unmute\", () => {\n                    //   trace({\n                    //     data: [\n                    //       \"onlocaltrack\",\n                    //       this.__rtcStatsId,\n                    //       debugTrack(track) +\n                    //         \" \" +\n                    //         streams.map((stream: any) => {\n                    //           return \"stream:\" + stream.id;\n                    //         }),\n                    //     ],\n                    //   });\n                    // });\n                    var sender = nativeMethod.apply(this, arguments);\n                    sender.__pcId = this.__rtcStatsId;\n                    // Associate the peer id to the existing transceivers\n                    var transceivers = this.getTransceivers();\n                    if (transceivers) {\n                        transceivers.forEach(function (transceiver) {\n                            transceiver.__pcId = _this_1.__rtcStatsId;\n                        });\n                    }\n                    return sender;\n                };\n            }\n        });\n        [\"removeTrack\"].forEach(function (method) {\n            var nativeMethod = origPeerConnection.prototype[method];\n            if (nativeMethod) {\n                origPeerConnection.prototype[method] = function () {\n                    var track = arguments[0].track;\n                    trace({\n                        data: [method, this.__rtcStatsId, track ? debugTrack(track) : \"null\"],\n                    });\n                    return nativeMethod.apply(this, arguments);\n                };\n            }\n        });\n        [\"createOffer\", \"createAnswer\"].forEach(function (method) {\n            var nativeMethod = origPeerConnection.prototype[method];\n            if (nativeMethod) {\n                origPeerConnection.prototype[method] = function () {\n                    var rtcStatsId = this.__rtcStatsId;\n                    var args = arguments;\n                    var opts;\n                    if (arguments.length === 1 && typeof arguments[0] === \"object\") {\n                        opts = arguments[0];\n                    }\n                    else if (arguments.length === 3 && typeof arguments[2] === \"object\") {\n                        opts = arguments[2];\n                    }\n                    trace({ data: [method, this.__rtcStatsId, opts] });\n                    return nativeMethod.apply(this, opts ? [opts] : undefined).then(function (description) {\n                        trace({ data: [method + \"OnSuccess\", rtcStatsId, description] });\n                        if (args.length > 0 && typeof args[0] === \"function\") {\n                            args[0].apply(null, [description]);\n                            return undefined;\n                        }\n                        return description;\n                    }, function (err) {\n                        trace({ data: [method + \"OnFailure\", rtcStatsId, err.toString()] });\n                        if (args.length > 1 && typeof args[1] === \"function\") {\n                            args[1].apply(null, [err]);\n                            return;\n                        }\n                        throw err;\n                    });\n                };\n            }\n        });\n        [\"setLocalDescription\", \"setRemoteDescription\", \"addIceCandidate\"].forEach(function (method) {\n            var nativeMethod = origPeerConnection.prototype[method];\n            if (nativeMethod) {\n                origPeerConnection.prototype[method] = function () {\n                    var rtcStatsId = this.__rtcStatsId;\n                    var args = arguments;\n                    var _this = this;\n                    // because of setLocalDescription(null) sometimes we don't have SDP value\n                    // fippo suggested: Access pc.localDescription.sdp in the successcallback\n                    var needToHandleSDPInSuccessCallback = method === \"setLocalDescription\" && (!args[0] || (args[0] && !args[0].sdp));\n                    trace({\n                        data: [method, this.__rtcStatsId, needToHandleSDPInSuccessCallback ? { parameterless: true } : args[0]],\n                    });\n                    return nativeMethod.apply(this, [args[0]]).then(function () {\n                        trace({\n                            data: [\n                                method + \"OnSuccess\",\n                                rtcStatsId,\n                                needToHandleSDPInSuccessCallback ? _this === null || _this === void 0 ? void 0 : _this.localDescription : undefined,\n                            ],\n                        });\n                        if (args.length >= 2 && typeof args[1] === \"function\") {\n                            args[1].apply(null, []);\n                            return undefined;\n                        }\n                        return undefined;\n                    }, function (err) {\n                        trace({ data: [method + \"OnFailure\", rtcStatsId, err.toString()] });\n                        if (args.length >= 3 && typeof args[2] === \"function\") {\n                            args[2].apply(null, [err]);\n                            return undefined;\n                        }\n                        throw err;\n                    });\n                };\n            }\n        });\n        // wrap static methods. Currently just generateCertificate.\n        if (origPeerConnection.generateCertificate) {\n            Object.defineProperty(peerconnection, \"generateCertificate\", {\n                get: function () {\n                    return arguments.length\n                        ? origPeerConnection.generateCertificate.apply(null, arguments)\n                        : origPeerConnection.generateCertificate;\n                },\n            });\n        }\n        globalContext[prefix + \"RTCPeerConnection\"] = peerconnection;\n        globalContext[prefix + \"RTCPeerConnection\"].prototype = origPeerConnection.prototype;\n        (0, exports.sdkLog)(\"debug\", \"RTCPeerConnection prefixes override complete\");\n    });\n    if (isBrowser) {\n        // getUserMedia wrappers\n        prefixesToWrap.forEach(function (prefix) {\n            var name = prefix + (prefix.length ? \"GetUserMedia\" : \"getUserMedia\");\n            if (!navigator[name]) {\n                return;\n            }\n            var origGetUserMedia = navigator[name].bind(navigator);\n            var gum = function () {\n                trace({ data: [\"getUserMedia\", null, arguments[0]] });\n                var cb = arguments[1];\n                var eb = arguments[2];\n                origGetUserMedia(arguments[0], function (stream) {\n                    // we log the stream id, track ids and tracks readystate since that is ended GUM fails\n                    // to acquire the cam (in chrome)\n                    trace({ data: [\"getUserMediaOnSuccess\", null, (0, utils_1.dumpStream)(stream)] });\n                    if (cb) {\n                        cb(stream);\n                    }\n                }, function (err) {\n                    var errorData = [\"getUserMediaOnFailure\", null, err.name];\n                    trace({ data: errorData });\n                    httpReportError(errorData);\n                    if (eb) {\n                        eb(err);\n                    }\n                });\n            };\n            navigator[name] = gum.bind(navigator);\n        });\n        if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {\n            var origGetUserMedia_1 = navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);\n            var gum = function () {\n                trace({ data: [\"navigator.mediaDevices.getUserMedia\", null, arguments[0]] });\n                return origGetUserMedia_1.apply(navigator.mediaDevices, arguments).then(function (stream) {\n                    trace({ data: [\"navigator.mediaDevices.getUserMediaOnSuccess\", null, (0, utils_1.dumpStream)(stream)] });\n                    return stream;\n                }, function (err) {\n                    var errorData = [\"navigator.mediaDevices.getUserMediaOnFailure\", null, err.name];\n                    trace({ data: errorData });\n                    httpReportError(errorData);\n                    return Promise.reject(err);\n                });\n            };\n            navigator.mediaDevices.getUserMedia = gum.bind(navigator.mediaDevices);\n        }\n        // getDisplayMedia\n        if (navigator.mediaDevices && navigator.mediaDevices.getDisplayMedia) {\n            var origGetDisplayMedia_1 = navigator.mediaDevices.getDisplayMedia.bind(navigator.mediaDevices);\n            var gdm = function () {\n                trace({ data: [\"navigator.mediaDevices.getDisplayMedia\", null, arguments[0]] });\n                return origGetDisplayMedia_1.apply(navigator.mediaDevices, arguments).then(function (stream) {\n                    trace({ data: [\"navigator.mediaDevices.getDisplayMediaOnSuccess\", null, (0, utils_1.dumpStream)(stream)] });\n                    return stream;\n                }, function (err) {\n                    var errorData = [\"navigator.mediaDevices.getDisplayMediaOnFailure\", null, err.name];\n                    trace({ data: errorData });\n                    httpReportError(errorData);\n                    return Promise.reject(err);\n                });\n            };\n            navigator.mediaDevices.getDisplayMedia = gdm.bind(navigator.mediaDevices);\n        }\n    }\n    if ((_b = watchrtc.console) === null || _b === void 0 ? void 0 : _b.level) {\n        (0, utils_1.setConsoleLevel)(watchrtc.console.level, trace);\n    }\n};\nexports.initSDK = initSDK;\nvar setConfig = function (newWatchrtcConfig) {\n    var _a;\n    var initialized = globalContext.watchRTCInitialized;\n    if (!initialized) {\n        (0, exports.sdkLog)(\"error\", \"SDK is not initialized. Use 'init' function first.\");\n        return;\n    }\n    var collectConsoleDisabled = (watchrtcConfig === null || watchrtcConfig === void 0 ? void 0 : watchrtcConfig.allowBrowserLogCollection) === false;\n    if (!collectConsoleDisabled && ((_a = newWatchrtcConfig === null || newWatchrtcConfig === void 0 ? void 0 : newWatchrtcConfig.console) === null || _a === void 0 ? void 0 : _a.override) === true && newWatchrtcConfig.console.level) {\n        (0, utils_1.setConsoleLevel)(newWatchrtcConfig.console.level, trace);\n    }\n    if (\"collectionInterval\" in newWatchrtcConfig) {\n        delete newWatchrtcConfig.collectionInterval;\n    }\n    watchrtcConfig = __assign(__assign({}, watchrtcConfig), newWatchrtcConfig);\n    watchrtcIdentifiers.rtcRoomId = watchrtcConfig.rtcRoomId;\n    watchrtcIdentifiers.rtcPeerId = watchrtcConfig.rtcPeerId;\n    (0, exports.sdkLog)(\"debug\", \"setConfig\", {\n        newWatchrtcConfig: JSON.stringify(newWatchrtcConfig),\n        watchrtcConfig: JSON.stringify(watchrtcConfig),\n    });\n    maybeOpenWebsocketConnection({});\n};\nexports.setConfig = setConfig;\n/**\n * Set user rating and/or comment for peer session\n * @param rating number from 1 to 5\n * @param comment string\n */\nvar setUserRating = function (\n/** 1 | 2 | 3 | 4 | 5 */\nrating, ratingComment) {\n    var _a;\n    var initialized = globalContext.watchRTCInitialized;\n    if (!initialized) {\n        (0, exports.sdkLog)(\"error\", \"SDK is not initialized. Use 'init' function first.\");\n        return Promise.resolve({ error: \"SDK is not initialized. Use 'init' function first.\" });\n    }\n    var isValidRating = (0, utils_1.validateRating)(rating);\n    if (!isValidRating) {\n        return Promise.resolve({ error: \"Rating is invalid\" });\n    }\n    var opened = ((_a = socket === null || socket === void 0 ? void 0 : socket.connection) === null || _a === void 0 ? void 0 : _a.readyState) === globalContext.WebSocket.OPEN;\n    var data = [\"userRating\", null, { rating: rating, ratingComment: ratingComment }];\n    return new Promise(function (resolve, reject) {\n        var options = { promiseFuncs: { resolve: resolve, reject: reject } };\n        if (opened) {\n            trace({ data: data, options: options });\n        }\n        else {\n            httpTrace.apply(void 0, data).then(function () { return resolve({}); })\n                .catch(function (error) { return resolve({ error: error }); });\n        }\n    });\n};\nexports.setUserRating = setUserRating;\n/**\n * Add keys for peer session\n * @param keys\n */\nvar addKeys = function (\n/** { \"key1\": \"value1\", \"key2\": [\"value2_1\", \"value2_2\"]} */\nkeys) {\n    var _a;\n    var initialized = globalContext.watchRTCInitialized;\n    if (!initialized) {\n        (0, exports.sdkLog)(\"error\", \"SDK is not initialized. Use 'init' function first.\");\n        return;\n    }\n    Object.keys(keys || {}).forEach(function (k) {\n        if (typeof keys[k] === \"string\") {\n            keys[k] = [keys[k]];\n        }\n    });\n    var data = [\"keys\", null, keys];\n    var opened = ((_a = socket === null || socket === void 0 ? void 0 : socket.connection) === null || _a === void 0 ? void 0 : _a.readyState) === globalContext.WebSocket.OPEN;\n    var wasConnected = socket === null || socket === void 0 ? void 0 : socket.wasConnected;\n    return new Promise(function (resolve, reject) {\n        var options = { promiseFuncs: { resolve: resolve, reject: reject } };\n        if (opened) {\n            trace({ data: data, options: options });\n        }\n        else if (!wasConnected) {\n            trace({ data: data, options: options });\n        }\n        else {\n            httpTrace.apply(void 0, data).then(function () { return resolve({}); })\n                .catch(function (error) { return resolve({ error: error }); });\n        }\n    });\n};\nexports.addKeys = addKeys;\nvar disableDataCollection = function () {\n    var initialized = globalContext.watchRTCInitialized;\n    if (!initialized) {\n        (0, exports.sdkLog)(\"error\", \"SDK is not initialized. Use 'init' function first.\");\n        return;\n    }\n    trace({ data: [\"disableDataCollection\", null, null] });\n    socket === null || socket === void 0 ? void 0 : socket.disableDataCollection();\n};\nexports.disableDataCollection = disableDataCollection;\nvar enableDataCollection = function () {\n    var initialized = globalContext.watchRTCInitialized;\n    if (!initialized) {\n        (0, exports.sdkLog)(\"error\", \"SDK is not initialized. Use 'init' function first.\");\n        return;\n    }\n    trace({ data: [\"enableDataCollection\", null, null] });\n    socket === null || socket === void 0 ? void 0 : socket.enableDataCollection();\n};\nexports.enableDataCollection = enableDataCollection;\nvar addEvent = function (event) {\n    var initialized = globalContext.watchRTCInitialized;\n    if (!initialized) {\n        (0, exports.sdkLog)(\"error\", \"addEvent error. SDK is not initialized. Use 'init' function first.\");\n        return;\n    }\n    // const opened = socket?.connection?.readyState === WS.OPEN;\n    // if (!opened && socket?.wasConnected) {\n    //   sdkLog(\"error\", `addEvent error. Connection has been closed.`);\n    //   return;\n    // }\n    var isEventValid = (0, utils_1.validateEvent)(event, openChannels);\n    if (!isEventValid) {\n        return;\n    }\n    // Don't keep `pc` information in event, only extract the id\n    var validatedEvent = __assign({}, event);\n    var source = null;\n    if (validatedEvent.pc) {\n        source = validatedEvent.pc.__rtcStatsId || null;\n        delete validatedEvent.pc;\n    }\n    var data = [\"event\", source, validatedEvent];\n    return new Promise(function (resolve, reject) {\n        var options = { promiseFuncs: { resolve: resolve, reject: reject } };\n        trace({ data: data, options: options });\n    });\n};\nexports.addEvent = addEvent;\nvar mapStream = function (id, name) {\n    var initialized = globalContext.watchRTCInitialized;\n    if (!initialized) {\n        (0, exports.sdkLog)(\"error\", \"mapStream error. SDK is not initialized. Use 'init' function first.\");\n        return;\n    }\n    var isDataValid = !!id && !!name;\n    if (!isDataValid) {\n        return;\n    }\n    var data = [\"mapStream\", null, { id: id, name: name }];\n    (0, exports.sdkLog)(\"info\", \"mapStream method is deprecated. Please use mapTrack instead.\");\n    trace({ data: data });\n};\nexports.mapStream = mapStream;\nvar mapTrack = function (id, name) {\n    var initialized = globalContext.watchRTCInitialized;\n    if (!initialized) {\n        (0, exports.sdkLog)(\"error\", \"mapTrack error. SDK is not initialized. Use 'init' function first.\");\n        return;\n    }\n    var isDataValid = !!id && !!name;\n    if (!isDataValid) {\n        return;\n    }\n    mappedTrack[id] = name;\n    var data = [\"mapTrack\", null, { id: id, name: name }];\n    trace({ data: data });\n};\nexports.mapTrack = mapTrack;\nvar connect = function () {\n    var initialized = globalContext.watchRTCInitialized;\n    if (!initialized) {\n        (0, exports.sdkLog)(\"error\", \"connect error. SDK is not initialized. Use 'init' function first.\");\n        return;\n    }\n    freshConnection = true;\n    isManualConnect = true;\n    (0, exports.sdkLog)(\"debug\", \"manual connect\");\n    maybeOpenWebsocketConnection({});\n};\nexports.connect = connect;\nvar disconnect = function () {\n    var initialized = globalContext.watchRTCInitialized;\n    if (!initialized) {\n        (0, exports.sdkLog)(\"error\", \"disconnect error. SDK is not initialized. Use 'init' function first.\");\n        return;\n    }\n    isManualConnect = false;\n    isManualDisconnect = true;\n    socket === null || socket === void 0 ? void 0 : socket.close();\n    (0, exports.sdkLog)(\"debug\", \"manual disconnect\");\n};\nexports.disconnect = disconnect;\nvar registerOnStatsListener = function (listener) {\n    getStatsCallback = listener;\n};\nexports.registerOnStatsListener = registerOnStatsListener;\nvar registerStateListener = function (listener) {\n    stateListener = listener;\n};\nexports.registerStateListener = registerStateListener;\nvar httpTrace = function () {\n    var _a;\n    var data = [];\n    for (var _i = 0; _i < arguments.length; _i++) {\n        data[_i] = arguments[_i];\n    }\n    if (!watchrtcIdentifiers.rtcRoomId || !watchrtcIdentifiers.rtcPeerId) {\n        var message = \"Missing configuration parameters rtcPeerId and rtcRoomId to connect\";\n        if (!watchrtcIdentifiers.rtcRoomId && watchrtcIdentifiers.rtcPeerId) {\n            message = \"Missing configuration parameter rtcRoomId to connect\";\n        }\n        else if (!watchrtcIdentifiers.rtcPeerId && watchrtcIdentifiers.rtcRoomId) {\n            message = \"Missing configuration parameter rtcPeerId to connect\";\n        }\n        (0, exports.sdkLog)(\"error\", message);\n        return Promise.reject(message);\n    }\n    if (!watchrtcIdentifiers.projectId && !watchrtcConfig.rtcApiKey) {\n        var message = \"Missing apiKey to enable trace before connection establishment\";\n        (0, exports.sdkLog)(\"info\", message);\n        return Promise.reject(message);\n    }\n    var httpConnectionData = (0, utils_1.getConnectionData)(\"http\", watchrtcConfig.rtcApiKey, watchrtcConfig.proxyUrl);\n    return http\n        ? http.trace.apply(http, __spreadArray([\"\".concat(httpConnectionData.url, \"/trace\"), (_a = watchrtcIdentifiers.projectId) !== null && _a !== void 0 ? _a : httpConnectionData.key, watchrtcIdentifiers.rtcRoomId,\n            watchrtcIdentifiers.rtcPeerId], data, false)) : Promise.reject(\"Invalid configuration of http service\");\n};\nvar httpReportError = function (data) {\n    var apiKey = watchrtcConfig === null || watchrtcConfig === void 0 ? void 0 : watchrtcConfig.rtcApiKey;\n    var rtcRoomId = watchrtcConfig === null || watchrtcConfig === void 0 ? void 0 : watchrtcConfig.rtcRoomId;\n    var rtcPeerId = watchrtcConfig === null || watchrtcConfig === void 0 ? void 0 : watchrtcConfig.rtcPeerId;\n    if (!apiKey || !rtcRoomId || !rtcPeerId) {\n        (0, exports.sdkLog)(\"error\", \"Cannot report an error. Please provide rtcApiKey, rtcRoomId and rtcPeerId \");\n        return;\n    }\n    var httpConnectionData = (0, utils_1.getConnectionData)(\"http\", watchrtcConfig === null || watchrtcConfig === void 0 ? void 0 : watchrtcConfig.rtcApiKey, watchrtcConfig.proxyUrl);\n    data = data || (socket === null || socket === void 0 ? void 0 : socket.buffer) || [];\n    http === null || http === void 0 ? void 0 : http.trace(\"\".concat(httpConnectionData.url, \"/error\"), httpConnectionData.key, rtcRoomId, rtcPeerId, data);\n};\nvar persistentEnd = function (nailUpCallEnd) {\n    var initialized = globalContext.watchRTCInitialized;\n    if (!initialized) {\n        (0, exports.sdkLog)(\"error\", \"persistentEnd error. SDK is not initialized. Use 'init' function first.\");\n        return;\n    }\n    clearInterval(getStatsInterval);\n    isManualConnect = false;\n    isManualDisconnect = true;\n    socket === null || socket === void 0 ? void 0 : socket.close(nailUpCallEnd);\n    (0, exports.sdkLog)(\"debug\", \"persistentEnd. sessionId: \".concat(globalContext.watchRTCSessionId));\n};\nexports.persistentEnd = persistentEnd;\nvar resetConnectionState = function () {\n    var _a;\n    (0, exports.sdkLog)(\"debug\", \"resetConnectionState sessionId: \".concat(globalContext.watchRTCSessionId));\n    for (var _i = 0, _b = Object.values(openChannels); _i < _b.length; _i++) {\n        var channel = _b[_i];\n        channel.prev = null;\n    }\n    if ((_a = socket === null || socket === void 0 ? void 0 : socket.buffer) === null || _a === void 0 ? void 0 : _a.length) {\n        socket.buffer = socket.buffer.filter(function (_a) {\n            var traceType = _a[0];\n            return traceType !== \"getstats\";\n        });\n    }\n};\nvar persistentStart = function (roomId, peerId) {\n    var initialized = globalContext.watchRTCInitialized;\n    if (!initialized) {\n        (0, exports.sdkLog)(\"error\", \"persistentStart error. SDK is not initialized. Use 'init' function first.\");\n        return;\n    }\n    watchrtcConfig = __assign(__assign({}, watchrtcConfig), { rtcRoomId: roomId, rtcPeerId: peerId });\n    watchrtcIdentifiers.rtcRoomId = roomId;\n    watchrtcIdentifiers.rtcPeerId = peerId;\n    resetConnectionState();\n    maybeOpenWebsocketConnection({ nailUp: true });\n    (0, exports.sdkLog)(\"debug\", \"persistentStart. sessionId: \".concat(globalContext.watchRTCSessionId), { watchrtcConfig: watchrtcConfig });\n};\nexports.persistentStart = persistentStart;\n// (globalContext as any).setUserRating = setUserRating;\n// (globalContext as any).addTags = addTags;\n// (globalContext as any).addKeys = addKeys;\n// (globalContext as any).init = initSDK;\n// (globalContext as any).addEvent = addEvent;\n// (globalContext as any).wrtcConnect = connect;\n// (globalContext as any).wrtcDisconnect = disconnect;\n/* QRTC SDK part */\nvar loadJS = function (url) {\n    return new Promise(function (resolve, reject) {\n        var script = document.createElement(\"script\");\n        script.src = url;\n        script.onload = resolve;\n        script.onerror = reject;\n        document.head.appendChild(script);\n    });\n};\nvar loadConfig = function (url) { return __awaiter(void 0, void 0, void 0, function () {\n    var response;\n    return __generator(this, function (_a) {\n        switch (_a.label) {\n            case 0: return [4 /*yield*/, fetch(url)];\n            case 1:\n                response = _a.sent();\n                return [4 /*yield*/, response.json()];\n            case 2: return [2 /*return*/, _a.sent()];\n        }\n    });\n}); };\nvar qrtcStopRequest = false;\n/*\n    const answer = await watchRTC.qualityrtc.run({\n      options: {\n        // run: \"Location\",\n\n        // if missing, will use default unpkg.com values\n        codeUrl: `http://localhost:8081/lib/main.bundle.js`,\n\n        // should not be passed, and will read from watchRTC server, passing this for development testing\n        configUrl: `https://niceincontact.testrtc.com/.netlify/functions/get-config`\n      },\n      progressCallback});\n\n */\nvar qrtcRun = function (_a) {\n    var options = _a.options, progressCallback = _a.progressCallback;\n    return __awaiter(void 0, void 0, void 0, function () {\n        var answer, codeUrl, queryParams_1, httpConnectionData, isNetlifyRequest, configUrl, _b, configAnswer, codeLoad, qualityRTC, progressCallbackWrapper, configData, netlifyBaseUrl, config;\n        return __generator(this, function (_c) {\n            switch (_c.label) {\n                case 0:\n                    if (!isBrowser) {\n                        (0, exports.sdkLogWithoutTrace)(\"info\", \"Cannot run qualityRTC test in non-browser environment\");\n                        return [2 /*return*/];\n                    }\n                    qrtcStopRequest = false;\n                    // disable WatchRTC SDK data collection while QRTC SDK working\n                    (0, exports.disableDataCollection)();\n                    _c.label = 1;\n                case 1:\n                    _c.trys.push([1, , 4, 5]);\n                    codeUrl = (options === null || options === void 0 ? void 0 : options.codeUrl) || \"https://qualityrtc-sdk.s3.amazonaws.com/\".concat(version_1.default, \"/main.bundle.js\");\n                    queryParams_1 = {};\n                    if (options) {\n                        Object.keys(options || {}).forEach(function (key) {\n                            if (typeof options[key] === \"string\") {\n                                queryParams_1[key] = options[key];\n                            }\n                        });\n                    }\n                    httpConnectionData = (0, utils_1.getConnectionData)(\"http\", watchrtcConfig === null || watchrtcConfig === void 0 ? void 0 : watchrtcConfig.rtcApiKey, watchrtcConfig.proxyUrl);\n                    isNetlifyRequest = !!(options === null || options === void 0 ? void 0 : options.configUrl);\n                    configUrl = isNetlifyRequest\n                        ? \"\".concat(options.configUrl, \"/.netlify/functions/get-config\")\n                        : httpConnectionData.url +\n                            \"/get-qualityrtc-config?apiKey=\".concat(httpConnectionData.key, \"&\").concat(new URLSearchParams(queryParams_1));\n                    console.log(\"runNetworkTest: request to run, loading lib and config\", {\n                        codeUrl: codeUrl,\n                        configUrl: configUrl,\n                    });\n                    return [4 /*yield*/, Promise.all([loadConfig(configUrl), loadJS(codeUrl)])];\n                case 2:\n                    _b = _c.sent(), configAnswer = _b[0], codeLoad = _b[1];\n                    console.log(\"runNetworkTest:JS code & config loaded\", {\n                        codeLoad: codeLoad,\n                        configAnswer: configAnswer,\n                    });\n                    qualityRTC = globalContext.__qualityRTC;\n                    if (!qualityRTC) {\n                        throw new Error(\"runNetworkTest:Failed to load qualityRTC, __qualityRTC is undefined\");\n                    }\n                    progressCallbackWrapper = function (progress) {\n                        if (qrtcStopRequest) {\n                            return false;\n                        }\n                        else if (progressCallback) {\n                            progressCallback(progress);\n                        }\n                        return true;\n                    };\n                    configData = isNetlifyRequest ? configAnswer.config : configAnswer.jsonConfig.config;\n                    netlifyBaseUrl = isNetlifyRequest ? options === null || options === void 0 ? void 0 : options.configUrl : new URL(configAnswer.url).origin;\n                    config = __assign(__assign({}, configData), { isProbe: true, options: __assign(__assign(__assign({}, configData.options), options), { wakeLock: true, netlifyBaseUrl: netlifyBaseUrl }) });\n                    console.log(\"runNetworkTest: code & config loaded, running test\", {\n                        config: config,\n                        configData: configData,\n                        qualityRTC: qualityRTC,\n                        netlifyBaseUrl: netlifyBaseUrl,\n                    });\n                    return [4 /*yield*/, qualityRTC.run({\n                            config: config,\n                            progressCallback: progressCallbackWrapper,\n                        })];\n                case 3:\n                    answer = _c.sent();\n                    console.log(\"runNetworkTest:JS Test completed\", { answer: answer });\n                    return [3 /*break*/, 5];\n                case 4:\n                    (0, exports.enableDataCollection)();\n                    return [7 /*endfinally*/];\n                case 5: return [2 /*return*/, answer];\n            }\n        });\n    });\n};\nexports.qrtcRun = qrtcRun;\nvar qrtcStop = function () {\n    if (!isBrowser) {\n        (0, exports.sdkLogWithoutTrace)(\"info\", \"Cannot run qualityRTC test in non-browser environment\");\n        return;\n    }\n    qrtcStopRequest = true;\n};\nexports.qrtcStop = qrtcStop;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.getStreamsFromStats = exports.getTransportFromStats = void 0;\nvar getTransportFromStats = function (id, reports) {\n    if (!reports) {\n        return null;\n    }\n    var reportKeys = Object.keys(reports);\n    var keyPairs = reportKeys.filter(function (reportKey) { return reports[reportKey].type === \"candidate-pair\" && reports[reportKey].nominated; });\n    if (keyPairs.length > 0) {\n        var _a = reports[keyPairs[0]], localCandidateId_1 = _a.localCandidateId, remoteCandidateId_1 = _a.remoteCandidateId;\n        var localCandidateKey = reportKeys.find(function (reportKey) { return reports[reportKey].type === \"local-candidate\" && reports[reportKey].id === localCandidateId_1; });\n        var remoteCandidateKey = reportKeys.find(function (reportKey) { return reports[reportKey].type === \"remote-candidate\" && reports[reportKey].id === remoteCandidateId_1; });\n        if (localCandidateKey && remoteCandidateKey) {\n            var localCandidate = reports[localCandidateKey];\n            var remoteCandidate = reports[remoteCandidateKey];\n            var peer = {};\n            peer[id] = {\n                connection: localCandidate.candidateType === \"relay\" ? \"relay\" : \"direct\",\n                transport: localCandidate.candidateType === \"relay\" ? localCandidate.relayProtocol : \"udp\",\n                address: \"\".concat(remoteCandidate.address, \":\").concat(remoteCandidate.port),\n            };\n            return peer;\n        }\n    }\n    return null;\n};\nexports.getTransportFromStats = getTransportFromStats;\nvar getStreamsFromStats = function (id, previous, current, mappedTrack) {\n    var streams = {};\n    var currentReportsKeys = Object.keys(current);\n    var streamsKeys = currentReportsKeys.filter(function (keys) { return current[keys].type === \"inbound-rtp\" || current[keys].type === \"outbound-rtp\"; });\n    streamsKeys.forEach(function (streamKey) {\n        var currentReport = current[streamKey];\n        var previousReport = previous && streamKey in previous ? previous[streamKey] : null;\n        var direction = currentReport.type === \"inbound-rtp\" ? \"inbound\" : \"outbound\";\n        var kind = currentReport.kind;\n        var currentRemoteReport = currentReport.remoteId in current ? current[currentReport.remoteId] : null;\n        var previousRemoteReport = previousReport && previousReport.remoteId in previous ? previous[previousReport.remoteId] : null;\n        var deltaSeconds = previousReport ? (currentReport.timestamp - previousReport.timestamp) / 1000 : null;\n        var stream = {\n            direction: direction,\n            kind: kind,\n            peerId: id,\n        };\n        // Specific video (in inbound, outbound\n        if (kind === \"video\") {\n            stream.frameWidth = currentReport.frameWidth;\n            stream.frameHeight = currentReport.frameHeight;\n            stream.framerate = currentReport.framesPerSecond;\n        }\n        if (currentReport.type === \"inbound-rtp\") {\n            stream.jitter = currentReport.jitter;\n            // For inbound stream, trackIdentifier is part of the inbound-rtp report\n            stream.mappedName =\n                currentReport.trackIdentifier in mappedTrack ? mappedTrack[currentReport.trackIdentifier] : null;\n            // Compute intermediate values if previous report exists\n            stream.bytesReceived = previousReport ? currentReport.bytesReceived - previousReport.bytesReceived : null;\n            stream.packetsReceived = previousReport ? currentReport.packetsReceived - previousReport.packetsReceived : null;\n            stream.packetsLost = previousReport ? currentReport.packetsLost - previousReport.packetsLost : null;\n            stream.packetsLoss =\n                stream.packetsLost + stream.packetsReceived > 0\n                    ? (stream.packetsLost * 100) / (stream.packetsLost + stream.packetsReceived)\n                    : null;\n            stream.bitrate = deltaSeconds ? (stream.bytesReceived * 8) / deltaSeconds : null;\n            // Compute intermediate stats from remoteId (remoteOutbound);\n            stream.roundTripTime =\n                currentRemoteReport && \"roundTripTime\" in currentRemoteReport ? currentRemoteReport.roundTripTime : null;\n        }\n        else {\n            // Compute intermediate values if previous report exists\n            stream.bytesSent = previousReport ? currentReport.bytesSent - previousReport.bytesSent : null;\n            stream.packetsSent = previousReport ? currentReport.packetsSent - previousReport.packetsSent : null;\n            stream.bitrate = deltaSeconds ? (stream.bytesSent * 8) / deltaSeconds : null;\n            // Compute intermediate stats from remoteId (remoteInbound)\n            stream.roundTripTime =\n                currentRemoteReport && \"roundTripTime\" in currentRemoteReport ? currentRemoteReport.roundTripTime : null;\n            stream.jitter = currentRemoteReport && \"jitter\" in currentRemoteReport ? currentRemoteReport.jitter : null;\n            stream.packetsLost =\n                currentRemoteReport && previousRemoteReport\n                    ? currentRemoteReport.packetsLost - previousRemoteReport.packetsLost\n                    : null;\n            stream.packetsLoss =\n                currentRemoteReport && \"fractionLost\" in currentRemoteReport ? currentRemoteReport.fractionLost : null;\n            // For outbound stream, trackIdentifier is part of the media-source report\n            var mediaSourceKey = currentReportsKeys.find(function (key) { return current[key].id === currentReport.mediaSourceId; });\n            if (mediaSourceKey) {\n                var outboundTrackIdentifier = current[mediaSourceKey].trackIdentifier;\n                stream.mappedName = outboundTrackIdentifier in mappedTrack ? mappedTrack[outboundTrackIdentifier] : null;\n            }\n        }\n        // Compute codec name from codecId (codec)\n        var codecKey = currentReportsKeys.find(function (key) { return current[key].id === currentReport.codecId; });\n        if (codecKey) {\n            var mimeType = current[codecKey].mimeType || \"\";\n            stream.codec = mimeType.includes(\"/\") ? mimeType.split(\"/\")[1] : mimeType;\n        }\n        streams[current[streamKey].id] = stream;\n    });\n    return streams;\n};\nexports.getStreamsFromStats = getStreamsFromStats;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\n","\"use strict\";\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n        if (ar || !(i in from)) {\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n            ar[i] = from[i];\n        }\n    }\n    return to.concat(ar || Array.prototype.slice.call(from));\n};\nvar _a;\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.generateID = exports.subtractNailUpReferenceStats = exports.applyPatchForRTT = exports.exposeApplicationStatsForPC = exports.restoreOriginalConsoleMethods = exports.setConsoleLevel = exports.getHardwareInfo = exports.validateEvent = exports.validateRating = exports.isRoomIdOrPeerIdChanged = exports.countOfValidConnections = exports.validateConfig = exports.getConnectionData = exports.dumpStream = exports.map2obj = exports.mangleChromeStats = exports.deltaCompression = exports.getSdkLogWithoutTrace = exports.getSdkLogger = exports.logPrefix = void 0;\nvar GPU = require(\"./detect-gpu\");\nvar stats_1 = require(\"./stats\");\nvar sdk_1 = require(\"./sdk\");\nvar getCurrTimeStamp = function () {\n    var date = new Date();\n    var dateStr = (\"00\" + (date.getMonth() + 1)).slice(-2) +\n        \"/\" +\n        (\"00\" + date.getDate()).slice(-2) +\n        \"/\" +\n        date.getFullYear() +\n        \" \" +\n        (\"00\" + date.getHours()).slice(-2) +\n        \":\" +\n        (\"00\" + date.getMinutes()).slice(-2) +\n        \":\" +\n        (\"00\" + date.getSeconds()).slice(-2) +\n        \":\" +\n        (\"000\" + date.getMilliseconds()).slice(-3);\n    return dateStr;\n};\nvar logPrefix = function (level) {\n    if (level === void 0) { level = \"info\"; }\n    return level === \"error\"\n        ? [\n            \"\".concat(getCurrTimeStamp(), \" %cwatchRTC %cERROR\"),\n            \"background: \".concat(\"gold\", \"; color: black; padding: 2px 0.5em; border-radius: 0.5em;\"),\n            \"background: \".concat(\"red\", \"; color: white; padding: 2px 0.5em; border-radius: 0.5em;\"),\n        ]\n        : [\n            \"\".concat(getCurrTimeStamp(), \" %cwatchRTC\"),\n            \"background: \".concat(\"gold\", \"; color: black; padding: 2px 0.5em; border-radius: 0.5em;\"),\n        ];\n};\nexports.logPrefix = logPrefix;\nvar logLevels = [\"debug\", \"info\", \"error\"];\nvar sdkLogger = function (log, getLogLevel) {\n    if (log === void 0) { log = console.log; }\n    return function (level, message, object) {\n        var allowed = getLogLevel();\n        var allowedValue = logLevels.indexOf(allowed);\n        var currentValue = logLevels.indexOf(level);\n        if (allowed === \"silent\" || currentValue < allowedValue) {\n            return;\n        }\n        var args = __spreadArray(__spreadArray([], (0, exports.logPrefix)(level), true), [message], false);\n        if (object) {\n            args.push(object);\n        }\n        log.apply(void 0, args);\n    };\n};\nexports.getSdkLogger = sdkLogger.bind(null, console.log);\nexports.getSdkLogWithoutTrace = sdkLogger.bind(null, (_a = console._original_log) !== null && _a !== void 0 ? _a : console.log);\n// apply a delta compression to the stats report. Reduces size by ~90%.\n// To reduce further, report keys could be compressed.\n// Muly: maybe can improve using https://github.com/AsyncBanana/microdiff?utm_source=tldrnewsletter\nvar deltaCompression = function (oldStats, newStats) {\n    oldStats = oldStats || {};\n    newStats = newStats || {};\n    newStats = JSON.parse(JSON.stringify(newStats));\n    Object.keys(newStats).forEach(function (id) {\n        var report = newStats[id];\n        delete report.id;\n        if (!oldStats[id]) {\n            return;\n        }\n        Object.keys(report).forEach(function (name) {\n            if (report.timestamp && typeof report.timestamp === \"string\") {\n                report.timestamp = new Date(report.timestamp).getTime();\n            }\n            if (report[name] === oldStats[id][name]) {\n                delete newStats[id][name];\n            }\n            else if (Array.isArray(report[name])) {\n                // Arrays get serialized if anything changed.\n                if (JSON.stringify(report[name]) === JSON.stringify(oldStats[id][name])) {\n                    delete newStats[id][name];\n                }\n            }\n            if (Object.keys(report).length === 0) {\n                delete newStats[id];\n            }\n            else if (Object.keys(report).length === 1 && report.timestamp) {\n                delete newStats[id];\n            }\n        });\n    });\n    var timestamp = -Infinity;\n    Object.keys(newStats).forEach(function (id) {\n        var report = newStats[id];\n        if (report.timestamp > timestamp) {\n            timestamp = report.timestamp;\n        }\n    });\n    Object.keys(newStats).forEach(function (id) {\n        var report = newStats[id];\n        if (report.timestamp === timestamp) {\n            report.timestamp = 0;\n        }\n    });\n    newStats.timestamp = timestamp;\n    return newStats;\n};\nexports.deltaCompression = deltaCompression;\nvar mangleChromeStats = function (pc, response) {\n    var standardReport = {};\n    var reports = response.result();\n    reports.forEach(function (report) {\n        var standardStats = {\n            id: report.id,\n            timestamp: report.timestamp.getTime(),\n            type: report.type,\n        };\n        report.names().forEach(function (name) {\n            standardStats[name] = report.stat(name);\n        });\n        standardReport[standardStats.id] = standardStats;\n    });\n    return standardReport;\n};\nexports.mangleChromeStats = mangleChromeStats;\n// transforms a maplike to an object. Mostly for getStats +\n// JSON.parse(JSON.stringify())\nvar map2obj = function (m) {\n    if (!m.entries) {\n        return m;\n    }\n    var o = {};\n    m.forEach(function (v, k) {\n        o[k] = v;\n    });\n    return o;\n};\nexports.map2obj = map2obj;\nvar dumpStream = function (stream) {\n    return {\n        id: stream.id,\n        tracks: stream.getTracks().map(function (track) {\n            return {\n                id: track.id,\n                kind: track.kind,\n                label: track.label,\n                enabled: track.enabled,\n                muted: track.muted,\n                readyState: track.readyState, // `live` or `ended`\n            };\n        }),\n    };\n};\nexports.dumpStream = dumpStream;\nvar getConnectionData = function (type, key, proxyURL) {\n    var localUrl = \"\".concat(type == \"ws\" ? \"ws\" : \"http\", \"://localhost:9101\");\n    var staging1Url = \"\".concat(type == \"ws\" ? \"wss\" : \"https\", \"://watchrtc-staging1.testrtc.com\");\n    var staging2Url = \"\".concat(type == \"ws\" ? \"wss\" : \"https\", \"://watchrtc-staging2.testrtc.com\");\n    var productionUrl = \"\".concat(type == \"ws\" ? \"wss\" : \"https\", \"://watchrtc.testrtc.com\");\n    var production1Url = \"\".concat(type == \"ws\" ? \"wss\" : \"https\", \"://watchrtc-app1.testrtc.com\");\n    if (proxyURL && type === \"http\") {\n        if (proxyURL.includes(\"wss://\")) {\n            proxyURL = proxyURL.replace(\"wss://\", \"https://\");\n        }\n        else {\n            proxyURL = proxyURL.replace(\"ws://\", \"http://\");\n        }\n    }\n    var splitted = key.split(\":\");\n    if (key.indexOf(\"local\") !== -1) {\n        return {\n            url: proxyURL || localUrl,\n            key: splitted[1],\n        };\n    }\n    else if (key.indexOf(\"staging1\") !== -1) {\n        return {\n            url: proxyURL || staging1Url,\n            key: splitted[1],\n        };\n    }\n    else if (key.indexOf(\"staging\") !== -1) {\n        return {\n            url: proxyURL || staging2Url,\n            key: splitted[1],\n        };\n    }\n    else if (key.indexOf(\"production1\") !== -1) {\n        return {\n            url: proxyURL || production1Url,\n            key: splitted[1],\n        };\n    }\n    else if (key.indexOf(\"production\") !== -1) {\n        return {\n            url: proxyURL || productionUrl,\n            key: splitted[1],\n        };\n    }\n    else {\n        return {\n            url: proxyURL || productionUrl,\n            key: splitted[0],\n        };\n    }\n};\nexports.getConnectionData = getConnectionData;\nvar validateConfig = function (config) {\n    if (!(config === null || config === void 0 ? void 0 : config.rtcApiKey)) {\n        (0, sdk_1.sdkLog)(\"debug\", \"config.rtcApiKey or config.rtcToken need to be provided.\");\n        return false;\n    }\n    if (!(config === null || config === void 0 ? void 0 : config.rtcRoomId) || !(config === null || config === void 0 ? void 0 : config.rtcPeerId)) {\n        (0, sdk_1.sdkLog)(\"debug\", \"config.rtcRoomId or config.rtcPeerId is empty.\");\n        return false;\n    }\n    return true;\n};\nexports.validateConfig = validateConfig;\nvar countOfValidConnections = function (openChannels) {\n    return Object.keys(openChannels).filter(function (id) { return openChannels[id].validConnection; }).length;\n};\nexports.countOfValidConnections = countOfValidConnections;\nvar isRoomIdOrPeerIdChanged = function (watchrtcIdentifiers, watchrtcConfig) {\n    var changed = false;\n    if (watchrtcConfig.rtcRoomId &&\n        watchrtcIdentifiers.rtcRoomId &&\n        watchrtcIdentifiers.rtcRoomId !== watchrtcConfig.rtcRoomId) {\n        changed = true;\n    }\n    if (watchrtcConfig.rtcPeerId &&\n        watchrtcIdentifiers.rtcPeerId &&\n        watchrtcIdentifiers.rtcPeerId !== watchrtcConfig.rtcPeerId) {\n        changed = true;\n    }\n    if (changed) {\n        (0, sdk_1.sdkLog)(\"debug\", \"maybeOpenWebsocketConnection. rtcRoomId or rtcPeerId has been changed\", {\n            old: {\n                rtcRoomId: watchrtcIdentifiers.rtcRoomId,\n                rtcPeerId: watchrtcIdentifiers.rtcPeerId,\n            },\n            new: {\n                rtcRoomId: watchrtcConfig.rtcRoomId,\n                rtcPeerId: watchrtcConfig.rtcPeerId,\n            },\n        });\n    }\n    return changed;\n};\nexports.isRoomIdOrPeerIdChanged = isRoomIdOrPeerIdChanged;\nvar validateRating = function (rating) {\n    if (!rating) {\n        (0, sdk_1.sdkLog)(\"error\", \"rating parameter is required\");\n        return false;\n    }\n    if (typeof rating !== \"number\" || rating < 1 || rating > 5) {\n        (0, sdk_1.sdkLog)(\"error\", \"rating parameter should be number from 1 to 5\");\n        return false;\n    }\n    return true;\n};\nexports.validateRating = validateRating;\nvar validateEvent = function (event, channels) {\n    if (!event) {\n        (0, sdk_1.sdkLog)(\"error\", \"event parameter is required\");\n        return false;\n    }\n    if (![\"global\", \"local\", \"log\"].includes(event.type)) {\n        (0, sdk_1.sdkLog)(\"error\", \"event.type should be either \\\"global\\\" or \\\"local\\\" or \\\"log\\\"\");\n        return false;\n    }\n    if (event.parameters && typeof event.parameters !== \"object\") {\n        (0, sdk_1.sdkLog)(\"error\", \"event.parameters should be JSON object\\\"\");\n        return false;\n    }\n    if (event.pc && !(event.pc.__rtcStatsId in channels)) {\n        (0, sdk_1.sdkLog)(\"error\", \"event.pc should be a RTCPeerConnection used in the call\\\"\");\n        return false;\n    }\n    return true;\n};\nexports.validateEvent = validateEvent;\nvar getHardwareInfo = function () { return __awaiter(void 0, void 0, void 0, function () {\n    function number_format(num) {\n        return (Math.round(num * 100) / 100).toFixed(2);\n    }\n    var loadBenchmarks, gpuInfo, result, memory;\n    return __generator(this, function (_a) {\n        switch (_a.label) {\n            case 0:\n                if (typeof window === \"undefined\") {\n                    return [2 /*return*/];\n                }\n                loadBenchmarks = function (fileName) { return __awaiter(void 0, void 0, void 0, function () {\n                    return __generator(this, function (_a) {\n                        switch (_a.label) {\n                            case 0: return [4 /*yield*/, new Promise(function (resolve) {\n                                    try {\n                                        var data = require(\"./gpu-benchmarks/\".concat(fileName));\n                                        data.shift();\n                                        return resolve(data);\n                                    }\n                                    catch (err) {\n                                        (0, sdk_1.sdkLog)(\"error\", \"Error. getHardwareInfo. loadBenchmarks\", { err: err.stack, fileName: fileName });\n                                        resolve([]);\n                                    }\n                                })];\n                            case 1: return [2 /*return*/, _a.sent()];\n                        }\n                    });\n                }); };\n                return [4 /*yield*/, GPU.getGPUTier({\n                        override: { loadBenchmarks: loadBenchmarks },\n                    })];\n            case 1:\n                gpuInfo = _a.sent();\n                result = __assign(__assign({}, gpuInfo), { cores_count: window.navigator.hardwareConcurrency });\n                memory = window.performance[\"memory\"];\n                if (memory) {\n                    result.jsHeapSizeLimit = number_format(memory.jsHeapSizeLimit / 1048576);\n                    result.totalJSHeapSize = number_format(memory.totalJSHeapSize / 1048576);\n                    result.usedJSHeapSize = number_format(memory.usedJSHeapSize / 1048576);\n                }\n                return [2 /*return*/, result];\n        }\n    });\n}); };\nexports.getHardwareInfo = getHardwareInfo;\nvar patchConsoleConfig = {\n    originalMethodPrefix: \"_original_\",\n    methodsToPatch: [\"log\", \"debug\", \"info\", \"warn\", \"error\"],\n    level: \"\",\n};\nvar patchConsoleMethod = function (methodName, trace) {\n    var originalMethod = console[methodName];\n    if (!originalMethod) {\n        return;\n    }\n    console[patchConsoleConfig.originalMethodPrefix + methodName] = originalMethod;\n    console[methodName] = function () {\n        var args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            args[_i] = arguments[_i];\n        }\n        if (patchConsoleConfig.level && args.length && trace) {\n            var currentMethodIndex = patchConsoleConfig.methodsToPatch.indexOf(methodName);\n            var configMethodIndex = patchConsoleConfig.methodsToPatch.indexOf(patchConsoleConfig.level);\n            var shouldTraceMethod = currentMethodIndex >= 0 && currentMethodIndex >= configMethodIndex;\n            if (shouldTraceMethod) {\n                var text = stringifyArgs(args);\n                trace({ data: [\"log\", null, { type: methodName, text: text }] });\n            }\n        }\n        originalMethod.apply(console, args);\n    };\n};\nvar setConsoleLevel = function (level, trace) {\n    if (level && patchConsoleConfig.methodsToPatch.includes(level) && level !== patchConsoleConfig.level) {\n        var currentIndex = patchConsoleConfig.methodsToPatch.indexOf(level);\n        var previousIndex = patchConsoleConfig.methodsToPatch.indexOf(patchConsoleConfig.level);\n        if (previousIndex < 0) {\n            for (var _i = 0, _a = patchConsoleConfig.methodsToPatch.slice(currentIndex); _i < _a.length; _i++) {\n                var methodName = _a[_i];\n                patchConsoleMethod(methodName, trace);\n            }\n        }\n        else if (currentIndex < previousIndex) {\n            for (var _b = 0, _c = patchConsoleConfig.methodsToPatch.slice(currentIndex, previousIndex); _b < _c.length; _b++) {\n                var methodName = _c[_b];\n                patchConsoleMethod(methodName, trace);\n            }\n        }\n        patchConsoleConfig.level = level;\n    }\n};\nexports.setConsoleLevel = setConsoleLevel;\nvar restoreOriginalConsoleMethods = function () {\n    if (!(\"console\" in window)) {\n        return;\n    }\n    for (var _i = 0, _a = patchConsoleConfig.methodsToPatch; _i < _a.length; _i++) {\n        var methodName = _a[_i];\n        var originalMethod = console[patchConsoleConfig.originalMethodPrefix + methodName];\n        if (!originalMethod) {\n            continue;\n        }\n        console[methodName] = originalMethod.bind(console);\n        delete console[patchConsoleConfig.originalMethodPrefix + methodName];\n    }\n};\nexports.restoreOriginalConsoleMethods = restoreOriginalConsoleMethods;\nvar exposeApplicationStatsForPC = function (id, previous, current, mappedTradk) {\n    return {\n        peer: (0, stats_1.getTransportFromStats)(id, current),\n        streams: (0, stats_1.getStreamsFromStats)(id, previous, current, mappedTradk),\n    };\n};\nexports.exposeApplicationStatsForPC = exposeApplicationStatsForPC;\nvar stringifyArgs = function (args) {\n    try {\n        return args.map(function (item) { return (typeof item === \"string\" ? item : JSON.stringify(item, replacerFunc())); }).join(\" \");\n    }\n    catch (_a) {\n        // do not log anything to not go into loop\n        // can fail with Illegal Invocation of JSON.stringify\n        // assumption - when customer also uses custom logger and binds another context\n        // so just ignore it\n        return \"\";\n    }\n};\n// avoid \"Converting circular structure to JSON\" error while JSON.stringifying\nvar replacerFunc = function () {\n    var visited = new WeakSet();\n    return function (_key, value) {\n        if (typeof value === \"object\" && value !== null) {\n            if (visited.has(value)) {\n                return;\n            }\n            visited.add(value);\n        }\n        return value;\n    };\n};\nvar applyPatchForRTT = function (oldStats, newStats) {\n    oldStats = oldStats || {};\n    newStats = newStats || {};\n    var hasOldStats = true;\n    if (Object.keys(oldStats).length === 0) {\n        hasOldStats = false;\n    }\n    var keys = Object.keys(newStats);\n    var reportKeys = keys.filter(function (key) { return newStats[key].type === \"remote-outbound-rtp\" || newStats[key].type === \"remote-inbound-rtp\"; });\n    reportKeys.forEach(function (reportKey) {\n        // case for Firefox/Safari\n        if (!(\"roundTripTime\" in newStats[reportKey])) {\n            newStats[reportKey].roundTripTime = NaN;\n        }\n        else {\n            // case Chrome\n            var statsHaveRTTMeasurements = \"roundTripTimeMeasurements\" in newStats[reportKey] &&\n                Boolean(oldStats[reportKey]) &&\n                \"roundTripTimeMeasurements\" in oldStats[reportKey];\n            if (hasOldStats && statsHaveRTTMeasurements) {\n                if (newStats[reportKey].roundTripTimeMeasurements === oldStats[reportKey].roundTripTimeMeasurements) {\n                    newStats[reportKey].roundTripTime = NaN;\n                }\n            }\n        }\n    });\n    return newStats;\n};\nexports.applyPatchForRTT = applyPatchForRTT;\nvar subtractNailUpReferenceStats = function (referenceStats, newStats) {\n    var _loop_1 = function (key, report) {\n        if (key in referenceStats) {\n            var referenceReport_1 = referenceStats[key];\n            switch (report.type) {\n                case \"inbound-rtp\":\n                    [\n                        \"bytesReceived\",\n                        \"packetsReceived\",\n                        \"packetsLost\",\n                        \"framesDecoded\",\n                        \"keyFramesDecoded\",\n                        \"framesRendered\",\n                        \"framesDropped\",\n                        \"qpSum\",\n                        \"totalDecodeTime\",\n                        \"totalInterFrameDelay\",\n                        \"totalSquaredInterFrameDelay\",\n                        \"pauseCount\",\n                        \"totalPausesDuration\",\n                        \"freezeCount\",\n                        \"totalFreezesDuration\",\n                        \"headerBytesReceived\",\n                        \"packetsDiscarded\",\n                        \"fecBytesReceived\",\n                        \"fecPacketsReceived\",\n                        \"fecPacketsDiscarded\",\n                        \"firCount\",\n                        \"pliCount\",\n                        \"totalProcessingDelay\",\n                        \"nackCount\",\n                        \"jitterBufferEmittedCount\",\n                        \"totalSamplesReceived\",\n                        \"concealedSamples\",\n                        \"silentConcealedSamples\",\n                        \"concealmentEvents\",\n                        \"totalAudioEnergy\",\n                        \"totalSamplesDuration\",\n                        \"framesReceived\",\n                        \"framesAssembledFromMultiplePackets\",\n                        \"totalAssemblyTime\",\n                        \"retransmittedPacketsReceived\",\n                        \"retransmittedBytesReceived\",\n                    ].forEach(function (stat) {\n                        if (stat in report) {\n                            report[stat] = Math.max(report[stat] - referenceReport_1[stat], 0);\n                        }\n                    });\n                    break;\n                case \"outbound-rtp\":\n                    [\n                        \"packetsSent\",\n                        \"bytesSent\",\n                        \"headerBytesSent\",\n                        \"retransmittedPacketsSent\",\n                        \"retransmittedBytesSent\",\n                        \"totalEncodedBytesTarget\",\n                        \"framesSent\",\n                        \"hugeFramesSent\",\n                        \"framesEncoded\",\n                        \"keyFramesEncoded\",\n                        \"qpSum\",\n                        \"totalEncodeTime\",\n                        \"totalPacketsSendDelay\",\n                        \"qualityLimitationResolutionChanges\",\n                        \"qualityLimitationDurations\",\n                        \"nackCount\",\n                        \"firCount\",\n                        \"pliCount\",\n                    ].forEach(function (stat) {\n                        if (stat in report) {\n                            if (stat === \"qualityLimitationDurations\") {\n                                report[stat].bandwidth = Math.max(report[stat].bandwidth - referenceReport_1[stat].bandwidth, 0);\n                                report[stat].cpu = Math.max(report[stat].cpu - referenceReport_1[stat].cpu, 0);\n                                report[stat].other = Math.max(report[stat].other - referenceReport_1[stat].other, 0);\n                                report[stat].none = Math.max(report[stat].none - referenceReport_1[stat].none, 0);\n                            }\n                            else {\n                                report[stat] = Math.max(report[stat] - referenceReport_1[stat], 0);\n                            }\n                        }\n                    });\n                    break;\n                case \"remote-inbound-rtp\":\n                    [\"packetsReceived\", \"packetsLost\", \"totalRoundTripTime\", \"roundTripTimeMeasurements\"].forEach(function (stat) {\n                        if (stat in report) {\n                            report[stat] = Math.max(report[stat] - referenceReport_1[stat], 0);\n                        }\n                    });\n                    break;\n                case \"remote-outbound-rtp\":\n                    [\"packetsSent\", \"bytesSent\", \"totalRoundTripTime\", \"roundTripTimeMeasurements\"].forEach(function (stat) {\n                        if (stat in report) {\n                            report[stat] = Math.max(report[stat] - referenceReport_1[stat], 0);\n                        }\n                    });\n                    break;\n                case \"media-source\":\n                    [\n                        \"totalAudioEnergy\",\n                        \"totalSamplesDuration\",\n                        \"droppedSamplesDuration\",\n                        \"droppedSamplesEvents\",\n                        \"totalCaptureDelay\",\n                        \"totalSamplesCaptured\",\n                        \"frames\",\n                    ].forEach(function (stat) {\n                        if (stat in report) {\n                            report[stat] = Math.max(report[stat] - referenceReport_1[stat], 0);\n                        }\n                    });\n                    break;\n                case \"media-playout\":\n                    [\n                        \"synthesizedSamplesDuration\",\n                        \"synthesizedSamplesEvents\",\n                        \"totalSamplesDuration\",\n                        \"totalPlayoutDelay\",\n                        \"totalSamplesCount\",\n                    ].forEach(function (stat) {\n                        if (stat in report) {\n                            report[stat] = Math.max(report[stat] - referenceReport_1[stat], 0);\n                        }\n                    });\n                    break;\n                case \"peer-connection\":\n                    [\"dataChannelsOpened\", \"dataChannelsClosed\"].forEach(function (stat) {\n                        if (stat in report) {\n                            report[stat] = Math.max(report[stat] - referenceReport_1[stat], 0);\n                        }\n                    });\n                    break;\n                case \"data-channel\":\n                    [\"messagesSent\", \"bytesSent\", \"messagesReceived\", \"bytesReceived\"].forEach(function (stat) {\n                        if (stat in report) {\n                            report[stat] = Math.max(report[stat] - referenceReport_1[stat], 0);\n                        }\n                    });\n                    break;\n                case \"transport\":\n                    [\"packetsSent\", \"packetsReceived\", \"bytesSent\", \"bytesReceived\", \"selectedCandidatePairChanges\"].forEach(function (stat) {\n                        if (stat in report) {\n                            report[stat] = Math.max(report[stat] - referenceReport_1[stat], 0);\n                        }\n                    });\n                    break;\n                case \"candidate-pair\":\n                    [\n                        \"packetsSent\",\n                        \"packetsReceived\",\n                        \"bytesSent\",\n                        \"bytesReceived\",\n                        \"totalRoundTripTime\",\n                        \"requestsReceived\",\n                        \"requestsSent\",\n                        \"responsesReceived\",\n                        \"responsesSent\",\n                        \"consentRequestsSent\",\n                        \"packetsDiscardedOnSend\",\n                        \"bytesDiscardedOnSend\",\n                    ].forEach(function (stat) {\n                        if (stat in report) {\n                            report[stat] = Math.max(report[stat] - referenceReport_1[stat], 0);\n                        }\n                    });\n                    break;\n                default:\n                    break;\n            }\n        }\n    };\n    for (var _i = 0, _a = Object.entries(newStats); _i < _a.length; _i++) {\n        var _b = _a[_i], key = _b[0], report = _b[1];\n        _loop_1(key, report);\n    }\n    return newStats;\n};\nexports.subtractNailUpReferenceStats = subtractNailUpReferenceStats;\nvar generateID = function () {\n    return Math.random().toString(36).substring(2, 15) + Math.random().toString(36).substring(2, 15);\n};\nexports.generateID = generateID;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.default = \"1.38.2\";\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar sdk_1 = require(\"./sdk\");\nvar WatchRTCHttp = /** @class */ (function () {\n    function WatchRTCHttp() {\n        if (WatchRTCHttp._instance) {\n            (0, sdk_1.sdkLog)(\"info\", \"WatchRTCSocket instance already created\");\n        }\n        else {\n            WatchRTCHttp._instance = this;\n        }\n    }\n    WatchRTCHttp.prototype.trace = function (url, projectId, rtcRoomId, rtcPeerId) {\n        var data = [];\n        for (var _i = 4; _i < arguments.length; _i++) {\n            data[_i - 4] = arguments[_i];\n        }\n        var args = Array.prototype.slice.call(data);\n        args.push(Date.now());\n        if (args[1] instanceof RTCPeerConnection) {\n            args[1] = args[1].__rtcStatsId;\n        }\n        var response = fetch(url, {\n            method: \"POST\",\n            mode: \"cors\",\n            cache: \"no-cache\",\n            credentials: \"same-origin\",\n            headers: {\n                \"Content-Type\": \"application/json\",\n            },\n            body: JSON.stringify({\n                data: data,\n                projectId: projectId,\n                rtcRoomId: rtcRoomId,\n                rtcPeerId: rtcPeerId,\n            }),\n        });\n        return response\n            .then(function () { return ({}); })\n            .catch(function (err) {\n            (0, sdk_1.sdkLog)(\"error\", err.message, { err: err.stack });\n            return { error: err };\n        });\n    };\n    return WatchRTCHttp;\n}());\nexports.default = WatchRTCHttp;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar sdk_1 = require(\"./sdk\");\nvar LZString = require(\"./lz-string\");\nvar PROTOCOL_VERSION = \"2.0\";\nvar MSG_TIME_DIFF_THRESHLOD = 12 * 60 * 60 * 1000; // 12 hours\nvar isBrowser = typeof window !== \"undefined\";\nvar globalContext = isBrowser ? window : global;\nvar WatchRTCSocket = /** @class */ (function () {\n    function WatchRTCSocket() {\n        var _this_1 = this;\n        this.connection = null;\n        this.wasConnected = false;\n        this.buffer = [];\n        this.sendInterval = 1;\n        this.onClose = function () { };\n        this.dataCollection = true;\n        this.sendPromises = [];\n        this.prevMessageTs = Date.now();\n        this.trace = function (_a) {\n            var data = _a.data, options = _a.options;\n            var args = Array.prototype.slice.call(data);\n            var prevMessageTs = _this_1.prevMessageTs;\n            var now = Date.now();\n            var timeSinceLastMessage = now - prevMessageTs;\n            if (Math.abs(timeSinceLastMessage) >= MSG_TIME_DIFF_THRESHLOD) {\n                _this_1.trace({ data: [\"timeChange\", null, { now: now, prevMessageTs: prevMessageTs, timeSinceLastMessage: timeSinceLastMessage }] });\n            }\n            args.push(now);\n            if (args[1] instanceof RTCPeerConnection) {\n                args[1] = args[1].__rtcStatsId;\n            }\n            if (!WatchRTCSocket._instance.dataCollection) {\n                if (options === null || options === void 0 ? void 0 : options.promiseFuncs) {\n                    options.promiseFuncs.resolve({ error: \"Data collection disabled\" });\n                }\n                return;\n            }\n            // Don't store a new message if the connection is not open and the buffer is full (> 1000 messages)\n            if (!WatchRTCSocket._instance.connection ||\n                WatchRTCSocket._instance.connection.readyState !== globalContext.WebSocket.OPEN) {\n                if (WatchRTCSocket._instance.buffer.length > 1000) {\n                    if (options === null || options === void 0 ? void 0 : options.promiseFuncs) {\n                        options.promiseFuncs.resolve({ error: \"Message buffer size exceeded\" });\n                    }\n                    return;\n                }\n            }\n            // Else, store the message in the buffer\n            WatchRTCSocket._instance.buffer.push(args);\n            if (options === null || options === void 0 ? void 0 : options.promiseFuncs) {\n                WatchRTCSocket._instance.sendPromises.push(options.promiseFuncs);\n            }\n            // If the connection is open and the buffer threshold is reached, send the messages\n            if (WatchRTCSocket._instance.connection &&\n                WatchRTCSocket._instance.connection.readyState === globalContext.WebSocket.OPEN) {\n                if (WatchRTCSocket._instance.buffer.length >= WatchRTCSocket._instance.sendInterval) {\n                    var lines = JSON.stringify(WatchRTCSocket._instance.buffer);\n                    var compressedMessage = LZString.compressToEncodedURIComponent(lines);\n                    (0, sdk_1.sdkLogWithoutTrace)(\"debug\", \"lines: \".concat(lines.length));\n                    (0, sdk_1.sdkLogWithoutTrace)(\"debug\", \"compressedMessage: \".concat(compressedMessage.length));\n                    WatchRTCSocket._instance.buffer = [];\n                    WatchRTCSocket._instance.connection.send(compressedMessage);\n                    WatchRTCSocket._instance.sendPromises.forEach(function (_a) {\n                        var resolve = _a.resolve;\n                        return resolve({});\n                    });\n                    WatchRTCSocket._instance.sendPromises = [];\n                }\n            }\n        };\n        if (WatchRTCSocket._instance) {\n            (0, sdk_1.sdkLog)(\"info\", \"WatchRTCSocket instance already created\");\n        }\n        else {\n            WatchRTCSocket._instance = this;\n        }\n    }\n    WatchRTCSocket.prototype.connect = function (_a) {\n        var url = _a.url, onData = _a.onData, onError = _a.onError, onOpen = _a.onOpen, onClose = _a.onClose, _b = _a.options, options = _b === void 0 ? {} : _b;\n        var cleanOldTraces = options.cleanOldTraces;\n        if (WatchRTCSocket._instance.connection) {\n            WatchRTCSocket._instance.connection.close();\n            WatchRTCSocket._instance.connection = null;\n        }\n        var _this = WatchRTCSocket._instance;\n        if (cleanOldTraces) {\n            // we want to keep last 10 minutes of logs, to prevent old logs timestamp impacting actual session duration\n            var timeThreshold_1 = Date.now() - 10 * 60 * 1000; // 10 min\n            var relevantTraces = _this.buffer.filter(function (data) { return data[3] > timeThreshold_1; });\n            var filteredCount = _this.buffer.length - relevantTraces.length;\n            _this.buffer = relevantTraces;\n            var args = [\"oldTracesCleanup\", null, { filteredCount: filteredCount }, Date.now()];\n            (0, sdk_1.sdkLog)(\"info\", \"watchRTC SDK flushed \".concat(filteredCount, \" messages\"));\n            _this.buffer.push(args);\n        }\n        WatchRTCSocket._instance.connection = new globalContext.WebSocket(url, PROTOCOL_VERSION);\n        WatchRTCSocket._instance.connection.onopen = onOpen || null;\n        WatchRTCSocket._instance.connection.onclose = onClose || null;\n        WatchRTCSocket._instance.connection.onmessage = function (e) {\n            var _a;\n            try {\n                var data = JSON.parse(e.data);\n                if (data.error) {\n                    (_a = _this === null || _this === void 0 ? void 0 : _this.connection) === null || _a === void 0 ? void 0 : _a.close();\n                    _this.connection = null;\n                    (0, sdk_1.sdkLog)(\"error\", \"\\n\" + data.error);\n                    onError(data.error, \"auth\");\n                }\n                else {\n                    if (data.sendInterval) {\n                        WatchRTCSocket._instance.sendInterval = data.sendInterval;\n                    }\n                    onData(data);\n                    WatchRTCSocket._instance.wasConnected = true;\n                }\n            }\n            catch (err) {\n                (0, sdk_1.sdkLog)(\"error\", \"\\n\", { err: err.stack });\n                onError(err.message);\n            }\n        };\n        WatchRTCSocket._instance.connection.onerror = function (e) {\n            (0, sdk_1.sdkLog)(\"error\", \"\\n\", e);\n            onError(e, \"connection\");\n        };\n    };\n    WatchRTCSocket.prototype.close = function (nailUpCallEnd) {\n        var _a, _b;\n        if (nailUpCallEnd && ((_b = (_a = WatchRTCSocket._instance) === null || _a === void 0 ? void 0 : _a.connection) === null || _b === void 0 ? void 0 : _b.readyState) === globalContext.WebSocket.OPEN) {\n            var lines = JSON.stringify([\"nailUpCallEnd\", null, null, Date.now()]);\n            var compressedMessage = LZString.compressToEncodedURIComponent(lines);\n            WatchRTCSocket._instance.connection.send(compressedMessage);\n        }\n        WatchRTCSocket._instance.buffer = [];\n        WatchRTCSocket._instance.sendPromises.forEach(function (_a) {\n            var resolve = _a.resolve;\n            return resolve({ error: \"Connection was close\" });\n        });\n        WatchRTCSocket._instance.sendPromises = [];\n        if (WatchRTCSocket._instance.connection) {\n            WatchRTCSocket._instance.connection.close();\n            WatchRTCSocket._instance.onClose();\n            WatchRTCSocket._instance.connection = null;\n        }\n    };\n    WatchRTCSocket.prototype.disableDataCollection = function () {\n        (0, sdk_1.sdkLog)(\"debug\", \"Data collection disabled.\");\n        WatchRTCSocket._instance.dataCollection = false;\n    };\n    WatchRTCSocket.prototype.enableDataCollection = function () {\n        (0, sdk_1.sdkLog)(\"debug\", \"Data collection enabled.\");\n        WatchRTCSocket._instance.dataCollection = true;\n    };\n    WatchRTCSocket.prototype.isDisabledDataCollection = function () {\n        return !WatchRTCSocket._instance.dataCollection;\n    };\n    return WatchRTCSocket;\n}());\nexports.default = WatchRTCSocket;\n","!(function (e, r) {\n  \"object\" == typeof exports && \"undefined\" != typeof module\n    ? r(exports)\n    : \"function\" == typeof define && define.amd\n    ? define([\"exports\"], r)\n    : r(((e = \"undefined\" != typeof globalThis ? globalThis : e || self).DetectGPU = {}));\n})(this, function (e) {\n  \"use strict\";\n  var r = function (e, n) {\n    return (r =\n      Object.setPrototypeOf ||\n      ({ __proto__: [] } instanceof Array &&\n        function (e, r) {\n          e.__proto__ = r;\n        }) ||\n      function (e, r) {\n        for (var n in r) Object.prototype.hasOwnProperty.call(r, n) && (e[n] = r[n]);\n      })(e, n);\n  };\n  function n(e, r, n, t) {\n    return new (n || (n = Promise))(function (o, a) {\n      function i(e) {\n        try {\n          u(t.next(e));\n        } catch (e) {\n          a(e);\n        }\n      }\n      function c(e) {\n        try {\n          u(t.throw(e));\n        } catch (e) {\n          a(e);\n        }\n      }\n      function u(e) {\n        var r;\n        e.done\n          ? o(e.value)\n          : ((r = e.value),\n            r instanceof n\n              ? r\n              : new n(function (e) {\n                  e(r);\n                })).then(i, c);\n      }\n      u((t = t.apply(e, r || [])).next());\n    });\n  }\n  function t(e, r) {\n    var n,\n      t,\n      o,\n      a,\n      i = {\n        label: 0,\n        sent: function () {\n          if (1 & o[0]) throw o[1];\n          return o[1];\n        },\n        trys: [],\n        ops: [],\n      };\n    return (\n      (a = { next: c(0), throw: c(1), return: c(2) }),\n      \"function\" == typeof Symbol &&\n        (a[Symbol.iterator] = function () {\n          return this;\n        }),\n      a\n    );\n    function c(a) {\n      return function (c) {\n        return (function (a) {\n          if (n) throw new TypeError(\"Generator is already executing.\");\n          for (; i; )\n            try {\n              if (\n                ((n = 1),\n                t &&\n                  (o = 2 & a[0] ? t.return : a[0] ? t.throw || ((o = t.return) && o.call(t), 0) : t.next) &&\n                  !(o = o.call(t, a[1])).done)\n              )\n                return o;\n              switch (((t = 0), o && (a = [2 & a[0], o.value]), a[0])) {\n                case 0:\n                case 1:\n                  o = a;\n                  break;\n                case 4:\n                  return i.label++, { value: a[1], done: !1 };\n                case 5:\n                  i.label++, (t = a[1]), (a = [0]);\n                  continue;\n                case 7:\n                  (a = i.ops.pop()), i.trys.pop();\n                  continue;\n                default:\n                  if (!((o = i.trys), (o = o.length > 0 && o[o.length - 1]) || (6 !== a[0] && 2 !== a[0]))) {\n                    i = 0;\n                    continue;\n                  }\n                  if (3 === a[0] && (!o || (a[1] > o[0] && a[1] < o[3]))) {\n                    i.label = a[1];\n                    break;\n                  }\n                  if (6 === a[0] && i.label < o[1]) {\n                    (i.label = o[1]), (o = a);\n                    break;\n                  }\n                  if (o && i.label < o[2]) {\n                    (i.label = o[2]), i.ops.push(a);\n                    break;\n                  }\n                  o[2] && i.ops.pop(), i.trys.pop();\n                  continue;\n              }\n              a = r.call(e, i);\n            } catch (e) {\n              (a = [6, e]), (t = 0);\n            } finally {\n              n = o = 0;\n            }\n          if (5 & a[0]) throw a[1];\n          return { value: a[0] ? a[1] : void 0, done: !0 };\n        })([a, c]);\n      };\n    }\n  }\n  var o = [\n    \"geforce 320m\",\n    \"geforce 8600\",\n    \"geforce 8600m gt\",\n    \"geforce 8800 gs\",\n    \"geforce 8800 gt\",\n    \"geforce 9400\",\n    \"geforce 9400m g\",\n    \"geforce 9400m\",\n    \"geforce 9600m gt\",\n    \"geforce 9600m\",\n    \"geforce fx go5200\",\n    \"geforce gt 120\",\n    \"geforce gt 130\",\n    \"geforce gt 330m\",\n    \"geforce gtx 285\",\n    \"google swiftshader\",\n    \"intel g41\",\n    \"intel g45\",\n    \"intel gma 4500mhd\",\n    \"intel gma x3100\",\n    \"intel hd 3000\",\n    \"intel q45\",\n    \"legacy\",\n    \"mali-2\",\n    \"mali-3\",\n    \"mali-4\",\n    \"quadro fx 1500\",\n    \"quadro fx 4\",\n    \"quadro fx 5\",\n    \"radeon hd 2400\",\n    \"radeon hd 2600\",\n    \"radeon hd 4670\",\n    \"radeon hd 4850\",\n    \"radeon hd 4870\",\n    \"radeon hd 5670\",\n    \"radeon hd 5750\",\n    \"radeon hd 6290\",\n    \"radeon hd 6300\",\n    \"radeon hd 6310\",\n    \"radeon hd 6320\",\n    \"radeon hd 6490m\",\n    \"radeon hd 6630m\",\n    \"radeon hd 6750m\",\n    \"radeon hd 6770m\",\n    \"radeon hd 6970m\",\n    \"sgx 543\",\n    \"sgx543\",\n  ];\n  function a(e) {\n    return (e = e\n      .toLowerCase()\n      .replace(/^angle ?\\((.+)\\)*$/, \"$1\")\n      .replace(/\\s(\\d{1,2}gb|direct3d.+$)|\\(r\\)| \\([^)]+\\)$/g, \"\"));\n  }\n  const i = 34962;\n  var c = \"undefined\" == typeof window,\n    u = (function () {\n      if (!c) {\n        var e = window.navigator,\n          r = e.userAgent,\n          n = e.platform,\n          t = e.maxTouchPoints,\n          o = /(iphone|ipod|ipad)/i.test(r),\n          a = \"iPad\" === n || (\"MacIntel\" === n && t > 0 && !window.MSStream);\n        return { isIpad: a, isMobile: /android/i.test(r) || o || a, isSafari12: /Version\\/12.+Safari/.test(r) };\n      }\n    })();\n  function f(e, r, n) {\n    if (!n) return [r];\n    var t,\n      o = (function (e) {\n        var r =\n            \"\\n    precision highp float;\\n    attribute vec3 aPosition;\\n    varying float vvv;\\n    void main() {\\n      vvv = 0.31622776601683794;\\n      gl_Position = vec4(aPosition, 1.0);\\n    }\\n  \",\n          n =\n            \"\\n    precision highp float;\\n    varying float vvv;\\n    void main() {\\n      vec4 enc = vec4(1.0, 255.0, 65025.0, 16581375.0) * vvv;\\n      enc = fract(enc);\\n      enc -= enc.yzww * vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0, 0.0);\\n      gl_FragColor = enc;\\n    }\\n  \",\n          t = e.createShader(35633),\n          o = e.createShader(35632),\n          a = e.createProgram();\n        if (!(o && t && a)) return;\n        e.shaderSource(t, r),\n          e.shaderSource(o, n),\n          e.compileShader(t),\n          e.compileShader(o),\n          e.attachShader(a, t),\n          e.attachShader(a, o),\n          e.linkProgram(a),\n          e.detachShader(a, t),\n          e.detachShader(a, o),\n          e.deleteShader(t),\n          e.deleteShader(o),\n          e.useProgram(a);\n        var c = e.createBuffer();\n        e.bindBuffer(i, c), e.bufferData(i, new Float32Array([-1, -1, 0, 3, -1, 0, -1, 3, 0]), 35044);\n        var u = e.getAttribLocation(a, \"aPosition\");\n        e.vertexAttribPointer(u, 3, 5126, !1, 0, 0),\n          e.enableVertexAttribArray(u),\n          e.clearColor(1, 1, 1, 1),\n          e.clear(16384),\n          e.viewport(0, 0, 1, 1),\n          e.drawArrays(4, 0, 3);\n        var f = new Uint8Array(4);\n        return e.readPixels(0, 0, 1, 1, 6408, 5121, f), e.deleteProgram(a), e.deleteBuffer(c), f.join(\"\");\n      })(e),\n      a = \"801621810\",\n      c = \"8016218135\",\n      f = \"80162181161\",\n      l = (null == u ? void 0 : u.isIpad)\n        ? [\n            [\"a7\", f, 12],\n            [\"a8\", c, 15],\n            [\"a8x\", c, 15],\n            [\"a9\", c, 15],\n            [\"a9x\", c, 15],\n            [\"a10\", c, 15],\n            [\"a10x\", c, 15],\n            [\"a12\", a, 15],\n            [\"a12x\", a, 15],\n            [\"a12z\", a, 15],\n            [\"a14\", a, 15],\n            [\"m1\", a, 15],\n          ]\n        : [\n            [\"a7\", f, 12],\n            [\"a8\", c, 12],\n            [\"a9\", c, 15],\n            [\"a10\", c, 15],\n            [\"a11\", a, 15],\n            [\"a12\", a, 15],\n            [\"a13\", a, 15],\n            [\"a14\", a, 15],\n          ];\n    return (\n      \"80162181255\" === o\n        ? (t = l.filter(function (e) {\n            return e[2] >= 14;\n          }))\n        : (t = l.filter(function (e) {\n            return e[1] === o;\n          })).length || (t = l),\n      t.map(function (e) {\n        var r = e[0];\n        return \"apple \".concat(r, \" gpu\");\n      })\n    );\n  }\n  var l = [],\n    d = [];\n  function s(e, r) {\n    if (e === r) return 0;\n    var n = e;\n    e.length > r.length && ((e = r), (r = n));\n    for (var t = e.length, o = r.length; t > 0 && e.charCodeAt(~-t) === r.charCodeAt(~-o); ) t--, o--;\n    for (var a, i = 0; i < t && e.charCodeAt(i) === r.charCodeAt(i); ) i++;\n    if (((o -= i), 0 === (t -= i))) return o;\n    for (var c, u, f = 0, s = 0, h = 0; s < t; ) (d[s] = e.charCodeAt(i + s)), (l[s] = ++s);\n    for (; h < o; )\n      for (a = r.charCodeAt(i + h), c = h++, f = h, s = 0; s < t; s++)\n        (u = a === d[s] ? c : c + 1), (c = l[s]), (f = l[s] = c > f ? (u > f ? f + 1 : u) : u > c ? c + 1 : u);\n    return f;\n  }\n  function h(e) {\n    return null != e;\n  }\n  var v = (function (e) {\n    function n(r) {\n      var n = this.constructor,\n        t = e.call(this, r) || this;\n      return Object.setPrototypeOf(t, n.prototype), t;\n    }\n    return (\n      (function (e, n) {\n        if (\"function\" != typeof n && null !== n)\n          throw new TypeError(\"Class extends value \" + String(n) + \" is not a constructor or null\");\n        function t() {\n          this.constructor = e;\n        }\n        r(e, n), (e.prototype = null === n ? Object.create(n) : ((t.prototype = n.prototype), new t()));\n      })(n, e),\n      n\n    );\n  })(Error);\n  (e.getGPUTier = function (e) {\n    var r = void 0 === e ? {} : e,\n      i = r.mobileTiers,\n      l = void 0 === i ? [0, 15, 30, 60] : i,\n      d = r.desktopTiers,\n      p = void 0 === d ? [0, 15, 30, 60] : d,\n      g = r.override,\n      m = void 0 === g ? {} : g,\n      b = r.glContext,\n      w = r.failIfMajorPerformanceCaveat,\n      y = void 0 !== w && w,\n      x = r.benchmarksURL,\n      P = void 0 === x ? \"https://unpkg.com/detect-gpu@\".concat(\"4.0.8\", \"/dist/benchmarks\") : x;\n    return n(void 0, void 0, void 0, function () {\n      var e, r, i, d, g, w, x, A, S, _, C, E, L, M, j, B, k, O, T, U, I, D, R, G, N, K;\n      return t(this, function (W) {\n        switch (W.label) {\n          case 0:\n            if (((e = {}), c)) return [2, { tier: 0, type: \"SSR\" }];\n            if (\n              ((r = m.isIpad),\n              (i = void 0 === r ? !!(null == u ? void 0 : u.isIpad) : r),\n              (d = m.isMobile),\n              (g = void 0 === d ? !!(null == u ? void 0 : u.isMobile) : d),\n              (w = m.screenSize),\n              (x = void 0 === w ? window.screen : w),\n              (A = m.loadBenchmarks),\n              (S =\n                void 0 === A\n                  ? function (e) {\n                      return n(void 0, void 0, void 0, function () {\n                        var r;\n                        return t(this, function (n) {\n                          switch (n.label) {\n                            case 0:\n                              return [\n                                4,\n                                fetch(\"\".concat(P, \"/\").concat(e)).then(function (e) {\n                                  return e.json();\n                                }),\n                              ];\n                            case 1:\n                              if (((r = n.sent()), parseInt(r.shift().split(\".\")[0], 10) < 4))\n                                throw new v(\"Detect GPU benchmark data is out of date. Please update to version 4x\");\n                              return [2, r];\n                          }\n                        });\n                      });\n                    }\n                  : A),\n              (_ = m.renderer),\n              (C = function (e) {\n                for (\n                  var r = 0,\n                    n = g\n                      ? [\"adreno\", \"apple\", \"mali-t\", \"mali\", \"nvidia\", \"powervr\"]\n                      : [\"intel\", \"apple\", \"amd\", \"radeon\", \"nvidia\", \"geforce\"];\n                  r < n.length;\n                  r++\n                ) {\n                  var t = n[r];\n                  if (e.includes(t)) return t;\n                }\n              }),\n              (E = function (r) {\n                return n(void 0, void 0, void 0, function () {\n                  var n, o, a, c, u, f, l, d, h, p, m, b, w, y, P, A, _, E, L, M, j, B, k, O, T, U;\n                  return t(this, function (t) {\n                    switch (t.label) {\n                      case 0:\n                        if (!(n = C(r))) return [2];\n                        (o = \"\"\n                          .concat(g ? \"m\" : \"d\", \"-\")\n                          .concat(n)\n                          .concat(i ? \"-ipad\" : \"\", \".json\")),\n                          (a = e[o] = null !== (U = e[o]) && void 0 !== U ? U : S(o)),\n                          (t.label = 1);\n                      case 1:\n                        return t.trys.push([1, 3, , 4]), [4, a];\n                      case 2:\n                        return (c = t.sent()), [3, 4];\n                      case 3:\n                        if ((u = t.sent()) instanceof v) throw u;\n                        return [2];\n                      case 4:\n                        if (\n                          ((f = (function (e) {\n                            var r,\n                              n =\n                                (e = e.replace(/\\([^)]+\\)/, \"\")).match(/\\d+/) ||\n                                e.match(/(\\W|^)([A-Za-z]{1,3})(\\W|$)/g);\n                            return null !== (r = null == n ? void 0 : n.join(\"\").replace(/\\W|amd/g, \"\")) && void 0 !== r\n                              ? r\n                              : \"\";\n                          })(r)),\n                          (l = c.filter(function (e) {\n                            return e[1] === f;\n                          })).length ||\n                            (l = c.filter(function (e) {\n                              return e[0].includes(r);\n                            })),\n                          0 === (d = l.length))\n                        )\n                          return [2];\n                        for (\n                          h =\n                            d > 1\n                              ? l\n                                  .map(function (e) {\n                                    return [e, s(r, e[0])];\n                                  })\n                                  .sort(function (e, r) {\n                                    return e[1] - r[1];\n                                  })[0][0]\n                              : l[0],\n                            p = h[0],\n                            m = h[3],\n                            b = Number.MAX_VALUE,\n                            y = window.devicePixelRatio,\n                            P = x.width * y * x.height * y,\n                            A = 0,\n                            _ = m;\n                          A < _.length;\n                          A++\n                        )\n                          (E = _[A]),\n                            (L = E[0]),\n                            (M = E[1]),\n                            (j = L * M),\n                            (B = Math.abs(P - j)) < b && ((b = B), (w = E));\n                        return w ? ((O = (k = w)[2]), (T = k[3]), [2, [b, O, p, T]]) : [2];\n                    }\n                  });\n                });\n              }),\n              (L = function (e, r, n, t, o) {\n                return { device: o, fps: t, gpu: n, isMobile: g, tier: e, type: r };\n              }),\n              (j = \"\"),\n              _)\n            )\n              (_ = a(_)), (M = [_]);\n            else {\n              if (\n                !(B =\n                  b ||\n                  (function (e, r) {\n                    void 0 === r && (r = !1);\n                    var n = {\n                      alpha: !1,\n                      antialias: !1,\n                      depth: !1,\n                      failIfMajorPerformanceCaveat: r,\n                      powerPreference: \"high-performance\",\n                      stencil: !1,\n                    };\n                    e && delete n.powerPreference;\n                    var t = window.document.createElement(\"canvas\"),\n                      o = t.getContext(\"webgl\", n) || t.getContext(\"experimental-webgl\", n);\n                    return null != o ? o : void 0;\n                  })(null == u ? void 0 : u.isSafari12, y))\n              )\n                return [2, L(0, \"WEBGL_UNSUPPORTED\")];\n              if (\n                ((k = B.getExtension(\"WEBGL_debug_renderer_info\")) && (_ = B.getParameter(k.UNMASKED_RENDERER_WEBGL)),\n                !_)\n              )\n                return [2, L(1, \"FALLBACK\")];\n              (j = _),\n                (_ = a(_)),\n                (M = (function (e, r, n) {\n                  return \"apple gpu\" === r ? f(e, r, n) : [r];\n                })(B, _, g));\n            }\n            return [4, Promise.all(M.map(E))];\n          case 1:\n            if (\n              !(O = W.sent()\n                .filter(h)\n                .sort(function (e, r) {\n                  var n = e[0],\n                    t = void 0 === n ? Number.MAX_VALUE : n,\n                    o = e[1],\n                    a = r[0],\n                    i = void 0 === a ? Number.MAX_VALUE : a,\n                    c = r[1];\n                  return t === i ? o - c : t - i;\n                })).length\n            )\n              return [\n                2,\n                (T = o.find(function (e) {\n                  return _.includes(e);\n                }))\n                  ? L(0, \"BLOCKLISTED\", T)\n                  : L(1, \"FALLBACK\", \"\".concat(_, \" (\").concat(j, \")\")),\n              ];\n            if (((U = O[0]), (I = U[1]), (D = U[2]), (R = U[3]), -1 === I)) return [2, L(0, \"BLOCKLISTED\", D, I, R)];\n            for (G = g ? l : p, N = 0, K = 0; K < G.length; K++) I >= G[K] && (N = K);\n            return [2, L(N, \"BENCHMARK\", D, I, R)];\n        }\n      });\n    });\n  }),\n    Object.defineProperty(e, \"__esModule\", { value: !0 });\n});\n//# sourceMappingURL=detect-gpu.umd.js.map\n","var map = {\n\t\"./d-adreno.json\": 622,\n\t\"./d-amd.json\": 183,\n\t\"./d-apple.json\": 732,\n\t\"./d-geforce.json\": 405,\n\t\"./d-intel.json\": 178,\n\t\"./d-nvidia.json\": 217,\n\t\"./d-radeon.json\": 145,\n\t\"./m-adreno.json\": 921,\n\t\"./m-apple-ipad.json\": 535,\n\t\"./m-apple.json\": 438,\n\t\"./m-intel.json\": 283,\n\t\"./m-mali-t.json\": 327,\n\t\"./m-mali.json\": 538,\n\t\"./m-nvidia.json\": 884,\n\t\"./m-powervr.json\": 214\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 804;","var LZString = (function () {\n  function o(o, r) {\n    if (!t[o]) {\n      t[o] = {};\n      for (var n = 0; n < o.length; n++) t[o][o.charAt(n)] = n;\n    }\n    return t[o][r];\n  }\n  var r = String.fromCharCode,\n    n = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\",\n    e = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$\",\n    t = {},\n    i = {\n      compressToBase64: function (o) {\n        if (null == o) return \"\";\n        var r = i._compress(o, 6, function (o) {\n          return n.charAt(o);\n        });\n        switch (r.length % 4) {\n          default:\n          case 0:\n            return r;\n          case 1:\n            return r + \"===\";\n          case 2:\n            return r + \"==\";\n          case 3:\n            return r + \"=\";\n        }\n      },\n      decompressFromBase64: function (r) {\n        return null == r\n          ? \"\"\n          : \"\" == r\n          ? null\n          : i._decompress(r.length, 32, function (e) {\n              return o(n, r.charAt(e));\n            });\n      },\n      compressToUTF16: function (o) {\n        return null == o\n          ? \"\"\n          : i._compress(o, 15, function (o) {\n              return r(o + 32);\n            }) + \" \";\n      },\n      decompressFromUTF16: function (o) {\n        return null == o\n          ? \"\"\n          : \"\" == o\n          ? null\n          : i._decompress(o.length, 16384, function (r) {\n              return o.charCodeAt(r) - 32;\n            });\n      },\n      compressToUint8Array: function (o) {\n        for (\n          var r = i.compress(o), n = new Uint8Array(2 * r.length), e = 0, t = r.length;\n          t > e;\n          e++\n        ) {\n          var s = r.charCodeAt(e);\n          (n[2 * e] = s >>> 8), (n[2 * e + 1] = s % 256);\n        }\n        return n;\n      },\n      decompressFromUint8Array: function (o) {\n        if (null === o || void 0 === o) return i.decompress(o);\n        for (var n = new Array(o.length / 2), e = 0, t = n.length; t > e; e++)\n          n[e] = 256 * o[2 * e] + o[2 * e + 1];\n        var s = [];\n        return (\n          n.forEach(function (o) {\n            s.push(r(o));\n          }),\n          i.decompress(s.join(\"\"))\n        );\n      },\n      compressToEncodedURIComponent: function (o) {\n        return null == o\n          ? \"\"\n          : i._compress(o, 6, function (o) {\n              return e.charAt(o);\n            });\n      },\n      decompressFromEncodedURIComponent: function (r) {\n        return null == r\n          ? \"\"\n          : \"\" == r\n          ? null\n          : ((r = r.replace(/ /g, \"+\")),\n            i._decompress(r.length, 32, function (n) {\n              return o(e, r.charAt(n));\n            }));\n      },\n      compress: function (o) {\n        return i._compress(o, 16, function (o) {\n          return r(o);\n        });\n      },\n      _compress: function (o, r, n) {\n        if (null == o) return \"\";\n        var e,\n          t,\n          i,\n          s = {},\n          p = {},\n          u = \"\",\n          c = \"\",\n          a = \"\",\n          l = 2,\n          f = 3,\n          h = 2,\n          d = [],\n          m = 0,\n          v = 0;\n        for (i = 0; i < o.length; i += 1)\n          if (\n            ((u = o.charAt(i)),\n            Object.prototype.hasOwnProperty.call(s, u) || ((s[u] = f++), (p[u] = !0)),\n            (c = a + u),\n            Object.prototype.hasOwnProperty.call(s, c))\n          )\n            a = c;\n          else {\n            if (Object.prototype.hasOwnProperty.call(p, a)) {\n              if (a.charCodeAt(0) < 256) {\n                for (e = 0; h > e; e++)\n                  (m <<= 1), v == r - 1 ? ((v = 0), d.push(n(m)), (m = 0)) : v++;\n                for (t = a.charCodeAt(0), e = 0; 8 > e; e++)\n                  (m = (m << 1) | (1 & t)),\n                    v == r - 1 ? ((v = 0), d.push(n(m)), (m = 0)) : v++,\n                    (t >>= 1);\n              } else {\n                for (t = 1, e = 0; h > e; e++)\n                  (m = (m << 1) | t), v == r - 1 ? ((v = 0), d.push(n(m)), (m = 0)) : v++, (t = 0);\n                for (t = a.charCodeAt(0), e = 0; 16 > e; e++)\n                  (m = (m << 1) | (1 & t)),\n                    v == r - 1 ? ((v = 0), d.push(n(m)), (m = 0)) : v++,\n                    (t >>= 1);\n              }\n              l--, 0 == l && ((l = Math.pow(2, h)), h++), delete p[a];\n            } else\n              for (t = s[a], e = 0; h > e; e++)\n                (m = (m << 1) | (1 & t)),\n                  v == r - 1 ? ((v = 0), d.push(n(m)), (m = 0)) : v++,\n                  (t >>= 1);\n            l--, 0 == l && ((l = Math.pow(2, h)), h++), (s[c] = f++), (a = String(u));\n          }\n        if (\"\" !== a) {\n          if (Object.prototype.hasOwnProperty.call(p, a)) {\n            if (a.charCodeAt(0) < 256) {\n              for (e = 0; h > e; e++)\n                (m <<= 1), v == r - 1 ? ((v = 0), d.push(n(m)), (m = 0)) : v++;\n              for (t = a.charCodeAt(0), e = 0; 8 > e; e++)\n                (m = (m << 1) | (1 & t)),\n                  v == r - 1 ? ((v = 0), d.push(n(m)), (m = 0)) : v++,\n                  (t >>= 1);\n            } else {\n              for (t = 1, e = 0; h > e; e++)\n                (m = (m << 1) | t), v == r - 1 ? ((v = 0), d.push(n(m)), (m = 0)) : v++, (t = 0);\n              for (t = a.charCodeAt(0), e = 0; 16 > e; e++)\n                (m = (m << 1) | (1 & t)),\n                  v == r - 1 ? ((v = 0), d.push(n(m)), (m = 0)) : v++,\n                  (t >>= 1);\n            }\n            l--, 0 == l && ((l = Math.pow(2, h)), h++), delete p[a];\n          } else\n            for (t = s[a], e = 0; h > e; e++)\n              (m = (m << 1) | (1 & t)),\n                v == r - 1 ? ((v = 0), d.push(n(m)), (m = 0)) : v++,\n                (t >>= 1);\n          l--, 0 == l && ((l = Math.pow(2, h)), h++);\n        }\n        for (t = 2, e = 0; h > e; e++)\n          (m = (m << 1) | (1 & t)), v == r - 1 ? ((v = 0), d.push(n(m)), (m = 0)) : v++, (t >>= 1);\n        for (;;) {\n          if (((m <<= 1), v == r - 1)) {\n            d.push(n(m));\n            break;\n          }\n          v++;\n        }\n        return d.join(\"\");\n      },\n      decompress: function (o) {\n        return null == o\n          ? \"\"\n          : \"\" == o\n          ? null\n          : i._decompress(o.length, 32768, function (r) {\n              return o.charCodeAt(r);\n            });\n      },\n      _decompress: function (o, n, e) {\n        var t,\n          i,\n          s,\n          p,\n          u,\n          c,\n          a,\n          l,\n          f = [],\n          h = 4,\n          d = 4,\n          m = 3,\n          v = \"\",\n          w = [],\n          A = { val: e(0), position: n, index: 1 };\n        for (i = 0; 3 > i; i += 1) f[i] = i;\n        for (p = 0, c = Math.pow(2, 2), a = 1; a != c; )\n          (u = A.val & A.position),\n            (A.position >>= 1),\n            0 == A.position && ((A.position = n), (A.val = e(A.index++))),\n            (p |= (u > 0 ? 1 : 0) * a),\n            (a <<= 1);\n        switch ((t = p)) {\n          case 0:\n            for (p = 0, c = Math.pow(2, 8), a = 1; a != c; )\n              (u = A.val & A.position),\n                (A.position >>= 1),\n                0 == A.position && ((A.position = n), (A.val = e(A.index++))),\n                (p |= (u > 0 ? 1 : 0) * a),\n                (a <<= 1);\n            l = r(p);\n            break;\n          case 1:\n            for (p = 0, c = Math.pow(2, 16), a = 1; a != c; )\n              (u = A.val & A.position),\n                (A.position >>= 1),\n                0 == A.position && ((A.position = n), (A.val = e(A.index++))),\n                (p |= (u > 0 ? 1 : 0) * a),\n                (a <<= 1);\n            l = r(p);\n            break;\n          case 2:\n            return \"\";\n        }\n        for (f[3] = l, s = l, w.push(l); ; ) {\n          if (A.index > o) return \"\";\n          for (p = 0, c = Math.pow(2, m), a = 1; a != c; )\n            (u = A.val & A.position),\n              (A.position >>= 1),\n              0 == A.position && ((A.position = n), (A.val = e(A.index++))),\n              (p |= (u > 0 ? 1 : 0) * a),\n              (a <<= 1);\n          switch ((l = p)) {\n            case 0:\n              for (p = 0, c = Math.pow(2, 8), a = 1; a != c; )\n                (u = A.val & A.position),\n                  (A.position >>= 1),\n                  0 == A.position && ((A.position = n), (A.val = e(A.index++))),\n                  (p |= (u > 0 ? 1 : 0) * a),\n                  (a <<= 1);\n              (f[d++] = r(p)), (l = d - 1), h--;\n              break;\n            case 1:\n              for (p = 0, c = Math.pow(2, 16), a = 1; a != c; )\n                (u = A.val & A.position),\n                  (A.position >>= 1),\n                  0 == A.position && ((A.position = n), (A.val = e(A.index++))),\n                  (p |= (u > 0 ? 1 : 0) * a),\n                  (a <<= 1);\n              (f[d++] = r(p)), (l = d - 1), h--;\n              break;\n            case 2:\n              return w.join(\"\");\n          }\n          if ((0 == h && ((h = Math.pow(2, m)), m++), f[l])) v = f[l];\n          else {\n            if (l !== d) return null;\n            v = s + s.charAt(0);\n          }\n          w.push(v),\n            (f[d++] = s + v.charAt(0)),\n            h--,\n            (s = v),\n            0 == h && ((h = Math.pow(2, m)), m++);\n        }\n      },\n    };\n  return i;\n})();\n\"function\" == typeof define && define.amd\n  ? define(function () {\n      return LZString;\n    })\n  : \"undefined\" != typeof module && null != module && (module.exports = LZString);\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tif(__webpack_module_cache__[moduleId]) {\n\t\treturn __webpack_module_cache__[moduleId].exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// module exports must be returned from runtime so entry inlining is disabled\n// startup\n// Load entry module and return exports\nreturn __webpack_require__(607);\n","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","'use strict'\n\nexports.byteLength = byteLength\nexports.toByteArray = toByteArray\nexports.fromByteArray = fromByteArray\n\nvar lookup = []\nvar revLookup = []\nvar Arr = typeof Uint8Array !== 'undefined' ? Uint8Array : Array\n\nvar code = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/'\nfor (var i = 0, len = code.length; i < len; ++i) {\n  lookup[i] = code[i]\n  revLookup[code.charCodeAt(i)] = i\n}\n\n// Support decoding URL-safe base64 strings, as Node.js does.\n// See: https://en.wikipedia.org/wiki/Base64#URL_applications\nrevLookup['-'.charCodeAt(0)] = 62\nrevLookup['_'.charCodeAt(0)] = 63\n\nfunction getLens (b64) {\n  var len = b64.length\n\n  if (len % 4 > 0) {\n    throw new Error('Invalid string. Length must be a multiple of 4')\n  }\n\n  // Trim off extra bytes after placeholder bytes are found\n  // See: https://github.com/beatgammit/base64-js/issues/42\n  var validLen = b64.indexOf('=')\n  if (validLen === -1) validLen = len\n\n  var placeHoldersLen = validLen === len\n    ? 0\n    : 4 - (validLen % 4)\n\n  return [validLen, placeHoldersLen]\n}\n\n// base64 is 4/3 + up to two characters of the original data\nfunction byteLength (b64) {\n  var lens = getLens(b64)\n  var validLen = lens[0]\n  var placeHoldersLen = lens[1]\n  return ((validLen + placeHoldersLen) * 3 / 4) - placeHoldersLen\n}\n\nfunction _byteLength (b64, validLen, placeHoldersLen) {\n  return ((validLen + placeHoldersLen) * 3 / 4) - placeHoldersLen\n}\n\nfunction toByteArray (b64) {\n  var tmp\n  var lens = getLens(b64)\n  var validLen = lens[0]\n  var placeHoldersLen = lens[1]\n\n  var arr = new Arr(_byteLength(b64, validLen, placeHoldersLen))\n\n  var curByte = 0\n\n  // if there are placeholders, only get up to the last complete 4 chars\n  var len = placeHoldersLen > 0\n    ? validLen - 4\n    : validLen\n\n  var i\n  for (i = 0; i < len; i += 4) {\n    tmp =\n      (revLookup[b64.charCodeAt(i)] << 18) |\n      (revLookup[b64.charCodeAt(i + 1)] << 12) |\n      (revLookup[b64.charCodeAt(i + 2)] << 6) |\n      revLookup[b64.charCodeAt(i + 3)]\n    arr[curByte++] = (tmp >> 16) & 0xFF\n    arr[curByte++] = (tmp >> 8) & 0xFF\n    arr[curByte++] = tmp & 0xFF\n  }\n\n  if (placeHoldersLen === 2) {\n    tmp =\n      (revLookup[b64.charCodeAt(i)] << 2) |\n      (revLookup[b64.charCodeAt(i + 1)] >> 4)\n    arr[curByte++] = tmp & 0xFF\n  }\n\n  if (placeHoldersLen === 1) {\n    tmp =\n      (revLookup[b64.charCodeAt(i)] << 10) |\n      (revLookup[b64.charCodeAt(i + 1)] << 4) |\n      (revLookup[b64.charCodeAt(i + 2)] >> 2)\n    arr[curByte++] = (tmp >> 8) & 0xFF\n    arr[curByte++] = tmp & 0xFF\n  }\n\n  return arr\n}\n\nfunction tripletToBase64 (num) {\n  return lookup[num >> 18 & 0x3F] +\n    lookup[num >> 12 & 0x3F] +\n    lookup[num >> 6 & 0x3F] +\n    lookup[num & 0x3F]\n}\n\nfunction encodeChunk (uint8, start, end) {\n  var tmp\n  var output = []\n  for (var i = start; i < end; i += 3) {\n    tmp =\n      ((uint8[i] << 16) & 0xFF0000) +\n      ((uint8[i + 1] << 8) & 0xFF00) +\n      (uint8[i + 2] & 0xFF)\n    output.push(tripletToBase64(tmp))\n  }\n  return output.join('')\n}\n\nfunction fromByteArray (uint8) {\n  var tmp\n  var len = uint8.length\n  var extraBytes = len % 3 // if we have 1 byte left, pad 2 bytes\n  var parts = []\n  var maxChunkLength = 16383 // must be multiple of 3\n\n  // go through the array every three bytes, we'll deal with trailing stuff later\n  for (var i = 0, len2 = len - extraBytes; i < len2; i += maxChunkLength) {\n    parts.push(encodeChunk(uint8, i, (i + maxChunkLength) > len2 ? len2 : (i + maxChunkLength)))\n  }\n\n  // pad the end with zeros, but make sure to not forget the extra bytes\n  if (extraBytes === 1) {\n    tmp = uint8[len - 1]\n    parts.push(\n      lookup[tmp >> 2] +\n      lookup[(tmp << 4) & 0x3F] +\n      '=='\n    )\n  } else if (extraBytes === 2) {\n    tmp = (uint8[len - 2] << 8) + uint8[len - 1]\n    parts.push(\n      lookup[tmp >> 10] +\n      lookup[(tmp >> 4) & 0x3F] +\n      lookup[(tmp << 2) & 0x3F] +\n      '='\n    )\n  }\n\n  return parts.join('')\n}\n","/*!\n * currentExecutingScript\n * Get the currently executing script, regardless of its source/trigger/synchronicity. Similar to HTML5's `document.currentScript` but arguably much more useful!\n * Copyright (c) 2015 James M. Greene\n * Licensed MIT\n * https://github.com/JamesMGreene/currentExecutingScript\n * v0.1.3\n */\n(function(root, factory) {\n  if (typeof define === \"function\" && define.amd) {\n    // AMD. Register as an anonymous module.\n    define([], factory);\n  } else if (typeof exports === \"object\") {\n    // CommonJS-like environments that support `module.exports`,\n    // like Node.js. Does not work with strict CommonJS!\n    module.exports = factory();\n  } else {\n    // Browser globals (`root` is `window`)\n    root.currentExecutingScript = factory();\n  }\n}(\n  // Current context/scope\n  this || window,\n\n  // Factory function to return the export\n  function() {\n\nvar scriptReadyRegex = /^(interactive|loaded|complete)$/;\n\n// This page's URL (minus query string and fragment identifer hash, if any)\nvar fullPageUrl = !!window.location ? window.location.href : null;\nvar pageUrl = fullPageUrl ? fullPageUrl.replace(/#.*$/, \"\").replace(/\\?.*$/, \"\") || null : null;\n\n// Live NodeList collection\nvar scripts = document.getElementsByTagName(\"script\");\n\n// Check if the browser supports the `readyState` property on `script` elements\nvar supportsScriptReadyState = \"readyState\" in (scripts[0] || document.createElement(\"script\"));\n\n// Lousy browser detection for [not] Opera\nvar isNotOpera = !window.opera || window.opera.toString() !== \"[object Opera]\";\n\n// Detect if `document.currentScript` is supported\nvar hasNativeCurrentScriptAccessor = \"currentScript\" in document;\n\nvar originalStackDepthConfig;\n// Detect if the V8 Error Stack Trace API is supported\nif (\"stackTraceLimit\" in Error && Error.stackTraceLimit !== Infinity) {\n  originalStackDepthConfig = Error.stackTraceLimit;\n  Error.stackTraceLimit = Infinity;\n}\n\n\n// In some browsers (e.g. Chrome), you can get the current stack from an Error\n// object instance without needing to throw it. Avoiding an unnecessary\n// use of `throw` saves time and performance.\nvar hasStackBeforeThrowing = false,\n    hasStackAfterThrowing = false;\n(function() {\n  try {\n    var err = new Error();\n    hasStackBeforeThrowing = typeof err.stack === \"string\" && !!err.stack;\n    throw err;\n  }\n  catch (thrownErr) {\n    hasStackAfterThrowing = typeof thrownErr.stack === \"string\" && !!thrownErr.stack;\n  }\n})();\n\n\n// Normalize whitespace within a string\nfunction normalizeWhitespace(str) {\n  return str ? str.replace(/^\\s+$|\\s+$/g, \"\").replace(/\\s\\s+/g, \" \") : \"\";\n}\n\n// Get script object based on the `src` URL\nfunction getScriptFromUrl(url, eligibleScripts) {\n  var i,\n      script = null;\n\n  eligibleScripts = eligibleScripts || scripts;\n\n  if (typeof url === \"string\" && url) {\n    for (i = eligibleScripts.length; i--; ) {\n      if (eligibleScripts[i].src === url) {\n        // NOTE: Could check if the same script URL is used by more than one `script` element\n        // here... but let's not. That would yield less useful results in \"loose\" detection. ;)\n        script = eligibleScripts[i];\n        break;\n      }\n    }\n  }\n  return script;\n}\n\n// Get script object based on the caller function's source code body (text)\nfunction getInlineScriptFromCallerSource(callerFnSource, eligibleScripts) {\n  var i, inlineScriptText,\n      script = null,\n      callerSourceText = normalizeWhitespace(callerFnSource);\n\n  eligibleScripts = eligibleScripts || scripts;\n\n  if (callerFnSource && callerSourceText) {\n    for (i = eligibleScripts.length; i--; ) {\n      // Only look at inline scripts\n      if (!eligibleScripts[i].hasAttribute(\"src\")) {\n        inlineScriptText = normalizeWhitespace(eligibleScripts[i].text);\n        if (inlineScriptText.indexOf(callerSourceText) !== -1) {\n          // If more than one match is found, don't return any\n          if (script) {\n            script = null;\n            break;\n          }\n          script = eligibleScripts[i];\n        }\n      }\n    }\n  }\n\n  return script;\n}\n\n// If there is only a single inline script on the page, return it; otherwise `null`\nfunction getSoleInlineScript(eligibleScripts) {\n  var i, len,\n      script = null;\n  eligibleScripts = eligibleScripts || scripts;\n  for (i = 0, len = eligibleScripts.length; i < len; i++) {\n    if (!eligibleScripts[i].hasAttribute(\"src\")) {\n      if (script) {\n        script = null;\n        break;\n      }\n      script = eligibleScripts[i];\n    }\n  }\n  return script;\n}\n\n// Get the currently executing script URL from an Error stack trace\nfunction getScriptUrlFromStack(stack, skipStackDepth) {\n  var matches, remainingStack,\n      url = null,\n      ignoreMessage = typeof skipStackDepth === \"number\";\n  skipStackDepth = ignoreMessage ? Math.round(skipStackDepth) : 0;\n  if (typeof stack === \"string\" && stack) {\n    if (ignoreMessage) {\n      matches = stack.match(/(data:text\\/javascript(?:;[^,]+)?,.+?|(?:|blob:)(?:http[s]?|file):\\/\\/[\\/]?.+?\\/[^:\\)]*?)(?::\\d+)(?::\\d+)?/);\n    }\n    else {\n      matches = stack.match(/^(?:|[^:@]*@|.+\\)@(?=data:text\\/javascript|blob|http[s]?|file)|.+?\\s+(?: at |@)(?:[^:\\(]+ )*[\\(]?)(data:text\\/javascript(?:;[^,]+)?,.+?|(?:|blob:)(?:http[s]?|file):\\/\\/[\\/]?.+?\\/[^:\\)]*?)(?::\\d+)(?::\\d+)?/);\n\n      if (!(matches && matches[1])) {\n        matches = stack.match(/\\)@(data:text\\/javascript(?:;[^,]+)?,.+?|(?:|blob:)(?:http[s]?|file):\\/\\/[\\/]?.+?\\/[^:\\)]*?)(?::\\d+)(?::\\d+)?/);\n      }\n    }\n\n    if (matches && matches[1]) {\n      if (skipStackDepth > 0) {\n        remainingStack = stack.slice(stack.indexOf(matches[0]) + matches[0].length);\n        url = getScriptUrlFromStack(remainingStack, (skipStackDepth - 1));\n      }\n      else {\n        url = matches[1];\n      }\n    }\n\n    // TODO: Handle more edge cases!\n    // Fixes #1\n    // See https://github.com/JamesMGreene/currentExecutingScript/issues/1\n\n    // ???\n\n  }\n  return url;\n}\n\n\n// Get the farthest currently executing (i.e. yes, EXECUTING) `script` DOM\n// element for the caller function, regardless of whether it is that `script`\n// DOM element is currently being evaluated for the first time. The farthest\n// currently executing `script` DOM element would typically be considered the\n// originator of the current execution stack.\nfunction _farthestExecutingScript() {\n  /*jshint noarg:false */\n\n  // TODO: Implement!\n  // Fixes #3\n  // See https://github.com/JamesMGreene/currentExecutingScript/issues/3\n  return null;\n\n/*\n  // Yes, this IS possible, i.e. if a script removes other scripts (or itself)\n  if (scripts.length === 0) {\n    return null;\n  }\n\n  // Guaranteed accurate in IE 6-10.\n  // Not accurate/supported in any other browsers.\n  if (isNotOpera && supportsScriptReadyState) {\n    for (var i = scripts.length; i--; ) {\n      if (scripts[i].readyState === \"interactive\") {\n        return scripts[i];\n      }\n    }\n  }\n\n  var stack,\n      e = new Error();\n  if (hasStackBeforeThrowing) {\n    stack = e.stack;\n  }\n  if (!stack && hasStackAfterThrowing) {\n    try {\n      throw e;\n    }\n    catch (err) {\n      // NOTE: Cannot use `err.sourceURL` or `err.fileName` as they will always be THIS script\n      stack = err.stack;\n    }\n  }\n  if (stack) {\n    var url = getScriptUrlFromStack(stack, skipStackDepth);\n    var script = getScriptFromUrl(url, scripts );\n    if (!script && pageUrl && url === pageUrl) {\n      // Try to find the correct inline script by searching through\n      // inline scripts' text content for the caller function's source\n      // code to be present. If the caller function's source code is\n      // not available, see if there is only one inline script element\n      // in the DOM and return that (even though it may be wrong)\n\n      // TODO: Implement!\n      // Fixes #4 in part\n      // See https://github.com/JamesMGreene/currentExecutingScript/issues/4\n\n      var callerFn = _farthestExecutingScript.caller || null,\n          callerFnStack = [],\n          callerFnSource = null;\n\n      while (callerFn) {\n        callerFnStack.push(callerFn);\n        callerFn = callerFn.caller || null;\n      }\n      callerFn = callerFnStack.slice(-1)[0];\n      callerFnSource = callerFn ? (\"\" + callerFn) : null;\n\n\n      if (callerFnSource) {\n        script = getInlineScriptFromCallerSource(callerFnSource);\n      }\n      else {\n        // NOTE: This is a loose assumption that could be inaccurate!\n        //\n        // Inaccuracies:\n        //  - If the inline script that initiated the call was also removed from the DOM.\n        //  - If the call was initiated by an element's inline event handler,\n        //    e.g. `<a onclick=\"(function() { alert(currentExecutingScript()); }()\">click</a>`\n        script = getSoleInlineScript();\n      }\n    }\n    return script;\n  }\n\n  // NOTE: This is a loose assumption that could be inaccurate!\n  //\n  // Inaccuracies:\n  //  - If a script is created dynamically and appended to some position\n  //    other than the very end of the document.\n  //  - If multiple scripts are created dynamically and all appended to the\n  //    same position within the document (and do not have their `async` attributes\n  //    set to `false`, at least in browsers that support async script evaluation.\n  //    other than the very end of the document.\n  //  - If any scripts are added with the `async` attribute set to `true` in a browser\n  //    that supports it.\n  //  - May get confused by `script` elements within `svg` elements\n  return scripts[scripts.length - 1] || null;\n*/\n}\n\n\n// Get the originating currently executing (i.e. yes, EXECUTING) `script` DOM\n// element or attribute node (e.g. `onclick`) for the caller function,\n// regardless of whether it is that `script` DOM element is currently being\n// evaluated for the first time. The originating currently executing `script`\n// DOM element [or attribute node] is the originator of the current execution stack.\nfunction _originatingExecutingScript() {\n  // TODO: Implement!\n  // Fixes #2\n  // See https://github.com/JamesMGreene/currentExecutingScript/issues/2\n  return null;\n}\n\n// Get the nearest currently executing (i.e. yes, EXECUTING) `script` DOM\n// element for the caller function, regardless of whether it is that `script`\n// DOM element is currently being evaluated for the first time.\nfunction _nearestExecutingScript() {\n  /*jshint noarg:false */\n\n  // Yes, this IS possible, i.e. if a script removes other scripts (or itself)\n  if (scripts.length === 0) {\n    return null;\n  }\n\n  var i, e, stack, url, script,\n      eligibleScripts = [],\n      skipStackDepth = _nearestExecutingScript.skipStackDepth || 1,\n\n      // TODO: Implement!\n      // Fixes #4 in part\n      // See https://github.com/JamesMGreene/currentExecutingScript/issues/4\n      callerFnSource = null;  //(\"\" + (_nearestExecutingScript.caller || \"\")) || null;\n\n  // This part will only help in IE 6-10.\n  for (i = 0; i < scripts.length; i++) {\n    if (isNotOpera && supportsScriptReadyState) {\n      if (scriptReadyRegex.test(scripts[i].readyState)) {\n        eligibleScripts.push(scripts[i]);\n      }\n    }\n    else {\n      eligibleScripts.push(scripts[i]);\n    }\n  }\n\n  e = new Error();\n  if (hasStackBeforeThrowing) {\n    stack = e.stack;\n  }\n  if (!stack && hasStackAfterThrowing) {\n    try {\n      throw e;\n    }\n    catch (err) {\n      // NOTE: Cannot use `err.sourceURL` or `err.fileName` as they will always be THIS script\n      stack = err.stack;\n    }\n  }\n\n  if (stack) {\n    url = getScriptUrlFromStack(stack, skipStackDepth);\n    script = getScriptFromUrl(url, eligibleScripts);\n\n    if (!script && pageUrl && url === pageUrl) {\n      // Try to find the correct inline script by searching through\n      // inline scripts' text content for the caller function's source\n      // code to be present.\n      if (callerFnSource) {\n        script = getInlineScriptFromCallerSource(callerFnSource, eligibleScripts);\n      }\n      // If the caller function's source code is not available, see if\n      // there is only one inline script element in the DOM and return\n      // that (even though it may be wrong)...\n      else {\n        // NOTE: This is a loose assumption that could be inaccurate!\n        //\n        // Inaccuracies:\n        //  - If the inline script that initiated the call was also removed from the DOM.\n        //  - If the call was initiated by an element's inline event handler,\n        //    e.g. `<a onclick=\"(function() { alert(currentExecutingScript()); }()\">click</a>`\n        script = getSoleInlineScript(eligibleScripts);\n      }\n    }\n  }\n\n  //\n  // Welcome to the Island of Inaccurate Assumptions!\n  // NOTE: ALL of the following are loose assumptions that could be inaccurate!\n  //\n\n  if (!script) {\n    // Inaccuracies:\n    //  - If the inline script that initiated the call was also removed from the DOM.\n    //  - If the call was initiated by an element's inline event handler,\n    //    e.g. `<a onclick=\"(function() { alert(currentExecutingScript()); }()\">click</a>`\n    if (eligibleScripts.length === 1) {\n      script = eligibleScripts[0];\n    }\n  }\n\n  if (!script) {\n    // Inaccuracies:\n    //  - If script currently being synchronously evaluated by the parser is the\n    //    originator of this call stack but NOT the source script of the caller/invocation\n    //    e.g.\n    //    ```html\n    //    <script id=\"a\">\n    //    function getCurrentScriptCallerFn() {\n    //      return currentExecutingScript.near();\n    //    }\n    //    </script>\n    //    <script id=\"b\">\n    //    // Should get `script[id=\"a\"]` but will get `script[id=\"b\"]` instead\n    //    getCurrentScriptCallerFn();\n    //    </script>\n    if (hasNativeCurrentScriptAccessor) {\n      script = document.currentScript;\n    }\n  }\n\n  if (!script) {\n    // Inaccuracies:\n    //  - If script currently being synchronously evaluated by the parser is the\n    //    originator of this call stack but NOT the source script of the caller/invocation\n    //    e.g.\n    //    ```html\n    //    <script id=\"a\">\n    //    function getCurrentScriptCallerFn() {\n    //      return currentExecutingScript.near();\n    //    }\n    //    </script>\n    //    <script id=\"b\">\n    //    // Should get `script[id=\"a\"]` but will get `script[id=\"b\"]` instead\n    //    getCurrentScriptCallerFn();\n    //    </script>\n    if (isNotOpera && supportsScriptReadyState) {\n      for (i = eligibleScripts.length; i--; ) {\n        if (eligibleScripts[i].readyState === \"interactive\") {\n          script = eligibleScripts[i];\n          break;\n        }\n      }\n    }\n  }\n\n  if (!script) {\n    // Inaccuracies:\n    //  - If a script is created dynamically and appended to some position\n    //    other than the very end of the document.\n    //  - If multiple scripts are created dynamically and all appended to the\n    //    same position within the document (and do not have their `async` attributes\n    //    set to `false`, at least in browsers that support async script evaluation.\n    //    other than the very end of the document.\n    //  - If any scripts are added with the `async` attribute set to `true` in a browser\n    //    that supports it.\n    //  - May get confused by `script` elements within `svg` elements\n    //  - If script currently being synchronously evaluated by the parser is the\n    //    originator of this call stack but NOT the source script of the caller/invocation\n    //    e.g.\n    //    ```html\n    //    <script id=\"a\">\n    //    function getCurrentScriptCallerFn() {\n    //      return currentExecutingScript.near();\n    //    }\n    //    </script>\n    //    <script id=\"b\">\n    //    // Should get `script[id=\"a\"]` but will get `script[id=\"b\"]` instead\n    //    getCurrentScriptCallerFn();\n    //    </script>\n    //    ```\n    script = eligibleScripts[eligibleScripts.length - 1] || null;\n  }\n\n  return script;\n}\n\n// Default stack depth to skip over when analyzing call stack frames\n_nearestExecutingScript.skipStackDepth = 1;\n\n\n\n    //\n    // Export the API\n    //\n    var currentExecutingScript    = _nearestExecutingScript;      // default\n    currentExecutingScript.near   = _nearestExecutingScript;\n    currentExecutingScript.far    = _farthestExecutingScript;\n    currentExecutingScript.origin = _originatingExecutingScript;\n\n\n    // Just return a value to define the module export.\n    // This example returns an object, but the module\n    // can return a function as the exported value.\n    return currentExecutingScript;\n  })\n);\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n'use strict';\n\nvar R = typeof Reflect === 'object' ? Reflect : null\nvar ReflectApply = R && typeof R.apply === 'function'\n  ? R.apply\n  : function ReflectApply(target, receiver, args) {\n    return Function.prototype.apply.call(target, receiver, args);\n  }\n\nvar ReflectOwnKeys\nif (R && typeof R.ownKeys === 'function') {\n  ReflectOwnKeys = R.ownKeys\n} else if (Object.getOwnPropertySymbols) {\n  ReflectOwnKeys = function ReflectOwnKeys(target) {\n    return Object.getOwnPropertyNames(target)\n      .concat(Object.getOwnPropertySymbols(target));\n  };\n} else {\n  ReflectOwnKeys = function ReflectOwnKeys(target) {\n    return Object.getOwnPropertyNames(target);\n  };\n}\n\nfunction ProcessEmitWarning(warning) {\n  if (console && console.warn) console.warn(warning);\n}\n\nvar NumberIsNaN = Number.isNaN || function NumberIsNaN(value) {\n  return value !== value;\n}\n\nfunction EventEmitter() {\n  EventEmitter.init.call(this);\n}\nmodule.exports = EventEmitter;\nmodule.exports.once = once;\n\n// Backwards-compat with node 0.10.x\nEventEmitter.EventEmitter = EventEmitter;\n\nEventEmitter.prototype._events = undefined;\nEventEmitter.prototype._eventsCount = 0;\nEventEmitter.prototype._maxListeners = undefined;\n\n// By default EventEmitters will print a warning if more than 10 listeners are\n// added to it. This is a useful default which helps finding memory leaks.\nvar defaultMaxListeners = 10;\n\nfunction checkListener(listener) {\n  if (typeof listener !== 'function') {\n    throw new TypeError('The \"listener\" argument must be of type Function. Received type ' + typeof listener);\n  }\n}\n\nObject.defineProperty(EventEmitter, 'defaultMaxListeners', {\n  enumerable: true,\n  get: function() {\n    return defaultMaxListeners;\n  },\n  set: function(arg) {\n    if (typeof arg !== 'number' || arg < 0 || NumberIsNaN(arg)) {\n      throw new RangeError('The value of \"defaultMaxListeners\" is out of range. It must be a non-negative number. Received ' + arg + '.');\n    }\n    defaultMaxListeners = arg;\n  }\n});\n\nEventEmitter.init = function() {\n\n  if (this._events === undefined ||\n      this._events === Object.getPrototypeOf(this)._events) {\n    this._events = Object.create(null);\n    this._eventsCount = 0;\n  }\n\n  this._maxListeners = this._maxListeners || undefined;\n};\n\n// Obviously not all Emitters should be limited to 10. This function allows\n// that to be increased. Set to zero for unlimited.\nEventEmitter.prototype.setMaxListeners = function setMaxListeners(n) {\n  if (typeof n !== 'number' || n < 0 || NumberIsNaN(n)) {\n    throw new RangeError('The value of \"n\" is out of range. It must be a non-negative number. Received ' + n + '.');\n  }\n  this._maxListeners = n;\n  return this;\n};\n\nfunction _getMaxListeners(that) {\n  if (that._maxListeners === undefined)\n    return EventEmitter.defaultMaxListeners;\n  return that._maxListeners;\n}\n\nEventEmitter.prototype.getMaxListeners = function getMaxListeners() {\n  return _getMaxListeners(this);\n};\n\nEventEmitter.prototype.emit = function emit(type) {\n  var args = [];\n  for (var i = 1; i < arguments.length; i++) args.push(arguments[i]);\n  var doError = (type === 'error');\n\n  var events = this._events;\n  if (events !== undefined)\n    doError = (doError && events.error === undefined);\n  else if (!doError)\n    return false;\n\n  // If there is no 'error' event listener then throw.\n  if (doError) {\n    var er;\n    if (args.length > 0)\n      er = args[0];\n    if (er instanceof Error) {\n      // Note: The comments on the `throw` lines are intentional, they show\n      // up in Node's output if this results in an unhandled exception.\n      throw er; // Unhandled 'error' event\n    }\n    // At least give some kind of context to the user\n    var err = new Error('Unhandled error.' + (er ? ' (' + er.message + ')' : ''));\n    err.context = er;\n    throw err; // Unhandled 'error' event\n  }\n\n  var handler = events[type];\n\n  if (handler === undefined)\n    return false;\n\n  if (typeof handler === 'function') {\n    ReflectApply(handler, this, args);\n  } else {\n    var len = handler.length;\n    var listeners = arrayClone(handler, len);\n    for (var i = 0; i < len; ++i)\n      ReflectApply(listeners[i], this, args);\n  }\n\n  return true;\n};\n\nfunction _addListener(target, type, listener, prepend) {\n  var m;\n  var events;\n  var existing;\n\n  checkListener(listener);\n\n  events = target._events;\n  if (events === undefined) {\n    events = target._events = Object.create(null);\n    target._eventsCount = 0;\n  } else {\n    // To avoid recursion in the case that type === \"newListener\"! Before\n    // adding it to the listeners, first emit \"newListener\".\n    if (events.newListener !== undefined) {\n      target.emit('newListener', type,\n                  listener.listener ? listener.listener : listener);\n\n      // Re-assign `events` because a newListener handler could have caused the\n      // this._events to be assigned to a new object\n      events = target._events;\n    }\n    existing = events[type];\n  }\n\n  if (existing === undefined) {\n    // Optimize the case of one listener. Don't need the extra array object.\n    existing = events[type] = listener;\n    ++target._eventsCount;\n  } else {\n    if (typeof existing === 'function') {\n      // Adding the second element, need to change to array.\n      existing = events[type] =\n        prepend ? [listener, existing] : [existing, listener];\n      // If we've already got an array, just append.\n    } else if (prepend) {\n      existing.unshift(listener);\n    } else {\n      existing.push(listener);\n    }\n\n    // Check for listener leak\n    m = _getMaxListeners(target);\n    if (m > 0 && existing.length > m && !existing.warned) {\n      existing.warned = true;\n      // No error code for this since it is a Warning\n      // eslint-disable-next-line no-restricted-syntax\n      var w = new Error('Possible EventEmitter memory leak detected. ' +\n                          existing.length + ' ' + String(type) + ' listeners ' +\n                          'added. Use emitter.setMaxListeners() to ' +\n                          'increase limit');\n      w.name = 'MaxListenersExceededWarning';\n      w.emitter = target;\n      w.type = type;\n      w.count = existing.length;\n      ProcessEmitWarning(w);\n    }\n  }\n\n  return target;\n}\n\nEventEmitter.prototype.addListener = function addListener(type, listener) {\n  return _addListener(this, type, listener, false);\n};\n\nEventEmitter.prototype.on = EventEmitter.prototype.addListener;\n\nEventEmitter.prototype.prependListener =\n    function prependListener(type, listener) {\n      return _addListener(this, type, listener, true);\n    };\n\nfunction onceWrapper() {\n  if (!this.fired) {\n    this.target.removeListener(this.type, this.wrapFn);\n    this.fired = true;\n    if (arguments.length === 0)\n      return this.listener.call(this.target);\n    return this.listener.apply(this.target, arguments);\n  }\n}\n\nfunction _onceWrap(target, type, listener) {\n  var state = { fired: false, wrapFn: undefined, target: target, type: type, listener: listener };\n  var wrapped = onceWrapper.bind(state);\n  wrapped.listener = listener;\n  state.wrapFn = wrapped;\n  return wrapped;\n}\n\nEventEmitter.prototype.once = function once(type, listener) {\n  checkListener(listener);\n  this.on(type, _onceWrap(this, type, listener));\n  return this;\n};\n\nEventEmitter.prototype.prependOnceListener =\n    function prependOnceListener(type, listener) {\n      checkListener(listener);\n      this.prependListener(type, _onceWrap(this, type, listener));\n      return this;\n    };\n\n// Emits a 'removeListener' event if and only if the listener was removed.\nEventEmitter.prototype.removeListener =\n    function removeListener(type, listener) {\n      var list, events, position, i, originalListener;\n\n      checkListener(listener);\n\n      events = this._events;\n      if (events === undefined)\n        return this;\n\n      list = events[type];\n      if (list === undefined)\n        return this;\n\n      if (list === listener || list.listener === listener) {\n        if (--this._eventsCount === 0)\n          this._events = Object.create(null);\n        else {\n          delete events[type];\n          if (events.removeListener)\n            this.emit('removeListener', type, list.listener || listener);\n        }\n      } else if (typeof list !== 'function') {\n        position = -1;\n\n        for (i = list.length - 1; i >= 0; i--) {\n          if (list[i] === listener || list[i].listener === listener) {\n            originalListener = list[i].listener;\n            position = i;\n            break;\n          }\n        }\n\n        if (position < 0)\n          return this;\n\n        if (position === 0)\n          list.shift();\n        else {\n          spliceOne(list, position);\n        }\n\n        if (list.length === 1)\n          events[type] = list[0];\n\n        if (events.removeListener !== undefined)\n          this.emit('removeListener', type, originalListener || listener);\n      }\n\n      return this;\n    };\n\nEventEmitter.prototype.off = EventEmitter.prototype.removeListener;\n\nEventEmitter.prototype.removeAllListeners =\n    function removeAllListeners(type) {\n      var listeners, events, i;\n\n      events = this._events;\n      if (events === undefined)\n        return this;\n\n      // not listening for removeListener, no need to emit\n      if (events.removeListener === undefined) {\n        if (arguments.length === 0) {\n          this._events = Object.create(null);\n          this._eventsCount = 0;\n        } else if (events[type] !== undefined) {\n          if (--this._eventsCount === 0)\n            this._events = Object.create(null);\n          else\n            delete events[type];\n        }\n        return this;\n      }\n\n      // emit removeListener for all listeners on all events\n      if (arguments.length === 0) {\n        var keys = Object.keys(events);\n        var key;\n        for (i = 0; i < keys.length; ++i) {\n          key = keys[i];\n          if (key === 'removeListener') continue;\n          this.removeAllListeners(key);\n        }\n        this.removeAllListeners('removeListener');\n        this._events = Object.create(null);\n        this._eventsCount = 0;\n        return this;\n      }\n\n      listeners = events[type];\n\n      if (typeof listeners === 'function') {\n        this.removeListener(type, listeners);\n      } else if (listeners !== undefined) {\n        // LIFO order\n        for (i = listeners.length - 1; i >= 0; i--) {\n          this.removeListener(type, listeners[i]);\n        }\n      }\n\n      return this;\n    };\n\nfunction _listeners(target, type, unwrap) {\n  var events = target._events;\n\n  if (events === undefined)\n    return [];\n\n  var evlistener = events[type];\n  if (evlistener === undefined)\n    return [];\n\n  if (typeof evlistener === 'function')\n    return unwrap ? [evlistener.listener || evlistener] : [evlistener];\n\n  return unwrap ?\n    unwrapListeners(evlistener) : arrayClone(evlistener, evlistener.length);\n}\n\nEventEmitter.prototype.listeners = function listeners(type) {\n  return _listeners(this, type, true);\n};\n\nEventEmitter.prototype.rawListeners = function rawListeners(type) {\n  return _listeners(this, type, false);\n};\n\nEventEmitter.listenerCount = function(emitter, type) {\n  if (typeof emitter.listenerCount === 'function') {\n    return emitter.listenerCount(type);\n  } else {\n    return listenerCount.call(emitter, type);\n  }\n};\n\nEventEmitter.prototype.listenerCount = listenerCount;\nfunction listenerCount(type) {\n  var events = this._events;\n\n  if (events !== undefined) {\n    var evlistener = events[type];\n\n    if (typeof evlistener === 'function') {\n      return 1;\n    } else if (evlistener !== undefined) {\n      return evlistener.length;\n    }\n  }\n\n  return 0;\n}\n\nEventEmitter.prototype.eventNames = function eventNames() {\n  return this._eventsCount > 0 ? ReflectOwnKeys(this._events) : [];\n};\n\nfunction arrayClone(arr, n) {\n  var copy = new Array(n);\n  for (var i = 0; i < n; ++i)\n    copy[i] = arr[i];\n  return copy;\n}\n\nfunction spliceOne(list, index) {\n  for (; index + 1 < list.length; index++)\n    list[index] = list[index + 1];\n  list.pop();\n}\n\nfunction unwrapListeners(arr) {\n  var ret = new Array(arr.length);\n  for (var i = 0; i < ret.length; ++i) {\n    ret[i] = arr[i].listener || arr[i];\n  }\n  return ret;\n}\n\nfunction once(emitter, name) {\n  return new Promise(function (resolve, reject) {\n    function errorListener(err) {\n      emitter.removeListener(name, resolver);\n      reject(err);\n    }\n\n    function resolver() {\n      if (typeof emitter.removeListener === 'function') {\n        emitter.removeListener('error', errorListener);\n      }\n      resolve([].slice.call(arguments));\n    };\n\n    eventTargetAgnosticAddListener(emitter, name, resolver, { once: true });\n    if (name !== 'error') {\n      addErrorHandlerIfEventEmitter(emitter, errorListener, { once: true });\n    }\n  });\n}\n\nfunction addErrorHandlerIfEventEmitter(emitter, handler, flags) {\n  if (typeof emitter.on === 'function') {\n    eventTargetAgnosticAddListener(emitter, 'error', handler, flags);\n  }\n}\n\nfunction eventTargetAgnosticAddListener(emitter, name, listener, flags) {\n  if (typeof emitter.on === 'function') {\n    if (flags.once) {\n      emitter.once(name, listener);\n    } else {\n      emitter.on(name, listener);\n    }\n  } else if (typeof emitter.addEventListener === 'function') {\n    // EventTarget does not have `error` event semantics like Node\n    // EventEmitters, we do not listen for `error` events here.\n    emitter.addEventListener(name, function wrapListener(arg) {\n      // IE does not have builtin `{ once: true }` support so we\n      // have to do it manually.\n      if (flags.once) {\n        emitter.removeEventListener(name, wrapListener);\n      }\n      listener(arg);\n    });\n  } else {\n    throw new TypeError('The \"emitter\" argument must be of type EventEmitter. Received type ' + typeof emitter);\n  }\n}\n","/**\n * [js-md5]{@link https://github.com/emn178/js-md5}\n *\n * @namespace md5\n * @version 0.7.3\n * @author Chen, Yi-Cyuan [emn178@gmail.com]\n * @copyright Chen, Yi-Cyuan 2014-2017\n * @license MIT\n */\n(function () {\n  'use strict';\n\n  var ERROR = 'input is invalid type';\n  var WINDOW = typeof window === 'object';\n  var root = WINDOW ? window : {};\n  if (root.JS_MD5_NO_WINDOW) {\n    WINDOW = false;\n  }\n  var WEB_WORKER = !WINDOW && typeof self === 'object';\n  var NODE_JS = !root.JS_MD5_NO_NODE_JS && typeof process === 'object' && process.versions && process.versions.node;\n  if (NODE_JS) {\n    root = global;\n  } else if (WEB_WORKER) {\n    root = self;\n  }\n  var COMMON_JS = !root.JS_MD5_NO_COMMON_JS && typeof module === 'object' && module.exports;\n  var AMD = typeof define === 'function' && define.amd;\n  var ARRAY_BUFFER = !root.JS_MD5_NO_ARRAY_BUFFER && typeof ArrayBuffer !== 'undefined';\n  var HEX_CHARS = '0123456789abcdef'.split('');\n  var EXTRA = [128, 32768, 8388608, -2147483648];\n  var SHIFT = [0, 8, 16, 24];\n  var OUTPUT_TYPES = ['hex', 'array', 'digest', 'buffer', 'arrayBuffer', 'base64'];\n  var BASE64_ENCODE_CHAR = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/'.split('');\n\n  var blocks = [], buffer8;\n  if (ARRAY_BUFFER) {\n    var buffer = new ArrayBuffer(68);\n    buffer8 = new Uint8Array(buffer);\n    blocks = new Uint32Array(buffer);\n  }\n\n  if (root.JS_MD5_NO_NODE_JS || !Array.isArray) {\n    Array.isArray = function (obj) {\n      return Object.prototype.toString.call(obj) === '[object Array]';\n    };\n  }\n\n  if (ARRAY_BUFFER && (root.JS_MD5_NO_ARRAY_BUFFER_IS_VIEW || !ArrayBuffer.isView)) {\n    ArrayBuffer.isView = function (obj) {\n      return typeof obj === 'object' && obj.buffer && obj.buffer.constructor === ArrayBuffer;\n    };\n  }\n\n  /**\n   * @method hex\n   * @memberof md5\n   * @description Output hash as hex string\n   * @param {String|Array|Uint8Array|ArrayBuffer} message message to hash\n   * @returns {String} Hex string\n   * @example\n   * md5.hex('The quick brown fox jumps over the lazy dog');\n   * // equal to\n   * md5('The quick brown fox jumps over the lazy dog');\n   */\n  /**\n   * @method digest\n   * @memberof md5\n   * @description Output hash as bytes array\n   * @param {String|Array|Uint8Array|ArrayBuffer} message message to hash\n   * @returns {Array} Bytes array\n   * @example\n   * md5.digest('The quick brown fox jumps over the lazy dog');\n   */\n  /**\n   * @method array\n   * @memberof md5\n   * @description Output hash as bytes array\n   * @param {String|Array|Uint8Array|ArrayBuffer} message message to hash\n   * @returns {Array} Bytes array\n   * @example\n   * md5.array('The quick brown fox jumps over the lazy dog');\n   */\n  /**\n   * @method arrayBuffer\n   * @memberof md5\n   * @description Output hash as ArrayBuffer\n   * @param {String|Array|Uint8Array|ArrayBuffer} message message to hash\n   * @returns {ArrayBuffer} ArrayBuffer\n   * @example\n   * md5.arrayBuffer('The quick brown fox jumps over the lazy dog');\n   */\n  /**\n   * @method buffer\n   * @deprecated This maybe confuse with Buffer in node.js. Please use arrayBuffer instead.\n   * @memberof md5\n   * @description Output hash as ArrayBuffer\n   * @param {String|Array|Uint8Array|ArrayBuffer} message message to hash\n   * @returns {ArrayBuffer} ArrayBuffer\n   * @example\n   * md5.buffer('The quick brown fox jumps over the lazy dog');\n   */\n  /**\n   * @method base64\n   * @memberof md5\n   * @description Output hash as base64 string\n   * @param {String|Array|Uint8Array|ArrayBuffer} message message to hash\n   * @returns {String} base64 string\n   * @example\n   * md5.base64('The quick brown fox jumps over the lazy dog');\n   */\n  var createOutputMethod = function (outputType) {\n    return function (message) {\n      return new Md5(true).update(message)[outputType]();\n    };\n  };\n\n  /**\n   * @method create\n   * @memberof md5\n   * @description Create Md5 object\n   * @returns {Md5} Md5 object.\n   * @example\n   * var hash = md5.create();\n   */\n  /**\n   * @method update\n   * @memberof md5\n   * @description Create and update Md5 object\n   * @param {String|Array|Uint8Array|ArrayBuffer} message message to hash\n   * @returns {Md5} Md5 object.\n   * @example\n   * var hash = md5.update('The quick brown fox jumps over the lazy dog');\n   * // equal to\n   * var hash = md5.create();\n   * hash.update('The quick brown fox jumps over the lazy dog');\n   */\n  var createMethod = function () {\n    var method = createOutputMethod('hex');\n    if (NODE_JS) {\n      method = nodeWrap(method);\n    }\n    method.create = function () {\n      return new Md5();\n    };\n    method.update = function (message) {\n      return method.create().update(message);\n    };\n    for (var i = 0; i < OUTPUT_TYPES.length; ++i) {\n      var type = OUTPUT_TYPES[i];\n      method[type] = createOutputMethod(type);\n    }\n    return method;\n  };\n\n  var nodeWrap = function (method) {\n    var crypto = eval(\"require('crypto')\");\n    var Buffer = eval(\"require('buffer').Buffer\");\n    var nodeMethod = function (message) {\n      if (typeof message === 'string') {\n        return crypto.createHash('md5').update(message, 'utf8').digest('hex');\n      } else {\n        if (message === null || message === undefined) {\n          throw ERROR;\n        } else if (message.constructor === ArrayBuffer) {\n          message = new Uint8Array(message);\n        }\n      }\n      if (Array.isArray(message) || ArrayBuffer.isView(message) ||\n        message.constructor === Buffer) {\n        return crypto.createHash('md5').update(new Buffer(message)).digest('hex');\n      } else {\n        return method(message);\n      }\n    };\n    return nodeMethod;\n  };\n\n  /**\n   * Md5 class\n   * @class Md5\n   * @description This is internal class.\n   * @see {@link md5.create}\n   */\n  function Md5(sharedMemory) {\n    if (sharedMemory) {\n      blocks[0] = blocks[16] = blocks[1] = blocks[2] = blocks[3] =\n      blocks[4] = blocks[5] = blocks[6] = blocks[7] =\n      blocks[8] = blocks[9] = blocks[10] = blocks[11] =\n      blocks[12] = blocks[13] = blocks[14] = blocks[15] = 0;\n      this.blocks = blocks;\n      this.buffer8 = buffer8;\n    } else {\n      if (ARRAY_BUFFER) {\n        var buffer = new ArrayBuffer(68);\n        this.buffer8 = new Uint8Array(buffer);\n        this.blocks = new Uint32Array(buffer);\n      } else {\n        this.blocks = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];\n      }\n    }\n    this.h0 = this.h1 = this.h2 = this.h3 = this.start = this.bytes = this.hBytes = 0;\n    this.finalized = this.hashed = false;\n    this.first = true;\n  }\n\n  /**\n   * @method update\n   * @memberof Md5\n   * @instance\n   * @description Update hash\n   * @param {String|Array|Uint8Array|ArrayBuffer} message message to hash\n   * @returns {Md5} Md5 object.\n   * @see {@link md5.update}\n   */\n  Md5.prototype.update = function (message) {\n    if (this.finalized) {\n      return;\n    }\n\n    var notString, type = typeof message;\n    if (type !== 'string') {\n      if (type === 'object') {\n        if (message === null) {\n          throw ERROR;\n        } else if (ARRAY_BUFFER && message.constructor === ArrayBuffer) {\n          message = new Uint8Array(message);\n        } else if (!Array.isArray(message)) {\n          if (!ARRAY_BUFFER || !ArrayBuffer.isView(message)) {\n            throw ERROR;\n          }\n        }\n      } else {\n        throw ERROR;\n      }\n      notString = true;\n    }\n    var code, index = 0, i, length = message.length, blocks = this.blocks;\n    var buffer8 = this.buffer8;\n\n    while (index < length) {\n      if (this.hashed) {\n        this.hashed = false;\n        blocks[0] = blocks[16];\n        blocks[16] = blocks[1] = blocks[2] = blocks[3] =\n        blocks[4] = blocks[5] = blocks[6] = blocks[7] =\n        blocks[8] = blocks[9] = blocks[10] = blocks[11] =\n        blocks[12] = blocks[13] = blocks[14] = blocks[15] = 0;\n      }\n\n      if (notString) {\n        if (ARRAY_BUFFER) {\n          for (i = this.start; index < length && i < 64; ++index) {\n            buffer8[i++] = message[index];\n          }\n        } else {\n          for (i = this.start; index < length && i < 64; ++index) {\n            blocks[i >> 2] |= message[index] << SHIFT[i++ & 3];\n          }\n        }\n      } else {\n        if (ARRAY_BUFFER) {\n          for (i = this.start; index < length && i < 64; ++index) {\n            code = message.charCodeAt(index);\n            if (code < 0x80) {\n              buffer8[i++] = code;\n            } else if (code < 0x800) {\n              buffer8[i++] = 0xc0 | (code >> 6);\n              buffer8[i++] = 0x80 | (code & 0x3f);\n            } else if (code < 0xd800 || code >= 0xe000) {\n              buffer8[i++] = 0xe0 | (code >> 12);\n              buffer8[i++] = 0x80 | ((code >> 6) & 0x3f);\n              buffer8[i++] = 0x80 | (code & 0x3f);\n            } else {\n              code = 0x10000 + (((code & 0x3ff) << 10) | (message.charCodeAt(++index) & 0x3ff));\n              buffer8[i++] = 0xf0 | (code >> 18);\n              buffer8[i++] = 0x80 | ((code >> 12) & 0x3f);\n              buffer8[i++] = 0x80 | ((code >> 6) & 0x3f);\n              buffer8[i++] = 0x80 | (code & 0x3f);\n            }\n          }\n        } else {\n          for (i = this.start; index < length && i < 64; ++index) {\n            code = message.charCodeAt(index);\n            if (code < 0x80) {\n              blocks[i >> 2] |= code << SHIFT[i++ & 3];\n            } else if (code < 0x800) {\n              blocks[i >> 2] |= (0xc0 | (code >> 6)) << SHIFT[i++ & 3];\n              blocks[i >> 2] |= (0x80 | (code & 0x3f)) << SHIFT[i++ & 3];\n            } else if (code < 0xd800 || code >= 0xe000) {\n              blocks[i >> 2] |= (0xe0 | (code >> 12)) << SHIFT[i++ & 3];\n              blocks[i >> 2] |= (0x80 | ((code >> 6) & 0x3f)) << SHIFT[i++ & 3];\n              blocks[i >> 2] |= (0x80 | (code & 0x3f)) << SHIFT[i++ & 3];\n            } else {\n              code = 0x10000 + (((code & 0x3ff) << 10) | (message.charCodeAt(++index) & 0x3ff));\n              blocks[i >> 2] |= (0xf0 | (code >> 18)) << SHIFT[i++ & 3];\n              blocks[i >> 2] |= (0x80 | ((code >> 12) & 0x3f)) << SHIFT[i++ & 3];\n              blocks[i >> 2] |= (0x80 | ((code >> 6) & 0x3f)) << SHIFT[i++ & 3];\n              blocks[i >> 2] |= (0x80 | (code & 0x3f)) << SHIFT[i++ & 3];\n            }\n          }\n        }\n      }\n      this.lastByteIndex = i;\n      this.bytes += i - this.start;\n      if (i >= 64) {\n        this.start = i - 64;\n        this.hash();\n        this.hashed = true;\n      } else {\n        this.start = i;\n      }\n    }\n    if (this.bytes > 4294967295) {\n      this.hBytes += this.bytes / 4294967296 << 0;\n      this.bytes = this.bytes % 4294967296;\n    }\n    return this;\n  };\n\n  Md5.prototype.finalize = function () {\n    if (this.finalized) {\n      return;\n    }\n    this.finalized = true;\n    var blocks = this.blocks, i = this.lastByteIndex;\n    blocks[i >> 2] |= EXTRA[i & 3];\n    if (i >= 56) {\n      if (!this.hashed) {\n        this.hash();\n      }\n      blocks[0] = blocks[16];\n      blocks[16] = blocks[1] = blocks[2] = blocks[3] =\n      blocks[4] = blocks[5] = blocks[6] = blocks[7] =\n      blocks[8] = blocks[9] = blocks[10] = blocks[11] =\n      blocks[12] = blocks[13] = blocks[14] = blocks[15] = 0;\n    }\n    blocks[14] = this.bytes << 3;\n    blocks[15] = this.hBytes << 3 | this.bytes >>> 29;\n    this.hash();\n  };\n\n  Md5.prototype.hash = function () {\n    var a, b, c, d, bc, da, blocks = this.blocks;\n\n    if (this.first) {\n      a = blocks[0] - 680876937;\n      a = (a << 7 | a >>> 25) - 271733879 << 0;\n      d = (-1732584194 ^ a & 2004318071) + blocks[1] - 117830708;\n      d = (d << 12 | d >>> 20) + a << 0;\n      c = (-271733879 ^ (d & (a ^ -271733879))) + blocks[2] - 1126478375;\n      c = (c << 17 | c >>> 15) + d << 0;\n      b = (a ^ (c & (d ^ a))) + blocks[3] - 1316259209;\n      b = (b << 22 | b >>> 10) + c << 0;\n    } else {\n      a = this.h0;\n      b = this.h1;\n      c = this.h2;\n      d = this.h3;\n      a += (d ^ (b & (c ^ d))) + blocks[0] - 680876936;\n      a = (a << 7 | a >>> 25) + b << 0;\n      d += (c ^ (a & (b ^ c))) + blocks[1] - 389564586;\n      d = (d << 12 | d >>> 20) + a << 0;\n      c += (b ^ (d & (a ^ b))) + blocks[2] + 606105819;\n      c = (c << 17 | c >>> 15) + d << 0;\n      b += (a ^ (c & (d ^ a))) + blocks[3] - 1044525330;\n      b = (b << 22 | b >>> 10) + c << 0;\n    }\n\n    a += (d ^ (b & (c ^ d))) + blocks[4] - 176418897;\n    a = (a << 7 | a >>> 25) + b << 0;\n    d += (c ^ (a & (b ^ c))) + blocks[5] + 1200080426;\n    d = (d << 12 | d >>> 20) + a << 0;\n    c += (b ^ (d & (a ^ b))) + blocks[6] - 1473231341;\n    c = (c << 17 | c >>> 15) + d << 0;\n    b += (a ^ (c & (d ^ a))) + blocks[7] - 45705983;\n    b = (b << 22 | b >>> 10) + c << 0;\n    a += (d ^ (b & (c ^ d))) + blocks[8] + 1770035416;\n    a = (a << 7 | a >>> 25) + b << 0;\n    d += (c ^ (a & (b ^ c))) + blocks[9] - 1958414417;\n    d = (d << 12 | d >>> 20) + a << 0;\n    c += (b ^ (d & (a ^ b))) + blocks[10] - 42063;\n    c = (c << 17 | c >>> 15) + d << 0;\n    b += (a ^ (c & (d ^ a))) + blocks[11] - 1990404162;\n    b = (b << 22 | b >>> 10) + c << 0;\n    a += (d ^ (b & (c ^ d))) + blocks[12] + 1804603682;\n    a = (a << 7 | a >>> 25) + b << 0;\n    d += (c ^ (a & (b ^ c))) + blocks[13] - 40341101;\n    d = (d << 12 | d >>> 20) + a << 0;\n    c += (b ^ (d & (a ^ b))) + blocks[14] - 1502002290;\n    c = (c << 17 | c >>> 15) + d << 0;\n    b += (a ^ (c & (d ^ a))) + blocks[15] + 1236535329;\n    b = (b << 22 | b >>> 10) + c << 0;\n    a += (c ^ (d & (b ^ c))) + blocks[1] - 165796510;\n    a = (a << 5 | a >>> 27) + b << 0;\n    d += (b ^ (c & (a ^ b))) + blocks[6] - 1069501632;\n    d = (d << 9 | d >>> 23) + a << 0;\n    c += (a ^ (b & (d ^ a))) + blocks[11] + 643717713;\n    c = (c << 14 | c >>> 18) + d << 0;\n    b += (d ^ (a & (c ^ d))) + blocks[0] - 373897302;\n    b = (b << 20 | b >>> 12) + c << 0;\n    a += (c ^ (d & (b ^ c))) + blocks[5] - 701558691;\n    a = (a << 5 | a >>> 27) + b << 0;\n    d += (b ^ (c & (a ^ b))) + blocks[10] + 38016083;\n    d = (d << 9 | d >>> 23) + a << 0;\n    c += (a ^ (b & (d ^ a))) + blocks[15] - 660478335;\n    c = (c << 14 | c >>> 18) + d << 0;\n    b += (d ^ (a & (c ^ d))) + blocks[4] - 405537848;\n    b = (b << 20 | b >>> 12) + c << 0;\n    a += (c ^ (d & (b ^ c))) + blocks[9] + 568446438;\n    a = (a << 5 | a >>> 27) + b << 0;\n    d += (b ^ (c & (a ^ b))) + blocks[14] - 1019803690;\n    d = (d << 9 | d >>> 23) + a << 0;\n    c += (a ^ (b & (d ^ a))) + blocks[3] - 187363961;\n    c = (c << 14 | c >>> 18) + d << 0;\n    b += (d ^ (a & (c ^ d))) + blocks[8] + 1163531501;\n    b = (b << 20 | b >>> 12) + c << 0;\n    a += (c ^ (d & (b ^ c))) + blocks[13] - 1444681467;\n    a = (a << 5 | a >>> 27) + b << 0;\n    d += (b ^ (c & (a ^ b))) + blocks[2] - 51403784;\n    d = (d << 9 | d >>> 23) + a << 0;\n    c += (a ^ (b & (d ^ a))) + blocks[7] + 1735328473;\n    c = (c << 14 | c >>> 18) + d << 0;\n    b += (d ^ (a & (c ^ d))) + blocks[12] - 1926607734;\n    b = (b << 20 | b >>> 12) + c << 0;\n    bc = b ^ c;\n    a += (bc ^ d) + blocks[5] - 378558;\n    a = (a << 4 | a >>> 28) + b << 0;\n    d += (bc ^ a) + blocks[8] - 2022574463;\n    d = (d << 11 | d >>> 21) + a << 0;\n    da = d ^ a;\n    c += (da ^ b) + blocks[11] + 1839030562;\n    c = (c << 16 | c >>> 16) + d << 0;\n    b += (da ^ c) + blocks[14] - 35309556;\n    b = (b << 23 | b >>> 9) + c << 0;\n    bc = b ^ c;\n    a += (bc ^ d) + blocks[1] - 1530992060;\n    a = (a << 4 | a >>> 28) + b << 0;\n    d += (bc ^ a) + blocks[4] + 1272893353;\n    d = (d << 11 | d >>> 21) + a << 0;\n    da = d ^ a;\n    c += (da ^ b) + blocks[7] - 155497632;\n    c = (c << 16 | c >>> 16) + d << 0;\n    b += (da ^ c) + blocks[10] - 1094730640;\n    b = (b << 23 | b >>> 9) + c << 0;\n    bc = b ^ c;\n    a += (bc ^ d) + blocks[13] + 681279174;\n    a = (a << 4 | a >>> 28) + b << 0;\n    d += (bc ^ a) + blocks[0] - 358537222;\n    d = (d << 11 | d >>> 21) + a << 0;\n    da = d ^ a;\n    c += (da ^ b) + blocks[3] - 722521979;\n    c = (c << 16 | c >>> 16) + d << 0;\n    b += (da ^ c) + blocks[6] + 76029189;\n    b = (b << 23 | b >>> 9) + c << 0;\n    bc = b ^ c;\n    a += (bc ^ d) + blocks[9] - 640364487;\n    a = (a << 4 | a >>> 28) + b << 0;\n    d += (bc ^ a) + blocks[12] - 421815835;\n    d = (d << 11 | d >>> 21) + a << 0;\n    da = d ^ a;\n    c += (da ^ b) + blocks[15] + 530742520;\n    c = (c << 16 | c >>> 16) + d << 0;\n    b += (da ^ c) + blocks[2] - 995338651;\n    b = (b << 23 | b >>> 9) + c << 0;\n    a += (c ^ (b | ~d)) + blocks[0] - 198630844;\n    a = (a << 6 | a >>> 26) + b << 0;\n    d += (b ^ (a | ~c)) + blocks[7] + 1126891415;\n    d = (d << 10 | d >>> 22) + a << 0;\n    c += (a ^ (d | ~b)) + blocks[14] - 1416354905;\n    c = (c << 15 | c >>> 17) + d << 0;\n    b += (d ^ (c | ~a)) + blocks[5] - 57434055;\n    b = (b << 21 | b >>> 11) + c << 0;\n    a += (c ^ (b | ~d)) + blocks[12] + 1700485571;\n    a = (a << 6 | a >>> 26) + b << 0;\n    d += (b ^ (a | ~c)) + blocks[3] - 1894986606;\n    d = (d << 10 | d >>> 22) + a << 0;\n    c += (a ^ (d | ~b)) + blocks[10] - 1051523;\n    c = (c << 15 | c >>> 17) + d << 0;\n    b += (d ^ (c | ~a)) + blocks[1] - 2054922799;\n    b = (b << 21 | b >>> 11) + c << 0;\n    a += (c ^ (b | ~d)) + blocks[8] + 1873313359;\n    a = (a << 6 | a >>> 26) + b << 0;\n    d += (b ^ (a | ~c)) + blocks[15] - 30611744;\n    d = (d << 10 | d >>> 22) + a << 0;\n    c += (a ^ (d | ~b)) + blocks[6] - 1560198380;\n    c = (c << 15 | c >>> 17) + d << 0;\n    b += (d ^ (c | ~a)) + blocks[13] + 1309151649;\n    b = (b << 21 | b >>> 11) + c << 0;\n    a += (c ^ (b | ~d)) + blocks[4] - 145523070;\n    a = (a << 6 | a >>> 26) + b << 0;\n    d += (b ^ (a | ~c)) + blocks[11] - 1120210379;\n    d = (d << 10 | d >>> 22) + a << 0;\n    c += (a ^ (d | ~b)) + blocks[2] + 718787259;\n    c = (c << 15 | c >>> 17) + d << 0;\n    b += (d ^ (c | ~a)) + blocks[9] - 343485551;\n    b = (b << 21 | b >>> 11) + c << 0;\n\n    if (this.first) {\n      this.h0 = a + 1732584193 << 0;\n      this.h1 = b - 271733879 << 0;\n      this.h2 = c - 1732584194 << 0;\n      this.h3 = d + 271733878 << 0;\n      this.first = false;\n    } else {\n      this.h0 = this.h0 + a << 0;\n      this.h1 = this.h1 + b << 0;\n      this.h2 = this.h2 + c << 0;\n      this.h3 = this.h3 + d << 0;\n    }\n  };\n\n  /**\n   * @method hex\n   * @memberof Md5\n   * @instance\n   * @description Output hash as hex string\n   * @returns {String} Hex string\n   * @see {@link md5.hex}\n   * @example\n   * hash.hex();\n   */\n  Md5.prototype.hex = function () {\n    this.finalize();\n\n    var h0 = this.h0, h1 = this.h1, h2 = this.h2, h3 = this.h3;\n\n    return HEX_CHARS[(h0 >> 4) & 0x0F] + HEX_CHARS[h0 & 0x0F] +\n      HEX_CHARS[(h0 >> 12) & 0x0F] + HEX_CHARS[(h0 >> 8) & 0x0F] +\n      HEX_CHARS[(h0 >> 20) & 0x0F] + HEX_CHARS[(h0 >> 16) & 0x0F] +\n      HEX_CHARS[(h0 >> 28) & 0x0F] + HEX_CHARS[(h0 >> 24) & 0x0F] +\n      HEX_CHARS[(h1 >> 4) & 0x0F] + HEX_CHARS[h1 & 0x0F] +\n      HEX_CHARS[(h1 >> 12) & 0x0F] + HEX_CHARS[(h1 >> 8) & 0x0F] +\n      HEX_CHARS[(h1 >> 20) & 0x0F] + HEX_CHARS[(h1 >> 16) & 0x0F] +\n      HEX_CHARS[(h1 >> 28) & 0x0F] + HEX_CHARS[(h1 >> 24) & 0x0F] +\n      HEX_CHARS[(h2 >> 4) & 0x0F] + HEX_CHARS[h2 & 0x0F] +\n      HEX_CHARS[(h2 >> 12) & 0x0F] + HEX_CHARS[(h2 >> 8) & 0x0F] +\n      HEX_CHARS[(h2 >> 20) & 0x0F] + HEX_CHARS[(h2 >> 16) & 0x0F] +\n      HEX_CHARS[(h2 >> 28) & 0x0F] + HEX_CHARS[(h2 >> 24) & 0x0F] +\n      HEX_CHARS[(h3 >> 4) & 0x0F] + HEX_CHARS[h3 & 0x0F] +\n      HEX_CHARS[(h3 >> 12) & 0x0F] + HEX_CHARS[(h3 >> 8) & 0x0F] +\n      HEX_CHARS[(h3 >> 20) & 0x0F] + HEX_CHARS[(h3 >> 16) & 0x0F] +\n      HEX_CHARS[(h3 >> 28) & 0x0F] + HEX_CHARS[(h3 >> 24) & 0x0F];\n  };\n\n  /**\n   * @method toString\n   * @memberof Md5\n   * @instance\n   * @description Output hash as hex string\n   * @returns {String} Hex string\n   * @see {@link md5.hex}\n   * @example\n   * hash.toString();\n   */\n  Md5.prototype.toString = Md5.prototype.hex;\n\n  /**\n   * @method digest\n   * @memberof Md5\n   * @instance\n   * @description Output hash as bytes array\n   * @returns {Array} Bytes array\n   * @see {@link md5.digest}\n   * @example\n   * hash.digest();\n   */\n  Md5.prototype.digest = function () {\n    this.finalize();\n\n    var h0 = this.h0, h1 = this.h1, h2 = this.h2, h3 = this.h3;\n    return [\n      h0 & 0xFF, (h0 >> 8) & 0xFF, (h0 >> 16) & 0xFF, (h0 >> 24) & 0xFF,\n      h1 & 0xFF, (h1 >> 8) & 0xFF, (h1 >> 16) & 0xFF, (h1 >> 24) & 0xFF,\n      h2 & 0xFF, (h2 >> 8) & 0xFF, (h2 >> 16) & 0xFF, (h2 >> 24) & 0xFF,\n      h3 & 0xFF, (h3 >> 8) & 0xFF, (h3 >> 16) & 0xFF, (h3 >> 24) & 0xFF\n    ];\n  };\n\n  /**\n   * @method array\n   * @memberof Md5\n   * @instance\n   * @description Output hash as bytes array\n   * @returns {Array} Bytes array\n   * @see {@link md5.array}\n   * @example\n   * hash.array();\n   */\n  Md5.prototype.array = Md5.prototype.digest;\n\n  /**\n   * @method arrayBuffer\n   * @memberof Md5\n   * @instance\n   * @description Output hash as ArrayBuffer\n   * @returns {ArrayBuffer} ArrayBuffer\n   * @see {@link md5.arrayBuffer}\n   * @example\n   * hash.arrayBuffer();\n   */\n  Md5.prototype.arrayBuffer = function () {\n    this.finalize();\n\n    var buffer = new ArrayBuffer(16);\n    var blocks = new Uint32Array(buffer);\n    blocks[0] = this.h0;\n    blocks[1] = this.h1;\n    blocks[2] = this.h2;\n    blocks[3] = this.h3;\n    return buffer;\n  };\n\n  /**\n   * @method buffer\n   * @deprecated This maybe confuse with Buffer in node.js. Please use arrayBuffer instead.\n   * @memberof Md5\n   * @instance\n   * @description Output hash as ArrayBuffer\n   * @returns {ArrayBuffer} ArrayBuffer\n   * @see {@link md5.buffer}\n   * @example\n   * hash.buffer();\n   */\n  Md5.prototype.buffer = Md5.prototype.arrayBuffer;\n\n  /**\n   * @method base64\n   * @memberof Md5\n   * @instance\n   * @description Output hash as base64 string\n   * @returns {String} base64 string\n   * @see {@link md5.base64}\n   * @example\n   * hash.base64();\n   */\n  Md5.prototype.base64 = function () {\n    var v1, v2, v3, base64Str = '', bytes = this.array();\n    for (var i = 0; i < 15;) {\n      v1 = bytes[i++];\n      v2 = bytes[i++];\n      v3 = bytes[i++];\n      base64Str += BASE64_ENCODE_CHAR[v1 >>> 2] +\n        BASE64_ENCODE_CHAR[(v1 << 4 | v2 >>> 4) & 63] +\n        BASE64_ENCODE_CHAR[(v2 << 2 | v3 >>> 6) & 63] +\n        BASE64_ENCODE_CHAR[v3 & 63];\n    }\n    v1 = bytes[i];\n    base64Str += BASE64_ENCODE_CHAR[v1 >>> 2] +\n      BASE64_ENCODE_CHAR[(v1 << 4) & 63] +\n      '==';\n    return base64Str;\n  };\n\n  var exports = createMethod();\n\n  if (COMMON_JS) {\n    module.exports = exports;\n  } else {\n    /**\n     * @method md5\b\n     * @description Md5 hash function, export to global in browsers.\n     * @param {String|Array|Uint8Array|ArrayBuffer} message message to hash\n     * @returns {String} md5 hashes\n     * @example\n     * md5(''); // d41d8cd98f00b204e9800998ecf8427e\n     * md5('The quick brown fox jumps over the lazy dog'); // 9e107d9d372bb6826bd81d3542a419d6\n     * md5('The quick brown fox jumps over the lazy dog.'); // e4d909c290d0fb1ca068ffaddf22cbd0\n     *\n     * // It also supports UTF-8 encoding\n     * md5(''); // a7bac2239fcdcb3a067903d8077c4a07\n     *\n     * // It also supports byte `Array`, `Uint8Array`, `ArrayBuffer`\n     * md5([]); // d41d8cd98f00b204e9800998ecf8427e\n     * md5(new Uint8Array([])); // d41d8cd98f00b204e9800998ecf8427e\n     */\n    root.md5 = exports;\n    if (AMD) {\n      define(function () {\n        return exports;\n      });\n    }\n  }\n})();\n","var grammar = module.exports = {\n  v: [{\n    name: 'version',\n    reg: /^(\\d*)$/\n  }],\n  o: [{ //o=- 20518 0 IN IP4 203.0.113.1\n    // NB: sessionId will be a String in most cases because it is huge\n    name: 'origin',\n    reg: /^(\\S*) (\\d*) (\\d*) (\\S*) IP(\\d) (\\S*)/,\n    names: ['username', 'sessionId', 'sessionVersion', 'netType', 'ipVer', 'address'],\n    format: '%s %s %d %s IP%d %s'\n  }],\n  // default parsing of these only (though some of these feel outdated)\n  s: [{ name: 'name' }],\n  i: [{ name: 'description' }],\n  u: [{ name: 'uri' }],\n  e: [{ name: 'email' }],\n  p: [{ name: 'phone' }],\n  z: [{ name: 'timezones' }], // TODO: this one can actually be parsed properly..\n  r: [{ name: 'repeats' }],   // TODO: this one can also be parsed properly\n  //k: [{}], // outdated thing ignored\n  t: [{ //t=0 0\n    name: 'timing',\n    reg: /^(\\d*) (\\d*)/,\n    names: ['start', 'stop'],\n    format: '%d %d'\n  }],\n  c: [{ //c=IN IP4 10.47.197.26\n    name: 'connection',\n    reg: /^IN IP(\\d) (\\S*)/,\n    names: ['version', 'ip'],\n    format: 'IN IP%d %s'\n  }],\n  b: [{ //b=AS:4000\n    push: 'bandwidth',\n    reg: /^(TIAS|AS|CT|RR|RS):(\\d*)/,\n    names: ['type', 'limit'],\n    format: '%s:%s'\n  }],\n  m: [{ //m=video 51744 RTP/AVP 126 97 98 34 31\n    // NB: special - pushes to session\n    // TODO: rtp/fmtp should be filtered by the payloads found here?\n    reg: /^(\\w*) (\\d*) ([\\w\\/]*)(?: (.*))?/,\n    names: ['type', 'port', 'protocol', 'payloads'],\n    format: '%s %d %s %s'\n  }],\n  a: [\n    { //a=rtpmap:110 opus/48000/2\n      push: 'rtp',\n      reg: /^rtpmap:(\\d*) ([\\w\\-\\.]*)(?:\\s*\\/(\\d*)(?:\\s*\\/(\\S*))?)?/,\n      names: ['payload', 'codec', 'rate', 'encoding'],\n      format: function (o) {\n        return (o.encoding) ?\n          'rtpmap:%d %s/%s/%s':\n          o.rate ?\n          'rtpmap:%d %s/%s':\n          'rtpmap:%d %s';\n      }\n    },\n    { //a=fmtp:108 profile-level-id=24;object=23;bitrate=64000\n      //a=fmtp:111 minptime=10; useinbandfec=1\n      push: 'fmtp',\n      reg: /^fmtp:(\\d*) ([\\S| ]*)/,\n      names: ['payload', 'config'],\n      format: 'fmtp:%d %s'\n    },\n    { //a=control:streamid=0\n      name: 'control',\n      reg: /^control:(.*)/,\n      format: 'control:%s'\n    },\n    { //a=rtcp:65179 IN IP4 193.84.77.194\n      name: 'rtcp',\n      reg: /^rtcp:(\\d*)(?: (\\S*) IP(\\d) (\\S*))?/,\n      names: ['port', 'netType', 'ipVer', 'address'],\n      format: function (o) {\n        return (o.address != null) ?\n          'rtcp:%d %s IP%d %s':\n          'rtcp:%d';\n      }\n    },\n    { //a=rtcp-fb:98 trr-int 100\n      push: 'rtcpFbTrrInt',\n      reg: /^rtcp-fb:(\\*|\\d*) trr-int (\\d*)/,\n      names: ['payload', 'value'],\n      format: 'rtcp-fb:%d trr-int %d'\n    },\n    { //a=rtcp-fb:98 nack rpsi\n      push: 'rtcpFb',\n      reg: /^rtcp-fb:(\\*|\\d*) ([\\w-_]*)(?: ([\\w-_]*))?/,\n      names: ['payload', 'type', 'subtype'],\n      format: function (o) {\n        return (o.subtype != null) ?\n          'rtcp-fb:%s %s %s':\n          'rtcp-fb:%s %s';\n      }\n    },\n    { //a=extmap:2 urn:ietf:params:rtp-hdrext:toffset\n      //a=extmap:1/recvonly URI-gps-string\n      push: 'ext',\n      reg: /^extmap:(\\d+)(?:\\/(\\w+))? (\\S*)(?: (\\S*))?/,\n      names: ['value', 'direction', 'uri', 'config'],\n      format: function (o) {\n        return 'extmap:%d' + (o.direction ? '/%s' : '%v') + ' %s' + (o.config ? ' %s' : '');\n      }\n    },\n    { //a=crypto:1 AES_CM_128_HMAC_SHA1_80 inline:PS1uQCVeeCFCanVmcjkpPywjNWhcYD0mXXtxaVBR|2^20|1:32\n      push: 'crypto',\n      reg: /^crypto:(\\d*) ([\\w_]*) (\\S*)(?: (\\S*))?/,\n      names: ['id', 'suite', 'config', 'sessionConfig'],\n      format: function (o) {\n        return (o.sessionConfig != null) ?\n          'crypto:%d %s %s %s':\n          'crypto:%d %s %s';\n      }\n    },\n    { //a=setup:actpass\n      name: 'setup',\n      reg: /^setup:(\\w*)/,\n      format: 'setup:%s'\n    },\n    { //a=mid:1\n      name: 'mid',\n      reg: /^mid:([^\\s]*)/,\n      format: 'mid:%s'\n    },\n    { //a=msid:0c8b064d-d807-43b4-b434-f92a889d8587 98178685-d409-46e0-8e16-7ef0db0db64a\n      name: 'msid',\n      reg: /^msid:(.*)/,\n      format: 'msid:%s'\n    },\n    { //a=ptime:20\n      name: 'ptime',\n      reg: /^ptime:(\\d*)/,\n      format: 'ptime:%d'\n    },\n    { //a=maxptime:60\n      name: 'maxptime',\n      reg: /^maxptime:(\\d*)/,\n      format: 'maxptime:%d'\n    },\n    { //a=sendrecv\n      name: 'direction',\n      reg: /^(sendrecv|recvonly|sendonly|inactive)/\n    },\n    { //a=ice-lite\n      name: 'icelite',\n      reg: /^(ice-lite)/\n    },\n    { //a=ice-ufrag:F7gI\n      name: 'iceUfrag',\n      reg: /^ice-ufrag:(\\S*)/,\n      format: 'ice-ufrag:%s'\n    },\n    { //a=ice-pwd:x9cml/YzichV2+XlhiMu8g\n      name: 'icePwd',\n      reg: /^ice-pwd:(\\S*)/,\n      format: 'ice-pwd:%s'\n    },\n    { //a=fingerprint:SHA-1 00:11:22:33:44:55:66:77:88:99:AA:BB:CC:DD:EE:FF:00:11:22:33\n      name: 'fingerprint',\n      reg: /^fingerprint:(\\S*) (\\S*)/,\n      names: ['type', 'hash'],\n      format: 'fingerprint:%s %s'\n    },\n    { //a=candidate:0 1 UDP 2113667327 203.0.113.1 54400 typ host\n      //a=candidate:1162875081 1 udp 2113937151 192.168.34.75 60017 typ host generation 0 network-id 3 network-cost 10\n      //a=candidate:3289912957 2 udp 1845501695 193.84.77.194 60017 typ srflx raddr 192.168.34.75 rport 60017 generation 0 network-id 3 network-cost 10\n      //a=candidate:229815620 1 tcp 1518280447 192.168.150.19 60017 typ host tcptype active generation 0 network-id 3 network-cost 10\n      //a=candidate:3289912957 2 tcp 1845501695 193.84.77.194 60017 typ srflx raddr 192.168.34.75 rport 60017 tcptype passive generation 0 network-id 3 network-cost 10\n      push:'candidates',\n      reg: /^candidate:(\\S*) (\\d*) (\\S*) (\\d*) (\\S*) (\\d*) typ (\\S*)(?: raddr (\\S*) rport (\\d*))?(?: tcptype (\\S*))?(?: generation (\\d*))?(?: network-id (\\d*))?(?: network-cost (\\d*))?/,\n      names: ['foundation', 'component', 'transport', 'priority', 'ip', 'port', 'type', 'raddr', 'rport', 'tcptype', 'generation', 'network-id', 'network-cost'],\n      format: function (o) {\n        var str = 'candidate:%s %d %s %d %s %d typ %s';\n\n        str += (o.raddr != null) ? ' raddr %s rport %d' : '%v%v';\n\n        // NB: candidate has three optional chunks, so %void middles one if it's missing\n        str += (o.tcptype != null) ? ' tcptype %s' : '%v';\n\n        if (o.generation != null) {\n          str += ' generation %d';\n        }\n\n        str += (o['network-id'] != null) ? ' network-id %d' : '%v';\n        str += (o['network-cost'] != null) ? ' network-cost %d' : '%v';\n        return str;\n      }\n    },\n    { //a=end-of-candidates (keep after the candidates line for readability)\n      name: 'endOfCandidates',\n      reg: /^(end-of-candidates)/\n    },\n    { //a=remote-candidates:1 203.0.113.1 54400 2 203.0.113.1 54401 ...\n      name: 'remoteCandidates',\n      reg: /^remote-candidates:(.*)/,\n      format: 'remote-candidates:%s'\n    },\n    { //a=ice-options:google-ice\n      name: 'iceOptions',\n      reg: /^ice-options:(\\S*)/,\n      format: 'ice-options:%s'\n    },\n    { //a=ssrc:2566107569 cname:t9YU8M1UxTF8Y1A1\n      push: 'ssrcs',\n      reg: /^ssrc:(\\d*) ([\\w_]*)(?::(.*))?/,\n      names: ['id', 'attribute', 'value'],\n      format: function (o) {\n        var str = 'ssrc:%d';\n        if (o.attribute != null) {\n          str += ' %s';\n          if (o.value != null) {\n            str += ':%s';\n          }\n        }\n        return str;\n      }\n    },\n    { //a=ssrc-group:FEC 1 2\n      //a=ssrc-group:FEC-FR 3004364195 1080772241\n      push: 'ssrcGroups',\n      // token-char = %x21 / %x23-27 / %x2A-2B / %x2D-2E / %x30-39 / %x41-5A / %x5E-7E\n      reg: /^ssrc-group:([\\x21\\x23\\x24\\x25\\x26\\x27\\x2A\\x2B\\x2D\\x2E\\w]*) (.*)/,\n      names: ['semantics', 'ssrcs'],\n      format: 'ssrc-group:%s %s'\n    },\n    { //a=msid-semantic: WMS Jvlam5X3SX1OP6pn20zWogvaKJz5Hjf9OnlV\n      name: 'msidSemantic',\n      reg: /^msid-semantic:\\s?(\\w*) (\\S*)/,\n      names: ['semantic', 'token'],\n      format: 'msid-semantic: %s %s' // space after ':' is not accidental\n    },\n    { //a=group:BUNDLE audio video\n      push: 'groups',\n      reg: /^group:(\\w*) (.*)/,\n      names: ['type', 'mids'],\n      format: 'group:%s %s'\n    },\n    { //a=rtcp-mux\n      name: 'rtcpMux',\n      reg: /^(rtcp-mux)/\n    },\n    { //a=rtcp-rsize\n      name: 'rtcpRsize',\n      reg: /^(rtcp-rsize)/\n    },\n    { //a=sctpmap:5000 webrtc-datachannel 1024\n      name: 'sctpmap',\n      reg: /^sctpmap:([\\w_\\/]*) (\\S*)(?: (\\S*))?/,\n      names: ['sctpmapNumber', 'app', 'maxMessageSize'],\n      format: function (o) {\n        return (o.maxMessageSize != null) ?\n          'sctpmap:%s %s %s' :\n          'sctpmap:%s %s';\n      }\n    },\n    { //a=x-google-flag:conference\n      name: 'xGoogleFlag',\n      reg: /^x-google-flag:([^\\s]*)/,\n      format: 'x-google-flag:%s'\n    },\n    { //a=rid:1 send max-width=1280;max-height=720;max-fps=30;depend=0\n      push: 'rids',\n      reg: /^rid:([\\d\\w]+) (\\w+)(?: ([\\S| ]*))?/,\n      names: ['id', 'direction', 'params'],\n      format: function (o) {\n        return (o.params) ? 'rid:%s %s %s' : 'rid:%s %s';\n      }\n    },\n    { //a=imageattr:97 send [x=800,y=640,sar=1.1,q=0.6] [x=480,y=320] recv [x=330,y=250]\n      //a=imageattr:* send [x=800,y=640] recv *\n      //a=imageattr:100 recv [x=320,y=240]\n      push: 'imageattrs',\n      reg: new RegExp(\n        //a=imageattr:97\n        '^imageattr:(\\\\d+|\\\\*)' +\n        //send [x=800,y=640,sar=1.1,q=0.6] [x=480,y=320]\n        '[\\\\s\\\\t]+(send|recv)[\\\\s\\\\t]+(\\\\*|\\\\[\\\\S+\\\\](?:[\\\\s\\\\t]+\\\\[\\\\S+\\\\])*)' +\n        //recv [x=330,y=250]\n        '(?:[\\\\s\\\\t]+(recv|send)[\\\\s\\\\t]+(\\\\*|\\\\[\\\\S+\\\\](?:[\\\\s\\\\t]+\\\\[\\\\S+\\\\])*))?'\n      ),\n      names: ['pt', 'dir1', 'attrs1', 'dir2', 'attrs2'],\n      format: function (o) {\n        return 'imageattr:%s %s %s' + (o.dir2 ? ' %s %s' : '');\n      }\n    },\n    { //a=simulcast:send 1,2,3;~4,~5 recv 6;~7,~8\n      //a=simulcast:recv 1;4,5 send 6;7\n      name: 'simulcast',\n      reg: new RegExp(\n        //a=simulcast:\n        '^simulcast:' +\n        //send 1,2,3;~4,~5\n        '(send|recv) ([a-zA-Z0-9\\\\-_~;,]+)' +\n        //space + recv 6;~7,~8\n        '(?:\\\\s?(send|recv) ([a-zA-Z0-9\\\\-_~;,]+))?' +\n        //end\n        '$'\n      ),\n      names: ['dir1', 'list1', 'dir2', 'list2'],\n      format: function (o) {\n        return 'simulcast:%s %s' + (o.dir2 ? ' %s %s' : '');\n      }\n    },\n    { //Old simulcast draft 03 (implemented by Firefox)\n      //  https://tools.ietf.org/html/draft-ietf-mmusic-sdp-simulcast-03\n      //a=simulcast: recv pt=97;98 send pt=97\n      //a=simulcast: send rid=5;6;7 paused=6,7\n      name: 'simulcast_03',\n      reg: /^simulcast:[\\s\\t]+([\\S+\\s\\t]+)$/,\n      names: ['value'],\n      format: 'simulcast: %s'\n    },\n    {\n      //a=framerate:25\n      //a=framerate:29.97\n      name: 'framerate',\n      reg: /^framerate:(\\d+(?:$|\\.\\d+))/,\n      format: 'framerate:%s'\n    },\n    { // any a= that we don't understand is kepts verbatim on media.invalid\n      push: 'invalid',\n      names: ['value']\n    }\n  ]\n};\n\n// set sensible defaults to avoid polluting the grammar with boring details\nObject.keys(grammar).forEach(function (key) {\n  var objs = grammar[key];\n  objs.forEach(function (obj) {\n    if (!obj.reg) {\n      obj.reg = /(.*)/;\n    }\n    if (!obj.format) {\n      obj.format = '%s';\n    }\n  });\n});\n","var parser = require('./parser');\nvar writer = require('./writer');\n\nexports.write = writer;\nexports.parse = parser.parse;\nexports.parseFmtpConfig = parser.parseFmtpConfig;\nexports.parseParams = parser.parseParams;\nexports.parsePayloads = parser.parsePayloads;\nexports.parseRemoteCandidates = parser.parseRemoteCandidates;\nexports.parseImageAttributes = parser.parseImageAttributes;\nexports.parseSimulcastStreamList = parser.parseSimulcastStreamList;\n","var toIntIfInt = function (v) {\n  return String(Number(v)) === v ? Number(v) : v;\n};\n\nvar attachProperties = function (match, location, names, rawName) {\n  if (rawName && !names) {\n    location[rawName] = toIntIfInt(match[1]);\n  }\n  else {\n    for (var i = 0; i < names.length; i += 1) {\n      if (match[i+1] != null) {\n        location[names[i]] = toIntIfInt(match[i+1]);\n      }\n    }\n  }\n};\n\nvar parseReg = function (obj, location, content) {\n  var needsBlank = obj.name && obj.names;\n  if (obj.push && !location[obj.push]) {\n    location[obj.push] = [];\n  }\n  else if (needsBlank && !location[obj.name]) {\n    location[obj.name] = {};\n  }\n  var keyLocation = obj.push ?\n    {} :  // blank object that will be pushed\n    needsBlank ? location[obj.name] : location; // otherwise, named location or root\n\n  attachProperties(content.match(obj.reg), keyLocation, obj.names, obj.name);\n\n  if (obj.push) {\n    location[obj.push].push(keyLocation);\n  }\n};\n\nvar grammar = require('./grammar');\nvar validLine = RegExp.prototype.test.bind(/^([a-z])=(.*)/);\n\nexports.parse = function (sdp) {\n  var session = {}\n    , media = []\n    , location = session; // points at where properties go under (one of the above)\n\n  // parse lines we understand\n  sdp.split(/(\\r\\n|\\r|\\n)/).filter(validLine).forEach(function (l) {\n    var type = l[0];\n    var content = l.slice(2);\n    if (type === 'm') {\n      media.push({rtp: [], fmtp: []});\n      location = media[media.length-1]; // point at latest media line\n    }\n\n    for (var j = 0; j < (grammar[type] || []).length; j += 1) {\n      var obj = grammar[type][j];\n      if (obj.reg.test(content)) {\n        return parseReg(obj, location, content);\n      }\n    }\n  });\n\n  session.media = media; // link it up\n  return session;\n};\n\nvar paramReducer = function (acc, expr) {\n  var s = expr.split(/=(.+)/, 2);\n  if (s.length === 2) {\n    acc[s[0]] = toIntIfInt(s[1]);\n  }\n  return acc;\n};\n\nexports.parseParams = function (str) {\n  return str.split(/\\;\\s?/).reduce(paramReducer, {});\n};\n\n// For backward compatibility - alias will be removed in 3.0.0\nexports.parseFmtpConfig = exports.parseParams;\n\nexports.parsePayloads = function (str) {\n  return str.split(' ').map(Number);\n};\n\nexports.parseRemoteCandidates = function (str) {\n  var candidates = [];\n  var parts = str.split(' ').map(toIntIfInt);\n  for (var i = 0; i < parts.length; i += 3) {\n    candidates.push({\n      component: parts[i],\n      ip: parts[i + 1],\n      port: parts[i + 2]\n    });\n  }\n  return candidates;\n};\n\nexports.parseImageAttributes = function (str) {\n  return str.split(' ').map(function (item) {\n    return item.substring(1, item.length-1).split(',').reduce(paramReducer, {});\n  });\n};\n\nexports.parseSimulcastStreamList = function (str) {\n  return str.split(';').map(function (stream) {\n    return stream.split(',').map(function (format) {\n      var scid, paused = false;\n\n      if (format[0] !== '~') {\n        scid = toIntIfInt(format);\n      } else {\n        scid = toIntIfInt(format.substring(1, format.length));\n        paused = true;\n      }\n\n      return {\n        scid: scid,\n        paused: paused\n      };\n    });\n  });\n};\n","var grammar = require('./grammar');\n\n// customized util.format - discards excess arguments and can void middle ones\nvar formatRegExp = /%[sdv%]/g;\nvar format = function (formatStr) {\n  var i = 1;\n  var args = arguments;\n  var len = args.length;\n  return formatStr.replace(formatRegExp, function (x) {\n    if (i >= len) {\n      return x; // missing argument\n    }\n    var arg = args[i];\n    i += 1;\n    switch (x) {\n    case '%%':\n      return '%';\n    case '%s':\n      return String(arg);\n    case '%d':\n      return Number(arg);\n    case '%v':\n      return '';\n    }\n  });\n  // NB: we discard excess arguments - they are typically undefined from makeLine\n};\n\nvar makeLine = function (type, obj, location) {\n  var str = obj.format instanceof Function ?\n    (obj.format(obj.push ? location : location[obj.name])) :\n    obj.format;\n\n  var args = [type + '=' + str];\n  if (obj.names) {\n    for (var i = 0; i < obj.names.length; i += 1) {\n      var n = obj.names[i];\n      if (obj.name) {\n        args.push(location[obj.name][n]);\n      }\n      else { // for mLine and push attributes\n        args.push(location[obj.names[i]]);\n      }\n    }\n  }\n  else {\n    args.push(location[obj.name]);\n  }\n  return format.apply(null, args);\n};\n\n// RFC specified order\n// TODO: extend this with all the rest\nvar defaultOuterOrder = [\n  'v', 'o', 's', 'i',\n  'u', 'e', 'p', 'c',\n  'b', 't', 'r', 'z', 'a'\n];\nvar defaultInnerOrder = ['i', 'c', 'b', 'a'];\n\n\nmodule.exports = function (session, opts) {\n  opts = opts || {};\n  // ensure certain properties exist\n  if (session.version == null) {\n    session.version = 0; // 'v=0' must be there (only defined version atm)\n  }\n  if (session.name == null) {\n    session.name = ' '; // 's= ' must be there if no meaningful name set\n  }\n  session.media.forEach(function (mLine) {\n    if (mLine.payloads == null) {\n      mLine.payloads = '';\n    }\n  });\n\n  var outerOrder = opts.outerOrder || defaultOuterOrder;\n  var innerOrder = opts.innerOrder || defaultInnerOrder;\n  var sdp = [];\n\n  // loop through outerOrder for matching properties on session\n  outerOrder.forEach(function (type) {\n    grammar[type].forEach(function (obj) {\n      if (obj.name in session && session[obj.name] != null) {\n        sdp.push(makeLine(type, obj, session));\n      }\n      else if (obj.push in session && session[obj.push] != null) {\n        session[obj.push].forEach(function (el) {\n          sdp.push(makeLine(type, obj, el));\n        });\n      }\n    });\n  });\n\n  // then for each media line, follow the innerOrder\n  session.media.forEach(function (mLine) {\n    sdp.push(makeLine('m', grammar.m[0], mLine));\n\n    innerOrder.forEach(function (type) {\n      grammar[type].forEach(function (obj) {\n        if (obj.name in mLine && mLine[obj.name] != null) {\n          sdp.push(makeLine(type, obj, mLine));\n        }\n        else if (obj.push in mLine && mLine[obj.push] != null) {\n          mLine[obj.push].forEach(function (el) {\n            sdp.push(makeLine(type, obj, el));\n          });\n        }\n      });\n    });\n  });\n\n  return sdp.join('\\r\\n') + '\\r\\n';\n};\n","/* eslint-env node */\n'use strict';\n\n// SDP helpers.\nconst SDPUtils = {};\n\n// Generate an alphanumeric identifier for cname or mids.\n// TODO: use UUIDs instead? https://gist.github.com/jed/982883\nSDPUtils.generateIdentifier = function() {\n  return Math.random().toString(36).substr(2, 10);\n};\n\n// The RTCP CNAME used by all peerconnections from the same JS.\nSDPUtils.localCName = SDPUtils.generateIdentifier();\n\n// Splits SDP into lines, dealing with both CRLF and LF.\nSDPUtils.splitLines = function(blob) {\n  return blob.trim().split('\\n').map(line => line.trim());\n};\n// Splits SDP into sessionpart and mediasections. Ensures CRLF.\nSDPUtils.splitSections = function(blob) {\n  const parts = blob.split('\\nm=');\n  return parts.map((part, index) => (index > 0 ?\n    'm=' + part : part).trim() + '\\r\\n');\n};\n\n// Returns the session description.\nSDPUtils.getDescription = function(blob) {\n  const sections = SDPUtils.splitSections(blob);\n  return sections && sections[0];\n};\n\n// Returns the individual media sections.\nSDPUtils.getMediaSections = function(blob) {\n  const sections = SDPUtils.splitSections(blob);\n  sections.shift();\n  return sections;\n};\n\n// Returns lines that start with a certain prefix.\nSDPUtils.matchPrefix = function(blob, prefix) {\n  return SDPUtils.splitLines(blob).filter(line => line.indexOf(prefix) === 0);\n};\n\n// Parses an ICE candidate line. Sample input:\n// candidate:702786350 2 udp 41819902 8.8.8.8 60769 typ relay raddr 8.8.8.8\n// rport 55996\"\n// Input can be prefixed with a=.\nSDPUtils.parseCandidate = function(line) {\n  let parts;\n  // Parse both variants.\n  if (line.indexOf('a=candidate:') === 0) {\n    parts = line.substring(12).split(' ');\n  } else {\n    parts = line.substring(10).split(' ');\n  }\n\n  const candidate = {\n    foundation: parts[0],\n    component: {1: 'rtp', 2: 'rtcp'}[parts[1]] || parts[1],\n    protocol: parts[2].toLowerCase(),\n    priority: parseInt(parts[3], 10),\n    ip: parts[4],\n    address: parts[4], // address is an alias for ip.\n    port: parseInt(parts[5], 10),\n    // skip parts[6] == 'typ'\n    type: parts[7],\n  };\n\n  for (let i = 8; i < parts.length; i += 2) {\n    switch (parts[i]) {\n      case 'raddr':\n        candidate.relatedAddress = parts[i + 1];\n        break;\n      case 'rport':\n        candidate.relatedPort = parseInt(parts[i + 1], 10);\n        break;\n      case 'tcptype':\n        candidate.tcpType = parts[i + 1];\n        break;\n      case 'ufrag':\n        candidate.ufrag = parts[i + 1]; // for backward compatibility.\n        candidate.usernameFragment = parts[i + 1];\n        break;\n      default: // extension handling, in particular ufrag. Don't overwrite.\n        if (candidate[parts[i]] === undefined) {\n          candidate[parts[i]] = parts[i + 1];\n        }\n        break;\n    }\n  }\n  return candidate;\n};\n\n// Translates a candidate object into SDP candidate attribute.\n// This does not include the a= prefix!\nSDPUtils.writeCandidate = function(candidate) {\n  const sdp = [];\n  sdp.push(candidate.foundation);\n\n  const component = candidate.component;\n  if (component === 'rtp') {\n    sdp.push(1);\n  } else if (component === 'rtcp') {\n    sdp.push(2);\n  } else {\n    sdp.push(component);\n  }\n  sdp.push(candidate.protocol.toUpperCase());\n  sdp.push(candidate.priority);\n  sdp.push(candidate.address || candidate.ip);\n  sdp.push(candidate.port);\n\n  const type = candidate.type;\n  sdp.push('typ');\n  sdp.push(type);\n  if (type !== 'host' && candidate.relatedAddress &&\n      candidate.relatedPort) {\n    sdp.push('raddr');\n    sdp.push(candidate.relatedAddress);\n    sdp.push('rport');\n    sdp.push(candidate.relatedPort);\n  }\n  if (candidate.tcpType && candidate.protocol.toLowerCase() === 'tcp') {\n    sdp.push('tcptype');\n    sdp.push(candidate.tcpType);\n  }\n  if (candidate.usernameFragment || candidate.ufrag) {\n    sdp.push('ufrag');\n    sdp.push(candidate.usernameFragment || candidate.ufrag);\n  }\n  return 'candidate:' + sdp.join(' ');\n};\n\n// Parses an ice-options line, returns an array of option tags.\n// Sample input:\n// a=ice-options:foo bar\nSDPUtils.parseIceOptions = function(line) {\n  return line.substr(14).split(' ');\n};\n\n// Parses a rtpmap line, returns RTCRtpCoddecParameters. Sample input:\n// a=rtpmap:111 opus/48000/2\nSDPUtils.parseRtpMap = function(line) {\n  let parts = line.substr(9).split(' ');\n  const parsed = {\n    payloadType: parseInt(parts.shift(), 10), // was: id\n  };\n\n  parts = parts[0].split('/');\n\n  parsed.name = parts[0];\n  parsed.clockRate = parseInt(parts[1], 10); // was: clockrate\n  parsed.channels = parts.length === 3 ? parseInt(parts[2], 10) : 1;\n  // legacy alias, got renamed back to channels in ORTC.\n  parsed.numChannels = parsed.channels;\n  return parsed;\n};\n\n// Generates a rtpmap line from RTCRtpCodecCapability or\n// RTCRtpCodecParameters.\nSDPUtils.writeRtpMap = function(codec) {\n  let pt = codec.payloadType;\n  if (codec.preferredPayloadType !== undefined) {\n    pt = codec.preferredPayloadType;\n  }\n  const channels = codec.channels || codec.numChannels || 1;\n  return 'a=rtpmap:' + pt + ' ' + codec.name + '/' + codec.clockRate +\n      (channels !== 1 ? '/' + channels : '') + '\\r\\n';\n};\n\n// Parses a extmap line (headerextension from RFC 5285). Sample input:\n// a=extmap:2 urn:ietf:params:rtp-hdrext:toffset\n// a=extmap:2/sendonly urn:ietf:params:rtp-hdrext:toffset\nSDPUtils.parseExtmap = function(line) {\n  const parts = line.substr(9).split(' ');\n  return {\n    id: parseInt(parts[0], 10),\n    direction: parts[0].indexOf('/') > 0 ? parts[0].split('/')[1] : 'sendrecv',\n    uri: parts[1],\n  };\n};\n\n// Generates an extmap line from RTCRtpHeaderExtensionParameters or\n// RTCRtpHeaderExtension.\nSDPUtils.writeExtmap = function(headerExtension) {\n  return 'a=extmap:' + (headerExtension.id || headerExtension.preferredId) +\n      (headerExtension.direction && headerExtension.direction !== 'sendrecv'\n        ? '/' + headerExtension.direction\n        : '') +\n      ' ' + headerExtension.uri + '\\r\\n';\n};\n\n// Parses a fmtp line, returns dictionary. Sample input:\n// a=fmtp:96 vbr=on;cng=on\n// Also deals with vbr=on; cng=on\nSDPUtils.parseFmtp = function(line) {\n  const parsed = {};\n  let kv;\n  const parts = line.substr(line.indexOf(' ') + 1).split(';');\n  for (let j = 0; j < parts.length; j++) {\n    kv = parts[j].trim().split('=');\n    parsed[kv[0].trim()] = kv[1];\n  }\n  return parsed;\n};\n\n// Generates a fmtp line from RTCRtpCodecCapability or RTCRtpCodecParameters.\nSDPUtils.writeFmtp = function(codec) {\n  let line = '';\n  let pt = codec.payloadType;\n  if (codec.preferredPayloadType !== undefined) {\n    pt = codec.preferredPayloadType;\n  }\n  if (codec.parameters && Object.keys(codec.parameters).length) {\n    const params = [];\n    Object.keys(codec.parameters).forEach(param => {\n      if (codec.parameters[param] !== undefined) {\n        params.push(param + '=' + codec.parameters[param]);\n      } else {\n        params.push(param);\n      }\n    });\n    line += 'a=fmtp:' + pt + ' ' + params.join(';') + '\\r\\n';\n  }\n  return line;\n};\n\n// Parses a rtcp-fb line, returns RTCPRtcpFeedback object. Sample input:\n// a=rtcp-fb:98 nack rpsi\nSDPUtils.parseRtcpFb = function(line) {\n  const parts = line.substr(line.indexOf(' ') + 1).split(' ');\n  return {\n    type: parts.shift(),\n    parameter: parts.join(' '),\n  };\n};\n\n// Generate a=rtcp-fb lines from RTCRtpCodecCapability or RTCRtpCodecParameters.\nSDPUtils.writeRtcpFb = function(codec) {\n  let lines = '';\n  let pt = codec.payloadType;\n  if (codec.preferredPayloadType !== undefined) {\n    pt = codec.preferredPayloadType;\n  }\n  if (codec.rtcpFeedback && codec.rtcpFeedback.length) {\n    // FIXME: special handling for trr-int?\n    codec.rtcpFeedback.forEach(fb => {\n      lines += 'a=rtcp-fb:' + pt + ' ' + fb.type +\n      (fb.parameter && fb.parameter.length ? ' ' + fb.parameter : '') +\n          '\\r\\n';\n    });\n  }\n  return lines;\n};\n\n// Parses a RFC 5576 ssrc media attribute. Sample input:\n// a=ssrc:3735928559 cname:something\nSDPUtils.parseSsrcMedia = function(line) {\n  const sp = line.indexOf(' ');\n  const parts = {\n    ssrc: parseInt(line.substr(7, sp - 7), 10),\n  };\n  const colon = line.indexOf(':', sp);\n  if (colon > -1) {\n    parts.attribute = line.substr(sp + 1, colon - sp - 1);\n    parts.value = line.substr(colon + 1);\n  } else {\n    parts.attribute = line.substr(sp + 1);\n  }\n  return parts;\n};\n\n// Parse a ssrc-group line (see RFC 5576). Sample input:\n// a=ssrc-group:semantics 12 34\nSDPUtils.parseSsrcGroup = function(line) {\n  const parts = line.substr(13).split(' ');\n  return {\n    semantics: parts.shift(),\n    ssrcs: parts.map(ssrc => parseInt(ssrc, 10)),\n  };\n};\n\n// Extracts the MID (RFC 5888) from a media section.\n// Returns the MID or undefined if no mid line was found.\nSDPUtils.getMid = function(mediaSection) {\n  const mid = SDPUtils.matchPrefix(mediaSection, 'a=mid:')[0];\n  if (mid) {\n    return mid.substr(6);\n  }\n};\n\n// Parses a fingerprint line for DTLS-SRTP.\nSDPUtils.parseFingerprint = function(line) {\n  const parts = line.substr(14).split(' ');\n  return {\n    algorithm: parts[0].toLowerCase(), // algorithm is case-sensitive in Edge.\n    value: parts[1].toUpperCase(), // the definition is upper-case in RFC 4572.\n  };\n};\n\n// Extracts DTLS parameters from SDP media section or sessionpart.\n// FIXME: for consistency with other functions this should only\n//   get the fingerprint line as input. See also getIceParameters.\nSDPUtils.getDtlsParameters = function(mediaSection, sessionpart) {\n  const lines = SDPUtils.matchPrefix(mediaSection + sessionpart,\n    'a=fingerprint:');\n  // Note: a=setup line is ignored since we use the 'auto' role in Edge.\n  return {\n    role: 'auto',\n    fingerprints: lines.map(SDPUtils.parseFingerprint),\n  };\n};\n\n// Serializes DTLS parameters to SDP.\nSDPUtils.writeDtlsParameters = function(params, setupType) {\n  let sdp = 'a=setup:' + setupType + '\\r\\n';\n  params.fingerprints.forEach(fp => {\n    sdp += 'a=fingerprint:' + fp.algorithm + ' ' + fp.value + '\\r\\n';\n  });\n  return sdp;\n};\n\n// Parses a=crypto lines into\n//   https://rawgit.com/aboba/edgertc/master/msortc-rs4.html#dictionary-rtcsrtpsdesparameters-members\nSDPUtils.parseCryptoLine = function(line) {\n  const parts = line.substr(9).split(' ');\n  return {\n    tag: parseInt(parts[0], 10),\n    cryptoSuite: parts[1],\n    keyParams: parts[2],\n    sessionParams: parts.slice(3),\n  };\n};\n\nSDPUtils.writeCryptoLine = function(parameters) {\n  return 'a=crypto:' + parameters.tag + ' ' +\n    parameters.cryptoSuite + ' ' +\n    (typeof parameters.keyParams === 'object'\n      ? SDPUtils.writeCryptoKeyParams(parameters.keyParams)\n      : parameters.keyParams) +\n    (parameters.sessionParams ? ' ' + parameters.sessionParams.join(' ') : '') +\n    '\\r\\n';\n};\n\n// Parses the crypto key parameters into\n//   https://rawgit.com/aboba/edgertc/master/msortc-rs4.html#rtcsrtpkeyparam*\nSDPUtils.parseCryptoKeyParams = function(keyParams) {\n  if (keyParams.indexOf('inline:') !== 0) {\n    return null;\n  }\n  const parts = keyParams.substr(7).split('|');\n  return {\n    keyMethod: 'inline',\n    keySalt: parts[0],\n    lifeTime: parts[1],\n    mkiValue: parts[2] ? parts[2].split(':')[0] : undefined,\n    mkiLength: parts[2] ? parts[2].split(':')[1] : undefined,\n  };\n};\n\nSDPUtils.writeCryptoKeyParams = function(keyParams) {\n  return keyParams.keyMethod + ':'\n    + keyParams.keySalt +\n    (keyParams.lifeTime ? '|' + keyParams.lifeTime : '') +\n    (keyParams.mkiValue && keyParams.mkiLength\n      ? '|' + keyParams.mkiValue + ':' + keyParams.mkiLength\n      : '');\n};\n\n// Extracts all SDES parameters.\nSDPUtils.getCryptoParameters = function(mediaSection, sessionpart) {\n  const lines = SDPUtils.matchPrefix(mediaSection + sessionpart,\n    'a=crypto:');\n  return lines.map(SDPUtils.parseCryptoLine);\n};\n\n// Parses ICE information from SDP media section or sessionpart.\n// FIXME: for consistency with other functions this should only\n//   get the ice-ufrag and ice-pwd lines as input.\nSDPUtils.getIceParameters = function(mediaSection, sessionpart) {\n  const ufrag = SDPUtils.matchPrefix(mediaSection + sessionpart,\n    'a=ice-ufrag:')[0];\n  const pwd = SDPUtils.matchPrefix(mediaSection + sessionpart,\n    'a=ice-pwd:')[0];\n  if (!(ufrag && pwd)) {\n    return null;\n  }\n  return {\n    usernameFragment: ufrag.substr(12),\n    password: pwd.substr(10),\n  };\n};\n\n// Serializes ICE parameters to SDP.\nSDPUtils.writeIceParameters = function(params) {\n  let sdp = 'a=ice-ufrag:' + params.usernameFragment + '\\r\\n' +\n      'a=ice-pwd:' + params.password + '\\r\\n';\n  if (params.iceLite) {\n    sdp += 'a=ice-lite\\r\\n';\n  }\n  return sdp;\n};\n\n// Parses the SDP media section and returns RTCRtpParameters.\nSDPUtils.parseRtpParameters = function(mediaSection) {\n  const description = {\n    codecs: [],\n    headerExtensions: [],\n    fecMechanisms: [],\n    rtcp: [],\n  };\n  const lines = SDPUtils.splitLines(mediaSection);\n  const mline = lines[0].split(' ');\n  for (let i = 3; i < mline.length; i++) { // find all codecs from mline[3..]\n    const pt = mline[i];\n    const rtpmapline = SDPUtils.matchPrefix(\n      mediaSection, 'a=rtpmap:' + pt + ' ')[0];\n    if (rtpmapline) {\n      const codec = SDPUtils.parseRtpMap(rtpmapline);\n      const fmtps = SDPUtils.matchPrefix(\n        mediaSection, 'a=fmtp:' + pt + ' ');\n      // Only the first a=fmtp:<pt> is considered.\n      codec.parameters = fmtps.length ? SDPUtils.parseFmtp(fmtps[0]) : {};\n      codec.rtcpFeedback = SDPUtils.matchPrefix(\n        mediaSection, 'a=rtcp-fb:' + pt + ' ')\n        .map(SDPUtils.parseRtcpFb);\n      description.codecs.push(codec);\n      // parse FEC mechanisms from rtpmap lines.\n      switch (codec.name.toUpperCase()) {\n        case 'RED':\n        case 'ULPFEC':\n          description.fecMechanisms.push(codec.name.toUpperCase());\n          break;\n        default: // only RED and ULPFEC are recognized as FEC mechanisms.\n          break;\n      }\n    }\n  }\n  SDPUtils.matchPrefix(mediaSection, 'a=extmap:').forEach(line => {\n    description.headerExtensions.push(SDPUtils.parseExtmap(line));\n  });\n  // FIXME: parse rtcp.\n  return description;\n};\n\n// Generates parts of the SDP media section describing the capabilities /\n// parameters.\nSDPUtils.writeRtpDescription = function(kind, caps) {\n  let sdp = '';\n\n  // Build the mline.\n  sdp += 'm=' + kind + ' ';\n  sdp += caps.codecs.length > 0 ? '9' : '0'; // reject if no codecs.\n  sdp += ' UDP/TLS/RTP/SAVPF ';\n  sdp += caps.codecs.map(codec => {\n    if (codec.preferredPayloadType !== undefined) {\n      return codec.preferredPayloadType;\n    }\n    return codec.payloadType;\n  }).join(' ') + '\\r\\n';\n\n  sdp += 'c=IN IP4 0.0.0.0\\r\\n';\n  sdp += 'a=rtcp:9 IN IP4 0.0.0.0\\r\\n';\n\n  // Add a=rtpmap lines for each codec. Also fmtp and rtcp-fb.\n  caps.codecs.forEach(codec => {\n    sdp += SDPUtils.writeRtpMap(codec);\n    sdp += SDPUtils.writeFmtp(codec);\n    sdp += SDPUtils.writeRtcpFb(codec);\n  });\n  let maxptime = 0;\n  caps.codecs.forEach(codec => {\n    if (codec.maxptime > maxptime) {\n      maxptime = codec.maxptime;\n    }\n  });\n  if (maxptime > 0) {\n    sdp += 'a=maxptime:' + maxptime + '\\r\\n';\n  }\n\n  if (caps.headerExtensions) {\n    caps.headerExtensions.forEach(extension => {\n      sdp += SDPUtils.writeExtmap(extension);\n    });\n  }\n  // FIXME: write fecMechanisms.\n  return sdp;\n};\n\n// Parses the SDP media section and returns an array of\n// RTCRtpEncodingParameters.\nSDPUtils.parseRtpEncodingParameters = function(mediaSection) {\n  const encodingParameters = [];\n  const description = SDPUtils.parseRtpParameters(mediaSection);\n  const hasRed = description.fecMechanisms.indexOf('RED') !== -1;\n  const hasUlpfec = description.fecMechanisms.indexOf('ULPFEC') !== -1;\n\n  // filter a=ssrc:... cname:, ignore PlanB-msid\n  const ssrcs = SDPUtils.matchPrefix(mediaSection, 'a=ssrc:')\n    .map(line => SDPUtils.parseSsrcMedia(line))\n    .filter(parts => parts.attribute === 'cname');\n  const primarySsrc = ssrcs.length > 0 && ssrcs[0].ssrc;\n  let secondarySsrc;\n\n  const flows = SDPUtils.matchPrefix(mediaSection, 'a=ssrc-group:FID')\n    .map(line => {\n      const parts = line.substr(17).split(' ');\n      return parts.map(part => parseInt(part, 10));\n    });\n  if (flows.length > 0 && flows[0].length > 1 && flows[0][0] === primarySsrc) {\n    secondarySsrc = flows[0][1];\n  }\n\n  description.codecs.forEach(codec => {\n    if (codec.name.toUpperCase() === 'RTX' && codec.parameters.apt) {\n      let encParam = {\n        ssrc: primarySsrc,\n        codecPayloadType: parseInt(codec.parameters.apt, 10),\n      };\n      if (primarySsrc && secondarySsrc) {\n        encParam.rtx = {ssrc: secondarySsrc};\n      }\n      encodingParameters.push(encParam);\n      if (hasRed) {\n        encParam = JSON.parse(JSON.stringify(encParam));\n        encParam.fec = {\n          ssrc: primarySsrc,\n          mechanism: hasUlpfec ? 'red+ulpfec' : 'red',\n        };\n        encodingParameters.push(encParam);\n      }\n    }\n  });\n  if (encodingParameters.length === 0 && primarySsrc) {\n    encodingParameters.push({\n      ssrc: primarySsrc,\n    });\n  }\n\n  // we support both b=AS and b=TIAS but interpret AS as TIAS.\n  let bandwidth = SDPUtils.matchPrefix(mediaSection, 'b=');\n  if (bandwidth.length) {\n    if (bandwidth[0].indexOf('b=TIAS:') === 0) {\n      bandwidth = parseInt(bandwidth[0].substr(7), 10);\n    } else if (bandwidth[0].indexOf('b=AS:') === 0) {\n      // use formula from JSEP to convert b=AS to TIAS value.\n      bandwidth = parseInt(bandwidth[0].substr(5), 10) * 1000 * 0.95\n          - (50 * 40 * 8);\n    } else {\n      bandwidth = undefined;\n    }\n    encodingParameters.forEach(params => {\n      params.maxBitrate = bandwidth;\n    });\n  }\n  return encodingParameters;\n};\n\n// parses http://draft.ortc.org/#rtcrtcpparameters*\nSDPUtils.parseRtcpParameters = function(mediaSection) {\n  const rtcpParameters = {};\n\n  // Gets the first SSRC. Note that with RTX there might be multiple\n  // SSRCs.\n  const remoteSsrc = SDPUtils.matchPrefix(mediaSection, 'a=ssrc:')\n    .map(line => SDPUtils.parseSsrcMedia(line))\n    .filter(obj => obj.attribute === 'cname')[0];\n  if (remoteSsrc) {\n    rtcpParameters.cname = remoteSsrc.value;\n    rtcpParameters.ssrc = remoteSsrc.ssrc;\n  }\n\n  // Edge uses the compound attribute instead of reducedSize\n  // compound is !reducedSize\n  const rsize = SDPUtils.matchPrefix(mediaSection, 'a=rtcp-rsize');\n  rtcpParameters.reducedSize = rsize.length > 0;\n  rtcpParameters.compound = rsize.length === 0;\n\n  // parses the rtcp-mux attrbute.\n  // Note that Edge does not support unmuxed RTCP.\n  const mux = SDPUtils.matchPrefix(mediaSection, 'a=rtcp-mux');\n  rtcpParameters.mux = mux.length > 0;\n\n  return rtcpParameters;\n};\n\nSDPUtils.writeRtcpParameters = function(rtcpParameters) {\n  let sdp = '';\n  if (rtcpParameters.reducedSize) {\n    sdp += 'a=rtcp-rsize\\r\\n';\n  }\n  if (rtcpParameters.mux) {\n    sdp += 'a=rtcp-mux\\r\\n';\n  }\n  if (rtcpParameters.ssrc !== undefined && rtcpParameters.cname) {\n    sdp += 'a=ssrc:' + rtcpParameters.ssrc +\n      ' cname:' + rtcpParameters.cname + '\\r\\n';\n  }\n  return sdp;\n};\n\n\n// parses either a=msid: or a=ssrc:... msid lines and returns\n// the id of the MediaStream and MediaStreamTrack.\nSDPUtils.parseMsid = function(mediaSection) {\n  let parts;\n  const spec = SDPUtils.matchPrefix(mediaSection, 'a=msid:');\n  if (spec.length === 1) {\n    parts = spec[0].substr(7).split(' ');\n    return {stream: parts[0], track: parts[1]};\n  }\n  const planB = SDPUtils.matchPrefix(mediaSection, 'a=ssrc:')\n    .map(line => SDPUtils.parseSsrcMedia(line))\n    .filter(msidParts => msidParts.attribute === 'msid');\n  if (planB.length > 0) {\n    parts = planB[0].value.split(' ');\n    return {stream: parts[0], track: parts[1]};\n  }\n};\n\n// SCTP\n// parses draft-ietf-mmusic-sctp-sdp-26 first and falls back\n// to draft-ietf-mmusic-sctp-sdp-05\nSDPUtils.parseSctpDescription = function(mediaSection) {\n  const mline = SDPUtils.parseMLine(mediaSection);\n  const maxSizeLine = SDPUtils.matchPrefix(mediaSection, 'a=max-message-size:');\n  let maxMessageSize;\n  if (maxSizeLine.length > 0) {\n    maxMessageSize = parseInt(maxSizeLine[0].substr(19), 10);\n  }\n  if (isNaN(maxMessageSize)) {\n    maxMessageSize = 65536;\n  }\n  const sctpPort = SDPUtils.matchPrefix(mediaSection, 'a=sctp-port:');\n  if (sctpPort.length > 0) {\n    return {\n      port: parseInt(sctpPort[0].substr(12), 10),\n      protocol: mline.fmt,\n      maxMessageSize,\n    };\n  }\n  const sctpMapLines = SDPUtils.matchPrefix(mediaSection, 'a=sctpmap:');\n  if (sctpMapLines.length > 0) {\n    const parts = sctpMapLines[0]\n      .substr(10)\n      .split(' ');\n    return {\n      port: parseInt(parts[0], 10),\n      protocol: parts[1],\n      maxMessageSize,\n    };\n  }\n};\n\n// SCTP\n// outputs the draft-ietf-mmusic-sctp-sdp-26 version that all browsers\n// support by now receiving in this format, unless we originally parsed\n// as the draft-ietf-mmusic-sctp-sdp-05 format (indicated by the m-line\n// protocol of DTLS/SCTP -- without UDP/ or TCP/)\nSDPUtils.writeSctpDescription = function(media, sctp) {\n  let output = [];\n  if (media.protocol !== 'DTLS/SCTP') {\n    output = [\n      'm=' + media.kind + ' 9 ' + media.protocol + ' ' + sctp.protocol + '\\r\\n',\n      'c=IN IP4 0.0.0.0\\r\\n',\n      'a=sctp-port:' + sctp.port + '\\r\\n',\n    ];\n  } else {\n    output = [\n      'm=' + media.kind + ' 9 ' + media.protocol + ' ' + sctp.port + '\\r\\n',\n      'c=IN IP4 0.0.0.0\\r\\n',\n      'a=sctpmap:' + sctp.port + ' ' + sctp.protocol + ' 65535\\r\\n',\n    ];\n  }\n  if (sctp.maxMessageSize !== undefined) {\n    output.push('a=max-message-size:' + sctp.maxMessageSize + '\\r\\n');\n  }\n  return output.join('');\n};\n\n// Generate a session ID for SDP.\n// https://tools.ietf.org/html/draft-ietf-rtcweb-jsep-20#section-5.2.1\n// recommends using a cryptographically random +ve 64-bit value\n// but right now this should be acceptable and within the right range\nSDPUtils.generateSessionId = function() {\n  return Math.random().toString().substr(2, 21);\n};\n\n// Write boiler plate for start of SDP\n// sessId argument is optional - if not supplied it will\n// be generated randomly\n// sessVersion is optional and defaults to 2\n// sessUser is optional and defaults to 'thisisadapterortc'\nSDPUtils.writeSessionBoilerplate = function(sessId, sessVer, sessUser) {\n  let sessionId;\n  const version = sessVer !== undefined ? sessVer : 2;\n  if (sessId) {\n    sessionId = sessId;\n  } else {\n    sessionId = SDPUtils.generateSessionId();\n  }\n  const user = sessUser || 'thisisadapterortc';\n  // FIXME: sess-id should be an NTP timestamp.\n  return 'v=0\\r\\n' +\n      'o=' + user + ' ' + sessionId + ' ' + version +\n        ' IN IP4 127.0.0.1\\r\\n' +\n      's=-\\r\\n' +\n      't=0 0\\r\\n';\n};\n\n// Gets the direction from the mediaSection or the sessionpart.\nSDPUtils.getDirection = function(mediaSection, sessionpart) {\n  // Look for sendrecv, sendonly, recvonly, inactive, default to sendrecv.\n  const lines = SDPUtils.splitLines(mediaSection);\n  for (let i = 0; i < lines.length; i++) {\n    switch (lines[i]) {\n      case 'a=sendrecv':\n      case 'a=sendonly':\n      case 'a=recvonly':\n      case 'a=inactive':\n        return lines[i].substr(2);\n      default:\n        // FIXME: What should happen here?\n    }\n  }\n  if (sessionpart) {\n    return SDPUtils.getDirection(sessionpart);\n  }\n  return 'sendrecv';\n};\n\nSDPUtils.getKind = function(mediaSection) {\n  const lines = SDPUtils.splitLines(mediaSection);\n  const mline = lines[0].split(' ');\n  return mline[0].substr(2);\n};\n\nSDPUtils.isRejected = function(mediaSection) {\n  return mediaSection.split(' ', 2)[1] === '0';\n};\n\nSDPUtils.parseMLine = function(mediaSection) {\n  const lines = SDPUtils.splitLines(mediaSection);\n  const parts = lines[0].substr(2).split(' ');\n  return {\n    kind: parts[0],\n    port: parseInt(parts[1], 10),\n    protocol: parts[2],\n    fmt: parts.slice(3).join(' '),\n  };\n};\n\nSDPUtils.parseOLine = function(mediaSection) {\n  const line = SDPUtils.matchPrefix(mediaSection, 'o=')[0];\n  const parts = line.substr(2).split(' ');\n  return {\n    username: parts[0],\n    sessionId: parts[1],\n    sessionVersion: parseInt(parts[2], 10),\n    netType: parts[3],\n    addressType: parts[4],\n    address: parts[5],\n  };\n};\n\n// a very naive interpretation of a valid SDP.\nSDPUtils.isValidSDP = function(blob) {\n  if (typeof blob !== 'string' || blob.length === 0) {\n    return false;\n  }\n  const lines = SDPUtils.splitLines(blob);\n  for (let i = 0; i < lines.length; i++) {\n    if (lines[i].length < 2 || lines[i].charAt(1) !== '=') {\n      return false;\n    }\n    // TODO: check the modifier a bit more.\n  }\n  return true;\n};\n\n// Expose public methods.\nif (typeof module === 'object') {\n  module.exports = SDPUtils;\n}\n","(function (global, factory) {\n            typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports) :\n            typeof define === 'function' && define.amd ? define(['exports'], factory) :\n            (global = typeof globalThis !== 'undefined' ? globalThis : global || self, factory(global.strophe = {}));\n})(this, (function (exports) { 'use strict';\n\n            var global$1 = typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : typeof window !== \"undefined\" ? window : {};\n\n            /*\n             * This module provides uniform\n             * Shims APIs and globals that are not present in all JS environments,\n             * the most common example for Strophe being browser APIs like WebSocket\n             * and DOM that don't exist under nodejs.\n             *\n             * Usually these will be supplied in nodejs by conditionally requiring a\n             * NPM module that provides a compatible implementation.\n             */\n\n            /* global global */\n\n            /**\n             * WHATWG WebSockets API\n             * https://www.w3.org/TR/websockets/\n             *\n             * Interface to use the web socket protocol\n             *\n             * Used implementations:\n             * - supported browsers: built-in in WebSocket global\n             *   https://developer.mozilla.org/en-US/docs/Web/API/WebSocket#Browser_compatibility\n             * - nodejs: use standard-compliant 'ws' module\n             *   https://www.npmjs.com/package/ws\n             */\n            function getWebSocketImplementation() {\n              let WebSocketImplementation = global$1.WebSocket;\n\n              if (typeof WebSocketImplementation === 'undefined') {\n                throw new Error('WebSocket global not found!');\n              }\n\n              return WebSocketImplementation;\n            }\n\n            const WebSocket = getWebSocketImplementation();\n            /**\n             * DOMParser\n             * https://w3c.github.io/DOM-Parsing/#the-domparser-interface\n             *\n             * Interface to parse XML strings into Document objects\n             *\n             * Used implementations:\n             * - supported browsers: built-in in DOMParser global\n             *   https://developer.mozilla.org/en-US/docs/Web/API/DOMParser#Browser_compatibility\n             * - nodejs: use '@xmldom/xmldom' module\n             *   https://www.npmjs.com/package/@xmldom/xmldom\n             */\n\n            function getDOMParserImplementation() {\n              let DOMParserImplementation = global$1.DOMParser;\n\n              if (typeof DOMParserImplementation === 'undefined') {\n                throw new Error('DOMParser global not found!');\n              }\n\n              return DOMParserImplementation;\n            }\n\n            const DOMParser = getDOMParserImplementation();\n            /**\n             *  Gets IE xml doc object. Used by getDummyXMLDocument shim.\n             *\n             *  Returns:\n             *    A Microsoft XML DOM Object\n             *  See Also:\n             *    http://msdn.microsoft.com/en-us/library/ms757837%28VS.85%29.aspx\n             */\n\n            function _getIEXmlDom() {\n              const docStrings = [\"Msxml2.DOMDocument.6.0\", \"Msxml2.DOMDocument.5.0\", \"Msxml2.DOMDocument.4.0\", \"MSXML2.DOMDocument.3.0\", \"MSXML2.DOMDocument\", \"MSXML.DOMDocument\", \"Microsoft.XMLDOM\"];\n\n              for (let d = 0; d < docStrings.length; d++) {\n                try {\n                  // eslint-disable-next-line no-undef\n                  const doc = new ActiveXObject(docStrings[d]);\n                  return doc;\n                } catch (e) {// Try next one\n                }\n              }\n            }\n            /**\n             * Creates a dummy XML DOM document to serve as an element and text node generator.\n             *\n             * Used implementations:\n             *  - IE < 10: avoid using createDocument() due to a memory leak, use ie-specific\n             *    workaround\n             *  - other supported browsers: use document's createDocument\n             *  - nodejs: use '@xmldom/xmldom'\n             */\n\n\n            function getDummyXMLDOMDocument() {\n              // nodejs\n              if (typeof document === 'undefined') {\n                try {\n                  const DOMImplementation = getDOMParserImplementation();\n                  return new DOMImplementation().createDocument('jabber:client', 'strophe', null);\n                } catch (err) {\n                  throw new Error('You must install the \"@xmldom/xmldom\" package to use Strophe in nodejs.');\n                }\n              } // IE < 10\n\n\n              if (document.implementation.createDocument === undefined || document.implementation.createDocument && document.documentMode && document.documentMode < 10) {\n                const doc = _getIEXmlDom();\n\n                doc.appendChild(doc.createElement('strophe'));\n                return doc;\n              } // All other supported browsers\n\n\n              return document.implementation.createDocument('jabber:client', 'strophe', null);\n            }\n\n            /*\n             * A JavaScript implementation of the RSA Data Security, Inc. MD5 Message\n             * Digest Algorithm, as defined in RFC 1321.\n             * Version 2.1 Copyright (C) Paul Johnston 1999 - 2002.\n             * Other contributors: Greg Holt, Andrew Kepert, Ydnar, Lostinet\n             * Distributed under the BSD License\n             * See http://pajhome.org.uk/crypt/md5 for more info.\n             */\n\n            /*\n             * Everything that isn't used by Strophe has been stripped here!\n             */\n\n            /*\n             * Add integers, wrapping at 2^32. This uses 16-bit operations internally\n             * to work around bugs in some JS interpreters.\n             */\n            const safe_add$1 = function (x, y) {\n              const lsw = (x & 0xFFFF) + (y & 0xFFFF);\n              const msw = (x >> 16) + (y >> 16) + (lsw >> 16);\n              return msw << 16 | lsw & 0xFFFF;\n            };\n            /*\n             * Bitwise rotate a 32-bit number to the left.\n             */\n\n\n            const bit_rol = function (num, cnt) {\n              return num << cnt | num >>> 32 - cnt;\n            };\n            /*\n             * Convert a string to an array of little-endian words\n             */\n\n\n            const str2binl = function (str) {\n              if (typeof str !== \"string\") {\n                throw new Error(\"str2binl was passed a non-string\");\n              }\n\n              const bin = [];\n\n              for (let i = 0; i < str.length * 8; i += 8) {\n                bin[i >> 5] |= (str.charCodeAt(i / 8) & 255) << i % 32;\n              }\n\n              return bin;\n            };\n            /*\n             * Convert an array of little-endian words to a string\n             */\n\n\n            const binl2str = function (bin) {\n              let str = \"\";\n\n              for (let i = 0; i < bin.length * 32; i += 8) {\n                str += String.fromCharCode(bin[i >> 5] >>> i % 32 & 255);\n              }\n\n              return str;\n            };\n            /*\n             * Convert an array of little-endian words to a hex string.\n             */\n\n\n            const binl2hex = function (binarray) {\n              const hex_tab = \"0123456789abcdef\";\n              let str = \"\";\n\n              for (let i = 0; i < binarray.length * 4; i++) {\n                str += hex_tab.charAt(binarray[i >> 2] >> i % 4 * 8 + 4 & 0xF) + hex_tab.charAt(binarray[i >> 2] >> i % 4 * 8 & 0xF);\n              }\n\n              return str;\n            };\n            /*\n             * These functions implement the four basic operations the algorithm uses.\n             */\n\n\n            const md5_cmn = function (q, a, b, x, s, t) {\n              return safe_add$1(bit_rol(safe_add$1(safe_add$1(a, q), safe_add$1(x, t)), s), b);\n            };\n\n            const md5_ff = function (a, b, c, d, x, s, t) {\n              return md5_cmn(b & c | ~b & d, a, b, x, s, t);\n            };\n\n            const md5_gg = function (a, b, c, d, x, s, t) {\n              return md5_cmn(b & d | c & ~d, a, b, x, s, t);\n            };\n\n            const md5_hh = function (a, b, c, d, x, s, t) {\n              return md5_cmn(b ^ c ^ d, a, b, x, s, t);\n            };\n\n            const md5_ii = function (a, b, c, d, x, s, t) {\n              return md5_cmn(c ^ (b | ~d), a, b, x, s, t);\n            };\n            /*\n             * Calculate the MD5 of an array of little-endian words, and a bit length\n             */\n\n\n            const core_md5 = function (x, len) {\n              /* append padding */\n              x[len >> 5] |= 0x80 << len % 32;\n              x[(len + 64 >>> 9 << 4) + 14] = len;\n              let a = 1732584193;\n              let b = -271733879;\n              let c = -1732584194;\n              let d = 271733878;\n              let olda, oldb, oldc, oldd;\n\n              for (let i = 0; i < x.length; i += 16) {\n                olda = a;\n                oldb = b;\n                oldc = c;\n                oldd = d;\n                a = md5_ff(a, b, c, d, x[i + 0], 7, -680876936);\n                d = md5_ff(d, a, b, c, x[i + 1], 12, -389564586);\n                c = md5_ff(c, d, a, b, x[i + 2], 17, 606105819);\n                b = md5_ff(b, c, d, a, x[i + 3], 22, -1044525330);\n                a = md5_ff(a, b, c, d, x[i + 4], 7, -176418897);\n                d = md5_ff(d, a, b, c, x[i + 5], 12, 1200080426);\n                c = md5_ff(c, d, a, b, x[i + 6], 17, -1473231341);\n                b = md5_ff(b, c, d, a, x[i + 7], 22, -45705983);\n                a = md5_ff(a, b, c, d, x[i + 8], 7, 1770035416);\n                d = md5_ff(d, a, b, c, x[i + 9], 12, -1958414417);\n                c = md5_ff(c, d, a, b, x[i + 10], 17, -42063);\n                b = md5_ff(b, c, d, a, x[i + 11], 22, -1990404162);\n                a = md5_ff(a, b, c, d, x[i + 12], 7, 1804603682);\n                d = md5_ff(d, a, b, c, x[i + 13], 12, -40341101);\n                c = md5_ff(c, d, a, b, x[i + 14], 17, -1502002290);\n                b = md5_ff(b, c, d, a, x[i + 15], 22, 1236535329);\n                a = md5_gg(a, b, c, d, x[i + 1], 5, -165796510);\n                d = md5_gg(d, a, b, c, x[i + 6], 9, -1069501632);\n                c = md5_gg(c, d, a, b, x[i + 11], 14, 643717713);\n                b = md5_gg(b, c, d, a, x[i + 0], 20, -373897302);\n                a = md5_gg(a, b, c, d, x[i + 5], 5, -701558691);\n                d = md5_gg(d, a, b, c, x[i + 10], 9, 38016083);\n                c = md5_gg(c, d, a, b, x[i + 15], 14, -660478335);\n                b = md5_gg(b, c, d, a, x[i + 4], 20, -405537848);\n                a = md5_gg(a, b, c, d, x[i + 9], 5, 568446438);\n                d = md5_gg(d, a, b, c, x[i + 14], 9, -1019803690);\n                c = md5_gg(c, d, a, b, x[i + 3], 14, -187363961);\n                b = md5_gg(b, c, d, a, x[i + 8], 20, 1163531501);\n                a = md5_gg(a, b, c, d, x[i + 13], 5, -1444681467);\n                d = md5_gg(d, a, b, c, x[i + 2], 9, -51403784);\n                c = md5_gg(c, d, a, b, x[i + 7], 14, 1735328473);\n                b = md5_gg(b, c, d, a, x[i + 12], 20, -1926607734);\n                a = md5_hh(a, b, c, d, x[i + 5], 4, -378558);\n                d = md5_hh(d, a, b, c, x[i + 8], 11, -2022574463);\n                c = md5_hh(c, d, a, b, x[i + 11], 16, 1839030562);\n                b = md5_hh(b, c, d, a, x[i + 14], 23, -35309556);\n                a = md5_hh(a, b, c, d, x[i + 1], 4, -1530992060);\n                d = md5_hh(d, a, b, c, x[i + 4], 11, 1272893353);\n                c = md5_hh(c, d, a, b, x[i + 7], 16, -155497632);\n                b = md5_hh(b, c, d, a, x[i + 10], 23, -1094730640);\n                a = md5_hh(a, b, c, d, x[i + 13], 4, 681279174);\n                d = md5_hh(d, a, b, c, x[i + 0], 11, -358537222);\n                c = md5_hh(c, d, a, b, x[i + 3], 16, -722521979);\n                b = md5_hh(b, c, d, a, x[i + 6], 23, 76029189);\n                a = md5_hh(a, b, c, d, x[i + 9], 4, -640364487);\n                d = md5_hh(d, a, b, c, x[i + 12], 11, -421815835);\n                c = md5_hh(c, d, a, b, x[i + 15], 16, 530742520);\n                b = md5_hh(b, c, d, a, x[i + 2], 23, -995338651);\n                a = md5_ii(a, b, c, d, x[i + 0], 6, -198630844);\n                d = md5_ii(d, a, b, c, x[i + 7], 10, 1126891415);\n                c = md5_ii(c, d, a, b, x[i + 14], 15, -1416354905);\n                b = md5_ii(b, c, d, a, x[i + 5], 21, -57434055);\n                a = md5_ii(a, b, c, d, x[i + 12], 6, 1700485571);\n                d = md5_ii(d, a, b, c, x[i + 3], 10, -1894986606);\n                c = md5_ii(c, d, a, b, x[i + 10], 15, -1051523);\n                b = md5_ii(b, c, d, a, x[i + 1], 21, -2054922799);\n                a = md5_ii(a, b, c, d, x[i + 8], 6, 1873313359);\n                d = md5_ii(d, a, b, c, x[i + 15], 10, -30611744);\n                c = md5_ii(c, d, a, b, x[i + 6], 15, -1560198380);\n                b = md5_ii(b, c, d, a, x[i + 13], 21, 1309151649);\n                a = md5_ii(a, b, c, d, x[i + 4], 6, -145523070);\n                d = md5_ii(d, a, b, c, x[i + 11], 10, -1120210379);\n                c = md5_ii(c, d, a, b, x[i + 2], 15, 718787259);\n                b = md5_ii(b, c, d, a, x[i + 9], 21, -343485551);\n                a = safe_add$1(a, olda);\n                b = safe_add$1(b, oldb);\n                c = safe_add$1(c, oldc);\n                d = safe_add$1(d, oldd);\n              }\n\n              return [a, b, c, d];\n            };\n            /*\n             * These are the functions you'll usually want to call.\n             * They take string arguments and return either hex or base-64 encoded\n             * strings.\n             */\n\n\n            const MD5 = {\n              hexdigest: function (s) {\n                return binl2hex(core_md5(str2binl(s), s.length * 8));\n              },\n              hash: function (s) {\n                return binl2str(core_md5(str2binl(s), s.length * 8));\n              }\n            };\n\n            /** Class: Strophe.SASLMechanism\n             *\n             *  Encapsulates an SASL authentication mechanism.\n             *\n             *  User code may override the priority for each mechanism or disable it completely.\n             *  See <priority> for information about changing priority and <test> for informatian on\n             *  how to disable a mechanism.\n             *\n             *  By default, all mechanisms are enabled and the priorities are\n             *\n             *      SCRAM-SHA-1 - 60\n             *      PLAIN       - 50\n             *      OAUTHBEARER - 40\n             *      X-OAUTH2    - 30\n             *      ANONYMOUS   - 20\n             *      EXTERNAL    - 10\n             *\n             *  See: Strophe.Connection.addSupportedSASLMechanisms\n             */\n            class SASLMechanism {\n              /**\n               * PrivateConstructor: Strophe.SASLMechanism\n               * SASL auth mechanism abstraction.\n               *\n               *  Parameters:\n               *    (String) name - SASL Mechanism name.\n               *    (Boolean) isClientFirst - If client should send response first without challenge.\n               *    (Number) priority - Priority.\n               *\n               *  Returns:\n               *    A new Strophe.SASLMechanism object.\n               */\n              constructor(name, isClientFirst, priority) {\n                /** PrivateVariable: mechname\n                 *  Mechanism name.\n                 */\n                this.mechname = name;\n                /** PrivateVariable: isClientFirst\n                 *  If client sends response without initial server challenge.\n                 */\n\n                this.isClientFirst = isClientFirst;\n                /** Variable: priority\n                 *  Determines which <SASLMechanism> is chosen for authentication (Higher is better).\n                 *  Users may override this to prioritize mechanisms differently.\n                 *\n                 *  Example: (This will cause Strophe to choose the mechanism that the server sent first)\n                 *\n                 *  > Strophe.SASLPlain.priority = Strophe.SASLSHA1.priority;\n                 *\n                 *  See <SASL mechanisms> for a list of available mechanisms.\n                 *\n                 */\n\n                this.priority = priority;\n              }\n              /**\n               *  Function: test\n               *  Checks if mechanism able to run.\n               *  To disable a mechanism, make this return false;\n               *\n               *  To disable plain authentication run\n               *  > Strophe.SASLPlain.test = function() {\n               *  >   return false;\n               *  > }\n               *\n               *  See <SASL mechanisms> for a list of available mechanisms.\n               *\n               *  Parameters:\n               *    (Strophe.Connection) connection - Target Connection.\n               *\n               *  Returns:\n               *    (Boolean) If mechanism was able to run.\n               */\n\n\n              test() {\n                // eslint-disable-line class-methods-use-this\n                return true;\n              }\n              /** PrivateFunction: onStart\n               *  Called before starting mechanism on some connection.\n               *\n               *  Parameters:\n               *    (Strophe.Connection) connection - Target Connection.\n               */\n\n\n              onStart(connection) {\n                this._connection = connection;\n              }\n              /** PrivateFunction: onChallenge\n               *  Called by protocol implementation on incoming challenge.\n               *\n               *  By deafult, if the client is expected to send data first (isClientFirst === true),\n               *  this method is called with `challenge` as null on the first call,\n               *  unless `clientChallenge` is overridden in the relevant subclass.\n               *\n               *  Parameters:\n               *    (Strophe.Connection) connection - Target Connection.\n               *    (String) challenge - current challenge to handle.\n               *\n               *  Returns:\n               *    (String) Mechanism response.\n               */\n\n\n              onChallenge(connection, challenge) {\n                // eslint-disable-line\n                throw new Error(\"You should implement challenge handling!\");\n              }\n              /** PrivateFunction: clientChallenge\n               *  Called by the protocol implementation if the client is expected to send\n               *  data first in the authentication exchange (i.e. isClientFirst === true).\n               *\n               *  Parameters:\n               *    (Strophe.Connection) connection - Target Connection.\n               *\n               *  Returns:\n               *    (String) Mechanism response.\n               */\n\n\n              clientChallenge(connection) {\n                if (!this.isClientFirst) {\n                  throw new Error(\"clientChallenge should not be called if isClientFirst is false!\");\n                }\n\n                return this.onChallenge(connection);\n              }\n              /** PrivateFunction: onFailure\n               *  Protocol informs mechanism implementation about SASL failure.\n               */\n\n\n              onFailure() {\n                this._connection = null;\n              }\n              /** PrivateFunction: onSuccess\n               *  Protocol informs mechanism implementation about SASL success.\n               */\n\n\n              onSuccess() {\n                this._connection = null;\n              }\n\n            }\n\n            class SASLAnonymous extends SASLMechanism {\n              /** PrivateConstructor: SASLAnonymous\n               *  SASL ANONYMOUS authentication.\n               */\n              constructor() {\n                let mechname = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 'ANONYMOUS';\n                let isClientFirst = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n                let priority = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 20;\n                super(mechname, isClientFirst, priority);\n              }\n\n              test(connection) {\n                // eslint-disable-line class-methods-use-this\n                return connection.authcid === null;\n              }\n\n            }\n\n            class SASLExternal extends SASLMechanism {\n              /** PrivateConstructor: SASLExternal\n               *  SASL EXTERNAL authentication.\n               *\n               *  The EXTERNAL mechanism allows a client to request the server to use\n               *  credentials established by means external to the mechanism to\n               *  authenticate the client. The external means may be, for instance,\n               *  TLS services.\n               */\n              constructor() {\n                let mechname = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 'EXTERNAL';\n                let isClientFirst = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;\n                let priority = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 10;\n                super(mechname, isClientFirst, priority);\n              }\n\n              onChallenge(connection) {\n                // eslint-disable-line class-methods-use-this\n\n                /** According to XEP-178, an authzid SHOULD NOT be presented when the\n                 * authcid contained or implied in the client certificate is the JID (i.e.\n                 * authzid) with which the user wants to log in as.\n                 *\n                 * To NOT send the authzid, the user should therefore set the authcid equal\n                 * to the JID when instantiating a new Strophe.Connection object.\n                 */\n                return connection.authcid === connection.authzid ? '' : connection.authzid;\n              }\n\n            }\n\n            const utils = {\n              utf16to8: function (str) {\n                var i, c;\n                var out = \"\";\n                var len = str.length;\n\n                for (i = 0; i < len; i++) {\n                  c = str.charCodeAt(i);\n\n                  if (c >= 0x0000 && c <= 0x007F) {\n                    out += str.charAt(i);\n                  } else if (c > 0x07FF) {\n                    out += String.fromCharCode(0xE0 | c >> 12 & 0x0F);\n                    out += String.fromCharCode(0x80 | c >> 6 & 0x3F);\n                    out += String.fromCharCode(0x80 | c >> 0 & 0x3F);\n                  } else {\n                    out += String.fromCharCode(0xC0 | c >> 6 & 0x1F);\n                    out += String.fromCharCode(0x80 | c >> 0 & 0x3F);\n                  }\n                }\n\n                return out;\n              },\n              addCookies: function (cookies) {\n                /* Parameters:\n                 *  (Object) cookies - either a map of cookie names\n                 *    to string values or to maps of cookie values.\n                 *\n                 * For example:\n                 * { \"myCookie\": \"1234\" }\n                 *\n                 * or:\n                 * { \"myCookie\": {\n                 *      \"value\": \"1234\",\n                 *      \"domain\": \".example.org\",\n                 *      \"path\": \"/\",\n                 *      \"expires\": expirationDate\n                 *      }\n                 *  }\n                 *\n                 *  These values get passed to Strophe.Connection via\n                 *   options.cookies\n                 */\n                cookies = cookies || {};\n\n                for (const cookieName in cookies) {\n                  if (Object.prototype.hasOwnProperty.call(cookies, cookieName)) {\n                    let expires = '';\n                    let domain = '';\n                    let path = '';\n                    const cookieObj = cookies[cookieName];\n                    const isObj = typeof cookieObj === \"object\";\n                    const cookieValue = escape(unescape(isObj ? cookieObj.value : cookieObj));\n\n                    if (isObj) {\n                      expires = cookieObj.expires ? \";expires=\" + cookieObj.expires : '';\n                      domain = cookieObj.domain ? \";domain=\" + cookieObj.domain : '';\n                      path = cookieObj.path ? \";path=\" + cookieObj.path : '';\n                    }\n\n                    document.cookie = cookieName + '=' + cookieValue + expires + domain + path;\n                  }\n                }\n              }\n            };\n\n            class SASLOAuthBearer extends SASLMechanism {\n              /** PrivateConstructor: SASLOAuthBearer\n               *  SASL OAuth Bearer authentication.\n               */\n              constructor() {\n                let mechname = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 'OAUTHBEARER';\n                let isClientFirst = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;\n                let priority = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 40;\n                super(mechname, isClientFirst, priority);\n              }\n\n              test(connection) {\n                // eslint-disable-line class-methods-use-this\n                return connection.pass !== null;\n              }\n\n              onChallenge(connection) {\n                // eslint-disable-line class-methods-use-this\n                let auth_str = 'n,';\n\n                if (connection.authcid !== null) {\n                  auth_str = auth_str + 'a=' + connection.authzid;\n                }\n\n                auth_str = auth_str + ',';\n                auth_str = auth_str + \"\\u0001\";\n                auth_str = auth_str + 'auth=Bearer ';\n                auth_str = auth_str + connection.pass;\n                auth_str = auth_str + \"\\u0001\";\n                auth_str = auth_str + \"\\u0001\";\n                return utils.utf16to8(auth_str);\n              }\n\n            }\n\n            class SASLPlain extends SASLMechanism {\n              /** PrivateConstructor: SASLPlain\n               *  SASL PLAIN authentication.\n               */\n              constructor() {\n                let mechname = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 'PLAIN';\n                let isClientFirst = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;\n                let priority = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 50;\n                super(mechname, isClientFirst, priority);\n              }\n\n              test(connection) {\n                // eslint-disable-line class-methods-use-this\n                return connection.authcid !== null;\n              }\n\n              onChallenge(connection) {\n                // eslint-disable-line class-methods-use-this\n                const {\n                  authcid,\n                  authzid,\n                  domain,\n                  pass\n                } = connection;\n\n                if (!domain) {\n                  throw new Error(\"SASLPlain onChallenge: domain is not defined!\");\n                } // Only include authzid if it differs from authcid.\n                // See: https://tools.ietf.org/html/rfc6120#section-6.3.8\n\n\n                let auth_str = authzid !== `${authcid}@${domain}` ? authzid : '';\n                auth_str = auth_str + \"\\u0000\";\n                auth_str = auth_str + authcid;\n                auth_str = auth_str + \"\\u0000\";\n                auth_str = auth_str + pass;\n                return utils.utf16to8(auth_str);\n              }\n\n            }\n\n            /*\n             * A JavaScript implementation of the Secure Hash Algorithm, SHA-1, as defined\n             * in FIPS PUB 180-1\n             * Version 2.1a Copyright Paul Johnston 2000 - 2002.\n             * Other contributors: Greg Holt, Andrew Kepert, Ydnar, Lostinet\n             * Distributed under the BSD License\n             * See http://pajhome.org.uk/crypt/md5 for details.\n             */\n\n            /* global define */\n\n            /* Some functions and variables have been stripped for use with Strophe */\n\n            /*\n             * Calculate the SHA-1 of an array of big-endian words, and a bit length\n             */\n            function core_sha1(x, len) {\n              /* append padding */\n              x[len >> 5] |= 0x80 << 24 - len % 32;\n              x[(len + 64 >> 9 << 4) + 15] = len;\n              var w = new Array(80);\n              var a = 1732584193;\n              var b = -271733879;\n              var c = -1732584194;\n              var d = 271733878;\n              var e = -1009589776;\n              var i, j, t, olda, oldb, oldc, oldd, olde;\n\n              for (i = 0; i < x.length; i += 16) {\n                olda = a;\n                oldb = b;\n                oldc = c;\n                oldd = d;\n                olde = e;\n\n                for (j = 0; j < 80; j++) {\n                  if (j < 16) {\n                    w[j] = x[i + j];\n                  } else {\n                    w[j] = rol(w[j - 3] ^ w[j - 8] ^ w[j - 14] ^ w[j - 16], 1);\n                  }\n\n                  t = safe_add(safe_add(rol(a, 5), sha1_ft(j, b, c, d)), safe_add(safe_add(e, w[j]), sha1_kt(j)));\n                  e = d;\n                  d = c;\n                  c = rol(b, 30);\n                  b = a;\n                  a = t;\n                }\n\n                a = safe_add(a, olda);\n                b = safe_add(b, oldb);\n                c = safe_add(c, oldc);\n                d = safe_add(d, oldd);\n                e = safe_add(e, olde);\n              }\n\n              return [a, b, c, d, e];\n            }\n            /*\n             * Perform the appropriate triplet combination function for the current\n             * iteration\n             */\n\n\n            function sha1_ft(t, b, c, d) {\n              if (t < 20) {\n                return b & c | ~b & d;\n              }\n\n              if (t < 40) {\n                return b ^ c ^ d;\n              }\n\n              if (t < 60) {\n                return b & c | b & d | c & d;\n              }\n\n              return b ^ c ^ d;\n            }\n            /*\n             * Determine the appropriate additive constant for the current iteration\n             */\n\n\n            function sha1_kt(t) {\n              return t < 20 ? 1518500249 : t < 40 ? 1859775393 : t < 60 ? -1894007588 : -899497514;\n            }\n            /*\n             * Calculate the HMAC-SHA1 of a key and some data\n             */\n\n\n            function core_hmac_sha1(key, data) {\n              var bkey = str2binb(key);\n\n              if (bkey.length > 16) {\n                bkey = core_sha1(bkey, key.length * 8);\n              }\n\n              var ipad = new Array(16),\n                  opad = new Array(16);\n\n              for (var i = 0; i < 16; i++) {\n                ipad[i] = bkey[i] ^ 0x36363636;\n                opad[i] = bkey[i] ^ 0x5C5C5C5C;\n              }\n\n              var hash = core_sha1(ipad.concat(str2binb(data)), 512 + data.length * 8);\n              return core_sha1(opad.concat(hash), 512 + 160);\n            }\n            /*\n             * Add integers, wrapping at 2^32. This uses 16-bit operations internally\n             * to work around bugs in some JS interpreters.\n             */\n\n\n            function safe_add(x, y) {\n              var lsw = (x & 0xFFFF) + (y & 0xFFFF);\n              var msw = (x >> 16) + (y >> 16) + (lsw >> 16);\n              return msw << 16 | lsw & 0xFFFF;\n            }\n            /*\n             * Bitwise rotate a 32-bit number to the left.\n             */\n\n\n            function rol(num, cnt) {\n              return num << cnt | num >>> 32 - cnt;\n            }\n            /*\n             * Convert an 8-bit or 16-bit string to an array of big-endian words\n             * In 8-bit function, characters >255 have their hi-byte silently ignored.\n             */\n\n\n            function str2binb(str) {\n              var bin = [];\n              var mask = 255;\n\n              for (var i = 0; i < str.length * 8; i += 8) {\n                bin[i >> 5] |= (str.charCodeAt(i / 8) & mask) << 24 - i % 32;\n              }\n\n              return bin;\n            }\n            /*\n             * Convert an array of big-endian words to a base-64 string\n             */\n\n\n            function binb2b64(binarray) {\n              var tab = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\";\n              var str = \"\";\n              var triplet, j;\n\n              for (var i = 0; i < binarray.length * 4; i += 3) {\n                triplet = (binarray[i >> 2] >> 8 * (3 - i % 4) & 0xFF) << 16 | (binarray[i + 1 >> 2] >> 8 * (3 - (i + 1) % 4) & 0xFF) << 8 | binarray[i + 2 >> 2] >> 8 * (3 - (i + 2) % 4) & 0xFF;\n\n                for (j = 0; j < 4; j++) {\n                  if (i * 8 + j * 6 > binarray.length * 32) {\n                    str += \"=\";\n                  } else {\n                    str += tab.charAt(triplet >> 6 * (3 - j) & 0x3F);\n                  }\n                }\n              }\n\n              return str;\n            }\n            /*\n             * Convert an array of big-endian words to a string\n             */\n\n\n            function binb2str(bin) {\n              var str = \"\";\n              var mask = 255;\n\n              for (var i = 0; i < bin.length * 32; i += 8) {\n                str += String.fromCharCode(bin[i >> 5] >>> 24 - i % 32 & mask);\n              }\n\n              return str;\n            }\n            /*\n             * These are the functions you'll usually want to call\n             * They take string arguments and return either hex or base-64 encoded strings\n             */\n\n\n            const SHA1 = {\n              b64_hmac_sha1: function (key, data) {\n                return binb2b64(core_hmac_sha1(key, data));\n              },\n              b64_sha1: function (s) {\n                return binb2b64(core_sha1(str2binb(s), s.length * 8));\n              },\n              binb2str: binb2str,\n              core_hmac_sha1: core_hmac_sha1,\n              str_hmac_sha1: function (key, data) {\n                return binb2str(core_hmac_sha1(key, data));\n              },\n              str_sha1: function (s) {\n                return binb2str(core_sha1(str2binb(s), s.length * 8));\n              }\n            };\n\n            class SASLSHA1 extends SASLMechanism {\n              /** PrivateConstructor: SASLSHA1\n               *  SASL SCRAM SHA 1 authentication.\n               */\n              constructor() {\n                let mechname = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 'SCRAM-SHA-1';\n                let isClientFirst = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;\n                let priority = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 60;\n                super(mechname, isClientFirst, priority);\n              }\n\n              test(connection) {\n                // eslint-disable-line class-methods-use-this\n                return connection.authcid !== null;\n              }\n\n              onChallenge(connection, challenge) {\n                // eslint-disable-line class-methods-use-this\n                let nonce, salt, iter, Hi, U, U_old, i, k;\n                let responseText = \"c=biws,\";\n                let authMessage = `${connection._sasl_data[\"client-first-message-bare\"]},${challenge},`;\n                const cnonce = connection._sasl_data.cnonce;\n                const attribMatch = /([a-z]+)=([^,]+)(,|$)/;\n\n                while (challenge.match(attribMatch)) {\n                  const matches = challenge.match(attribMatch);\n                  challenge = challenge.replace(matches[0], \"\");\n\n                  switch (matches[1]) {\n                    case \"r\":\n                      nonce = matches[2];\n                      break;\n\n                    case \"s\":\n                      salt = matches[2];\n                      break;\n\n                    case \"i\":\n                      iter = matches[2];\n                      break;\n                  }\n                }\n\n                if (nonce.slice(0, cnonce.length) !== cnonce) {\n                  connection._sasl_data = {};\n                  return connection._sasl_failure_cb();\n                }\n\n                responseText += \"r=\" + nonce;\n                authMessage += responseText;\n                salt = atob(salt);\n                salt += \"\\x00\\x00\\x00\\x01\";\n                const pass = utils.utf16to8(connection.pass);\n                Hi = U_old = SHA1.core_hmac_sha1(pass, salt);\n\n                for (i = 1; i < iter; i++) {\n                  U = SHA1.core_hmac_sha1(pass, SHA1.binb2str(U_old));\n\n                  for (k = 0; k < 5; k++) {\n                    Hi[k] ^= U[k];\n                  }\n\n                  U_old = U;\n                }\n\n                Hi = SHA1.binb2str(Hi);\n                const clientKey = SHA1.core_hmac_sha1(Hi, \"Client Key\");\n                const serverKey = SHA1.str_hmac_sha1(Hi, \"Server Key\");\n                const clientSignature = SHA1.core_hmac_sha1(SHA1.str_sha1(SHA1.binb2str(clientKey)), authMessage);\n                connection._sasl_data[\"server-signature\"] = SHA1.b64_hmac_sha1(serverKey, authMessage);\n\n                for (k = 0; k < 5; k++) {\n                  clientKey[k] ^= clientSignature[k];\n                }\n\n                responseText += \",p=\" + btoa(SHA1.binb2str(clientKey));\n                return responseText;\n              }\n\n              clientChallenge(connection, test_cnonce) {\n                // eslint-disable-line class-methods-use-this\n                const cnonce = test_cnonce || MD5.hexdigest(\"\" + Math.random() * 1234567890);\n                let auth_str = \"n=\" + utils.utf16to8(connection.authcid);\n                auth_str += \",r=\";\n                auth_str += cnonce;\n                connection._sasl_data.cnonce = cnonce;\n                connection._sasl_data[\"client-first-message-bare\"] = auth_str;\n                auth_str = \"n,,\" + auth_str;\n                return auth_str;\n              }\n\n            }\n\n            class SASLXOAuth2 extends SASLMechanism {\n              /** PrivateConstructor: SASLXOAuth2\n               *  SASL X-OAuth2 authentication.\n               */\n              constructor() {\n                let mechname = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 'X-OAUTH2';\n                let isClientFirst = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;\n                let priority = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 30;\n                super(mechname, isClientFirst, priority);\n              }\n\n              test(connection) {\n                // eslint-disable-line class-methods-use-this\n                return connection.pass !== null;\n              }\n\n              onChallenge(connection) {\n                // eslint-disable-line class-methods-use-this\n                let auth_str = '\\u0000';\n\n                if (connection.authcid !== null) {\n                  auth_str = auth_str + connection.authzid;\n                }\n\n                auth_str = auth_str + \"\\u0000\";\n                auth_str = auth_str + connection.pass;\n                return utils.utf16to8(auth_str);\n              }\n\n            }\n\n            /*\n                This program is distributed under the terms of the MIT license.\n                Please see the LICENSE file for details.\n\n                Copyright 2006-2018, OGG, LLC\n            */\n            /** Function: $build\n             *  Create a Strophe.Builder.\n             *  This is an alias for 'new Strophe.Builder(name, attrs)'.\n             *\n             *  Parameters:\n             *    (String) name - The root element name.\n             *    (Object) attrs - The attributes for the root element in object notation.\n             *\n             *  Returns:\n             *    A new Strophe.Builder object.\n             */\n\n            function $build(name, attrs) {\n              return new Strophe.Builder(name, attrs);\n            }\n            /** Function: $msg\n             *  Create a Strophe.Builder with a <message/> element as the root.\n             *\n             *  Parameters:\n             *    (Object) attrs - The <message/> element attributes in object notation.\n             *\n             *  Returns:\n             *    A new Strophe.Builder object.\n             */\n\n            function $msg(attrs) {\n              return new Strophe.Builder(\"message\", attrs);\n            }\n            /** Function: $iq\n             *  Create a Strophe.Builder with an <iq/> element as the root.\n             *\n             *  Parameters:\n             *    (Object) attrs - The <iq/> element attributes in object notation.\n             *\n             *  Returns:\n             *    A new Strophe.Builder object.\n             */\n\n            function $iq(attrs) {\n              return new Strophe.Builder(\"iq\", attrs);\n            }\n            /** Function: $pres\n             *  Create a Strophe.Builder with a <presence/> element as the root.\n             *\n             *  Parameters:\n             *    (Object) attrs - The <presence/> element attributes in object notation.\n             *\n             *  Returns:\n             *    A new Strophe.Builder object.\n             */\n\n            function $pres(attrs) {\n              return new Strophe.Builder(\"presence\", attrs);\n            }\n            /** Class: Strophe\n             *  An object container for all Strophe library functions.\n             *\n             *  This class is just a container for all the objects and constants\n             *  used in the library.  It is not meant to be instantiated, but to\n             *  provide a namespace for library objects, constants, and functions.\n             */\n\n            const Strophe = {\n              /** Constant: VERSION */\n              VERSION: \"1.5.0\",\n\n              /** Constants: XMPP Namespace Constants\n               *  Common namespace constants from the XMPP RFCs and XEPs.\n               *\n               *  NS.HTTPBIND - HTTP BIND namespace from XEP 124.\n               *  NS.BOSH - BOSH namespace from XEP 206.\n               *  NS.CLIENT - Main XMPP client namespace.\n               *  NS.AUTH - Legacy authentication namespace.\n               *  NS.ROSTER - Roster operations namespace.\n               *  NS.PROFILE - Profile namespace.\n               *  NS.DISCO_INFO - Service discovery info namespace from XEP 30.\n               *  NS.DISCO_ITEMS - Service discovery items namespace from XEP 30.\n               *  NS.MUC - Multi-User Chat namespace from XEP 45.\n               *  NS.SASL - XMPP SASL namespace from RFC 3920.\n               *  NS.STREAM - XMPP Streams namespace from RFC 3920.\n               *  NS.BIND - XMPP Binding namespace from RFC 3920 and RFC 6120.\n               *  NS.SESSION - XMPP Session namespace from RFC 3920.\n               *  NS.XHTML_IM - XHTML-IM namespace from XEP 71.\n               *  NS.XHTML - XHTML body namespace from XEP 71.\n               */\n              NS: {\n                HTTPBIND: \"http://jabber.org/protocol/httpbind\",\n                BOSH: \"urn:xmpp:xbosh\",\n                CLIENT: \"jabber:client\",\n                AUTH: \"jabber:iq:auth\",\n                ROSTER: \"jabber:iq:roster\",\n                PROFILE: \"jabber:iq:profile\",\n                DISCO_INFO: \"http://jabber.org/protocol/disco#info\",\n                DISCO_ITEMS: \"http://jabber.org/protocol/disco#items\",\n                MUC: \"http://jabber.org/protocol/muc\",\n                SASL: \"urn:ietf:params:xml:ns:xmpp-sasl\",\n                STREAM: \"http://etherx.jabber.org/streams\",\n                FRAMING: \"urn:ietf:params:xml:ns:xmpp-framing\",\n                BIND: \"urn:ietf:params:xml:ns:xmpp-bind\",\n                SESSION: \"urn:ietf:params:xml:ns:xmpp-session\",\n                VERSION: \"jabber:iq:version\",\n                STANZAS: \"urn:ietf:params:xml:ns:xmpp-stanzas\",\n                XHTML_IM: \"http://jabber.org/protocol/xhtml-im\",\n                XHTML: \"http://www.w3.org/1999/xhtml\"\n              },\n\n              /** Constants: XHTML_IM Namespace\n               *  contains allowed tags, tag attributes, and css properties.\n               *  Used in the createHtml function to filter incoming html into the allowed XHTML-IM subset.\n               *  See http://xmpp.org/extensions/xep-0071.html#profile-summary for the list of recommended\n               *  allowed tags and their attributes.\n               */\n              XHTML: {\n                tags: ['a', 'blockquote', 'br', 'cite', 'em', 'img', 'li', 'ol', 'p', 'span', 'strong', 'ul', 'body'],\n                attributes: {\n                  'a': ['href'],\n                  'blockquote': ['style'],\n                  'br': [],\n                  'cite': ['style'],\n                  'em': [],\n                  'img': ['src', 'alt', 'style', 'height', 'width'],\n                  'li': ['style'],\n                  'ol': ['style'],\n                  'p': ['style'],\n                  'span': ['style'],\n                  'strong': [],\n                  'ul': ['style'],\n                  'body': []\n                },\n                css: ['background-color', 'color', 'font-family', 'font-size', 'font-style', 'font-weight', 'margin-left', 'margin-right', 'text-align', 'text-decoration'],\n\n                /** Function: XHTML.validTag\n                 *\n                 * Utility method to determine whether a tag is allowed\n                 * in the XHTML_IM namespace.\n                 *\n                 * XHTML tag names are case sensitive and must be lower case.\n                 */\n                validTag(tag) {\n                  for (let i = 0; i < Strophe.XHTML.tags.length; i++) {\n                    if (tag === Strophe.XHTML.tags[i]) {\n                      return true;\n                    }\n                  }\n\n                  return false;\n                },\n\n                /** Function: XHTML.validAttribute\n                 *\n                 * Utility method to determine whether an attribute is allowed\n                 * as recommended per XEP-0071\n                 *\n                 * XHTML attribute names are case sensitive and must be lower case.\n                 */\n                validAttribute(tag, attribute) {\n                  if (typeof Strophe.XHTML.attributes[tag] !== 'undefined' && Strophe.XHTML.attributes[tag].length > 0) {\n                    for (let i = 0; i < Strophe.XHTML.attributes[tag].length; i++) {\n                      if (attribute === Strophe.XHTML.attributes[tag][i]) {\n                        return true;\n                      }\n                    }\n                  }\n\n                  return false;\n                },\n\n                validCSS(style) {\n                  for (let i = 0; i < Strophe.XHTML.css.length; i++) {\n                    if (style === Strophe.XHTML.css[i]) {\n                      return true;\n                    }\n                  }\n\n                  return false;\n                }\n\n              },\n\n              /** Constants: Connection Status Constants\n               *  Connection status constants for use by the connection handler\n               *  callback.\n               *\n               *  Status.ERROR - An error has occurred\n               *  Status.CONNECTING - The connection is currently being made\n               *  Status.CONNFAIL - The connection attempt failed\n               *  Status.AUTHENTICATING - The connection is authenticating\n               *  Status.AUTHFAIL - The authentication attempt failed\n               *  Status.CONNECTED - The connection has succeeded\n               *  Status.DISCONNECTED - The connection has been terminated\n               *  Status.DISCONNECTING - The connection is currently being terminated\n               *  Status.ATTACHED - The connection has been attached\n               *  Status.REDIRECT - The connection has been redirected\n               *  Status.CONNTIMEOUT - The connection has timed out\n               */\n              Status: {\n                ERROR: 0,\n                CONNECTING: 1,\n                CONNFAIL: 2,\n                AUTHENTICATING: 3,\n                AUTHFAIL: 4,\n                CONNECTED: 5,\n                DISCONNECTED: 6,\n                DISCONNECTING: 7,\n                ATTACHED: 8,\n                REDIRECT: 9,\n                CONNTIMEOUT: 10,\n                BINDREQUIRED: 11,\n                ATTACHFAIL: 12\n              },\n              ErrorCondition: {\n                BAD_FORMAT: \"bad-format\",\n                CONFLICT: \"conflict\",\n                MISSING_JID_NODE: \"x-strophe-bad-non-anon-jid\",\n                NO_AUTH_MECH: \"no-auth-mech\",\n                UNKNOWN_REASON: \"unknown\"\n              },\n\n              /** Constants: Log Level Constants\n               *  Logging level indicators.\n               *\n               *  LogLevel.DEBUG - Debug output\n               *  LogLevel.INFO - Informational output\n               *  LogLevel.WARN - Warnings\n               *  LogLevel.ERROR - Errors\n               *  LogLevel.FATAL - Fatal errors\n               */\n              LogLevel: {\n                DEBUG: 0,\n                INFO: 1,\n                WARN: 2,\n                ERROR: 3,\n                FATAL: 4\n              },\n\n              /** PrivateConstants: DOM Element Type Constants\n               *  DOM element types.\n               *\n               *  ElementType.NORMAL - Normal element.\n               *  ElementType.TEXT - Text data element.\n               *  ElementType.FRAGMENT - XHTML fragment element.\n               */\n              ElementType: {\n                NORMAL: 1,\n                TEXT: 3,\n                CDATA: 4,\n                FRAGMENT: 11\n              },\n\n              /** PrivateConstants: Timeout Values\n               *  Timeout values for error states.  These values are in seconds.\n               *  These should not be changed unless you know exactly what you are\n               *  doing.\n               *\n               *  TIMEOUT - Timeout multiplier. A waiting request will be considered\n               *      failed after Math.floor(TIMEOUT * wait) seconds have elapsed.\n               *      This defaults to 1.1, and with default wait, 66 seconds.\n               *  SECONDARY_TIMEOUT - Secondary timeout multiplier. In cases where\n               *      Strophe can detect early failure, it will consider the request\n               *      failed if it doesn't return after\n               *      Math.floor(SECONDARY_TIMEOUT * wait) seconds have elapsed.\n               *      This defaults to 0.1, and with default wait, 6 seconds.\n               */\n              TIMEOUT: 1.1,\n              SECONDARY_TIMEOUT: 0.1,\n\n              /** Function: addNamespace\n               *  This function is used to extend the current namespaces in\n               *  Strophe.NS.  It takes a key and a value with the key being the\n               *  name of the new namespace, with its actual value.\n               *  For example:\n               *  Strophe.addNamespace('PUBSUB', \"http://jabber.org/protocol/pubsub\");\n               *\n               *  Parameters:\n               *    (String) name - The name under which the namespace will be\n               *      referenced under Strophe.NS\n               *    (String) value - The actual namespace.\n               */\n              addNamespace(name, value) {\n                Strophe.NS[name] = value;\n              },\n\n              /** Function: forEachChild\n               *  Map a function over some or all child elements of a given element.\n               *\n               *  This is a small convenience function for mapping a function over\n               *  some or all of the children of an element.  If elemName is null, all\n               *  children will be passed to the function, otherwise only children\n               *  whose tag names match elemName will be passed.\n               *\n               *  Parameters:\n               *    (XMLElement) elem - The element to operate on.\n               *    (String) elemName - The child element tag name filter.\n               *    (Function) func - The function to apply to each child.  This\n               *      function should take a single argument, a DOM element.\n               */\n              forEachChild(elem, elemName, func) {\n                for (let i = 0; i < elem.childNodes.length; i++) {\n                  const childNode = elem.childNodes[i];\n\n                  if (childNode.nodeType === Strophe.ElementType.NORMAL && (!elemName || this.isTagEqual(childNode, elemName))) {\n                    func(childNode);\n                  }\n                }\n              },\n\n              /** Function: isTagEqual\n               *  Compare an element's tag name with a string.\n               *\n               *  This function is case sensitive.\n               *\n               *  Parameters:\n               *    (XMLElement) el - A DOM element.\n               *    (String) name - The element name.\n               *\n               *  Returns:\n               *    true if the element's tag name matches _el_, and false\n               *    otherwise.\n               */\n              isTagEqual(el, name) {\n                return el.tagName === name;\n              },\n\n              /** PrivateVariable: _xmlGenerator\n               *  _Private_ variable that caches a DOM document to\n               *  generate elements.\n               */\n              _xmlGenerator: null,\n\n              /** Function: xmlGenerator\n               *  Get the DOM document to generate elements.\n               *\n               *  Returns:\n               *    The currently used DOM document.\n               */\n              xmlGenerator() {\n                if (!Strophe._xmlGenerator) {\n                  Strophe._xmlGenerator = getDummyXMLDOMDocument();\n                }\n\n                return Strophe._xmlGenerator;\n              },\n\n              /** Function: xmlElement\n               *  Create an XML DOM element.\n               *\n               *  This function creates an XML DOM element correctly across all\n               *  implementations. Note that these are not HTML DOM elements, which\n               *  aren't appropriate for XMPP stanzas.\n               *\n               *  Parameters:\n               *    (String) name - The name for the element.\n               *    (Array|Object) attrs - An optional array or object containing\n               *      key/value pairs to use as element attributes. The object should\n               *      be in the format {'key': 'value'} or {key: 'value'}. The array\n               *      should have the format [['key1', 'value1'], ['key2', 'value2']].\n               *    (String) text - The text child data for the element.\n               *\n               *  Returns:\n               *    A new XML DOM element.\n               */\n              xmlElement(name) {\n                if (!name) {\n                  return null;\n                }\n\n                const node = Strophe.xmlGenerator().createElement(name); // FIXME: this should throw errors if args are the wrong type or\n                // there are more than two optional args\n\n                for (let a = 1; a < arguments.length; a++) {\n                  const arg = arguments[a];\n\n                  if (!arg) {\n                    continue;\n                  }\n\n                  if (typeof arg === \"string\" || typeof arg === \"number\") {\n                    node.appendChild(Strophe.xmlTextNode(arg));\n                  } else if (typeof arg === \"object\" && typeof arg.sort === \"function\") {\n                    for (let i = 0; i < arg.length; i++) {\n                      const attr = arg[i];\n\n                      if (typeof attr === \"object\" && typeof attr.sort === \"function\" && attr[1] !== undefined && attr[1] !== null) {\n                        node.setAttribute(attr[0], attr[1]);\n                      }\n                    }\n                  } else if (typeof arg === \"object\") {\n                    for (const k in arg) {\n                      if (Object.prototype.hasOwnProperty.call(arg, k) && arg[k] !== undefined && arg[k] !== null) {\n                        node.setAttribute(k, arg[k]);\n                      }\n                    }\n                  }\n                }\n\n                return node;\n              },\n\n              /*  Function: xmlescape\n               *  Excapes invalid xml characters.\n               *\n               *  Parameters:\n               *     (String) text - text to escape.\n               *\n               *  Returns:\n               *      Escaped text.\n               */\n              xmlescape(text) {\n                text = text.replace(/\\&/g, \"&amp;\");\n                text = text.replace(/</g, \"&lt;\");\n                text = text.replace(/>/g, \"&gt;\");\n                text = text.replace(/'/g, \"&apos;\");\n                text = text.replace(/\"/g, \"&quot;\");\n                return text;\n              },\n\n              /*  Function: xmlunescape\n              *  Unexcapes invalid xml characters.\n              *\n              *  Parameters:\n              *     (String) text - text to unescape.\n              *\n              *  Returns:\n              *      Unescaped text.\n              */\n              xmlunescape(text) {\n                text = text.replace(/\\&amp;/g, \"&\");\n                text = text.replace(/&lt;/g, \"<\");\n                text = text.replace(/&gt;/g, \">\");\n                text = text.replace(/&apos;/g, \"'\");\n                text = text.replace(/&quot;/g, \"\\\"\");\n                return text;\n              },\n\n              /** Function: xmlTextNode\n               *  Creates an XML DOM text node.\n               *\n               *  Provides a cross implementation version of document.createTextNode.\n               *\n               *  Parameters:\n               *    (String) text - The content of the text node.\n               *\n               *  Returns:\n               *    A new XML DOM text node.\n               */\n              xmlTextNode(text) {\n                return Strophe.xmlGenerator().createTextNode(text);\n              },\n\n              /** Function: xmlHtmlNode\n               *  Creates an XML DOM html node.\n               *\n               *  Parameters:\n               *    (String) html - The content of the html node.\n               *\n               *  Returns:\n               *    A new XML DOM text node.\n               */\n              xmlHtmlNode(html) {\n                let node; //ensure text is escaped\n\n                if (DOMParser) {\n                  const parser = new DOMParser();\n                  node = parser.parseFromString(html, \"text/xml\");\n                } else {\n                  node = new ActiveXObject(\"Microsoft.XMLDOM\");\n                  node.async = \"false\";\n                  node.loadXML(html);\n                }\n\n                return node;\n              },\n\n              /** Function: getText\n               *  Get the concatenation of all text children of an element.\n               *\n               *  Parameters:\n               *    (XMLElement) elem - A DOM element.\n               *\n               *  Returns:\n               *    A String with the concatenated text of all text element children.\n               */\n              getText(elem) {\n                if (!elem) {\n                  return null;\n                }\n\n                let str = \"\";\n\n                if (elem.childNodes.length === 0 && elem.nodeType === Strophe.ElementType.TEXT) {\n                  str += elem.nodeValue;\n                }\n\n                for (let i = 0; i < elem.childNodes.length; i++) {\n                  if (elem.childNodes[i].nodeType === Strophe.ElementType.TEXT) {\n                    str += elem.childNodes[i].nodeValue;\n                  }\n                }\n\n                return Strophe.xmlescape(str);\n              },\n\n              /** Function: copyElement\n               *  Copy an XML DOM element.\n               *\n               *  This function copies a DOM element and all its descendants and returns\n               *  the new copy.\n               *\n               *  Parameters:\n               *    (XMLElement) elem - A DOM element.\n               *\n               *  Returns:\n               *    A new, copied DOM element tree.\n               */\n              copyElement(elem) {\n                let el;\n\n                if (elem.nodeType === Strophe.ElementType.NORMAL) {\n                  el = Strophe.xmlElement(elem.tagName);\n\n                  for (let i = 0; i < elem.attributes.length; i++) {\n                    el.setAttribute(elem.attributes[i].nodeName, elem.attributes[i].value);\n                  }\n\n                  for (let i = 0; i < elem.childNodes.length; i++) {\n                    el.appendChild(Strophe.copyElement(elem.childNodes[i]));\n                  }\n                } else if (elem.nodeType === Strophe.ElementType.TEXT) {\n                  el = Strophe.xmlGenerator().createTextNode(elem.nodeValue);\n                }\n\n                return el;\n              },\n\n              /** Function: createHtml\n               *  Copy an HTML DOM element into an XML DOM.\n               *\n               *  This function copies a DOM element and all its descendants and returns\n               *  the new copy.\n               *\n               *  Parameters:\n               *    (HTMLElement) elem - A DOM element.\n               *\n               *  Returns:\n               *    A new, copied DOM element tree.\n               */\n              createHtml(elem) {\n                let el;\n\n                if (elem.nodeType === Strophe.ElementType.NORMAL) {\n                  const tag = elem.nodeName.toLowerCase(); // XHTML tags must be lower case.\n\n                  if (Strophe.XHTML.validTag(tag)) {\n                    try {\n                      el = Strophe.xmlElement(tag);\n\n                      for (let i = 0; i < Strophe.XHTML.attributes[tag].length; i++) {\n                        const attribute = Strophe.XHTML.attributes[tag][i];\n                        let value = elem.getAttribute(attribute);\n\n                        if (typeof value === 'undefined' || value === null || value === '' || value === false || value === 0) {\n                          continue;\n                        }\n\n                        if (attribute === 'style' && typeof value === 'object' && typeof value.cssText !== 'undefined') {\n                          value = value.cssText; // we're dealing with IE, need to get CSS out\n                        } // filter out invalid css styles\n\n\n                        if (attribute === 'style') {\n                          const css = [];\n                          const cssAttrs = value.split(';');\n\n                          for (let j = 0; j < cssAttrs.length; j++) {\n                            const attr = cssAttrs[j].split(':');\n                            const cssName = attr[0].replace(/^\\s*/, \"\").replace(/\\s*$/, \"\").toLowerCase();\n\n                            if (Strophe.XHTML.validCSS(cssName)) {\n                              const cssValue = attr[1].replace(/^\\s*/, \"\").replace(/\\s*$/, \"\");\n                              css.push(cssName + ': ' + cssValue);\n                            }\n                          }\n\n                          if (css.length > 0) {\n                            value = css.join('; ');\n                            el.setAttribute(attribute, value);\n                          }\n                        } else {\n                          el.setAttribute(attribute, value);\n                        }\n                      }\n\n                      for (let i = 0; i < elem.childNodes.length; i++) {\n                        el.appendChild(Strophe.createHtml(elem.childNodes[i]));\n                      }\n                    } catch (e) {\n                      // invalid elements\n                      el = Strophe.xmlTextNode('');\n                    }\n                  } else {\n                    el = Strophe.xmlGenerator().createDocumentFragment();\n\n                    for (let i = 0; i < elem.childNodes.length; i++) {\n                      el.appendChild(Strophe.createHtml(elem.childNodes[i]));\n                    }\n                  }\n                } else if (elem.nodeType === Strophe.ElementType.FRAGMENT) {\n                  el = Strophe.xmlGenerator().createDocumentFragment();\n\n                  for (let i = 0; i < elem.childNodes.length; i++) {\n                    el.appendChild(Strophe.createHtml(elem.childNodes[i]));\n                  }\n                } else if (elem.nodeType === Strophe.ElementType.TEXT) {\n                  el = Strophe.xmlTextNode(elem.nodeValue);\n                }\n\n                return el;\n              },\n\n              /** Function: escapeNode\n               *  Escape the node part (also called local part) of a JID.\n               *\n               *  Parameters:\n               *    (String) node - A node (or local part).\n               *\n               *  Returns:\n               *    An escaped node (or local part).\n               */\n              escapeNode(node) {\n                if (typeof node !== \"string\") {\n                  return node;\n                }\n\n                return node.replace(/^\\s+|\\s+$/g, '').replace(/\\\\/g, \"\\\\5c\").replace(/ /g, \"\\\\20\").replace(/\\\"/g, \"\\\\22\").replace(/\\&/g, \"\\\\26\").replace(/\\'/g, \"\\\\27\").replace(/\\//g, \"\\\\2f\").replace(/:/g, \"\\\\3a\").replace(/</g, \"\\\\3c\").replace(/>/g, \"\\\\3e\").replace(/@/g, \"\\\\40\");\n              },\n\n              /** Function: unescapeNode\n               *  Unescape a node part (also called local part) of a JID.\n               *\n               *  Parameters:\n               *    (String) node - A node (or local part).\n               *\n               *  Returns:\n               *    An unescaped node (or local part).\n               */\n              unescapeNode(node) {\n                if (typeof node !== \"string\") {\n                  return node;\n                }\n\n                return node.replace(/\\\\20/g, \" \").replace(/\\\\22/g, '\"').replace(/\\\\26/g, \"&\").replace(/\\\\27/g, \"'\").replace(/\\\\2f/g, \"/\").replace(/\\\\3a/g, \":\").replace(/\\\\3c/g, \"<\").replace(/\\\\3e/g, \">\").replace(/\\\\40/g, \"@\").replace(/\\\\5c/g, \"\\\\\");\n              },\n\n              /** Function: getNodeFromJid\n               *  Get the node portion of a JID String.\n               *\n               *  Parameters:\n               *    (String) jid - A JID.\n               *\n               *  Returns:\n               *    A String containing the node.\n               */\n              getNodeFromJid(jid) {\n                if (jid.indexOf(\"@\") < 0) {\n                  return null;\n                }\n\n                return jid.split(\"@\")[0];\n              },\n\n              /** Function: getDomainFromJid\n               *  Get the domain portion of a JID String.\n               *\n               *  Parameters:\n               *    (String) jid - A JID.\n               *\n               *  Returns:\n               *    A String containing the domain.\n               */\n              getDomainFromJid(jid) {\n                const bare = Strophe.getBareJidFromJid(jid);\n\n                if (bare.indexOf(\"@\") < 0) {\n                  return bare;\n                } else {\n                  const parts = bare.split(\"@\");\n                  parts.splice(0, 1);\n                  return parts.join('@');\n                }\n              },\n\n              /** Function: getResourceFromJid\n               *  Get the resource portion of a JID String.\n               *\n               *  Parameters:\n               *    (String) jid - A JID.\n               *\n               *  Returns:\n               *    A String containing the resource.\n               */\n              getResourceFromJid(jid) {\n                if (!jid) {\n                  return null;\n                }\n\n                const s = jid.split(\"/\");\n\n                if (s.length < 2) {\n                  return null;\n                }\n\n                s.splice(0, 1);\n                return s.join('/');\n              },\n\n              /** Function: getBareJidFromJid\n               *  Get the bare JID from a JID String.\n               *\n               *  Parameters:\n               *    (String) jid - A JID.\n               *\n               *  Returns:\n               *    A String containing the bare JID.\n               */\n              getBareJidFromJid(jid) {\n                return jid ? jid.split(\"/\")[0] : null;\n              },\n\n              /** PrivateFunction: _handleError\n               *  _Private_ function that properly logs an error to the console\n               */\n              _handleError(e) {\n                if (typeof e.stack !== \"undefined\") {\n                  Strophe.fatal(e.stack);\n                }\n\n                if (e.sourceURL) {\n                  Strophe.fatal(\"error: \" + this.handler + \" \" + e.sourceURL + \":\" + e.line + \" - \" + e.name + \": \" + e.message);\n                } else if (e.fileName) {\n                  Strophe.fatal(\"error: \" + this.handler + \" \" + e.fileName + \":\" + e.lineNumber + \" - \" + e.name + \": \" + e.message);\n                } else {\n                  Strophe.fatal(\"error: \" + e.message);\n                }\n              },\n\n              /** Function: log\n               *  User overrideable logging function.\n               *\n               *  This function is called whenever the Strophe library calls any\n               *  of the logging functions.  The default implementation of this\n               *  function logs only fatal errors.  If client code wishes to handle the logging\n               *  messages, it should override this with\n               *  > Strophe.log = function (level, msg) {\n               *  >   (user code here)\n               *  > };\n               *\n               *  Please note that data sent and received over the wire is logged\n               *  via Strophe.Connection.rawInput() and Strophe.Connection.rawOutput().\n               *\n               *  The different levels and their meanings are\n               *\n               *    DEBUG - Messages useful for debugging purposes.\n               *    INFO - Informational messages.  This is mostly information like\n               *      'disconnect was called' or 'SASL auth succeeded'.\n               *    WARN - Warnings about potential problems.  This is mostly used\n               *      to report transient connection errors like request timeouts.\n               *    ERROR - Some error occurred.\n               *    FATAL - A non-recoverable fatal error occurred.\n               *\n               *  Parameters:\n               *    (Integer) level - The log level of the log message.  This will\n               *      be one of the values in Strophe.LogLevel.\n               *    (String) msg - The log message.\n               */\n              log(level, msg) {\n                if (level === this.LogLevel.FATAL) {\n                  var _console;\n\n                  (_console = console) === null || _console === void 0 ? void 0 : _console.error(msg);\n                }\n              },\n\n              /** Function: debug\n               *  Log a message at the Strophe.LogLevel.DEBUG level.\n               *\n               *  Parameters:\n               *    (String) msg - The log message.\n               */\n              debug(msg) {\n                this.log(this.LogLevel.DEBUG, msg);\n              },\n\n              /** Function: info\n               *  Log a message at the Strophe.LogLevel.INFO level.\n               *\n               *  Parameters:\n               *    (String) msg - The log message.\n               */\n              info(msg) {\n                this.log(this.LogLevel.INFO, msg);\n              },\n\n              /** Function: warn\n               *  Log a message at the Strophe.LogLevel.WARN level.\n               *\n               *  Parameters:\n               *    (String) msg - The log message.\n               */\n              warn(msg) {\n                this.log(this.LogLevel.WARN, msg);\n              },\n\n              /** Function: error\n               *  Log a message at the Strophe.LogLevel.ERROR level.\n               *\n               *  Parameters:\n               *    (String) msg - The log message.\n               */\n              error(msg) {\n                this.log(this.LogLevel.ERROR, msg);\n              },\n\n              /** Function: fatal\n               *  Log a message at the Strophe.LogLevel.FATAL level.\n               *\n               *  Parameters:\n               *    (String) msg - The log message.\n               */\n              fatal(msg) {\n                this.log(this.LogLevel.FATAL, msg);\n              },\n\n              /** Function: serialize\n               *  Render a DOM element and all descendants to a String.\n               *\n               *  Parameters:\n               *    (XMLElement) elem - A DOM element.\n               *\n               *  Returns:\n               *    The serialized element tree as a String.\n               */\n              serialize(elem) {\n                if (!elem) {\n                  return null;\n                }\n\n                if (typeof elem.tree === \"function\") {\n                  elem = elem.tree();\n                }\n\n                const names = [...Array(elem.attributes.length).keys()].map(i => elem.attributes[i].nodeName);\n                names.sort();\n                let result = names.reduce((a, n) => `${a} ${n}=\"${Strophe.xmlescape(elem.attributes.getNamedItem(n).value)}\"`, `<${elem.nodeName}`);\n\n                if (elem.childNodes.length > 0) {\n                  result += \">\";\n\n                  for (let i = 0; i < elem.childNodes.length; i++) {\n                    const child = elem.childNodes[i];\n\n                    switch (child.nodeType) {\n                      case Strophe.ElementType.NORMAL:\n                        // normal element, so recurse\n                        result += Strophe.serialize(child);\n                        break;\n\n                      case Strophe.ElementType.TEXT:\n                        // text element to escape values\n                        result += Strophe.xmlescape(child.nodeValue);\n                        break;\n\n                      case Strophe.ElementType.CDATA:\n                        // cdata section so don't escape values\n                        result += \"<![CDATA[\" + child.nodeValue + \"]]>\";\n                    }\n                  }\n\n                  result += \"</\" + elem.nodeName + \">\";\n                } else {\n                  result += \"/>\";\n                }\n\n                return result;\n              },\n\n              /** PrivateVariable: _requestId\n               *  _Private_ variable that keeps track of the request ids for\n               *  connections.\n               */\n              _requestId: 0,\n\n              /** PrivateVariable: Strophe.connectionPlugins\n               *  _Private_ variable Used to store plugin names that need\n               *  initialization on Strophe.Connection construction.\n               */\n              _connectionPlugins: {},\n\n              /** Function: addConnectionPlugin\n               *  Extends the Strophe.Connection object with the given plugin.\n               *\n               *  Parameters:\n               *    (String) name - The name of the extension.\n               *    (Object) ptype - The plugin's prototype.\n               */\n              addConnectionPlugin(name, ptype) {\n                Strophe._connectionPlugins[name] = ptype;\n              }\n\n            };\n            /** Class: Strophe.Builder\n             *  XML DOM builder.\n             *\n             *  This object provides an interface similar to JQuery but for building\n             *  DOM elements easily and rapidly.  All the functions except for toString()\n             *  and tree() return the object, so calls can be chained.  Here's an\n             *  example using the $iq() builder helper.\n             *  > $iq({to: 'you', from: 'me', type: 'get', id: '1'})\n             *  >     .c('query', {xmlns: 'strophe:example'})\n             *  >     .c('example')\n             *  >     .toString()\n             *\n             *  The above generates this XML fragment\n             *  > <iq to='you' from='me' type='get' id='1'>\n             *  >   <query xmlns='strophe:example'>\n             *  >     <example/>\n             *  >   </query>\n             *  > </iq>\n             *  The corresponding DOM manipulations to get a similar fragment would be\n             *  a lot more tedious and probably involve several helper variables.\n             *\n             *  Since adding children makes new operations operate on the child, up()\n             *  is provided to traverse up the tree.  To add two children, do\n             *  > builder.c('child1', ...).up().c('child2', ...)\n             *  The next operation on the Builder will be relative to the second child.\n             */\n\n            /** Constructor: Strophe.Builder\n             *  Create a Strophe.Builder object.\n             *\n             *  The attributes should be passed in object notation.  For example\n             *  > let b = new Builder('message', {to: 'you', from: 'me'});\n             *  or\n             *  > let b = new Builder('messsage', {'xml:lang': 'en'});\n             *\n             *  Parameters:\n             *    (String) name - The name of the root element.\n             *    (Object) attrs - The attributes for the root element in object notation.\n             *\n             *  Returns:\n             *    A new Strophe.Builder.\n             */\n\n            Strophe.Builder = class Builder {\n              constructor(name, attrs) {\n                // Set correct namespace for jabber:client elements\n                if (name === \"presence\" || name === \"message\" || name === \"iq\") {\n                  if (attrs && !attrs.xmlns) {\n                    attrs.xmlns = Strophe.NS.CLIENT;\n                  } else if (!attrs) {\n                    attrs = {\n                      xmlns: Strophe.NS.CLIENT\n                    };\n                  }\n                } // Holds the tree being built.\n\n\n                this.nodeTree = Strophe.xmlElement(name, attrs); // Points to the current operation node.\n\n                this.node = this.nodeTree;\n              }\n              /** Function: tree\n               *  Return the DOM tree.\n               *\n               *  This function returns the current DOM tree as an element object.  This\n               *  is suitable for passing to functions like Strophe.Connection.send().\n               *\n               *  Returns:\n               *    The DOM tree as a element object.\n               */\n\n\n              tree() {\n                return this.nodeTree;\n              }\n              /** Function: toString\n               *  Serialize the DOM tree to a String.\n               *\n               *  This function returns a string serialization of the current DOM\n               *  tree.  It is often used internally to pass data to a\n               *  Strophe.Request object.\n               *\n               *  Returns:\n               *    The serialized DOM tree in a String.\n               */\n\n\n              toString() {\n                return Strophe.serialize(this.nodeTree);\n              }\n              /** Function: up\n               *  Make the current parent element the new current element.\n               *\n               *  This function is often used after c() to traverse back up the tree.\n               *  For example, to add two children to the same element\n               *  > builder.c('child1', {}).up().c('child2', {});\n               *\n               *  Returns:\n               *    The Stophe.Builder object.\n               */\n\n\n              up() {\n                this.node = this.node.parentNode;\n                return this;\n              }\n              /** Function: root\n               *  Make the root element the new current element.\n               *\n               *  When at a deeply nested element in the tree, this function can be used\n               *  to jump back to the root of the tree, instead of having to repeatedly\n               *  call up().\n               *\n               *  Returns:\n               *    The Stophe.Builder object.\n               */\n\n\n              root() {\n                this.node = this.nodeTree;\n                return this;\n              }\n              /** Function: attrs\n               *  Add or modify attributes of the current element.\n               *\n               *  The attributes should be passed in object notation.  This function\n               *  does not move the current element pointer.\n               *\n               *  Parameters:\n               *    (Object) moreattrs - The attributes to add/modify in object notation.\n               *\n               *  Returns:\n               *    The Strophe.Builder object.\n               */\n\n\n              attrs(moreattrs) {\n                for (const k in moreattrs) {\n                  if (Object.prototype.hasOwnProperty.call(moreattrs, k)) {\n                    if (moreattrs[k] === undefined) {\n                      this.node.removeAttribute(k);\n                    } else {\n                      this.node.setAttribute(k, moreattrs[k]);\n                    }\n                  }\n                }\n\n                return this;\n              }\n              /** Function: c\n               *  Add a child to the current element and make it the new current\n               *  element.\n               *\n               *  This function moves the current element pointer to the child,\n               *  unless text is provided.  If you need to add another child, it\n               *  is necessary to use up() to go back to the parent in the tree.\n               *\n               *  Parameters:\n               *    (String) name - The name of the child.\n               *    (Object) attrs - The attributes of the child in object notation.\n               *    (String) text - The text to add to the child.\n               *\n               *  Returns:\n               *    The Strophe.Builder object.\n               */\n\n\n              c(name, attrs, text) {\n                const child = Strophe.xmlElement(name, attrs, text);\n                this.node.appendChild(child);\n\n                if (typeof text !== \"string\" && typeof text !== \"number\") {\n                  this.node = child;\n                }\n\n                return this;\n              }\n              /** Function: cnode\n               *  Add a child to the current element and make it the new current\n               *  element.\n               *\n               *  This function is the same as c() except that instead of using a\n               *  name and an attributes object to create the child it uses an\n               *  existing DOM element object.\n               *\n               *  Parameters:\n               *    (XMLElement) elem - A DOM element.\n               *\n               *  Returns:\n               *    The Strophe.Builder object.\n               */\n\n\n              cnode(elem) {\n                let impNode;\n                const xmlGen = Strophe.xmlGenerator();\n\n                try {\n                  impNode = xmlGen.importNode !== undefined;\n                } catch (e) {\n                  impNode = false;\n                }\n\n                const newElem = impNode ? xmlGen.importNode(elem, true) : Strophe.copyElement(elem);\n                this.node.appendChild(newElem);\n                this.node = newElem;\n                return this;\n              }\n              /** Function: t\n               *  Add a child text element.\n               *\n               *  This *does not* make the child the new current element since there\n               *  are no children of text elements.\n               *\n               *  Parameters:\n               *    (String) text - The text data to append to the current element.\n               *\n               *  Returns:\n               *    The Strophe.Builder object.\n               */\n\n\n              t(text) {\n                const child = Strophe.xmlTextNode(text);\n                this.node.appendChild(child);\n                return this;\n              }\n              /** Function: h\n               *  Replace current element contents with the HTML passed in.\n               *\n               *  This *does not* make the child the new current element\n               *\n               *  Parameters:\n               *    (String) html - The html to insert as contents of current element.\n               *\n               *  Returns:\n               *    The Strophe.Builder object.\n               */\n\n\n              h(html) {\n                const fragment = Strophe.xmlGenerator().createElement('body'); // force the browser to try and fix any invalid HTML tags\n\n                fragment.innerHTML = html; // copy cleaned html into an xml dom\n\n                const xhtml = Strophe.createHtml(fragment);\n\n                while (xhtml.childNodes.length > 0) {\n                  this.node.appendChild(xhtml.childNodes[0]);\n                }\n\n                return this;\n              }\n\n            };\n            /** PrivateClass: Strophe.Handler\n             *  _Private_ helper class for managing stanza handlers.\n             *\n             *  A Strophe.Handler encapsulates a user provided callback function to be\n             *  executed when matching stanzas are received by the connection.\n             *  Handlers can be either one-off or persistant depending on their\n             *  return value. Returning true will cause a Handler to remain active, and\n             *  returning false will remove the Handler.\n             *\n             *  Users will not use Strophe.Handler objects directly, but instead they\n             *  will use Strophe.Connection.addHandler() and\n             *  Strophe.Connection.deleteHandler().\n             */\n\n            /** PrivateConstructor: Strophe.Handler\n             *  Create and initialize a new Strophe.Handler.\n             *\n             *  Parameters:\n             *    (Function) handler - A function to be executed when the handler is run.\n             *    (String) ns - The namespace to match.\n             *    (String) name - The element name to match.\n             *    (String) type - The element type to match.\n             *    (String) id - The element id attribute to match.\n             *    (String) from - The element from attribute to match.\n             *    (Object) options - Handler options\n             *\n             *  Returns:\n             *    A new Strophe.Handler object.\n             */\n\n            Strophe.Handler = function (handler, ns, name, type, id, from, options) {\n              this.handler = handler;\n              this.ns = ns;\n              this.name = name;\n              this.type = type;\n              this.id = id;\n              this.options = options || {\n                'matchBareFromJid': false,\n                'ignoreNamespaceFragment': false\n              }; // BBB: Maintain backward compatibility with old `matchBare` option\n\n              if (this.options.matchBare) {\n                Strophe.warn('The \"matchBare\" option is deprecated, use \"matchBareFromJid\" instead.');\n                this.options.matchBareFromJid = this.options.matchBare;\n                delete this.options.matchBare;\n              }\n\n              if (this.options.matchBareFromJid) {\n                this.from = from ? Strophe.getBareJidFromJid(from) : null;\n              } else {\n                this.from = from;\n              } // whether the handler is a user handler or a system handler\n\n\n              this.user = true;\n            };\n\n            Strophe.Handler.prototype = {\n              /** PrivateFunction: getNamespace\n               *  Returns the XML namespace attribute on an element.\n               *  If `ignoreNamespaceFragment` was passed in for this handler, then the\n               *  URL fragment will be stripped.\n               *\n               *  Parameters:\n               *    (XMLElement) elem - The XML element with the namespace.\n               *\n               *  Returns:\n               *    The namespace, with optionally the fragment stripped.\n               */\n              getNamespace(elem) {\n                let elNamespace = elem.getAttribute(\"xmlns\");\n\n                if (elNamespace && this.options.ignoreNamespaceFragment) {\n                  elNamespace = elNamespace.split('#')[0];\n                }\n\n                return elNamespace;\n              },\n\n              /** PrivateFunction: namespaceMatch\n               *  Tests if a stanza matches the namespace set for this Strophe.Handler.\n               *\n               *  Parameters:\n               *    (XMLElement) elem - The XML element to test.\n               *\n               *  Returns:\n               *    true if the stanza matches and false otherwise.\n               */\n              namespaceMatch(elem) {\n                let nsMatch = false;\n\n                if (!this.ns) {\n                  return true;\n                } else {\n                  Strophe.forEachChild(elem, null, elem => {\n                    if (this.getNamespace(elem) === this.ns) {\n                      nsMatch = true;\n                    }\n                  });\n                  return nsMatch || this.getNamespace(elem) === this.ns;\n                }\n              },\n\n              /** PrivateFunction: isMatch\n               *  Tests if a stanza matches the Strophe.Handler.\n               *\n               *  Parameters:\n               *    (XMLElement) elem - The XML element to test.\n               *\n               *  Returns:\n               *    true if the stanza matches and false otherwise.\n               */\n              isMatch(elem) {\n                let from = elem.getAttribute('from');\n\n                if (this.options.matchBareFromJid) {\n                  from = Strophe.getBareJidFromJid(from);\n                }\n\n                const elem_type = elem.getAttribute(\"type\");\n\n                if (this.namespaceMatch(elem) && (!this.name || Strophe.isTagEqual(elem, this.name)) && (!this.type || (Array.isArray(this.type) ? this.type.indexOf(elem_type) !== -1 : elem_type === this.type)) && (!this.id || elem.getAttribute(\"id\") === this.id) && (!this.from || from === this.from)) {\n                  return true;\n                }\n\n                return false;\n              },\n\n              /** PrivateFunction: run\n               *  Run the callback on a matching stanza.\n               *\n               *  Parameters:\n               *    (XMLElement) elem - The DOM element that triggered the\n               *      Strophe.Handler.\n               *\n               *  Returns:\n               *    A boolean indicating if the handler should remain active.\n               */\n              run(elem) {\n                let result = null;\n\n                try {\n                  result = this.handler(elem);\n                } catch (e) {\n                  Strophe._handleError(e);\n\n                  throw e;\n                }\n\n                return result;\n              },\n\n              /** PrivateFunction: toString\n               *  Get a String representation of the Strophe.Handler object.\n               *\n               *  Returns:\n               *    A String.\n               */\n              toString() {\n                return \"{Handler: \" + this.handler + \"(\" + this.name + \",\" + this.id + \",\" + this.ns + \")}\";\n              }\n\n            };\n            /** PrivateClass: Strophe.TimedHandler\n             *  _Private_ helper class for managing timed handlers.\n             *\n             *  A Strophe.TimedHandler encapsulates a user provided callback that\n             *  should be called after a certain period of time or at regular\n             *  intervals.  The return value of the callback determines whether the\n             *  Strophe.TimedHandler will continue to fire.\n             *\n             *  Users will not use Strophe.TimedHandler objects directly, but instead\n             *  they will use Strophe.Connection.addTimedHandler() and\n             *  Strophe.Connection.deleteTimedHandler().\n             */\n\n            Strophe.TimedHandler = class TimedHandler {\n              /** PrivateConstructor: Strophe.TimedHandler\n               *  Create and initialize a new Strophe.TimedHandler object.\n               *\n               *  Parameters:\n               *    (Integer) period - The number of milliseconds to wait before the\n               *      handler is called.\n               *    (Function) handler - The callback to run when the handler fires.  This\n               *      function should take no arguments.\n               *\n               *  Returns:\n               *    A new Strophe.TimedHandler object.\n               */\n              constructor(period, handler) {\n                this.period = period;\n                this.handler = handler;\n                this.lastCalled = new Date().getTime();\n                this.user = true;\n              }\n              /** PrivateFunction: run\n               *  Run the callback for the Strophe.TimedHandler.\n               *\n               *  Returns:\n               *    true if the Strophe.TimedHandler should be called again, and false\n               *      otherwise.\n               */\n\n\n              run() {\n                this.lastCalled = new Date().getTime();\n                return this.handler();\n              }\n              /** PrivateFunction: reset\n               *  Reset the last called time for the Strophe.TimedHandler.\n               */\n\n\n              reset() {\n                this.lastCalled = new Date().getTime();\n              }\n              /** PrivateFunction: toString\n               *  Get a string representation of the Strophe.TimedHandler object.\n               *\n               *  Returns:\n               *    The string representation.\n               */\n\n\n              toString() {\n                return \"{TimedHandler: \" + this.handler + \"(\" + this.period + \")}\";\n              }\n\n            };\n            /** Class: Strophe.Connection\n             *  XMPP Connection manager.\n             *\n             *  This class is the main part of Strophe.  It manages a BOSH or websocket\n             *  connection to an XMPP server and dispatches events to the user callbacks\n             *  as data arrives. It supports SASL PLAIN, SASL SCRAM-SHA-1\n             *  and legacy authentication.\n             *\n             *  After creating a Strophe.Connection object, the user will typically\n             *  call connect() with a user supplied callback to handle connection level\n             *  events like authentication failure, disconnection, or connection\n             *  complete.\n             *\n             *  The user will also have several event handlers defined by using\n             *  addHandler() and addTimedHandler().  These will allow the user code to\n             *  respond to interesting stanzas or do something periodically with the\n             *  connection. These handlers will be active once authentication is\n             *  finished.\n             *\n             *  To send data to the connection, use send().\n             */\n\n            /** Constructor: Strophe.Connection\n             *  Create and initialize a Strophe.Connection object.\n             *\n             *  The transport-protocol for this connection will be chosen automatically\n             *  based on the given service parameter. URLs starting with \"ws://\" or\n             *  \"wss://\" will use WebSockets, URLs starting with \"http://\", \"https://\"\n             *  or without a protocol will use BOSH.\n             *\n             *  To make Strophe connect to the current host you can leave out the protocol\n             *  and host part and just pass the path, e.g.\n             *\n             *  > let conn = new Strophe.Connection(\"/http-bind/\");\n             *\n             *  Options common to both Websocket and BOSH:\n             *  ------------------------------------------\n             *\n             *  cookies:\n             *\n             *  The *cookies* option allows you to pass in cookies to be added to the\n             *  document. These cookies will then be included in the BOSH XMLHttpRequest\n             *  or in the websocket connection.\n             *\n             *  The passed in value must be a map of cookie names and string values.\n             *\n             *  > { \"myCookie\": {\n             *  >     \"value\": \"1234\",\n             *  >     \"domain\": \".example.org\",\n             *  >     \"path\": \"/\",\n             *  >     \"expires\": expirationDate\n             *  >     }\n             *  > }\n             *\n             *  Note that cookies can't be set in this way for other domains (i.e. cross-domain).\n             *  Those cookies need to be set under those domains, for example they can be\n             *  set server-side by making a XHR call to that domain to ask it to set any\n             *  necessary cookies.\n             *\n             *  mechanisms:\n             *\n             *  The *mechanisms* option allows you to specify the SASL mechanisms that this\n             *  instance of Strophe.Connection (and therefore your XMPP client) will\n             *  support.\n             *\n             *  The value must be an array of objects with Strophe.SASLMechanism\n             *  prototypes.\n             *\n             *  If nothing is specified, then the following mechanisms (and their\n             *  priorities) are registered:\n             *\n             *      SCRAM-SHA-1 - 60\n             *      PLAIN       - 50\n             *      OAUTHBEARER - 40\n             *      X-OAUTH2    - 30\n             *      ANONYMOUS   - 20\n             *      EXTERNAL    - 10\n             *\n             *  explicitResourceBinding:\n             *\n             *  If `explicitResourceBinding` is set to a truthy value, then the XMPP client\n             *  needs to explicitly call `Strophe.Connection.prototype.bind` once the XMPP\n             *  server has advertised the \"urn:ietf:params:xml:ns:xmpp-bind\" feature.\n             *\n             *  Making this step explicit allows client authors to first finish other\n             *  stream related tasks, such as setting up an XEP-0198 Stream Management\n             *  session, before binding the JID resource for this session.\n             *\n             *  WebSocket options:\n             *  ------------------\n             *\n             *  protocol:\n             *\n             *  If you want to connect to the current host with a WebSocket connection you\n             *  can tell Strophe to use WebSockets through a \"protocol\" attribute in the\n             *  optional options parameter. Valid values are \"ws\" for WebSocket and \"wss\"\n             *  for Secure WebSocket.\n             *  So to connect to \"wss://CURRENT_HOSTNAME/xmpp-websocket\" you would call\n             *\n             *  > let conn = new Strophe.Connection(\"/xmpp-websocket/\", {protocol: \"wss\"});\n             *\n             *  Note that relative URLs _NOT_ starting with a \"/\" will also include the path\n             *  of the current site.\n             *\n             *  Also because downgrading security is not permitted by browsers, when using\n             *  relative URLs both BOSH and WebSocket connections will use their secure\n             *  variants if the current connection to the site is also secure (https).\n             *\n             *  worker:\n             *\n             *  Set this option to URL from where the shared worker script should be loaded.\n             *\n             *  To run the websocket connection inside a shared worker.\n             *  This allows you to share a single websocket-based connection between\n             *  multiple Strophe.Connection instances, for example one per browser tab.\n             *\n             *  The script to use is the one in `src/shared-connection-worker.js`.\n             *\n             *  BOSH options:\n             *  -------------\n             *\n             *  By adding \"sync\" to the options, you can control if requests will\n             *  be made synchronously or not. The default behaviour is asynchronous.\n             *  If you want to make requests synchronous, make \"sync\" evaluate to true.\n             *  > let conn = new Strophe.Connection(\"/http-bind/\", {sync: true});\n             *\n             *  You can also toggle this on an already established connection.\n             *  > conn.options.sync = true;\n             *\n             *  The *customHeaders* option can be used to provide custom HTTP headers to be\n             *  included in the XMLHttpRequests made.\n             *\n             *  The *keepalive* option can be used to instruct Strophe to maintain the\n             *  current BOSH session across interruptions such as webpage reloads.\n             *\n             *  It will do this by caching the sessions tokens in sessionStorage, and when\n             *  \"restore\" is called it will check whether there are cached tokens with\n             *  which it can resume an existing session.\n             *\n             *  The *withCredentials* option should receive a Boolean value and is used to\n             *  indicate wether cookies should be included in ajax requests (by default\n             *  they're not).\n             *  Set this value to true if you are connecting to a BOSH service\n             *  and for some reason need to send cookies to it.\n             *  In order for this to work cross-domain, the server must also enable\n             *  credentials by setting the Access-Control-Allow-Credentials response header\n             *  to \"true\". For most usecases however this setting should be false (which\n             *  is the default).\n             *  Additionally, when using Access-Control-Allow-Credentials, the\n             *  Access-Control-Allow-Origin header can't be set to the wildcard \"*\", but\n             *  instead must be restricted to actual domains.\n             *\n             *  The *contentType* option can be set to change the default Content-Type\n             *  of \"text/xml; charset=utf-8\", which can be useful to reduce the amount of\n             *  CORS preflight requests that are sent to the server.\n             *\n             *  Parameters:\n             *    (String) service - The BOSH or WebSocket service URL.\n             *    (Object) options - A hash of configuration options\n             *\n             *  Returns:\n             *    A new Strophe.Connection object.\n             */\n\n            Strophe.Connection = class Connection {\n              constructor(service, options) {\n                // The service URL\n                this.service = service; // Configuration options\n\n                this.options = options || {};\n                this.setProtocol();\n                /* The connected JID. */\n\n                this.jid = \"\";\n                /* the JIDs domain */\n\n                this.domain = null;\n                /* stream:features */\n\n                this.features = null; // SASL\n\n                this._sasl_data = {};\n                this.do_bind = false;\n                this.do_session = false;\n                this.mechanisms = {}; // handler lists\n\n                this.timedHandlers = [];\n                this.handlers = [];\n                this.removeTimeds = [];\n                this.removeHandlers = [];\n                this.addTimeds = [];\n                this.addHandlers = [];\n                this.protocolErrorHandlers = {\n                  'HTTP': {},\n                  'websocket': {}\n                };\n                this._idleTimeout = null;\n                this._disconnectTimeout = null;\n                this.authenticated = false;\n                this.connected = false;\n                this.disconnecting = false;\n                this.do_authentication = true;\n                this.paused = false;\n                this.restored = false;\n                this._data = [];\n                this._uniqueId = 0;\n                this._sasl_success_handler = null;\n                this._sasl_failure_handler = null;\n                this._sasl_challenge_handler = null; // Max retries before disconnecting\n\n                this.maxRetries = 5; // Call onIdle callback every 1/10th of a second\n\n                this._idleTimeout = setTimeout(() => this._onIdle(), 100);\n                utils.addCookies(this.options.cookies);\n                this.registerSASLMechanisms(this.options.mechanisms); // A client must always respond to incoming IQ \"set\" and \"get\" stanzas.\n                // See https://datatracker.ietf.org/doc/html/rfc6120#section-8.2.3\n                //\n                // This is a fallback handler which gets called when no other handler\n                // was called for a received IQ \"set\" or \"get\".\n\n                this.iqFallbackHandler = new Strophe.Handler(iq => this.send($iq({\n                  type: 'error',\n                  id: iq.getAttribute('id')\n                }).c('error', {\n                  'type': 'cancel'\n                }).c('service-unavailable', {\n                  'xmlns': Strophe.NS.STANZAS\n                })), null, 'iq', ['get', 'set']); // initialize plugins\n\n                for (const k in Strophe._connectionPlugins) {\n                  if (Object.prototype.hasOwnProperty.call(Strophe._connectionPlugins, k)) {\n                    const F = function () {};\n\n                    F.prototype = Strophe._connectionPlugins[k];\n                    this[k] = new F();\n                    this[k].init(this);\n                  }\n                }\n              }\n              /** Function: setProtocol\n               *  Select protocal based on this.options or this.service\n               */\n\n\n              setProtocol() {\n                const proto = this.options.protocol || \"\";\n\n                if (this.options.worker) {\n                  this._proto = new Strophe.WorkerWebsocket(this);\n                } else if (this.service.indexOf(\"ws:\") === 0 || this.service.indexOf(\"wss:\") === 0 || proto.indexOf(\"ws\") === 0) {\n                  this._proto = new Strophe.Websocket(this);\n                } else {\n                  this._proto = new Strophe.Bosh(this);\n                }\n              }\n              /** Function: reset\n               *  Reset the connection.\n               *\n               *  This function should be called after a connection is disconnected\n               *  before that connection is reused.\n               */\n\n\n              reset() {\n                this._proto._reset(); // SASL\n\n\n                this.do_session = false;\n                this.do_bind = false; // handler lists\n\n                this.timedHandlers = [];\n                this.handlers = [];\n                this.removeTimeds = [];\n                this.removeHandlers = [];\n                this.addTimeds = [];\n                this.addHandlers = [];\n                this.authenticated = false;\n                this.connected = false;\n                this.disconnecting = false;\n                this.restored = false;\n                this._data = [];\n                this._requests = [];\n                this._uniqueId = 0;\n              }\n              /** Function: pause\n               *  Pause the request manager.\n               *\n               *  This will prevent Strophe from sending any more requests to the\n               *  server.  This is very useful for temporarily pausing\n               *  BOSH-Connections while a lot of send() calls are happening quickly.\n               *  This causes Strophe to send the data in a single request, saving\n               *  many request trips.\n               */\n\n\n              pause() {\n                this.paused = true;\n              }\n              /** Function: resume\n               *  Resume the request manager.\n               *\n               *  This resumes after pause() has been called.\n               */\n\n\n              resume() {\n                this.paused = false;\n              }\n              /** Function: getUniqueId\n               *  Generate a unique ID for use in <iq/> elements.\n               *\n               *  All <iq/> stanzas are required to have unique id attributes.  This\n               *  function makes creating these easy.  Each connection instance has\n               *  a counter which starts from zero, and the value of this counter\n               *  plus a colon followed by the suffix becomes the unique id. If no\n               *  suffix is supplied, the counter is used as the unique id.\n               *\n               *  Suffixes are used to make debugging easier when reading the stream\n               *  data, and their use is recommended.  The counter resets to 0 for\n               *  every new connection for the same reason.  For connections to the\n               *  same server that authenticate the same way, all the ids should be\n               *  the same, which makes it easy to see changes.  This is useful for\n               *  automated testing as well.\n               *\n               *  Parameters:\n               *    (String) suffix - A optional suffix to append to the id.\n               *\n               *  Returns:\n               *    A unique string to be used for the id attribute.\n               */\n\n\n              getUniqueId(suffix) {\n                // eslint-disable-line class-methods-use-this\n                const uuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\n                  const r = Math.random() * 16 | 0,\n                        v = c === 'x' ? r : r & 0x3 | 0x8;\n                  return v.toString(16);\n                });\n\n                if (typeof suffix === \"string\" || typeof suffix === \"number\") {\n                  return uuid + \":\" + suffix;\n                } else {\n                  return uuid + \"\";\n                }\n              }\n              /** Function: addProtocolErrorHandler\n               *  Register a handler function for when a protocol (websocker or HTTP)\n               *  error occurs.\n               *\n               *  NOTE: Currently only HTTP errors for BOSH requests are handled.\n               *  Patches that handle websocket errors would be very welcome.\n               *\n               *  Parameters:\n               *    (String) protocol - 'HTTP' or 'websocket'\n               *    (Integer) status_code - Error status code (e.g 500, 400 or 404)\n               *    (Function) callback - Function that will fire on Http error\n               *\n               *  Example:\n               *  function onError(err_code){\n               *    //do stuff\n               *  }\n               *\n               *  let conn = Strophe.connect('http://example.com/http-bind');\n               *  conn.addProtocolErrorHandler('HTTP', 500, onError);\n               *  // Triggers HTTP 500 error and onError handler will be called\n               *  conn.connect('user_jid@incorrect_jabber_host', 'secret', onConnect);\n               */\n\n\n              addProtocolErrorHandler(protocol, status_code, callback) {\n                this.protocolErrorHandlers[protocol][status_code] = callback;\n              }\n              /** Function: connect\n               *  Starts the connection process.\n               *\n               *  As the connection process proceeds, the user supplied callback will\n               *  be triggered multiple times with status updates.  The callback\n               *  should take two arguments - the status code and the error condition.\n               *\n               *  The status code will be one of the values in the Strophe.Status\n               *  constants.  The error condition will be one of the conditions\n               *  defined in RFC 3920 or the condition 'strophe-parsererror'.\n               *\n               *  The Parameters _wait_, _hold_ and _route_ are optional and only relevant\n               *  for BOSH connections. Please see XEP 124 for a more detailed explanation\n               *  of the optional parameters.\n               *\n               *  Parameters:\n               *    (String) jid - The user's JID.  This may be a bare JID,\n               *      or a full JID.  If a node is not supplied, SASL OAUTHBEARER or\n               *      SASL ANONYMOUS authentication will be attempted (OAUTHBEARER will\n               *      process the provided password value as an access token).\n               *    (String) pass - The user's password.\n               *    (Function) callback - The connect callback function.\n               *    (Integer) wait - The optional HTTPBIND wait value.  This is the\n               *      time the server will wait before returning an empty result for\n               *      a request.  The default setting of 60 seconds is recommended.\n               *    (Integer) hold - The optional HTTPBIND hold value.  This is the\n               *      number of connections the server will hold at one time.  This\n               *      should almost always be set to 1 (the default).\n               *    (String) route - The optional route value.\n               *    (String) authcid - The optional alternative authentication identity\n               *      (username) if intending to impersonate another user.\n               *      When using the SASL-EXTERNAL authentication mechanism, for example\n               *      with client certificates, then the authcid value is used to\n               *      determine whether an authorization JID (authzid) should be sent to\n               *      the server. The authzid should NOT be sent to the server if the\n               *      authzid and authcid are the same. So to prevent it from being sent\n               *      (for example when the JID is already contained in the client\n               *      certificate), set authcid to that same JID. See XEP-178 for more\n               *      details.\n               *     (Integer) disconnection_timeout - The optional disconnection timeout\n               *      in milliseconds before _doDisconnect will be called.\n               */\n\n\n              connect(jid, pass, callback, wait, hold, route, authcid) {\n                let disconnection_timeout = arguments.length > 7 && arguments[7] !== undefined ? arguments[7] : 3000;\n                this.jid = jid;\n                /** Variable: authzid\n                 *  Authorization identity.\n                 */\n\n                this.authzid = Strophe.getBareJidFromJid(this.jid);\n                /** Variable: authcid\n                 *  Authentication identity (User name).\n                 */\n\n                this.authcid = authcid || Strophe.getNodeFromJid(this.jid);\n                /** Variable: pass\n                 *  Authentication identity (User password).\n                 */\n\n                this.pass = pass;\n                this.connect_callback = callback;\n                this.disconnecting = false;\n                this.connected = false;\n                this.authenticated = false;\n                this.restored = false;\n                this.disconnection_timeout = disconnection_timeout; // parse jid for domain\n\n                this.domain = Strophe.getDomainFromJid(this.jid);\n\n                this._changeConnectStatus(Strophe.Status.CONNECTING, null);\n\n                this._proto._connect(wait, hold, route);\n              }\n              /** Function: attach\n               *  Attach to an already created and authenticated BOSH session.\n               *\n               *  This function is provided to allow Strophe to attach to BOSH\n               *  sessions which have been created externally, perhaps by a Web\n               *  application.  This is often used to support auto-login type features\n               *  without putting user credentials into the page.\n               *\n               *  Parameters:\n               *    (String) jid - The full JID that is bound by the session.\n               *    (String) sid - The SID of the BOSH session.\n               *    (String) rid - The current RID of the BOSH session.  This RID\n               *      will be used by the next request.\n               *    (Function) callback The connect callback function.\n               *    (Integer) wait - The optional HTTPBIND wait value.  This is the\n               *      time the server will wait before returning an empty result for\n               *      a request.  The default setting of 60 seconds is recommended.\n               *      Other settings will require tweaks to the Strophe.TIMEOUT value.\n               *    (Integer) hold - The optional HTTPBIND hold value.  This is the\n               *      number of connections the server will hold at one time.  This\n               *      should almost always be set to 1 (the default).\n               *    (Integer) wind - The optional HTTBIND window value.  This is the\n               *      allowed range of request ids that are valid.  The default is 5.\n               */\n\n\n              attach(jid, sid, rid, callback, wait, hold, wind) {\n                if (this._proto._attach) {\n                  return this._proto._attach(jid, sid, rid, callback, wait, hold, wind);\n                } else {\n                  const error = new Error('The \"attach\" method is not available for your connection protocol');\n                  error.name = 'StropheSessionError';\n                  throw error;\n                }\n              }\n              /** Function: restore\n               *  Attempt to restore a cached BOSH session.\n               *\n               *  This function is only useful in conjunction with providing the\n               *  \"keepalive\":true option when instantiating a new Strophe.Connection.\n               *\n               *  When \"keepalive\" is set to true, Strophe will cache the BOSH tokens\n               *  RID (Request ID) and SID (Session ID) and then when this function is\n               *  called, it will attempt to restore the session from those cached\n               *  tokens.\n               *\n               *  This function must therefore be called instead of connect or attach.\n               *\n               *  For an example on how to use it, please see examples/restore.js\n               *\n               *  Parameters:\n               *    (String) jid - The user's JID.  This may be a bare JID or a full JID.\n               *    (Function) callback - The connect callback function.\n               *    (Integer) wait - The optional HTTPBIND wait value.  This is the\n               *      time the server will wait before returning an empty result for\n               *      a request.  The default setting of 60 seconds is recommended.\n               *    (Integer) hold - The optional HTTPBIND hold value.  This is the\n               *      number of connections the server will hold at one time.  This\n               *      should almost always be set to 1 (the default).\n               *    (Integer) wind - The optional HTTBIND window value.  This is the\n               *      allowed range of request ids that are valid.  The default is 5.\n               */\n\n\n              restore(jid, callback, wait, hold, wind) {\n                if (this._sessionCachingSupported()) {\n                  this._proto._restore(jid, callback, wait, hold, wind);\n                } else {\n                  const error = new Error('The \"restore\" method can only be used with a BOSH connection.');\n                  error.name = 'StropheSessionError';\n                  throw error;\n                }\n              }\n              /** PrivateFunction: _sessionCachingSupported\n               * Checks whether sessionStorage and JSON are supported and whether we're\n               * using BOSH.\n               */\n\n\n              _sessionCachingSupported() {\n                if (this._proto instanceof Strophe.Bosh) {\n                  if (!JSON) {\n                    return false;\n                  }\n\n                  try {\n                    sessionStorage.setItem('_strophe_', '_strophe_');\n                    sessionStorage.removeItem('_strophe_');\n                  } catch (e) {\n                    return false;\n                  }\n\n                  return true;\n                }\n\n                return false;\n              }\n              /** Function: xmlInput\n               *  User overrideable function that receives XML data coming into the\n               *  connection.\n               *\n               *  The default function does nothing.  User code can override this with\n               *  > Strophe.Connection.xmlInput = function (elem) {\n               *  >   (user code)\n               *  > };\n               *\n               *  Due to limitations of current Browsers' XML-Parsers the opening and closing\n               *  <stream> tag for WebSocket-Connoctions will be passed as selfclosing here.\n               *\n               *  BOSH-Connections will have all stanzas wrapped in a <body> tag. See\n               *  <Strophe.Bosh.strip> if you want to strip this tag.\n               *\n               *  Parameters:\n               *    (XMLElement) elem - The XML data received by the connection.\n               */\n\n\n              xmlInput(elem) {\n                // eslint-disable-line\n                return;\n              }\n              /** Function: xmlOutput\n               *  User overrideable function that receives XML data sent to the\n               *  connection.\n               *\n               *  The default function does nothing.  User code can override this with\n               *  > Strophe.Connection.xmlOutput = function (elem) {\n               *  >   (user code)\n               *  > };\n               *\n               *  Due to limitations of current Browsers' XML-Parsers the opening and closing\n               *  <stream> tag for WebSocket-Connoctions will be passed as selfclosing here.\n               *\n               *  BOSH-Connections will have all stanzas wrapped in a <body> tag. See\n               *  <Strophe.Bosh.strip> if you want to strip this tag.\n               *\n               *  Parameters:\n               *    (XMLElement) elem - The XMLdata sent by the connection.\n               */\n\n\n              xmlOutput(elem) {\n                // eslint-disable-line\n                return;\n              }\n              /** Function: rawInput\n               *  User overrideable function that receives raw data coming into the\n               *  connection.\n               *\n               *  The default function does nothing.  User code can override this with\n               *  > Strophe.Connection.rawInput = function (data) {\n               *  >   (user code)\n               *  > };\n               *\n               *  Parameters:\n               *    (String) data - The data received by the connection.\n               */\n\n\n              rawInput(data) {\n                // eslint-disable-line\n                return;\n              }\n              /** Function: rawOutput\n               *  User overrideable function that receives raw data sent to the\n               *  connection.\n               *\n               *  The default function does nothing.  User code can override this with\n               *  > Strophe.Connection.rawOutput = function (data) {\n               *  >   (user code)\n               *  > };\n               *\n               *  Parameters:\n               *    (String) data - The data sent by the connection.\n               */\n\n\n              rawOutput(data) {\n                // eslint-disable-line\n                return;\n              }\n              /** Function: nextValidRid\n               *  User overrideable function that receives the new valid rid.\n               *\n               *  The default function does nothing. User code can override this with\n               *  > Strophe.Connection.nextValidRid = function (rid) {\n               *  >    (user code)\n               *  > };\n               *\n               *  Parameters:\n               *    (Number) rid - The next valid rid\n               */\n\n\n              nextValidRid(rid) {\n                // eslint-disable-line\n                return;\n              }\n              /** Function: send\n               *  Send a stanza.\n               *\n               *  This function is called to push data onto the send queue to\n               *  go out over the wire.  Whenever a request is sent to the BOSH\n               *  server, all pending data is sent and the queue is flushed.\n               *\n               *  Parameters:\n               *    (XMLElement |\n               *     [XMLElement] |\n               *     Strophe.Builder) elem - The stanza to send.\n               */\n\n\n              send(elem) {\n                if (elem === null) {\n                  return;\n                }\n\n                if (typeof elem.sort === \"function\") {\n                  for (let i = 0; i < elem.length; i++) {\n                    this._queueData(elem[i]);\n                  }\n                } else if (typeof elem.tree === \"function\") {\n                  this._queueData(elem.tree());\n                } else {\n                  this._queueData(elem);\n                }\n\n                this._proto._send();\n              }\n              /** Function: flush\n               *  Immediately send any pending outgoing data.\n               *\n               *  Normally send() queues outgoing data until the next idle period\n               *  (100ms), which optimizes network use in the common cases when\n               *  several send()s are called in succession. flush() can be used to\n               *  immediately send all pending data.\n               */\n\n\n              flush() {\n                // cancel the pending idle period and run the idle function\n                // immediately\n                clearTimeout(this._idleTimeout);\n\n                this._onIdle();\n              }\n              /** Function: sendPresence\n               *  Helper function to send presence stanzas. The main benefit is for\n               *  sending presence stanzas for which you expect a responding presence\n               *  stanza with the same id (for example when leaving a chat room).\n               *\n               *  Parameters:\n               *    (XMLElement) elem - The stanza to send.\n               *    (Function) callback - The callback function for a successful request.\n               *    (Function) errback - The callback function for a failed or timed\n               *      out request.  On timeout, the stanza will be null.\n               *    (Integer) timeout - The time specified in milliseconds for a\n               *      timeout to occur.\n               *\n               *  Returns:\n               *    The id used to send the presence.\n               */\n\n\n              sendPresence(elem, callback, errback, timeout) {\n                let timeoutHandler = null;\n\n                if (typeof elem.tree === \"function\") {\n                  elem = elem.tree();\n                }\n\n                let id = elem.getAttribute('id');\n\n                if (!id) {\n                  // inject id if not found\n                  id = this.getUniqueId(\"sendPresence\");\n                  elem.setAttribute(\"id\", id);\n                }\n\n                if (typeof callback === \"function\" || typeof errback === \"function\") {\n                  const handler = this.addHandler(stanza => {\n                    // remove timeout handler if there is one\n                    if (timeoutHandler) {\n                      this.deleteTimedHandler(timeoutHandler);\n                    }\n\n                    if (stanza.getAttribute('type') === 'error') {\n                      if (errback) {\n                        errback(stanza);\n                      }\n                    } else if (callback) {\n                      callback(stanza);\n                    }\n                  }, null, 'presence', null, id); // if timeout specified, set up a timeout handler.\n\n                  if (timeout) {\n                    timeoutHandler = this.addTimedHandler(timeout, () => {\n                      // get rid of normal handler\n                      this.deleteHandler(handler); // call errback on timeout with null stanza\n\n                      if (errback) {\n                        errback(null);\n                      }\n\n                      return false;\n                    });\n                  }\n                }\n\n                this.send(elem);\n                return id;\n              }\n              /** Function: sendIQ\n               *  Helper function to send IQ stanzas.\n               *\n               *  Parameters:\n               *    (XMLElement) elem - The stanza to send.\n               *    (Function) callback - The callback function for a successful request.\n               *    (Function) errback - The callback function for a failed or timed\n               *      out request.  On timeout, the stanza will be null.\n               *    (Integer) timeout - The time specified in milliseconds for a\n               *      timeout to occur.\n               *\n               *  Returns:\n               *    The id used to send the IQ.\n              */\n\n\n              sendIQ(elem, callback, errback, timeout) {\n                let timeoutHandler = null;\n\n                if (typeof elem.tree === \"function\") {\n                  elem = elem.tree();\n                }\n\n                let id = elem.getAttribute('id');\n\n                if (!id) {\n                  // inject id if not found\n                  id = this.getUniqueId(\"sendIQ\");\n                  elem.setAttribute(\"id\", id);\n                }\n\n                if (typeof callback === \"function\" || typeof errback === \"function\") {\n                  const handler = this.addHandler(stanza => {\n                    // remove timeout handler if there is one\n                    if (timeoutHandler) {\n                      this.deleteTimedHandler(timeoutHandler);\n                    }\n\n                    const iqtype = stanza.getAttribute('type');\n\n                    if (iqtype === 'result') {\n                      if (callback) {\n                        callback(stanza);\n                      }\n                    } else if (iqtype === 'error') {\n                      if (errback) {\n                        errback(stanza);\n                      }\n                    } else {\n                      const error = new Error(`Got bad IQ type of ${iqtype}`);\n                      error.name = \"StropheError\";\n                      throw error;\n                    }\n                  }, null, 'iq', ['error', 'result'], id); // if timeout specified, set up a timeout handler.\n\n                  if (timeout) {\n                    timeoutHandler = this.addTimedHandler(timeout, () => {\n                      // get rid of normal handler\n                      this.deleteHandler(handler); // call errback on timeout with null stanza\n\n                      if (errback) {\n                        errback(null);\n                      }\n\n                      return false;\n                    });\n                  }\n                }\n\n                this.send(elem);\n                return id;\n              }\n              /** PrivateFunction: _queueData\n               *  Queue outgoing data for later sending.  Also ensures that the data\n               *  is a DOMElement.\n               */\n\n\n              _queueData(element) {\n                if (element === null || !element.tagName || !element.childNodes) {\n                  const error = new Error(\"Cannot queue non-DOMElement.\");\n                  error.name = \"StropheError\";\n                  throw error;\n                }\n\n                this._data.push(element);\n              }\n              /** PrivateFunction: _sendRestart\n               *  Send an xmpp:restart stanza.\n               */\n\n\n              _sendRestart() {\n                this._data.push(\"restart\");\n\n                this._proto._sendRestart();\n\n                this._idleTimeout = setTimeout(() => this._onIdle(), 100);\n              }\n              /** Function: addTimedHandler\n               *  Add a timed handler to the connection.\n               *\n               *  This function adds a timed handler.  The provided handler will\n               *  be called every period milliseconds until it returns false,\n               *  the connection is terminated, or the handler is removed.  Handlers\n               *  that wish to continue being invoked should return true.\n               *\n               *  Because of method binding it is necessary to save the result of\n               *  this function if you wish to remove a handler with\n               *  deleteTimedHandler().\n               *\n               *  Note that user handlers are not active until authentication is\n               *  successful.\n               *\n               *  Parameters:\n               *    (Integer) period - The period of the handler.\n               *    (Function) handler - The callback function.\n               *\n               *  Returns:\n               *    A reference to the handler that can be used to remove it.\n               */\n\n\n              addTimedHandler(period, handler) {\n                const thand = new Strophe.TimedHandler(period, handler);\n                this.addTimeds.push(thand);\n                return thand;\n              }\n              /** Function: deleteTimedHandler\n               *  Delete a timed handler for a connection.\n               *\n               *  This function removes a timed handler from the connection.  The\n               *  handRef parameter is *not* the function passed to addTimedHandler(),\n               *  but is the reference returned from addTimedHandler().\n               *\n               *  Parameters:\n               *    (Strophe.TimedHandler) handRef - The handler reference.\n               */\n\n\n              deleteTimedHandler(handRef) {\n                // this must be done in the Idle loop so that we don't change\n                // the handlers during iteration\n                this.removeTimeds.push(handRef);\n              }\n              /** Function: addHandler\n               *  Add a stanza handler for the connection.\n               *\n               *  This function adds a stanza handler to the connection.  The\n               *  handler callback will be called for any stanza that matches\n               *  the parameters.  Note that if multiple parameters are supplied,\n               *  they must all match for the handler to be invoked.\n               *\n               *  The handler will receive the stanza that triggered it as its argument.\n               *  *The handler should return true if it is to be invoked again;\n               *  returning false will remove the handler after it returns.*\n               *\n               *  As a convenience, the ns parameters applies to the top level element\n               *  and also any of its immediate children.  This is primarily to make\n               *  matching /iq/query elements easy.\n               *\n               *  Options\n               *  ~~~~~~~\n               *  With the options argument, you can specify boolean flags that affect how\n               *  matches are being done.\n               *\n               *  Currently two flags exist:\n               *\n               *  - matchBareFromJid:\n               *      When set to true, the from parameter and the\n               *      from attribute on the stanza will be matched as bare JIDs instead\n               *      of full JIDs. To use this, pass {matchBareFromJid: true} as the\n               *      value of options. The default value for matchBareFromJid is false.\n               *\n               *  - ignoreNamespaceFragment:\n               *      When set to true, a fragment specified on the stanza's namespace\n               *      URL will be ignored when it's matched with the one configured for\n               *      the handler.\n               *\n               *      This means that if you register like this:\n               *      >   connection.addHandler(\n               *      >       handler,\n               *      >       'http://jabber.org/protocol/muc',\n               *      >       null, null, null, null,\n               *      >       {'ignoreNamespaceFragment': true}\n               *      >   );\n               *\n               *      Then a stanza with XML namespace of\n               *      'http://jabber.org/protocol/muc#user' will also be matched. If\n               *      'ignoreNamespaceFragment' is false, then only stanzas with\n               *      'http://jabber.org/protocol/muc' will be matched.\n               *\n               *  Deleting the handler\n               *  ~~~~~~~~~~~~~~~~~~~~\n               *  The return value should be saved if you wish to remove the handler\n               *  with deleteHandler().\n               *\n               *  Parameters:\n               *    (Function) handler - The user callback.\n               *    (String) ns - The namespace to match.\n               *    (String) name - The stanza name to match.\n               *    (String|Array) type - The stanza type (or types if an array) to match.\n               *    (String) id - The stanza id attribute to match.\n               *    (String) from - The stanza from attribute to match.\n               *    (String) options - The handler options\n               *\n               *  Returns:\n               *    A reference to the handler that can be used to remove it.\n               */\n\n\n              addHandler(handler, ns, name, type, id, from, options) {\n                const hand = new Strophe.Handler(handler, ns, name, type, id, from, options);\n                this.addHandlers.push(hand);\n                return hand;\n              }\n              /** Function: deleteHandler\n               *  Delete a stanza handler for a connection.\n               *\n               *  This function removes a stanza handler from the connection.  The\n               *  handRef parameter is *not* the function passed to addHandler(),\n               *  but is the reference returned from addHandler().\n               *\n               *  Parameters:\n               *    (Strophe.Handler) handRef - The handler reference.\n               */\n\n\n              deleteHandler(handRef) {\n                // this must be done in the Idle loop so that we don't change\n                // the handlers during iteration\n                this.removeHandlers.push(handRef); // If a handler is being deleted while it is being added,\n                // prevent it from getting added\n\n                const i = this.addHandlers.indexOf(handRef);\n\n                if (i >= 0) {\n                  this.addHandlers.splice(i, 1);\n                }\n              }\n              /** Function: registerSASLMechanisms\n               *\n               * Register the SASL mechanisms which will be supported by this instance of\n               * Strophe.Connection (i.e. which this XMPP client will support).\n               *\n               *  Parameters:\n               *    (Array) mechanisms - Array of objects with Strophe.SASLMechanism prototypes\n               *\n               */\n\n\n              registerSASLMechanisms(mechanisms) {\n                this.mechanisms = {};\n                mechanisms = mechanisms || [Strophe.SASLAnonymous, Strophe.SASLExternal, Strophe.SASLOAuthBearer, Strophe.SASLXOAuth2, Strophe.SASLPlain, Strophe.SASLSHA1];\n                mechanisms.forEach(m => this.registerSASLMechanism(m));\n              }\n              /** Function: registerSASLMechanism\n               *\n               * Register a single SASL mechanism, to be supported by this client.\n               *\n               *  Parameters:\n               *    (Object) mechanism - Object with a Strophe.SASLMechanism prototype\n               *\n               */\n\n\n              registerSASLMechanism(Mechanism) {\n                const mechanism = new Mechanism();\n                this.mechanisms[mechanism.mechname] = mechanism;\n              }\n              /** Function: disconnect\n               *  Start the graceful disconnection process.\n               *\n               *  This function starts the disconnection process.  This process starts\n               *  by sending unavailable presence and sending BOSH body of type\n               *  terminate.  A timeout handler makes sure that disconnection happens\n               *  even if the BOSH server does not respond.\n               *  If the Connection object isn't connected, at least tries to abort all pending requests\n               *  so the connection object won't generate successful requests (which were already opened).\n               *\n               *  The user supplied connection callback will be notified of the\n               *  progress as this process happens.\n               *\n               *  Parameters:\n               *    (String) reason - The reason the disconnect is occuring.\n               */\n\n\n              disconnect(reason) {\n                this._changeConnectStatus(Strophe.Status.DISCONNECTING, reason);\n\n                if (reason) {\n                  Strophe.warn(\"Disconnect was called because: \" + reason);\n                } else {\n                  Strophe.info(\"Disconnect was called\");\n                }\n\n                if (this.connected) {\n                  let pres = false;\n                  this.disconnecting = true;\n\n                  if (this.authenticated) {\n                    pres = $pres({\n                      'xmlns': Strophe.NS.CLIENT,\n                      'type': 'unavailable'\n                    });\n                  } // setup timeout handler\n\n\n                  this._disconnectTimeout = this._addSysTimedHandler(this.disconnection_timeout, this._onDisconnectTimeout.bind(this));\n\n                  this._proto._disconnect(pres);\n                } else {\n                  Strophe.warn(\"Disconnect was called before Strophe connected to the server\");\n\n                  this._proto._abortAllRequests();\n\n                  this._doDisconnect();\n                }\n              }\n              /** PrivateFunction: _changeConnectStatus\n               *  _Private_ helper function that makes sure plugins and the user's\n               *  callback are notified of connection status changes.\n               *\n               *  Parameters:\n               *    (Integer) status - the new connection status, one of the values\n               *      in Strophe.Status\n               *    (String) condition - the error condition or null\n               *    (XMLElement) elem - The triggering stanza.\n               */\n\n\n              _changeConnectStatus(status, condition, elem) {\n                // notify all plugins listening for status changes\n                for (const k in Strophe._connectionPlugins) {\n                  if (Object.prototype.hasOwnProperty.call(Strophe._connectionPlugins, k)) {\n                    const plugin = this[k];\n\n                    if (plugin.statusChanged) {\n                      try {\n                        plugin.statusChanged(status, condition);\n                      } catch (err) {\n                        Strophe.error(`${k} plugin caused an exception changing status: ${err}`);\n                      }\n                    }\n                  }\n                } // notify the user's callback\n\n\n                if (this.connect_callback) {\n                  try {\n                    this.connect_callback(status, condition, elem);\n                  } catch (e) {\n                    Strophe._handleError(e);\n\n                    Strophe.error(`User connection callback caused an exception: ${e}`);\n                  }\n                }\n              }\n              /** PrivateFunction: _doDisconnect\n               *  _Private_ function to disconnect.\n               *\n               *  This is the last piece of the disconnection logic.  This resets the\n               *  connection and alerts the user's connection callback.\n               */\n\n\n              _doDisconnect(condition) {\n                if (typeof this._idleTimeout === \"number\") {\n                  clearTimeout(this._idleTimeout);\n                } // Cancel Disconnect Timeout\n\n\n                if (this._disconnectTimeout !== null) {\n                  this.deleteTimedHandler(this._disconnectTimeout);\n                  this._disconnectTimeout = null;\n                }\n\n                Strophe.debug(\"_doDisconnect was called\");\n\n                this._proto._doDisconnect();\n\n                this.authenticated = false;\n                this.disconnecting = false;\n                this.restored = false; // delete handlers\n\n                this.handlers = [];\n                this.timedHandlers = [];\n                this.removeTimeds = [];\n                this.removeHandlers = [];\n                this.addTimeds = [];\n                this.addHandlers = []; // tell the parent we disconnected\n\n                this._changeConnectStatus(Strophe.Status.DISCONNECTED, condition);\n\n                this.connected = false;\n              }\n              /** PrivateFunction: _dataRecv\n               *  _Private_ handler to processes incoming data from the the connection.\n               *\n               *  Except for _connect_cb handling the initial connection request,\n               *  this function handles the incoming data for all requests.  This\n               *  function also fires stanza handlers that match each incoming\n               *  stanza.\n               *\n               *  Parameters:\n               *    (Strophe.Request) req - The request that has data ready.\n               *    (string) req - The stanza a raw string (optiona).\n               */\n\n\n              _dataRecv(req, raw) {\n                const elem = this._proto._reqToData(req);\n\n                if (elem === null) {\n                  return;\n                }\n\n                if (this.xmlInput !== Strophe.Connection.prototype.xmlInput) {\n                  if (elem.nodeName === this._proto.strip && elem.childNodes.length) {\n                    this.xmlInput(elem.childNodes[0]);\n                  } else {\n                    this.xmlInput(elem);\n                  }\n                }\n\n                if (this.rawInput !== Strophe.Connection.prototype.rawInput) {\n                  if (raw) {\n                    this.rawInput(raw);\n                  } else {\n                    this.rawInput(Strophe.serialize(elem));\n                  }\n                } // remove handlers scheduled for deletion\n\n\n                while (this.removeHandlers.length > 0) {\n                  const hand = this.removeHandlers.pop();\n                  const i = this.handlers.indexOf(hand);\n\n                  if (i >= 0) {\n                    this.handlers.splice(i, 1);\n                  }\n                } // add handlers scheduled for addition\n\n\n                while (this.addHandlers.length > 0) {\n                  this.handlers.push(this.addHandlers.pop());\n                } // handle graceful disconnect\n\n\n                if (this.disconnecting && this._proto._emptyQueue()) {\n                  this._doDisconnect();\n\n                  return;\n                }\n\n                const type = elem.getAttribute(\"type\");\n\n                if (type !== null && type === \"terminate\") {\n                  // Don't process stanzas that come in after disconnect\n                  if (this.disconnecting) {\n                    return;\n                  } // an error occurred\n\n\n                  let cond = elem.getAttribute(\"condition\");\n                  const conflict = elem.getElementsByTagName(\"conflict\");\n\n                  if (cond !== null) {\n                    if (cond === \"remote-stream-error\" && conflict.length > 0) {\n                      cond = \"conflict\";\n                    }\n\n                    this._changeConnectStatus(Strophe.Status.CONNFAIL, cond);\n                  } else {\n                    this._changeConnectStatus(Strophe.Status.CONNFAIL, Strophe.ErrorCondition.UNKOWN_REASON);\n                  }\n\n                  this._doDisconnect(cond);\n\n                  return;\n                } // send each incoming stanza through the handler chain\n\n\n                Strophe.forEachChild(elem, null, child => {\n                  const matches = [];\n                  this.handlers = this.handlers.reduce((handlers, handler) => {\n                    try {\n                      if (handler.isMatch(child) && (this.authenticated || !handler.user)) {\n                        if (handler.run(child)) {\n                          handlers.push(handler);\n                        }\n\n                        matches.push(handler);\n                      } else {\n                        handlers.push(handler);\n                      }\n                    } catch (e) {\n                      // if the handler throws an exception, we consider it as false\n                      Strophe.warn('Removing Strophe handlers due to uncaught exception: ' + e.message);\n                    }\n\n                    return handlers;\n                  }, []); // If no handler was fired for an incoming IQ with type=\"set\",\n                  // then we return an IQ error stanza with service-unavailable.\n\n                  if (!matches.length && this.iqFallbackHandler.isMatch(child)) {\n                    this.iqFallbackHandler.run(child);\n                  }\n                });\n              }\n              /** PrivateFunction: _connect_cb\n               *  _Private_ handler for initial connection request.\n               *\n               *  This handler is used to process the initial connection request\n               *  response from the BOSH server. It is used to set up authentication\n               *  handlers and start the authentication process.\n               *\n               *  SASL authentication will be attempted if available, otherwise\n               *  the code will fall back to legacy authentication.\n               *\n               *  Parameters:\n               *    (Strophe.Request) req - The current request.\n               *    (Function) _callback - low level (xmpp) connect callback function.\n               *      Useful for plugins with their own xmpp connect callback (when they\n               *      want to do something special).\n               */\n\n\n              _connect_cb(req, _callback, raw) {\n                Strophe.debug(\"_connect_cb was called\");\n                this.connected = true;\n                let bodyWrap;\n\n                try {\n                  bodyWrap = this._proto._reqToData(req);\n                } catch (e) {\n                  if (e.name !== Strophe.ErrorCondition.BAD_FORMAT) {\n                    throw e;\n                  }\n\n                  this._changeConnectStatus(Strophe.Status.CONNFAIL, Strophe.ErrorCondition.BAD_FORMAT);\n\n                  this._doDisconnect(Strophe.ErrorCondition.BAD_FORMAT);\n                }\n\n                if (!bodyWrap) {\n                  return;\n                }\n\n                if (this.xmlInput !== Strophe.Connection.prototype.xmlInput) {\n                  if (bodyWrap.nodeName === this._proto.strip && bodyWrap.childNodes.length) {\n                    this.xmlInput(bodyWrap.childNodes[0]);\n                  } else {\n                    this.xmlInput(bodyWrap);\n                  }\n                }\n\n                if (this.rawInput !== Strophe.Connection.prototype.rawInput) {\n                  if (raw) {\n                    this.rawInput(raw);\n                  } else {\n                    this.rawInput(Strophe.serialize(bodyWrap));\n                  }\n                }\n\n                const conncheck = this._proto._connect_cb(bodyWrap);\n\n                if (conncheck === Strophe.Status.CONNFAIL) {\n                  return;\n                } // Check for the stream:features tag\n\n\n                let hasFeatures;\n\n                if (bodyWrap.getElementsByTagNameNS) {\n                  hasFeatures = bodyWrap.getElementsByTagNameNS(Strophe.NS.STREAM, \"features\").length > 0;\n                } else {\n                  hasFeatures = bodyWrap.getElementsByTagName(\"stream:features\").length > 0 || bodyWrap.getElementsByTagName(\"features\").length > 0;\n                }\n\n                if (!hasFeatures) {\n                  this._proto._no_auth_received(_callback);\n\n                  return;\n                }\n\n                const matched = Array.from(bodyWrap.getElementsByTagName(\"mechanism\")).map(m => this.mechanisms[m.textContent]).filter(m => m);\n\n                if (matched.length === 0) {\n                  if (bodyWrap.getElementsByTagName(\"auth\").length === 0) {\n                    // There are no matching SASL mechanisms and also no legacy\n                    // auth available.\n                    this._proto._no_auth_received(_callback);\n\n                    return;\n                  }\n                }\n\n                if (this.do_authentication !== false) {\n                  this.authenticate(matched);\n                }\n              }\n              /** Function: sortMechanismsByPriority\n               *\n               *  Sorts an array of objects with prototype SASLMechanism according to\n               *  their priorities.\n               *\n               *  Parameters:\n               *    (Array) mechanisms - Array of SASL mechanisms.\n               *\n               */\n\n\n              sortMechanismsByPriority(mechanisms) {\n                // eslint-disable-line class-methods-use-this\n                // Sorting mechanisms according to priority.\n                for (let i = 0; i < mechanisms.length - 1; ++i) {\n                  let higher = i;\n\n                  for (let j = i + 1; j < mechanisms.length; ++j) {\n                    if (mechanisms[j].priority > mechanisms[higher].priority) {\n                      higher = j;\n                    }\n                  }\n\n                  if (higher !== i) {\n                    const swap = mechanisms[i];\n                    mechanisms[i] = mechanisms[higher];\n                    mechanisms[higher] = swap;\n                  }\n                }\n\n                return mechanisms;\n              }\n              /** Function: authenticate\n               * Set up authentication\n               *\n               *  Continues the initial connection request by setting up authentication\n               *  handlers and starting the authentication process.\n               *\n               *  SASL authentication will be attempted if available, otherwise\n               *  the code will fall back to legacy authentication.\n               *\n               *  Parameters:\n               *    (Array) matched - Array of SASL mechanisms supported.\n               *\n               */\n\n\n              authenticate(matched) {\n                if (!this._attemptSASLAuth(matched)) {\n                  this._attemptLegacyAuth();\n                }\n              }\n              /** PrivateFunction: _attemptSASLAuth\n               *\n               *  Iterate through an array of SASL mechanisms and attempt authentication\n               *  with the highest priority (enabled) mechanism.\n               *\n               *  Parameters:\n               *    (Array) mechanisms - Array of SASL mechanisms.\n               *\n               *  Returns:\n               *    (Boolean) mechanism_found - true or false, depending on whether a\n               *          valid SASL mechanism was found with which authentication could be\n               *          started.\n               */\n\n\n              _attemptSASLAuth(mechanisms) {\n                mechanisms = this.sortMechanismsByPriority(mechanisms || []);\n                let mechanism_found = false;\n\n                for (let i = 0; i < mechanisms.length; ++i) {\n                  if (!mechanisms[i].test(this)) {\n                    continue;\n                  }\n\n                  this._sasl_success_handler = this._addSysHandler(this._sasl_success_cb.bind(this), null, \"success\", null, null);\n                  this._sasl_failure_handler = this._addSysHandler(this._sasl_failure_cb.bind(this), null, \"failure\", null, null);\n                  this._sasl_challenge_handler = this._addSysHandler(this._sasl_challenge_cb.bind(this), null, \"challenge\", null, null);\n                  this._sasl_mechanism = mechanisms[i];\n\n                  this._sasl_mechanism.onStart(this);\n\n                  const request_auth_exchange = $build(\"auth\", {\n                    'xmlns': Strophe.NS.SASL,\n                    'mechanism': this._sasl_mechanism.mechname\n                  });\n\n                  if (this._sasl_mechanism.isClientFirst) {\n                    const response = this._sasl_mechanism.clientChallenge(this);\n\n                    request_auth_exchange.t(btoa(response));\n                  }\n\n                  this.send(request_auth_exchange.tree());\n                  mechanism_found = true;\n                  break;\n                }\n\n                return mechanism_found;\n              }\n              /** PrivateFunction: _sasl_challenge_cb\n               *  _Private_ handler for the SASL challenge\n               *\n               */\n\n\n              _sasl_challenge_cb(elem) {\n                const challenge = atob(Strophe.getText(elem));\n\n                const response = this._sasl_mechanism.onChallenge(this, challenge);\n\n                const stanza = $build('response', {\n                  'xmlns': Strophe.NS.SASL\n                });\n\n                if (response !== \"\") {\n                  stanza.t(btoa(response));\n                }\n\n                this.send(stanza.tree());\n                return true;\n              }\n              /** PrivateFunction: _attemptLegacyAuth\n               *\n               *  Attempt legacy (i.e. non-SASL) authentication.\n               */\n\n\n              _attemptLegacyAuth() {\n                if (Strophe.getNodeFromJid(this.jid) === null) {\n                  // we don't have a node, which is required for non-anonymous\n                  // client connections\n                  this._changeConnectStatus(Strophe.Status.CONNFAIL, Strophe.ErrorCondition.MISSING_JID_NODE);\n\n                  this.disconnect(Strophe.ErrorCondition.MISSING_JID_NODE);\n                } else {\n                  // Fall back to legacy authentication\n                  this._changeConnectStatus(Strophe.Status.AUTHENTICATING, null);\n\n                  this._addSysHandler(this._onLegacyAuthIQResult.bind(this), null, null, null, \"_auth_1\");\n\n                  this.send($iq({\n                    'type': \"get\",\n                    'to': this.domain,\n                    'id': \"_auth_1\"\n                  }).c(\"query\", {\n                    xmlns: Strophe.NS.AUTH\n                  }).c(\"username\", {}).t(Strophe.getNodeFromJid(this.jid)).tree());\n                }\n              }\n              /** PrivateFunction: _onLegacyAuthIQResult\n               *  _Private_ handler for legacy authentication.\n               *\n               *  This handler is called in response to the initial <iq type='get'/>\n               *  for legacy authentication.  It builds an authentication <iq/> and\n               *  sends it, creating a handler (calling back to _auth2_cb()) to\n               *  handle the result\n               *\n               *  Parameters:\n               *    (XMLElement) elem - The stanza that triggered the callback.\n               *\n               *  Returns:\n               *    false to remove the handler.\n               */\n\n\n              _onLegacyAuthIQResult(elem) {\n                // eslint-disable-line no-unused-vars\n                // build plaintext auth iq\n                const iq = $iq({\n                  type: \"set\",\n                  id: \"_auth_2\"\n                }).c('query', {\n                  xmlns: Strophe.NS.AUTH\n                }).c('username', {}).t(Strophe.getNodeFromJid(this.jid)).up().c('password').t(this.pass);\n\n                if (!Strophe.getResourceFromJid(this.jid)) {\n                  // since the user has not supplied a resource, we pick\n                  // a default one here.  unlike other auth methods, the server\n                  // cannot do this for us.\n                  this.jid = Strophe.getBareJidFromJid(this.jid) + '/strophe';\n                }\n\n                iq.up().c('resource', {}).t(Strophe.getResourceFromJid(this.jid));\n\n                this._addSysHandler(this._auth2_cb.bind(this), null, null, null, \"_auth_2\");\n\n                this.send(iq.tree());\n                return false;\n              }\n              /** PrivateFunction: _sasl_success_cb\n               *  _Private_ handler for succesful SASL authentication.\n               *\n               *  Parameters:\n               *    (XMLElement) elem - The matching stanza.\n               *\n               *  Returns:\n               *    false to remove the handler.\n               */\n\n\n              _sasl_success_cb(elem) {\n                if (this._sasl_data[\"server-signature\"]) {\n                  let serverSignature;\n                  const success = atob(Strophe.getText(elem));\n                  const attribMatch = /([a-z]+)=([^,]+)(,|$)/;\n                  const matches = success.match(attribMatch);\n\n                  if (matches[1] === \"v\") {\n                    serverSignature = matches[2];\n                  }\n\n                  if (serverSignature !== this._sasl_data[\"server-signature\"]) {\n                    // remove old handlers\n                    this.deleteHandler(this._sasl_failure_handler);\n                    this._sasl_failure_handler = null;\n\n                    if (this._sasl_challenge_handler) {\n                      this.deleteHandler(this._sasl_challenge_handler);\n                      this._sasl_challenge_handler = null;\n                    }\n\n                    this._sasl_data = {};\n                    return this._sasl_failure_cb(null);\n                  }\n                }\n\n                Strophe.info(\"SASL authentication succeeded.\");\n\n                if (this._sasl_mechanism) {\n                  this._sasl_mechanism.onSuccess();\n                } // remove old handlers\n\n\n                this.deleteHandler(this._sasl_failure_handler);\n                this._sasl_failure_handler = null;\n\n                if (this._sasl_challenge_handler) {\n                  this.deleteHandler(this._sasl_challenge_handler);\n                  this._sasl_challenge_handler = null;\n                }\n\n                const streamfeature_handlers = [];\n\n                const wrapper = (handlers, elem) => {\n                  while (handlers.length) {\n                    this.deleteHandler(handlers.pop());\n                  }\n\n                  this._onStreamFeaturesAfterSASL(elem);\n\n                  return false;\n                };\n\n                streamfeature_handlers.push(this._addSysHandler(elem => wrapper(streamfeature_handlers, elem), null, \"stream:features\", null, null));\n                streamfeature_handlers.push(this._addSysHandler(elem => wrapper(streamfeature_handlers, elem), Strophe.NS.STREAM, \"features\", null, null)); // we must send an xmpp:restart now\n\n                this._sendRestart();\n\n                return false;\n              }\n              /** PrivateFunction: _onStreamFeaturesAfterSASL\n               *  Parameters:\n               *    (XMLElement) elem - The matching stanza.\n               *\n               *  Returns:\n               *    false to remove the handler.\n               */\n\n\n              _onStreamFeaturesAfterSASL(elem) {\n                // save stream:features for future usage\n                this.features = elem;\n\n                for (let i = 0; i < elem.childNodes.length; i++) {\n                  const child = elem.childNodes[i];\n\n                  if (child.nodeName === 'bind') {\n                    this.do_bind = true;\n                  }\n\n                  if (child.nodeName === 'session') {\n                    this.do_session = true;\n                  }\n                }\n\n                if (!this.do_bind) {\n                  this._changeConnectStatus(Strophe.Status.AUTHFAIL, null);\n\n                  return false;\n                } else if (!this.options.explicitResourceBinding) {\n                  this.bind();\n                } else {\n                  this._changeConnectStatus(Strophe.Status.BINDREQUIRED, null);\n                }\n\n                return false;\n              }\n              /** Function: bind\n               *\n               *  Sends an IQ to the XMPP server to bind a JID resource for this session.\n               *\n               *  https://tools.ietf.org/html/rfc6120#section-7.5\n               *\n               *  If `explicitResourceBinding` was set to a truthy value in the options\n               *  passed to the Strophe.Connection constructor, then this function needs\n               *  to be called explicitly by the client author.\n               *\n               *  Otherwise it'll be called automatically as soon as the XMPP server\n               *  advertises the \"urn:ietf:params:xml:ns:xmpp-bind\" stream feature.\n               */\n\n\n              bind() {\n                if (!this.do_bind) {\n                  Strophe.log(Strophe.LogLevel.INFO, `Strophe.Connection.prototype.bind called but \"do_bind\" is false`);\n                  return;\n                }\n\n                this._addSysHandler(this._onResourceBindResultIQ.bind(this), null, null, null, \"_bind_auth_2\");\n\n                const resource = Strophe.getResourceFromJid(this.jid);\n\n                if (resource) {\n                  this.send($iq({\n                    type: \"set\",\n                    id: \"_bind_auth_2\"\n                  }).c('bind', {\n                    xmlns: Strophe.NS.BIND\n                  }).c('resource', {}).t(resource).tree());\n                } else {\n                  this.send($iq({\n                    type: \"set\",\n                    id: \"_bind_auth_2\"\n                  }).c('bind', {\n                    xmlns: Strophe.NS.BIND\n                  }).tree());\n                }\n              }\n              /** PrivateFunction: _onResourceBindIQ\n               *  _Private_ handler for binding result and session start.\n               *\n               *  Parameters:\n               *    (XMLElement) elem - The matching stanza.\n               *\n               *  Returns:\n               *    false to remove the handler.\n               */\n\n\n              _onResourceBindResultIQ(elem) {\n                if (elem.getAttribute(\"type\") === \"error\") {\n                  Strophe.warn(\"Resource binding failed.\");\n                  const conflict = elem.getElementsByTagName(\"conflict\");\n                  let condition;\n\n                  if (conflict.length > 0) {\n                    condition = Strophe.ErrorCondition.CONFLICT;\n                  }\n\n                  this._changeConnectStatus(Strophe.Status.AUTHFAIL, condition, elem);\n\n                  return false;\n                } // TODO - need to grab errors\n\n\n                const bind = elem.getElementsByTagName(\"bind\");\n\n                if (bind.length > 0) {\n                  const jidNode = bind[0].getElementsByTagName(\"jid\");\n\n                  if (jidNode.length > 0) {\n                    this.authenticated = true;\n                    this.jid = Strophe.getText(jidNode[0]);\n\n                    if (this.do_session) {\n                      this._establishSession();\n                    } else {\n                      this._changeConnectStatus(Strophe.Status.CONNECTED, null);\n                    }\n                  }\n                } else {\n                  Strophe.warn(\"Resource binding failed.\");\n\n                  this._changeConnectStatus(Strophe.Status.AUTHFAIL, null, elem);\n\n                  return false;\n                }\n              }\n              /** PrivateFunction: _establishSession\n               *  Send IQ request to establish a session with the XMPP server.\n               *\n               *  See https://xmpp.org/rfcs/rfc3921.html#session\n               *\n               *  Note: The protocol for session establishment has been determined as\n               *  unnecessary and removed in RFC-6121.\n               */\n\n\n              _establishSession() {\n                if (!this.do_session) {\n                  throw new Error(`Strophe.Connection.prototype._establishSession ` + `called but apparently ${Strophe.NS.SESSION} wasn't advertised by the server`);\n                }\n\n                this._addSysHandler(this._onSessionResultIQ.bind(this), null, null, null, \"_session_auth_2\");\n\n                this.send($iq({\n                  type: \"set\",\n                  id: \"_session_auth_2\"\n                }).c('session', {\n                  xmlns: Strophe.NS.SESSION\n                }).tree());\n              }\n              /** PrivateFunction: _onSessionResultIQ\n               *  _Private_ handler for the server's IQ response to a client's session\n               *  request.\n               *\n               *  This sets Connection.authenticated to true on success, which\n               *  starts the processing of user handlers.\n               *\n               *  See https://xmpp.org/rfcs/rfc3921.html#session\n               *\n               *  Note: The protocol for session establishment has been determined as\n               *  unnecessary and removed in RFC-6121.\n               *\n               *  Parameters:\n               *    (XMLElement) elem - The matching stanza.\n               *\n               *  Returns:\n               *    false to remove the handler.\n               */\n\n\n              _onSessionResultIQ(elem) {\n                if (elem.getAttribute(\"type\") === \"result\") {\n                  this.authenticated = true;\n\n                  this._changeConnectStatus(Strophe.Status.CONNECTED, null);\n                } else if (elem.getAttribute(\"type\") === \"error\") {\n                  this.authenticated = false;\n                  Strophe.warn(\"Session creation failed.\");\n\n                  this._changeConnectStatus(Strophe.Status.AUTHFAIL, null, elem);\n\n                  return false;\n                }\n\n                return false;\n              }\n              /** PrivateFunction: _sasl_failure_cb\n               *  _Private_ handler for SASL authentication failure.\n               *\n               *  Parameters:\n               *    (XMLElement) elem - The matching stanza.\n               *\n               *  Returns:\n               *    false to remove the handler.\n               */\n\n\n              _sasl_failure_cb(elem) {\n                // delete unneeded handlers\n                if (this._sasl_success_handler) {\n                  this.deleteHandler(this._sasl_success_handler);\n                  this._sasl_success_handler = null;\n                }\n\n                if (this._sasl_challenge_handler) {\n                  this.deleteHandler(this._sasl_challenge_handler);\n                  this._sasl_challenge_handler = null;\n                }\n\n                if (this._sasl_mechanism) this._sasl_mechanism.onFailure();\n\n                this._changeConnectStatus(Strophe.Status.AUTHFAIL, null, elem);\n\n                return false;\n              }\n              /** PrivateFunction: _auth2_cb\n               *  _Private_ handler to finish legacy authentication.\n               *\n               *  This handler is called when the result from the jabber:iq:auth\n               *  <iq/> stanza is returned.\n               *\n               *  Parameters:\n               *    (XMLElement) elem - The stanza that triggered the callback.\n               *\n               *  Returns:\n               *    false to remove the handler.\n               */\n\n\n              _auth2_cb(elem) {\n                if (elem.getAttribute(\"type\") === \"result\") {\n                  this.authenticated = true;\n\n                  this._changeConnectStatus(Strophe.Status.CONNECTED, null);\n                } else if (elem.getAttribute(\"type\") === \"error\") {\n                  this._changeConnectStatus(Strophe.Status.AUTHFAIL, null, elem);\n\n                  this.disconnect('authentication failed');\n                }\n\n                return false;\n              }\n              /** PrivateFunction: _addSysTimedHandler\n               *  _Private_ function to add a system level timed handler.\n               *\n               *  This function is used to add a Strophe.TimedHandler for the\n               *  library code.  System timed handlers are allowed to run before\n               *  authentication is complete.\n               *\n               *  Parameters:\n               *    (Integer) period - The period of the handler.\n               *    (Function) handler - The callback function.\n               */\n\n\n              _addSysTimedHandler(period, handler) {\n                const thand = new Strophe.TimedHandler(period, handler);\n                thand.user = false;\n                this.addTimeds.push(thand);\n                return thand;\n              }\n              /** PrivateFunction: _addSysHandler\n               *  _Private_ function to add a system level stanza handler.\n               *\n               *  This function is used to add a Strophe.Handler for the\n               *  library code.  System stanza handlers are allowed to run before\n               *  authentication is complete.\n               *\n               *  Parameters:\n               *    (Function) handler - The callback function.\n               *    (String) ns - The namespace to match.\n               *    (String) name - The stanza name to match.\n               *    (String) type - The stanza type attribute to match.\n               *    (String) id - The stanza id attribute to match.\n               */\n\n\n              _addSysHandler(handler, ns, name, type, id) {\n                const hand = new Strophe.Handler(handler, ns, name, type, id);\n                hand.user = false;\n                this.addHandlers.push(hand);\n                return hand;\n              }\n              /** PrivateFunction: _onDisconnectTimeout\n               *  _Private_ timeout handler for handling non-graceful disconnection.\n               *\n               *  If the graceful disconnect process does not complete within the\n               *  time allotted, this handler finishes the disconnect anyway.\n               *\n               *  Returns:\n               *    false to remove the handler.\n               */\n\n\n              _onDisconnectTimeout() {\n                Strophe.debug(\"_onDisconnectTimeout was called\");\n\n                this._changeConnectStatus(Strophe.Status.CONNTIMEOUT, null);\n\n                this._proto._onDisconnectTimeout(); // actually disconnect\n\n\n                this._doDisconnect();\n\n                return false;\n              }\n              /** PrivateFunction: _onIdle\n               *  _Private_ handler to process events during idle cycle.\n               *\n               *  This handler is called every 100ms to fire timed handlers that\n               *  are ready and keep poll requests going.\n               */\n\n\n              _onIdle() {\n                // add timed handlers scheduled for addition\n                // NOTE: we add before remove in the case a timed handler is\n                // added and then deleted before the next _onIdle() call.\n                while (this.addTimeds.length > 0) {\n                  this.timedHandlers.push(this.addTimeds.pop());\n                } // remove timed handlers that have been scheduled for deletion\n\n\n                while (this.removeTimeds.length > 0) {\n                  const thand = this.removeTimeds.pop();\n                  const i = this.timedHandlers.indexOf(thand);\n\n                  if (i >= 0) {\n                    this.timedHandlers.splice(i, 1);\n                  }\n                } // call ready timed handlers\n\n\n                const now = new Date().getTime();\n                const newList = [];\n\n                for (let i = 0; i < this.timedHandlers.length; i++) {\n                  const thand = this.timedHandlers[i];\n\n                  if (this.authenticated || !thand.user) {\n                    const since = thand.lastCalled + thand.period;\n\n                    if (since - now <= 0) {\n                      if (thand.run()) {\n                        newList.push(thand);\n                      }\n                    } else {\n                      newList.push(thand);\n                    }\n                  }\n                }\n\n                this.timedHandlers = newList;\n                clearTimeout(this._idleTimeout);\n\n                this._proto._onIdle(); // reactivate the timer only if connected\n\n\n                if (this.connected) {\n                  this._idleTimeout = setTimeout(() => this._onIdle(), 100);\n                }\n              }\n\n            };\n            Strophe.SASLMechanism = SASLMechanism;\n            /** Constants: SASL mechanisms\n             *  Available authentication mechanisms\n             *\n             *  Strophe.SASLAnonymous   - SASL ANONYMOUS authentication.\n             *  Strophe.SASLPlain       - SASL PLAIN authentication.\n             *  Strophe.SASLSHA1        - SASL SCRAM-SHA-1 authentication\n             *  Strophe.SASLOAuthBearer - SASL OAuth Bearer authentication\n             *  Strophe.SASLExternal    - SASL EXTERNAL authentication\n             *  Strophe.SASLXOAuth2     - SASL X-OAuth2 authentication\n             */\n\n            Strophe.SASLAnonymous = SASLAnonymous;\n            Strophe.SASLPlain = SASLPlain;\n            Strophe.SASLSHA1 = SASLSHA1;\n            Strophe.SASLOAuthBearer = SASLOAuthBearer;\n            Strophe.SASLExternal = SASLExternal;\n            Strophe.SASLXOAuth2 = SASLXOAuth2;\n            var core = {\n              'Strophe': Strophe,\n              '$build': $build,\n              '$iq': $iq,\n              '$msg': $msg,\n              '$pres': $pres,\n              'SHA1': SHA1,\n              'MD5': MD5,\n              'b64_hmac_sha1': SHA1.b64_hmac_sha1,\n              'b64_sha1': SHA1.b64_sha1,\n              'str_hmac_sha1': SHA1.str_hmac_sha1,\n              'str_sha1': SHA1.str_sha1\n            };\n\n            /*\n                This program is distributed under the terms of the MIT license.\n                Please see the LICENSE file for details.\n\n                Copyright 2006-2008, OGG, LLC\n            */\n            /** PrivateClass: Strophe.Request\n             *  _Private_ helper class that provides a cross implementation abstraction\n             *  for a BOSH related XMLHttpRequest.\n             *\n             *  The Strophe.Request class is used internally to encapsulate BOSH request\n             *  information.  It is not meant to be used from user's code.\n             */\n\n            Strophe.Request = class Request {\n              /** PrivateConstructor: Strophe.Request\n               *  Create and initialize a new Strophe.Request object.\n               *\n               *  Parameters:\n               *    (XMLElement) elem - The XML data to be sent in the request.\n               *    (Function) func - The function that will be called when the\n               *      XMLHttpRequest readyState changes.\n               *    (Integer) rid - The BOSH rid attribute associated with this request.\n               *    (Integer) sends - The number of times this same request has been sent.\n               */\n              constructor(elem, func, rid, sends) {\n                this.id = ++Strophe._requestId;\n                this.xmlData = elem;\n                this.data = Strophe.serialize(elem); // save original function in case we need to make a new request\n                // from this one.\n\n                this.origFunc = func;\n                this.func = func;\n                this.rid = rid;\n                this.date = NaN;\n                this.sends = sends || 0;\n                this.abort = false;\n                this.dead = null;\n\n                this.age = function () {\n                  if (!this.date) {\n                    return 0;\n                  }\n\n                  const now = new Date();\n                  return (now - this.date) / 1000;\n                };\n\n                this.timeDead = function () {\n                  if (!this.dead) {\n                    return 0;\n                  }\n\n                  const now = new Date();\n                  return (now - this.dead) / 1000;\n                };\n\n                this.xhr = this._newXHR();\n              }\n              /** PrivateFunction: getResponse\n               *  Get a response from the underlying XMLHttpRequest.\n               *\n               *  This function attempts to get a response from the request and checks\n               *  for errors.\n               *\n               *  Throws:\n               *    \"parsererror\" - A parser error occured.\n               *    \"bad-format\" - The entity has sent XML that cannot be processed.\n               *\n               *  Returns:\n               *    The DOM element tree of the response.\n               */\n\n\n              getResponse() {\n                let node = null;\n\n                if (this.xhr.responseXML && this.xhr.responseXML.documentElement) {\n                  node = this.xhr.responseXML.documentElement;\n\n                  if (node.tagName === \"parsererror\") {\n                    Strophe.error(\"invalid response received\");\n                    Strophe.error(\"responseText: \" + this.xhr.responseText);\n                    Strophe.error(\"responseXML: \" + Strophe.serialize(this.xhr.responseXML));\n                    throw new Error(\"parsererror\");\n                  }\n                } else if (this.xhr.responseText) {\n                  // In React Native, we may get responseText but no responseXML.  We can try to parse it manually.\n                  Strophe.debug(\"Got responseText but no responseXML; attempting to parse it with DOMParser...\");\n                  node = new DOMParser().parseFromString(this.xhr.responseText, 'application/xml').documentElement;\n\n                  if (!node) {\n                    throw new Error('Parsing produced null node');\n                  } else if (node.querySelector('parsererror')) {\n                    Strophe.error(\"invalid response received: \" + node.querySelector('parsererror').textContent);\n                    Strophe.error(\"responseText: \" + this.xhr.responseText);\n                    const error = new Error();\n                    error.name = Strophe.ErrorCondition.BAD_FORMAT;\n                    throw error;\n                  }\n                }\n\n                return node;\n              }\n              /** PrivateFunction: _newXHR\n               *  _Private_ helper function to create XMLHttpRequests.\n               *\n               *  This function creates XMLHttpRequests across all implementations.\n               *\n               *  Returns:\n               *    A new XMLHttpRequest.\n               */\n\n\n              _newXHR() {\n                let xhr = null;\n\n                if (window.XMLHttpRequest) {\n                  xhr = new XMLHttpRequest();\n\n                  if (xhr.overrideMimeType) {\n                    xhr.overrideMimeType(\"text/xml; charset=utf-8\");\n                  }\n                } else if (window.ActiveXObject) {\n                  xhr = new ActiveXObject(\"Microsoft.XMLHTTP\");\n                } // use Function.bind() to prepend ourselves as an argument\n\n\n                xhr.onreadystatechange = this.func.bind(null, this);\n                return xhr;\n              }\n\n            };\n            /** Class: Strophe.Bosh\n             *  _Private_ helper class that handles BOSH Connections\n             *\n             *  The Strophe.Bosh class is used internally by Strophe.Connection\n             *  to encapsulate BOSH sessions. It is not meant to be used from user's code.\n             */\n\n            /** File: bosh.js\n             *  A JavaScript library to enable BOSH in Strophejs.\n             *\n             *  this library uses Bidirectional-streams Over Synchronous HTTP (BOSH)\n             *  to emulate a persistent, stateful, two-way connection to an XMPP server.\n             *  More information on BOSH can be found in XEP 124.\n             */\n\n            /** PrivateConstructor: Strophe.Bosh\n             *  Create and initialize a Strophe.Bosh object.\n             *\n             *  Parameters:\n             *    (Strophe.Connection) connection - The Strophe.Connection that will use BOSH.\n             *\n             *  Returns:\n             *    A new Strophe.Bosh object.\n             */\n\n            Strophe.Bosh = class Bosh {\n              constructor(connection) {\n                this._conn = connection;\n                /* request id for body tags */\n\n                this.rid = Math.floor(Math.random() * 4294967295);\n                /* The current session ID. */\n\n                this.sid = null; // default BOSH values\n\n                this.hold = 1;\n                this.wait = 60;\n                this.window = 5;\n                this.errors = 0;\n                this.inactivity = null;\n                this.lastResponseHeaders = null;\n                this._requests = [];\n              }\n              /** PrivateFunction: _buildBody\n               *  _Private_ helper function to generate the <body/> wrapper for BOSH.\n               *\n               *  Returns:\n               *    A Strophe.Builder with a <body/> element.\n               */\n\n\n              _buildBody() {\n                const bodyWrap = $build('body', {\n                  'rid': this.rid++,\n                  'xmlns': Strophe.NS.HTTPBIND\n                });\n\n                if (this.sid !== null) {\n                  bodyWrap.attrs({\n                    'sid': this.sid\n                  });\n                }\n\n                if (this._conn.options.keepalive && this._conn._sessionCachingSupported()) {\n                  this._cacheSession();\n                }\n\n                return bodyWrap;\n              }\n              /** PrivateFunction: _reset\n               *  Reset the connection.\n               *\n               *  This function is called by the reset function of the Strophe Connection\n               */\n\n\n              _reset() {\n                this.rid = Math.floor(Math.random() * 4294967295);\n                this.sid = null;\n                this.errors = 0;\n\n                if (this._conn._sessionCachingSupported()) {\n                  window.sessionStorage.removeItem('strophe-bosh-session');\n                }\n\n                this._conn.nextValidRid(this.rid);\n              }\n              /** PrivateFunction: _connect\n               *  _Private_ function that initializes the BOSH connection.\n               *\n               *  Creates and sends the Request that initializes the BOSH connection.\n               */\n\n\n              _connect(wait, hold, route) {\n                this.wait = wait || this.wait;\n                this.hold = hold || this.hold;\n                this.errors = 0;\n\n                const body = this._buildBody().attrs({\n                  \"to\": this._conn.domain,\n                  \"xml:lang\": \"en\",\n                  \"wait\": this.wait,\n                  \"hold\": this.hold,\n                  \"content\": \"text/xml; charset=utf-8\",\n                  \"ver\": \"1.6\",\n                  \"xmpp:version\": \"1.0\",\n                  \"xmlns:xmpp\": Strophe.NS.BOSH\n                });\n\n                if (route) {\n                  body.attrs({\n                    'route': route\n                  });\n                }\n\n                const _connect_cb = this._conn._connect_cb;\n\n                this._requests.push(new Strophe.Request(body.tree(), this._onRequestStateChange.bind(this, _connect_cb.bind(this._conn)), body.tree().getAttribute(\"rid\")));\n\n                this._throttledRequestHandler();\n              }\n              /** PrivateFunction: _attach\n               *  Attach to an already created and authenticated BOSH session.\n               *\n               *  This function is provided to allow Strophe to attach to BOSH\n               *  sessions which have been created externally, perhaps by a Web\n               *  application.  This is often used to support auto-login type features\n               *  without putting user credentials into the page.\n               *\n               *  Parameters:\n               *    (String) jid - The full JID that is bound by the session.\n               *    (String) sid - The SID of the BOSH session.\n               *    (String) rid - The current RID of the BOSH session.  This RID\n               *      will be used by the next request.\n               *    (Function) callback The connect callback function.\n               *    (Integer) wait - The optional HTTPBIND wait value.  This is the\n               *      time the server will wait before returning an empty result for\n               *      a request.  The default setting of 60 seconds is recommended.\n               *      Other settings will require tweaks to the Strophe.TIMEOUT value.\n               *    (Integer) hold - The optional HTTPBIND hold value.  This is the\n               *      number of connections the server will hold at one time.  This\n               *      should almost always be set to 1 (the default).\n               *    (Integer) wind - The optional HTTBIND window value.  This is the\n               *      allowed range of request ids that are valid.  The default is 5.\n               */\n\n\n              _attach(jid, sid, rid, callback, wait, hold, wind) {\n                this._conn.jid = jid;\n                this.sid = sid;\n                this.rid = rid;\n                this._conn.connect_callback = callback;\n                this._conn.domain = Strophe.getDomainFromJid(this._conn.jid);\n                this._conn.authenticated = true;\n                this._conn.connected = true;\n                this.wait = wait || this.wait;\n                this.hold = hold || this.hold;\n                this.window = wind || this.window;\n\n                this._conn._changeConnectStatus(Strophe.Status.ATTACHED, null);\n              }\n              /** PrivateFunction: _restore\n               *  Attempt to restore a cached BOSH session\n               *\n               *  Parameters:\n               *    (String) jid - The full JID that is bound by the session.\n               *      This parameter is optional but recommended, specifically in cases\n               *      where prebinded BOSH sessions are used where it's important to know\n               *      that the right session is being restored.\n               *    (Function) callback The connect callback function.\n               *    (Integer) wait - The optional HTTPBIND wait value.  This is the\n               *      time the server will wait before returning an empty result for\n               *      a request.  The default setting of 60 seconds is recommended.\n               *      Other settings will require tweaks to the Strophe.TIMEOUT value.\n               *    (Integer) hold - The optional HTTPBIND hold value.  This is the\n               *      number of connections the server will hold at one time.  This\n               *      should almost always be set to 1 (the default).\n               *    (Integer) wind - The optional HTTBIND window value.  This is the\n               *      allowed range of request ids that are valid.  The default is 5.\n               */\n\n\n              _restore(jid, callback, wait, hold, wind) {\n                const session = JSON.parse(window.sessionStorage.getItem('strophe-bosh-session'));\n\n                if (typeof session !== \"undefined\" && session !== null && session.rid && session.sid && session.jid && (typeof jid === \"undefined\" || jid === null || Strophe.getBareJidFromJid(session.jid) === Strophe.getBareJidFromJid(jid) || // If authcid is null, then it's an anonymous login, so\n                // we compare only the domains:\n                Strophe.getNodeFromJid(jid) === null && Strophe.getDomainFromJid(session.jid) === jid)) {\n                  this._conn.restored = true;\n\n                  this._attach(session.jid, session.sid, session.rid, callback, wait, hold, wind);\n                } else {\n                  const error = new Error(\"_restore: no restoreable session.\");\n                  error.name = \"StropheSessionError\";\n                  throw error;\n                }\n              }\n              /** PrivateFunction: _cacheSession\n               *  _Private_ handler for the beforeunload event.\n               *\n               *  This handler is used to process the Bosh-part of the initial request.\n               *  Parameters:\n               *    (Strophe.Request) bodyWrap - The received stanza.\n               */\n\n\n              _cacheSession() {\n                if (this._conn.authenticated) {\n                  if (this._conn.jid && this.rid && this.sid) {\n                    window.sessionStorage.setItem('strophe-bosh-session', JSON.stringify({\n                      'jid': this._conn.jid,\n                      'rid': this.rid,\n                      'sid': this.sid\n                    }));\n                  }\n                } else {\n                  window.sessionStorage.removeItem('strophe-bosh-session');\n                }\n              }\n              /** PrivateFunction: _connect_cb\n               *  _Private_ handler for initial connection request.\n               *\n               *  This handler is used to process the Bosh-part of the initial request.\n               *  Parameters:\n               *    (Strophe.Request) bodyWrap - The received stanza.\n               */\n\n\n              _connect_cb(bodyWrap) {\n                const typ = bodyWrap.getAttribute(\"type\");\n\n                if (typ !== null && typ === \"terminate\") {\n                  // an error occurred\n                  let cond = bodyWrap.getAttribute(\"condition\");\n                  Strophe.error(\"BOSH-Connection failed: \" + cond);\n                  const conflict = bodyWrap.getElementsByTagName(\"conflict\");\n\n                  if (cond !== null) {\n                    if (cond === \"remote-stream-error\" && conflict.length > 0) {\n                      cond = \"conflict\";\n                    }\n\n                    this._conn._changeConnectStatus(Strophe.Status.CONNFAIL, cond);\n                  } else {\n                    this._conn._changeConnectStatus(Strophe.Status.CONNFAIL, \"unknown\");\n                  }\n\n                  this._conn._doDisconnect(cond);\n\n                  return Strophe.Status.CONNFAIL;\n                } // check to make sure we don't overwrite these if _connect_cb is\n                // called multiple times in the case of missing stream:features\n\n\n                if (!this.sid) {\n                  this.sid = bodyWrap.getAttribute(\"sid\");\n                }\n\n                const wind = bodyWrap.getAttribute('requests');\n\n                if (wind) {\n                  this.window = parseInt(wind, 10);\n                }\n\n                const hold = bodyWrap.getAttribute('hold');\n\n                if (hold) {\n                  this.hold = parseInt(hold, 10);\n                }\n\n                const wait = bodyWrap.getAttribute('wait');\n\n                if (wait) {\n                  this.wait = parseInt(wait, 10);\n                }\n\n                const inactivity = bodyWrap.getAttribute('inactivity');\n\n                if (inactivity) {\n                  this.inactivity = parseInt(inactivity, 10);\n                }\n              }\n              /** PrivateFunction: _disconnect\n               *  _Private_ part of Connection.disconnect for Bosh\n               *\n               *  Parameters:\n               *    (Request) pres - This stanza will be sent before disconnecting.\n               */\n\n\n              _disconnect(pres) {\n                this._sendTerminate(pres);\n              }\n              /** PrivateFunction: _doDisconnect\n               *  _Private_ function to disconnect.\n               *\n               *  Resets the SID and RID.\n               */\n\n\n              _doDisconnect() {\n                this.sid = null;\n                this.rid = Math.floor(Math.random() * 4294967295);\n\n                if (this._conn._sessionCachingSupported()) {\n                  window.sessionStorage.removeItem('strophe-bosh-session');\n                }\n\n                this._conn.nextValidRid(this.rid);\n              }\n              /** PrivateFunction: _emptyQueue\n               * _Private_ function to check if the Request queue is empty.\n               *\n               *  Returns:\n               *    True, if there are no Requests queued, False otherwise.\n               */\n\n\n              _emptyQueue() {\n                return this._requests.length === 0;\n              }\n              /** PrivateFunction: _callProtocolErrorHandlers\n               *  _Private_ function to call error handlers registered for HTTP errors.\n               *\n               *  Parameters:\n               *    (Strophe.Request) req - The request that is changing readyState.\n               */\n\n\n              _callProtocolErrorHandlers(req) {\n                const reqStatus = Bosh._getRequestStatus(req);\n\n                const err_callback = this._conn.protocolErrorHandlers.HTTP[reqStatus];\n\n                if (err_callback) {\n                  err_callback.call(this, reqStatus);\n                }\n              }\n              /** PrivateFunction: _hitError\n               *  _Private_ function to handle the error count.\n               *\n               *  Requests are resent automatically until their error count reaches\n               *  5.  Each time an error is encountered, this function is called to\n               *  increment the count and disconnect if the count is too high.\n               *\n               *  Parameters:\n               *    (Integer) reqStatus - The request status.\n               */\n\n\n              _hitError(reqStatus) {\n                this.errors++;\n                Strophe.warn(\"request errored, status: \" + reqStatus + \", number of errors: \" + this.errors);\n\n                if (this.errors > 4) {\n                  this._conn._onDisconnectTimeout();\n                }\n              }\n              /** PrivateFunction: _no_auth_received\n               *\n               * Called on stream start/restart when no stream:features\n               * has been received and sends a blank poll request.\n               */\n\n\n              _no_auth_received(callback) {\n                Strophe.warn(\"Server did not yet offer a supported authentication \" + \"mechanism. Sending a blank poll request.\");\n\n                if (callback) {\n                  callback = callback.bind(this._conn);\n                } else {\n                  callback = this._conn._connect_cb.bind(this._conn);\n                }\n\n                const body = this._buildBody();\n\n                this._requests.push(new Strophe.Request(body.tree(), this._onRequestStateChange.bind(this, callback), body.tree().getAttribute(\"rid\")));\n\n                this._throttledRequestHandler();\n              }\n              /** PrivateFunction: _onDisconnectTimeout\n               *  _Private_ timeout handler for handling non-graceful disconnection.\n               *\n               *  Cancels all remaining Requests and clears the queue.\n               */\n\n\n              _onDisconnectTimeout() {\n                this._abortAllRequests();\n              }\n              /** PrivateFunction: _abortAllRequests\n               *  _Private_ helper function that makes sure all pending requests are aborted.\n               */\n\n\n              _abortAllRequests() {\n                while (this._requests.length > 0) {\n                  const req = this._requests.pop();\n\n                  req.abort = true;\n                  req.xhr.abort();\n\n                  req.xhr.onreadystatechange = function () {};\n                }\n              }\n              /** PrivateFunction: _onIdle\n               *  _Private_ handler called by Strophe.Connection._onIdle\n               *\n               *  Sends all queued Requests or polls with empty Request if there are none.\n               */\n\n\n              _onIdle() {\n                const data = this._conn._data; // if no requests are in progress, poll\n\n                if (this._conn.authenticated && this._requests.length === 0 && data.length === 0 && !this._conn.disconnecting) {\n                  Strophe.debug(\"no requests during idle cycle, sending blank request\");\n                  data.push(null);\n                }\n\n                if (this._conn.paused) {\n                  return;\n                }\n\n                if (this._requests.length < 2 && data.length > 0) {\n                  const body = this._buildBody();\n\n                  for (let i = 0; i < data.length; i++) {\n                    if (data[i] !== null) {\n                      if (data[i] === \"restart\") {\n                        body.attrs({\n                          \"to\": this._conn.domain,\n                          \"xml:lang\": \"en\",\n                          \"xmpp:restart\": \"true\",\n                          \"xmlns:xmpp\": Strophe.NS.BOSH\n                        });\n                      } else {\n                        body.cnode(data[i]).up();\n                      }\n                    }\n                  }\n\n                  delete this._conn._data;\n                  this._conn._data = [];\n\n                  this._requests.push(new Strophe.Request(body.tree(), this._onRequestStateChange.bind(this, this._conn._dataRecv.bind(this._conn)), body.tree().getAttribute(\"rid\")));\n\n                  this._throttledRequestHandler();\n                }\n\n                if (this._requests.length > 0) {\n                  const time_elapsed = this._requests[0].age();\n\n                  if (this._requests[0].dead !== null) {\n                    if (this._requests[0].timeDead() > Math.floor(Strophe.SECONDARY_TIMEOUT * this.wait)) {\n                      this._throttledRequestHandler();\n                    }\n                  }\n\n                  if (time_elapsed > Math.floor(Strophe.TIMEOUT * this.wait)) {\n                    Strophe.warn(\"Request \" + this._requests[0].id + \" timed out, over \" + Math.floor(Strophe.TIMEOUT * this.wait) + \" seconds since last activity\");\n\n                    this._throttledRequestHandler();\n                  }\n                }\n              }\n              /** PrivateFunction: _getRequestStatus\n               *\n               *  Returns the HTTP status code from a Strophe.Request\n               *\n               *  Parameters:\n               *    (Strophe.Request) req - The Strophe.Request instance.\n               *    (Integer) def - The default value that should be returned if no\n               *          status value was found.\n               */\n\n\n              static _getRequestStatus(req, def) {\n                let reqStatus;\n\n                if (req.xhr.readyState === 4) {\n                  try {\n                    reqStatus = req.xhr.status;\n                  } catch (e) {\n                    // ignore errors from undefined status attribute. Works\n                    // around a browser bug\n                    Strophe.error(\"Caught an error while retrieving a request's status, \" + \"reqStatus: \" + reqStatus);\n                  }\n                }\n\n                if (typeof reqStatus === \"undefined\") {\n                  reqStatus = typeof def === 'number' ? def : 0;\n                }\n\n                return reqStatus;\n              }\n              /** PrivateFunction: _onRequestStateChange\n               *  _Private_ handler for Strophe.Request state changes.\n               *\n               *  This function is called when the XMLHttpRequest readyState changes.\n               *  It contains a lot of error handling logic for the many ways that\n               *  requests can fail, and calls the request callback when requests\n               *  succeed.\n               *\n               *  Parameters:\n               *    (Function) func - The handler for the request.\n               *    (Strophe.Request) req - The request that is changing readyState.\n               */\n\n\n              _onRequestStateChange(func, req) {\n                Strophe.debug(\"request id \" + req.id + \".\" + req.sends + \" state changed to \" + req.xhr.readyState);\n\n                if (req.abort) {\n                  req.abort = false;\n                  return;\n                }\n\n                if (req.xhr.readyState !== 4) {\n                  // The request is not yet complete\n                  return;\n                }\n\n                const reqStatus = Bosh._getRequestStatus(req);\n\n                this.lastResponseHeaders = req.xhr.getAllResponseHeaders();\n\n                if (this._conn.disconnecting && reqStatus >= 400) {\n                  this._hitError(reqStatus);\n\n                  this._callProtocolErrorHandlers(req);\n\n                  return;\n                }\n\n                const reqIs0 = this._requests[0] === req;\n                const reqIs1 = this._requests[1] === req;\n                const valid_request = reqStatus > 0 && reqStatus < 500;\n                const too_many_retries = req.sends > this._conn.maxRetries;\n\n                if (valid_request || too_many_retries) {\n                  // remove from internal queue\n                  this._removeRequest(req);\n\n                  Strophe.debug(\"request id \" + req.id + \" should now be removed\");\n                }\n\n                if (reqStatus === 200) {\n                  // request succeeded\n                  // if request 1 finished, or request 0 finished and request\n                  // 1 is over Strophe.SECONDARY_TIMEOUT seconds old, we need to\n                  // restart the other - both will be in the first spot, as the\n                  // completed request has been removed from the queue already\n                  if (reqIs1 || reqIs0 && this._requests.length > 0 && this._requests[0].age() > Math.floor(Strophe.SECONDARY_TIMEOUT * this.wait)) {\n                    this._restartRequest(0);\n                  }\n\n                  this._conn.nextValidRid(Number(req.rid) + 1);\n\n                  Strophe.debug(\"request id \" + req.id + \".\" + req.sends + \" got 200\");\n                  func(req); // call handler\n\n                  this.errors = 0;\n                } else if (reqStatus === 0 || reqStatus >= 400 && reqStatus < 600 || reqStatus >= 12000) {\n                  // request failed\n                  Strophe.error(\"request id \" + req.id + \".\" + req.sends + \" error \" + reqStatus + \" happened\");\n\n                  this._hitError(reqStatus);\n\n                  this._callProtocolErrorHandlers(req);\n\n                  if (reqStatus >= 400 && reqStatus < 500) {\n                    this._conn._changeConnectStatus(Strophe.Status.DISCONNECTING, null);\n\n                    this._conn._doDisconnect();\n                  }\n                } else {\n                  Strophe.error(\"request id \" + req.id + \".\" + req.sends + \" error \" + reqStatus + \" happened\");\n                }\n\n                if (!valid_request && !too_many_retries) {\n                  this._throttledRequestHandler();\n                } else if (too_many_retries && !this._conn.connected) {\n                  this._conn._changeConnectStatus(Strophe.Status.CONNFAIL, \"giving-up\");\n                }\n              }\n              /** PrivateFunction: _processRequest\n               *  _Private_ function to process a request in the queue.\n               *\n               *  This function takes requests off the queue and sends them and\n               *  restarts dead requests.\n               *\n               *  Parameters:\n               *    (Integer) i - The index of the request in the queue.\n               */\n\n\n              _processRequest(i) {\n                let req = this._requests[i];\n\n                const reqStatus = Bosh._getRequestStatus(req, -1); // make sure we limit the number of retries\n\n\n                if (req.sends > this._conn.maxRetries) {\n                  this._conn._onDisconnectTimeout();\n\n                  return;\n                }\n\n                const time_elapsed = req.age();\n                const primary_timeout = !isNaN(time_elapsed) && time_elapsed > Math.floor(Strophe.TIMEOUT * this.wait);\n                const secondary_timeout = req.dead !== null && req.timeDead() > Math.floor(Strophe.SECONDARY_TIMEOUT * this.wait);\n                const server_error = req.xhr.readyState === 4 && (reqStatus < 1 || reqStatus >= 500);\n\n                if (primary_timeout || secondary_timeout || server_error) {\n                  if (secondary_timeout) {\n                    Strophe.error(`Request ${this._requests[i].id} timed out (secondary), restarting`);\n                  }\n\n                  req.abort = true;\n                  req.xhr.abort(); // setting to null fails on IE6, so set to empty function\n\n                  req.xhr.onreadystatechange = function () {};\n\n                  this._requests[i] = new Strophe.Request(req.xmlData, req.origFunc, req.rid, req.sends);\n                  req = this._requests[i];\n                }\n\n                if (req.xhr.readyState === 0) {\n                  Strophe.debug(\"request id \" + req.id + \".\" + req.sends + \" posting\");\n\n                  try {\n                    const content_type = this._conn.options.contentType || \"text/xml; charset=utf-8\";\n                    req.xhr.open(\"POST\", this._conn.service, this._conn.options.sync ? false : true);\n\n                    if (typeof req.xhr.setRequestHeader !== 'undefined') {\n                      // IE9 doesn't have setRequestHeader\n                      req.xhr.setRequestHeader(\"Content-Type\", content_type);\n                    }\n\n                    if (this._conn.options.withCredentials) {\n                      req.xhr.withCredentials = true;\n                    }\n                  } catch (e2) {\n                    Strophe.error(\"XHR open failed: \" + e2.toString());\n\n                    if (!this._conn.connected) {\n                      this._conn._changeConnectStatus(Strophe.Status.CONNFAIL, \"bad-service\");\n                    }\n\n                    this._conn.disconnect();\n\n                    return;\n                  } // Fires the XHR request -- may be invoked immediately\n                  // or on a gradually expanding retry window for reconnects\n\n\n                  const sendFunc = () => {\n                    req.date = new Date();\n\n                    if (this._conn.options.customHeaders) {\n                      const headers = this._conn.options.customHeaders;\n\n                      for (const header in headers) {\n                        if (Object.prototype.hasOwnProperty.call(headers, header)) {\n                          req.xhr.setRequestHeader(header, headers[header]);\n                        }\n                      }\n                    }\n\n                    req.xhr.send(req.data);\n                  }; // Implement progressive backoff for reconnects --\n                  // First retry (send === 1) should also be instantaneous\n\n\n                  if (req.sends > 1) {\n                    // Using a cube of the retry number creates a nicely\n                    // expanding retry window\n                    const backoff = Math.min(Math.floor(Strophe.TIMEOUT * this.wait), Math.pow(req.sends, 3)) * 1000;\n                    setTimeout(function () {\n                      // XXX: setTimeout should be called only with function expressions (23974bc1)\n                      sendFunc();\n                    }, backoff);\n                  } else {\n                    sendFunc();\n                  }\n\n                  req.sends++;\n\n                  if (this._conn.xmlOutput !== Strophe.Connection.prototype.xmlOutput) {\n                    if (req.xmlData.nodeName === this.strip && req.xmlData.childNodes.length) {\n                      this._conn.xmlOutput(req.xmlData.childNodes[0]);\n                    } else {\n                      this._conn.xmlOutput(req.xmlData);\n                    }\n                  }\n\n                  if (this._conn.rawOutput !== Strophe.Connection.prototype.rawOutput) {\n                    this._conn.rawOutput(req.data);\n                  }\n                } else {\n                  Strophe.debug(\"_processRequest: \" + (i === 0 ? \"first\" : \"second\") + \" request has readyState of \" + req.xhr.readyState);\n                }\n              }\n              /** PrivateFunction: _removeRequest\n               *  _Private_ function to remove a request from the queue.\n               *\n               *  Parameters:\n               *    (Strophe.Request) req - The request to remove.\n               */\n\n\n              _removeRequest(req) {\n                Strophe.debug(\"removing request\");\n\n                for (let i = this._requests.length - 1; i >= 0; i--) {\n                  if (req === this._requests[i]) {\n                    this._requests.splice(i, 1);\n                  }\n                } // IE6 fails on setting to null, so set to empty function\n\n\n                req.xhr.onreadystatechange = function () {};\n\n                this._throttledRequestHandler();\n              }\n              /** PrivateFunction: _restartRequest\n               *  _Private_ function to restart a request that is presumed dead.\n               *\n               *  Parameters:\n               *    (Integer) i - The index of the request in the queue.\n               */\n\n\n              _restartRequest(i) {\n                const req = this._requests[i];\n\n                if (req.dead === null) {\n                  req.dead = new Date();\n                }\n\n                this._processRequest(i);\n              }\n              /** PrivateFunction: _reqToData\n               * _Private_ function to get a stanza out of a request.\n               *\n               * Tries to extract a stanza out of a Request Object.\n               * When this fails the current connection will be disconnected.\n               *\n               *  Parameters:\n               *    (Object) req - The Request.\n               *\n               *  Returns:\n               *    The stanza that was passed.\n               */\n\n\n              _reqToData(req) {\n                try {\n                  return req.getResponse();\n                } catch (e) {\n                  if (e.message !== \"parsererror\") {\n                    throw e;\n                  }\n\n                  this._conn.disconnect(\"strophe-parsererror\");\n                }\n              }\n              /** PrivateFunction: _sendTerminate\n               *  _Private_ function to send initial disconnect sequence.\n               *\n               *  This is the first step in a graceful disconnect.  It sends\n               *  the BOSH server a terminate body and includes an unavailable\n               *  presence if authentication has completed.\n               */\n\n\n              _sendTerminate(pres) {\n                Strophe.debug(\"_sendTerminate was called\");\n\n                const body = this._buildBody().attrs({\n                  type: \"terminate\"\n                });\n\n                if (pres) {\n                  body.cnode(pres.tree());\n                }\n\n                const req = new Strophe.Request(body.tree(), this._onRequestStateChange.bind(this, this._conn._dataRecv.bind(this._conn)), body.tree().getAttribute(\"rid\"));\n\n                this._requests.push(req);\n\n                this._throttledRequestHandler();\n              }\n              /** PrivateFunction: _send\n               *  _Private_ part of the Connection.send function for BOSH\n               *\n               * Just triggers the RequestHandler to send the messages that are in the queue\n               */\n\n\n              _send() {\n                clearTimeout(this._conn._idleTimeout);\n\n                this._throttledRequestHandler();\n\n                this._conn._idleTimeout = setTimeout(() => this._conn._onIdle(), 100);\n              }\n              /** PrivateFunction: _sendRestart\n               *\n               *  Send an xmpp:restart stanza.\n               */\n\n\n              _sendRestart() {\n                this._throttledRequestHandler();\n\n                clearTimeout(this._conn._idleTimeout);\n              }\n              /** PrivateFunction: _throttledRequestHandler\n               *  _Private_ function to throttle requests to the connection window.\n               *\n               *  This function makes sure we don't send requests so fast that the\n               *  request ids overflow the connection window in the case that one\n               *  request died.\n               */\n\n\n              _throttledRequestHandler() {\n                if (!this._requests) {\n                  Strophe.debug(\"_throttledRequestHandler called with \" + \"undefined requests\");\n                } else {\n                  Strophe.debug(\"_throttledRequestHandler called with \" + this._requests.length + \" requests\");\n                }\n\n                if (!this._requests || this._requests.length === 0) {\n                  return;\n                }\n\n                if (this._requests.length > 0) {\n                  this._processRequest(0);\n                }\n\n                if (this._requests.length > 1 && Math.abs(this._requests[0].rid - this._requests[1].rid) < this.window) {\n                  this._processRequest(1);\n                }\n              }\n\n            };\n            /** Variable: strip\n             *\n             *  BOSH-Connections will have all stanzas wrapped in a <body> tag when\n             *  passed to <Strophe.Connection.xmlInput> or <Strophe.Connection.xmlOutput>.\n             *  To strip this tag, User code can set <Strophe.Bosh.strip> to \"body\":\n             *\n             *  > Strophe.Bosh.prototype.strip = \"body\";\n             *\n             *  This will enable stripping of the body tag in both\n             *  <Strophe.Connection.xmlInput> and <Strophe.Connection.xmlOutput>.\n             */\n\n            Strophe.Bosh.prototype.strip = null;\n\n            /*\n                This program is distributed under the terms of the MIT license.\n                Please see the LICENSE file for details.\n\n                Copyright 2006-2008, OGG, LLC\n            */\n            /** Class: Strophe.WebSocket\n             *  _Private_ helper class that handles WebSocket Connections\n             *\n             *  The Strophe.WebSocket class is used internally by Strophe.Connection\n             *  to encapsulate WebSocket sessions. It is not meant to be used from user's code.\n             */\n\n            /** File: websocket.js\n             *  A JavaScript library to enable XMPP over Websocket in Strophejs.\n             *\n             *  This file implements XMPP over WebSockets for Strophejs.\n             *  If a Connection is established with a Websocket url (ws://...)\n             *  Strophe will use WebSockets.\n             *  For more information on XMPP-over-WebSocket see RFC 7395:\n             *  http://tools.ietf.org/html/rfc7395\n             *\n             *  WebSocket support implemented by Andreas Guth (andreas.guth@rwth-aachen.de)\n             */\n\n            Strophe.Websocket = class Websocket {\n              /** PrivateConstructor: Strophe.Websocket\n               *  Create and initialize a Strophe.WebSocket object.\n               *  Currently only sets the connection Object.\n               *\n               *  Parameters:\n               *    (Strophe.Connection) connection - The Strophe.Connection that will use WebSockets.\n               *\n               *  Returns:\n               *    A new Strophe.WebSocket object.\n               */\n              constructor(connection) {\n                this._conn = connection;\n                this.strip = \"wrapper\";\n                const service = connection.service;\n\n                if (service.indexOf(\"ws:\") !== 0 && service.indexOf(\"wss:\") !== 0) {\n                  // If the service is not an absolute URL, assume it is a path and put the absolute\n                  // URL together from options, current URL and the path.\n                  let new_service = \"\";\n\n                  if (connection.options.protocol === \"ws\" && window.location.protocol !== \"https:\") {\n                    new_service += \"ws\";\n                  } else {\n                    new_service += \"wss\";\n                  }\n\n                  new_service += \"://\" + window.location.host;\n\n                  if (service.indexOf(\"/\") !== 0) {\n                    new_service += window.location.pathname + service;\n                  } else {\n                    new_service += service;\n                  }\n\n                  connection.service = new_service;\n                }\n              }\n              /** PrivateFunction: _buildStream\n               *  _Private_ helper function to generate the <stream> start tag for WebSockets\n               *\n               *  Returns:\n               *    A Strophe.Builder with a <stream> element.\n               */\n\n\n              _buildStream() {\n                return $build(\"open\", {\n                  \"xmlns\": Strophe.NS.FRAMING,\n                  \"to\": this._conn.domain,\n                  \"version\": '1.0'\n                });\n              }\n              /** PrivateFunction: _checkStreamError\n               * _Private_ checks a message for stream:error\n               *\n               *  Parameters:\n               *    (Strophe.Request) bodyWrap - The received stanza.\n               *    connectstatus - The ConnectStatus that will be set on error.\n               *  Returns:\n               *     true if there was a streamerror, false otherwise.\n               */\n\n\n              _checkStreamError(bodyWrap, connectstatus) {\n                let errors;\n\n                if (bodyWrap.getElementsByTagNameNS) {\n                  errors = bodyWrap.getElementsByTagNameNS(Strophe.NS.STREAM, \"error\");\n                } else {\n                  errors = bodyWrap.getElementsByTagName(\"stream:error\");\n                }\n\n                if (errors.length === 0) {\n                  return false;\n                }\n\n                const error = errors[0];\n                let condition = \"\";\n                let text = \"\";\n                const ns = \"urn:ietf:params:xml:ns:xmpp-streams\";\n\n                for (let i = 0; i < error.childNodes.length; i++) {\n                  const e = error.childNodes[i];\n\n                  if (e.getAttribute(\"xmlns\") !== ns) {\n                    break;\n                  }\n\n                  if (e.nodeName === \"text\") {\n                    text = e.textContent;\n                  } else {\n                    condition = e.nodeName;\n                  }\n                }\n\n                let errorString = \"WebSocket stream error: \";\n\n                if (condition) {\n                  errorString += condition;\n                } else {\n                  errorString += \"unknown\";\n                }\n\n                if (text) {\n                  errorString += \" - \" + text;\n                }\n\n                Strophe.error(errorString); // close the connection on stream_error\n\n                this._conn._changeConnectStatus(connectstatus, condition);\n\n                this._conn._doDisconnect();\n\n                return true;\n              }\n              /** PrivateFunction: _reset\n               *  Reset the connection.\n               *\n               *  This function is called by the reset function of the Strophe Connection.\n               *  Is not needed by WebSockets.\n               */\n\n\n              _reset() {\n                // eslint-disable-line class-methods-use-this\n                return;\n              }\n              /** PrivateFunction: _connect\n               *  _Private_ function called by Strophe.Connection.connect\n               *\n               *  Creates a WebSocket for a connection and assigns Callbacks to it.\n               *  Does nothing if there already is a WebSocket.\n               */\n\n\n              _connect() {\n                // Ensure that there is no open WebSocket from a previous Connection.\n                this._closeSocket();\n\n                this.socket = new WebSocket(this._conn.service, \"xmpp\");\n\n                this.socket.onopen = () => this._onOpen();\n\n                this.socket.onerror = e => this._onError(e);\n\n                this.socket.onclose = e => this._onClose(e); // Gets replaced with this._onMessage once _onInitialMessage is called\n\n\n                this.socket.onmessage = message => this._onInitialMessage(message);\n              }\n              /** PrivateFunction: _connect_cb\n               *  _Private_ function called by Strophe.Connection._connect_cb\n               *\n               * checks for stream:error\n               *\n               *  Parameters:\n               *    (Strophe.Request) bodyWrap - The received stanza.\n               */\n\n\n              _connect_cb(bodyWrap) {\n                const error = this._checkStreamError(bodyWrap, Strophe.Status.CONNFAIL);\n\n                if (error) {\n                  return Strophe.Status.CONNFAIL;\n                }\n              }\n              /** PrivateFunction: _handleStreamStart\n               * _Private_ function that checks the opening <open /> tag for errors.\n               *\n               * Disconnects if there is an error and returns false, true otherwise.\n               *\n               *  Parameters:\n               *    (Node) message - Stanza containing the <open /> tag.\n               */\n\n\n              _handleStreamStart(message) {\n                let error = false; // Check for errors in the <open /> tag\n\n                const ns = message.getAttribute(\"xmlns\");\n\n                if (typeof ns !== \"string\") {\n                  error = \"Missing xmlns in <open />\";\n                } else if (ns !== Strophe.NS.FRAMING) {\n                  error = \"Wrong xmlns in <open />: \" + ns;\n                }\n\n                const ver = message.getAttribute(\"version\");\n\n                if (typeof ver !== \"string\") {\n                  error = \"Missing version in <open />\";\n                } else if (ver !== \"1.0\") {\n                  error = \"Wrong version in <open />: \" + ver;\n                }\n\n                if (error) {\n                  this._conn._changeConnectStatus(Strophe.Status.CONNFAIL, error);\n\n                  this._conn._doDisconnect();\n\n                  return false;\n                }\n\n                return true;\n              }\n              /** PrivateFunction: _onInitialMessage\n               * _Private_ function that handles the first connection messages.\n               *\n               * On receiving an opening stream tag this callback replaces itself with the real\n               * message handler. On receiving a stream error the connection is terminated.\n               */\n\n\n              _onInitialMessage(message) {\n                if (message.data.indexOf(\"<open \") === 0 || message.data.indexOf(\"<?xml\") === 0) {\n                  // Strip the XML Declaration, if there is one\n                  const data = message.data.replace(/^(<\\?.*?\\?>\\s*)*/, \"\");\n                  if (data === '') return;\n                  const streamStart = new DOMParser().parseFromString(data, \"text/xml\").documentElement;\n\n                  this._conn.xmlInput(streamStart);\n\n                  this._conn.rawInput(message.data); //_handleStreamSteart will check for XML errors and disconnect on error\n\n\n                  if (this._handleStreamStart(streamStart)) {\n                    //_connect_cb will check for stream:error and disconnect on error\n                    this._connect_cb(streamStart);\n                  }\n                } else if (message.data.indexOf(\"<close \") === 0) {\n                  // <close xmlns=\"urn:ietf:params:xml:ns:xmpp-framing />\n                  // Parse the raw string to an XML element\n                  const parsedMessage = new DOMParser().parseFromString(message.data, \"text/xml\").documentElement; // Report this input to the raw and xml handlers\n\n                  this._conn.xmlInput(parsedMessage);\n\n                  this._conn.rawInput(message.data);\n\n                  const see_uri = parsedMessage.getAttribute(\"see-other-uri\");\n\n                  if (see_uri) {\n                    const service = this._conn.service; // Valid scenarios: WSS->WSS, WS->ANY\n\n                    const isSecureRedirect = service.indexOf(\"wss:\") >= 0 && see_uri.indexOf(\"wss:\") >= 0 || service.indexOf(\"ws:\") >= 0;\n\n                    if (isSecureRedirect) {\n                      this._conn._changeConnectStatus(Strophe.Status.REDIRECT, \"Received see-other-uri, resetting connection\");\n\n                      this._conn.reset();\n\n                      this._conn.service = see_uri;\n\n                      this._connect();\n                    }\n                  } else {\n                    this._conn._changeConnectStatus(Strophe.Status.CONNFAIL, \"Received closing stream\");\n\n                    this._conn._doDisconnect();\n                  }\n                } else {\n                  this._replaceMessageHandler();\n\n                  const string = this._streamWrap(message.data);\n\n                  const elem = new DOMParser().parseFromString(string, \"text/xml\").documentElement;\n\n                  this._conn._connect_cb(elem, null, message.data);\n                }\n              }\n              /** PrivateFunction: _replaceMessageHandler\n               *\n               * Called by _onInitialMessage in order to replace itself with the general message handler.\n               * This method is overridden by Strophe.WorkerWebsocket, which manages a\n               * websocket connection via a service worker and doesn't have direct access\n               * to the socket.\n               */\n\n\n              _replaceMessageHandler() {\n                this.socket.onmessage = m => this._onMessage(m);\n              }\n              /** PrivateFunction: _disconnect\n               *  _Private_ function called by Strophe.Connection.disconnect\n               *\n               *  Disconnects and sends a last stanza if one is given\n               *\n               *  Parameters:\n               *    (Request) pres - This stanza will be sent before disconnecting.\n               */\n\n\n              _disconnect(pres) {\n                if (this.socket && this.socket.readyState !== WebSocket.CLOSED) {\n                  if (pres) {\n                    this._conn.send(pres);\n                  }\n\n                  const close = $build(\"close\", {\n                    \"xmlns\": Strophe.NS.FRAMING\n                  });\n\n                  this._conn.xmlOutput(close.tree());\n\n                  const closeString = Strophe.serialize(close);\n\n                  this._conn.rawOutput(closeString);\n\n                  try {\n                    this.socket.send(closeString);\n                  } catch (e) {\n                    Strophe.warn(\"Couldn't send <close /> tag.\");\n                  }\n                }\n\n                setTimeout(() => this._conn._doDisconnect(), 0);\n              }\n              /** PrivateFunction: _doDisconnect\n               *  _Private_ function to disconnect.\n               *\n               *  Just closes the Socket for WebSockets\n               */\n\n\n              _doDisconnect() {\n                Strophe.debug(\"WebSockets _doDisconnect was called\");\n\n                this._closeSocket();\n              }\n              /** PrivateFunction _streamWrap\n               *  _Private_ helper function to wrap a stanza in a <stream> tag.\n               *  This is used so Strophe can process stanzas from WebSockets like BOSH\n               */\n\n\n              _streamWrap(stanza) {\n                // eslint-disable-line class-methods-use-this\n                return \"<wrapper>\" + stanza + '</wrapper>';\n              }\n              /** PrivateFunction: _closeSocket\n               *  _Private_ function to close the WebSocket.\n               *\n               *  Closes the socket if it is still open and deletes it\n               */\n\n\n              _closeSocket() {\n                if (this.socket) {\n                  try {\n                    this.socket.onclose = null;\n                    this.socket.onerror = null;\n                    this.socket.onmessage = null;\n                    this.socket.close();\n                  } catch (e) {\n                    Strophe.debug(e.message);\n                  }\n                }\n\n                this.socket = null;\n              }\n              /** PrivateFunction: _emptyQueue\n               * _Private_ function to check if the message queue is empty.\n               *\n               *  Returns:\n               *    True, because WebSocket messages are send immediately after queueing.\n               */\n\n\n              _emptyQueue() {\n                // eslint-disable-line class-methods-use-this\n                return true;\n              }\n              /** PrivateFunction: _onClose\n               * _Private_ function to handle websockets closing.\n               */\n\n\n              _onClose(e) {\n                if (this._conn.connected && !this._conn.disconnecting) {\n                  Strophe.error(\"Websocket closed unexpectedly\");\n\n                  this._conn._doDisconnect();\n                } else if (e && e.code === 1006 && !this._conn.connected && this.socket) {\n                  // in case the onError callback was not called (Safari 10 does not\n                  // call onerror when the initial connection fails) we need to\n                  // dispatch a CONNFAIL status update to be consistent with the\n                  // behavior on other browsers.\n                  Strophe.error(\"Websocket closed unexcectedly\");\n\n                  this._conn._changeConnectStatus(Strophe.Status.CONNFAIL, \"The WebSocket connection could not be established or was disconnected.\");\n\n                  this._conn._doDisconnect();\n                } else {\n                  Strophe.debug(\"Websocket closed\");\n                }\n              }\n              /** PrivateFunction: _no_auth_received\n               *\n               * Called on stream start/restart when no stream:features\n               * has been received.\n               */\n\n\n              _no_auth_received(callback) {\n                Strophe.error(\"Server did not offer a supported authentication mechanism\");\n\n                this._conn._changeConnectStatus(Strophe.Status.CONNFAIL, Strophe.ErrorCondition.NO_AUTH_MECH);\n\n                if (callback) {\n                  callback.call(this._conn);\n                }\n\n                this._conn._doDisconnect();\n              }\n              /** PrivateFunction: _onDisconnectTimeout\n               *  _Private_ timeout handler for handling non-graceful disconnection.\n               *\n               *  This does nothing for WebSockets\n               */\n\n\n              _onDisconnectTimeout() {} // eslint-disable-line class-methods-use-this\n\n              /** PrivateFunction: _abortAllRequests\n               *  _Private_ helper function that makes sure all pending requests are aborted.\n               */\n\n\n              _abortAllRequests() {} // eslint-disable-line class-methods-use-this\n\n              /** PrivateFunction: _onError\n               * _Private_ function to handle websockets errors.\n               *\n               * Parameters:\n               * (Object) error - The websocket error.\n               */\n\n\n              _onError(error) {\n                Strophe.error(\"Websocket error \" + JSON.stringify(error));\n\n                this._conn._changeConnectStatus(Strophe.Status.CONNFAIL, \"The WebSocket connection could not be established or was disconnected.\");\n\n                this._disconnect();\n              }\n              /** PrivateFunction: _onIdle\n               *  _Private_ function called by Strophe.Connection._onIdle\n               *\n               *  sends all queued stanzas\n               */\n\n\n              _onIdle() {\n                const data = this._conn._data;\n\n                if (data.length > 0 && !this._conn.paused) {\n                  for (let i = 0; i < data.length; i++) {\n                    if (data[i] !== null) {\n                      let stanza;\n\n                      if (data[i] === \"restart\") {\n                        stanza = this._buildStream().tree();\n                      } else {\n                        stanza = data[i];\n                      }\n\n                      const rawStanza = Strophe.serialize(stanza);\n\n                      this._conn.xmlOutput(stanza);\n\n                      this._conn.rawOutput(rawStanza);\n\n                      this.socket.send(rawStanza);\n                    }\n                  }\n\n                  this._conn._data = [];\n                }\n              }\n              /** PrivateFunction: _onMessage\n               * _Private_ function to handle websockets messages.\n               *\n               * This function parses each of the messages as if they are full documents.\n               * [TODO : We may actually want to use a SAX Push parser].\n               *\n               * Since all XMPP traffic starts with\n               *  <stream:stream version='1.0'\n               *                 xml:lang='en'\n               *                 xmlns='jabber:client'\n               *                 xmlns:stream='http://etherx.jabber.org/streams'\n               *                 id='3697395463'\n               *                 from='SERVER'>\n               *\n               * The first stanza will always fail to be parsed.\n               *\n               * Additionally, the seconds stanza will always be <stream:features> with\n               * the stream NS defined in the previous stanza, so we need to 'force'\n               * the inclusion of the NS in this stanza.\n               *\n               * Parameters:\n               * (string) message - The websocket message.\n               */\n\n\n              _onMessage(message) {\n                let elem; // check for closing stream\n\n                const close = '<close xmlns=\"urn:ietf:params:xml:ns:xmpp-framing\" />';\n\n                if (message.data === close) {\n                  this._conn.rawInput(close);\n\n                  this._conn.xmlInput(message);\n\n                  if (!this._conn.disconnecting) {\n                    this._conn._doDisconnect();\n                  }\n\n                  return;\n                } else if (message.data.search(\"<open \") === 0) {\n                  // This handles stream restarts\n                  elem = new DOMParser().parseFromString(message.data, \"text/xml\").documentElement;\n\n                  if (!this._handleStreamStart(elem)) {\n                    return;\n                  }\n                } else {\n                  const data = this._streamWrap(message.data);\n\n                  elem = new DOMParser().parseFromString(data, \"text/xml\").documentElement;\n                }\n\n                if (this._checkStreamError(elem, Strophe.Status.ERROR)) {\n                  return;\n                } //handle unavailable presence stanza before disconnecting\n\n\n                if (this._conn.disconnecting && elem.firstChild.nodeName === \"presence\" && elem.firstChild.getAttribute(\"type\") === \"unavailable\") {\n                  this._conn.xmlInput(elem);\n\n                  this._conn.rawInput(Strophe.serialize(elem)); // if we are already disconnecting we will ignore the unavailable stanza and\n                  // wait for the </stream:stream> tag before we close the connection\n\n\n                  return;\n                }\n\n                this._conn._dataRecv(elem, message.data);\n              }\n              /** PrivateFunction: _onOpen\n               * _Private_ function to handle websockets connection setup.\n               *\n               * The opening stream tag is sent here.\n               */\n\n\n              _onOpen() {\n                Strophe.debug(\"Websocket open\");\n\n                const start = this._buildStream();\n\n                this._conn.xmlOutput(start.tree());\n\n                const startString = Strophe.serialize(start);\n\n                this._conn.rawOutput(startString);\n\n                this.socket.send(startString);\n              }\n              /** PrivateFunction: _reqToData\n               * _Private_ function to get a stanza out of a request.\n               *\n               * WebSockets don't use requests, so the passed argument is just returned.\n               *\n               *  Parameters:\n               *    (Object) stanza - The stanza.\n               *\n               *  Returns:\n               *    The stanza that was passed.\n               */\n\n\n              _reqToData(stanza) {\n                // eslint-disable-line class-methods-use-this\n                return stanza;\n              }\n              /** PrivateFunction: _send\n               *  _Private_ part of the Connection.send function for WebSocket\n               *\n               * Just flushes the messages that are in the queue\n               */\n\n\n              _send() {\n                this._conn.flush();\n              }\n              /** PrivateFunction: _sendRestart\n               *\n               *  Send an xmpp:restart stanza.\n               */\n\n\n              _sendRestart() {\n                clearTimeout(this._conn._idleTimeout);\n\n                this._conn._onIdle.bind(this._conn)();\n              }\n\n            };\n\n            /*\n                This program is distributed under the terms of the MIT license.\n                Please see the LICENSE file for details.\n\n                Copyright 2020, JC Brand\n            */\n            const lmap = {};\n            lmap['debug'] = Strophe.LogLevel.DEBUG;\n            lmap['info'] = Strophe.LogLevel.INFO;\n            lmap['warn'] = Strophe.LogLevel.WARN;\n            lmap['error'] = Strophe.LogLevel.ERROR;\n            lmap['fatal'] = Strophe.LogLevel.FATAL;\n            /** Class: Strophe.WorkerWebsocket\n             *  _Private_ helper class that handles a websocket connection inside a shared worker.\n             */\n\n            Strophe.WorkerWebsocket = class WorkerWebsocket extends Strophe.Websocket {\n              /** PrivateConstructor: Strophe.WorkerWebsocket\n               *  Create and initialize a Strophe.WorkerWebsocket object.\n               *\n               *  Parameters:\n               *    (Strophe.Connection) connection - The Strophe.Connection\n               *\n               *  Returns:\n               *    A new Strophe.WorkerWebsocket object.\n               */\n              constructor(connection) {\n                super(connection);\n                this._conn = connection;\n                this.worker = new SharedWorker(this._conn.options.worker, 'Strophe XMPP Connection');\n\n                this.worker.onerror = e => {\n                  var _console;\n\n                  (_console = console) === null || _console === void 0 ? void 0 : _console.error(e);\n                  Strophe.log(Strophe.LogLevel.ERROR, `Shared Worker Error: ${e}`);\n                };\n              }\n\n              get socket() {\n                return {\n                  'send': str => this.worker.port.postMessage(['send', str])\n                };\n              }\n\n              _connect() {\n                this._messageHandler = m => this._onInitialMessage(m);\n\n                this.worker.port.start();\n\n                this.worker.port.onmessage = ev => this._onWorkerMessage(ev);\n\n                this.worker.port.postMessage(['_connect', this._conn.service, this._conn.jid]);\n              }\n\n              _attach(callback) {\n                this._messageHandler = m => this._onMessage(m);\n\n                this._conn.connect_callback = callback;\n                this.worker.port.start();\n\n                this.worker.port.onmessage = ev => this._onWorkerMessage(ev);\n\n                this.worker.port.postMessage(['_attach', this._conn.service]);\n              }\n\n              _attachCallback(status, jid) {\n                if (status === Strophe.Status.ATTACHED) {\n                  this._conn.jid = jid;\n                  this._conn.authenticated = true;\n                  this._conn.connected = true;\n                  this._conn.restored = true;\n\n                  this._conn._changeConnectStatus(Strophe.Status.ATTACHED);\n                } else if (status === Strophe.Status.ATTACHFAIL) {\n                  this._conn.authenticated = false;\n                  this._conn.connected = false;\n                  this._conn.restored = false;\n\n                  this._conn._changeConnectStatus(Strophe.Status.ATTACHFAIL);\n                }\n              }\n\n              _disconnect(readyState, pres) {\n                pres && this._conn.send(pres);\n                const close = $build(\"close\", {\n                  \"xmlns\": Strophe.NS.FRAMING\n                });\n\n                this._conn.xmlOutput(close.tree());\n\n                const closeString = Strophe.serialize(close);\n\n                this._conn.rawOutput(closeString);\n\n                this.worker.port.postMessage(['send', closeString]);\n\n                this._conn._doDisconnect();\n              }\n\n              _onClose(e) {\n                if (this._conn.connected && !this._conn.disconnecting) {\n                  Strophe.error(\"Websocket closed unexpectedly\");\n\n                  this._conn._doDisconnect();\n                } else if (e && e.code === 1006 && !this._conn.connected) {\n                  // in case the onError callback was not called (Safari 10 does not\n                  // call onerror when the initial connection fails) we need to\n                  // dispatch a CONNFAIL status update to be consistent with the\n                  // behavior on other browsers.\n                  Strophe.error(\"Websocket closed unexcectedly\");\n\n                  this._conn._changeConnectStatus(Strophe.Status.CONNFAIL, \"The WebSocket connection could not be established or was disconnected.\");\n\n                  this._conn._doDisconnect();\n                } else {\n                  Strophe.debug(\"Websocket closed\");\n                }\n              }\n\n              _closeSocket() {\n                this.worker.port.postMessage(['_closeSocket']);\n              }\n              /** PrivateFunction: _replaceMessageHandler\n               *\n               * Called by _onInitialMessage in order to replace itself with the general message handler.\n               * This method is overridden by Strophe.WorkerWebsocket, which manages a\n               * websocket connection via a service worker and doesn't have direct access\n               * to the socket.\n               */\n\n\n              _replaceMessageHandler() {\n                this._messageHandler = m => this._onMessage(m);\n              }\n              /** PrivateFunction: _onWorkerMessage\n               * _Private_ function that handles messages received from the service worker\n               */\n\n\n              _onWorkerMessage(ev) {\n                const {\n                  data\n                } = ev;\n                const method_name = data[0];\n\n                if (method_name === '_onMessage') {\n                  this._messageHandler(data[1]);\n                } else if (method_name in this) {\n                  try {\n                    this[method_name].apply(this, ev.data.slice(1));\n                  } catch (e) {\n                    Strophe.log(Strophe.LogLevel.ERROR, e);\n                  }\n                } else if (method_name === 'log') {\n                  const level = data[1];\n                  const msg = data[2];\n                  Strophe.log(lmap[level], msg);\n                } else {\n                  Strophe.log(Strophe.LogLevel.ERROR, `Found unhandled service worker message: ${data}`);\n                }\n              }\n\n            };\n\n            global$1.$build = core.$build;\n            global$1.$iq = core.$iq;\n            global$1.$msg = core.$msg;\n            global$1.$pres = core.$pres;\n            global$1.Strophe = core.Strophe;\n            const {\n              b64_sha1\n            } = SHA1;\n\n            exports.$build = $build;\n            exports.$iq = $iq;\n            exports.$msg = $msg;\n            exports.$pres = $pres;\n            exports.Strophe = Strophe;\n            exports.b64_sha1 = b64_sha1;\n\n            Object.defineProperty(exports, '__esModule', { value: true });\n\n}));\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","__webpack_require__.amdO = {};","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","// startup\n// Load entry module and return exports\n// This entry module is referenced by other modules so it can't be inlined\nvar __webpack_exports__ = __webpack_require__(154);\n"],"names":["root","factory","exports","module","define","amd","self","value","other","array","key","length","eq","splice","Array","prototype","ListCache","entries","index","this","clear","entry","set","__data__","size","data","assocIndexOf","pop","call","get","undefined","has","push","global","Object","freeSelf","freeGlobal","Function","Symbol","objectProto","hasOwnProperty","nativeObjectToString","toString","symToStringTag","toStringTag","isOwn","tag","unmasked","e","result","getRawTag","objectToString","type","isObject","baseGetTag","uid","maskSrcKey","exec","coreJsData","keys","IE_PROTO","funcToString","func","reIsHostCtor","funcProto","reIsNative","RegExp","replace","isFunction","test","toSource","object","getValue","baseIsNative","getNative","Hash","nativeCreate","map","MapCache","Map","getMapData","Stack","pairs","LARGE_ARRAY_SIZE","defineProperty","baseAssignValue","iteratee","keysFunc","iterable","props","freeExports","nodeType","freeModule","Buffer","allocUnsafe","buffer","isDeep","slice","constructor","copy","Uint8Array","arrayBuffer","byteLength","typedArray","cloneArrayBuffer","byteOffset","source","objectCreate","create","proto","transform","arg","overArg","getPrototypeOf","Ctor","isPrototype","baseCreate","getPrototype","isObjectLike","propertyIsEnumerable","isArguments","baseIsArguments","arguments","isArray","isLength","isBuffer","objectCtorString","typedArrayTags","freeProcess","process","require","types","binding","nodeIsTypedArray","nodeUtil","isTypedArray","baseUnary","objValue","customizer","isNew","newValue","assignValue","reIsUint","inherited","isArr","isArg","isBuff","isType","skipIndexes","n","baseTimes","String","isIndex","nativeKeysIn","isProto","isArrayLike","arrayLikeKeys","baseKeysIn","srcIndex","mergeFunc","stack","safeGet","srcValue","stacked","assignMergeValue","isCommon","isTyped","copyArray","cloneBuffer","cloneTypedArray","isPlainObject","copyObject","keysIn","toPlainObject","initCloneObject","baseMerge","baseFor","baseMergeDeep","nativeMax","Math","max","string","identity","nativeNow","Date","now","baseSetToString","count","lastCalled","stamp","remaining","apply","start","setToString","args","otherArgs","thisArg","overRest","assigner","baseRest","sources","guard","isIterateeCall","JitsiConferenceErrors","AUTH_ERROR_TYPES","AUTHENTICATION_REQUIRED","CHAT_ERROR","SETTINGS_ERROR","CONFERENCE_DESTROYED","CONFERENCE_MAX_USERS","CONNECTION_ERROR","NOT_ALLOWED_ERROR","MEMBERS_ONLY_ERROR","CONFERENCE_ACCESS_DENIED","DISPLAY_NAME_REQUIRED","FOCUS_DISCONNECTED","FOCUS_LEFT","GRACEFUL_SHUTDOWN","ICE_FAILED","INCOMPATIBLE_SERVER_VERSIONS","OFFER_ANSWER_FAILED","PASSWORD_NOT_SUPPORTED","PASSWORD_REQUIRED","RESERVATION_ERROR","VIDEOBRIDGE_NOT_AVAILABLE","JitsiConferenceEvents","SetCache","values","add","predicate","bitmask","equalFunc","isPartial","arrLength","othLength","arrStacked","othStacked","seen","arrValue","othValue","compared","arraySome","othIndex","forEach","symbolProto","symbolValueOf","valueOf","offset","symbolsFunc","arrayPush","nativeGetSymbols","getOwnPropertySymbols","resIndex","arrayFilter","symbol","stubArray","nativeKeys","baseKeys","baseGetAllKeys","getSymbols","mapTag","promiseTag","setTag","weakMapTag","dataViewTag","dataViewCtorString","DataView","mapCtorString","promiseCtorString","Promise","setCtorString","Set","weakMapCtorString","WeakMap","getTag","ArrayBuffer","resolve","ctorString","argsTag","arrayTag","objectTag","objIsArr","othIsArr","objTag","othTag","objIsObj","othIsObj","isSameTag","equalArrays","name","message","convert","mapToArray","setToArray","equalByTag","objIsWrapped","othIsWrapped","objUnwrapped","othUnwrapped","objProps","getAllKeys","objLength","objStacked","skipCtor","objCtor","othCtor","equalObjects","baseIsEqual","baseIsEqualDeep","JitsiTrackEvents","Browser","PARSER_TO_JITSI_NAME","CHROME","FIREFOX","SAFARI","ELECTRON","Engine","ENGINES","BLINK","WEBKIT","GECKO","_getJitsiBrowserInfo","browserInfo","engine","engineVersion","version","BrowserDetection","_parser","UAParser","navigator","userAgent","parser","reactNativeInfo","match","product","REACT_NATIVE","_detectReactNative","getBrowser","getEngine","_detect","_name","_version","_engine","_engineVersion","isChrome","isFirefox","isSafari","isElectron","isReactNative","isChromiumBased","isWebKitBased","getName","getVersion","getEngineVersion","getOS","getOSVersion","isVersionGreaterThan","parseInt","isVersionLessThan","isVersionEqualTo","isEngineVersionGreaterThan","isEngineVersionLessThan","isEngineVersionEqualTo","logger","getLogger","deltaCompression","oldStats","newStatsArg","newStats","JSON","parse","stringify","id","report","timestamp","dumpStream","stream","tracks","getTracks","track","kind","label","enabled","muted","readyState","getRandomValues","rnds8","rng","crypto","bind","msCrypto","Error","byteToHex","i","substr","arr","uuid","toLowerCase","REGEX","validate","TypeError","options","buf","rnds","random","MAX_RECONNECT_TIME","CUSTOM_ERROR_CODES","obfuscateIP","ip","indexOf","obfuscateCandidate","candidate","cand","SDPUtils","protocol","address","relatedAddress","_ref","parentStatsSessionId","connection","keepAliveInterval","reconnectTimeout","endpoint","meetingFqn","onCloseCallback","useLegacy","obfuscate","pingInterval","statsSessionId","uuidv4","reconnectSpentTime","canSendMessage","sequenceNumber","protocolVersion","setTransportParams","getTime","sendMessage","msg","copyMsg","assign","WebSocket","OPEN","send","trace","isConnected","isClosed","CLOSED","_len","_key","statsEntry","_len2","_key2","myData","jsonRepr","sdp","line","join","trim","stats","candidateType","port","splitBy","split","obfuscator","keepAlive","close","connect","isBreakoutRoom","isReconnect","headers","onclose","closeEvent","clearInterval","code","reason","includes","reconnectTimeoutTimeCandidate","floor","reconnectTimeoutTime","setTimeout","onopen","setInterval","onmessage","async","body","state","firstSN","lastSN","lastReceivedSNIndex","findIndex","clearTimeout","DummyLocalStorage","EventEmitter","_storage","getItem","keyName","setItem","keyValue","removeItem","serialize","ignore","storageCopy","JitsiLocalStorage","super","window","localStorage","_localStorageDisabled","console","warn","isLocalStorageDisabled","setLocalStorageDisabled","emit","dontEmitChangedEvent","localStorageContent","jitsiLocalStorage","safeJsonParse","BourneParse","randomInt","min","randomElement","randomAlphanumStr","randomHexDigit","randomHexString","len","ret","names","_callStatsUserName","_machineId","callStatsUserName","username","info","_generateStatsId","init","externalStorage","machineId","amDid","jitsiMeetId","replaceAll","generateJitsiMeetId","sessionId","NodeEventEmitter","addEventListener","addListener","removeEventListener","removeListener","RTCStatsEvents","DefaultLogStorage","rtcStats","isReady","isTraceAvailable","storeLogs","logEntries","RTCStats","sendStatsEntry","LOG_EVENT","_defineProperty","_trace","startWithConnection","_options$name","_this$_defaultLogColl","analytics","rtcstatsEndpoint","rtcstatsEnabled","rtcstatsPollInterval","pollInterval","rtcstatsSendSdp","sendSdp","_initialized","_ref2","connectionFilter","prefixesToWrap","eventCallback","peerconnectioncounter","browserDetection","prefix","OrigPeerConnection","peerconnection","config","constraints","origConfig","optional","isP2P","some","option","rtcStatsSFUP2P","pc","__rtcStatsId","nullConfig","iceServers","server","credential","browserType","__dtlsTransport","t","streams","signalingState","iceConnectionState","pcId","iceGatheringState","connectionState","event","channel","prev","getStats","then","res","m","o","v","k","map2obj","base","response","standardReport","standardStats","stat","mangleChromeStats","interval","error","method","nativeMethod","streamInfo","s","trackOrKind","opts","rtcStatsId","description","err","endsWith","getSenders","sender","transport","newstate","generateCertificate","origGetUserMedia","cb","eb","mediaDevices","getUserMedia","gum","reject","getDisplayMedia","origGetDisplayMedia","gdm","rtcstatsInit","events","RTC_STATS_PC_EVENT","traceOptions","_connectTrace","_defaultLogCollector","flush","sendIdentity","confName","_startedWithNewConnection","attachToConference","conference","_Settings$callStatsUs","confConfig","_statsCurrentId","displayName","localId","Settings","once","CONFERENCE_JOINED","_conference$getBreako","Boolean","getBreakoutRooms","endpointId","myUserId","meetingUniqueId","getMeetingUniqueId","_this$_defaultLogColl2","identityData","CONFERENCE_UNIQUE_ID_SET","CONFERENCE_LEFT","reset","CONFERENCE_CREATED_TIMESTAMP","CONFERENCE_START_TIMESTAMP_EVENT","BEFORE_STATISTICS_DISPOSED","_this$_defaultLogColl3","traceOptionsComplete","RTC_STATS_WC_DISCONNECTED","traceInit","_this$_trace","_this$_defaultLogColl4","_this$_trace2","statsType","_this$_trace3","getDefaultLogCollector","maxEntryLength","Logger","AnalyticsEvents","createConferenceEvent","action","attributes","TYPE_OPERATIONAL","createConnectionStageReachedEvent","stage","actionSubject","createGetUserMediaEvent","createJingleEvent","createP2PEvent","createRemotelyMutedEvent","mediaType","createRtpStatsEvent","StatisticsEvents","_getIOSVersion","Number","_getSafariVersion","doesVideoMuteByStreamRemove","isAndroidBrowser","isIosBrowser","isMobileDevice","isTwa","matchMedia","matches","isSupported","_navigator","_navigator2","RTCPeerConnection","enumerateDevices","MIN_REQUIRED_CHROME_VERSION","MIN_REQUIRED_FIREFOX_VERSION","isSupportedAndroidBrowser","isSupportedIOSBrowser","isUserInteractionRequiredForUnmute","supportsVideoMuteOnConnInterrupted","supportsBandwidthStatistics","supportsCodecPreferences","_window$RTCRtpTransce","_window$RTCRtpReceive","RTCRtpTransceiver","RTCRtpReceiver","getCapabilities","supportsCodecSelectionAPI","supportsDDExtHeaders","supportsDeviceChangeEvent","_navigator$mediaDevic","_navigator$mediaDevic2","ondevicechange","supportsReceiverStats","supportsRTTStatistics","supportsScalabilityModeAPI","supportsTrackBasedStats","supportsVP9","supportsSVC","usesSdpMungingForSimulcast","usesRidsForSimulcast","supportsGetDisplayMedia","_navigator$mediaDevic3","supportsEncodedTransform","RTCRtpScriptTransform","supportsInsertableStreams","_window$RTCRtpSender","RTCRtpSender","createEncodedStreams","ReadableStream","postMessage","supportsAudioRed","_window$RTCRtpSender2","_window$RTCRtpReceive2","codecs","codec","mimeType","supportsVADDetection","supportsRTX","_analytics$watchRTCEn","watchRTCEnabled","isWatchRTCEnabled","browser","disableThirdPartyRequests","disabled","isAnalyticsEnabled","_options$watchRTCConf","watchRTCConfigParams","rtcApiKey","watchRTC","roomName","userName","rtcRoomId","rtcPeerId","_maybeCacheEvent","cache","_sendEvent","analyticsHandlers","handler","sendEvent","_setUserProperties","setUserProperties","permanentProperties","_verifyRequiredFields","TYPE_PAGE","TYPE_UI","TYPE_TRACK","objectType","containerType","containerId","conferenceName","objectId","addPermanentProperties","properties","dispose","debug","setAnalyticsHandlers","disposed","eventName","handlers","setConferenceName","context","LocalStatsCollector","callback","intervalId","intervalMilis","audioLevel","analyser","isLocalStatsSupported","resume","createAnalyser","smoothingTimeConstant","fftSize","createMediaStreamSource","frequencyBinCount","getByteTimeDomainData","samples","maxVolume","parseFloat","toFixed","timeDomainDataToAudioLevel","newLevel","lastLevel","diff","animateLevel","stop","_this$analyser","_this$source","disconnect","connectAudioContext","_window","AudioContext","disconnectAudioContext","suspend","MediaType","flags","_runInLiteMode","runInLiteMode","_ssrcRewriting","ssrcRewritingEnabled","isRunInLiteModeEnabled","isSsrcRewritingSupported","safeCounterIncrement","number","nextValue","MAX_SAFE_INTEGER","calculateAverage","valueArray","reduce","a","b","filterPositiveValues","from","filter","safeSubtract","x","y","isValidNumber","isFinite","calculatePacketLoss","lostPackets","totalPackets","round","SsrcStats","loss","bitrate","download","upload","resolution","framerate","setLoss","setResolution","addBitrate","resetBitrate","setFramerate","setCodec","setEncodeStats","encodeStats","ConferenceStats","bandwidth","packetLoss","StatsCollector","audioLevelsInterval","statsInterval","eventEmitter","currentStatsReport","previousStatsReport","audioLevelsIntervalId","conferenceStats","audioLevelsIntervalMilis","speakerList","statsIntervalId","statsIntervalMilis","ssrc2stats","setSpeakerList","errorCallback","startAudioLevelStats","audioLevels","getAudioLevels","ssrc","AUDIO_LEVEL","processStats","processStatsReport","catch","_processAndEmitReport","bitrateDownload","bitrateUpload","resolutions","framerates","audioBitrateDownload","audioBitrateUpload","videoBitrateDownload","videoBitrateUpload","ssrcStats","_codecs$participantId","isDownloadStream","packetsTotal","packetsLost","ssrcBitrateDownload","ssrcBitrateUpload","getTrackBySSRC","audioCodec","videoCodec","isAudioTrack","participantId","getParticipantId","FeatureFlags","userCodecs","audio","video","isVideoTrack","height","width","userResolutions","isLocal","doesTrueSimulcast","localSsrcs","getLocalVideoSSRCs","localSsrc","_this$ssrc2stats$get","ssrcResolution","userFramerates","total","CONNECTION_STATS","getNonNegativeValue","_calculateBitrate","before","fieldName","bytesNow","bytesBefore","bytesProcessed","timeMs","bitrateKbps","_calculateFps","frameRate","byteSentStats","encodedTimeStatsPerSsrc","nominated","availableIncomingBitrate","availableOutgoingBitrate","remoteUsedCandidate","remoteCandidateId","localUsedCandidate","localCandidateId","localip","conferenceStatsTransport","localCandidateType","networkType","p2p","remoteCandidateType","rtt","currentRoundTripTime","packetsNow","packetsBefore","packetsDiff","packetsLostNow","packetsLostBefore","packetsLostDiff","frameHeight","frameWidth","_now$active","isStreamActive","active","framesPerSecond","bytesSent","codecId","codecShortType","totalEncodeTime","framesEncoded","encodeTimeStats","encodeTime","qualityLimitationReason","VIDEO","remoteSource","localVideoTracks","getLocalTracks","getSsrcByTrackId","trackIdentifier","BYTE_SENT_STATS","ENCODE_TIME_STATS","Statistics","instances","_instances","audioLevelsEnabled","disableAudioLevels","pcStatsInterval","LocalStats","WatchRTC","startLocalStats","NO_DATA_FROM_SOURCE","localStat","localStats","LOCAL_TRACK_STOPPED","stopLocalStats","getOriginalStream","sendAnalyticsAndLog","eventToLog","sendAnalytics","rtpStatsMap","xmpp","startRemoteStats","stopRemoteStats","rtpStats","RTPStats","addAudioLevelListener","listener","on","removeAudioLevelListener","addBeforeDisposedListener","BEFORE_DISPOSED","removeBeforeDisposedListener","addConnectionStatsListener","removeConnectionStatsListener","addEncodeTimeStatsListener","removeEncodeTimeStatsListener","addByteSentStatsListener","removeByteSentStatsListener","tpcId","_stopRemoteStats","removeAllListeners","delete","tpc","sendFeedback","overall","comment","FEEDBACK","rating","EventEmitterForwarder","src","dest","listeners","forward","srcEvent","newListener","removeListeners","l","RTCEvents","AuthenticationEvents","XMPPEvents","JitsiConferenceEventManager","xmppListeners","_addConferenceXMPPListener","setupChatRoomListeners","chatRoom","room","chatRoomForwarder","PARTICIPANT_FEATURES_CHANGED","features","participant","getParticipantById","Strophe","getResourceFromJid","setFeatures","PARTCIPANT_FEATURES_CHANGED","PERMISSIONS_RECEIVED","AUDIO_MUTED_BY_FOCUS","actor","AUDIO","mutedByFocusActor","rtc","setAudioMute","isMutedByFocus","VIDEO_MUTED_BY_FOCUS","mutedVideoByFocusActor","setVideoMute","isVideoMutedByFocus","DESKTOP_MUTED_BY_FOCUS","DESKTOP","mutedDesktopByFocusActor","setDesktopMute","isDesktopMutedByFocus","SUBJECT_CHANGED","MUC_JOINED","MUC_JOIN_IN_PROGRESS","CONFERENCE_JOIN_IN_PROGRESS","MEETING_ID_SET","CONFERENCE_TIMESTAMP_RECEIVED","_onMucJoined","isJvbConnectionInterrupted","connectionTimes","TRACK_OWNER_SET","owner","sourceName","videoType","getSourceName","TRACK_REMOVED","setOwner","setSourceName","_setVideoType","TRACK_ADDED","ROOM_JOIN_ERROR","CONFERENCE_FAILED","ROOM_CONNECT_ERROR","ROOM_CONNECT_NOT_ALLOWED_ERROR","ROOM_CONNECT_MEMBERS_ONLY_ERROR","ROOM_MAX_USERS_ERROR","BRIDGE_DOWN","MUC_DESTROYED","CHAT_ERROR_RECEIVED","CONFERENCE_ERROR","SETTINGS_ERROR_RECEIVED","SESSION_ACCEPT_TIMEOUT","jingleSession","ACTION_JINGLE_SA_TIMEOUT","RECORDER_STATE_CHANGED","session","jid","resource","getStatus","setTerminator","setInitiator","TRANSCRIPTION_STATUS_CHANGED","VIDEO_SIP_GW_AVAILABILITY_CHANGED","VIDEO_SIP_GW_SESSION_STATE_CHANGED","PHONE_NUMBER_CHANGED","setParticipantPropertyListener","prop","setProperty","KICKED","onMemberKicked","SUSPEND_DETECTED","onSuspendDetected","MUC_LOCK_CHANGED","LOCK_STATE_CHANGED","MUC_MEMBERS_ONLY_CHANGED","MEMBERS_ONLY_CHANGED","MUC_VISITORS_SUPPORTED_CHANGED","VISITORS_SUPPORTED_CHANGED","MUC_MEMBER_JOINED","onMemberJoined","MUC_LOBBY_MEMBER_JOINED","LOBBY_USER_JOINED","MUC_LOBBY_MEMBER_UPDATED","LOBBY_USER_UPDATED","MUC_LOBBY_MEMBER_LEFT","LOBBY_USER_LEFT","MUC_MEMBER_BOT_TYPE_CHANGED","_onMemberBotTypeChanged","MUC_MEMBER_LEFT","onMemberLeft","MUC_LEFT","MUC_DENIED_ACCESS","DISPLAY_NAME_CHANGED","onDisplayNameChanged","SILENT_STATUS_CHANGED","onSilentStatusChanged","LOCAL_ROLE_CHANGED","role","onLocalRoleChanged","MUC_ROLE_CHANGED","onUserRoleChanged","IDENTITY_UPDATED","authEnabled","authIdentity","AUTH_STATUS_CHANGED","MESSAGE_RECEIVED","txt","myJid","ts","isVisitor","messageId","replyToId","POLLS_RECEIVE_EVENT","POLL_RECEIVED","POLLS_ANSWER_EVENT","POLL_ANSWER_RECEIVED","REACTION_RECEIVED","reactionList","PRIVATE_MESSAGE_RECEIVED","ofrom","PRESENCE_STATUS","status","_status","USER_STATUS_CHANGED","JSON_MESSAGE_RECEIVED","payload","ENDPOINT_MESSAGE_RECEIVED","NON_PARTICIPANT_MESSAGE_RECEIVED","BREAKOUT_ROOMS_MOVE_TO_ROOM","BREAKOUT_ROOMS_UPDATED","FILE_SHARING_FILES_RECEIVED","FILE_SHARING_FILE_ADDED","FILE_SHARING_FILE_REMOVED","ROOM_METADATA_UPDATED","metadata","startMuted","_updateStartMutedPolicy","recording","isTranscribingEnabled","_setTranscribingEnabled","METADATA_UPDATED","setupRTCListeners","REMOTE_TRACK_ADDED","onRemoteTrackAdded","REMOTE_TRACK_REMOVED","onRemoteTrackRemoved","DOMINANT_SPEAKER_CHANGED","dominant","previous","silence","lastDominantSpeaker","dominantSpeakerIsSilent","statistics","sendDominantSpeakerEvent","roomjid","DOMINANT_SPEAKER_CHANGED_EVENT","DATA_CHANNEL_OPEN","performance","DATA_CHANNEL_OPENED","DATA_CHANNEL_CLOSED","ev","VIDEO_SSRCS_REMAPPED","jvbJingleSession","processSourceMap","AUDIO_SSRCS_REMAPPED","BRIDGE_BWE_STATS_RECEIVED","bwe","ENDPOINT_STATS_RECEIVED","setupStatisticsListeners","level","setAudioLevel","ENCODE_TIME_STATS_RECEIVED","startSilent","getLocalSSRC","onByteSentStatsReceived","setupXMPPListeners","CALL_INCOMING","onIncomingCall","CALL_ACCEPTED","onCallAccepted","TRANSPORT_INFO","onTransportInfo","CALL_ENDED","onCallEnded","AV_MODERATION_CHANGED","actorJid","actorParticipant","getParticipants","find","p","getJid","AV_MODERATION_PARTICIPANT_APPROVED","AV_MODERATION_PARTICIPANT_REJECTED","AV_MODERATION_APPROVED","AV_MODERATION_REJECTED","VISITORS_MESSAGE","VISITORS_REJECTION","removeXMPPListeners","JitsiConnectionEvents","CONNECTION_DISCONNECTED","CONNECTION_ESTABLISHED","CONNECTION_FAILED","CONNECTION_REDIRECTED","PROPERTIES_UPDATED","JitsiParticipant","hidden","statsID","isReplacing","isReplaced","isSilent","_jid","_id","_conference","_displayName","_supportsDTMF","_tracks","_role","_hidden","_statsID","_properties","_identity","_isReplacing","_isReplaced","_isSilent","_features","_sources","_isMediaTypeMuted","getType","isMuted","_setSources","_sourceByMediaType","sourceByMediaType","sourceInfo","getBotType","_botType","getConference","getConnectionJid","_connectionJid","getDisplayName","getFeatures","getId","getIdentity","getProperty","getRole","getSources","getStatsID","getTracksByMediaType","hasFeature","feature","isAudioMuted","isHidden","isHiddenFromRecorder","_this$_identity","user","isModerator","isVideoMuted","setBotType","newBotType","setConnectionJid","newJid","newFeatures","setIsReplaced","newIsReplaced","setIsReplacing","newIsReplacing","setIsSilent","newIsSilent","oldValue","PARTICIPANT_PROPERTY_CHANGED","setRole","newRole","supportsDTMF","JitsiTrackErrors","CONSTRAINT_FAILED","ELECTRON_DESKTOP_PICKER_ERROR","ELECTRON_DESKTOP_PICKER_NOT_FOUND","GENERAL","NOT_FOUND","PERMISSION_DENIED","SCREENSHARING_GENERIC_ERROR","SCREENSHARING_NOT_SUPPORTED_ERROR","SCREENSHARING_USER_CANCELED","TIMEOUT","TRACK_IS_DISPOSED","TRACK_NO_STREAM_FOUND","UNSUPPORTED_RESOLUTION","TRACK_TOO_MANY_TRACKS_IN_STREAM","TRACK_NO_STREAM_TRACKS_FOUND","TRACK_ERROR_TO_MESSAGE_MAP","JitsiTrackError","devices","constraintName","constraint","getResolutionFromFailedConstraint","failedConstraintName","_constraints$video","mandatory","minWidth","minHeight","getSymbolsIn","reFlags","regexp","dataView","cloneDataView","lastIndex","nodeIsMap","isMap","nodeIsSet","isSet","funcTag","cloneableTags","baseClone","isFlat","isFull","input","initCloneArray","isFunc","copySymbolsIn","baseAssignIn","copySymbols","baseAssign","initCloneByTag","subValue","getAllKeysIn","arrayEach","CLONE_DEEP_FLAG","VideoType","Listenable","eventId","off","addCancellableListener","listenerCount","BridgeChannel","wsUrl","emitter","_channel","_connected","_eventEmitter","_mode","_areRetriesEnabled","_closedFromClient","datachannel","createDataChannel","_handleChannel","_wsUrl","_initWebSocket","ws","_startConnectionRetries","timeoutS","reload","CONNECTING","isOpen","_retryTimeout","_stopConnectionRetries","_retryWebSocketConnection","createBridgeChannelClosedEvent","mode","sendEndpointStatsMessage","_send","colibriClass","to","msgPayload","sendSetLastNMessage","lastN","sendReceiverAudioSubscriptionMessage","_message$list","list","sendReceiverVideoConstraintsMessage","sendSourceVideoTypeMessage","onerror","obj","estimatedDownlinkBandwidth","dominantSpeakerEndpoint","previousSpeakers","isActive","ENDPOINT_CONN_STATUS_CHANGED","forwardedSources","FORWARDED_SOURCES_CHANGED","maxHeight","SENDER_VIDEO_CONSTRAINTS_CHANGED","mappedSources","getParticipantCount","jsonObject","CameraFacingMode","logDisabled_","deprecationWarnings_","extractVersion","uastring","expr","pos","wrapPeerConnectionEvent","eventNameToWrap","wrapper","nativeAddEventListener","nativeEventName","wrappedCallback","modifiedEvent","handleEvent","_eventMap","nativeRemoveEventListener","unwrappedCb","enumerable","configurable","disableLog","bool","disableWarnings","log","deprecated","oldMethod","newMethod","val","compactObject","accumulator","isObj","isEmptyObject","walkStats","resultSet","filterStats","outbound","streamStatsType","filteredResult","trackStats","trackStat","trackId","logging","utils","shimGetUserMedia","browserDetails","constraintsToChrome_","c","cc","r","ideal","exact","oldname_","charAt","toUpperCase","oc","mix","advanced","concat","shimConstraints_","remap","face","facingMode","getSupportedFacingModeLies","getSupportedConstraints","dev","d","deviceId","shimError_","PermissionDeniedError","PermissionDismissedError","InvalidStateError","DevicesNotFoundError","ConstraintNotSatisfiedError","TrackStartError","MediaDeviceFailedDueToShutdown","MediaDeviceKillSwitchOn","TabCaptureError","ScreenCaptureError","DeviceCaptureError","onSuccess","onError","webkitGetUserMedia","cs","getAudioTracks","getVideoTracks","DOMException","shimGetDisplayMedia","getSourceId","sourceId","widthSpecified","heightSpecified","frameRateSpecified","chromeMediaSource","chromeMediaSourceId","maxFrameRate","maxWidth","shimMediaStream","MediaStream","webkitMediaStream","shimOnTrack","_ontrack","f","origSetRemoteDescription","setRemoteDescription","_ontrackpoly","te","receiver","getReceivers","Event","transceiver","dispatchEvent","shimGetSendersWithDtmf","shimSenderWithDtmf","dtmf","_dtmf","createDTMFSender","_pc","_senders","origAddTrack","addTrack","origRemoveTrack","removeTrack","idx","origAddStream","addStream","origRemoveStream","removeStream","origGetSenders","senders","shimGetStats","origGetStats","selector","onSucc","onErr","fixChromeStats_","localcandidate","remotecandidate","makeMapStats","successCallbackWrapper_","shimSenderReceiverGetStats","origGetReceivers","receivers","srcElement","MediaStreamTrack","shimAddTrackRemoveTrackWithNative","getLocalStreams","_shimmedLocalStreams","streamId","existingSenders","newSenders","newSender","shimAddTrackRemoveTrack","origGetLocalStreams","nativeStreams","_reverseStreams","_streams","newStream","replaceInternalStreamId","internalId","externalStream","internalStream","RTCSessionDescription","oldStream","methodObj","desc","origSetLocalDescription","setLocalDescription","replaceExternalStreamId","origLocalDescription","getOwnPropertyDescriptor","streamid","shimPeerConnection","webkitRTCPeerConnection","RTCIceCandidate","fixNegotiationNeeded","target","getConfiguration","sdpSemantics","nativeGetUserMedia","getSettings","nativeGetSettings","applyConstraints","nativeApplyConstraints","preferredMediaSource","mediaSource","RTCTrackEvent","mozRTCPeerConnection","modernStatsTypes","inboundrtp","outboundrtp","candidatepair","nativeGetStats","shimSenderGetStats","shimReceiverGetStats","shimRemoveStream","shimRTCDataChannel","DataChannel","RTCDataChannel","shimAddTransceiver","origAddTransceiver","addTransceiver","setParametersPromises","initParameters","shouldPerformCheck","sendEncodings","encodingParam","rid","scaleResolutionDownBy","RangeError","maxFramerate","params","getParameters","encodings","setParameters","shimGetParameters","origGetParameters","shimCreateOffer","origCreateOffer","createOffer","all","finally","shimCreateAnswer","origCreateAnswer","createAnswer","shimLocalStreamsAPI","_localStreams","_addTrack","shimRemoteStreamsAPI","getRemoteStreams","_remoteStreams","_onaddstream","_onaddstreampoly","shimCallbacksAPI","addIceCandidate","successCallback","failureCallback","promise","withCallback","_getUserMedia","shimConstraints","errcb","shimRTCIceServerUrls","pcConfig","pcConstraints","newIceServers","urls","url","shimTrackEventTransceiver","shimCreateOfferLegacy","offerOptions","offerToReceiveAudio","audioTransceiver","getTransceivers","direction","setDirection","offerToReceiveVideo","videoTransceiver","shimAudioContext","webkitAudioContext","shimRTCIceCandidate","NativeRTCIceCandidate","nativeCandidate","parsedCandidate","augmentedCandidate","toJSON","sdpMid","sdpMLineIndex","usernameFragment","writable","shimMaxMessageSize","_sctp","sections","shift","mediaSection","mLine","sctpInDescription","getRemoteFirefoxVersion","canSendMMS","remoteIsFirefox","canSendMaxMessageSize","getCanSendMaxMessageSize","remoteMMS","maxMessageSize","getMaxMessageSize","POSITIVE_INFINITY","sctp","shimSendThrowTypeError","wrapDcSend","dc","origDataChannelSend","origCreateDataChannel","dataChannel","shimConnectionState","completed","checking","_onconnectionstatechange","origMethod","_connectionstatechangepoly","_lastConnectionState","newEvent","removeExtmapAllowMixed","nativeSRD","shimAddIceCandidateNullOrEmpty","nativeAddIceCandidate","shimParameterlessSetLocalDescription","nativeSetLocalDescription","shimChrome","shimFirefox","shimSafari","mozGetUserMedia","isSecureContext","RTCIceGatherer","supportsUnifiedPlan","adapter","commonShim","chromeShim","browserShim","firefoxShim","safariShim","adapterFactory","obtainStream","_createObtainStreamMethod","_electronSkipDisplayMedia","_obtainScreenOnElectron","obtainScreenFromGetDisplayMediaRN","_obtainScreenFromGetDisplayMedia","_getAudioConstraints","_this$options$testing","audioQuality","isTestModeEnabled","testing","testMode","supportsRestrictOwnAudio","needsEchoCancellation","stereo","defaultAudioConstraints","autoGainControl","channelCount","echoCancellation","noiseSuppression","restrictOwnAudio","onFailure","_window$JitsiMeetScre","_this","JitsiMeetScreenObtainer","openDesktopPicker","desktopSharingFrameRate","desktopSharingResolution","desktopSharingSources","streamType","_desktopSharingFrameR","_desktopSharingResolu","_desktopSharingResolu2","_desktopSharingResolu3","_desktopSharingResolu4","_desktopSharingFrameR2","_desktopSharingResolu5","_desktopSharingResolu6","audioConstraints","optionalConstraints","screen","minFrameRate","setContentHint","sourceType","_this$options","_this$options2","_this$options3","constraintOpts","screenShareSettings","preferCurrentTab","desktopPreferCurrentTab","systemAudio","desktopSystemAudio","surfaceSwitching","desktopSurfaceSwitching","desktopDisplaySurface","displaySurface","selfBrowserSurface","desktopSelfBrowserSurface","cursor","_track$getSettings","_this$options$testing2","minFps","trackConstraints","videoTracks","_errorDetails$errorMs","errorDetails","errorCode","errorMsg","errorName","errorStack","NOT_SUPPORTED_ERR","desktopTrack","contentHint","setDesktopSharingFrameRate","maxFps","DEFAULT_CONSTRAINTS","audioOutputDeviceId","audioOutputChanged","disableAP","disableAEC","disableNS","disableAGC","featureDetectionAudioEl","document","createElement","isAudioOutputDeviceChangeAvailable","setSinkId","availableDevicesPollTimer","availableDevices","emptyFuncton","sendDeviceListToAnalytics","deviceList","audioInputDeviceCount","audioOutputDeviceCount","videoInputDeviceCount","videoOutputDeviceCount","device","groupId","AVAILABLE_DEVICE","_initOnce","_options$audioQuality","screenObtainer","ds","DEVICE_LIST_AVAILABLE","attachMediaStream","element","srcObject","isDeviceChangeAvailable","getAudioOutputDevice","ex","_updateKnownDevices","umDevices","timeout","gumTimeout","timeoutExpired","_updateGrantedPermissions","jitsiError","_getDesktopMedia","_getMissingTracks","requestedDevices","missingDevices","audioDeviceRequested","audioTracksReceived","videoDeviceRequested","videoTracksReceived","_onMediaDevicesListChanged","devicesReceived","DEVICE_LIST_WILL_CHANGE","DEVICE_LIST_CHANGED","pds","newDevices","mediaDeviceInfoToJSON","sort","facing","compareAvailableMediaDevices","um","grantedPermissions","PERMISSIONS_CHANGED","obtainAudioAndVideoPermissions","otherOptions","mediaStreamsMetaData","maybeRequestDesktopDevice","desktopSharingSourceDevice","matchingDevice","deviceConstraints","maybeRequestCaptureDevices","requestedCaptureDevices","cloneDeep","Resolutions","cameraDeviceId","USER","allowedAudioProps","validConstraints","micDeviceId","getConstraints","desktopStream","desktopAudioTracks","desktopAudioStream","desktopVideoTracks","desktopVideoStream","avStream","audioTracks","audioStream","effects","videoStream","CAMERA","stopMediaStream","deviceType","mediaStream","release","isDesktopSharingEnabled","setAudioOutputDevice","AUDIO_OUTPUT_DEVICE_CHANGED","getCurrentlyAvailableMediaDevices","getEventDataForActiveDevice","deviceData","isUserStreamById","trackHandler2Prop","JitsiTrack","streamInactiveHandler","trackMediaType","containers","_streamInactiveHandler","_setStream","_addMediaStreamInactiveHandler","onended","oninactive","_attachTTFMTracker","_container","_onTrackAttach","_onTrackDetach","_setHandler","_unregisterHandlers","videoTrack","isWebRTCTrackMuted","_this$track","attach","container","RTCUtils","detach","getStreamId","getSsrc","getTrack","getTrackLabel","getTrackId","getUsageLabel","getVideoType","getHeight","getWidth","isLocalAudioTrack","newAudioLevel","TRACK_AUDIO_LEVEL_CHANGED","NO_AUDIO_INPUT","setAudioOutput","TRACK_AUDIO_OUTPUT_CHANGED","JitsiLocalTrack","rtcId","_setEffectInProgress","effect","isEnabled","_startStreamEffect","_this$_constraints$he","_constraints","maxEnabledResolution","_prevSetMuted","_facingMode","_trackEnded","_hasSentData","_testDataSent","_realDeviceId","_sourceName","_ssrc","_trackMutedTS","_onDeviceListWillChange","oldRealDeviceId","_setRealDeviceIdFromDeviceList","_onAudioOutputDeviceChanged","_initNoDataFromSourceHandlers","_addStreamToConferenceAsUnmute","_addLocalTrackToPc","_fireNoDataFromSourceEvent","isReceivingData","createNoDataFromSourceEvent","_isNoDataFromSourceEventsEnabled","TRACK_UNMUTED","_queueSetMuted","setMuted","_setMuted","_removeStreamFromConferenceAsMute","_removeLocalTrackFromPc","logMuteInfo","_this$_streamEffect","_streamEffect","_stopStreamEffect","stopStream","streamOptions","getDeviceId","getCameraFacingMode","streamsInfo","cont","_this$conference","_sendMuteStatus","AUDIO_MUTE_CHANGED_EVENT","VIDEO_MUTE_CHANGED_EVENT","_sendBridgeVideoTypeMessage","TRACK_MUTE_CHANGED","_originalStream","startEffect","stopEffect","_switchCamera","ENVIRONMENT","_switchStreamEffect","setEffect","mute","_setTrackMuteStatus","sendPresence","_this$track$getSettin","trackSettings","getCaptureResolution","getDuration","_this$conference2","isEnded","_this$_streamEffect2","_this$track2","_stopStreamInProgress","_effectEnabled","getConnectionState","NO_BYTES_SENT","setConference","setSsrc","unmute","_this$_streamEffect3","_mediaStreamData2","hasAudioMixEffect","hasConference","audioAnalyser","getAudioAnalyser","_trackRemoved","initialSettings","constraintsToApply","deviceIdKey","mediaStreamData","_mediaStreamData","_trackAdded","CodecMimeType","MediaDirection","SignalingEvents","getSourceNameForJitsiTrack","trackIdx","substring","getMediaTypeFromSourceName","firstLetterOfMediaTypeIdx","lastIndexOf","firstLetterOfMediaType","getSourceIndexFromSourceName","nameParts","SignalingLayer","getPeerMediaInfo","getPeerSourceInfo","getSSRCOwner","getTrackSourceName","removeSSRCOwners","ssrcList","setSSRCOwner","setTrackMuteStatus","setTrackVideoType","updateSsrcOwnersOnLeave","DEFAULT_LAST_N","SIM_LAYERS","scaleFactor","SSRC_GROUP_SEMANTICS","STANDARD_CODEC_SETTINGS","av1","maxBitratesVideo","fullHd","high","low","none","ssHigh","standard","ultraHd","scalabilityModeEnabled","useKSVC","useSimulcast","h264","vp8","vp9","VIDEO_CODECS_BY_COMPLEXITY","AV1","VP9","VP8","VIDEO_QUALITY_LEVELS","VIDEO_QUALITY_SETTINGS","parsePrimarySSRC","group","ssrcs","parseSecondarySSRC","_getSSRCCount","ssrcInfo","MLineWrap","_mLine","ssrcGroups","getSSRCAttrValue","ssrcNumber","attrName","attribute","ssrcObj","removeSSRC","ssrcNum","_this$_mLine$ssrcs","addSSRCAttribute","findGroup","semantics","findGroups","findGroupByPrimarySSRC","primarySSRC","getSSRCCount","containsAnySSRCGroups","getPrimaryVideoSsrc","simGroup","SIM","fidGroup","FID","fecGroup","getRtxSSRC","primarySsrc","getSSRCs","getPrimaryVideoSSRCs","videoSSRCs","ssrcGroupInfo","secondarySsrc","removeGroupsWithSSRC","groupInfo","removeGroupsBySemantics","addSSRCGroup","SdpTransformWrap","rawSDP","parsedSDP","selectMedia","selectedMLines","media","toRawSDP","LocalSdpMunger","localEndpointId","_tpc","_localEndpointId","_transformMediaIdentifiers","ssrcMap","_mediaSection$_mLine$","_mediaSection$_mLine$2","mediaDirection","msid","sortedSources","trackSsrcs","isEqual","SENDONLY","SENDRECV","_this$_tpc$getLocalVi","generatedMsid","existingMsid","getLocalVideoTracks","RECVONLY","INACTIVE","_hasHadVideoTrack","_hasHadAudioTrack","transformStreamIdentifiers","sessionDesc","_transformer$selectMe","transformer","audioMLine","videoMlines","videoMLine","SDPUtil","buildICECandidate","foundation","component","priority","hasOwnAttribute","tcptype","generation","buildICEPwd","pwd","buildICEUfrag","frag","buildMLine","mline","fmt","buildRTPMap","el","getAttribute","candidateFromJingle","candidateToJingle","elems","network","filterSpecialChars","text","findLine","haystack","needle","sessionpart","lines","j","findLines","needles","generateSsrc","RandomUtil","getSsrcAttribute","attributeName","ssrcLine","getUfrag","ufragLines","startsWith","iceparams","mediadesc","sessiondesc","ufrag","parseICEPwd","parseICEUfrag","parseCrypto","parts","parseExtmap","uri","parseFingerprint","hash","fingerprint","parseFmtp","parseGroupSsrcs","ssrcGroup","ssrcStr","parseICECandidate","parseMID","parseMLine","parseMSIDAttribute","ssrcLines","msidLine","parsePrimaryVideoSsrc","_videoMLine$ssrcGroup","numSsrcs","numGroups","parseRTCPFB","pt","parseRTPMap","clockrate","channels","parseSCTPMap","parseSCTPPort","parseSSRC","parseSSRCGroupLine","parseSourceNameLine","sourceNameLine","ssrcSdpLine","parseVideoTypeLine","videoTypeLine","preferCodec","codecName","sortPayloadTypes","matchingPayloadTypes","rtp","H264","payloadsWithMode0","fmtp","item","reverse","payloadType","unshift","payloadTypes","payloads","payloadIndex","stripCodec","highProfile","highProfileCodecs","removePts","rtxApts","rtxPts","keepPts","rtcpFb","updateAssociatedRtxStream","primarySsrcInfo","rtxSsrc","primarySsrcMsid","primarySsrcCname","cname","previousRtxSSRC","RtxModifier","correspondingRtxSsrcs","clearSsrcCache","setSsrcCache","ssrcMapping","modifyRtxSsrcs","sdpStr","modified","sdpTransformer","videoMLines","modifyRtxSsrcs2","primaryVideoSsrcs","correspondingRtxSsrc","stripRtx","fidGroups","XEP","findAll","querySelectorAll","getText","textContent","exists","querySelector","findFirst","SDP","_updateSessionAndMediaSections","raw","failICE","removeTcpCandidates","removeUdpCandidates","_adjustMsidSemantic","mediaI","updateRemoteSources","sourceMap","isAdd","updatedMidIndices","groups","addMlineForNewSource","updatedMsid","isRemote","mid","mids","fromJingle","jingle","BUNDLE_MEDIA","_findAll","contents","content","jingle2media","newSession","newMedia","_mLine$ssrcs","APPLICATION","newMline","_mLine$ssrcGroups","_mline$ssrcs","bundleOnly","ssrcId","g","otherSsrc","otherSource","msidSemantic","semantic","token","origin","sessionVersion","getMediaSsrcMap","mediaItem","mediaindex","midLine","linessrc","ICE_UDP_TRANSPORT","SCTP_DATA_CHANNEL","DTLS_SRTP","setup","setAttribute","parameters","parameter","rtcpFbFromJingle","RTP_HEADER_EXTENSIONS","hdrExt","SOURCE_ATTRIBUTES","children","child","localName","userSources","nonUserSources","isUserSource","sourceStr","_value","_value2","elem","payloadtype","feedbackElementTrrInt","RTP_FEEDBACK","fb","hasAttribute","rtcpFbToJingle","mediaIndex","feedback","xmlns","up","attrs","toJingle","thecreator","mediaTypes","assrcline","isRecvOnly","tree","availableSsrc","ssrcParameters","xmlElement","param","append","creator","initialLastN","RTP_MEDIA","format","rtpmap","afmtpline","ridLines","rids","ridLine","extmapLine","extmap","transportToJingle","sctpport","sctpmap","sctpAttrs","setupLine","iceParameters","SdpSimulcast","_ssrcCache","_numOfLayers","_fillSsrcsFromCache","cachedSsrcs","newSsrcs","_parseSimLayers","newMsid","_getSsrcAttribute","newCname","_generateNewSsrcsForSimulcast","simSsrcs","simSsrc","_generateSsrc","_mLine$ssrcs2","mungeLocalDescription","_media$ssrcs","_media$ssrcGroups$len","_media$ssrcGroups","_media$ssrcs$","simulcastSsrcs","TrackStreamingStatus","TrackStreamingStatusImpl","_getNewStateForJvbMode","isInForwardedSources","isRestoringTimedout","isVideoTrackFrozen","ACTIVE","INTERRUPTED","RESTORING","_getNewStateForP2PMode","restoringTimer","rtcMutedTimestamp","streamingStatusMap","trackTimer","outOfForwardedSourcesTimeout","p2pRtcMuteTimeout","rtcMuteTimeout","_getVideoFrozenTimeout","isP2PActive","_onP2PStatus","figureOutStreamingStatus","P2P_STATUS","_onUserLeft","onUserLeft","USER_LEFT","_onTrackRtcMuted","onTrackRtcMuted","REMOTE_TRACK_MUTE","_onTrackRtcUnmuted","onTrackRtcUnmuted","REMOTE_TRACK_UNMUTE","_onSignallingMuteChanged","onSignallingMuteChanged","_onTrackVideoTypeChanged","onTrackVideoTypeChanged","TRACK_VIDEOTYPE_CHANGED","_onForwardedSourcesChanged","onForwardedSourcesChanged","_onLastNValueChanged","LASTN_VALUE_CHANGED","clearRtcMutedTimestamp","maybeSendTrackStreamingStatusEvent","_changeStreamingStatus","newStatus","getTrackStreamingStatus","_setTrackStreamingStatus","TRACK_STREAMING_STATUS_CHANGED","REMOTE_SOURCE_SUSPENDED_EVENT","REMOTE_SOURCE_INTERRUPTED_EVENT","isVideoRTCMuted","inP2PMode","isRestoringTimedOut","_isRestoringTimedout","audioOnlyMode","getLastN","newState","_clearRestoringTimer","oldStreamingStatus","streamingStatus","nowMs","startedMs","trackStreamingStatus","createTrackStreamingStatusEvent","leavingForwardedSources","enteringForwardedSources","_clearEnteredForwardedSourcesTimestamp","_setEnteredForwardedSourcesTimestamp","rTimer","enteredForwardedSourcesTimestamp","_getEnteredForwardedSourcesTimestamp","_isCurrentTrack","ttfmTrackerAudioAttached","ttfmTrackerVideoAttached","containerEvents","JitsiRemoteTrack","ownerEndpointId","_rtc","_muted","_trackStreamingStatus","_trackStreamingStatusImpl","_enteredForwardedSourcesTimestamp","_addEventListener","_removeEventListener","_hasBeenMuted","_bindTrackHandlers","_containerHandlers","_containerEventHandler","_onTrackMute","_onTrackUnmute","_initTrackStreamingStatus","_disposeTrackStreamingStatus","_playCallback","getConnectionTimes","gumStart","gumEnd","gumDuration","ttfm","_getStatus","_peerConnStatusOutOfLastNTimeout","_p2pConnStatusRtcMuteTimeout","_peerConnStatusRtcMuteTimeout","setMute","VideoEncoderScalabilityMode","VIDEO_CODECS","TPCUtils","codecSettings","videoQualitySettings","videoQuality","_codecConfig$maxBitra","_videoQualitySettings","codecConfig","bitrateSettings","maxbitratesvideo","_calculateActiveEncodingParams","localVideoTrack","newHeight","_this$options$videoQu","codecBitrates","trackCaptureHeight","effectiveNewHeight","desktopShareBitrate","desktopbitrate","isScreenshare","scalabilityMode","L3T3_KEY","L3T3","lvl","maxBitrate","_isScreenshareBitrateCapped","L1T3","ULTRA","FULL","HIGH","STANDARD","L2T3_KEY","L2T3","_getConfiguredVideoCodecsImpl","parsedSdp","_getVideoStreamEncodings","localTrack","captureResolution","cameraMaxbitrate","effectiveScaleFactors","sim","effectiveBitrates","standardSimulcastEncodings","videoTransferActive","encoding","_isRunningInFullSvcMode","_capScreenshareBitrate","calculateEncodingsActiveState","videoStreamEncodings","activeState","isSpatialScalabilityOn","_videoStreamEncodings","calculateEncodingsBitrates","_this$options$videoQu2","calculateEncodingsScalabilityMode","scalabilityModes","calculateEncodingsScaleFactor","isRunningInSimulcastMode","ensureCorrectOrderOfSsrcs","reorderedSsrcs","getConfiguredVideoCodec","_this$pc$remoteDescri","rtpSender","findSenderForTrack","usesCodecSelectionAPI","remoteDescription","localTrackTransceiverMids","getConfiguredVideoCodecs","_this$pc$localDescrip","currentSdp","localDescription","getDesiredMediaDirection","isAddOperation","hasLocalSource","getStreamEncodings","audioTransferActive","injectSsrcGroupForSimulcast","simulcast","simulcast_03","insertUnifiedPlanSimulcastReceive","simulcastLine","mLines","senderMids","_this$codecSettings","mungeCodecOrder","mungedSdp","currentCodecs","ULPFEC","RED","codecList","mungeOpus","enableOpusDtx","opusMaxAverageBitrate","OPUS","fmtpOpus","fmtpConfig","sdpChanged","maxaveragebitrate","usedtx","mungedConfig","setMaxBitrates","isLocalSdp","pcCodecSettings","currentCodec","codecScalabilityModeSettings","isDoingVp9KSvc","limit","TraceablePeerConnection","signalingLayer","_transceiver$sender","_parameters$encodings","_t$sender","_t$receiver","tpcUtils","enable","_parameters$encodings2","_transceiver","isInitiator","localTracks","webrtcStream","mediaStreamTrack","transceiverInit","_setEncodings","_dtmfSender","_dtmfTonesQueue","_pcId","remoteTracksBySsrc","remoteTracks","localSSRCs","remoteSSRCs","remoteSources","_localUfrag","_remoteUfrag","_dtlsTransport","_signalingLayer","_peerVideoTypeChanged","PEER_VIDEO_TYPE_CHANGED","_peerMutedChanged","PEER_MUTED_CHANGED","SOURCE_MUTED_CHANGED","_sourceMutedChanged","SOURCE_VIDEO_TYPE_CHANGED","_sourceVideoTypeChanged","safeConstraints","updateLog","statsinterval","capScreenshareBitrate","_usesCodecSelectionAPI","maxstats","localSdpMunger","getLocalEndpointId","rtxModifier","_senderMaxHeights","_localSsrcMap","_remoteSsrcMap","what","time","onicecandidate","onTrack","evt","_remoteTrackAdded","_remoteTrackRemoved","onsignalingstatechange","oniceconnectionstatechange","onnegotiationneeded","onconnectionstatechange","ondatachannel","results","_processStat","_lastVideoSenderUpdatePromise","getRemoteTracks","_getReceiversByEndpointIds","endpoints","remoteTrackIds","remote","_remote$track","_adjustRemoteMediaDirection","localSources","_getPreferredCodecForScreenshare","defaultCodec","screenshareCodec","_initializeDtlsTransport","onstatechange","_updateVideoSenderParameters","_configureSenderEncodings","_mungeDescription","dumpSDP","mungedDescription","nextFunction","nextPromise","_updateVideoSenderEncodings","preferredCodec","_parameters$encodings3","videoSender","isScreensharingTrack","preference","degradationPreference","codecForCamera","bitrates","scaleFactors","needsUpdate","expectedPattern","matchingCodec","VIDEO_CODEC_CHANGED","LOCAL_TRACK_MAX_ENABLED_RESOLUTION_CHANGED","_onToneChange","tone","tones","duration","interToneGap","insertDTMF","_createOfferOrAnswer","isOffer","logName","handleSuccess","resultSdp","resolveFn","rejectFn","_resultSdp2","_resultSdp","disableRtx","_processAndExtractSourceInfo","handleFailure","_RTCRtpReceiver$getCa","transceivers","_t$receiver2","capabilities","caps","setCodecPreferences","oaPromise","_extractPrimarySSRC","_ssrcObj$groups","_ssrcObj$ssrcs","_sendRtcStatsEvent","SCREENSHARE_MUTE_CHANGED_EVENT","statValue","endTime","startTime","times","h264SimulcastEnabled","disableSimulcast","getSynchronizationSources","_this$localSSRCs$get","remoteTrack","endpointTracksByMediaType","getRemoteSourceInfoBySourceName","getRemoteSourceInfoByParticipant","removeSsrcInfo","primarySsrcs","_sourceInfo$ssrcList","getTargetVideoBitrates","_this$localSSRCs$get2","findTrackById","_this$remoteDescripti","_peerMediaInfo$muted","remoteSDP","mediaLine","mls","trackSsrc","peerMediaInfo","trackDetails","_createRemoteTrack","remoteTracksMap","userTracksByMediaType","_userTracksByMediaTyp","jitsiTrack","toBeRemoved","_removeRemoteTrack","_userTracksByMediaTyp2","localSDP","_ssrcs","trackIndex","parsedGroup","groupSsrcs","oldSsrcInfo","oldSsrc","newSsrc","_getSSRC","isSharingLowFpsScreen","_isSharingScreen","addTrackToPc","_assertTrackBelongs","replaceTrack","methodName","doesBelong","lowFps","setVideoCodecs","updated","configureVideoSenderEncodings","CODEC_CHANGED_EVENT","camera","screenshare","webRtcStream","findReceiverForTrack","processLocalSdpForTransceiverInfo","_this$localDescriptio","localSdp","oldTrack","newTrack","_newTrack$getType","_newTrack$getTrack","isMuteOperation","isNewLocalSource","currentDirection","stopped","_newTrack$getSourceNa","transceiverMid","_transceiver2","oldTrackSSRC","oldSsrcNum","removeTrackFromPc","calculateExpectedSendResolution","maxValue","configureAudioSenderEncodings","localAudioTrack","promises","allSettled","_this$_senderMaxHeigh","setSenderVideoConstraints","_this$_senderMaxHeigh2","localUfrag","LOCAL_UFRAG_CHANGED","remoteUfrag","REMOTE_UFRAG_CHANGED","setMediaTransferActive","_enableSenderEncodings","settledResult","errors","setVideoTransferActive","changed","sendTones","ontonechange","toneBuffer","peerTracks","_removePeerConnection","addRemoteSsrc","existing","peerConnectionIdCounter","rtcTrackIdCounter","_createLocalTracks","metaData","RTC","peerConnections","_lastN","_forwardedSources","_forwardedSourcesChangeListener","_onDeviceListChanged","_updateAudioOutputForAudioTracks","destroy","_channelOpenListener","createLocalTracks","tracksInfo","initializeBridgeChannel","logError","msgType","_receiverVideoConstraints","oldForwardedSources","setReceiverVideoConstraints","sendSourceVideoType","eventType","createPeerConnection","signaling","enableInsertableStreams","encodedInsertableStreams","forceTurnRelay","iceTransportPolicy","bundlePolicy","newConnection","traceablePeerConnection","addLocalTrack","getForwardedSources","getLocalVideoTrack","localVideo","getLocalAudioTrack","localAudio","pcRemoteTracks","mutePromises","audioTrack","removeLocalTrack","elSelector","isWebRtcSupported","closeBridgeChannel","sendChannelMessage","setLastN","remoteAudioTracks","ConnectionQualityEvents","ConnectionQuality","_localStats","connectionQuality","jvbRTT","_lastConnectionQualityUpdate","_options","_remoteStats","_timeIceConnected","_timeVideoUnmuted","ConferenceEvents","_this$_localStats","CONNECTION_INTERRUPTED","_updateLocalConnectionQuality","LOCAL_STATS_UPDATED","_broadcastLocalStats","ICE_CONNECTION_STATE_CHANGED","_updateRemoteStats","disableLocalStats","_updateLocalStats","_maybeUpdateUnmuteTime","_resetVideoUnmuteTime","_MEDIA_SESSION_ACTIVE_CHANGED","SERVER_REGION_CHANGED","serverRegion","PROPERTIES_CHANGED","bridgeCount","disableLocalStatsBroadcast","_calculateConnectionQuality","resolutionName","quality","activeTPC","getActivePeerConnection","_this$_options$config","_this$_options$config2","millisSinceStart","qualityLevel","targetHeight","pow","rampUp","getTarget","maxIncreasePerSecond","prevConnectionQuality","diffSeconds","_data$transport","updateLocalConnectionQuality","isConnectionInterrupted","REMOTE_STATS_UPDATED","IceFailedHandling","_actOnIceFailed","jvbConnection","jvbConnIceState","getIceConnectionState","JVB_ICE_RESTARTED_EVENT","_stopJvbSession","reasonDescription","requestRestart","sendSessionTerminate","ping","_canceled","_iceFailedTimeout","cancel","DetectionEvents","NoAudioSignalDetection","_timeoutTrigger","_hasAudioInput","_audioTrack","_eventFired","_clearTriggerTimeout","_handleAudioInputStateChange","AUDIO_INPUT_STATE_CHANGE","_handleNoAudioInputDetection","_audioLevel","P2PDominantSpeakerDetection","myUserID","createAudioContext","AudioContextImpl","TrackVADEmitter","procNodeSampleRate","vadProcessor","jitsiLocalTrack","_procNodeSampleRate","_vadProcessor","_localTrack","_bufferResidue","Float32Array","_audioContext","sampleRate","getRequiredPCMFrequency","_vadSampleSize","getSampleLength","_onAudioProcess","_initializeAudioContext","_audioSource","_audioProcessingNode","createScriptProcessor","audioEvent","inData","inputBuffer","getChannelData","completeInData","sampleTimestamp","pcmSample","vadScore","calculateAudioFrameVAD","VAD_SCORE_PUBLISHED","pcmData","score","_connectAudioGraph","onaudioprocess","destination","_disconnectAudioGraph","_cleanupResources","_destroyed","VADAudioAnalyser","createVADProcessor","_createVADProcessor","_vadEmitter","_isVADEmitterRunning","_detectionServices","_vadInitTracker","_processVADScore","_trackMuteChanged","addVADDetectionService","vadService","DETECTOR_STATE_CHANGE","detector","_stopVADEmitter","_startVADEmitter","processVADScore","_changeDetectorsMuteState","changeMuteState","vadEmitter","VADNoiseDetection","_processing","_scoreArray","_audioLvlArray","_active","_processTimeout","_calculateNoisyScore","scoreAvg","audioLevelAvg","VAD_NOISY_DEVICE","_setActiveState","_recordValues","avgAudioLvl","posAudioLevels","VADTalkMutedDetection","_calculateVADScore","VAD_TALK_WHILE_MUTED","Deferred","clearRejectTimeout","_timeout","setRejectTimeout","ms","kJitsiE2EE","E2EEcontext","sharedKey","baseUrl","ljm","workerUrl","workerBlob","Blob","URL","createObjectURL","_worker","Worker","operation","cleanup","cleanupAll","handleReceiver","receiverStreams","readableStream","readable","writableStream","handleSender","senderStreams","setEnabled","setKey","keyIndex","KeyHandler","e2eeCtx","E2EEContext","_enabling","_firstEnable","_MEDIA_SESSION_STARTED","_onMediaSessionStarted","_onLocalTrackAdded","_setupReceiverE2EEForTrack","setLocalParticipantProperty","_setEnabled","_restartMediaSessions","getMediaSessions","_setupSenderE2EEForTrack","ExternallyManagedKeyHandler","keyInfo","encryptionKey","reWhitespace","reTrimStart","trimmedEndIndex","reIsBadHex","reIsBinary","reIsOctal","freeParseInt","isSymbol","baseTrim","isBinary","nativeMin","wait","lastArgs","lastThis","maxWait","timerId","lastCallTime","lastInvokeTime","leading","maxing","trailing","invokeFunc","shouldInvoke","timeSinceLastCall","timerExpired","trailingEdge","timeWaiting","remainingWait","debounced","isInvoking","leadingEdge","toNumber","symbolToString","baseToString","arrayMap","reEscapedHtml","reHasEscapedHtml","unescapeHtmlChar","JitsiConnectionErrors","CONFERENCE_REQUEST_FAILED","CONNECTION_DROPPED_ERROR","NOT_LIVE_ERROR","OTHER_ERROR","SERVER_ERROR","SHARD_CHANGED_ERROR","sha1_ft","sha1_kt","safe_add","lsw","rol","num","cnt","SHA1","binarray","triplet","str","binb2b64","olda","oldb","oldc","oldd","olde","w","core_sha1","bin","charCodeAt","str2binb","IDENTITY_PROPERTIES","IDENTITY_PROPERTIES_FOR_COMPARE","compareIdentities","parseDiscoInfo","node","identities","category","Caps","disco","rooms","externalFeatures","emuc","EMUC_ROOM_ADDED","_addChatRoom","EMUC_ROOM_REMOVED","_removeChatRoom","addNamespace","addFeature","NS","CAPS","_getDiscoInfo","_fixChatRoomPresenceMap","_updateRoomWithExternalFeatures","addOrReplaceInPresence","ver","_generateVersion","sortedIdentities","accumulatedValue","tmp","sortedFeatures","sha1","generateSha","_identities","_notifyVersionChanged","removeFromPresence","submit","external","getFeaturesAndIdentities","removeFeature","IDENTITY_TYPE","FileSharing","_mainRoom","_xmpp","_handleMessages","FILE_SHARING_EVENT","fileSharingComponentAddress","getIdentityType","addFile","_sendMessage","removeFile","fileId","$msg","file","files","NETWORK_INFO_EVENT","_current","isOnline","updateNetworkInfo","getJitterDelay","retry","minDelay","ResumeTask","stropheConnection","_stropheConn","_resumeRetryN","_retryDelay","_resumeTimeout","_networkOnlineListener","retryCount","retryDelay","_cancelResume","_removeNetworkOnlineListener","_resumeConnection","streamManagement","resumeToken","getResumeToken","service","search","pattern","oldToken","_scheduleResume","schedule","NetworkInfo","LastRequestTracker","_lastSuccess","_lastFailedMessage","startTracking","xmppConnection","originalRawInput","rawInput","rawMessage","connected","getLastFailedMessage","getTimeSinceLastSuccess","autoSendCountOnEveryIncomingStanza","requestResponseInterval","_c","_NS","_isStreamManagementEnabled","_serverProcesssedStanzasCounter","_clientProcessedStanzasCounter","_clientSentStanzasCounter","_originalXMLOutput","_requestHandler","_incomingHandler","_requestResponseIntervalCount","_isSupported","_unacknowledgedStanzas","_acknowledgedStanzaListeners","addAcknowledgedStanzaListener","_connectionStatus","Status","CONNECTED","$build","pause","_resumeToken","DISCONNECTED","explicitResourceBinding","_resuming","_originalConnect","_connectArgs","requestAcknowledgement","getOutgoingCounter","getIncomingCounter","conn","xmlOutput","_interceptConnectArgs","_originalOnStreamFeaturesAfterSASL","_onStreamFeaturesAfterSASL","_originalDoDisconnect","_doDisconnect","_interceptDoDisconnect","_originalDisconnect","_interceptDisconnect","disconnecting","_resumeState","timedHandlers","removeTimeds","removeHandlers","addTimeds","addHandlers","_storedJid","_data","getElementsByTagNameNS","statusChanged","BINDREQUIRED","h","_addSysHandler","ns","addTimedHandler","period","deleteTimedHandler","previd","ERROR","deleteHandler","addHandler","_handleServerRequestHandler","_ackHandler","_handleServerAck","_incomingStanzaHandler","_enabledHandler","_handleEnabled","_resumeFailedHandler","_handleResumeFailed","_resumedHandler","_handleResumed","isTagEqual","_increaseSentStanzasCounter","firstElementChild","tagName","firstChild","_changeConnectStatus","handledCount","_handleAcknowledgedStanzas","do_bind","authenticated","restored","stanza","_increaseReceivedStanzasCounter","_answerProcessedStanzas","reportedHandledCount","lastKnownHandledCount","delta","_throwError","getConnectionPluginDefinition","addConnectionPlugin","ConnectionPluginListenable","PingConnectionPlugin","ConnectionPlugin","getTimeSinceLastServerResponse","onPingThresholdExceeded","pingOptions","failedPings","_onPingThresholdExceeded","_getTimeSinceLastServerResponse","pingTimeout","pingThreshold","threshold","pingTimestampsToKeep","pingExecIntervals","success","_addPingExecutionTimestamp","iq","$iq","PING","sendIQ2","startInterval","remoteJid","_lastServerCheck","errmsg","stopInterval","getPingSuspendTime","pingIntervals","maxInterval","previousTS","currentInterval","XmppConnection","Events","CONN_SHARD_CHANGED","CONN_STATUS_CHANGED","enableWebsocketResume","websocketKeepAlive","websocketKeepAliveUrl","serviceUrl","shard","xmppPing","Connection","registerSASLMechanisms","SASLAnonymous","SASLPlain","SASLSHA1","_usesWebsocket","maxRetries","_rawInputTracker","LastSuccessTracker","_resumeTask","_deferredIQs","_onPingErrorThresholdExceeded","_oneSuccessfulConnect","_this$_stropheConn","websocket","_proto","socket","ATTACHED","isUsingWebSocket","domain","lastResponseHeaders","_this$_stropheConn$_p","pingDomain","_this$_options$pingOp","_maybeStartWSKeepAlive","plugin","sid","_stropheConnectionCb","pass","targetCallback","condition","blockCallback","_this$_options$pingOp2","_maybeEnableStreamResume","_processDeferredIQs","_tryResumingConnection","_wsKeepAlive","_clearDeferredIQs","deferred","closeWebsocket","_this$_stropheConn2","_closeSocket","_onClose","forcedTimeout","_keepAliveAndCheckShard","fetch","responseShard","timeLeft","sendIQ","_this$_stropheConn3","errback","sendUnavailableBeacon","sendBeacon","DISCONNECTING","_buildBody","pres","$pres","CLIENT","cnode","_abortAllRequests","handleStropheError","errResponse","errorObj","errorEl","errorElements","getElementsByTagName","reasonEl","msgEl","outerHTML","STROPHE_ERROR_EVENT","createExpBackoffTimer","step","Moderator","_this$options$hosts","_this$options$hosts2","getNextTimeout","getNextErrorTimeout","sipGatewayEnabled","visitorsSupported","targetJid","hosts","focus","targetUrl","conferenceRequestUrl","focusUserJids","focusUserJid","location","isFocusJid","focusJid","isSipGatewayEnabled","_createConferenceRequest","roomJid","_config$analytics$rtc","_config$analytics","startAudioMuted","startVideoMuted","conferenceRequest","machineUid","iAmRecorder","iAmSipGateway","preferVisitor","visitor","_createConferenceIq","_parseConferenceIq","resultIq","conferenceEl","ready","vnode","authentication","externalAuth","live","sendConferenceRequest","conferenceRequestSent","_handleIqSuccess","_handleIqError","ok","json","resultJson","_handleSuccess","statusText","sessionError","notAuthorized","_handleError","_breakoutMovingToMain","authenticationEnabled","waitMs","userJid","reservationErr","errorTextNode","invalidSession","authenticate","errorIq","_errorEl$children","firstErrorChild","logout","_connection","_items","_onDiscoInfo","DISCO_INFO","_onDiscoItems","DISCO_ITEMS","addIdentity","lang","var_name","addItem","call_back","items","_buildIQResult","query_attrs","iqresult","JitsiTranscriptionStatus","ON","OFF","AVModeration","_moderationEnabledByType","_whitelistAudio","_whitelistDesktop","_whitelistVideo","_onMessage","AV_MODERATION_RECEIVED","avModerationComponentAddress","approve","jidToWhitelist","jidToBlacklist","removed","approved","whitelists","newWhitelists","oldList","newList","FEATURE_KEY","BREAKOUT_ROOM_ACTIONS","ADD","MOVE_TO_ROOM","REMOVE","RENAME","BREAKOUT_ROOM_EVENTS","BreakoutRooms","BREAKOUT_ROOMS_EVENT","_rooms","createBreakoutRoom","subject","removeBreakoutRoom","breakoutRoomJid","renameBreakoutRoom","sendParticipantToRoom","participantJid","isFeatureSupported","breakoutRoomsFeatures","getComponentAddress","breakoutRoomsComponentAddress","_setIsBreakoutRoom","_isBreakoutRoom","getDomainFromJid","myroomjid","_setMainRoomJid","_mainRoomJid","getMainRoomJid","filteredPayload","_filterUpdatePayload","hiddenDomain","filteredRooms","participants","filteredParticipants","EMAIL_COMMAND","Lobby","mainRoom","maybeJoinLobbyRoom","_maybeJoinLobbyRoom","lobbyRoomJid","lobbySupported","initialDiscoRoomInfoReceived","membersOnlyEnabled","setMembersOnly","unsubscribers","unsubscribe","remove","ROOM_DISCO_INFO_UPDATED","ROOM_DISCO_INFO_FAILED","disable","lobbyRoom","sendPrivateMessage","getLocalId","addMessageListener","removeMessageHandler","leave","setLobbyRoomJid","joined","email","getNodeFromJid","customDomain","createRoom","disableDiscoInfo","disableFocus","disableRoomCreationRetry","enableLobby","addPresenceListener","nick","isHiddenDomain","botType","members","avatar","clean","isSelfPresence","INVITE_MESSAGE_RECEIVED","invitePassword","_this$lobbyRoom","_this$lobbyRoom2","ROOM_CREATION_RESTRICTION","denyAccess","kick","approveAccess","mainRoomJid","membersToApprove","ids","memberRoomJid","msgToSend","COMMAND_ANSWER_POLL","COMMAND_NEW_POLL","Polls","POLLS_EVENT","pollsComponentAddress","createPoll","pollId","question","answers","command","answerPoll","_payload$polls","polls","poll","history","RoomMetadata","ROOM_METADATA_EVENT","_metadata","setMetadata","getMetadata","roomMetadataComponentAddress","JITSI_MEET_MUC_TYPE","EMOJI_REGEX","json2packet","nodes","packet","packet2JSON","attr","xmlunescape","filterNodeFromPresenceJSON","nodeName","MEMBERS_AFFILIATIONS","extractIdentityInformation","hiddenFromRecorderFeatureEnabled","userInfo","tags","ChatRoom","password","getBareJidFromJid","replaceParticipant","presMap","presHandlers","_removeConnListeners","inProgressEmitted","focusMucJid","noBridgeAvailable","eventsForwarder","moderator","lobby","avModeration","breakoutRooms","fileSharing","roomMetadata","initPresenceMap","lastPresences","phoneNumber","phonePin","participantPropertyListener","locked","transcriptionStatus","xns","statsId","presenceUpdateTime","_extractFeatures","var","_initFocus","focusFeatures","_onConnStatusChanged","presenceSyncTime","_processNode","_this$presHandlers$no","_parseReplyMessage","fromJoin","doLeave","discoRoomInfo","getInfo","meetingIdValEl","setMeetingId","meetingCreatedTSValEl","membersOnly","lobbyRoomField","isBreakoutField","breakoutMainRoomField","meetingId","createNonAnonymousRoom","getForm","form","formSubmit","onPresence","member","statusEl","hasStatusUpdate","hasVersionUpdate","xElement","mucUserItem","isReplaceParticipant","affiliation","isFocus","PRESENCE_RECEIVED","fromHiddenDomain","presence","xEl","region","deploymentInfo","userRegion","permissionEl","permissionsMap","memberOfThis","participantProperties","displayJids","CONFERENCE_PROPERTIES_CHANGED","FEATURE_TRANSCRIBER","att","phone","pin","elementName","SENDING_CHAT_MESSAGE","sendReaction","reaction","receiverId","SENDING_PRIVATE_CHAT_MESSAGE","setSubject","valueToProcess","onPresenceUnavailable","destroySelect","reasonSelect","isKick","membersKeys","actorSelect","actorNick","onMessage","settingsErrorEl","settingsErrorMsg","reactions","reactionElem","bodyEl","subjectText","dateParts","invite","passwordSelect","jsonMessage","parsedJson","tryParseJSONAndVerify","displayNameEl","isVisitorMessage","originalFrom","addressesEl","ofromEl","sourceAttrValue","onPresenceError","errorDescriptionNode","anonymousdomain","_roomCreationRetries","ROOM_UNAUTHENTICATED_ACCESS_DISABLED","NO_MAIN_PARTICIPANTS","PROMOTION_NOT_ALLOWED","NO_VISITORS_LOBBY","lobbyRoomNode","waitingForHost","setAffiliation","grantIQ","kickIQ","lockRoom","onNotSupported","formsubmit","affiliationsIq","sendIq","formToSubmit","matchingNodes","getFromPresence","tagHandlers","removePresenceListener","handlerIdx","mucJid","getMediaPresenceInfo","mutedNode","codecTypeNode","videoTypeNode","codecType","getMemberRole","peerJid","getLastPresence","mucNick","dial","rayo","hangup","getLobby","getAVModeration","getFileSharing","getMetadataHandler","getPolls","getPhoneNumber","getPhonePin","getMeetingId","muteParticipant","iqToFocus","onMute","onMuteVideo","onMuteDesktop","_this$lobby","onMucLeft","doReject","end","endConferenceComponentAddress","getShortTermCredentials","cachedCredentials","cachedShortTermCredentials","host","resultServiceEl","currentDate","expirationDate","MucConnectionPlugin","onVisitors","isRoomCreated","visitors","_createSourceExtension","sourceCompactJson","isVideo","_createSsrcGroupExtension","ssrcGroupCompactJson","_getOrCreateRtpDescription","appendChild","expandSourcesFromJson","jsonMessageXml","_json","audioRtpDescription","videoRtpDescription","ownerSources","videoSources","videoSsrcGroups","audioSources","audioSsrcGroups","_videoSources$i","_audioSources$i","SDPDiffer","mySdp","othersSdp","getNewMedia","mySources","othersSources","othersSource","mySource","othersSsrcs","modify","diffSourceInfo","mediaSsrc","onlyOnce","fn","callFn","_defer","hasQueueMicrotask","queueMicrotask","hasSetImmediate","setImmediate","hasNextTick","nextTick","defer","DLL","head","tail","removeLink","next","empty","insertAfter","newNode","insertBefore","setInitial","toArray","iterator","cur","testFn","curr","dll","handlePromise","invokeCallback","isAsync","asyncFn","asyncify","queue","worker","concurrency","wrapAsync","numRunning","workersList","drain","saturated","unsaturated","trigger","processingScheduled","_insert","insertAtFront","rejectOnError","rej","promiseCallback","q","started","_createTaskItem","_tasks","_createCB","tasks","_len3","_key3","task","idle","_maybeDrain","eventMethod","handleAndRemove","isProcessing","paused","datum","pushAsync","kill","unshiftAsync","running","defineProperties","ClearedQueueError","AsyncQueue","_queue","_processQueueTasks","_stopped","_taskCallbacks","finishedCallback","shutdown","JingleSessionState","PENDING","ENDED","JingleSession","localJid","mediaConstraints","usedrip","dripContainer","initiatorJid","responderJid","doInitialize","initialize","addIceCandidates","getState","addSources","removeSources","terminate","failure","acceptOffer","MediaSessionEvents","IQ_TIMEOUT","getEndpointId","jidOrEndpointId","_addSourceElement","ssrc_","_s$videoType","JingleSessionPC","parseVideoSenders","jingleContents","parseSourceMaxFrameHeight","receiverConstraints","sourceFrameHeightSel","_bridgeSessionId","_cachedOldLocalSdp","_cachedNewLocalSdp","_iceCheckingStartedTimestamp","_gatheringStartedTimestamp","_sourceReceiverConstraints","_localSendReceiveVideoActive","_remoteSendReceiveVideoActive","_gatheringReported","lasticecandidate","numRemoteVideoSources","numRemoteAudioSources","remoteSourceMaxFrameHeights","modificationQueue","wasConnected","establishmentDuration","_xmppListeners","onXmppStatusChanged","_removeSenderVideoConstraintsChangeListener","_addOrRemoveRemoteStream","logPrefix","_this$peerconnection$","errMsg","currentRemoteSdp","sourceDescription","_processSourceMapFromJingle","modifiedMids","desiredDirection","_renegotiate","_addRemoveTrack","isRemove","operationName","workFunction","shouldRenegotiate","_assertNotEnded","_processNewJingleOfferIq","offerIq","remoteSdp","webrtcIceTcpDisable","webrtcIceUdpDisable","sourceElement","sourceElementArray","descriptionsWithSources","removeSsrcs","_sourceDescription$ge","DESKTOP_HIGH_FPS","optionalRemoteSdp","oldLocalSDP","answer","notifyMySSRCUpdate","_sendContentModify","sessionModify","initiator","newJingleErrorHandler","_sendIceCandidate","ice","jcand","_sendIceCandidates","candidates","cands","fingerprintLine","required","_sendSessionAccept","accept","responder","channelLastN","_sendSessionInitiate","offerSdp","_this$room","failureCb","Element","errorElSel","errorResponseChildren","_this$room2","oldSDP","newSDP","getSignaledSourceInfo","sdpDiffer","signaledSsrcs","ctx","removedSsrcInfo","SOURCE_REMOVE","SOURCE_REMOVE_ERROR","addedSsrcInfo","SOURCE_ADD","SOURCE_ADD_ERROR","setOfferAnswerCycle","jingleOfferAnswerIq","addTracks","newRemoteSdp","bridgeSessionId","jingleOffer","SESSION_ACCEPT","SESSION_ACCEPT_ERROR","iceCandidates","_elem$","rtcCandidate","iceCandidate","addRemoteStream","replaceTracks","recvOnlyTransceiver","finishCallback","_options$testing","_options$testing$enab","_options$testing2","wasstable","pcOptions","gatherStats","enableCodecSelectionAPI","settings","fromEntries","_options$desktopShari","ICE_DURATION","phase","isStable","ICE_STATE_CHANGED","reconnect","CONNECTION_RESTORED","iceStarted","CONNECTION_ICE_FAILED","icestate","getRemoteSourcesRecvMaxFrameHeight","modifyContents","newVideoSenders","sourceMaxFrameHeights","REMOTE_SOURCE_CONSTRAINTS_CHANGED","isRemoteVideoActive","onTerminated","reasonCondition","reasonText","oldSourceName","rtx","removeRemoteStream","removeRemoteStreamsOnLeave","setAnswer","jingleAnswer","oldLocalSdp","newLocalSdp","setP2pVideoTransferActive","videoActive","setReceiverVideoConstraint","sourceReceiverConstraints","setSenderVideoConstraint","maxFrameHeight","currentCodecOrder","every","sessionTerminate","restart","JingleConnectionPlugin","iceConfig","sessions","jvbIceConfig","jvb","p2pIceConfig","onJingle","jingleElement","fromJid","ack","sess","jsonMessages","_audioVideoSsrcs","audioVideoSsrcs","logMessage","parseCandidates","candidateAttrs","_parseIceCandidates","reasonElement","_reasonElement$childr","firstReasonChild","newP2PJingleSession","me","peer","getStunAndTurnCredentials","v2Res","onReceiveStunAndTurnCredentials","v1Res","iceservers","dict","turnPort","iceServersOverride","targetType","temp","useTurnUdp","getLog","href","StropheLogger","logIncoming","rawOutput","logOutgoing","RAYO_XMLNS","RayoConnectionPlugin","onRayo","roomPass","req","callResource","lastErrorStatus","resetLastErrorStatusRegExpr","lastErrorStatusRegExpr","FAILURE_REGEX","DEFAULT_STUN_SERVERS","FEATURE_JIGASI","FEATURE_E2EE","XMPP","bosh","_disconnectInProgress","authenticatedUser","_components","_preComponentsMsgs","LogLevel","WARN","DEBUG","errStatusCapture","FATAL","getLastErrorStatus","getStatusString","CONNFAIL","AUTHENTICATING","AUTHFAIL","createConnection","details","shard_changed","suspend_time","time_since_last_success","enableGracefulReconnect","_initStrophePlugins","initFeaturesList","_onPrivateMessage","disableBeforeUnloadHandlers","handleDisconnect","JINGLE","RTP_AUDIO","RTP_VIDEO","enableOpusRed","enableRemb","enableTcc","E2EEncryption","users","SPEAKER_STATS_RECEIVED","FILE_SHARING_IDENTITY_TYPE","_maybeSendDeploymentInfoStat","force","acceptedStatuses","CONNTIMEOUT","sendDeploymentInfo","aprops","logObject","_processDiscoInfoIdentities","speakerStatsComponentAddress","processLobbyFeatures","fr","backendRelease","processBreakoutRoomsFeatures","rename","_ref3","_parseConnectionFailedMessage","_connect","_this$connection$_str","_resetState","sendDiscoInfo","_sysMessageHandler","_onSystemMessage","connectionHandler","foundIceServers","_cleanupXmppConnection","evType","sync","_startConnecting","_this$options$p2p","_this$options$p2p2","p2pStunServers","stunServers","_getConnectionFailedReasonDetails","_this$options$deploym","headersArr","header","_anonymousConnectionFailed","connectionFailed","_lastErrorMsg","_wasDisconnected","getConnection","credentials","statusStr","CONNECTION_STATUS_CHANGED","STROPHE_RECONNECTED_EVENT","_ref4","STROPHE_DISCONNECTED_EVENT","wasIntentionalDisconnect","lastFailedRawMessage","attaching","configDomain","hostname","onCreateResource","_this$connection$emuc","_this$connection$emuc2","getRoomJid","mucNickname","muc","_this$connection$emuc3","_this$connection$emuc4","getJingleLog","getXmppLog","_this$connection$logg","_this$connection$rayo","getSessions","disconnectListener","sendFaceLandmarksEvent","faceExpression","jsonString","unescape","E2EEErrors","emojiMapping","sasGenerators","decimal","sasBytes","emoji","REQ_TIMEOUT","OLM_MESSAGE_TYPE","OLM_MESSAGE_TYPES","OLM_KEY_VERIFICATION_MAC_INFO","OLM_KEY_VERIFICATION_MAC_KEY_IDS","kOlmData","OlmAdapterEvents","PARTICIPANT_E2EE_CHANNEL_READY","PARTICIPANT_KEY_UPDATED","PARTICIPANT_SAS_AVAILABLE","PARTICIPANT_SAS_READY","PARTICIPANT_VERIFICATION_COMPLETED","OlmAdapter","_conf","_init","_mediaKey","_mediaKeyIndex","_reqs","_sessionInitialization","_sessionReadyCallbacks","_bootstrapOlm","_onEndpointMessageReceived","_onConferenceLeft","_onParticipantLeft","_onParticipantPropertyChanged","myId","initSessions","localParticipantId","e2eeParticipants","outgoingPromises","_sendSessionInit","waitPromises","pId","_getParticipantOlmData","sessionPromise","race","Olm","updateKey","olmData","olm","ciphertext","_encryptKeyInfo","updateCurrentMediaKey","clearParticipantSession","_olmData$sasVerificat","free","pendingSessionUuid","lastKey","sasVerification","sas","clearAllParticipantsSessions","markParticipantVerified","isVerified","E2EE_SAS_CHANNEL_VERIFICATION_FAILED","E2EE_SAS_INVALID_SAS_VERIFICATION","sasMacSent","is_their_key_set","_sendSasMac","_olmAccount","Account","_idKeys","_safeJsonParse","identity_keys","get_library_version","_onIdKeysReady","startVerification","SAS","transactionId","startContent","startMessage","idKeys","keyType","_onParticipantE2EEChannelReady","base64js","encrypt","_sendError","Session","create_outbound","idKey","otKey","create_inbound","remove_one_time_keys","decrypt","_olmData$sasVerificat2","pubKey","get_pubkey","commitment","_computeCommitment","acceptMessage","sasCommitment","keyMessage","keySent","theirKey","E2EE_SAS_COMMITMENT_MISMATCHED","set_their_key","myInfo","theirInfo","generatedSas","generateSas","generate_bytes","mac","baseInfo","calculate_mac","E2EE_SAS_KEYS_MAC_MISMATCH","ed25519","E2EE_SAS_MISSING_KEY","computedMac","E2EE_SAS_MAC_MISMATCH","isE2EEEnabled","sessionEstablished","E2EE_OLM_SESSION_ALREADY_EXISTS","E2EE_OLM_SESSION_INIT_PENDING","generate_one_time_keys","otKeys","one_time_keys","curve25519","E2EE_OLM_NO_ONE_TIME_KEYS","mark_keys_as_published","keyList","deviceKeyId","macMessage","olmUtil","Utility","sha256","ManagedKeyHandler","_conferenceJoined","_olmAdapter","_rotateKey","debounce","_rotateKeyImpl","_ratchetKey","_ratchetKeyImpl","_onParticipantKeyUpdated","_onParticipantSasReady","_onParticipantSasAvailable","_onParticipantVerificationCompleted","USER_JOINED","_onParticipantJoined","_generateKey","material","keyBytes","subtle","importKey","newKey","textEncoder","TextEncoder","deriveBits","salt","encode","ratchet","E2EE_VERIFICATION_READY","E2EE_VERIFICATION_AVAILABLE","E2EE_VERIFICATION_COMPLETED","e2ee","_externallyManaged","externallyManagedKey","_keyHandler","_config$testing","disableE2EE","enableEncodedTransformSupport","setEncryptionKey","_this$_keyHandler$sas","_this$_keyHandler$sas2","E2ePingEvents","E2E_PING_REQUEST","E2E_PING_RESPONSE","ParticipantWrapper","e2eping","requests","lastRequestId","sendRequest","handleResponse","maybeLogRttAndStop","scheduleNext","getDelay","removeParticipant","conferenceSize","totalSeconds","numRequests","maxMessagesPerSecond","requestId","requestMessage","timeSent","request","Infinity","numRequestsWithResponses","totalNumRequests","E2E_RTT_CHANGED","E2ePing","maxConferenceSize","participantJoined","participantLeft","messageReceived","conferenceJoined","handleRequest","participantWrapper","kJitsiLiteMode","LiteModeContext","_setupLiteModeForTrack","transformStream","TransformStream","pipeThrough","pipeTo","DESKTOP_VIDEO_CODEC_ORDER","MOBILE_P2P_VIDEO_CODEC_ORDER","MOBILE_VIDEO_CODEC_ORDER","CodecSelection","codecPreferenceOrder","visitorCodecs","connectionType","disabledCodec","preferenceOrder","enableAV1ForFF","supportedCodecs","_getSupportedVideoCodecs","selectedOrder","_disabledCodec","_preferredCodec","isVp9EncodeSupported","selectedCodec","_window$RTCRtpReceive3","supportedCodec","getCodecPreferenceList","getScreenshareCodec","selectPreferredCodec","mediaSession","_remoteParticipants$m","_this$screenshareCode","localPreferredCodecOrder","remoteParticipants","remoteCodecsPerParticipant","selectedCodecOrder","acc","localCodec","codecNotSupportedByRemote","remoteCodecs","participantCodec","changeCodecPreferenceOrder","getActiveMediaSession","codecOrder","codecsByVideoType","codecIndex","newCodec","updateVisitorCodecs","ReceiverAudioSubscription","ReceiverAudioController","_sourceList","_subscriptionMode","ALL","audioSubscription","muteRemoteAudio","setAudioSubscriptionMode","NONE","INCLUDE","EXCLUDE","ReceiveVideoController","_config$startLastN","startLastN","_maxFrameHeight","_assumedBandwidthBps","_lastNLimitedByCpu","_receiveResolutionLimitedByCpu","assumedBandwidthBps","_getDefaultSourceReceiverConstraints","_mediaSession$peercon","remoteVideoTracks","_updateIndividualConstraints","individualConstraints","defaultConstraints","getCurrentReceiverConstraints","isLastNLimitedByCpu","onMediaSessionStarted","setAssumedBandwidthBps","setLastNLimitedByCpu","setPreferredReceiveMaxFrameHeight","setReceiverConstraints","_constraints$assumedB","p2pSession","mappedConstraints","setReceiveResolutionLimitedByCpu","SendVideoController","_preferredSendMaxFrameHeight","_sourceSenderConstraints","_propagateSendMaxFrameHeight","sendMaxFrameHeight","_selectSendMaxFrameHeight","remoteRecvMaxFrameHeight","configureConstraintsForLocalSources","sourceConstraints","onSenderConstraintsReceived","videoConstraints","_this$_conference$get","setPreferredSendMaxFrameHeight","QualityLimitationReason","FixedSizeArray","_maxSize","QualityController","_options$enableAdapti","_audioController","_codecController","_enableAdaptiveMode","enableAdaptiveMode","_encodeTimeStats","_isLastNRampupBlocked","_lastNRampupTime","lastNRampupTime","_receiveVideoController","_sendVideoController","CONFERENCE_VISITOR_CODECS_CHANGED","debouncedSelectCodec","_debounce","_processOutboundRtpStats","delay","_timer","_lowerOrRaiseLastN","cpuLimited","receiveVideoController","newLastN","videoStreamsReceived","isStillLimitedByCpu","_maybeLowerReceiveResolution","currentLevel","_maybeSwitchVideoCodec","encodeResolution","_limitedByCpuTimeout","updatedStats","latestSourceStats","expectedSendResolution","CPU","codecController","_performQualityOptimizations","sourceStats","_lastNRampupTimeout","ENCODER_CPU_RESTRICTED_EVENT","statsPerTrack","existingStats","_trackStats$find","avgEncodeTime","totalValue","currentValue","exisitingStats","audioController","sendVideoController","JibriSession","_jibriJid","_statusFromJicofo","_setSessionID","sessionID","setStatus","_focusMucJid","getError","_error","getID","_sessionID","getInitiator","_initiator","getLiveStreamViewURL","_liveStreamViewURL","getJibriJid","getTerminator","_terminator","getMode","setError","setLiveStreamViewURL","setStatusFromJicofo","setJibriJid","jibriJid","appData","broadcastId","_this$_connection","_createIQ","_response$getElements","_response$getElements2","_this$_connection2","_setErrorFromIq","_this$_connection3","_this$_connection4","errorChildren","_chatRoom","getSession","_sessions","getSessionByJibriJid","_presence$getAttribut","_presence$getAttribut2","isFromFocus","_handleJibriPresence","_handleFocusPresence","prevStatus","_emitSessionUpdate","startRecording","_addSession","stopRecording","_createSession","jibriStatus","recordingMode","getFocusRecordingUpdate","liveStreamViewURL","_presence$getElements","_presence$getElements2","_presence$getElements3","getHiddenDomainUpdate","AverageStatReport","_count","_sum","_samples","addNext","calculate","NaN","appendReport","ConnectionAvgStats","avgRtpStatsReporter","_n","_sampleIdx","_avgRTT","_avgRemoteRTTMap","_avgRtpStatsReporter","_avgEnd2EndRTT","_onConnectionStats","_calculateAvgStats","_onRemoteStatsUpdated","_processRemoteStats","_data$transport2","batchReport","jvbEnd2EndRTT","jvbStatsMonitor","rtt_diff","avgRemoteRTT","_calculateAvgRemoteRTT","avgLocalRTT","end2end_rtt_avg","_resetAvgStats","sum","remoteAvg","avg","validData","rttAvg","AvgRTPStatsReporter","_avgAudioBitrateUp","_avgAudioBitrateDown","_avgVideoBitrateUp","_avgVideoBitrateDown","_avgBandwidthUp","_avgBandwidthDown","_avgPacketLossTotal","_avgPacketLossUp","_avgPacketLossDown","_avgRemoteFPS","_avgRemoteScreenFPS","_avgLocalFPS","_avgLocalScreenFPS","_avgRemoteCameraPixels","_avgRemoteScreenPixels","_avgLocalCameraPixels","_avgLocalScreenPixels","_avgCQ","_cachedTransportStats","_onLocalStatsUpdated","_maybeSendTransportAnalyticsEvent","_onP2PStatusChanged","p2pStatsMonitor","_onJvb121StatusChanged","activeSession","_resetAvgJvbStats","confSize","_calculateAvgVideoFps","_calculateAvgVideoPixels","_data$transport3","peerResolutions","peerPixelsSum","peerCount","myID","peerID","videosResolution","peerAvgPixels","_calculatePeerAvgVideoPixels","videos","peerSsrcCount","peerSsrcPixels","peerFpsSum","videosFps","peerAvgFPS","_calculatePeerAvgVideoFps","peerSsrcFps","_data$transport4","transportStats","userId","isLocalStats","_userId","setDisplayName","_isLocalStats","setDominantSpeaker","totalDominantSpeakerTime","_dominantSpeakerStart","_isDominantSpeaker","_hasLeft","_faceLandmarks","getUserId","newName","isDominantSpeaker","isNowDominantSpeaker","timeElapsed","getTotalDominantSpeakerTime","hasLeft","markAsHasLeft","getFaceLandmarks","setFaceLandmarks","faceLandmarks","addFaceLandmarks","SpeakerStatsCollector","dominantSpeakerId","SpeakerStats","_onDominantSpeaker","_onUserJoin","_onUserLeave","_onDisplayNameChange","_onFaceLandmarkAdd","_updateStats","oldDominantSpeaker","newDominantSpeaker","savedUser","speakerStatsToUpdate","newParticipant","ComponentsVersions","versions","addCommandListener","_processVersions","_","getComponentVersion","componentName","VideoSIPGWStatusConstants","VideoSIPGWStateConstants","VideoSIPGWErrorConstants","STATUS_AVAILABLE","STATUS_UNDEFINED","STATUS_BUSY","STATE_ON","STATE_OFF","STATE_PENDING","STATE_RETRYING","STATE_FAILED","ERROR_NO_CONNECTION","ERROR_SESSION_EXISTS","STATE_CHANGED","JitsiVideoSIPGWSession","sipAddress","_sendJibriIQ","nodeTree","setState","VideoSIPGWConstants","failureReason","oldState","addStateListener","removeStateListener","VideoSIPGW","sessionStateChangeListener","sessionStateChanged","handleJibriSIPState","Constants","sipaddress","failure_reason","createVideoSIPGWSession","SOURCE_INFO_PRESENCE_ELEMENT","SignalingLayerImpl","_ssrcOwners","_localSourceState","_remoteSourceState","_addLocalSourceInfoToPresence","_bindChatRoomEventHandlers","emitAudioMutedEvent","_audioMuteHandler","_doesEndpointSendNewSourceInfo","emitVideoMutedEvent","_videoMuteHandler","emitVideoTypeEvent","_videoTypeHandler","_sourceInfoHandler","sourceInfoJSON","emitEventsFromHere","endpointSourceState","_sourceInfoJSON$sourc","sourceChanged","newMutedState","oldSourceState","newVideoType","SOURCE_UPDATED","newSourceNames","_memberLeftHandler","_this$_chatRoom","_logOwnerChangedMessage","_this$_chatRoom2","lastPresence","legacyGetPeerMediaInfo","mediaInfo","codecListNode","_codecListNode$0$valu","_codecListNode$0$valu2","_this$_remoteSourceSt","_this$_ssrcOwners$get","_this$_ssrcOwners$get2","setChatRoom","oldChatRoom","newEndpointId","newSourceName","existingOwner","BridgeVideoType","DEFAULT_TRANSCRIPTION_LANGUAGE","_getCodecMimeType","JitsiConference","_this$connection","_options$config$p2p","_this$options$config$","_this$options$config$2","additionalLogMsg","eventManager","componentsVersions","dtmfManager","somebodySupportsDTMF","startMutedPolicy","wasStopped","avgRtpStatsN","speakerStatsCollector","deferredStartP2PTask","backToP2PDelay","isP2PConnectionInterrupted","p2pJingleSession","videoSIPGWHandler","recordingManager","RecordingManager","_conferenceJoinAnalyticsEventSent","isE2EESupported","_e2eEncryption","_liteModeContext","_audioSenderLimitReached","_videoSenderLimitReached","_firefoxP2pEnabled","enableFirefoxP2p","_iceRestarts","_unsubscribers","resourceCreator","isAuthenticatedUser","_Strophe$getNodeFromJ","_config$statisticsId","_config$e2eping","_config$videoQuality","_config$videoQuality2","_config$videoQuality3","_config$videoQuality4","_config$videoQuality5","_config$videoQuality6","_config$videoQuality7","_config$testing$lastN","_config$testing2","_config$p2p","_config$p2p2","_config$p2p3","_config$p2p4","_config$p2p5","_config$p2p6","_config$deploymentInf","_config$transcription","statisticsId","PARTICIPANT_SOURCE_UPDATED","_onIceConnectionEstablished","_onIceConnectionFailed","_onIceConnectionInterrupted","_onIceConnectionRestored","_updateProperties","_sendConferenceJoinAnalyticsEvent","_removeLocalSourceOnReject","_updateRoomPresence","_registerRtcListeners","qualityOptions","mobileCodecPreferenceOrder","mobileScreenshareCodec","_config$confID","_config$statisticsDis","qualityController","aliasName","applicationName","confID","statisticsDisplayName","enableTalkWhileMuted","_audioAnalyser","vadTalkMutedDetection","TALK_WHILE_MUTED","enableNoisyMicDetection","vadNoiseDetection","NOISY_MIC","enableNoAudioDetection","_noAudioSignalDetection","hasAudioSignal","p2pDominantSpeakerDetection","transcriptionLanguage","setTranscriptionLanguage","_window$JitsiMeetJS$a","_window$JitsiMeetJS","conferenceConnectionTimes","xmppConnectionTimes","globalNSConnectionTimes","JitsiMeetJS","app","connectedToMUCJoinedTime","connectingToMUCJoinedTime","connecting","numberOfParticipantsOnJoin","_numberOfParticipantsOnJoin","xmppConnectingTime","_sendConferenceLeftAnalyticsEvent","_stopP2PSession","_maybeStartOrStopP2P","_fireAudioLevelChangeEvent","activeTpc","_fireMuteChangeEvent","actorId","_doReplaceTrack","replaceTrackPromises","errorReason","TRACK_UNMUTE_REJECTED","_setupNewTrack","_this$getLocalTracks","_setNewVideoType","videoTypeChanged","_maybeClearSITimeout","_sessionInitiateTimeout","_maybeSetSITimeout","ACTION_JINGLE_SI_TIMEOUT","_maybeClearDeferredStartP2P","_removeRemoteJVBTracks","_removeRemoteTracks","_removeRemoteP2PTracks","sessionNickname","_resumeMediaTransferForJvbConnection","_setP2PStatus","p2pFailed","isVideoActive","_startP2PSession","_this$p2pJingleSessio","_suspendMediaTransferForJvbConnection","userLeftEvent","isP2PEnabled","isP2PTestModeEnabled","peers","shouldBeInP2P","_shouldBeInP2PMode","_this$options$config$3","_this$options$config$4","peersId","forceInitiator","forceResponder","ACTION_P2P_SWITCH_TO_JVB","hasBotPeer","_hasVisitors","_transcribingEnabled","wasP2PEstablished","_addRemoteJVBTracks","skip","muteStatusChanged","presenceChanged","_updateFeatures","updateDTMFSupport","_acceptJvbIncomingCall","ACTION_JINGLE_RESTART","ACTION_JINGLE_SI_RECEIVED","_setBridgeChannel","_desktopSharingFrameRate","_this$connection2","_this$connection$opti","_this$connection3","ignoreDomain","bridgeChannel","preferSctp","sctpOffered","firstWsUrl","_rejectIncomingCall","_onIncomingCallP2P","rejectReason","contentName","ACTION_P2P_DECLINED","_acceptP2PIncomingCall","ACTION_P2P_FAILED","jitterDelay","_delayedIceFailed","_this$options$config$5","createJvbIceFailedEvent","ACTION_JVB_ICE_FAILED","_addRemoteTracks","_addRemoteP2PTracks","p2pEstablishmentDuration","jvbEstablishmentDuration","done","establishmentDurationDiff","ICE_ESTABLISHMENT_DURATION_DIFF","ACTION_P2P_ESTABLISHED","_this$properties$visi","_publishedCodecs","audioLimitReached","videoLimitReached","AUDIO_UNMUTE_PERMISSIONS_CHANGED","VIDEO_UNMUTE_PERMISSIONS_CHANGED","publishedCodecs","_visitorCodecs","_fireIncompatibleVersionsEvent","localtrack","removePromises","addPromises","isJoined","START_MUTED_POLICY_CHANGED","botParticipant","BOT_TYPE_CHANGED","authenticateAndUpgradeRole","rejectPromise","onLoginSuccessful","canceled","authenticationError","connectionError","_xmpp2","_this$options$config$6","_this$options$config$7","p2pTestMode","_this$getBreakoutRoom","onLocalTrackRemoved","mJid","leaveError","_this$connection4","isEndConferenceSupported","isAuthEnabled","isLoggedIn","getAuthLogin","removeCommandListener","sendTextMessage","sendPrivateTextMessage","useFullJid","sendCommand","sendCommandOnce","removeCommand","nickKey","silent","getTranscriptionStatus","_this$options$config$8","allowMultipleTracks","_this$getLocalTracks2","addTrackPromises","oldVideoType","_this$getLocalTracks3","oldTrackBelongsToConference","lock","unlock","isInteger","countHidden","grantOwner","revokeOwner","isMyself","isMembersOnly","kickParticipant","fullJid","_this$p2pJingleSessio2","_this$p2pJingleSessio3","_this$jvbJingleSessio","_this$jvbJingleSessio2","audioMuted","videoMuted","numberOfParticipants","mediaSessions","tracksToBeRemoved","kickedParticipantId","kickedParticipant","PARTICIPANT_KICKED","USER_ROLE_CHANGED","transportInfo","removedTrack","ACTION_JINGLE_TERMINATE","stopOptions","DTMF_SUPPORT_CHANGED","isDTMFSupported","_this$room3","peerConnection","isSIPCallingSupported","_this$room$xmpp$moder","_this$room4","setStartMutedPolicy","policy","getStartMutedPolicy","removeLocalParticipantProperty","getLocalParticipantProperty","property","overallFeedback","detailedFeedback","getSsrcByTrack","_this$getActivePeerCo","sendApplicationLog","sendEndpointMessage","broadcastEndpointMessage","sendThroughVideobridge","messageType","messageToSend","getP2PConnectionState","_this$jvbJingleSessio3","fps","startP2PSession","stopP2PSession","getSpeakerStats","sendFaceLandmarks","_this$_e2eEncryption","toggleE2EE","setMediaEncryptionKey","isLobbySupported","_this$room5","_this$room6","isVisitorsSupported","_this$room7","disableLobby","joinLobby","myLobbyUserId","sendLobbyMessage","addLobbyMessageListener","removeLobbyMessageHandler","lobbyDenyAccess","lobbyApproveAccess","isAVModerationSupported","_this$room8","enableAVModeration","disableAVModeration","avModerationApprove","avModerationReject","_this$room9","_this$room10","_this$room11","_this$room12","JitsiConnection","appID","errType","createConnectionFailedEvent","errorType","errorMessage","setToken","initJitsiConference","getLogs","ua","JitsiMediaDevicesEvents","AUDIO_PERMISSION_NAME","VIDEO_PERMISSION_NAME","stopActiveDevices","CustomSignalingLayer","ssrcOwners","_owner","_mediaType","_videoType","ACTIONS","ProxyConnectionPC","receiveAudio","receiveVideo","_peerConnection","_onError","_onRemoteStream","_onSendMessage","getPeerJid","processMessage","ACCEPT","_onSessionAccept","INITIATE","_onSessionInitiate","TERMINATE","_onSessionTerminate","_onTransportInfo","_createPeerConnection","connectionStub","pcConfigStub","roomStub","jitsiRemoteTrack","onRemoteStream","onSendMessage","ParsedIceCandidate","iceCandidateStr","parsed","typeTransport","extractTypeTransport","ipv6","ipAddress","getString","isHost","isServerReflexive","isPeerReflexive","isRelay","isPublicIp","getTypeTransport","isTypeTransportUdp","isTypeTransportTcp","isTypeTransportTls","getTransport","isUdp","isTcp","getProtocol","isRtp","isRtcp","isIpv6","getIpAddress","getPort","codeBaseType","chrome","firefox","edge","browserName","msie","safari","osName","windows","android","ios","StatsAdapter","codeBase","getIceCandidates","rawData","localCandidates","remoteCandidates","iceCandidatePairs","rawStats","extractRawStats","processRawStatsForIceInfo","selectedCandidatePairId","candidatePairs","parsedStats","getParsedStats","classifiedStats","statsClassifier","candidatePair","localCandidate","mozLocalTransport","relayType","formatRelayType","remoteCandidate","googActiveConnection","expectedType","typeIsInbound","reportType","selected","GetStatsHandler","isPromiseBased","csioGetStats","iceCandidatesHandler","candidatesObj","statsHandler","getStatsFirefox","getStatsSafari","getStatsChrome","getStatsEdge","csioReactNative","TurnConnection","statshandler","pctpc1","pctpc2","sendChannel","messageCallback","parsedIceResults","resolveCb","rejectCb","localIpAddressInfo","localIpAddresses","localIp","localIpType","numberOfLocalIp","setMessageCallback","setErrorCallback","raiseSendError","assignEvent","attachEvent","CSRTCPeerConnection","continueFlag","datachannelSettings","ordered","maxRetransmits","servers","rejectDisconnect","connectionTimer","binaryType","onIceCandidate","onIceStateChange","onCreateOfferSuccess","onCreateOfferError","iceTimer","getOtherPc","onCreateAnswerError","onSetLocalSuccess","onSetSessionDescriptionError","onSetRemoteSuccess","onSetRemoteSessionDescriptionError","onCreateAnswerSuccess","relayUdpGathered","relayTcpGathered","relayTlsGathered","srflxGathered","onAddIceCandidateSuccess","onAddIceCandidateError","getIceResults","iceResults","turnIpAddress","turnIpVersion","turnTransport","ipv6Supported","ipv4Supported","relayTlsSuccess","relayTcpSuccess","relayUdpSuccess","srflxSuccess","localIP","numberOfLocalIPs","localIPType","localIPNetworkType","ipInfo","foundActiveCand","pair","turnNetworkType","getCurrent","timing","navigationStart","TurnTest","getResults","handleMessage","handleError","forceStopped","initiate","forceStop","finished","failed","LAST_TIMEOUT","RttTest","sendTimer","countSent","rtts","startTimestamp","Timestamps","sendPing","sentTs","calculateRtt","calculateMetrics","fillResults","sentMessages","unAckedMessages","maxMessages","median","average","variance","std","endTimestamp","half","sqrt","randomAsciiString","fromCharCode","MessageMaker","sentBytes","padding","PADDING","make","ThroughputTest","receivedBytes","secondHalfBytes","secondHalfStart","bufferEmpty","chunkSize","messageMaker","intervals","intervalStart","intervalLength","intervalBytes","lastReceivedTimestamp","startSend","lastMessage","intervalDuration","intervalAvg","averageThroughput","bytes","milliseconds","bufferListener","fillBuffer","bufferedAmount","bufferFullThreshold","usePolling","bufferedAmountLowThreshold","maxDuration","bytesPrepared","bytesReceived","allDuration","allAverage","fractionLostBytes","LossTest","numBufferFill","sentData","msgJson","totalBytes","ResultsHandler","trunc","failures","setStatusStopped","setStatusFailed","setStatusSuccess","tests","getFailureNumber","testName","OnlineCheck","onlineCheck","addEntry","onLine","TEST_NAMES","osVersion","agentVersion","csioGetOsName","csioGetOsVer","os","nVer","fullVersion","verOffset","nAgt","appVersion","opera","clientStrings","splitWords","browserVersion","detect","callsInProgress","turnTests","resultsHandler","startResolve","startReject","turnTestCounter","endpointInfo","buildName","buildVersion","_start","turnConnection","startTurnTests","activeTurnTest","onlineCheckResults","sendResults","getPublicPrecalltestResults","publicResults","mediaConnectivity","throughput","fractionalLoss","jitter","resultsMin","callStarts","callFinished","crashDisconnect","handleTestResults","loadScript","prepend","relativeURL","loadCallback","script","referenceNode","scriptEl","currentExecutingScript","scriptSrc","baseScriptSrc","onload","parentNode","AudioMixer","_started","_streamsToMix","_streamMSSArray","addMediaStream","_mixedMSD","createMediaStreamDestination","streamMSS","INFO","hasGUMExecuted","getAnalyticsAttributesFromOptions","audio_requested","video_requested","screen_sharing_requested","_permissions","_permissionsApiSupported","_parsePermissionState","_handlePermissionsChange","permissions","query","onchange","supported","isDevicePermissionGranted","permissionStatus","isMultipleAudioInputSupported","ProxyConnectionService","jitsiConnection","_onFatalError","_convertStringToXML","UNAVAILABLE","_selfCloseConnection","localTrackIndex","localSourceNameTrack","xml","xmlString","doc","DOMParser","parseFromString","parserError","parseXML","convertVideoToDesktop","jitsiLocalTracks","stringifiedIq","XMLSerializer","serializeToString","onConnectionClosed","addGlobalLogTransport","globalTransport","constants","BUSY","POLICY_VIOLATION","RESOURCE_CONSTRAINT","SERVICE_UNAVAILABLE","UNEXPECTED_REQUEST","FILE","STREAM","sipVideoGW","createAudioMixer","isFirstGUM","startTS","endTS","isCollectingLocalStats","currentlyAvailableMediaDevices","createLocalTracksFromMediaStreams","trackInfo","createTrackVADEmitter","localAudioDeviceId","errorTypes","detection","rtcstats","getActiveAudioDevice","audioDevices","devicePromiseArray","micDevice","devicePromise","outcomeArray","successfulPromises","rejectedPromises","rejectReasons","deviceLabel","rtcstatsStoreLogs","rtcstatsLogFlushSizeBytes","enableAnalyticsLogging","joinConference","_options$connectionOp","appId","connectionOptions","_options$jaas$useStag","_options$jaas","useStage","jaas","useStaging","jaasDomain","merge","cleanupListeners","onConnectionEstablished","onConnectionFailed","_options$conferenceOp","conf","conferenceOptions","logLevels","removeGlobalLogTransport","sendIdentityEntry","runPreCallTest","PreCallTest","setGlobalLogOptions","setLogLevel","setLogLevelById","setNetworkInfo","util","ScriptUtil","_mergeNamespaceAndModule","internals","firstOptions","reviver","protoAction","scan","SyntaxError","__proto__","safeParse","ignoreError","FUNC_TYPE","UNDEF_TYPE","OBJ_TYPE","STR_TYPE","MAJOR","MODEL","NAME","TYPE","VENDOR","VERSION","ARCHITECTURE","CONSOLE","MOBILE","TABLET","SMARTTV","WEARABLE","EMBEDDED","AMAZON","APPLE","ASUS","BLACKBERRY","BROWSER","GOOGLE","HUAWEI","LG","MICROSOFT","MOTOROLA","OPERA","SAMSUNG","SHARP","SONY","XIAOMI","ZEBRA","FACEBOOK","CHROMIUM_OS","MAC_OS","enumerize","enums","str1","str2","lowerize","rgxMapper","arrays","regex","strMapper","windowsVersionMap","regexes","cpu","EDGE","extensions","getResult","_ua","_uach","userAgentData","_rgxmap","mergedRegexes","extend","_isSelfNav","_browser","brave","isBrave","getCPU","_cpu","getDevice","_device","mobile","standalone","maxTouchPoints","_os","platform","getUA","setUA","DEVICE","ENGINE","OS","$","jQuery","Zepto","LogCollector","logStorage","stringifyObjects","storeInterval","levels","logLevel","_log","storeLogsIntervalID","totalLen","outputCache","someObject","formatLogMessage","prevMessage","_flush","_reschedulePublishInterval","_storeLogs","logs","reschedule","logStorageReady","cachedQueue","consoleTransport","globalTransports","addGlobalTransport","removeGlobalTransport","transportIdx","globalOptions","callerInfo","disableCallerInfo","fileLocation","column","getCallerInfo","transports","logPrefixes","toISOString","fullLogParts","methods","setGlobalOptions","setLevel","TRACE","LOG","idLoggers","loggers","curLevel","getUntrackedLogger","ap","Tk","Vk","b1","zP","$j","dL","aM","vP","xt","Zt","UN","IO","zl","v6","S1","initSDK","setConfig","setUserRating","addKeys","disableDataCollection","enableDataCollection","addEvent","mapStream","mapTrack","registerOnStatsListener","persistentEnd","persistentStart","registerStateListener","default","addTags","addStatsListener","qualityrtc","run","qrtcRun","qrtcStop","__assign","__awaiter","throw","__generator","sent","trys","ops","return","__spreadArray","sdkLogWithoutTrace","sdkLog","u","projectId","S","C","z","T","I","L","P","R","O","getSdkLogger","getSdkLogWithoutTrace","D","E","M","forceRecreate","reconnecting","nailUp","isDisabledDataCollection","isManualDisconnect","isManualConnect","tryingToConnectSocket","watchrtcConfig","openChannels","isRoomIdOrPeerIdChanged","countOfValidConnections","connectionCount","validateConfig","rtcToken","getConnectionData","proxyUrl","U","cleanOldTraces","onData","allowBrowserLogCollection","collectConsoleLogEnabled","override","collectConsoleLogLevel","setConsoleLevel","restoreOriginalConsoleMethods","connectionId","collectionInterval","W","oldInterval","sdkVersion","watchRTCSessionId","onOpen","connectionStatus","onClose","wasClean","authFailed","reconnectTimerId","nailUpRef","logGetStats","connections","A","applyPatchForRTT","subtractNailUpReferenceStats","exposeApplicationStatsForPC","watchRTCInitialized","generateID","getHardwareInfo","hardwareInfo","URLSearchParams","socketService","httpService","watchrtc","validConnection","errorText","HTMLMediaElement","__pcId","parameterless","F","newWatchrtcConfig","validateRating","ratingComment","promiseFuncs","N","validateEvent","J","K","progressCallback","codeUrl","configUrl","codeLoad","configAnswer","__qualityRTC","jsonConfig","isProbe","wakeLock","netlifyBaseUrl","configData","qualityRTC","getStreamsFromStats","getTransportFromStats","relayProtocol","remoteId","peerId","mappedName","packetsReceived","packetsLoss","roundTripTime","packetsSent","fractionLost","mediaSourceId","getMonth","getDate","getFullYear","getHours","getMinutes","getSeconds","getMilliseconds","_original_log","old","new","fileName","getGPUTier","loadBenchmarks","cores_count","hardwareConcurrency","memory","jsHeapSizeLimit","totalJSHeapSize","usedJSHeapSize","originalMethodPrefix","methodsToPatch","WeakSet","roundTripTimeMeasurements","_instance","sendInterval","dataCollection","sendPromises","prevMessageTs","abs","timeSinceLastMessage","compressToEncodedURIComponent","filteredCount","setPrototypeOf","MSStream","isIpad","isMobile","isSafari12","mobileTiers","desktopTiers","glContext","failIfMajorPerformanceCaveat","benchmarksURL","tier","screenSize","renderer","MAX_VALUE","devicePixelRatio","gpu","alpha","antialias","depth","powerPreference","stencil","getContext","getExtension","getParameter","UNMASKED_RENDERER_WEBGL","createShader","createProgram","shaderSource","compileShader","attachShader","linkProgram","detachShader","deleteShader","useProgram","createBuffer","bindBuffer","bufferData","getAttribLocation","vertexAttribPointer","enableVertexAttribArray","clearColor","viewport","drawArrays","readPixels","deleteProgram","deleteBuffer","compressToBase64","_compress","decompressFromBase64","_decompress","compressToUTF16","decompressFromUTF16","compressToUint8Array","compress","decompressFromUint8Array","decompress","decompressFromEncodedURIComponent","position","globalThis","b64","lens","getLens","validLen","placeHoldersLen","toByteArray","Arr","_byteLength","curByte","revLookup","fromByteArray","uint8","extraBytes","maxChunkLength","len2","encodeChunk","lookup","tripletToBase64","output","scriptReadyRegex","fullPageUrl","pageUrl","scripts","supportsScriptReadyState","isNotOpera","hasNativeCurrentScriptAccessor","stackTraceLimit","hasStackBeforeThrowing","hasStackAfterThrowing","getScriptUrlFromStack","skipStackDepth","ignoreMessage","_nearestExecutingScript","eligibleScripts","getScriptFromUrl","getSoleInlineScript","currentScript","thrownErr","near","far","ReflectOwnKeys","Reflect","ReflectApply","ownKeys","getOwnPropertyNames","NumberIsNaN","isNaN","errorListener","resolver","eventTargetAgnosticAddListener","addErrorHandlerIfEventEmitter","_events","_eventsCount","_maxListeners","defaultMaxListeners","checkListener","_getMaxListeners","that","_addListener","warning","warned","onceWrapper","fired","wrapFn","_onceWrap","wrapped","_listeners","unwrap","evlistener","unwrapListeners","arrayClone","wrapListener","setMaxListeners","getMaxListeners","doError","er","prependListener","prependOnceListener","originalListener","spliceOne","rawListeners","eventNames","WINDOW","JS_MD5_NO_WINDOW","WEB_WORKER","NODE_JS","JS_MD5_NO_NODE_JS","COMMON_JS","JS_MD5_NO_COMMON_JS","AMD","ARRAY_BUFFER","JS_MD5_NO_ARRAY_BUFFER","HEX_CHARS","EXTRA","SHIFT","OUTPUT_TYPES","BASE64_ENCODE_CHAR","blocks","buffer8","Uint32Array","JS_MD5_NO_ARRAY_BUFFER_IS_VIEW","isView","createOutputMethod","outputType","Md5","update","createMethod","nodeWrap","eval","nodeMethod","createHash","digest","sharedMemory","h0","h1","h2","h3","hBytes","finalized","hashed","first","notString","lastByteIndex","finalize","bc","da","hex","base64","v1","v2","v3","base64Str","md5","grammar","reg","rate","subtype","sessionConfig","raddr","dir2","writer","write","parseFmtpConfig","parseParams","parsePayloads","parseRemoteCandidates","parseImageAttributes","parseSimulcastStreamList","toIntIfInt","parseReg","needsBlank","keyLocation","rawName","attachProperties","validLine","paramReducer","scid","formatRegExp","formatStr","makeLine","defaultOuterOrder","defaultInnerOrder","outerOrder","innerOrder","localCName","generateIdentifier","splitLines","blob","splitSections","part","getDescription","getMediaSections","matchPrefix","parseCandidate","relatedPort","tcpType","writeCandidate","parseIceOptions","parseRtpMap","clockRate","numChannels","writeRtpMap","preferredPayloadType","writeExtmap","headerExtension","preferredId","kv","writeFmtp","parseRtcpFb","writeRtcpFb","rtcpFeedback","parseSsrcMedia","sp","colon","parseSsrcGroup","getMid","algorithm","getDtlsParameters","fingerprints","writeDtlsParameters","setupType","fp","parseCryptoLine","cryptoSuite","keyParams","sessionParams","writeCryptoLine","writeCryptoKeyParams","parseCryptoKeyParams","keyMethod","keySalt","lifeTime","mkiValue","mkiLength","getCryptoParameters","getIceParameters","writeIceParameters","iceLite","parseRtpParameters","headerExtensions","fecMechanisms","rtcp","rtpmapline","fmtps","writeRtpDescription","maxptime","extension","parseRtpEncodingParameters","encodingParameters","hasRed","hasUlpfec","flows","apt","encParam","codecPayloadType","fec","mechanism","parseRtcpParameters","rtcpParameters","remoteSsrc","rsize","reducedSize","compound","mux","writeRtcpParameters","parseMsid","spec","planB","msidParts","parseSctpDescription","maxSizeLine","sctpPort","sctpMapLines","writeSctpDescription","generateSessionId","writeSessionBoilerplate","sessId","sessVer","sessUser","getDirection","getKind","isRejected","parseOLine","netType","addressType","isValidSDP","global$1","WebSocketImplementation","getWebSocketImplementation","getDOMParserImplementation","DOMParserImplementation","getDummyXMLDOMDocument","createDocument","implementation","documentMode","docStrings","ActiveXObject","_getIEXmlDom","safe_add$1","str2binl","md5_cmn","md5_ff","md5_gg","md5_hh","md5_ii","core_md5","MD5","hexdigest","hex_tab","binl2hex","binl2str","SASLMechanism","isClientFirst","mechname","onStart","onChallenge","challenge","clientChallenge","out","cookies","cookieName","expires","path","cookieObj","cookieValue","escape","cookie","core_hmac_sha1","bkey","ipad","opad","binb2str","b64_hmac_sha1","b64_sha1","str_hmac_sha1","str_sha1","Builder","HTTPBIND","BOSH","AUTH","ROSTER","PROFILE","MUC","SASL","FRAMING","BIND","SESSION","STANZAS","XHTML_IM","XHTML","css","validTag","validAttribute","validCSS","style","REDIRECT","ATTACHFAIL","ErrorCondition","BAD_FORMAT","CONFLICT","MISSING_JID_NODE","NO_AUTH_MECH","UNKNOWN_REASON","ElementType","NORMAL","TEXT","CDATA","FRAGMENT","SECONDARY_TIMEOUT","forEachChild","elemName","childNodes","childNode","_xmlGenerator","xmlGenerator","xmlTextNode","xmlescape","createTextNode","xmlHtmlNode","html","loadXML","nodeValue","copyElement","createHtml","cssText","cssAttrs","cssName","cssValue","createDocumentFragment","escapeNode","unescapeNode","bare","fatal","sourceURL","lineNumber","_console","getNamedItem","_requestId","_connectionPlugins","ptype","moreattrs","removeAttribute","impNode","xmlGen","importNode","newElem","fragment","innerHTML","xhtml","matchBare","matchBareFromJid","Handler","getNamespace","elNamespace","ignoreNamespaceFragment","namespaceMatch","nsMatch","isMatch","elem_type","TimedHandler","setProtocol","_sasl_data","do_session","mechanisms","protocolErrorHandlers","_idleTimeout","_disconnectTimeout","do_authentication","_uniqueId","_sasl_success_handler","_sasl_failure_handler","_sasl_challenge_handler","_onIdle","iqFallbackHandler","WorkerWebsocket","Websocket","Bosh","_reset","_requests","getUniqueId","suffix","addProtocolErrorHandler","status_code","hold","route","authcid","disconnection_timeout","authzid","connect_callback","wind","_attach","restore","_sessionCachingSupported","_restore","sessionStorage","xmlInput","nextValidRid","_queueData","timeoutHandler","iqtype","_sendRestart","thand","handRef","hand","SASLExternal","SASLOAuthBearer","SASLXOAuth2","registerSASLMechanism","Mechanism","_addSysTimedHandler","_onDisconnectTimeout","_disconnect","_dataRecv","_reqToData","strip","_emptyQueue","cond","conflict","UNKOWN_REASON","_connect_cb","_callback","bodyWrap","hasFeatures","_no_auth_received","matched","sortMechanismsByPriority","higher","swap","_attemptSASLAuth","_attemptLegacyAuth","mechanism_found","_sasl_success_cb","_sasl_failure_cb","_sasl_challenge_cb","_sasl_mechanism","request_auth_exchange","btoa","atob","_onLegacyAuthIQResult","_auth2_cb","serverSignature","attribMatch","streamfeature_handlers","_onResourceBindResultIQ","jidNode","_establishSession","_onSessionResultIQ","auth_str","nonce","iter","Hi","U_old","responseText","authMessage","cnonce","clientKey","serverKey","clientSignature","test_cnonce","core","Request","sends","xmlData","origFunc","date","abort","dead","age","timeDead","xhr","_newXHR","getResponse","responseXML","documentElement","XMLHttpRequest","overrideMimeType","onreadystatechange","_conn","inactivity","keepalive","_cacheSession","_onRequestStateChange","_throttledRequestHandler","typ","_sendTerminate","_callProtocolErrorHandlers","reqStatus","_getRequestStatus","err_callback","HTTP","_hitError","time_elapsed","def","getAllResponseHeaders","reqIs0","reqIs1","valid_request","too_many_retries","_removeRequest","_restartRequest","_processRequest","primary_timeout","secondary_timeout","server_error","content_type","contentType","open","setRequestHeader","withCredentials","e2","sendFunc","customHeaders","backoff","new_service","pathname","_buildStream","_checkStreamError","connectstatus","errorString","_onOpen","_onInitialMessage","_handleStreamStart","streamStart","parsedMessage","see_uri","_replaceMessageHandler","_streamWrap","closeString","rawStanza","startString","lmap","SharedWorker","_messageHandler","_onWorkerMessage","_attachCallback","method_name","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","__webpack_modules__","amdO","getter","__esModule","definition","__webpack_exports__"],"sourceRoot":""}